# Home

---
title: 'PostgreSQL Tutorial'
page_title: 'PostgreSQL Tutorial'
page_description: 'Learn PostgreSQL quickly through a practical PostgreSQL tutorial designed for database administrators and application developers.'
prev_url: 'https://www.postgresqltutorial.com/'
ogImage: '/postgresqltutorial/postgresql-tutorial-homepage.svg'
updatedOn: '2024-09-08T01:42:12+00:00'
enableTableOfContents: true
---

![PostgreSQL Tutorial](/postgresqltutorial/postgresql-tutorial-homepage.svg?alignright 'PostgreSQL Tutorial')
Welcome to the PostgreSQLTutorial.com website!

This **PostgreSQL tutorial** helps you quickly understand PostgreSQL. You’ll master PostgreSQL fast through many practical examples and apply the knowledge to application development using PostgreSQL.

If you want to:

- Learn PostgreSQL fast.
- Develop applications using PostgreSQL as the back\-end database.
- Migrate from other database management systems such as MySQL, Oracle, and Microsoft SQL Server.

You’ve come to the right place. This website provides you with everything you need to know to get started with PostgreSQL quickly and effectively.

The PostgreSQL tutorial demonstrates many unique features of PostgreSQL that position it as the most advanced open\-source database management system.

## Quick start

![](/postgresqltutorial/getting-started-with-postgresql.svg?alignleft)

### [Getting Started with PostgreSQL](./postgresql-getting-started/)

This section helps you get started with PostgreSQL by showing you how to install PostgreSQL on Windows, Linux, and macOS. You also learn how to connect to PostgreSQL using the psql tool as well as how to load a sample database into the PostgreSQL for practicing.

## Basic PostgreSQL Tutorial

First, you’ll learn how to query data from a single table using basic data techniques, which include selecting data, sorting result sets, and filtering rows.

Next, you’ll delve into advanced queries, which include joining multiple tables, using set operations, and constructing the subquery.

Finally, you’ll learn how to manage database tables, including creating a new table or modifying the structure of an existing table.

### Section 1\. Querying Data

- [Select](./postgresql-tutorial/postgresql-select/ 'PostgreSQL SELECT') – show you how to query data from a single table.
- [Column aliases](./postgresql-tutorial/postgresql-column-alias/) – learn how to assign temporary names to columns or expressions within a query.
- [Order By](./postgresql-tutorial/postgresql-order-by/ 'PostgreSQL ORDER BY') – guide you on how to sort the result set returned by a query.
- [Select Distinct](./postgresql-tutorial/postgresql-select-distinct/ 'PostgreSQL SELECT DISTINCT')  – show you how to remove duplicate rows from the result set.

### Section 2\. Filtering Data

- [Where](./postgresql-tutorial/postgresql-where/ 'PostgreSQL WHERE') – filter rows based on a specified condition.
- [AND operator](./postgresql-tutorial/postgresql-and/) – combine two boolean expressions and return true if both expressions evaluate to true.
- [OR operator](./postgresql-tutorial/postgresql-or/) – combine two boolean expressions and return false if either expression evaluates to false.
- [Limit](./postgresql-tutorial/postgresql-limit/) – retrieve a subset of rows generated by a query.
- [Fetch](./postgresql-tutorial/postgresql-fetch/)– limit the number of rows returned by a query.
- [In](./postgresql-tutorial/postgresql-in/ 'PostgreSQL IN') – select data that matches any value in a list of values.
- [Between](./postgresql-tutorial/postgresql-between/ 'PostgreSQL BETWEEN') – select data that is a range of values.
- [Like](./postgresql-tutorial/postgresql-like/ 'PostgreSQL LIKE') – filter data based on pattern matching.
- [Is Null](./postgresql-tutorial/postgresql-is-null/) – check if a value is null or not.

### Section 3\. Joining Multiple Tables

- [Joins](./postgresql-tutorial/postgresql-joins/) – show you a brief overview of joins in PostgreSQL.
- [Table aliases](./postgresql-tutorial/postgresql-alias/) – describes how to use table aliases in the query.
- [Inner Join](./postgresql-tutorial/postgresql-inner-join/ 'PostgreSQL INNER JOIN')– select rows from one table that have the corresponding rows in other tables.
- [Left Join](./postgresql-tutorial/postgresql-left-join/ 'PostgreSQL LEFT JOIN') – select rows from one table that may or may not have the corresponding rows in other tables.
- [Self\-join](./postgresql-tutorial/postgresql-self-join/) – join a table to itself by comparing a table to itself.
- [Full Outer Join](./postgresql-tutorial/postgresql-full-outer-join/) – use the full join to find a row in a table that does not have a matching row in another table.
- [Cross Join](./postgresql-tutorial/postgresql-cross-join/) – produce a Cartesian product of the rows in two or more tables.
- [Natural Join](./postgresql-tutorial/postgresql-natural-join/) – join two or more tables using implicit join conditions based on the common column names in the joined tables.

### Section 4\. Grouping Data

- [Group By](./postgresql-tutorial/postgresql-group-by/ 'PostgreSQL GROUP BY') – divide rows of a result set into groups and optionally apply an aggregate function to each group.
- [Having](./postgresql-tutorial/postgresql-having/ 'PostgreSQL HAVING') – apply conditions to groups, which allow you to filter groups.

### Section 5\. Set Operations

- [Union](./postgresql-tutorial/postgresql-union/ 'PostgreSQL UNION') – combine result sets of multiple queries into a single result set.
- [Intersect](./postgresql-tutorial/postgresql-intersect/) – combine the result sets of two or more queries and return a single result set containing rows that appear in both result sets.
- [Except](./postgresql-tutorial/postgresql-except/) – return the rows from the first query that do not appear in the output of the second query.

### Section 6\. Grouping sets, Cubes, and Rollups

- [Grouping Sets](./postgresql-tutorial/postgresql-grouping-sets/)  – generate multiple grouping sets in reporting.
- [Cube](./postgresql-tutorial/postgresql-cube/) – define multiple grouping sets that include all possible combinations of dimensions.
- [Rollup](./postgresql-tutorial/postgresql-rollup/) – generate reports that contain totals and subtotals.

### Section 7\. Subquery

- [Subquery](./postgresql-tutorial/postgresql-subquery/ 'PostgreSQL Subquery') – write a query nested inside another query.
- [Correlated Subquery](./postgresql-tutorial/postgresql-correlated-subquery/) – show you how to use a correlated subquery to perform a query that depends on the values of the current row being processed.
- [ANY](./postgresql-tutorial/postgresql-any/)  – retrieve data by comparing a value with a set of values returned by a subquery.
- [ALL](./postgresql-tutorial/postgresql-all/) – query data by comparing a value with a list of values returned by a subquery.
- [EXISTS](./postgresql-tutorial/postgresql-exists/)  – check for the existence of rows returned by a subquery.

### Section 8\. Common Table Expressions

- [PostgreSQL CTE](./postgresql-tutorial/postgresql-cte/) – introduce you to PostgreSQL common table expressions or CTEs.
- [Recursive query using CTEs](./postgresql-tutorial/postgresql-recursive-query/) – discuss the recursive query and learn how to apply it in various contexts.

### Section 9\. Modifying Data

In this section, you will learn how to insert data into a table with the `INSERT` statement, modify existing data with the `UPDATE` statement, and remove data with the `DELETE` statement. Additionally, you will learn how to use the UPSERT statement to merge data.

- [Insert](./postgresql-tutorial/postgresql-insert/ 'PostgreSQL INSERT') – guide you on how to insert a single row into a table.
- [Insert multiple rows](./postgresql-tutorial/postgresql-insert-multiple-rows/) – show you how to insert multiple rows into a table.
- [Update](./postgresql-tutorial/postgresql-update/ 'PostgreSQL UPDATE') – update existing data in a table.
- [Update join](./postgresql-tutorial/postgresql-update-join/) – update values in a table based on values in another table.
- [Delete](./postgresql-tutorial/postgresql-delete/ 'PostgreSQL DELETE') – delete data in a table.
- [Upsert](./postgresql-tutorial/postgresql-upsert/) – insert or update data if the new row already exists in the table.

### Section 10\. Transactions

- [PostgreSQL Transactions](./postgresql-tutorial/postgresql-transaction/) – show you how to handle transactions in PostgreSQL using BEGIN, COMMIT, and ROLLBACK statements.

### Section 11\. Import \& Export Data

You will learn how to import and export PostgreSQL data from and to CSV file format using the copy command.

- [Import CSV file into Table](./postgresql-tutorial/import-csv-file-into-posgresql-table/) – show you how to import CSV file into a table.
- [Export PostgreSQL Table to CSV file](./postgresql-tutorial/export-postgresql-table-to-csv-file/) – show you how to export tables to a CSV file.

### Section 12\. Managing Tables

In this section, you will begin exploring the PostgreSQL data types and learn how to create new tables and modify the structure of the existing ones.

- [Data types](./postgresql-tutorial/postgresql-data-types/ 'PostgreSQL Data Types') – cover the most commonly used PostgreSQL data types.
- [Create a table](./postgresql-tutorial/postgresql-create-table/ 'PostgreSQL CREATE TABLE') – guide you on how to create a new table in the database.
- [Select Into](./postgresql-tutorial/postgresql-select-into/) \& [Create table as](./postgresql-tutorial/postgresql-create-table-as/)– shows you how to create a new table from the result set of a query.
- [Auto\-increment](./postgresql-tutorial/postgresql-serial/) column with SERIAL – uses SERIAL to add an auto\-increment column to a table.
- [Sequences](./postgresql-tutorial/postgresql-sequences/) – introduce you to sequences and describe how to use a sequence to generate a sequence of numbers.
- [Identity column](./postgresql-tutorial/postgresql-identity-column/) – show you how to use the identity column.
- [Alter table](./postgresql-tutorial/postgresql-alter-table/ 'PostgreSQL ALTER TABLE') – modify the structure of an existing table.
- [Rename table](./postgresql-tutorial/postgresql-rename-table/) – change the name of the table to a new one.
- [Add column](./postgresql-tutorial/postgresql-add-column/) – show you how to add one or more columns to an existing table.
- [Drop column](./postgresql-tutorial/postgresql-drop-column/) – demonstrate how to drop a column of a table.
- [Change column data type](./postgresql-tutorial/postgresql-change-column-type/) – show you how to change a column’s data.
- [Rename column](./postgresql-tutorial/postgresql-rename-column/) – illustrate how to rename one or more table columns.
- [Drop table](./postgresql-tutorial/postgresql-drop-table/ 'PostgreSQL DROP TABLE') – remove an existing table and all of its dependent objects.
- [Truncate table](./postgresql-tutorial/postgresql-truncate-table/ 'PostgreSQL TRUNCATE TABLE') – remove all data in a large table quickly and efficiently.
- [Temporary table](./postgresql-tutorial/postgresql-temporary-table/) – show you how to use the temporary table.
- [Copy a table](./postgresql-tutorial/postgresql-copy-table/) – show you how to copy a table to a new one.

### Section 13\. PostgreSQL Constraints

- [Primary key](./postgresql-tutorial/postgresql-primary-key/) – illustrate how to define a primary key when creating a table or adding a primary key to an existing table.
- [Foreign key](./postgresql-tutorial/postgresql-foreign-key/) – show you how to define foreign key constraints when creating a new table or adding foreign key constraints for existing tables.
- [DELETE CASCADE](./postgresql-tutorial/postgresql-delete-cascade/) – show you how to automatically delete rows in child tables when the corresponding rows in the parent table are deleted.
- [CHECK constraint](./postgresql-tutorial/postgresql-check-constraint/) – add logic to check value based on a Boolean expression.
- [UNIQUE constraint](./postgresql-tutorial/postgresql-unique-constraint/) – ensure that values in a column or a group of columns are unique across the table.
- [NOT NULL constraint](./postgresql-tutorial/postgresql-not-null-constraint/) – ensure values in a column are not NULL.
- [DEFAULT constraint](./postgresql-tutorial/postgresql-default-value/) – specify a default value for a column using the DEFAULT constraint.

### Section 14\. PostgreSQL Data Types in Depth

- [Boolean](./postgresql-tutorial/postgresql-boolean/) – store `TRUE` and `FALSE`values with the Boolean data type.
- [CHAR, VARCHAR, and TEXT](./postgresql-tutorial/postgresql-char-varchar-text/) – learn how to use various character types including `CHAR`, `VARCHAR`, and `TEXT`.
- [NUMERIC](./postgresql-tutorial/postgresql-numeric/) – show you how to use `NUMERIC` type to store values that precision is required.
- [DOUBLE PRECISION](./postgresql-tutorial/postgresql-double-precision-type/) – learn to store inexact, variable\-precision numbers in the database. The DOUBLE PRECISION type is also known as the FLOAT type.
- [REAL](./postgresql-tutorial/postgresql-real-data-type/) – guide you on how to use single\-precision floating\-point numbers in the database.
- [Integer](./postgresql-tutorial/postgresql-integer/) – introduce you to various integer types in PostgreSQL including `SMALLINT`, `INT` and `BIGINT`.
- [DATE](./postgresql-tutorial/postgresql-date/)  – introduce the `DATE` data type for storing date values.
- [Timestamp](./postgresql-tutorial/postgresql-timestamp/) – understand timestamp data types quickly.
- [Interval](./postgresql-tutorial/postgresql-interval/) – show you how to use interval data type to handle a period effectively.
- [TIME](./postgresql-tutorial/postgresql-time/) – use the `TIME` datatype to manage the time of day values.
- [UUID](./postgresql-tutorial/postgresql-uuid/) – guide you on how to use `UUID` datatype and how to generate `UUID` values using supplied modules.
- [Array](./postgresql-tutorial/postgresql-array/) – show you how to work with arrays and introduce you to some handy functions for array manipulation.
- [hstore](./postgresql-tutorial/postgresql-hstore/) – introduce you to the hstore data type, a set of key/value pairs stored in a single value in PostgreSQL.
- [JSON](./postgresql-tutorial/postgresql-json/) – illustrate how to work with JSON data type and use some of the most important JSON operators and functions.
- [User\-defined data types](./postgresql-tutorial/postgresql-user-defined-data-types/) – show you how to use the `CREATE DOMAIN` and `CREATE TYPE` statements to create user\-defined data types.
- [Enum](./postgresql-tutorial/postgresql-enum/) – learn how to create an enum type that defines a list of fixed values for a column.
- [XML](./postgresql-tutorial/postgresql-xml-data-type/) – show you how to store XML documents in the database using the XML data type.
- [BYTEA](./postgresql-tutorial/postgresql-bytea-data-type/) – learn how to store binary strings in the database.
- [Composite Types](./postgresql-tutorial/postgresql-composite-types/) – show you how to define a composite type that consists of multiple fields.

### Section 15\. Conditional Expressions \& Operators

- [CASE](./postgresql-tutorial/postgresql-case/) – show you how to form conditional queries with `CASE` expression.
- [COALESCE](./postgresql-tutorial/postgresql-coalesce/) – return the first non\-null argument. You can use it to substitute `NULL` by a default value.
- [NULLIF](./postgresql-tutorial/postgresql-nullif/) – return `NULL` if the first argument equals the second one.
- [CAST](./postgresql-tutorial/postgresql-cast/) – convert from one data type into another e.g., from a string into an integer, from a string into a date.

### Section 16\. PostgreSQL Utilities

- [psql commands](./postgresql-administration/psql-commands/) – show you the most common psql commands that help you interact with psql faster and more effectively.

### Section 17\. PostgreSQL Recipes

- [How to compare two tables](./postgresql-tutorial/compare-two-tables-in-postgresql/) – describe how to compare data in two tables in a database.
- [How to delete duplicate rows in PostgreSQL](./postgresql-tutorial/how-to-delete-duplicate-rows-in-postgresql/) – show you various ways to delete duplicate rows from a table.
- [How to generate a random number in a range](./postgresql-tutorial/postgresql-random-range/)  – illustrate how to generate a random number in a specific range.
- [EXPLAIN statement](./postgresql-tutorial/postgresql-explain/)– guide you on how to use the `EXPLAIN` statement to return the execution plan of a query.
- [PostgreSQL vs. MySQL](./postgresql-tutorial/postgresql-vs-mysql/) – compare PostgreSQL with MySQL in terms of functionalities.

## Advanced PostgreSQL Tutorial

This advanced PostgreSQL tutorial covers the advanced concepts including stored procedures, indexes, views, triggers, and database administrations.

![](/postgresqltutorial/postgresql-plpgsql.svg?alignleft)

### [PostgreSQL PL/pgSQL](./postgresql-plpgsql/)

This PostgreSQL stored procedures section shows you step by step how to develop PostgreSQL user\-defined functions using PL/pgSQL procedural language.![](/postgresqltutorial/postgresql-triggers.svg?alignleft)

### [PostgreSQL Triggers](./postgresql-triggers/)

This section provides you with PostgreSQL trigger concept and shows how to manage triggers in PostgreSQL.![](/postgresqltutorial/postgresql-views.svg?alignleft)

### [PostgreSQL Views](./postgresql-views/)

This section introduces you to PostgreSQL views concept and shows you how to manage views in the database.![](/postgresqltutorial/postgresql-indexes.svg?alignleft)

### [PostgreSQL Indexes](./postgresql-indexes/)

In this tutorial, you will learn how to use PostgreSQL indexes to enhance the data retrieval speed and various index types.![](/postgresqltutorial/postgresql-administration.svg?alignleft)

### [PostgreSQL Administration](./postgresql-administration/)

PostgreSQL administration covers common database administrative tasks including role and database management, backup, and restore.


# Getting Started

---
title: 'Getting Started with PostgreSQL'
page_title: 'Getting Started with PostgreSQL'
page_description: 'This section helps you get started with PostgreSQL by showing you how to install PostgreSQL on Windows, Linux, and macOS.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-getting-started/'
ogImage: ''
updatedOn: '2021-04-27T02:23:23+00:00'
enableTableOfContents: true
previousLink:
  title: ''
  slug: ''
nextLink:
  title: 'What is PostgreSQL?'
  slug: 'postgresql-getting-started/what-is-postgresql'
---

This section helps you get started with PostgreSQL by showing you how to install PostgreSQL on Windows, Linux, and macOS. You also learn how to connect to PostgreSQL using the psql tool as well as how to load a sample database into the PostgreSQL for practicing.

## Getting Started

- [What is PostgreSQL](postgresql-getting-started/what-is-postgresql) – introduce you to PostgreSQL and its applications in today’s software stack.
- [Introduction to PostgreSQL sample database](postgresql-getting-started/postgresql-sample-database) – to learn the PostgreSQL fast, you need to have a good sample database to practice with. This tutorial introduces you to a PostgreSQL sample database called `dvdrental`.

## PostgreSQL on Windows

If you’re using windows, you can follow these tutorials to install PostgreSQL, connect to it, and load the sample database into the PostgreSQL database server:

- [Install PostgreSQL on Windows](postgresql-getting-started/install-postgresql 'Install PostgreSQL') – walk you through the steps of how to install PostgreSQL on Windows.
- [Connect to PostgreSQL database server](postgresql-getting-started/connect-to-postgresql-database 'Connect to PostgreSQL Database') – show you how to connect to the PostgreSQL using psql tool and pgAdmin 4 GUI tool.
- [Load the sample database into the PostgreSQL database server](postgresql-getting-started/load-postgresql-sample-database 'Load PostgreSQL Sample Database') – guide you on how to load the sample database into the PostgreSQL database server for practicing.

## PostgreSQL on Linux

- [Install PostgreSQL on Ubuntu](postgresql-getting-started/install-postgresql-linux) – you will learn how to install PostgreSQL on Ubuntu, connect to the PostgreSQL database server using the `psql` tool, and load the sample database into the PostgreSQL.

## PostgreSQL on macOS

- [Install PostgreSQL on macOS](postgresql-getting-started/install-postgresql-macos) – learn how to download PostgreSQL installer for macOS, how to install PostgreSQL on macOS, and how to restore the sample database into the PostgreSQL database server.


# PostgreSQL Quick Start

# What is PostgreSQL?

---
title: 'What is PostgreSQL?'
page_title: 'What is PostgreSQL?'
page_description: 'What is PostgreSQL? PostgreSQL is a general-purpose and object-relational database management system, the most advanced open-source RDBMS.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-getting-started/what-is-postgresql/'
ogImage: '/postgresqltutorial/What-is-PostgreSQL.png'
updatedOn: '2024-01-18T09:18:45+00:00'
enableTableOfContents: true
previousLink:
  title: 'Getting Started with PostgreSQL'
  slug: 'postgresql-getting-started/'
nextLink:
  title: 'PostgreSQL Sample Database'
  slug: 'postgresql-getting-started/postgresql-sample-database'
---

**Summary**: in this tutorial, you will learn about PostgreSQL and its applications.

## What is PostgreSQL

[![What is PostgreSQL](/postgresqltutorial/What-is-PostgreSQL.png?alignright)](/postgresqltutorial/What-is-PostgreSQL.png)Let’s start with a simple question: what is PostgreSQL?

PostgreSQL is an advanced, enterprise\-class, and open\-source relational database system. PostgreSQL supports both SQL (relational) and JSON (non\-relational) querying.

PostgreSQL is a highly stable database backed by more than 20 years of development by the open\-source community.

PostgreSQL is used as a primary database for many web applications as well as mobile and analytics applications.

PostgreSQL’s community pronounces PostgreSQL as /ˈpoʊstɡrɛs ˌkjuː ˈɛl/.

## History of PostgreSQL

The PostgreSQL project started in 1986 at [Berkeley Computer Science Department](http://www.cs.berkeley.edu/), University of California.

The project was originally named POSTGRES, about the older Ingres database which was also developed at Berkeley. The goal of the POSTGRES project was to add the minimal features needed to support multiple data types.

In 1996, the POSTGRES project was renamed to PostgreSQL to clearly illustrate its support for SQL. Today, PostgreSQL is commonly abbreviated as Postgres.

Since then, the PostgreSQL Global Development Group, a dedicated community of contributors continues to make the releases of the open\-source and free database project.

Originally, PostgreSQL was designed to run on UNIX\-like platforms. And then, PostgreSQL evolved to run on various platforms such as Windows, macOS, and Solaris.

## Common Use Cases of PostgreSQL

The following are the common use cases of PostgreSQL.

### 1\) A robust database in the LAPP stack

LAPP stands for **L**inux, **A**pache, **P**ostgreSQL, and **P**HP (or Python and Perl). PostgreSQL is primarily used as a robust back\-end database that powers many dynamic websites and web applications.

### 2\) General\-purpose transaction database

Large corporations and startups alike use PostgreSQL as the primary database to support their applications and products.

### 3\) Geospatial database

PostgreSQL with the [PostGIS extension](https://postgis.net/) supports geospatial databases for geographic information systems (GIS).

## Language support

PostgreSQL supports the most popular programming languages:

- Python
- Java
- C\#
- C/C\+
- Ruby
- JavaScript (Node.js)
- Perl
- Go
- Tcl

## PostgreSQL feature highlights

PostgreSQL has many advanced features that other enterprise\-class database management systems offer, such as:

- User\-defined types
- Table inheritance
- Sophisticated locking mechanism
- [Foreign key referential integrity](../postgresql-tutorial/postgresql-foreign-key)
- [Views](../postgresql-views), rules, [subquery](../postgresql-tutorial/postgresql-subquery)
- Nested transactions (savepoints)
- Multi\-version concurrency control (MVCC)
- Asynchronous replication

The recent versions of PostgreSQL support the following features:

- Native Microsoft Windows Server version
- Tablespaces
- Point\-in\-time recovery

And more new features are added in each new release.

PostgreSQL is designed to be extensible. PostgreSQL allows you to define your data types, index types, functional languages, and so on.

If you don’t like any part of the system, you can always develop a custom plugin to enhance it to meet your requirements such as adding a new optimizer.

## Who uses PostgreSQL

Many companies have built products and solutions based on PostgreSQL. Some featured companies are Apple, Fujitsu, Red Hat, Cisco, Juniper Network, Instagram, and so on.


# PostgreSQL Sample Database

---
title: 'PostgreSQL Sample Database'
page_title: 'PostgreSQL Sample Database'
page_description: 'This tutorial introduces you to a PostgreSQL sample database that you can use for learning and practicing with PostgreSQL.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-getting-started/postgresql-sample-database/'
ogImage: '/postgresqltutorial/dvd-rental-sample-database-diagram.png'
updatedOn: '2024-01-16T02:36:36+00:00'
enableTableOfContents: true
previousLink:
  title: 'What is PostgreSQL?'
  slug: 'postgresql-getting-started/what-is-postgresql'
nextLink:
  title: 'Install PostgreSQL on Windows'
  slug: 'postgresql-getting-started/install-postgresql'
---

**Summary**: in this tutorial, we will introduce you to a PostgreSQL sample database that you can use for learning and practicing PostgreSQL.

We will use the DVD rental database to demonstrate the features of PostgreSQL.

The DVD rental database represents the business processes of a DVD rental store. The DVD rental database has many objects, including:

- 15 tables
- 1 trigger
- 7 views
- 8 functions
- 1 domain
- 13 sequences

## DVD Rental ER Model

## PostgreSQL Sample Database Diagram

In the diagram, the asterisk (\*), which appears in front of the field, indicates the [primary key](../postgresql-tutorial/postgresql-primary-key).

## PostgreSQL Sample Database Tables

There are 15 tables in the DVD Rental database:

- actor – stores actor data including first name and last name.
- film – stores film data such as title, release year, length, rating, etc.
- film_actor – stores the relationships between films and actors.
- category – stores film’s categories data.
- film_category\- stores the relationships between films and categories.
- store – contains the store data including manager staff and address.
- inventory – stores inventory data.
- rental – stores rental data.
- payment – stores customer’s payments.
- staff – stores staff data.
- customer – stores customer data.
- address – stores address data for staff and customers
- city – stores city names.
- country – stores country names.

## Download the PostgreSQL sample database

You can download the PostgreSQL DVD Rental sample database via the following link:

[Download DVD Rental Sample Database](/postgresqltutorial/dvdrental.zip)

The database file is in `zip`format ( `dvdrental.zip`) so you need to extract it to  `dvdrental.tar` [before loading the sample database into the PostgreSQL database server](load-postgresql-sample-database 'Load PostgreSQL Sample Database').

## Download printable ER diagram

Besides the sample database, we provide you with a printable ER diagram in PDF format. You can download and print the ER diagram for reference while practicing PostgreSQL.

[Download the Printable ER Diagram](/postgresqltutorial/printable-postgresql-sample-database-diagram.pdf)

This tutorial introduced you to a PostgreSQL sample database named DVD Rental. We will use this database in our PostgreSQL tutorials, so make sure [you load it to your server](load-postgresql-sample-database).


# Install PostgreSQL on Windows

---
title: 'Install PostgreSQL on Windows'
page_title: 'Install PostgreSQL'
page_description: 'In this tutorial, we will show you how to install PostgreSQL in your local system for learning and practicing PostgreSQL.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-getting-started/install-postgresql/'
ogImage: '/postgresqltutorial/Install-PostgreSQL-Windows-Step-1.png'
updatedOn: '2024-01-16T05:41:06+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Sample Database'
  slug: 'postgresql-getting-started/postgresql-sample-database'
nextLink:
  title: 'Connect to a PostgreSQL Database Server'
  slug: 'postgresql-getting-started/connect-to-postgresql-database'
---

**Summary**: in this tutorial, you will step by step learn how to **install PostgreSQL** on your local system.

- [Install PostgreSQL on macOS](install-postgresql-macos)
- [Install PostgreSQL on Linux](install-postgresql-linux)

<CTA title="Run PostgreSQL in the Cloud, Free" description="As an alternative to installing Postgres locally, you can get cloud Postgres in seconds on Neon with a generous free plan. No credit card required." buttonText="Get Cloud Postgres" buttonUrl="/signup?ref=pgt-install-cta" />

PostgreSQL was developed for UNIX\-like platforms, however, it was designed to be portable. It means that PostgreSQL can also run on other platforms such as macOS, Solaris, and Windows.

To install PostgreSQL on Windows, you follow these steps:

- First, download the PostgreSQL installer for Windows.
- Second, install PostgreSQL using the installer.
- Third, add the path to the PostgreSQL’s bin directory to the PATH environment variable.

## 1\) Download PostgreSQL Installer for Windows

First, go to the download page of [PostgreSQL installers on the EnterpriseDB](https://www.enterprisedb.com/downloads/postgres-postgresql-downloads).

Second, download the PostgreSQL for Windows x86\-64 version 16\.1 (or the latest version). It’ll take a few minutes to complete.

## 2\) Install PostgreSQL on Windows step\-by\-step

To install PostgreSQL on Windows, you need to have administrator privileges.

Step 1\. Double\-click on the installer file and an installation wizard will appear and guide you through multiple steps. Hence, you can choose various options based on your preferences for PostgreSQL.

Step 2\. Click the Next button

![in this tutorial, you will step by step learn how to install PostgreSQL on your local system.](/postgresqltutorial/Install-PostgreSQL-Windows-Step-1.png)Step 3\. Specify the installation directory by either choosing your preferred location or using the default folder suggested by the PostgreSQL installer and click the Next button

![](/postgresqltutorial/Install-PostgreSQL-Windows-Step-2.png)
Step 4\. Select software components to install:

- **PostgreSQL Server** option allows you to install the PostgreSQL database server
- **pgAdmin 4** option allows you to install the PostgreSQL database GUI management tool.
- **Stack Builder** provides a GUI that allows you to download and install drivers that work with PostgreSQL.
- **Command Line Tools** option allows you to install command\-line tools such as `psql`, `pg_restore`, and so on. These tools allow you to interact with the PostgreSQL database server using the command\-line interface.

For tutorials on this website, you can skip installing Stack Builder. Feel free to uncheck it and click the Next button to proceed to the data directory selection:

![](/postgresqltutorial/Install-PostgreSQL-Windows-Step-3.png)
Step 5\. Choose the database directory to store the data, or accept the default directory. Click the Next button to proceed to the next step:

![](/postgresqltutorial/Install-PostgreSQL-Windows-Step-4.png)
Step 6\. Enter the password for the database superuser (`postgres`).

After entering the password, retype for confirmation, and then click the Next button:

Step 7\. Specify a port number on which the PostgreSQL database server will listen. The default port of PostgreSQL is 5432\. Ensure that no other applications are using this port.

![](/postgresqltutorial/Install-PostgreSQL-Windows-Step-6.png)
Step 8\. Select the default locale for the PostgreSQL server. If you leave it as the default, PostgreSQL will use the operating system locale. Afterward, click the Next button.

![](/postgresqltutorial/Install-PostgreSQL-Windows-Step-7.png)
Step 9\. The setup wizard will show the summary PostgreSQL information. Review the details, and if everything is correct, click the Next button. Otherwise, click the Back button to adjust the configuration accordingly.

![](/postgresqltutorial/Install-PostgreSQL-Windows-Step-8.png)
Now, you are ready to install PostgreSQL on your computer. Click the **Next** button to initiate PostgreSQL installation.

![](/postgresqltutorial/Install-PostgreSQL-Windows-Step-9.png)
The installation may take a few minutes to complete.

![](/postgresqltutorial/Install-PostgreSQL-Windows-Step-9-1.png)
Step 10\. Click the **Finish** button to complete the PostgreSQL installation.

![](/postgresqltutorial/Install-PostgreSQL-Windows-Step-10.png)

## 3\) Adding bin directory to the PATH environment variable

By adding the bin directory of the PostgreSQL to the `PATH` environment variable, you enable the execution of common PostgreSQL tools, such as `plsql` and `pg_restore`, from any directory without the need to navigate the bin directory first.

First, find the path of the `bin` directory of the PostgreSQL installation directory. Typically, it is set to the following:

```xml
C:\Program Files\PostgreSQL\<version>\bin
```

The `<version>` is PostgreSQL’s specific version. For example, if you install PostgreSQL 16, the path to the `bin` directory will look like this:

```
C:\Program Files\PostgreSQL\16\bin
```

Second, open the environment variables:

- Press `Win + R` to open the Run dialog
- Type `sysdm.cpl` an press Enter. The System Properties dialog will display.
- Select the Advanced tab and click the `Environment Variables...` button.

You’ll see two sections in the `Environment Variables` window:

- User variables for \[YourUsername]
- System variables.

Usually, you can edit the `PATH` variable under the `System variables` section, but if you want to add the path only for your user account, you can edit the `User variables` section.

Third, select the `Path` variable under the `User variables` and click the `Edit` button.

Fourth, in the `Edit Environment Variable` window, click the New button.

Fifth, enter `C:\Program Files\PostgreSQL\16\bin` and click `OK` to add it to the list of paths.

Finally, click the OK button to close the Environment Variables window and click the OK button to close the System Properties window.

Congratulations! You’ve successfully installed the PostgreSQL database server on your local system. Let’s learn various ways to [connect to the PostgreSQL database server](connect-to-postgresql-database 'Connect to PostgreSQL Database').


# Connect to Database

---
title: 'Connect to a PostgreSQL Database Server'
page_title: 'Connecting to PostgreSQL Database Server'
page_description: 'You will learn how to connect to the PostgreSQL Database Server via client tools including psql and pgAdmin.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-getting-started/connect-to-postgresql-database/'
ogImage: '/postgresqltutorial/pgAdmin-4.png'
updatedOn: '2024-02-19T06:34:03+00:00'
enableTableOfContents: true
previousLink:
  title: 'Install PostgreSQL on Windows'
  slug: 'postgresql-getting-started/install-postgresql'
nextLink:
  title: 'Load PostgreSQL Sample Database'
  slug: 'postgresql-getting-started/load-postgresql-sample-database'
---

**Summary**: in this tutorial, you will learn how to **connect to the PostgreSQL Database Server** via an interactive terminal program called **psql** and via the **pgAdmin** application.

When you [install the PostgreSQL database server](install-postgresql 'Install PostgreSQL'), the PostgreSQL installer will also install some useful tools for working with the PostgreSQL server.

In this tutorial, you will learn how to connect to the PostgreSQL server via the following tools:

- `psql` – a terminal\-based utility to connect to the PostgreSQL server.
- `pgAdmin` – a web\-based tool to connect to the PostgreSQL server.

## 1\) Connect to PostgreSQL database server using psql

The `psql` is an interactive terminal program provided by PostgreSQL. It allows you to interact with the PostgreSQL server such as executing SQL statements and managing database objects.

The following steps show you how to connect to the PostgreSQL database server via the `psql` program:

First, open the Command Prompt on Windows or Terminal on Unix\-like systems.

Second, use the `psql` command to connect to the PostgreSQL server:

```shellsql
psql -U postgres
```

In this command:

- `psql`: Invoke the psql program.
- `-U postgres`: Specify the user that connects to the PostgreSQL server. The `-U` option means user. Note that you need to use `-U` in uppercase, not lowercase.

The command will prompt you to enter the password for the `postgres` user:

```shell
Password for user postgres:
```

You need to provide the password for the `postgres` user and press Enter (or Return key). Note that the password is the one that you provided when installing the PostgreSQL server.

After entering the password correctly, you’ll be connected to the PostgreSQL server. The command prompt will change to something like this:

```shell
postgres=#
```

In this command, `postgres` is the default database of a PostgreSQL server.

Connecting to the PostgreSQL server will grant you a session. A session is log\-lived, allowing you to perform many requests such as executing commands, before eventually disconnecting.

Third, execute the following command to retrieve the PostgreSQL version:

```plaintext
SELECT version();
```

Please ensure to conclude the statement with a semicolon (`;`). Upon pressing **Enter**, `psql` will return the current PostgreSQL version on your system.

The output will look like:

```
                          version
------------------------------------------------------------
 PostgreSQL 16.1, compiled by Visual C++ build 1937, 64-bit
(1 row)
```

To show the current database, you can use the following command:

```
SELECT current_database();
```

Output:

```
 current_database
------------------
 postgres
(1 row)
```

To show the IP address and port of the current connection, you can execute the following command:

```
SELECT
  inet_server_addr(),
  inet_server_port();
```

Output:

```
 inet_server_addr | inet_server_port
------------------+------------------
 127.0.0.1        |             5432
(1 row)
```

## 2\) Connect to PostgreSQL database server using pgAdmin

The second way to connect to a database is by using a pgAdmin application.

The pgAdmin application allows you to interact with the PostgreSQL database server via an intuitive user interface.

The following illustrates how to connect to a database using the pgAdmin application:

First, launch the pgAdmin application from the Start menu

The pgAdmin application will launch on the web browser as shown in the following picture:

![](/postgresqltutorial/pgAdmin-4.png)Second, right\-click the Servers node and select **Register \> Server…** menu to create a server

![](/postgresqltutorial/Connect-to-PostgreSQL-pgadmin4.png)
Third, enter the server name such as `Local`, and click the **Connection** tab:

![](/postgresqltutorial/Connect-to-PostgreSQL-pgadmin4-server-name.png)
Fourth, enter the host and password for the `postgres` user and click the **Save** button:

![](/postgresqltutorial/Connect-to-PostgreSQL-pgadmin4-connection.png)
Fifth, click on the `Servers` node to expand the server. By default, PostgreSQL has a database named `postgres`:

![](/postgresqltutorial/Connect-to-PostgreSQL-pgadmin4-databases.png)
Sixth, open the query tool by selecting the menu item **Tool \> Query Tool**:

![](/postgresqltutorial/Connect-to-PostgreSQL-pgadmin4-query-tool.png)
Seventh, enter the query in the **Query Editor** and click the **Execute** button, you will see the result of the query displayed in the **Data Output** tab:

![](/postgresqltutorial/Connect-to-PostgreSQL-pgadmin4-execute-query.png)

## Connect to PostgreSQL Server from other applications

Any application that supports ODBC or [JDBC](../postgresql-jdbc) can connect to the PostgreSQL server.

Furthermore, if you develop an application that uses a specific driver, it can connect to the PostgreSQL database server:

- [Connect to PostgreSQL from PHP](../postgresql-php/connect)
- [Connect to PostgreSQL from Python](../postgresql-python/connect)
- [Connect to PostgreSQL from Java](../postgresql-jdbc/connecting-to-postgresql-database)

In this tutorial, you’ve learned how to connect to the PostgreSQL database server by using various client tools, including psql and pgAdmin.


# Load Sample Database

---
title: 'Load PostgreSQL Sample Database'
page_title: 'Load PostgreSQL Sample Database'
page_description: 'In this tutorial, we will show you how to load a PostgreSQL sample database into the PostgreSQL database server.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-getting-started/load-postgresql-sample-database/'
ogImage: '/postgresqltutorial/PostgreSQL-create-database-pgadmin4.png'
updatedOn: '2024-01-20T09:40:21+00:00'
enableTableOfContents: true
previousLink:
  title: 'Connect to a PostgreSQL Database Server'
  slug: 'postgresql-getting-started/connect-to-postgresql-database'
nextLink:
  title: 'Install PostgreSQL macOS'
  slug: 'postgresql-getting-started/install-postgresql-macos'
---

**Summary**: in this tutorial, you will learn how to load the **PostgreSQL sample database** into the PostgreSQL database server**.**

Before going forward with this tutorial, you need to have:

- A PostgreSQL database server.
- A [PostgreSQL sample database](postgresql-sample-database) called `dvdrental`.

## Load the sample database using the psql \& pg_restore tool

`psql` is a terminal\-based client tool to PostgreSQL. It allows you to enter queries, send them to PostgreSQL for execution, and display the results.

`pg_restore` is a utility for restoring a database from an archive.

To create a database and load data from an archive file, you follow these steps:

- First, connect to the [PostgreSQL database server](connect-to-postgresql-database) using `psql` or `pgAdmin`.
- Second, create a blank database called `dvdrental`.
- Third, load data from the sample database file into the `dvdrental` database using `pg_restore`.

### 1\) Create the dvdrental database

First, open the Command Prompt on Windows or Terminal on Unix\-like systems and connect to the PostgreSQL server using **psql** tool:

```phpsql
psql -U postgres
```

It’ll prompt you to enter a password for the `postgres` user:

```
Password for user postgres:
```

The password for the `postgres` user is the one you entered during the [PostgreSQL installation](install-postgresql).

After entering the password correctly, you will be connected to the PostgreSQL server.

The command prompt will look like this:

```
postgres=#
```

Second, create a new database called `dvdrental` using [`CREATE DATABASE`](../postgresql-administration/postgresql-create-database) statement:

```php
CREATE DATABASE dvdrental;
```

Output:

```
CREATE DATABASE
```

PostgreSQL will create a new database called `dvdrental`.

Third, verify the database creation using the `\l` command. The `\l` command will show all databases in the PostgreSQL server:

```
\l
```

Output:

```
                                                                      List of databases
   Name    |  Owner   | Encoding | Locale Provider |          Collate           |           Ctype            | ICU Locale | ICU Rules |   Access privileges
-----------+----------+----------+-----------------+----------------------------+----------------------------+------------+-----------+-----------------------
 dvdrental | postgres | UTF8     | libc            | English_United States.1252 | English_United States.1252 |            |           |
 postgres  | postgres | UTF8     | libc            | English_United States.1252 | English_United States.1252 |            |           |
 template0 | postgres | UTF8     | libc            | English_United States.1252 | English_United States.1252 |            |           | =c/postgres          +
           |          |          |                 |                            |                            |            |           | postgres=CTc/postgres
 template1 | postgres | UTF8     | libc            | English_United States.1252 | English_United States.1252 |            |           | =c/postgres          +
           |          |          |                 |                            |                            |            |           | postgres=CTc/postgres
(4 rows)
```

The output shows that `dvdrental` on the list, meaning that you have created the `dvdrental` database successfully.

Note that other databases such as `postgres`, `template0`, and `template1` are the system databases.

Fourth, disconnect from the PostgreSQL server and exit the `psql` using the `exit` command:

```php
exit
```

### 2\) Restore the sample database from a tar file

Fifth, download the sample database (`dvdrental.zip`) and extract the `tar` file to the directory such as `D:\sampledb\postgres\dvdrental.tar` on Windows.

Sixth, load the `dvdrental` database using the `pg_restore` command:

```css
pg_restore -U postgres -d dvdrental D:\sampledb\postgres\dvdrental.tar
```

In this command:

- The `-U postgres` instructs `pg_restore` to connect the PostgreSQL server using the `postgres` user.
- The `-d dvdrental` specifies the target database to load.

It’ll prompt you to enter the password for the `postgres` user. Enter the password for the `postgres` user and press the Enter (or Return key):

```php
Password:
```

It’ll take about seconds to load data stored in the `dvdrental.tar` file into the `dvdrental` database.

### 3\) Verify the sample database

First, connect to the PostgreSQL server using the `psql` command:

```
psql -U postgres
```

Second, switch the current database to `dvdrental`:

```
\c dvdrental
```

The command prompt will change to the following:

```
dvdrental=#
```

Third, display all tables in the `dvdrental` database:

```php
\dt
```

Output:

```
             List of relations
 Schema |     Name      | Type  |  Owner
--------+---------------+-------+----------
 public | actor         | table | postgres
 public | address       | table | postgres
 public | category      | table | postgres
 public | city          | table | postgres
 public | country       | table | postgres
 public | customer      | table | postgres
 public | film          | table | postgres
 public | film_actor    | table | postgres
 public | film_category | table | postgres
 public | inventory     | table | postgres
 public | language      | table | postgres
 public | payment       | table | postgres
 public | rental        | table | postgres
 public | staff         | table | postgres
 public | store         | table | postgres
(15 rows)
```

## Load the DVD Rental database using the pgAdmin

pgAdmin is a web\-based graphic user interface (GUI) for interacting with the PostgreSQL server.

The following shows you step\-by\-step how to use the pgAdmin to restore the [sample database](postgresql-sample-database) from the database file:

First, launch the **pgAdmin** tool and [connect to the PostgreSQL server](../postgresql-python/connect).

Second, right\-click the **Databases** and select the **Create \> Database…** menu option:

![](/postgresqltutorial/PostgreSQL-create-database-pgadmin4.png)Third, enter the database name `dvdrental` and click the **Save** button:

![](/postgresqltutorial/PostgreSQL-create-database-database-name.png)
You’ll see the new empty database created under the **Databases** node:

![](/postgresqltutorial/PostgreSQL-create-database-sample-database.png)
Fourth, right\-click on the **dvdrental** database and choose the **Restore…** menu item to restore the database from the downloaded database file:

![](/postgresqltutorial/PostgreSQL-create-database-restore-db.png)
Fifth, enter the path to the sample database file such as **c:\\sampledb\\dvdrental.tar** and click the **Restore** button:

![](/postgresqltutorial/PostgreSQL-create-database-restore-from-a-tar-file.png)
Sixth, the restoration process will complete in a few seconds and show the following dialog once it completes:

![](/postgresqltutorial/PostgreSQL-create-database-completed.png)
Finally, open the `dvdrental` database from the object browser panel, you will find tables in the `public` schema and other database objects as shown in the following picture:

![PostgreSQL Load Sample Database - pgAdmin step 3](/postgresqltutorial/PostgreSQL-Load-Sample-Database-pgAdmin-step-3.png)
In this tutorial, you have learned how to load the `dvdrental` sample database into the PostgreSQL database server for practicing PostgreSQL.

Let’s start learning PostgreSQL and have fun!


# Install PostgreSQL on macOS

---
title: 'Install PostgreSQL macOS'
page_title: 'Install PostgreSQL on macOS'
page_description: 'In this tutorial, you will learn how to download and install PostgreSQL on macOS step by step.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-getting-started/install-postgresql-macos/'
ogImage: '/postgresqltutorial/Install-PostgreSQL-macOS-step-1.png'
updatedOn: '2024-02-02T07:21:07+00:00'
enableTableOfContents: true
previousLink:
  title: 'Load PostgreSQL Sample Database'
  slug: 'postgresql-getting-started/load-postgresql-sample-database'
nextLink:
  title: 'Install PostgreSQL Linux'
  slug: 'postgresql-getting-started/install-postgresql-linux'
---

**Summary**: in this tutorial, you will learn how to download the PostgreSQL, install PostgreSQL on macOS, and restore the sample database.

<CTA title="Run PostgreSQL in the Cloud, Free" description="As an alternative to installing Postgres locally, you can get cloud Postgres in seconds on Neon with a generous free plan. No credit card required." buttonText="Get Cloud Postgres" buttonUrl="/signup?ref=pgt-install-cta" />

## Download PostgreSQL installer for macOS

To download the PostgreSQL installer, you follow these steps:

- First, visit the [PostgreSQL installer download page](https://www.enterprisedb.com/downloads/postgres-postgresql-downloads).
- Then, download the PostgreSQL for macOS.

## Install PostgreSQL on macOS

To install PostgreSQL on macOS, you follow these steps:

First, launch the setup wizard by double\-click the installer file:

![](/postgresqltutorial/Install-PostgreSQL-macOS-step-1.png)Second, select the directory where the PostgreSQL will be installed and click the Next button:

![](/postgresqltutorial/Install-PostgreSQL-macOS-step-2.png)
Third, select the components that you want to install, uncheck the Stack Builder, and click the Next button:

![](/postgresqltutorial/Install-PostgreSQL-macOS-step-3.png)
Fourth, specify a directory where PostgreSQL stores the data and click the Next button:

![](/postgresqltutorial/Install-PostgreSQL-macOS-step-4.png)
Fifth, enter the password for the **postgres** user account. You should note down this password for logging in to the PostgreSQL database server later. After that, click the Next button.

![](/postgresqltutorial/Install-PostgreSQL-macOS-step-5.png)
Sixth, specify the port number on which the PostgreSQL server will listen. By default, PostgreSQL uses port number 5432\.

![](/postgresqltutorial/Install-PostgreSQL-macOS-step-6.png)
Seventh, select the locale used by PostgreSQL. By default, PostgreSQL uses the locale of the current operating system:

![](/postgresqltutorial/Install-PostgreSQL-macOS-step-7.png)
Eighth, review the installation information. If everything looks correct, click the Next button to begin the installation.

![](/postgresqltutorial/Install-PostgreSQL-macOS-step-8.png)
Ninth, click the Next button to start installing the PostgreSQL database server on your computer:

![](/postgresqltutorial/Install-PostgreSQL-macOS-step-9.png)
It will take few mintues to complete the installation.

![](/postgresqltutorial/Install-PostgreSQL-step-10.png)
Finally, click the Finish button once the installation is completed:

![](/postgresqltutorial/Install-PostgreSQL-step-11.png)

## Load the sample database

First, launch pgAdmin from Launchpad.

Second, enter the password for the **postgres** user.

Third, right\-click the PostgreSQL 12 and select **Create \> Database..** to open a dialog for creating a new database.

![](/postgresqltutorial/Restore-Sample-Database-Step-1.png)
Fourth, enter dvdrental as the database, postgres as the owner, and click the Save button to create the dvdrental database.

![](/postgresqltutorial/Restore-Sample-Database-Step-2.png)
Sixth, [download the sample database](postgresql-sample-database) and unzip it. You’ll get a directory with many files.

Seventh, right\-click the **dvdrental** database and select the **Restore…** menu item:

![](/postgresqltutorial/Restore-Sample-Database-Step-3.png)
Eighth, select the directory as the Format (1\), the directory that contains sample database as the Filename (2\), and postgres as the Role name (3\), and click the Restore button.

![](/postgresqltutorial/Restore-Sample-Database-Step-4.png)
It will take few seconds to restore the sample database. Once the restoration completes, you will see a notification like this:

![](/postgresqltutorial/Restore-Sample-Database-Step-5.png)
It means that you have successfully created the sample database and restored it from the downloaded file.

In this tutorial, you have learned how to download PostgreSQL installer for macOS, how to install PostgreSQL on macOS, and how to restore the sample database.


# Install PostgreSQL on Linux

---
title: 'Install PostgreSQL Linux'
page_title: 'Install PostgreSQL on Linux (Ubuntu)'
page_description: 'In this tutorial, you will learn how to download and install PostgreSQL on Linux. You also learn how to load the sample database to the PostgreSQL Database Server.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-getting-started/install-postgresql-linux/'
ogImage: ''
updatedOn: '2024-02-19T07:35:09+00:00'
enableTableOfContents: true
previousLink:
  title: 'Install PostgreSQL macOS'
  slug: 'postgresql-getting-started/install-postgresql-macos'
nextLink:
  title: 'PostgreSQL Tutorial'
  slug: 'postgresql-getting-started/..'
---

**Summary**: in this tutorial, you will learn how to download and install PostgreSQL on Linux.

<CTA title="Run PostgreSQL in the Cloud, Free" description="As an alternative to installing Postgres locally, you can get cloud Postgres in seconds on Neon with a generous free plan. No Credit Card Required." buttonText="Get Cloud Postgres" buttonUrl="/signup?ref=pgt-install-cta" />

Most Linux platforms such as Debian, Red Hat / CentOS, SUSE, and Ubuntu have PostgreSQL integrated with their package management.

It is recommended that you install PostgreSQL this way since it ensures a proper integration with the operating system including automatic patching and other update management functionality.

## Install PostgreSQL on Ubuntu

In this tutorial, we’ll show you how to install PostgreSQL 16 on Ubuntu 22\.04\.

### Step 1\. Add PostgreSQL Repository

First, update the package index and install the necessary packages:

```shellsql
sudo apt update
sudo apt install gnupg2 wget
```

Second, add the PostgreSQL repository:

```
sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'
```

Third, import the repository signing key:

```sql
curl -fsSL https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/postgresql.gpg
```

Finally, update the package list

```shell
sudo apt update
```

### Step 2\. Install PostgreSQL 16

First, install PostgreSQL and its contrib modules:

```shell
sudo apt install postgresql-16 postgresql-contrib-16
```

Second, start the PostgreSQL service:

```shell
sudo systemctl start postgresql
```

Third, enable PostgreSQL service:

```php
sudo systemctl enable postgresql
```

### Step 3\. Configure PostgreSQL server

PostgreSQL stores the configuration in the `postgresql.conf` file. You can edit the `postgresql.conf` using any text editor such as nano and vim.

```
sudo nano /etc/postgresql/16/main/postgresql.conf
```

Set the listen_addresses to \* to allow remote connection:

```
listen_addresses = '*'
```

Configure PostgreSQL to use md5 password authentication in the `pg_hba.conf` file. This is necessary if you want to enable remote connections :

```
sudo sed -i '/^host/s/ident/md5/' /etc/postgresql/16/main/pg_hba.conf
sudo sed -i '/^local/s/peer/trust/' /etc/postgresql/16/main/pg_hba.conf
echo "host all all 0.0.0.0/0 md5" | sudo tee -a /etc/postgresql/16/main/pg_hba.conf
```

Restart PostgreSQL for the changes to take effect:

```shell
sudo systemctl restart postgresql
```

Allow PostgreSQL port through the firewall:

```
sudo ufw allow 5432/tcp
```

## Connect to the PostgreSQL database server

First, connect to the PostgreSQL server using the `postgres` user:

```
sudo -u postgres psql
```

Second, set a password for `postgres` user:

```shell
ALTER USER postgres PASSWORD '<password>';
```

Replace the `<password>` with the one you want.

Third, quit the psql:

```shell
\q
```

## Load the sample database

First, download the sample database using the `curl` tool:

```shell
curl -O https://neon.tech/postgresql//postgresqltutorial/dvdrental.zip
```

Second, unzip the dvdrental.zip file to get the dvdrental.tar file:

```shell
unzip dvdrental.zip
```

Third, connect to the PostgreSQL server using `postgres` user:

```shell
sudo -u postgres psql
```

Fourth, create the `dvdrental` database using the [`CREATE DATABASE`](../postgresql-administration/postgresql-create-database) statement:

```shell
create database dvdrental;
```

Fifth, quit the `psql` by using the `\q` command:

```shell
\q
```

Sixth, use the [pg_restore tool to restore](../postgresql-administration/postgresql-restore-database) the `dvdrental` database:

```shell
pg_restore -U postgres --dbname=dvdrental --verbose dvdrental.tar
```

Seventh, access the PostgreSQL database server again using `psql`:

```shell
psql
```

Eighth, switch to the `dvdental` database:

```shell
\c dvdrental
```

Finally, enter the following command to get the number of films in the `film` table:

```shell
select count(*) from film;
```

Here is the output:

```shell
count
-------
1000
(1 row)
```

Congratulations! You have successfully installed PostgreSQL on Ubuntu, connected to the PostgreSQL database server using psql, and loaded the sample database.


# Querying Data

# SELECT

---
title: 'PostgreSQL SELECT'
page_title: 'PostgreSQL SELECT'
page_description: 'This tutorial shows you how to use the basic PostgreSQL SELECT statement to retrieve data from a single table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-select/'
ogImage: '/postgresqltutorial/PostgreSQL-Select.png'
updatedOn: '2024-09-21T09:35:09+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Server and Database Objects'
  slug: 'postgresql-tutorial/postgresql-server-and-database-objects'
nextLink:
  title: 'PostgreSQL Column Alias'
  slug: 'postgresql-tutorial/postgresql-column-alias'
---

**Summary**: in this tutorial, you are going to learn how to use the basic **PostgreSQL SELECT** statement to query data from a table.

Note that if you don’t know how to execute a query against the PostgreSQL database using the **psql** command\-line tool or **pgAdmin** GUI tool, you can check [the connection to the PostgreSQL database tutorial](../postgresql-getting-started/connect-to-postgresql-database).

One of the most common tasks, when you work with the database, is to retrieve data from tables using the `SELECT` statement.

The `SELECT` statement is one of the most complex statements in PostgreSQL. It has many clauses that you can use to form a flexible query.

Due to its complexity, we will break it down into many shorter and easy\-to\-understand tutorials so that you can learn about each clause faster.

The `SELECT` statement has the following clauses:

- Select distinct rows using [`DISTINCT`](postgresql-select-distinct) operator.
- Sort rows using [`ORDER BY`](postgresql-order-by) clause.
- Filter rows using [`WHERE`](postgresql-where) clause.
- Select a subset of rows from a table using [`LIMIT`](postgresql-limit) or [`FETCH`](postgresql-fetch) clause.
- Group rows into groups using [`GROUP BY`](postgresql-group-by) clause.
- Filter groups using [`HAVING`](postgresql-having) clause.
- Join with other tables using [joins](postgresql-joins) such as [`INNER JOIN`](postgresql-inner-join), [`LEFT JOIN`](postgresql-left-join), [`FULL OUTER JOIN`](postgresql-full-outer-join), [`CROSS JOIN`](postgresql-cross-join) clauses.
- Perform set operations using [`UNION`](postgresql-union), [`INTERSECT`](postgresql-intersect), and [`EXCEPT`](https://neon.tech/postgresql/postgresql-tutorial/postgresql-tutorial/postgresql-except/).

In this tutorial, you are going to focus on the `SELECT`and `FROM` clauses.

## PostgreSQL SELECT statement syntax

Let’s start with the basic form of the `SELECT` statement that retrieves data from a single table.

The following illustrates the syntax of the `SELECT` statement:

```phpsqlsql
SELECT
   select_list
FROM
   table_name;
```

In this syntax:

- First, specify a select list that can be a column or a list of columns in a table from which you want to retrieve data. If you specify a list of columns, you need to place a comma (`,`) between two columns to separate them. If you want to select data from all the columns of the table, you can use an asterisk (`*`) shorthand instead of specifying all the column names. The select list may also contain expressions or literal values.
- Second, provide the name of the table from which you want to query data after the `FROM` keyword.

The `FROM` clause is optional. If you are not querying data from any table, you can omit the `FROM` clause in the `SELECT` statement.

PostgreSQL evaluates the `FROM` clause before the `SELECT` clause in the `SELECT` statement:

![](/postgresqltutorial/PostgreSQL-Select.png)
Note that the SQL keywords are case\-insensitive. It means that `SELECT` is equivalent to `select` or `Select`. By convention, we will use all the SQL keywords in uppercase to make the queries easier to read.

## PostgreSQL SELECT examples

Let’s explore some examples of using the `SELECT` statement.

We will use the following `customer` table in the `dvdrental` [sampledatabase](../postgresql-getting-started/postgresql-sample-database 'PostgreSQL Sample Database') for the demonstration.

![customer table](/postgresqltutorial/customer.png)First, [connect to the PostgreSQL server](../postgresql-getting-started/connect-to-postgresql-database) using the `postgres` user:

```bash
psql -U postgres
```

You’ll be prompted to enter a password for the `postgres` user. After entering the password correctly, you will be connected to the PostgreSQL server:

```
postgres=#
```

Second, switch the current database to dvdrental:

```php
\c dvdrental
```

Third, execute the query in the following examples.

### 1\) Using PostgreSQL SELECT statement to query data from one column example

This example uses the `SELECT` statement to find the first names of all customers from the `customer` table:

```
SELECT first_name FROM customer;
```

Here is the partial output:

```text
 first_name
-------------
 Jared
 Mary
 Patricia
 Linda
 Barbara
...
```

Notice that we added a semicolon (`;`) at the end of the `SELECT` statement. The semicolon is not a part of the SQL statement; rather, it serves as a signal of PostgreSQL indicating the conclusion of an SQL statement. Additionally, semicolons are used to separate two or more SQL statements.

### 2\) Using PostgreSQL SELECT statement to query data from multiple columns example

The following query uses the `SELECT` statement to retrieve first name, last name, and email of customers from the `customer` table:

```
SELECT
   first_name,
   last_name,
   email
FROM
   customer;
```

Partial output:

```text
 first_name  |  last_name   |                  email
-------------+--------------+------------------------------------------
 Jared       | Ely          | [[email protected]](../cdn-cgi/l/email-protection.html)
 Mary        | Smith        | [[email protected]](../cdn-cgi/l/email-protection.html)
 Patricia    | Johnson      | [[email protected]](../cdn-cgi/l/email-protection.html)
...
```

The output shows three corresponding columns first_name, last_name, and email.

### 3\) Using PostgreSQL SELECT statement to query data from all columns of a table example

The following query uses the `SELECT *` statement to retrieve data from all columns of the `customer` table:

```
SELECT * FROM customer;
```

Partial output:

```text
 customer_id | store_id | first_name  |  last_name   |                  email                   | address_id | activebool | create_date |       last_update       | active
-------------+----------+-------------+--------------+------------------------------------------+------------+------------+-------------+-------------------------+--------
         524 |        1 | Jared       | Ely          | [[email protected]](../cdn-cgi/l/email-protection.html)             |        530 | t          | 2006-02-14  | 2013-05-26 14:49:45.738 |      1
           1 |        1 | Mary        | Smith        | [[email protected]](../cdn-cgi/l/email-protection.html)            |          5 | t          | 2006-02-14  | 2013-05-26 14:49:45.738 |      1
           2 |        1 | Patricia    | Johnson      | [[email protected]](../cdn-cgi/l/email-protection.html)      |          6 | t          | 2006-02-14  | 2013-05-26 14:49:45.738 |      1
...
```

In this example, we used an asterisk (`*`) in the `SELECT` clause, which serves as a shorthand for all columns.

Instead of listing all columns in the `SELECT` clause individually, we can use the asterisk (`*`) to make the query shorter.

However, using the asterisk (`*`) in the `SELECT` statement is considered a bad practice when you embed SQL statements in the application code, such as [Python](../postgresql-python), [Java](../postgresql-jdbc), or [PHP](../postgresql-php) for the following reasons:

- Database performance. Suppose you have a table with many columns and substantial data, the `SELECT` statement with the asterisk (`*`) shorthand will select data from all the columns of the table, potentially retrieving more data than required for the application.
- Application performance. Retrieving unnecessary data from the database increases the traffic between the PostgreSQL server and the application server. Consequently, this can result in slower response times and reduced scalability for your applications.

For these reasons, it is recommended to explicitly specify the column names in the `SELECT` clause whenever possible. This ensures that only the necessary data is retrieved from the database, contributing to more efficient and optimized queries.

The asterisk (\*) shorthand should be reserved solely for the ad\-hoc queries that examine data from the database.

### 4\) Using PostgreSQL SELECT statement with expressions example

The following example uses the `SELECT` statement to return the full names and emails of all customers from the `customer` table:

```
SELECT
   first_name || ' ' || last_name,
   email
FROM
   customer;
```

Output:

```
       ?column?        |                  email
-----------------------+------------------------------------------
 Jared Ely             | [[email protected]](../cdn-cgi/l/email-protection.html)
 Mary Smith            | [[email protected]](../cdn-cgi/l/email-protection.html)
 Patricia Johnson      | [[email protected]](../cdn-cgi/l/email-protection.html)
...
```

In this example, we used the [concatenation operator](../postgresql-string-functions/postgresql-concat-function) `||` to concatenate the first name, space, and last name of every customer.

Notice the first column of the output doesn’t have a name but `?column?`. To assign a name to a column temporarily in the query, you can use a [column alias](postgresql-column-alias):

```
expression AS column_lias
```

The AS keyword is optional. Therefore, you can use a shorter syntax:

```
expression column_lias
```

For example, you can assign a column alias full_name to the first column of the query as follows:

```
SELECT
   first_name || ' ' || last_name full_name,
   email
FROM
   customer;
```

Output:

```
       full_name       |                  email
-----------------------+------------------------------------------
 Jared Ely             | [[email protected]](../cdn-cgi/l/email-protection.html)
 Mary Smith            | [[email protected]](../cdn-cgi/l/email-protection.html)
 Patricia Johnson      | [[email protected]](../cdn-cgi/l/email-protection.html)
...
```

### 5\) Using PostgreSQL SELECT statement without a FROM clause

The `FROM` clause of the `SELECT` statement is optional. Therefore, you can omit it in the SELECT statement.

Typically, you use the `SELECT` clause with a function to retrieve the function result. For example:

```
SELECT NOW();
```

In this example, we use the [`NOW()`](../postgresql-date-functions/postgresql-now) function in the `SELECT` statement. It’ll return the current date and time of the PostgreSQL server.

## Summary

- Use the `SELECT ... FROM` statement to retrieve data from a table.
- PostgreSQL evaluates the `FROM` clause before the `SELECT` clause.
- Use a column alias to assign a temporary name to a column or an expression in a query.
- In PostgreSQL, the `FROM` clause is optional.


# Column Aliases

---
title: 'PostgreSQL Column Alias'
page_title: 'PostgreSQL Column Alias'
page_description: 'In this tutorial, you will learn about PostgreSQL column aliases and how to use them to assign temporary names to columns in a query.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-column-alias/'
ogImage: '/postgresqltutorial/customer-table.png'
updatedOn: '2024-01-16T08:47:13+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL SELECT'
  slug: 'postgresql-tutorial/postgresql-select'
nextLink:
  title: 'PostgreSQL ORDER BY'
  slug: 'postgresql-tutorial/postgresql-order-by'
---

**Summary**: In this tutorial, you will learn about PostgreSQL column aliases and how to use them to assign temporary names to columns in a query.

## Introduction to the PostgreSQL column aliases

A column alias allows you to assign a column or an expression in the select list of a `SELECT` statement a temporary name. The column alias exists temporarily during the execution of the query.

The following illustrates the syntax of using a column alias:

```phpsqlsql
SELECT column_name AS alias_name
FROM table_name;
```

In this syntax, the `column_name` is assigned an alias `alias_name`. The `AS` keyword is optional so you can omit it like this:

```sql
SELECT column_name alias_name
FROM table_name;
```

The following syntax illustrates how to set an alias for an expression in the [`SELECT`](postgresql-select) clause:

```sql
SELECT expression AS alias_name
FROM table_name;
```

The main purpose of column aliases is to make the headings of the output of a query more meaningful.

### PostgreSQL column alias examples

We’ll use the `customer` table from the [sample database](../postgresql-getting-started/postgresql-sample-database) to show you how to work with column aliases.

![customer table](/postgresqltutorial/customer-table.png)

### 1\) Assigning a column alias to a column example

The following query returns the first names and last names of all customers from the `customer` table:

```sql
SELECT
   first_name,
   last_name
FROM customer;
```

![PostgreSQL Column Alias](/postgresqltutorial/PostgreSQL-Column-Alias-example-1.png)If you want to rename the `last_name` heading, you can assign it a new name using a column alias like this:

```sql
SELECT
   first_name,
   last_name AS surname
FROM customer;
```

This query assigned the `surname` as the alias of the `last_name` column:

![PostgreSQL Column Alias example](/postgresqltutorial/PostgreSQL-Column-Alias-Surname-example-1.png)
Or you can make it shorter by removing the `AS` keyword as follows:

```sql
SELECT
   first_name,
   last_name surname
FROM customer;
```

### 2\) Assigning a column alias to an expression example

The following query returns the full names of all customers. It constructs the full name by concatenating the first name, space, and the last name:

```sql
SELECT
   first_name || ' ' || last_name
FROM
   customer;
```

Note that in PostgreSQL, you use the `||` as the concatenating operator that concatenates one or more strings into a single string.

![PostgreSQL Alias Example](/postgresqltutorial/PostgreSQL-Alias-Example.png)
As you can see clearly from the output, the heading of the column is not meaningful `?column?` .

To fix this, you can assign the expression `first_name || ' ' || last_name` a column alias e.g., `full_name`:

```sql
SELECT
    first_name || ' ' || last_name AS full_name
FROM
    customer;
```

![PostgreSQL Column Alias Example](/postgresqltutorial/PostgreSQL-Alias-column-alias-example.png)

### 3\) Column aliases that contain spaces

If a column alias contains one or more spaces, you need to surround it with double quotes like this:

```
column_name AS "column alias"
```

For example:

```
SELECT
    first_name || ' ' || last_name "full name"
FROM
    customer;
```

![](/postgresqltutorial/PostgreSQL-Column-Alias-with-space.png)

## Summary

- Assign a column or an expression a column alias using the syntax `column_name AS alias_name` or `expression AS alias_name`. The `AS` keyword is optional.
- Use double quotes (“) to surround column aliases that contain spaces.


# ORDER BY

---
title: 'PostgreSQL ORDER BY'
page_title: 'PostgreSQL ORDER BY'
page_description: 'This tutorial shows you how to use the PostgreSQL ORDER BY clause to sort result set returned by a query in ascending or descending order.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-order-by/'
ogImage: '/postgresqltutorial/PostgreSQL-ORDER-BY.png'
updatedOn: '2024-01-16T09:02:03+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Column Alias'
  slug: 'postgresql-tutorial/postgresql-column-alias'
nextLink:
  title: 'PostgreSQL SELECT DISTINCT'
  slug: 'postgresql-tutorial/postgresql-select-distinct'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `ORDER BY` clause to sort the rows of a query by one or more criteria.

## Introduction to PostgreSQL ORDER BY clause

When you query data from a table, the [`SELECT`](postgresql-select) statement returns rows in an unspecified order. To sort the rows of the result set, you use the `ORDER BY` clause in the [`SELECT`](postgresql-select) statement.

The `ORDER BY` clause allows you to sort rows returned by a `SELECT` clause in ascending or descending order based on a sort expression.

The following illustrates the syntax of the `ORDER BY` clause:

```csssqlsql
SELECT
  select_list
FROM
  table_name
ORDER BY
  sort_expression1 [ASC | DESC],
  sort_expression2 [ASC | DESC],
  ...;
```

In this syntax:

- First, specify a sort expression, which can be a column or an expression, that you want to sort after the `ORDER BY` keywords. If you want to sort the result set based on multiple columns or expressions, you need to place a comma (`,`) between two columns or expressions to separate them.
- Second, you use the `ASC` option to sort rows in ascending order and the `DESC` option to sort rows in descending order. If you omit the `ASC` or `DESC` option, the `ORDER BY` uses `ASC` by default.

PostgreSQL evaluates the clauses in the `SELECT` statement in the following order: `FROM`, `SELECT`, and `ORDER BY`:

![](/postgresqltutorial/PostgreSQL-ORDER-BY.png)
Due to the order of evaluation, if you have a column alias in the `SELECT` clause, you can use it in the `ORDER BY` clause.

Let’s take some examples of using the PostgreSQL `ORDER BY` clause.

## PostgreSQL ORDER BY examples

We will use the `customer` table in the [sample database](../postgresql-getting-started/postgresql-sample-database) for the demonstration.

![customer table](/postgresqltutorial/customer.png)

### 1\) Using PostgreSQL ORDER BY clause to sort rows by one column

The following query uses the `ORDER BY` clause to sort customers by their first names in ascending order:

```sql
SELECT
  first_name,
  last_name
FROM
  customer
ORDER BY
  first_name ASC;
```

![PostgreSQL ORDER BY one column example](/postgresqltutorial/PostgreSQL-ORDER-BY-one-column-example.png)
Since the `ASC` option is the default, you can omit it in the `ORDER BY` clause like this:

```sql
SELECT
  first_name,
  last_name
FROM
  customer
ORDER BY
  first_name;
```

### 2\) Using PostgreSQL ORDER BY clause to sort rows by one column in descending order

The following statement selects the first name and last name from the `customer` table and sorts the rows by values in the last name column in descending order:

```sql
SELECT
  first_name,
  last_name
FROM
  customer
ORDER BY
  last_name DESC;
```

![PostgreSQL ORDER BY one column DESC example](/postgresqltutorial/PostgreSQL-ORDER-BY-one-column-desc-example.png)

### 3\) Using PostgreSQL ORDER BY clause to sort rows by multiple columns

The following statement selects the first name and last name from the customer table and sorts the rows by the first name in ascending order and last name in descending order:

```sql
SELECT
  first_name,
  last_name
FROM
  customer
ORDER BY
  first_name ASC,
  last_name DESC;
```

![PostgreSQL ORDER BY multiple columns](/postgresqltutorial/PostgreSQL-ORDER-BY-multiple-columns.png)
In this example, the ORDER BY clause sorts rows by values in the first name column first. Then it sorts the sorted rows by values in the last name column.

As you can see clearly from the output, two customers with the same first name `Kelly` have the last name sorted in descending order.

### 4\) Using PostgreSQL ORDER BY clause to sort rows by expressions

The [`LENGTH()`](../postgresql-string-functions/postgresql-length-function) function accepts a string and returns the length of that string.

The following statement selects the first names and their lengths. It sorts the rows by the lengths of the first names:

```sql
SELECT
  first_name,
  LENGTH(first_name) len
FROM
  customer
ORDER BY
  len DESC;
```

![PostgreSQL ORDER BY expressions](/postgresqltutorial/PostgreSQL-ORDER-BY-expressions.png)
Because the `ORDER BY` clause is evaluated after the `SELECT` clause, the column alias `len` is available and can be used in the `ORDER BY` clause.

## PostgreSQL ORDER BY clause and NULL

In the database world, `NULL` is a marker that indicates the missing data or the data is unknown at the time of recording.

When you sort rows that contain `NULL`, you can specify the order of `NULL` with other non\-null values by using the `NULLS FIRST` or `NULLS LAST` option of the `ORDER BY` clause:

```sql
ORDER BY sort_expresssion [ASC | DESC] [NULLS FIRST | NULLS LAST]
```

The `NULLS FIRST` option places `NULL` before other non\-null values and the `NULL LAST` option places `NULL` after other non\-null values.

Let’s [create a table](postgresql-create-table) for the demonstration.

```php
-- create a new table
CREATE TABLE sort_demo(num INT);

-- insert some data
INSERT INTO sort_demo(num)
VALUES
  (1),
  (2),
  (3),
  (null);
```

Note that if you are not yet familiar with the `CREATE TABLE` and `INSERT` statements, you can simply execute them from `pgAdmin` or `psql` to create the `sort_demo` table and insert data into it.

The following query returns data from the `sort_demo` table:

```sql
SELECT
  num
FROM
  sort_demo
ORDER BY
  num;
```

Output:

```text
 num
------
    1
    2
    3
 null
(4 rows)
```

In this example, the `ORDER BY` clause sorts values in the `num` column of the `sort_demo` table in ascending order. It places `NULL` after other values.

Note that psql displays null as an empty string by default. To make null clearer, you can execute the following command to change an empty string to another such as null:

```text
\pset null null
```

Output:

```sql
Null display is "null".
```

So if you use the `ASC` option, the `ORDER BY` clause uses the `NULLS LAST` option by default. Therefore, the following query returns the same result:

```
SELECT
  num
FROM
  sort_demo
ORDER BY
  num NULLS LAST;
```

Output:

```text
 num
------
    1
    2
    3
 null
(4 rows)
```

To place `NULL` before other non\-null values, you use the `NULLS FIRST` option:

```sql
SELECT
  num
FROM
  sort_demo
ORDER BY
  num NULLS FIRST;
```

Output:

```text
 num
------
 null
    1
    2
    3
(4 rows)
```

The following statement sorts values in the `num` column of the `sort_demo` table in descending order:

```sql
SELECT
  num
FROM
  sort_demo
ORDER BY
  num DESC;
```

Output:

```text
 num
------
 null
    3
    2
    1
(4 rows)
```

The output indicates that the `ORDER BY` clause with the `DESC` option uses the `NULLS FIRST` by default.

To reverse the order, you can use the `NULLS LAST` option:

```sql
SELECT
  num
FROM
  sort_demo
ORDER BY
  num DESC NULLS LAST;
```

Output:

```
 num
------
    3
    2
    1
 null
(4 rows)
```

## Summary

- Use the `ORDER BY` clause in the `SELECT` statement to sort the rows in the query set.
- Use the `ASC` option to sort rows in ascending order and `DESC` option to sort rows in descending order.
- The `ORDER BY` clause uses the `ASC` option by default.
- Use `NULLS FIRST` and `NULLS LAST` options to explicitly specify the order of `NULL` with other non\-null values.


# SELECT DISTINCT

---
title: 'PostgreSQL SELECT DISTINCT'
page_title: 'PostgreSQL SELECT DISTINCT'
page_description: 'This tutorial shows you how to use the PostgreSQL SELECT DISTINCT clause to remove duplicate rows from a result set returned by a query.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-select-distinct/'
ogImage: '/postgresqltutorial/film.png'
updatedOn: '2024-04-19T08:05:04+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL ORDER BY'
  slug: 'postgresql-tutorial/postgresql-order-by'
nextLink:
  title: 'PostgreSQL WHERE'
  slug: 'postgresql-tutorial/postgresql-where'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `SELECT DISTINCT` clause to remove duplicate rows from a result set returned by a query.

## Introduction to PostgreSQL SELECT DISTINCT clause

The `SELECT DISTINCT` removes duplicate rows from a result set. The `SELECT DISTINCT` clause retains one row for each group of duplicates.

The `SELECT DISTINCT` clause can be applied to one or more columns in the select list of the [`SELECT`](postgresql-select) statement.

The following illustrates the syntax of the `DISTINCT` clause:

```sqlsqlsql
SELECT
  DISTINCT column1
FROM
  table_name;
```

In this syntax, the `SELECT DISTINCT` uses the values in the `column1` column to evaluate the duplicate.

If you specify multiple columns, the `SELECT DISTINCT` clause will evaluate the duplicate based on the combination of values in these columns. For example:

```sql
SELECT
   DISTINCT column1, column2
FROM
   table_name;
```

In this syntax, the `SELECT DISTINCT` uses the combination of values in both `column1` and `column2` columns for evaluating the duplicate.

Note that PostgreSQL also offers the [DISTINCT ON](postgresql-distinct-on) clause that retains the first unique entry of a column or combination of columns in the result set.

If you want to find distinct values of all columns in a table, you can use `SELECT DISTINCT *`:

```sql
SELECT DISTINCT *
FROM table_name;
```

The star or asterisk (`*`) means all columns of the `table_name`.

## PostgreSQL SELECT DISTINCT examples

Let’s [create a new table](postgresql-create-table) to practice the `SELECT DISTINCT` clause.

Note that you will learn how to [create a table](postgresql-create-table) and [insert data into it](postgresql-insert) in the subsequent tutorial. In this tutorial, you need to execute the statement in psql or pgAdmin to execute the statements.

First, create the `colors` table that has three columns: `id`, `bcolor` and `fcolor` using the following [`CREATE TABLE`](postgresql-create-table) statement:

```
CREATE TABLE colors(
  id SERIAL PRIMARY KEY,
  bcolor VARCHAR,
  fcolor VARCHAR
);
```

Second, [insert some rows](postgresql-insert-multiple-rows) into the `colors` table:

```sql
INSERT INTO
  colors (bcolor, fcolor)
VALUES
  ('red', 'red'),
  ('red', 'red'),
  ('red', NULL),
  (NULL, 'red'),
  (NULL, NULL),
  ('green', 'green'),
  ('blue', 'blue'),
  ('blue', 'blue');
```

Third, retrieve the data from the `colors` table using the [`SELECT`](postgresql-select) statement:

```sql
SELECT
  id,
  bcolor,
  fcolor
FROM
  colors;
```

Output:

```text
 id | bcolor | fcolor
----+--------+--------
  1 | red    | red
  2 | red    | red
  3 | red    | null
  4 | null   | red
  5 | null   | null
  6 | green  | green
  7 | blue   | blue
  8 | blue   | blue
(8 rows)
```

### 1\) PostgreSQL SELECT DISTINCT one column example

The following statement selects unique values from the `bcolor` column of the `t1` table and [sorts](postgresql-order-by) the result set in alphabetical order by using the [`ORDER BY`](postgresql-order-by) clause.

```sql
SELECT
  DISTINCT bcolor
FROM
  colors
ORDER BY
  bcolor;
```

Output:

```text
 bcolor
--------
 blue
 green
 red
 null
(4 rows)
```

The `bcolor` column has 3 red values, two NULL, 1 green value, and two blue values. The `DISTINCT` removes two red values, 1 NULL, and one blue.

Note that PostgreSQL treats `NULL`s as duplicates so that it keeps one `NULL` for all `NULL`s when you apply the `SELECT DISTINCT` clause.

### 2\) SELECT DISTINCT on multiple columns

The following statement applies the `SELECT DISTINCT` clause to both `bcolor` and `fcolor` columns:

```sql
SELECT
  DISTINCT bcolor, fcolor
FROM
  colors
ORDER BY
  bcolor,
  fcolor;
```

Output:

```
 bcolor | fcolor
--------+--------
 blue   | blue
 green  | green
 red    | red
 red    | null
 null   | red
 null   | null
(6 rows)
```

In this example, the query uses the values from both `bcolor` and `fcolor` columns to evaluate the uniqueness of rows.

### 3\) Using the SELECT DISTINCT clause in practice

In practice, you often use the `SELECT DISTINCT` clause to analyze the uniqueness of values in a column.

For example, you may want to know how many rental rates for films from the `film` table:

![PostgreSQL SELECT DISTINCT - sample table](/postgresqltutorial/film.png)To achieve this, you can specify the `rental_rate` column in the `SELECT DISTINCT` clause as follows:

```
SELECT DISTINCT
  rental_rate
FROM
  film
ORDER BY
  rental_rate;
```

Output:

```plaintext
 rental_rate
-------------
        0.99
        2.99
        4.99
(3 rows)
```

The output indicates that there are only three distinct rental rates 0\.99, 2\.99, and 4\.99\.

## Summary

- Use the `SELECT DISTINCT` to remove duplicate rows from a result set of a query.


# Filtering Data

# WHERE

---
title: 'PostgreSQL WHERE'
page_title: 'PostgreSQL WHERE: Filtering Rows of a Query'
page_description: 'In this tutorial, you’ll learn how to use PostgreSQL WHERE clause to filter rows returned from the SELECT statement.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-where/'
ogImage: '/postgresqltutorial/PostgreSQL-WHERE.png'
updatedOn: '2024-01-16T10:02:38+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL SELECT DISTINCT'
  slug: 'postgresql-tutorial/postgresql-select-distinct'
nextLink:
  title: 'PostgreSQL AND Operator'
  slug: 'postgresql-tutorial/postgresql-and'
---

**Summary**: in this tutorial, you will learn how to use PostgreSQL `WHERE` clause to filter rows returned by a `SELECT` statement.

## Introduction to PostgreSQL WHERE clause

The [`SELECT`](postgresql-select) statement returns all rows from one or more columns in a table. To retrieve rows that satisfy a specified condition, you use a `WHERE` clause.

The syntax of the PostgreSQL `WHERE` clause is as follows:

```sql
SELECT
  select_list
FROM
  table_name
WHERE
  condition
ORDER BY
  sort_expression;
```

In this syntax, you place the `WHERE` clause right after the `FROM` clause of the `SELECT` statement.

The `WHERE` clause uses the `condition` to filter the rows returned from the `SELECT` clause.

The `condition` is a boolean expression that evaluates to true, false, or unknown.

The query returns only rows that satisfy the `condition` in the `WHERE` clause. In other words, the query will include only rows that cause the `condition` to evaluate to true in the result set.

PostgreSQL evaluates the `WHERE` clause after the `FROM` clause but before the `SELECT` and `ORDER BY` clause:

![](/postgresqltutorial/PostgreSQL-WHERE.png)If you use [column aliases](postgresql-column-alias) in the `SELECT` clause, you cannot use them in the `WHERE` clause.

Besides the `SELECT` statement, you can use the `WHERE` clause in the [`UPDATE`](postgresql-update) and [`DELETE`](postgresql-delete) statement to specify rows to update and delete.

To form the condition in the `WHERE` clause, you use comparison and logical operators:

| Operator                      | Description                                         |
| ----------------------------- | --------------------------------------------------- |
| \=                            | Equal                                               |
| \>                            | Greater than                                        |
| \<                            | Less than                                           |
| \>\=                          | Greater than or equal                               |
| \<\=                          | Less than or equal                                  |
| \<\> or !\=                   | Not equal                                           |
| AND                           | Logical operator AND                                |
| OR                            | Logical operator OR                                 |
| [IN](postgresql-in)           | Return true if a value matches any value in a list  |
| [BETWEEN](postgresql-between) | Return true if a value is between a range of values |
| [LIKE](postgresql-like)       | Return true if a value matches a pattern            |
| [IS NULL](postgresql-is-null) | Return true if a value is NULL                      |
| NOT                           | Negate the result of other operators                |

## PostgreSQL WHERE clause examples

Let’s practice with some examples of using the `WHERE` clause.

We will use the `customer` table from the [sample database](../postgresql-getting-started/postgresql-sample-database) for demonstration.

![customer table](/postgresqltutorial/customer.png)

### 1\)  Using WHERE clause with the equal (\=) operator example

The following statement uses the `WHERE` clause to find customers whose first name is `Jamie`:

```sql
SELECT
  last_name,
  first_name
FROM
  customer
WHERE
  first_name = 'Jamie';
```

Output:

```text
 last_name | first_name
-----------+------------
 Rice      | Jamie
 Waugh     | Jamie
(2 rows)
```

### 2\) Using the WHERE clause with the AND operator example

The following example uses a `WHERE` clause with the `AND` logical operator to find customers whose first name and last names are `Jamie` and `rice`:

```
SELECT
  last_name,
  first_name
FROM
  customer
WHERE
  first_name = 'Jamie'
  AND last_name = 'Rice';
```

Output:

```text
 last_name | first_name
-----------+------------
 Rice      | Jamie
(1 row)
```

### 3\) Using the WHERE clause with the OR operator example

The following example uses a WHERE clause with an OR operator to find the customers whose last name is `Rodriguez` or first name is `Adam`:

```
SELECT
  first_name,
  last_name
FROM
  customer
WHERE
  last_name = 'Rodriguez'
  OR first_name = 'Adam';
```

Output:

```text
 first_name | last_name
------------+-----------
 Laura      | Rodriguez
 Adam       | Gooch
(2 rows)
```

### 4\) Using the WHERE clause with the IN operator example

If you want to find a value in a list of values, you can use the [`IN`](postgresql-in) operator.

The following example uses the WHERE clause with the IN operator to find the customers with first names in the list Ann, Anne, and Annie:

```
SELECT
  first_name,
  last_name
FROM
  customer
WHERE
  first_name IN ('Ann', 'Anne', 'Annie');
```

Output:

```text
 first_name | last_name
------------+-----------
 Ann        | Evans
 Anne       | Powell
 Annie      | Russell
(3 rows)
```

### 5\) Using the WHERE clause with the LIKE operator example

To find a string that matches a specified pattern, you use the [`LIKE`](postgresql-like) operator.

The following example uses the LIKE operator in the WHERE clause to find customers whose first names start with the word `Ann`:

```
SELECT
  first_name,
  last_name
FROM
  customer
WHERE
  first_name LIKE 'Ann%';
```

Output:

```text
 first_name | last_name
------------+-----------
 Anna       | Hill
 Ann        | Evans
 Anne       | Powell
 Annie      | Russell
 Annette    | Olson
(5 rows)
```

The `%` is called a wildcard that matches any string. The `'Ann%'` pattern matches any strings that start with `'Ann'`.

### 6\) Using the WHERE clause with the BETWEEN operator example

The following example finds customers whose first names start with the letter `A` and contains 3 to 5 characters by using the [`BETWEEN`](postgresql-between) operator.

The `BETWEEN` operator returns true if a value is in a range of values.

```
SELECT
  first_name,
  LENGTH(first_name) name_length
FROM
  customer
WHERE
  first_name LIKE 'A%'
  AND LENGTH(first_name) BETWEEN 3
  AND 5
ORDER BY
  name_length;
```

Output:

```sql
first_name | name_length
------------+-------------
 Amy        |           3
 Ann        |           3
 Ana        |           3
 Andy       |           4
 Anna       |           4
 Anne       |           4
 Alma       |           4
 Adam       |           4
 Alan       |           4
 Alex       |           4
 Angel      |           5
...
```

In this example, we use the [`LENGTH()`](../postgresql-string-functions/postgresql-length-function) function to get the number of characters of an input string.

### 7\) Using the WHERE clause with the not equal operator (\<\>) example

This example finds customers whose first names start with `Bra` and last names are not `Motley`:

```
SELECT
  first_name,
  last_name
FROM
  customer
WHERE
  first_name LIKE 'Bra%'
  AND last_name <> 'Motley';
```

Output:

```
 first_name | last_name
------------+-----------
 Brandy     | Graves
 Brandon    | Huey
 Brad       | Mccurdy
(3 rows)
```

Note that you can use the `!=` operator and `<>` operator interchangeably because they are equivalent.

## Summary

- Use a `WHERE` clause in the `SELECT` statement to filter rows of a query based on one or more conditions.


# AND Operator

---
title: 'PostgreSQL AND Operator'
page_title: 'PostgreSQL AND Operator'
page_description: 'In this tutorial, you will learn about PostgreSQL AND logical operator and how to use it to combine multiple boolean expressions.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-and/'
ogImage: '/postgresqltutorial/film.png'
updatedOn: '2024-02-12T11:29:29+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL WHERE'
  slug: 'postgresql-tutorial/postgresql-where'
nextLink:
  title: 'PostgreSQL OR Operator'
  slug: 'postgresql-tutorial/postgresql-or'
---

**Summary**: in this tutorial, you will learn about the PostgreSQL `AND` logical operator and how to use it to combine multiple boolean expressions.

## Introduction to the PostgreSQL AND operator

In PostgreSQL, a [boolean](postgresql-boolean) value can have one of three values: `true`, `false`, and `null`.

PostgreSQL uses `true`, `'t'`, `'true'`, `'y'`, `'yes'`, `'1'` to represent `true` and `false`, `'f'`, `'false'`, `'n'`, `'no'`, and `'0'` to represent `false`.

A boolean expression is an expression that evaluates to a boolean value. For example, the expression `1=1` is a boolean expression that evaluates to `true`:

```phpsqlsql
SELECT 1 = 1 AS result;
```

Output:

```text
 result
--------
 t
(1 row)
```

The letter `t` in the output indicates the value of `true`.

The `AND` operator is a logical operator that combines two boolean expressions.

Here’s the basic syntax of the `AND` operator:

```sql
expression1 AND expression2
```

In this syntax, `expression1` and `expression2` are boolean expressions that evaluate to `true`, `false`, or `null`.

The `AND` operator returns `true` only if both expressions are `true`. It returns `false` if one of the expressions is `false`. Otherwise, it returns `null`.

The following table shows the results of the `AND` operator when combining `true`, `false`, and `null`.

| AND       | True  | False | Null  |
| --------- | ----- | ----- | ----- |
| **True**  | True  | False | Null  |
| **False** | False | False | False |
| **Null**  | Null  | False | Null  |

In practice, you often use the `AND` operator in a [`WHERE`](postgresql-where) clause to ensure that all specified expressions must be true for a row to be included in the result set.

## PostgreSQL AND operator

Let’s explore some examples of using the `AND` operator.

### 1\) Basic PostgreSQL AND operator examples

The following example uses the `AND` operator to combine two true values, which returns true:

```sql
SELECT true AND true AS result;
```

Output:

```text
 result
--------
 t
(1 row)
```

The following statement uses the `AND` operator to combine true with false, which returns false:

```sql
SELECT true AND false AS result;
```

Output:

```text
 result
--------
 f
(1 row)
```

The following example uses the `AND` operator to combine true with null, which returns null:

```sql
SELECT true AND null AS result;
```

Output:

```text
 result
--------
 null
(1 row)
```

The following example uses the `AND` operator to combine false with false, which returns false:

```sql
SELECT false AND false AS result;
```

Output:

```text
 result
--------
 f
(1 row)
```

The following example uses the `AND` operator to combine false with null, which returns false:

```sql
SELECT false AND null AS result;
```

Output:

```text
 result
--------
 f
(1 row)
```

The following example uses the `AND` operator to combine null with null, which returns null:

```sql
SELECT null AND null AS result;
```

Output:

```
 result
--------
 null
(1 row)
```

### 2\) Using the AND operator in the WHERE clause

We’ll use the `film` table from the [sample database](../postgresql-getting-started/postgresql-sample-database) for the demonstration:

![](/postgresqltutorial/film.png)The following example uses the `AND` operator in the `WHERE` clause to find the films that have a length greater than 180 and a rental rate less than 1:

```
SELECT
  title,
  length,
  rental_rate
FROM
  film
WHERE
  length > 180
  AND rental_rate < 1;
```

Output:

```text
       title        | length | rental_rate
--------------------+--------+-------------
 Catch Amistad      |    183 |        0.99
 Haunting Pianist   |    181 |        0.99
 Intrigue Worst     |    181 |        0.99
 Love Suicides      |    181 |        0.99
 Runaway Tenenbaums |    181 |        0.99
 Smoochy Control    |    184 |        0.99
 Sorority Queen     |    184 |        0.99
 Theory Mermaid     |    184 |        0.99
 Wild Apollo        |    181 |        0.99
 Young Language     |    183 |        0.99
(10 rows)
```

## Summary

- Use the `AND` operator to combine multiple boolean expressions.


# OR Operator

---
title: 'PostgreSQL OR Operator'
page_title: 'PostgreSQL OR Operator'
page_description: 'In this tutorial, you will learn about the PostgreSQL OR logical operator and how to use it to combine multiple boolean expressions.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-or/'
ogImage: '/postgresqltutorial/film.png'
updatedOn: '2024-02-12T11:31:51+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL AND Operator'
  slug: 'postgresql-tutorial/postgresql-and'
nextLink:
  title: 'PostgreSQL LIMIT'
  slug: 'postgresql-tutorial/postgresql-limit'
---

**Summary**: in this tutorial, you will learn about the PostgreSQL `OR` logical operator and how to use it to combine multiple boolean expressions.

## Introduction to the PostgreSQL OR operator

In PostgreSQL, a [boolean](postgresql-boolean) value can have one of three values: `true`, `false`, and `null`.

PostgreSQL uses `true`, `'t'`, `'true'`, `'y'`, `'yes'`, `'1'` to represent `true` and `false`, `'f'`, `'false'`, `'n'`, `'no'`, and `'0'` to represent `false`.

A boolean expression is an expression that evaluates to a boolean value. For example, the expression `1<>1` is a boolean expression that evaluates to `false`:

```phpsqlsql
SELECT 1 <> 1 AS result;
```

Output:

```text
 result
--------
 f
(1 row)
```

The letter `f` in the output indicates `false`.

The `OR` operator is a logical operator that combines multiple boolean expressions. Here’s the basic syntax of the `OR` operator:

```sql
expression1 OR expression2
```

In this syntax, `expression1` and `expression2` are boolean expressions that evaluate to `true`, `false`, or `null`.

The `OR` operator returns `true` only if any of the expressions is `true`. It returns `false` if both expressions are false. Otherwise, it returns null.

The following table shows the results of the `OR` operator when combining `true`, `false`, and `null`.

| OR        | True | False | Null |
| --------- | ---- | ----- | ---- |
| **True**  | True | True  | True |
| **False** | True | False | Null |
| **Null**  | True | Null  | Null |

In practice, you usually use the `OR` operator in a [`WHERE`](postgresql-where) clause to ensure that either of the specified expressions must be true for a row to be included in the result set.

## PostgreSQL OR operator

Let’s explore some examples of using the `OR` operator.

### 1\) Basic PostgreSQL OR operator examples

The following example uses the `OR` operator to combine `true` with `true`, which returns `true`:

```sql
SELECT true OR true AS result;
```

Output:

```text
 result
--------
 t
(1 row)
```

The following statement uses the `OR` operator to combine `true` with `false`, which returns true:

```sql
SELECT true OR false AS result;
```

Output:

```text
 result
--------
 t
(1 row)
```

The following example uses the `OR` operator to combine `true` with `null`, which returns `true`:

```sql
SELECT true OR null AS result;
```

Output:

```text
 result
--------
 t
(1 row)
```

The following example uses the `OR` operator to combine `false` with `false`, which returns `false`:

```sql
SELECT false OR false AS result;
```

Output:

```text
 result
--------
 f
(1 row)
```

The following example uses the `OR` operator to combine `false` with `null`, which returns `null`:

```sql
SELECT false OR null AS result;
```

Output:

```text
 result
--------
 null
(1 row)
```

The following example uses the `OR` operator to combine `null` with `null`, which returns `null`:

```sql
SELECT null OR null AS result;
```

Output:

```
 result
--------
 null
(1 row)
```

### 2\) Using the OR operator in the WHERE clause

We’ll use the `film` table from the [sample database](../postgresql-getting-started/postgresql-sample-database) for the demonstration:

![](/postgresqltutorial/film.png)The following example uses the `OR` operator in the `WHERE` clause to find the films that have a rental rate is `0.99` or `2.99`:

```
SELECT
  title,
  rental_rate
FROM
  film
WHERE
  rental_rate = 0.99 OR
  rental_rate = 2.99;
```

Output:

```text
            title            | rental_rate
-----------------------------+-------------
 Academy Dinosaur            |        0.99
 Adaptation Holes            |        2.99
 Affair Prejudice            |        2.99
 African Egg                 |        2.99
...
```

## Summary

- Use the `OR` operator to combine multiple boolean expressions.


# LIMIT

---
title: 'PostgreSQL LIMIT'
page_title: 'PostgreSQL LIMIT Clause'
page_description: 'In this tutorial, you will learn how to use PostgreSQL LIMIT clause to get a subset of rows generated by a query.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-limit/'
ogImage: '/postgresqltutorial/film_table.png'
updatedOn: '2024-04-19T07:40:00+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL OR Operator'
  slug: 'postgresql-tutorial/postgresql-or'
nextLink:
  title: 'PostgreSQL FETCH'
  slug: 'postgresql-tutorial/postgresql-fetch'
---

**Summary**: in this tutorial, you will learn how to use the **PostgreSQL LIMIT** clause to get a subset of rows generated by a query.

## Introduction to PostgreSQL LIMIT clause

PostgreSQL `LIMIT` is an optional clause of the [`SELECT`](postgresql-select) statement that constrains the number of rows returned by the query.

Here’s the basic syntax of the `LIMIT` clause:

```sql
SELECT
  select_list
FROM
  table_name
ORDER BY
  sort_expression
LIMIT
  row_count;
```

The statement returns `row_count` rows generated by the query. If the `row_count` is zero, the query returns an empty set. If the `row_count` is `NULL`, the query returns the same result set as it does not have the `LIMIT` clause.

If you want to skip a number of rows before returning the `row_count` rows, you can use `OFFSET` clause placed after the `LIMIT` clause:

```sql
SELECT
  select_list
FROM
  table_name
ORDER BY
  sort_expression
LIMIT
  row_count
OFFSET
  row_to_skip;
```

The statement first skips `row_to_skip` rows before returning `row_count` rows generated by the query.

If the `row_to_skip` is zero, the statement will work like it doesn’t have the `OFFSET` clause.

It’s important to note that PostgreSQL evaluates the `OFFSET` clause before the `LIMIT` clause.

PostgreSQL stores rows in a table in an unspecified order, therefore, when you use the `LIMIT` clause, you should always use the [`ORDER BY`](postgresql-order-by) clause to control the row order.

If you don’t use the `ORDER BY` clause, you may get a result set with the rows in an unspecified order.

## PostgreSQL LIMIT clause examples

Let’s take some examples of using the PostgreSQL `LIMIT` clause. We will use the `film` table in the [sample database](../postgresql-getting-started/postgresql-sample-database) for the demonstration.

![PostgreSQL LIMIT - Sample Table](/postgresqltutorial/film_table.png)

### 1\) Using PostgreSQL LIMIT to constrain the number of returned rows

The following statement uses the `LIMIT` clause to get the first five films sorted by `film_id`:

```sql
SELECT
  film_id,
  title,
  release_year
FROM
  film
ORDER BY
  film_id
LIMIT
  5;
```

Output:

```text
 film_id |      title       | release_year
---------+------------------+--------------
       1 | Academy Dinosaur |         2006
       2 | Ace Goldfinger   |         2006
       3 | Adaptation Holes |         2006
       4 | Affair Prejudice |         2006
       5 | African Egg      |         2006
(5 rows)
```

How it works.

- First, sort films by the `film_id` ascending order using the `ORDER BY film_id` clause.
- Second, take 5 films from the top using the `LIMIT 5` clause.

### 2\) Using the LIMIT clause with the OFFSET clause example

To retrieve 4 films starting from the fourth one ordered by `film_id`, you can use both `LIMIT` and `OFFSET` clauses as follows:

```
SELECT
  film_id,
  title,
  release_year
FROM
  film
ORDER BY
  film_id
LIMIT 4 OFFSET 3;
```

Output:

```text
 film_id |      title       | release_year
---------+------------------+--------------
       4 | Affair Prejudice |         2006
       5 | African Egg      |         2006
       6 | Agent Truman     |         2006
       7 | Airplane Sierra  |         2006
(4 rows)
```

How it works.

- First, sort films by film id in ascending order.
- Second, skip the first three rows using the `OFFSET 3` clause.
- Second, take the next four rows using the `LIMIT 4` clause.

### 3\) Using LIMIT OFFSET to get top/bottom N rows

Typically, you often use the `LIMIT` clause to select rows with the highest or lowest values from a table.

The following example uses the `LIMIT` clause to retrieve the top 10 most expensive films by rental rate:

```
SELECT
  film_id,
  title,
  rental_rate
FROM
  film
ORDER BY
  rental_rate DESC
LIMIT
  10;
```

Output:

```
 film_id |        title        | rental_rate
---------+---------------------+-------------
      13 | Ali Forever         |        4.99
      20 | Amelie Hellfighters |        4.99
       7 | Airplane Sierra     |        4.99
      10 | Aladdin Calendar    |        4.99
       2 | Ace Goldfinger      |        4.99
       8 | Airport Pollock     |        4.99
      98 | Bright Encounters   |        4.99
     133 | Chamber Italian     |        4.99
     384 | Grosse Wonderful    |        4.99
      21 | American Circus     |        4.99
(10 rows)
```

How it works.

- First, sort all the films by rental rates from high to low using the `ORDER BY rental_rate` clause.
- Second, take only 10 rows from the top using the `LIMIT 10` clause.

## Summary

- Use the PostgreSQL `LIMIT OFFSET` clause to retrieve a subset of rows returned by a query.


# FETCH

---
title: 'PostgreSQL FETCH'
page_title: 'PostgreSQL FETCH NEXT n ROWS ONLY OFFSET m ROWS'
page_description: 'Use the PostgreSQL FETCH clause to skip a certain number of rows and retrieve a specific number of rows from a query.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-fetch/'
ogImage: '/postgresqltutorial/film_table.png'
updatedOn: '2024-01-17T04:54:54+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL LIMIT'
  slug: 'postgresql-tutorial/postgresql-limit'
nextLink:
  title: 'PostgreSQL IN'
  slug: 'postgresql-tutorial/postgresql-in'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `FETCH` clause to retrieve a portion of rows returned by a query.

## Introduction to PostgreSQL FETCH clause

To skip a certain number of rows and retrieve a specific number of rows, you often use the [`LIMIT`](postgresql-limit) clause in the `SELECT` statement.

The `LIMIT` clause is widely used by many Relational Database Management Systems such as MySQL, H2, and HSQLDB. However, the `LIMIT` clause is not a SQL standard.

To conform with the SQL standard, PostgreSQL supports the `FETCH` clause to skip a certain number of rows and then fetch a specific number of rows.

Note that the `FETCH` clause was introduced as a part of the SQL standard in SQL:2008\.

The following illustrates the syntax of the PostgreSQL `FETCH` clause:

```sql
OFFSET row_to_skip { ROW | ROWS }
FETCH { FIRST | NEXT } [ row_count ] { ROW | ROWS } ONLY
```

In this syntax:

First, specify the number of rows to skip (`row_to_skip`) after the `OFFSET` keyword. The start is an integer that is zero or positive. It defaults to 0, meaning the query will skip no rows.

If the `row_to_skip` is higher than the number of rows in the table, the query will return no rows.

Second, provide the number of rows to retrieve (`row_count`) in the `FETCH` clause. The `row_count` must be an integer 1 or greater. The `row_count` defaults to 1\.

The `ROW` is the synonym for `ROWS`, `FIRST` is the synonym for `NEXT` so you can use them interchangeably.

Because the table stores the rows in an unspecified order, you should always use the `FETCH` clause with the [`ORDER BY`](postgresql-order-by) clause to make the order of rows consistent.

Note that the `OFFSET` clause must come before the `FETCH` clause in SQL:2008\. However, `OFFSET` and `FETCH` clauses can appear in any order in PostgreSQL.

### FETCH vs. LIMIT

The `FETCH` clause is functionally equivalent to the `LIMIT` clause. If you plan to make your application compatible with other database systems, you should use the `FETCH` clause because it follows the standard SQL.

## PostgreSQL FETCH examples

Let’s use the `film` table in the [sample database](../postgresql-getting-started/postgresql-sample-database) for the demonstration.

![Film Table](/postgresqltutorial/film_table.png)The following query uses the `FETCH` clause to select the first film sorted by titles in ascending order:

```sql
SELECT
    film_id,
    title
FROM
    film
ORDER BY
    title
FETCH FIRST ROW ONLY;
```

Output:

```text
 film_id |      title
---------+------------------
       1 | Academy Dinosaur
(1 row)
```

It is equivalent to the following query:

```
SELECT
    film_id,
    title
FROM
    film
ORDER BY
    title
FETCH FIRST 1 ROW ONLY;
```

The following query uses the `FETCH` clause to select the first five films sorted by titles:

```sql
SELECT
    film_id,
    title
FROM
    film
ORDER BY
    title
FETCH FIRST 5 ROW ONLY;
```

Output:

```text
 film_id |      title
---------+------------------
       1 | Academy Dinosaur
       2 | Ace Goldfinger
       3 | Adaptation Holes
       4 | Affair Prejudice
       5 | African Egg
(5 rows)
```

The following statement returns the next five films after the first five films sorted by titles:

```
SELECT
    film_id,
    title
FROM
    film
ORDER BY
    title
OFFSET 5 ROWS
FETCH FIRST 5 ROW ONLY;
```

Output:

```
 film_id |      title
---------+------------------
       6 | Agent Truman
       7 | Airplane Sierra
       8 | Airport Pollock
       9 | Alabama Devil
      10 | Aladdin Calendar
(5 rows)
```

## Summary

- Use the PostgreSQL `FETCH` clause to skip a certain number of rows and retrieve a specific number of rows from a query.


# IN

---
title: 'PostgreSQL IN'
page_title: 'PostgreSQL IN - Matching Against a List of Values'
page_description: 'This tutorial shows you how to use the PostgreSQL IN operator to match against a list of values. It also shows you how to use the IN operator in a subquery.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-in/'
ogImage: '/postgresqltutorial/film.png'
updatedOn: '2024-01-17T02:52:11+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL FETCH'
  slug: 'postgresql-tutorial/postgresql-fetch'
nextLink:
  title: 'PostgreSQL BETWEEN'
  slug: 'postgresql-tutorial/postgresql-between'
---

**Summary**: in this tutorial, you will learn how to use the **PostgreSQL IN** operator to check if a value matches any value in a list.

## Introduction to PostgreSQL IN operator

The `IN` operator allows you to check whether a value matches any value in a list of values.

Here’s the basic syntax of the `IN` operator:

```phpsqlsql
value IN (value1,value2,...)
```

The `IN` operator returns true if the `value` is equal to any value in the list such as `value1` and `value2`.

The list of values can be a list of literal values including numbers and strings.

In addition to literal values, the `IN` operator also accepts a list of values returned from a query. You’ll learn more about how to use the `IN` operator with a query in the [subquery tutorial](postgresql-subquery).

Functionally, the `IN` operator is equivalent to combining multiple boolean expressions with the [OR](postgresql-or) operators:

```sql
value = value1 OR value = value2 OR ...
```

## PostgreSQL IN operator examples

We’ll use the `film` table from the [sample database](../postgresql-getting-started/postgresql-sample-database):

![](/postgresqltutorial/film.png)

### 1\) Using the PostgreSQL IN operator with a list of numbers

The following example uses the `IN` operator to retrieve information about the film with id 1, 2, and 3:

```
SELECT
  film_id,
  title
FROM
  film
WHERE
  film_id in (1, 2, 3);
```

Output:

```text
 film_id |      title
---------+------------------
       1 | Academy Dinosaur
       2 | Ace Goldfinger
       3 | Adaptation Holes
(3 rows)
```

The following statement uses the equal (`=`) and `OR` operators instead of the `IN` operator, which is equivalent to the query above:

```
SELECT
  film_id,
  title
FROM
  film
WHERE
  film_id = 1
  OR film_id = 2
  OR film_id = 3;
```

The query that uses the `IN` operator is shorter and more readable than the query that uses equal (`=`) and `OR` operators.

Additionally, PostgreSQL executes the query with the `IN` operator much faster than the same query that uses a list of `OR` operators.

### 2\) Using the PostgreSQL IN operator with a list of strings

We’ll use the `actor` table from the [sample database](../postgresql-getting-started/postgresql-sample-database):

![](/postgresqltutorial/actor.png)
The following example uses the `IN` operator to find the actors who have the last name in the list `'Allen'`, `'Chase'`, and `'Davis'`:

```sql
SELECT
  first_name,
  last_name
FROM
  actor
WHERE
  last_name IN ('Allen', 'Chase', 'Davis')
ORDER BY
  last_name;
```

Output:

```
 first_name | last_name
------------+-----------
 Meryl      | Allen
 Cuba       | Allen
 Kim        | Allen
 Jon        | Chase
 Ed         | Chase
 Susan      | Davis
 Jennifer   | Davis
 Susan      | Davis
(8 rows)

```

### 3\) Using the PostgreSQL IN operator with a list of dates

The following statement uses the IN operator to find payments whose payment dates are in a list of dates: `2007-02-15` and `2007-02-16`:

```
SELECT
  payment_id,
  amount,
  payment_date
FROM
  payment
WHERE
  payment_date::date IN ('2007-02-15', '2007-02-16');
```

Output:

```css
payment_id | amount |        payment_date
------------+--------+----------------------------
      17503 |   7.99 | 2007-02-15 22:25:46.996577
      17504 |   1.99 | 2007-02-16 17:23:14.996577
      17505 |   7.99 | 2007-02-16 22:41:45.996577
      17512 |   4.99 | 2007-02-16 00:10:50.996577
...
```

In this example, the `payment_date` column has the type [`timestamp`](postgresql-timestamp) that consists of both date and time parts.

To match the values in the `payment_date` column with a list of dates, you need to cast them to date values that have the date part only.

To do that you use the `::` [cast operator](postgresql-cast):

```
payment_date::date
```

For example, if the timestamp value is `2007-02-15 22:25:46.996577`, the cast operator will convert it to `2007-02-15`.

## PostgreSQL NOT IN operator

To negate the `IN` operator, you use the `NOT IN` operator. Here’s the basic syntax of the `NOT IN` operator:

```xml
value NOT IN (value1, value2, ...)
```

The `NOT IN` operator returns `true` if the `value` is not equal to any value in the list such as `value1` and `value2`; otherwise, the `NOT IN` operator returns `false`.

The `NOT IN` operator is equivalent to a combination of multiple boolean expressions with the [AND operators](postgresql-and):

```sql
value <> value1 AND value <> value2 AND ...
```

### PostgreSQL NOT IN operator example

The following example uses the `NOT IN` operator to retrieve films whose id is not 1, 2, or 3:

```
SELECT
  film_id,
  title
FROM
  film
WHERE
  film_id NOT IN (1, 2, 3)
ORDER BY
  film_id;
```

Output:

```text
 film_id |            title
---------+-----------------------------
       4 | Affair Prejudice
       5 | African Egg
       6 | Agent Truman
       7 | Airplane Sierra
       8 | Airport Pollock
...
```

The following query retrieves the same set of data but uses the not\-equal (`<>`) and [`AND`](postgresql-and) operators:

```
SELECT
  film_id,
  title
FROM
  film
WHERE
  film_id <> 1
  AND film_id <> 2
  AND film_id <> 3
ORDER BY
  film_id;
```

## Summary

- Use the `IN` operator to check if a value matches any value in a list of values.
- Use the `NOT` operator to negate the `IN` operator.


# BETWEEN

---
title: 'PostgreSQL BETWEEN'
page_title: 'PostgreSQL BETWEEN'
page_description: 'This tutorial shows you how to use the PostgreSQL BETWEEN operator to check if a value is in a range of values.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-between/'
ogImage: '/postgresqltutorial/payment-table.png'
updatedOn: '2024-04-19T07:33:19+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL IN'
  slug: 'postgresql-tutorial/postgresql-in'
nextLink:
  title: 'PostgreSQL LIKE'
  slug: 'postgresql-tutorial/postgresql-like'
---

**Summary**: in this tutorial, you will learn how to use the **PostgreSQL BETWEEN** operator to check if a value falls in a particular range of values.

## Introduction to the PostgreSQL BETWEEN operator

The `BETWEEN` operator allows you to check if a value falls within a range of values.

The basic syntax of the `BETWEEN` operator is as follows:

```sql
value BETWEEN low AND high;
```

If the `value` is greater than or equal to the `low` value and less than or equal to the `high` value, the `BETWEEN` operator returns `true`; otherwise, it returns `false`.

You can rewrite the `BETWEEN` operator by using the greater than or equal ( `>=`) and less than or equal to ( `<=`) operators and the [logical AND operator](postgresql-and):

```sql
value >= low AND value <= high
```

If you want to check if a value is outside a specific range, you can use the `NOT BETWEEN` operator as follows:

```sql
value NOT BETWEEN low AND high
```

The following expression is equivalent to the expression that uses the `NOT BETWEEN` operators:

```sql
value < low OR value > high
```

In practice, you often use the `BETWEEN`operator in the [WHERE](postgresql-where 'PostgreSQL WHERE') clause of the [SELECT](postgresql-select 'PostgreSQL SELECT'), [INSERT](postgresql-insert), [UPDATE,](postgresql-update) and [DELETE](postgresql-delete) statements.

## PostgreSQL BETWEEN operator examples

Let’s take a look at the `payment`table in the [sample database](../postgresql-getting-started/postgresql-sample-database 'PostgreSQL Sample Database').

![payment table](/postgresqltutorial/payment-table.png)

### 1\) Using the PostgreSQL BETWEEN operator with numbers

The following query uses the `BETWEEN` operator to retrieve payments with `payment_id` is between `17503` and `17505`:

```sql
SELECT
  payment_id,
  amount
FROM
  payment
WHERE
  payment_id BETWEEN 17503 AND 17505
ORDER BY
  payment_id;
```

Output:

```text
 payment_id | amount
------------+--------
      17503 |   7.99
      17504 |   1.99
      17505 |   7.99
(3 rows)

```

### 2\) Using the PostgreSQL NOT BETWEEN example

The following example uses the `NOT BETWEEN` operator to find payments with the `payment_id` not between `17503` and `17505`:

```
SELECT
  payment_id,
  amount
FROM
  payment
WHERE
  payment_id NOT BETWEEN 17503 AND 17505
ORDER BY
  payment_id;
```

Output:

```sql
payment_id | amount
------------+--------
      17506 |   2.99
      17507 |   7.99
      17508 |   5.99
      17509 |   5.99
      17510 |   5.99
...
```

### 3\) Using the PostgreSQL BETWEEN with a date range

If you want to check a value against a date range, you use the literal date in ISO 8601 format, which is `YYYY-MM-DD`.

The following example uses the `BETWEEN` operator to find payments whose payment dates are between `2007-02-15` and `2007-02-20` and amount more than 10:

```
SELECT
  payment_id,
  amount,
  payment_date
FROM
  payment
WHERE
  payment_date BETWEEN '2007-02-15' AND '2007-02-20'
  AND amount > 10
ORDER BY
  payment_date;
```

Output:

```
 customer_id | payment_id | amount |        payment_date
-------------+------------+--------+----------------------------
          33 |      18640 |  10.99 | 2007-02-15 08:14:59.996577
         544 |      18272 |  10.99 | 2007-02-15 16:59:12.996577
         516 |      18175 |  10.99 | 2007-02-16 13:20:28.996577
         572 |      18367 |  10.99 | 2007-02-17 02:33:38.996577
         260 |      19481 |  10.99 | 2007-02-17 16:37:30.996577
         477 |      18035 |  10.99 | 2007-02-18 07:01:49.996577
         221 |      19336 |  10.99 | 2007-02-19 09:18:28.996577
(7 rows)
```

## Summary

- Use the `BETWEEN` operator to check if a value falls within a particular range.
- Use the `NOT BETWEEN` operator to negate the `BETWEEN` operator.


# LIKE

---
title: 'PostgreSQL LIKE'
page_title: 'PostgreSQL LIKE Operator'
page_description: 'This tutorial shows you how to use the PostgreSQL LIKE and ILIKE operators to query data based on patterns.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-like/'
ogImage: '/postgresqltutorial/customer.png'
updatedOn: '2024-01-21T02:25:04+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL BETWEEN'
  slug: 'postgresql-tutorial/postgresql-between'
nextLink:
  title: 'PostgreSQL IS NULL'
  slug: 'postgresql-tutorial/postgresql-is-null'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `LIKE` operators to query data based on patterns.

## Introduction to PostgreSQL LIKE operator

Suppose that you want to find customers, but you don’t remember their names exactly. However, you can recall that their names begin with something like `Jen`.

How do you locate the exact customers from the database? You can identify customers in the  `customer` table by examining the first name column to see if any values begin with `Jen`. However, this process can be time\-consuming, especially when the `customer` table has a large number of rows.

Fortunately, you can use the PostgreSQL `LIKE` operator to match the first names of customers with a string using the following query:

```sqlsql
SELECT
  first_name,
  last_name
FROM
  customer
WHERE
  first_name LIKE 'Jen%';
```

Output:

```text
 first_name | last_name
------------+-----------
 Jennifer   | Davis
 Jennie     | Terry
 Jenny      | Castro
(3 rows)
```

The `WHERE` clause in the query contains an expression:

```
first_name LIKE 'Jen%'
```

The expression consists of the `first_name`, the `LIKE` operator and a literal string that contains a percent sign (`%`). The string `'Jen%'` is called a pattern.

The query returns rows whose values in the `first_name` column begin with `Jen` and are followed by any sequence of characters. This technique is called pattern matching.

You construct a pattern by combining literal values with wildcard characters and using the `LIKE` or `NOT LIKE` operator to find the matches.

PostgreSQL offers two wildcards:

- Percent sign (`%`) matches any sequence of zero or more characters.
- Underscore sign (`_`)  matches any single character.

Here’s the basic syntax of the `LIKE` operator:

```sql
value LIKE pattern
```

The `LIKE` operator returns `true` if the `value` matches the `pattern`. To negate the `LIKE` operator, you use the `NOT` operator as follows:

```sql
value NOT LIKE pattern
```

The `NOT LIKE` operator returns `true` when the `value` does not match the `pattern`.

If the pattern does not contain any wildcard character, the `LIKE` operator behaves like the equal (`=`) operator.

## PostgreSQL LIKE operator examples

Let’s take some examples of using the `LIKE` operator

### 1\) Basic LIKE operator examples

The following statement uses the `LIKE` operator with a pattern that doesn’t have any wildcard characters:

```sql
SELECT 'Apple' LIKE 'Apple' AS result;
```

Output:

```text
 result
--------
 t
(1 row)
```

In this example, the `LIKE` operator behaves like the equal to (`=`) operator. The query returns `true` because ‘`Apple' = 'Apple'` is `true`.

The following example uses the `LIKE` operator to match any string that starts with the letter `A`:

```
SELECT 'Apple' LIKE 'A%' AS result;
```

Output:

```text
 result
--------
 t
(1 row)
```

The query returns true because the string `'Apple'` starts with the letter `'A'`.

### 2\) Using the LIKE operator with table data

We’ll use the `customer` table from the [sample database](../postgresql-getting-started/postgresql-sample-database):

![customer table - PostgreSQL LIKE and ILIKE examples](/postgresqltutorial/customer.png)The following example uses the `LIKE` operator to find customers whose first names contain the string `er` :

```
SELECT
  first_name,
  last_name
FROM
  customer
WHERE
  first_name LIKE '%er%'
ORDER BY
  first_name;
```

Output:

```sql
first_name  |  last_name
-------------+-------------
 Albert      | Crouse
 Alberto     | Henning
 Alexander   | Fennell
 Amber       | Dixon
 Bernard     | Colby
...
```

### 3\) Using the LIKE operator a pattern that contains both wildcards

The following example uses the `LIKE` operator with a pattern that contains both the percent (`%`) and underscore (`_`) wildcards:

```
SELECT
  first_name,
  last_name
FROM
  customer
WHERE
  first_name LIKE '_her%'
ORDER BY
  first_name;
```

Output:

```text
 first_name | last_name
------------+-----------
 Cheryl     | Murphy
 Sherri     | Rhodes
 Sherry     | Marshall
 Theresa    | Watson
(4 rows)
```

The pattern `_her%` matches any strings that satisfy the following conditions:

- The first character can be anything.
- The following characters must be `'her'`.
- There can be any number (including zero) of characters after `'her'`.

### 4\) PostgreSQL NOT LIKE examples

The following query uses the `NOT LIKE` operator to find customers whose first names do not begin with `Jen`:

```
SELECT
  first_name,
  last_name
FROM
  customer
WHERE
  first_name NOT LIKE 'Jen%'
ORDER BY
  first_name;
```

Output:

```text
 first_name  |  last_name
-------------+--------------
 Aaron       | Selby
 Adam        | Gooch
 Adrian      | Clary
 Agnes       | Bishop
...
```

## PostgreSQL extensions of the LIKE operator

PostgreSQL `ILIKE` operator, which is similar to the `LIKE` operator, but allows for **case\-insensitive matching**. For example:

```
SELECT
  first_name,
  last_name
FROM
  customer
WHERE
  first_name ILIKE 'BAR%';
```

Output:

```text
 first_name | last_name
------------+-----------
 Barbara    | Jones
 Barry      | Lovelace
(2 rows)
```

In this example, the `BAR%` pattern matches any string that begins with `BAR`, `Bar`, `BaR`, and so on. If you use the `LIKE` operator instead, the query will return no row:

```
SELECT
  first_name,
  last_name
FROM
  customer
WHERE
  first_name LIKE 'BAR%';
```

Output:

```text
 first_name | last_name
------------+-----------
(0 rows)
```

PostgreSQL also provides some operators that mirror the functionality of `LIKE`, `NOT LIKE`, `ILIKE`, `NOT ILIKE`, as shown in the following table:

| Operator | Equivalent |
| -------- | ---------- |
| \~\~     | LIKE       |
| \~\~\*   | ILIKE      |
| !\~\~    | NOT LIKE   |
| !\~\~\*  | NOT ILIKE  |

For example, the following statement uses the `~~` operator to find a customer whose first names start with the string `Dar`:

```
SELECT
  first_name,
  last_name
FROM
  customer
WHERE
  first_name ~~ 'Dar%'
ORDER BY
  first_name;
```

Output:

```text
 first_name | last_name
------------+-----------
 Darlene    | Rose
 Darrell    | Power
 Darren     | Windham
 Darryl     | Ashcraft
 Daryl      | Larue
(5 rows)
```

## PostgreSQL LIKE operator with ESCAPE option

Sometimes, the data, that you want to match, contains the wildcard characters `%` and `_`. For example:

```
The rents are now 10% higher than last month
The new film will have _ in the title
```

To instruct the `LIKE` operator to treat the wildcard characters `%` and `_` as regular literal characters, you can use the `ESCAPE` option in the `LIKE` operator:

```sql
string LIKE pattern ESCAPE escape_character;
```

Let’s [create a simple table](postgresql-create-table) for demonstration:

```sql
CREATE TABLE t(
   message text
);

INSERT INTO t(message)
VALUES('The rents are now 10% higher than last month'),
      ('The new film will have _ in the title');

SELECT message FROM t;
```

Note that you’ll learn how to [create a table](postgresql-create-table) and [insert data into it](postgresql-insert-multiple-rows) in the upcoming tutorials.

Output:

```text
                   message
----------------------------------------------
 The rents are now 10% higher than last month
 The new film will have _ in the title
(2 rows)
```

The following statement uses the `LIKE` operator with the `ESCAPE` option to treat the `%` followed by the number `10` as a regular character:

```
SELECT * FROM t
WHERE message LIKE '%10$%%' ESCAPE '$';
```

Output:

```
                   message
----------------------------------------------
 The rents are now 10% higher than last month
(1 row)
```

In the pattern `%10$%%`, the first and last `%` are the wildcard characters whereas the `%` appears after the escape character `$` is a regular character.

## Summary

- Use the `LIKE` operator to match data by patterns.
- Use the `NOT LIKE` operator to negate the `LIKE` operator.
- Use the `%` wildcard to match zero or more characters.
- Use the `_` wildcard to match a single character.
- Use the `ESCAPE` option to specify the escape character.
- Use the `ILIKE` operator to match data case\-insensitively.


# IS NULL

---
title: 'PostgreSQL IS NULL'
page_title: 'PostgreSQL IS NULL'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL IS NULL operator to check if a value is NULL or not.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-is-null/'
ogImage: '/postgresqltutorial/address.png'
updatedOn: '2024-05-14T13:59:22+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL LIKE'
  slug: 'postgresql-tutorial/postgresql-like'
nextLink:
  title: 'PostgreSQL Joins'
  slug: 'postgresql-tutorial/postgresql-joins'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `IS NULL` operator to check if a value is NULL or not.

## Introduction to NULL

In the database world, NULL means missing information or not applicable. NULL is not a value, therefore, you cannot compare it with other values like numbers or strings.

The comparison of NULL with a value will always result in NULL. Additionally, NULL is not equal to NULL so the following expression returns NULL:

```phpsqlsql
SELECT null = null AS result;
```

Output:

```text
 result
--------
 null
(1 row)
```

## IS NULL operator

To check if a value is NULL or not, you cannot use the equal to (`=`) or not equal to (`<>`) operators. Instead, you use the `IS NULL` operator.

Here’s the basic syntax of the `IS NULL` operator:

```sql
value IS NULL
```

The `IS NULL` operator returns true if the `value` is NULL or false otherwise.

To negate the `IS NULL` operator, you use the `IS NOT NULL` operator:

```php
value IS NOT NULL
```

The `IS NOT NULL` operator returns true if the value is not NULL or false otherwise.

To learn how to deal with NULL in sorting, check out the [ORDER BY tutorial](postgresql-order-by).

PostgreSQL offers some useful functions to handle NULL effectively such as [NULLIF](postgresql-nullif), [ISNULL](postgresql-isnull), and [COALESCE](postgresql-coalesce).

To ensure that a column does not contain NULL, you use the [NOT NULL constraint](postgresql-not-null-constraint).

## PostgreSQL IS NULL operator examples

We’ll use the `address` table from the [sample database](../postgresql-getting-started/postgresql-sample-database):

![address table](/postgresqltutorial/address.png)
Please note that the `psql` program displays `NULL` as an empty string by default. To change how `psql` shows NULL in the terminal, you can use the command: `\pset null null`. It will display NULL as null.

### 1\) Basic IS NULL operator example

The following example uses the `IS NULL` operator to find the addresses from the `address` table that the `address2` column contains `NULL`:

```php
SELECT
  address,
  address2
FROM
  address
WHERE
  address2 IS NULL;
```

Output:

```
       address        | address2
----------------------+----------
 47 MySakila Drive    | null
 28 MySQL Boulevard   | null
 23 Workhaven Lane    | null
 1411 Lillydale Drive | null
(4 rows)
```

### 2\) Using the IS NOT NULL operator example

The following example uses the `IS NOT NULL` operator to retrieve the address that has the `address2` not NULL:

```
SELECT
  address,
  address2
FROM
  address
WHERE
  address2 IS NOT NULL;
```

Output:

```
                address                 | address2
----------------------------------------+----------
 1913 Hanoi Way                         |
 1121 Loja Avenue                       |
 692 Joliet Street                      |
 1566 Inegl Manor                       |
```

Notice that the `address2` is empty, not NULL. This is a good example of **bad practice** when it comes to storing empty strings and NULL in the same column.

To fix it, you can use the `UPDATE` statement to change the empty strings to NULL in the `address2` column, which you will learn in the [UPDATE tutorial](postgresql-update).

## Summary

- In databases, NULL means missing information or not applicable.
- The `IS NULL` operator returns true if a value is NULL or false otherwise.
- Use the `IS NOT NULL` operator returns true if a value is not NULL or false otherwise.


# Join Tables

# Joins

---
title: 'PostgreSQL Joins'
page_title: 'PostgreSQL Joins: A Visual Explanation of PostgreSQL Joins'
page_description: 'You will learn visually how to use various kinds of PostgreSQL joins including inner join, left join, right join, and outer join.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-joins/'
ogImage: '/postgresqltutorial/PostgreSQL-Join-Inner-Join.png'
updatedOn: '2024-01-17T05:01:10+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL IS NULL'
  slug: 'postgresql-tutorial/postgresql-is-null'
nextLink:
  title: 'PostgreSQL Table Aliases'
  slug: 'postgresql-tutorial/postgresql-alias'
---

**Summary**: in this tutorial, you will learn about various kinds of PostgreSQL joins including inner join, left join, right join, and full outer join.

PostgreSQL join is used to combine columns from one ([self\-join](postgresql-self-join)) or more tables based on the values of the common columns between related tables. The common columns are typically the [primary key](postgresql-primary-key) columns of the first table and the [foreign key](postgresql-foreign-key) columns of the second table.

PostgreSQL supports [inner join](postgresql-inner-join), [left join](postgresql-left-join), [right join](postgresql-right-join), [full outer join](postgresql-full-outer-join), [cross join](postgresql-cross-join), [natural join](postgresql-natural-join), and a special kind of join called [self\-join](postgresql-self-join).

## Setting up sample tables

Suppose you have two tables called `basket_a` and `basket_b` that store fruits:

```sqlsql
CREATE TABLE basket_a (
    a INT PRIMARY KEY,
    fruit_a VARCHAR (100) NOT NULL
);

CREATE TABLE basket_b (
    b INT PRIMARY KEY,
    fruit_b VARCHAR (100) NOT NULL
);

INSERT INTO basket_a (a, fruit_a)
VALUES
    (1, 'Apple'),
    (2, 'Orange'),
    (3, 'Banana'),
    (4, 'Cucumber');

INSERT INTO basket_b (b, fruit_b)
VALUES
    (1, 'Orange'),
    (2, 'Apple'),
    (3, 'Watermelon'),
    (4, 'Pear');
```

The tables have some common fruits such as `apple` and `orange`.

The following statement returns data from the `basket_a` table:

```sql
SELECT * FROM basket_a;
```

Output:

```text
 a | fruit_a
---+----------
 1 | Apple
 2 | Orange
 3 | Banana
 4 | Cucumber
(4 rows)
```

The following statement returns data from the `basket_b` table:

```sql
SELECT * FROM basket_b;
```

Output:

```
 b |  fruit_b
---+------------
 1 | Orange
 2 | Apple
 3 | Watermelon
 4 | Pear
(4 rows)
```

## PostgreSQL inner join

The following statement joins the first table (`basket_a`) with the second table (`basket_b`) by matching the values in the `fruit_a` and `fruit_b` columns:

```
SELECT
    a,
    fruit_a,
    b,
    fruit_b
FROM
    basket_a
INNER JOIN basket_b
    ON fruit_a = fruit_b;
```

Output:

```text
 a | fruit_a | b | fruit_b
---+---------+---+---------
 1 | Apple   | 2 | Apple
 2 | Orange  | 1 | Orange
(2 rows)
```

The inner join examines each row in the first table (`basket_a`). It compares the value in the `fruit_a` column with the value in the `fruit_b` column of each row in the second table (`basket_b`). If these values are equal, the inner join creates a new row that contains columns from both tables and adds this new row to the result set.

The following Venn diagram illustrates the inner join:

![PostgreSQL Join - Inner Join](/postgresqltutorial/PostgreSQL-Join-Inner-Join.png)

## PostgreSQL left join

The following statement uses the left join clause to join the `basket_a` table with the `basket_b` table. In the left join context, the first table is called the left table and the second table is called the right table.

```
SELECT
    a,
    fruit_a,
    b,
    fruit_b
FROM
    basket_a
LEFT JOIN basket_b
   ON fruit_a = fruit_b;
```

Output:

```text
 a | fruit_a  |  b   | fruit_b
---+----------+------+---------
 1 | Apple    |    2 | Apple
 2 | Orange   |    1 | Orange
 3 | Banana   | null | null
 4 | Cucumber | null | null
(4 rows)
```

The left join starts selecting data from the left table. It compares values in the fruit_a column with the values in the fruit_b column in the basket_b table.

If these values are equal, the left join creates a new row that contains columns of both tables and adds this new row to the result set. (see the row \#1 and \#2 in the result set).

In case the values do not equal, the left join also creates a new row that contains columns from both tables and adds it to the result set. However, it fills the columns of the right table (`basket_b`) with null. (see the row \#3 and \#4 in the result set).

The following Venn diagram illustrates the left join:

![PostgreSQL Join - Left Join](/postgresqltutorial/PostgreSQL-Join-Left-Join.png)
To select rows from the left table that do not have matching rows in the right table, you use the left join with a [`WHERE`](postgresql-where) clause. For example:

```sql
SELECT
    a,
    fruit_a,
    b,
    fruit_b
FROM
    basket_a
LEFT JOIN basket_b
    ON fruit_a = fruit_b
WHERE b IS NULL;
```

The output is:

```text
 a | fruit_a  |  b   | fruit_b
---+----------+------+---------
 3 | Banana   | null | null
 4 | Cucumber | null | null
(2 rows)

```

Note that the `LEFT JOIN` is the same as the `LEFT OUTER JOIN` so you can use them interchangeably.

The following Venn diagram illustrates the left join that returns rows from the left table that do not have matching rows from the right table:

![PostgreSQL Join - Left Join with Where](/postgresqltutorial/PostgreSQL-Join-Left-Join-with-Where.png)

## PostgreSQL right join

The [right join](postgresql-right-join) is a reversed version of the left join. The right join starts selecting data from the right table. It compares each value in the fruit_b column of every row in the right table with each value in the fruit_a column of every row in the fruit_a table.

If these values are equal, the right join creates a new row that contains columns from both tables.

In case these values are not equal, the right join also creates a new row that contains columns from both tables. However, it fills the columns in the left table with NULL.

The following statement uses the right join to join the `basket_a` table with the `basket_b` table:

```sql
SELECT
    a,
    fruit_a,
    b,
    fruit_b
FROM
    basket_a
RIGHT JOIN basket_b ON fruit_a = fruit_b;
```

Here is the output:

```text
  a   | fruit_a | b |  fruit_b
------+---------+---+------------
    2 | Orange  | 1 | Orange
    1 | Apple   | 2 | Apple
 null | null    | 3 | Watermelon
 null | null    | 4 | Pear
(4 rows)
```

The following Venn diagram illustrates the right join:

![PostgreSQL Join - Right Join](/postgresqltutorial/PostgreSQL-Join-Right-Join.png)
Similarly, you can get rows from the right table that do not have matching rows from the left table by adding a `WHERE` clause as follows:

```sql
SELECT
    a,
    fruit_a,
    b,
    fruit_b
FROM
    basket_a
RIGHT JOIN basket_b
   ON fruit_a = fruit_b
WHERE a IS NULL;
```

Output:

```text
  a   | fruit_a | b |  fruit_b
------+---------+---+------------
 null | null    | 3 | Watermelon
 null | null    | 4 | Pear
(2 rows)
```

The `RIGHT JOIN` and `RIGHT OUTER JOIN` are the same therefore you can use them interchangeably.

The following Venn diagram illustrates the right join that returns rows from the right table that do not have matching rows in the left table:

![PostgreSQL Join - Right Join with Where](/postgresqltutorial/PostgreSQL-Join-Right-Join-with-Where.png)

## PostgreSQL full outer join

The [full outer join](postgresql-full-outer-join) or full join returns a result set that contains all rows from both left and right tables, with the matching rows from both sides if available. In case there is no match, the columns of the table will be filled with NULL.

```sql
SELECT
    a,
    fruit_a,
    b,
    fruit_b
FROM
    basket_a
FULL OUTER JOIN basket_b
    ON fruit_a = fruit_b;
```

Output:

```text
  a   | fruit_a  |  b   |  fruit_b
------+----------+------+------------
    1 | Apple    |    2 | Apple
    2 | Orange   |    1 | Orange
    3 | Banana   | null | null
    4 | Cucumber | null | null
 null | null     |    3 | Watermelon
 null | null     |    4 | Pear
(6 rows)

```

The following Venn diagram illustrates the full outer join:

![PostgreSQL Join - Full Outer Join](/postgresqltutorial/PostgreSQL-Join-Full-Outer-Join.png)
To return rows in a table that do not have matching rows in the other, you use the full join with a `WHERE` clause like this:

```sql
SELECT
    a,
    fruit_a,
    b,
    fruit_b
FROM
    basket_a
FULL JOIN basket_b
   ON fruit_a = fruit_b
WHERE a IS NULL OR b IS NULL;
```

Here is the result:

```
  a   | fruit_a  |  b   |  fruit_b
------+----------+------+------------
    3 | Banana   | null | null
    4 | Cucumber | null | null
 null | null     |    3 | Watermelon
 null | null     |    4 | Pear
(4 rows)
```

The following Venn diagram illustrates the full outer join that returns rows from a table that do not have the corresponding rows in the other table:

![PostgreSQL Join - Full Outer Join with Where](/postgresqltutorial/PostgreSQL-Join-Full-Outer-Join-with-Where.png)
The following picture shows all the PostgreSQL joins that we discussed so far with the detailed syntax:

![PostgreSQL Joins](/postgresqltutorial/PostgreSQL-Joins.png)
In this tutorial, you have learned how to use various kinds of PostgreSQL joins to combine data from multiple related tables.


# Table Aliases

---
title: 'PostgreSQL Table Aliases'
page_title: 'PostgreSQL Table Aliases'
page_description: 'This tutorial shows you how to use a table alias to assign a temporary name to a table during the query execution.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-alias/'
ogImage: ''
updatedOn: '2024-01-17T06:08:13+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Joins'
  slug: 'postgresql-tutorial/postgresql-joins'
nextLink:
  title: 'PostgreSQL INNER JOIN'
  slug: 'postgresql-tutorial/postgresql-inner-join'
---

**Summary**: in this tutorial, you will learn about the PostgreSQL table aliases and their practical applications.

## Introduction to the PostgreSQL table aliases

A table alias is a feature in SQL that allows you to assign a temporary name to a table during the execution of a query.

The following illustrates the syntax of defining a table alias:

```csssql
table_name AS alias_name
```

In this syntax:

- `table_name`: Specify the name of the table that you want to give an alias.
- `alias_name`: Provide the alias for the table.

Like [column aliases](postgresql-column-alias), the `AS` keyword is optional, meaning that you can omit it like this:

```sql
table_name alias_name
```

## PostgreSQL table alias examples

Let’s take some examples of using table aliases.

### 1\) Basic PostgreSQL table alias example

The following example uses a table alias to retrieve five titles from the `film` table:

```
SELECT f.title
FROM film AS f
ORDER BY f.title
LIMIT 5;
```

Output:

```text
      title
------------------
 Academy Dinosaur
 Ace Goldfinger
 Adaptation Holes
 Affair Prejudice
 African Egg
(5 rows)
```

In this example, we assign the `film` table an alias `f` and use the table alias to fully qualify the `title` column.

Since the `AS` keyword is optional, you can remove it as follows:

```
SELECT f.title
FROM film f
ORDER BY f.title
LIMIT 5;
```

### 2\) Using table aliases in join clauses

Typically, you use table aliases in a query that has a [join](postgresql-joins) clause to retrieve data from multiple related tables that share the same column name.

If you use the same column name that comes from multiple tables in the same query without fully qualifying them, you will get an error.

To avoid this error, you can qualify the columns using the following syntax:

```sql
table_name.column_name
```

If the table has an alias, you can qualify its column using the alias:

```css
alias.column_name
```

For example, the following query uses an [`INNER JOIN`](postgresql-inner-join) clause to retrieve data from the `customer` and `payment` tables:

```
SELECT
  c.customer_id,
  c.first_name,
  p.amount,
  p.payment_date
FROM
  customer c
  INNER JOIN payment p ON p.customer_id = c.customer_id
ORDER BY
  p.payment_date DESC;
```

Output:

```text
 customer_id | first_name  | amount |        payment_date
-------------+-------------+--------+----------------------------
          94 | Norma       |   4.99 | 2007-05-14 13:44:29.996577
         264 | Gwendolyn   |   2.99 | 2007-05-14 13:44:29.996577
         263 | Hilda       |   0.99 | 2007-05-14 13:44:29.996577
         252 | Mattie      |   4.99 | 2007-05-14 13:44:29.996577
```

Note that you’ll learn about [INNER JOIN](postgresql-inner-join) in the upcoming tutorial.

### 3\) Using table aliases in self\-join

When you join a table to itself (a.k.a [self\-join](postgresql-self-join)), you need to use table aliases. This is because referencing the same table multiple times within a query will result in an error.

The following example shows how to reference the `film` table twice in the same query using the table aliases:

```
SELECT
    f1.title,
    f2.title,
    f1.length
FROM
    film f1
INNER JOIN film f2
    ON f1.film_id <> f2.film_id AND
       f1.length = f2.length;
```

Output:

```
            title            |            title            | length
-----------------------------+-----------------------------+--------
 Chamber Italian             | Resurrection Silverado      |    117
 Chamber Italian             | Magic Mallrats              |    117
 Chamber Italian             | Graffiti Love               |    117
 Chamber Italian             | Affair Prejudice            |    117
 Grosse Wonderful            | Hurricane Affair            |     49
 Grosse Wonderful            | Hook Chariots               |     49
 Grosse Wonderful            | Heavenly Gun                |     49
 Grosse Wonderful            | Doors President             |     49
...
```

Note that you’ll learn about [self\-join](postgresql-inner-join) in the upcoming tutorial.

## Summary

- Use PostgreSQL table aliases to assign a temporary name to a table during the execution of a query.


# INNER JOIN

---
title: 'PostgreSQL INNER JOIN'
page_title: 'PostgreSQL INNER JOIN'
page_description: 'This tutorial shows you how to select data from multiple tables by using PostgreSQL INNER JOIN clause.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-inner-join/'
ogImage: '/postgresqltutorial/PostgreSQL-Join-Inner-Join.png'
updatedOn: '2024-01-17T15:32:06+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Table Aliases'
  slug: 'postgresql-tutorial/postgresql-alias'
nextLink:
  title: 'PostgreSQL LEFT JOIN'
  slug: 'postgresql-tutorial/postgresql-left-join'
---

**Summary**: in this tutorial, you will learn how to select data from multiple tables using the **PostgreSQL INNER JOIN** clause.

## Introduction to PostgreSQL INNER JOIN clause

In a relational database, data is typically distributed across multiple tables. To retrieve comprehensive data, you often need to query it from multiple tables.

In this tutorial, we are focusing on how to retrieve data from multiple tables using the `INNER JOIN` clause.

Here is the generic syntax for the `INNER JOIN` clause that joins two tables:

```sql
SELECT
  select_list
FROM
  table1
INNER JOIN table2
  ON table1.column_name = table2.column_name;
```

In this syntax:

- First, specify the columns from both tables in the select list of the `SELECT` clause.
- Second, specify the main table (`table1`) from which you want to select data in the `FROM` clause.
- Third, specify the second table (`table2`) you want to join using the `INNER JOIN` keyword.
- Finally, define a condition for the join. This condition indicates which column (`column_name`) in each table should have matching values for the join.

To make the query shorter, you can use [table aliases](postgresql-alias):

```sql
SELECT
  select_list
FROM
  table1 t1
INNER JOIN table2 t2
    ON t1.column_name = t2.column_name;
```

In this syntax, we first assign `t1` and `t2` as the table aliases for `table1` and `table2`. Then, we use the table aliases to qualify the columns of each table.

If the columns for matching share the same name, you can use the `USING` syntax:

```sql
SELECT
  select_list
FROM
  table1 t1
INNER JOIN table2 t2 USING(column_name);
```

### How the INNER JOIN works

For each row in the `table1`, the inner join compares the value in the `column_name` with the value in the corresponding column of every row in the `table2`.

When these values are equal, the inner join creates a new row that includes all columns from both tables and adds this row to the result set.

Conversely, if these values are not equal, the inner join disregards the current pair and proceeds to the next row, repeating the matching process.

The following Venn diagram illustrates how `INNER JOIN` clause works.

![PostgreSQL Join - Inner Join](/postgresqltutorial/PostgreSQL-Join-Inner-Join.png)

## PostgreSQL INNER JOIN examples

Let’s take some examples of using the `INNER JOIN` clause.

### 1\) Using PostgreSQL INNER JOIN to join two tables

Let’s take a look at the `customer`and `payment` tables in the [sample database](../postgresql-getting-started/postgresql-sample-database 'PostgreSQL Sample Database').

![customer and payment tables](/postgresqltutorial/customer-and-payment-tables.png)
In this schema, whenever a customer makes a payment, a new row is inserted into the `payment` table. While each customer may have zero or many payments, each payment belongs to one and only one customer. The `customer_id` column serves as the link establishing the relationship between the two tables.

The following statement uses the `INNER JOIN` clause to select data from both tables:

```sql
SELECT
  customer.customer_id,
  customer.first_name,
  customer.last_name,
  payment.amount,
  payment.payment_date
FROM
  customer
  INNER JOIN payment ON payment.customer_id = customer.customer_id
ORDER BY
  payment.payment_date;
```

Output:

```text
 customer_id | first_name  |  last_name   | amount |        payment_date
-------------+-------------+--------------+--------+----------------------------
         416 | Jeffery     | Pinson       |   2.99 | 2007-02-14 21:21:59.996577
         516 | Elmer       | Noe          |   4.99 | 2007-02-14 21:23:39.996577
         239 | Minnie      | Romero       |   4.99 | 2007-02-14 21:29:00.996577
         592 | Terrance    | Roush        |   6.99 | 2007-02-14 21:41:12.996577
          49 | Joyce       | Edwards      |   0.99 | 2007-02-14 21:44:52.996577
...
```

To make the query shorter, you can use the table aliases:

```
SELECT
  c.customer_id,
  c.first_name,
  c.last_name,
  p.amount,
  p.payment_date
FROM
  customer c
  INNER JOIN payment p ON p.customer_id = c.customer_id
ORDER BY
  p.payment_date;
```

Since both tables have the same `customer_id` column, you can use the `USING` syntax:

```sql
SELECT
  customer_id,
  first_name,
  last_name,
  amount,
  payment_date
FROM
  customer
  INNER JOIN payment USING(customer_id)
ORDER BY
  payment_date;
```

### 2\) Using PostgreSQL INNER JOIN to join three tables

The following diagram below illustrates the relationship between three tables: `staff`, `payment`, and `customer`:

![customer, payment and staff tables](/postgresqltutorial/customer-payment-staff-tables.png)
Each staff member can handle zero or multiple payments, with each payment being processed by one and only one staff member.

Similarly, each customer can make zero or multiple payments, and each payment is associated with a single customer.

The following example uses `INNER JOIN` clauses to retrieve data from three tables

```sql
SELECT
  c.customer_id,
  c.first_name || ' ' || c.last_name customer_name,
  s.first_name || ' ' || s.last_name staff_name,
  p.amount,
  p.payment_date
FROM
  customer c
  INNER JOIN payment p USING (customer_id)
  INNER JOIN staff s using(staff_id)
ORDER BY
  payment_date;
```

Output:

```
 customer_id |     customer_name     |  staff_name  | amount |        payment_date
-------------+-----------------------+--------------+--------+----------------------------
         416 | Jeffery Pinson        | Jon Stephens |   2.99 | 2007-02-14 21:21:59.996577
         516 | Elmer Noe             | Jon Stephens |   4.99 | 2007-02-14 21:23:39.996577
         239 | Minnie Romero         | Mike Hillyer |   4.99 | 2007-02-14 21:29:00.996577
         592 | Terrance Roush        | Jon Stephens |   6.99 | 2007-02-14 21:41:12.996577
          49 | Joyce Edwards         | Mike Hillyer |   0.99 | 2007-02-14 21:44:52.996577
...
```

## Summary

- Use `INNER JOIN` clauses to select data from two or more related tables and return rows that have matching values in all tables.


# LEFT JOIN

---
title: 'PostgreSQL LEFT JOIN'
page_title: 'PostgreSQL LEFT JOIN'
page_description: 'This tutorial shows you how to use PostgreSQL LEFT JOIN clause to select rows from one table that may or may not have corresponding rows in another table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-left-join/'
ogImage: '/postgresqltutorial/PostgreSQL-Join-Left-Join.png'
updatedOn: '2024-02-07T02:59:26+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL INNER JOIN'
  slug: 'postgresql-tutorial/postgresql-inner-join'
nextLink:
  title: 'PostgreSQL RIGHT JOIN'
  slug: 'postgresql-tutorial/postgresql-right-join'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `LEFT JOIN` clause to select data from multiple tables.

## Introduction to PostgreSQL LEFT JOIN clause

The `LEFT JOIN` clause [joins](postgresql-joins) a left table with the right table and returns the rows from the left table that may or may not have corresponding rows in the right table.

The `LEFT JOIN` can be useful for selecting rows from one table that do not have matching rows in another.

Here’s the basic syntax of the `LEFT JOIN` clause:

```sqlsql
SELECT
  select_list
FROM
  table1
LEFT JOIN table2
  ON table1.column_name = table2.column_name;
```

In this syntax:

- First, specify the columns from both tables in the select list (`select_list`) of the `SELECT` clause.
- Second, specify the left table (`table1`) from which you want to select data in the `FROM` clause.
- Third, specify the right table (`table2`) you want to join using the `LEFT JOIN` keyword.
- Finally, define a condition for the join (`table1.column_name = table2.column_name`), which indicates the column (`column_name`) in each table should have matching values.

### How the LEFT JOIN works

The `LEFT JOIN` clause starts selecting data from the left table (`table1`). For each row in the left table, it compares the value in the `column_name` with the value of the corresponding column from every row in the right table.

When these values are equal, the left join clause generates a new row including the columns that appear in the `select_list` and appends it to the result set.

If these values are not equal, the `LEFT JOIN` clause creates a new row that includes the columns specified in the `SELECT` clause. Additionally, it populates the columns that come from the right table with NULL.

Note that `LEFT JOIN` is also referred to as `LEFT OUTER JOIN`.

If the columns for joining two tables have the same name, you can use the `USING` syntax:

```sql
SELECT
  select_list
FROM
  table1
  LEFT JOIN table2 USING (column_name);
```

The following Venn diagram illustrates how the `LEFT JOIN` clause works:

![PostgreSQL Join - Left Join](/postgresqltutorial/PostgreSQL-Join-Left-Join.png)

## PostgreSQL LEFT JOIN examples

Let’s look at the following `film` and `inventory` tables from the [sample database](../postgresql-getting-started/postgresql-sample-database).

![Film and Inventory tables](/postgresqltutorial/film-and-inventory-tables.png)
Each row in the `film` table may correspond to zero or multiple rows in the `inventory` table.

Conversely, each row in the `inventory` table has one and only one row in the `film` table.

The linkage between the `film` and `inventory` tables is established through the `film_id` column.

### 1\) Basic PostgreSQL LEFT JOIN examples

The following statement uses the `LEFT JOIN` clause to join `film` table with the `inventory` table:

```sql
SELECT
  film.film_id,
  film.title,
  inventory.inventory_id
FROM
  film
  LEFT JOIN inventory ON inventory.film_id = film.film_id
ORDER BY
  film.title;
```

![PostgreSQL LEFT JOIN example](/postgresqltutorial/PostgreSQL-LEFT-JOIN-join-two-tables-example.png)
When a row from the `film` table does not have a matching row in the `inventory` table, the value of the `inventory_id` column of this row is `NULL`.

The following statement uses table aliases and `LEFT JOIN` clause to join the `film` and `inventory` tables:

```sql
SELECT
  f.film_id,
  f.title,
  i.inventory_id
FROM
  film f
  LEFT JOIN inventory i ON i.film_id = f.film_id
ORDER BY
  i.inventory_id;
```

Because the `film` and `inventory` tables share the same `film_id` column, you can use the `USING` syntax:

```sql
SELECT
  f.film_id,
  f.title,
  i.inventory_id
FROM
  film f
  LEFT JOIN inventory i USING (film_id)
ORDER BY
  i.inventory_id;
```

### 2\) Using PostgreSQL LEFT JOIN with WHERE clause

The following uses the `LEFT JOIN` clause to join the `inventory` and `film` tables. It includes a [`WHERE`](postgresql-where) clause that identifies the films that are not present in the inventory:

```sql
SELECT
  f.film_id,
  f.title,
  i.inventory_id
FROM
  film f
  LEFT JOIN inventory i USING (film_id)
WHERE
  i.film_id IS NULL
ORDER BY
  f.title;
```

Output:

```
 film_id |         title          | inventory_id
---------+------------------------+--------------
      14 | Alice Fantasia         |         null
      33 | Apollo Teen            |         null
      36 | Argonauts Town         |         null
      38 | Ark Ridgemont          |         null
      41 | Arsenic Independence   |         null
...
```

## Summary

- Use the PostgreSQL `LEFT JOIN` clause to select rows from one table that may or may not have corresponding rows in other tables.


# RIGHT JOIN

---
title: 'PostgreSQL RIGHT JOIN'
page_title: 'PostgreSQL RIGHT JOIN'
page_description: 'You will how to use PostgreSQL RIGHT JOIN to join two tables and return rows from the right table that may or may not have matching rows in the left table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-right-join/'
ogImage: '/postgresqltutorial/PostgreSQL-Join-Right-Join.png'
updatedOn: '2024-01-18T03:45:01+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL LEFT JOIN'
  slug: 'postgresql-tutorial/postgresql-left-join'
nextLink:
  title: 'PostgreSQL Self-Join'
  slug: 'postgresql-tutorial/postgresql-self-join'
---

**Summary**: in this tutorial, you will how to use PostgreSQL `RIGHT JOIN` to join two tables and return rows from the right table that may or may not have matching rows in the left table.

## Introduction to PostgreSQL RIGHT JOIN clause

The `RIGHT JOIN` clause joins a right table with a left table and returns the rows from the right table that may or may not have matching rows in the left table.

The `RIGHT JOIN` can be useful when you want to find rows in the right table that do not have matching rows in the left table.

Here’s the basic syntax of the `RIGHT JOIN` clause:

```sqlsql
SELECT
  select_list
FROM
  table1
RIGHT JOIN table2
  ON table1.column_name = table2.column_name;
```

In this syntax:

- First, specify the columns from both tables in the `select_list` in the `SELECT` clause.
- Second, provide the left table (`table1`) from which you want to select data in the `FROM` clause.
- Third, specify the right table (`table2`) that you want to join with the left table in the `RIGHT JOIN` clause.
- Finally, define a condition for joining two tables (`table1.column_name = table2.column_name`), which indicates the `column_name` in each table should have matching rows.

### How the RIGHT JOIN works

The `RIGHT JOIN` starts retrieving data from the right table (`table2`).

For each row in the right table (`table2`), the `RIGHT JOIN` checks if the value in the `column_name` is equal to the value of the corresponding column in every row of the left table (`table1`).

When these values are equal, the `RIGHT JOIN` creates a new row that includes columns specified in the `select_list` and appends it to the result set.

If these values are not equal, the `RIGHT JOIN` generates a new row that includes columns specified in the `select_list`, populates the columns on the left with `NULL`, and appends the new row to the result set.

In other words, the `RIGHT JOIN` returns all rows from the right table whether or not they have corresponding rows in the left table.

The following Venn diagram illustrates how the `RIGHT JOIN` works:

![PostgreSQL Join - Right Join](/postgresqltutorial/PostgreSQL-Join-Right-Join.png)Note that the `RIGHT OUTER JOIN` is the same as `RIGHT JOIN`. The `OUTER` keyword is optional

### The USING syntax

When the columns for joining have the same name, you can use the `USING` syntax:

```sql
SELECT
  select_list
FROM
  table1
RIGHT JOIN table2 USING (column_name);
```

## PostgreSQL RIGHT JOIN examples

We’ll use the `film` and `inventory` tables from the [sample database](../postgresql-getting-started/postgresql-sample-database).

### 1\) Basic PostgreSQL RIGHT JOIN examples

The following example uses the `RIGHT JOIN` clause to retrieve all rows from the film table that may or may not have corresponding rows in the inventory table:

```sql
SELECT
  film.film_id,
  film.title,
  inventory.inventory_id
FROM
  inventory
RIGHT JOIN film
  ON film.film_id = inventory.film_id
ORDER BY
  film.title;
```

Output:

![PostgreSQL RIGHT JOIN example](/postgresqltutorial/PostgreSQL-RIGHT-JOIN-example.png)
You can rewrite the above query using table aliases:

```
SELECT
  f.film_id,
  f.title,
  i.inventory_id
FROM
  inventory i
RIGHT JOIN film f
  ON f.film_id = i.film_id
ORDER BY
  f.title;
```

Since the film and inventory table has the film_id column, you can use the USING syntax:

```sql
SELECT
  f.film_id,
  f.title,
  i.inventory_id
FROM
  inventory i
RIGHT JOIN film f USING(film_id)
ORDER BY
  f.title;
```

### 2\) PostgreSQL RIGHT JOIN with a WHERE clause

The following query uses a `RIGHT JOIN` clause with a `WHERE` clause to retrieve the films that have no inventory:

```sql
SELECT
  f.film_id,
  f.title,
  i.inventory_id
FROM
  inventory i
RIGHT JOIN film f USING(film_id)
WHERE i.inventory_id IS NULL
ORDER BY
  f.title;
```

Output:

```
 film_id |         title          | inventory_id
---------+------------------------+--------------
      14 | Alice Fantasia         |         null
      33 | Apollo Teen            |         null
      36 | Argonauts Town         |         null
      38 | Ark Ridgemont          |         null
      41 | Arsenic Independence   |         null
...
```

## Summary

- Use the PostgreSQL `RIGHT JOIN` clause to join a right table with a left table and return rows from the right table that may or may not have corresponding rows in the left table.
- The `RIGHT JOIN` is also known as `RIGHT OUTER JOIN`.


# SELF-JOIN

---
title: 'PostgreSQL Self-Join'
page_title: 'PostgreSQL Self-join By Practical Examples'
page_description: 'This tutorial shows you how to use the PostgreSQL self-join technique to join a table to itself.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-self-join/'
ogImage: '/postgresqltutorial/PostgreSQL-Self-Join-Reporting-Structure.png'
updatedOn: '2024-01-18T03:56:12+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL RIGHT JOIN'
  slug: 'postgresql-tutorial/postgresql-right-join'
nextLink:
  title: 'PostgreSQL FULL OUTER JOIN'
  slug: 'postgresql-tutorial/postgresql-full-outer-join'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL self\-join technique to compare rows within the same table.

## Introduction to PostgreSQL self\-join

A self\-join is a regular join that joins a table to itself. In practice, you typically use a self\-join to query hierarchical data or to compare rows within the same table.

To form a self\-join, you specify the same table twice with [different table aliases](postgresql-alias) and provide the join predicate after the `ON` keyword.

The following query uses an [`INNER JOIN`](postgresql-inner-join) that joins the table to itself:

```sqlsql
SELECT select_list
FROM table_name t1
INNER JOIN table_name t2 ON join_predicate;
```

In this syntax, the `table_name` is joined to itself using the [`INNER JOIN`](postgresql-inner-join) clause.

Alternatively, you can use the [`LEFT JOIN`](postgresql-left-join) or `RIGHT JOIN` clause to join the table to itself like this:

```sql
SELECT select_list
FROM table_name t1
LEFT JOIN table_name t2 ON join_predicate;
```

## PostgreSQL self\-join examples

Let’s take some examples of using self\-joins.

### 1\) Querying hierarchical data example

Let’s set up a sample table for the demonstration.

Suppose, you have the following organizational structure:

![PostgreSQL Self Join - Reporting Structure](/postgresqltutorial/PostgreSQL-Self-Join-Reporting-Structure.png)The following statements create the `employee` table and insert some sample data into the table.

```sql
CREATE TABLE employee (
  employee_id INT PRIMARY KEY,
  first_name VARCHAR (255) NOT NULL,
  last_name VARCHAR (255) NOT NULL,
  manager_id INT,
  FOREIGN KEY (manager_id) REFERENCES employee (employee_id) ON DELETE CASCADE
);
INSERT INTO employee (employee_id, first_name, last_name, manager_id)
VALUES
  (1, 'Windy', 'Hays', NULL),
  (2, 'Ava', 'Christensen', 1),
  (3, 'Hassan', 'Conner', 1),
  (4, 'Anna', 'Reeves', 2),
  (5, 'Sau', 'Norman', 2),
  (6, 'Kelsie', 'Hays', 3),
  (7, 'Tory', 'Goff', 3),
  (8, 'Salley', 'Lester', 3);

SELECT * FROM employee;
```

Output:

```text
 employee_id | first_name |  last_name  | manager_id
-------------+------------+-------------+------------
           1 | Windy      | Hays        |       null
           2 | Ava        | Christensen |          1
           3 | Hassan     | Conner      |          1
           4 | Anna       | Reeves      |          2
           5 | Sau        | Norman      |          2
           6 | Kelsie     | Hays        |          3
           7 | Tory       | Goff        |          3
           8 | Salley     | Lester      |          3
(8 rows)
```

In this `employee` table, the `manager_id` column references the `employee_id` column.

The `manager_id` column indicates the direct relationship, showing the manager to whom the employee reports.

If the `manager_id` column contains NULL, which signifies that the respective employee does not report to anyone, essentially holding the top managerial position.

The following query uses the self\-join to find who reports to whom:

```sql
SELECT
  e.first_name || ' ' || e.last_name employee,
  m.first_name || ' ' || m.last_name manager
FROM
  employee e
  INNER JOIN employee m ON m.employee_id = e.manager_id
ORDER BY
  manager;
```

Output:

```text
    employee     |     manager
-----------------+-----------------
 Sau Norman      | Ava Christensen
 Anna Reeves     | Ava Christensen
 Salley Lester   | Hassan Conner
 Kelsie Hays     | Hassan Conner
 Tory Goff       | Hassan Conner
 Ava Christensen | Windy Hays
 Hassan Conner   | Windy Hays
(7 rows)
```

This query references the `employees` table twice, one as the employee and the other as the manager. It uses table aliases `e` for the employee and `m` for the manager.

The join predicate finds the employee/manager pair by matching values in the `employee_id` and `manager_id` columns.

Notice that the top manager does not appear on the output.

To include the top manager in the result set, you use the [`LEFT JOIN`](postgresql-left-join) instead of [`INNER JOIN`](postgresql-inner-join) clause as shown in the following query:

```
SELECT
  e.first_name || ' ' || e.last_name employee,
  m.first_name || ' ' || m.last_name manager
FROM
  employee e
  LEFT JOIN employee m ON m.employee_id = e.manager_id
ORDER BY
  manager;
```

Output:

```text
    employee     |     manager
-----------------+-----------------
 Anna Reeves     | Ava Christensen
 Sau Norman      | Ava Christensen
 Salley Lester   | Hassan Conner
 Kelsie Hays     | Hassan Conner
 Tory Goff       | Hassan Conner
 Hassan Conner   | Windy Hays
 Ava Christensen | Windy Hays
 Windy Hays      | null
(8 rows)
```

### 2\) Comparing the rows with the same table

See the following `film` table from the DVD rental database:

![Film Table](/postgresqltutorial/film_table.png)
The following query finds all pairs of films that have the same length,

```sql
SELECT
  f1.title,
  f2.title,
  f1.length
FROM
  film f1
  INNER JOIN film f2 ON f1.film_id > f2.film_id
  AND f1.length = f2.length;
```

Output:

```
           title           |            title            | length
---------------------------+-----------------------------+--------
 Chamber Italian           | Affair Prejudice            |    117
 Grosse Wonderful          | Doors President             |     49
 Bright Encounters         | Bedazzled Married           |     73
 Date Speed                | Crow Grease                 |    104
 Annie Identity            | Academy Dinosaur            |     86
 Anything Savannah         | Alone Trip                  |     82
 Apache Divine             | Anaconda Confessions        |     92
 Arabia Dogma              | Airplane Sierra             |     62
 Dying Maker               | Antitrust Tomatoes          |    168
...
```

The join predicate matches two different films (`f1.film_id > f2.film_id`) that have the same length (`f1.length = f2.length`)

## Summary

- A PostgreSQL self\-join is a regular join that joins a table to itself using the `INNER JOIN` or `LEFT JOIN`.
- Self\-joins are very useful for querying hierarchical data or comparing rows within the same table.


# FULL OUTER JOIN

---
title: 'PostgreSQL FULL OUTER JOIN'
page_title: 'PostgreSQL FULL OUTER JOIN'
page_description: 'This tutorial shows you how to use the PostgreSQL FULL OUTER JOIN to join two tables.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-full-outer-join/'
ogImage: '/postgresqltutorial/PostgreSQL-Join-Full-Outer-Join.png'
updatedOn: '2024-01-18T05:31:07+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Self-Join'
  slug: 'postgresql-tutorial/postgresql-self-join'
nextLink:
  title: 'PostgreSQL Cross Join'
  slug: 'postgresql-tutorial/postgresql-cross-join'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `FULL OUTER JOIN` to query data from two tables.

## Introduction to the PostgreSQL FULL OUTER JOIN clause

The `FULL OUTER JOIN` combine data from two tables and returns all rows from both tables, including matching and non\-matching rows from both sides.

In other words, the `FULL OUTER JOIN` combines the results of both the [left join](postgresql-left-join) and the [right join](postgresql-right-join).

Here’s the basic syntax of `FULL OUTER JOIN` clause:

```sqlsql
SELECT select_list
FROM table1
FULL OUTER JOIN table2
   ON table1.column_name = table2.column_name;
```

In this syntax:

- First, specify the columns from `table1` and `table2` in the `select_list`.
- Second, specify the `table1` that you want to retrieve data in the `FROM` clause.
- Third, specify the `table2` that you want to join with the `table1` in the `FULL OUTER JOIN` clause.
- Finally, define a condition for joining two tables.

The `FULL OUTER JOIN` is also known as `FULL JOIN`. The `OUTER` keyword is optional.

### How the FULL OUTER JOIN works

**Step 1\. Initialize the result set:**

- The `FULL OUTER JOIN` starts with an empty result set.

**Step 2\. Match rows:**

- First, identify rows in `table1` and `table2` where the values in the specified `column_name` match.
- Then, include these matching rows in the result set.

**Step 3\. Include non\-matching rows from the `table1` and `table2`:**

- First, include rows from `table1` that do not have a match in `table2`. For the columns from `table2` in these rows, include NULLs.
- Second, include rows from `table2` that do not have a match in `table1`. For the columns from `table1` in these rows, include NULLs.

**Step 4\. Return the result set:**

- Return the final result set will contain all rows from both tables, with matching rows and non\-matching rows from both `table1` and `table2`.
- If a row has a match on both sides, combine the values into a single row.
- If there is no match on one side, the columns from the non\-matching side will have NULLs.

The following Venn diagram illustrates the `FULL OUTER JOIN` operation:

![PostgreSQL Join - Full Outer Join](/postgresqltutorial/PostgreSQL-Join-Full-Outer-Join.png)

## Setting up sample tables

First, [create two new tables](postgresql-create-table) for the demonstration: `employees` and `departments`:

```sql
CREATE TABLE departments (
  department_id serial PRIMARY KEY,
  department_name VARCHAR (255) NOT NULL
);
CREATE TABLE employees (
  employee_id serial PRIMARY KEY,
  employee_name VARCHAR (255),
  department_id INTEGER
);
```

Each department has zero or many employees and each employee belongs to zero or one department.

Second, insert some sample data into the `departments` and `employees` tables.

```sql
INSERT INTO departments (department_name)
VALUES
  ('Sales'),
  ('Marketing'),
  ('HR'),
  ('IT'),
  ('Production');
INSERT INTO employees (employee_name, department_id)
VALUES
  ('Bette Nicholson', 1),
  ('Christian Gable', 1),
  ('Joe Swank', 2),
  ('Fred Costner', 3),
  ('Sandra Kilmer', 4),
  ('Julia Mcqueen', NULL);

```

Third, query data from the `departments` and `employees` tables:

```sql
SELECT * FROM departments;
```

Output:

```text
 department_id | department_name
---------------+-----------------
             1 | Sales
             2 | Marketing
             3 | HR
             4 | IT
             5 | Production
(5 rows)
```

```
SELECT * FROM employees;
```

Output:

```text
 employee_id |  employee_name  | department_id
-------------+-----------------+---------------
           1 | Bette Nicholson |             1
           2 | Christian Gable |             1
           3 | Joe Swank       |             2
           4 | Fred Costner    |             3
           5 | Sandra Kilmer   |             4
           6 | Julia Mcqueen   |          null
(6 rows)
```

## PostgreSQL FULL OUTER JOIN examples

Let’s take some examples of using the `FULL OUTER JOIN` clause.

### 1\) Basic FULL OUTER JOIN examaple

The following query uses the `FULL OUTER JOIN` to query data from both `employees` and `departments` tables:

```sql
SELECT
  employee_name,
  department_name
FROM
  employees e
FULL OUTER JOIN departments d
  ON d.department_id = e.department_id;
```

Output:

```text
  employee_name  | department_name
-----------------+-----------------
 Bette Nicholson | Sales
 Christian Gable | Sales
 Joe Swank       | Marketing
 Fred Costner    | HR
 Sandra Kilmer   | IT
 Julia Mcqueen   | null
 null            | Production
(7 rows)
```

The result set includes every employee who belongs to a department and every department which have an employee.

Additionally, it includes every employee who does not belong to a department and every department that does not have an employee.

### 2\) Using FULL OUTER JOIN with WHERE clause example

The following example use the `FULL OUTER JOIN` with a [WHERE](postgresql-where) clause to find the department that does not have any employees:

```sql
SELECT
  employee_name,
  department_name
FROM
  employees e
FULL OUTER JOIN departments d
  ON d.department_id = e.department_id
WHERE
  employee_name IS NULL;

```

Output:

```text
 employee_name | department_name
---------------+-----------------
 null          | Production
(1 row)
```

The result shows that the `Production` department does not have any employees.

The following example use the `FULL OUTER JOIN` cluase with a `WHERE` clause to find employees who do not belong to any department:

```sql
SELECT
  employee_name,
  department_name
FROM
  employees e
FULL OUTER JOIN departments d
  ON d.department_id = e.department_id
WHERE
  department_name IS NULL;
```

Output:

```
 employee_name | department_name
---------------+-----------------
 Julia Mcqueen | null
(1 row)
```

The output shows that `Juila Mcqueen` does not belong to any department.

## Summary

- Use the PostgreSQL `FULL OUTER JOIN` clause to combine data from both tables, ensuring that matching rows are included from both the left and right tables, as well as unmatched rows from either table.


# Cross Join

---
title: 'PostgreSQL Cross Join'
page_title: 'PostgreSQL CROSS JOIN'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL CROSS JOIN to produce the cartesian product of rows from the joined tables.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-cross-join/'
ogImage: '/postgresqltutorial/PostgreSQL-CROSS-JOIN-illustration.png'
updatedOn: '2024-04-08T04:05:33+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL FULL OUTER JOIN'
  slug: 'postgresql-tutorial/postgresql-full-outer-join'
nextLink:
  title: 'PostgreSQL NATURAL JOIN'
  slug: 'postgresql-tutorial/postgresql-natural-join'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `CROSS JOIN` to produce a cartesian product of rows from the joined tables.

## Introduction to the PostgreSQL CROSS JOIN clause

In PostgreSQL, a cross\-join allows you to join two tables by combining each row from the first table with every row from the second table, resulting in a complete combination of all rows.

In the set theory, we can say that a cross\-join produces the [cartesian product](https://en.wikipedia.org/wiki/Cartesian_product) of rows in two tables.

Unlike other [join](postgresql-joins) clauses such as [LEFT JOIN](postgresql-left-join)  or [INNER JOIN](postgresql-inner-join), the `CROSS JOIN` clause does not have a join predicate.

Suppose you have to perform a `CROSS JOIN` of `table1` and `table2`.

If `table1` has `n` rows and `table2` has `m` rows, the `CROSS JOIN` will return a result set that has `nxm` rows.

For example, the `table1` has `1,000` rows and `table2` has `1,000` rows, the result set will have `1,000 x 1,000` \= `1,000,000` rows.

Because a `CROSS JOIN` may generate a large result set, you should use it carefully to avoid performance issues.

Here’s the basic syntax of the `CROSS JOIN` syntax:

```sqlsql
SELECT
  select_list
FROM
  table1
CROSS JOIN table2;
```

The following statement is equivalent to the above statement:

```sql
SELECT
  select_list
FROM
  table1,table2;
```

Alternatively, you can use an `INNER JOIN` clause with a condition that always evaluates to true to simulate a cross\-join:

```sql
SELECT
  select_list
FROM
  table1
  INNER JOIN table2 ON true;
```

## PostgreSQL CROSS JOIN example

The following [CREATE TABLE](postgresql-create-table) statements create `T1` and `T2` tables and [insert sample data](postgresql-insert) for the cross\-join demonstration.

```sql
DROP TABLE IF EXISTS T1;

CREATE TABLE
  T1 (LABEL CHAR(1) PRIMARY KEY);

DROP TABLE IF EXISTS T2;

CREATE TABLE
  T2 (score INT PRIMARY KEY);

INSERT INTO
  T1 (LABEL)
VALUES
  ('A'),
  ('B');

INSERT INTO
  T2 (score)
VALUES
  (1),
  (2),
  (3);
```

The following statement uses the `CROSS JOIN` operator to join `T1` table with `T2` table:

```sql
SELECT *
FROM T1
CROSS JOIN T2;
```

```
 label | score
-------+-------
 A     |     1
 B     |     1
 A     |     2
 B     |     2
 A     |     3
 B     |     3
(6 rows)
```

The following picture illustrates how the `CROSS JOIN` works when joining the `T1` table with the `T2` table:

![PostgreSQL CROSS JOIN illustration](/postgresqltutorial/PostgreSQL-CROSS-JOIN-illustration.png)

## Some practical examples of using CROSS JOIN

In practice, you can find the `CROSS JOIN` useful when you need to combine data from two tables without specific matching conditions. For example:

### 1\) Scheduling

Suppose you have a table for `employees` and `shifts`, and you want to create a schedule that lists all possible combinations of employees and shifts to explore various staffing scenarios:

```
SELECT *
FROM employees
CROSS JOIN shift;
```

### 2\) Inventory management

In an inventory management system, you have tables for `warehouses` and `products`. A `CROSS JOIN` can help you analyze the availability of each product in every warehouse:

```sql
SELECT *
FROM products
CROSS JOIN warehouses;
```

## Summary

- Use the PostgreSQL `CROSS JOIN` clause to make a cartesian product of rows in two tables.


# Natural Join

---
title: 'PostgreSQL NATURAL JOIN'
page_title: 'PostgreSQL NATURAL JOIN Explained By Example'
page_description: 'This tutorial explains to you how the PostgreSQL NATURAL JOIN works and shows you how to use the NATURAL JOIN to query data from two or more tables.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-natural-join/'
ogImage: '/postgresqltutorial/city.png'
updatedOn: '2024-02-02T02:29:26+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Cross Join'
  slug: 'postgresql-tutorial/postgresql-cross-join'
nextLink:
  title: 'PostgreSQL GROUP BY'
  slug: 'postgresql-tutorial/postgresql-group-by'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `NATURAL JOIN` to query data from two tables.

## Introduction to PostgreSQL NATURAL JOIN clause

A natural join is a [join](postgresql-joins) that creates an implicit join based on the same column names in the joined tables.

The following shows the syntax of the PostgreSQL NATURAL JOIN clause:

```phpsqlsql
SELECT select_list
FROM table1
NATURAL [INNER, LEFT, RIGHT] JOIN table2;
```

In this syntax:

- First, specify columns from the tables from which you want to retrieve data in the `select_list` in the `SELECT` clause.
- Second, provide the main table (`table1`) from which you want to retrieve data.
- Third, specify the table (`table2`) that you want to join with the main table, in the `NATURAL JOIN` clause.

A natural join can be an [inner join](postgresql-inner-join), [left join](postgresql-left-join), or [right join](postgresql-right-join). If you do not specify an explicit join, PostgreSQL will use the `INNER JOIN` by default.

The convenience of the `NATURAL JOIN` is that it does not require you to specify the condition in the join clause because it uses an implicit condition based on the equality of the common columns.

The equivalent of the `NATURAL JOIN` clause will be like this:

```sql
SELECT select_list
FROM table1
[INNER, LEFT, RIGHT] JOIN table2
   ON table1.column_name = table2.column_name;
```

### Inner Join

The following statements are equivalent:

```
SELECT select_list
FROM table1
NATURAL INNER JOIN table2;
```

And

```
SELECT select_list
FROM table1
INNER JOIN table2 USING (column_name);
```

### Left Join

The following statements are equivalent:

```
SELECT select_list
FROM table1
NATURAL LEFT JOIN table2;
```

And

```
SELECT select_list
FROM table1
LEFT JOIN table2 USING (column_name);
```

### Right join

The following statements are equivalent:

```
SELECT select_list
FROM table1
NATURAL RIGHT JOIN table2;
```

And

```
SELECT select_list
FROM table1
RIGHT JOIN table2 USING (column_name);
```

## Setting up sample tables

The following statements create `categories` and `products` tables, and insert sample data for the demonstration:

```
CREATE TABLE categories (
  category_id SERIAL PRIMARY KEY,
  category_name VARCHAR (255) NOT NULL
);

CREATE TABLE products (
  product_id serial PRIMARY KEY,
  product_name VARCHAR (255) NOT NULL,
  category_id INT NOT NULL,
  FOREIGN KEY (category_id) REFERENCES categories (category_id)
);

INSERT INTO categories (category_name)
VALUES
  ('Smartphone'),
  ('Laptop'),
  ('Tablet'),
  ('VR')
RETURNING *;

INSERT INTO products (product_name, category_id)
VALUES
  ('iPhone', 1),
  ('Samsung Galaxy', 1),
  ('HP Elite', 2),
  ('Lenovo Thinkpad', 2),
  ('iPad', 3),
  ('Kindle Fire', 3)
RETURNING *;
```

The `products` table has the following data:

```
 product_id |  product_name   | category_id
------------+-----------------+-------------
          1 | iPhone          |           1
          2 | Samsung Galaxy  |           1
          3 | HP Elite        |           2
          4 | Lenovo Thinkpad |           2
          5 | iPad            |           3
          6 | Kindle Fire     |           3
(6 rows)
```

The `categories` table has the following data:

```
 category_id | category_name
-------------+---------------
           1 | Smartphone
           2 | Laptop
           3 | Tablet
           4 | VR
(4 rows)
```

## PostgreSQL NATURAL JOIN examples

Let’s explore some examples of using the `NATURAL JOIN` statement.

### 1\) Basic PostgreSQL NATURAL JOIN example

The following statement uses the `NATURAL JOIN` clause to join the `products` table with the `categories` table:

```
SELECT *
FROM products
NATURAL JOIN categories;
```

This statement performs an inner join using the `category_id` column.

Output:

```
 category_id | product_id |  product_name   | category_name
-------------+------------+-----------------+---------------
           1 |          1 | iPhone          | Smartphone
           1 |          2 | Samsung Galaxy  | Smartphone
           2 |          3 | HP Elite        | Laptop
           2 |          4 | Lenovo Thinkpad | Laptop
           3 |          5 | iPad            | Tablet
           3 |          6 | Kindle Fire     | Tablet
(6 rows)
```

The statement is equivalent to the following statement that uses the `INNER JOIN` clause:

```
SELECT	*
FROM products
INNER JOIN categories USING (category_id);
```

### 2\) Using PostgreSQL NATURAL JOIN to perform a LEFT JOIN

The following example uses the `NATURAL JOIN` clause to perform a `LEFT JOIN` without specifying the matching column:

```
SELECT *
FROM categories
NATURAL LEFT JOIN products;
```

Output:

```
 category_id | category_name | product_id |  product_name
-------------+---------------+------------+-----------------
           1 | Smartphone    |          1 | iPhone
           1 | Smartphone    |          2 | Samsung Galaxy
           2 | Laptop        |          3 | HP Elite
           2 | Laptop        |          4 | Lenovo Thinkpad
           3 | Tablet        |          5 | iPad
           3 | Tablet        |          6 | Kindle Fire
           4 | VR            |       null | null
(7 rows)
```

### 3\) Example of using NATURAL JOIN that causes an unexpected result

In practice, you should avoid using the `NATURAL JOIN` whenever possible because sometimes it may cause an unexpected result.

Consider the following `city` and `country` tables from the [sample database](../postgresql-getting-started/postgresql-sample-database):

![](/postgresqltutorial/city.png)

![](/postgresqltutorial/country.png)
Both tables have the same `country_id` column so you can use the `NATURAL JOIN` to join these tables as follows:

```
SELECT *
FROM city
NATURAL JOIN country;
```

The query returns an empty result set.

The reason is that both tables have another common column called `last_update`. When the `NATURAL JOIN` clause uses the `last_update` column, it does not find any matches.

## Summary

- Use the PostgreSQL `NATURAL JOIN` clause to query data from two or more tables that have common columns.


# Group Data

# GROUP BY

---
title: 'PostgreSQL GROUP BY'
page_title: 'PostgreSQL GROUP BY Clause'
page_description: 'In this tutorial, you will learn how to use PostgreSQL GROUP BY clause to divide rows into groups.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-group-by/'
ogImage: '/postgresqltutorial/PostgreSQL-GROUP-BY-1.png'
updatedOn: '2024-04-19T07:10:40+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL NATURAL JOIN'
  slug: 'postgresql-tutorial/postgresql-natural-join'
nextLink:
  title: 'PostgreSQL HAVING'
  slug: 'postgresql-tutorial/postgresql-having'
---

**Summary**: in this tutorial, you will learn how to use PostgreSQL `GROUP BY` clause to divide rows into groups.

## Introduction to PostgreSQL GROUP BY clause

The `GROUP BY` clause divides the rows returned from the [`SELECT`](postgresql-select) statement into groups.

For each group, you can apply an [aggregate function](../postgresql-aggregate-functions) such as [`SUM()`](../postgresql-aggregate-functions/postgresql-sum-function) to calculate the sum of items or [`COUNT()`](../postgresql-aggregate-functions/postgresql-count-function) to get the number of items in the groups.

The following illustrates the basic syntax of the `GROUP BY` clause:

```sql
SELECT
   column_1,
   column_2,
   ...,
   aggregate_function(column_3)
FROM
   table_name
GROUP BY
   column_1,
   column_2,
   ...;

```

In this syntax:

- First, select the columns that you want to group such as `column1` and `column2`, and column that you want to apply an aggregate function (`column3`).
- Second, list the columns that you want to group in the `GROUP BY` clause.

The `GROUP BY` clause divides the rows by the values in the columns specified in the `GROUP BY` clause and calculates a value for each group.

It’s possible to use other clauses of the `SELECT` statement with the `GROUP BY` clause.

PostgreSQL evaluates the `GROUP BY` clause after the `FROM` and [`WHERE`](postgresql-where) clauses and before the [`HAVING`](postgresql-having) [`SELECT`](postgresql-select), [`DISTINCT`](postgresql-select-distinct), [`ORDER BY`](postgresql-order-by) and [`LIMIT`](postgresql-limit) clauses.

![PostgreSQL GROUP BY](/postgresqltutorial/PostgreSQL-GROUP-BY-1.png)

## PostgreSQL GROUP BY clause examples

Let’s take a look at the `payment` table in the [sample database](../postgresql-getting-started/postgresql-sample-database 'PostgreSQL Sample Database').

![payment](/postgresqltutorial/payment.png)

### 1\) Using PostgreSQL GROUP BY without an aggregate function example

The following example uses the `GROUP BY` clause to retrieve the `customer_id` from the payment table:

```sql
SELECT
  customer_id
FROM
  payment
GROUP BY
  customer_id
ORDER BY
  customer_id;
```

Output:

```text
 customer_id
-------------
           1
           2
           3
           4
           5
           6
           7
           8
...
```

Each customer has one or more payments. The `GROUP BY` clause removes duplicate values in the customer_id column and returns distinct customer ids. In this example, the `GROUP BY` clause works like the [`DISTINCT`](postgresql-select-distinct) operator.

### 2\) Using PostgreSQL GROUP BY with SUM() function example

The `GROUP BY` clause is useful when used in conjunction with an [aggregate function](../postgresql-aggregate-functions).

The following query uses the `GROUP BY` clause to retrieve the total payment paid by each customer:

```
SELECT
  customer_id,
  SUM (amount)
FROM
  payment
GROUP BY
  customer_id
ORDER BY
  customer_id;
```

Output:

```text
 customer_id |  sum
-------------+--------
           1 | 114.70
           2 | 123.74
           3 | 130.76
           4 |  81.78
           5 | 134.65
           6 |  84.75
           7 | 130.72
...
```

In this example, the `GROUP BY` clause groups the payments by the customer id. For each group, it calculates the total payment.

The following statement uses the [`ORDER BY`](postgresql-order-by) clause with `GROUP BY` clause to sort the groups by total payments:

```
SELECT
  customer_id,
  SUM (amount)
FROM
  payment
GROUP BY
  customer_id
ORDER BY
  SUM (amount) DESC;
```

Output:

```text
 customer_id |  sum
-------------+--------
         148 | 211.55
         526 | 208.58
         178 | 194.61
         137 | 191.62
         144 | 189.60
```

### 3\) Using PostgreSQL GROUP BY clause with the JOIN clause

The following statement uses the `GROUP BY` clause to retrieve the total payment for each customer and display the customer name and amount:

```
SELECT
  first_name || ' ' || last_name full_name,
  SUM (amount) amount
FROM
  payment
  INNER JOIN customer USING (customer_id)
GROUP BY
  full_name
ORDER BY
  amount DESC;
```

Output:

```text
       full_name       | amount
-----------------------+--------
 Eleanor Hunt          | 211.55
 Karl Seal             | 208.58
 Marion Snyder         | 194.61
 Rhonda Kennedy        | 191.62
 Clara Shaw            | 189.60
...
```

In this example, we join the `payment` table with the `customer` table using an [inner join](postgresql-inner-join) to get the customer names and group customers by their names.

### 4\) Using PostgreSQL GROUP BY with COUNT() function example

The following example uses the `GROUP BY` clause with the [`COUNT()`](../postgresql-aggregate-functions/postgresql-count-function) function to count the number of payments processed by each staff:

```
SELECT
	staff_id,
	COUNT (payment_id)
FROM
	payment
GROUP BY
	staff_id;
```

Output:

```text
 staff_id | count
----------+-------
        1 |  7292
        2 |  7304
(2 rows)
```

In this example, the `GROUP BY` clause divides the rows in the `payment` table into groups and groups them by value in the `staff_id` column. For each group, it counts the number of rows using the [`COUNT()`](../postgresql-aggregate-functions/postgresql-count-function) function.

### 5\) Using PostgreSQL GROUP BY with multiple columns

The following example uses a `GROUP BY` clause to group rows by values in two columns:

```
SELECT
  customer_id,
  staff_id,
  SUM(amount)
FROM
  payment
GROUP BY
  staff_id,
  customer_id
ORDER BY
  customer_id;
```

Output:

```text
 customer_id | staff_id |  sum
-------------+----------+--------
           1 |        2 |  53.85
           1 |        1 |  60.85
           2 |        2 |  67.88
           2 |        1 |  55.86
           3 |        1 |  59.88
...
```

In this example, the `GROUP BY` clause divides the rows in the `payment` table by the values in the `customer_id` and `staff_id` columns. For each group of `(customer_id, staff_id)`, the `SUM()` calculates the total amount.

### 6\) Using PostgreSQL GROUP BY clause with a date column

The following example uses the `GROUP BY` clause to group the payments by payment date:

```
SELECT
  payment_date::date payment_date,
  SUM(amount) sum
FROM
  payment
GROUP BY
  payment_date::date
ORDER BY
  payment_date DESC;
```

Output:

```
payment_date |   sum
--------------+---------
 2007-05-14   |  514.18
 2007-04-30   | 5723.89
 2007-04-29   | 2717.60
 2007-04-28   | 2622.73
...
```

Since the values in the `payment_date` column are [timestamps](postgresql-timestamp), we cast them to date values using the [cast operator](postgresql-cast) `::`.

## Summary

- Use the PostgreSQL `GROUP BY` clause to divide rows into groups and apply an aggregate function to each group.


# HAVING

---
title: 'PostgreSQL HAVING'
page_title: 'PostgreSQL HAVING'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL HAVING clause to filter groups of rows based on a specified condition.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-having/'
ogImage: '/postgresqltutorial/postgresql-having.svg'
updatedOn: '2024-01-17T08:04:37+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL GROUP BY'
  slug: 'postgresql-tutorial/postgresql-group-by'
nextLink:
  title: 'PostgreSQL GROUPING SETS'
  slug: 'postgresql-tutorial/postgresql-grouping-sets'
---

**Summary**: in this tutorial, you will learn how to use the **PostgreSQL HAVING** clause to specify a search condition for a group or an aggregate.

## Introduction to PostgreSQL HAVING clause

The `HAVING` clause specifies a search condition for a group. The `HAVING` clause is often used with the [`GROUP BY`](postgresql-group-by) clause to filter groups based on a specified condition.

The following statement illustrates the basic syntax of the `HAVING` clause:

```sql
SELECT
  column1,
  aggregate_function (column2)
FROM
  table_name
GROUP BY
  column1
HAVING
  condition;
```

In this syntax:

- First, the `GROUP BY` clause groups rows into groups by the values in the `column1`.
- Then, the `HAVING` clause filters the groups based on the `condition`.

If a group satisfies the specified condition, the `HAVING` clause will include it in the result set.

Besides the `GROUP BY` clause, you can also include other clauses such as [`JOIN`](postgresql-joins) and [`LIMIT`](postgresql-limit) in the statement that uses the `HAVING` clause.

PostgreSQL evaluates the `HAVING` clause after the `FROM`, [`WHERE`](postgresql-where), [`GROUP BY`](postgresql-group-by), and before the [`DISTINCT`](postgresql-select-distinct), [`SELECT`](postgresql-select), [`ORDER BY`](postgresql-order-by) and [`LIMIT`](postgresql-limit) clauses:

![](/postgresqltutorial/postgresql-having.svg)
Because PostgreSQL evaluates the `HAVING` clause before the `SELECT` clause, you cannot use the column aliases in the `HAVING` clause.

This restriction arises from the fact that, at the point of `HAVING` clause evaluation, the column aliases specified in the `SELECT` clause are not yet available.

### HAVING vs. WHERE

The [`WHERE`](postgresql-where) clause filters the rows based on a specified condition whereas the `HAVING` clause filter groups of rows according to a specified condition.

In other words, you apply the condition in the `WHERE` clause to the rows while you apply the condition in the `HAVING` clause to the groups of rows.

## PostgreSQL HAVING clause examples

Let’s take a look at the `payment` table in the [sample database](../postgresql-getting-started/postgresql-sample-database 'PostgreSQL Sample Database'):

![payment](/postgresqltutorial/payment.png)

### 1\) Using PostgreSQL HAVING clause with SUM function example

The following query uses the [`GROUP BY`](postgresql-group-by) clause with the [`SUM()`](../postgresql-aggregate-functions/postgresql-sum-function) function to find the total payment of each customer:

```sql
SELECT
  customer_id,
  SUM (amount) amount
FROM
  payment
GROUP BY
  customer_id
ORDER BY
  amount DESC;
```

Output:

```text
 customer_id | amount
-------------+--------
         148 | 211.55
         526 | 208.58
         178 | 194.61
         137 | 191.62
...
```

The following statement adds the `HAVING`clause to select the only customers who have been spending more than `200`:

```
SELECT
  customer_id,
  SUM (amount) amount
FROM
  payment
GROUP BY
  customer_id
HAVING
  SUM (amount) > 200
ORDER BY
  amount DESC;
```

Output:

```text
 customer_id | amount
-------------+--------
         148 | 211.55
         526 | 208.58
(2 rows)
```

### 2\) PostgreSQL HAVING clause with COUNT example

See the following `customer` table from the [sample database](../postgresql-getting-started/postgresql-sample-database):

![customer table](/postgresqltutorial/customer-table.png)
The following query uses the `GROUP BY` clause to find the number of customers per store:

```
SELECT
  store_id,
  COUNT (customer_id)
FROM
  customer
GROUP BY
  store_id
```

Output:

```text
 store_id | count
----------+-------
        1 |   326
        2 |   273
(2 rows)
```

The following statement adds the `HAVING` clause to select a store that has more than 300 customers:

```
SELECT
  store_id,
  COUNT (customer_id)
FROM
  customer
GROUP BY
  store_id
HAVING
  COUNT (customer_id) > 300;
```

Output:

```
 store_id | count
----------+-------
        1 |   326
(1 row)
```

## Summary

- Use the `HAVING` clause to specify the filter condition for groups returned by the `GROUP BY` clause.


# GROUPING SETS

---
title: 'PostgreSQL GROUPING SETS'
page_title: 'PostgreSQL GROUPING SETS'
page_description: 'Show you how to use PostgreSQL GROUPING SETS to generate a result set equivalent to the one generated by the UNION ALL of multiple GROUP BY clauses.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-grouping-sets/'
ogImage: '/postgresqltutorial/PostgreSQL-Grouping-Sets-GROUPING-function-1.png'
updatedOn: '2024-07-01T01:00:43+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL EXCEPT'
  slug: 'postgresql-tutorial/postgresql-except'
nextLink:
  title: 'PostgreSQL ROLLUP'
  slug: 'postgresql-tutorial/postgresql-rollup'
---

**Summary**: in this tutorial, you will learn about grouping sets and how to use the PostgreSQL `GROUPING SETS` clause to generate multiple grouping sets in a query.

## Setup a sample table

Let’s get started by [creating a new table](postgresql-create-table) called `sales` for the demonstration.

```sql
DROP TABLE IF EXISTS sales;

CREATE TABLE sales (
    brand VARCHAR NOT NULL,
    segment VARCHAR NOT NULL,
    quantity INT NOT NULL,
    PRIMARY KEY (brand, segment)
);

INSERT INTO sales (brand, segment, quantity)
VALUES
    ('ABC', 'Premium', 100),
    ('ABC', 'Basic', 200),
    ('XYZ', 'Premium', 100),
    ('XYZ', 'Basic', 300)
RETURNING *;
```

Output:

```text
 brand | segment | quantity
-------+---------+----------
 ABC   | Premium |      100
 ABC   | Basic   |      200
 XYZ   | Premium |      100
 XYZ   | Basic   |      300
(4 rows)
```

The `sales` table stores the number of products sold by brand and segment.

## Introduction to PostgreSQL GROUPING SETS

A grouping set is a set of columns by which you group using the `GROUP BY` clause.

A grouping set is denoted by a comma\-separated list of columns placed inside parentheses:

```sql
(column1, column2, ...)
```

For example, the following query uses the `GROUP BY` clause to return the number of products sold by brand and segment. In other words, it defines a grouping set of the brand and segment which is denoted by `(brand, segment)`

```sql
SELECT
    brand,
    segment,
    SUM (quantity)
FROM
    sales
GROUP BY
    brand,
    segment;
```

Output:

```text
 brand | segment | sum
-------+---------+-----
 XYZ   | Basic   | 300
 ABC   | Premium | 100
 ABC   | Basic   | 200
 XYZ   | Premium | 100
(4 rows)
```

The following query finds the number of products sold by a brand. It defines a grouping set `(brand)`:

```sql
SELECT
    brand,
    SUM (quantity)
FROM
    sales
GROUP BY
    brand;
```

Output:

```text
 brand | sum
-------+-----
 ABC   | 300
 XYZ   | 400
(2 rows)
```

The following query finds the number of products sold by segment. It defines a grouping set `(segment)`:

```sql
SELECT
    segment,
    SUM (quantity)
FROM
    sales
GROUP BY
    segment;
```

Output:

```text
 segment | sum
---------+-----
 Basic   | 500
 Premium | 200
(2 rows)
```

The following query finds the number of products sold for all brands and segments. It defines an empty grouping set which is denoted by `()`.

```sql
SELECT SUM (quantity) FROM sales;
```

Output:

```text
 sum
-----
 700
(1 row)
```

Suppose you want to get all the grouping sets using a single query. To achieve this, you can use the [`UNION ALL`](postgresql-union) to combine all the result sets of the queries above.

Because `UNION ALL` requires all result sets to have the same number of columns with compatible data types, you need to adjust the queries by adding `NULL` to the selection list of each as shown below:

```sql
SELECT
    brand,
    segment,
    SUM (quantity)
FROM
    sales
GROUP BY
    brand,
    segment

UNION ALL

SELECT
    brand,
    NULL,
    SUM (quantity)
FROM
    sales
GROUP BY
    brand

UNION ALL

SELECT
    NULL,
    segment,
    SUM (quantity)
FROM
    sales
GROUP BY
    segment

UNION ALL

SELECT
    NULL,
    NULL,
    SUM (quantity)
FROM
    sales;
```

Output:

```text
 brand | segment | sum
-------+---------+-----
 XYZ   | Basic   | 300
 ABC   | Premium | 100
 ABC   | Basic   | 200
 XYZ   | Premium | 100
 ABC   | null    | 300
 XYZ   | null    | 400
 null  | Basic   | 500
 null  | Premium | 200
 null  | null    | 700
(9 rows)
```

This query generated a single result set with the aggregates for all grouping sets.

Even though the above query works as you expected, it has two main problems.

- First, it is quite lengthy.
- Second, it has a performance issue because PostgreSQL has to scan the `sales` table separately for each query.

To make it more efficient, PostgreSQL provides the `GROUPING SETS` clause which is the subclause of the [`GROUP BY`](postgresql-group-by) clause.

The `GROUPING SETS` allows you to define multiple grouping sets in the same query.

The general syntax of the `GROUPING SETS` is as follows:

```sql
SELECT
    c1,
    c2,
    aggregate_function(c3)
FROM
    table_name
GROUP BY
    GROUPING SETS (
        (c1, c2),
        (c1),
        (c2),
        ()
);
```

In this syntax, we have four grouping sets `(c1,c2)`, `(c1)`, `(c2)`, and `()`.

To apply this syntax to the above example, you can use `GROUPING SETS` clause instead of the [`UNION ALL`](postgresql-union) clause like this:

```sql
SELECT
    brand,
    segment,
    SUM (quantity)
FROM
    sales
GROUP BY
    GROUPING SETS (
        (brand, segment),
        (brand),
        (segment),
        ()
    );
```

Output:

```text
 brand | segment | sum
-------+---------+-----
 null  | null    | 700
 XYZ   | Basic   | 300
 ABC   | Premium | 100
 ABC   | Basic   | 200
 XYZ   | Premium | 100
 ABC   | null    | 300
 XYZ   | null    | 400
 null  | Basic   | 500
 null  | Premium | 200
(9 rows)
```

This query is much shorter and more readable. In addition, PostgreSQL will optimize the number of times it scans the `sales` table and will not scan multiple times.

## Grouping function

The `GROUPING()` function accepts an argument which can be a column name or an expression:

```sql
GROUPING( column_name | expression)
```

The `column_name` or `expression` must match with the one specified in the `GROUP BY` clause.

The `GROUPING()` function returns bit 0 if the argument is a member of the current grouping set and 1 otherwise.

See the following example:

```sql
SELECT
	GROUPING(brand) grouping_brand,
	GROUPING(segment) grouping_segment,
	brand,
	segment,
	SUM (quantity)
FROM
	sales
GROUP BY
	GROUPING SETS (
		(brand),
		(segment),
		()
	)
ORDER BY
	brand,
	segment;
```

![PostgreSQL GROUPING SETS - GROUPING function.](/postgresqltutorial/PostgreSQL-Grouping-Sets-GROUPING-function-1.png)As shown in the screenshot, when the value in the `grouping_brand` is 0, the `sum` column shows the subtotal of the `brand`.

When the value in the `grouping_segment` is zero, the sum column shows the subtotal of the `segment`.

You can use the `GROUPING()` function in the `HAVING` clause to find the subtotal of each brand like this:

```sql
SELECT
	GROUPING(brand) grouping_brand,
	GROUPING(segment) grouping_segment,
	brand,
	segment,
	SUM (quantity)
FROM
	sales
GROUP BY
	GROUPING SETS (
		(brand),
		(segment),
		()
	)
HAVING GROUPING(brand) = 0
ORDER BY
	brand,
	segment;
```

![PostgreSQL GROUPING SETS - GROUPING function in HAVING clause](/postgresqltutorial/PostgreSQL-Grouping-Sets-GROUPING-function-in-HAVING-clause.png)

## Summary

- Use the PostgreSQL `GROUPING SETS` to generate multiple grouping sets.


# CUBE

---
title: 'PostgreSQL CUBE'
page_title: 'PostgreSQL CUBE'
page_description: 'This tutorial shows you how to use the PostgreSQL CUBE to generate multiple grouping sets.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-cube/'
ogImage: '/postgresqltutorial/sales-table.png'
updatedOn: '2024-07-01T01:06:31+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL ROLLUP'
  slug: 'postgresql-tutorial/postgresql-rollup'
nextLink:
  title: 'PostgreSQL Subquery'
  slug: 'postgresql-tutorial/postgresql-subquery'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `CUBE` to generate multiple grouping sets.

## Introduction to the PostgreSQL CUBE

PostgreSQL `CUBE` is a subclause of the [`GROUP BY`](postgresql-group-by) clause. The `CUBE` allows you to generate multiple grouping sets.

A grouping set is a set of columns to which you want to group. For more information on the grouping sets, check it out the [`GROUPING SETS`](postgresql-grouping-sets) tutorial.

The following illustrates the syntax of the `CUBE` subclause:

```sql
SELECT
    c1,
    c2,
    c3,
    aggregate (c4)
FROM
    table_name
GROUP BY
    CUBE (c1, c2, c3);

```

In this syntax:

- First, specify the `CUBE` subclause in the [`GROUP BY`](postgresql-group-by) clause of the [`SELECT`](postgresql-select) statement.
- Second, in the select list, specify the columns (dimensions or dimension columns) which you want to analyze and [aggregation function](../postgresql-aggregate-functions) expressions.
- Third, in the `GROUP BY` clause, specify the dimension columns within the parentheses of the `CUBE` subclause.

The query generates all possible grouping sets based on the dimension columns specified in `CUBE`. The `CUBE` subclause is a short way to define multiple grouping sets so the following are equivalent:

```sql
CUBE(c1,c2,c3)

GROUPING SETS (
    (c1,c2,c3),
    (c1,c2),
    (c1,c3),
    (c2,c3),
    (c1),
    (c2),
    (c3),
    ()
 )

```

In general, if the number of columns specified in the `CUBE` is `n`, then you will have 2ncombinations.

PostgreSQL allows you to perform a partial cube to reduce the number of aggregates calculated. The following shows the syntax:

```sql
SELECT
    c1,
    c2,
    c3,
    aggregate (c4)
FROM
    table_name
GROUP BY
    c1,
    CUBE (c1, c2);

```

## PostgreSQL CUBE examples

We will use the `sales` table created in the `GROUPING SETS` tutorial for the demonstration.

![Sales Table](/postgresqltutorial/sales-table.png)
The following query uses the `CUBE` subclause to generate multiple grouping sets:

```sql
SELECT
    brand,
    segment,
    SUM (quantity)
FROM
    sales
GROUP BY
    CUBE (brand, segment)
ORDER BY
    brand,
    segment;

```

Here is the output:

![PostgreSQL CUBE example](/postgresqltutorial/PostgreSQL-CUBE-example.png)
The following query performs a partial cube:

```sql
SELECT
    brand,
    segment,
    SUM (quantity)
FROM
    sales
GROUP BY
    brand,
    CUBE (segment)
ORDER BY
    brand,
    segment;

```

![PostgreSQL CUBE - partial cube example](/postgresqltutorial/PostgreSQL-CUBE-partial-cube-example.png)
In this tutorial, you have learned how to use the PostgreSQL `CUBE` to generate multiple grouping sets.


# ROLLUP

---
title: 'PostgreSQL ROLLUP'
page_title: 'PostgreSQL ROLLUP'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL ROLLUP to generate multiple grouping sets.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-rollup/'
ogImage: '/postgresqltutorial/PostgreSQL-ROLLUP-example.png'
updatedOn: '2024-07-01T01:04:08+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL GROUPING SETS'
  slug: 'postgresql-tutorial/postgresql-grouping-sets'
nextLink:
  title: 'PostgreSQL CUBE'
  slug: 'postgresql-tutorial/postgresql-cube'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `ROLLUP` to generate multiple grouping sets.

## Introduction to the PostgreSQL ROLLUP

The PostgreSQL `ROLLUP` is a subclause of the [`GROUP BY`](postgresql-group-by) clause that offers a shorthand for defining multiple [grouping sets](postgresql-grouping-sets). A grouping set is a set of columns by which you group. Check out the [grouping sets](postgresql-grouping-sets) tutorial for detailed information.

Different from the [`CUBE`](postgresql-cube) subclause, `ROLLUP` does not generate all possible grouping sets based on the specified columns. It just makes a subset of those.

The `ROLLUP` assumes a hierarchy among the input columns and generates all grouping sets that make sense considering the hierarchy. This is the reason why `ROLLUP` is often used to generate the subtotals and the grand total for reports.

For example, the `CUBE (c1,c2,c3)` makes all eight possible grouping sets:

```phpsql
(c1, c2, c3)
(c1, c2)
(c2, c3)
(c1,c3)
(c1)
(c2)
(c3)
()

```

However, the `ROLLUP(c1,c2,c3)` generates only four grouping sets, assuming the hierarchy `c1 > c2 > c3` as follows:

```sql
(c1, c2, c3)
(c1, c2)
(c1)
()

```

A common use of  `ROLLUP` is to calculate the aggregations of data by year, month, and date, considering the hierarchy `year > month > date`

The following illustrates the syntax of the PostgreSQL `ROLLUP`:

```sql
SELECT
    c1,
    c2,
    c3,
    aggregate(c4)
FROM
    table_name
GROUP BY
    ROLLUP (c1, c2, c3);

```

It is also possible to do a partial roll up to reduce the number of subtotals generated.

```sql
SELECT
    c1,
    c2,
    c3,
    aggregate(c4)
FROM
    table_name
GROUP BY
    c1,
    ROLLUP (c2, c3);

```

## PostgreSQL ROLLUP examples

If you haven’t created the sales table, you can use the following script:

```sql
DROP TABLE IF EXISTS sales;
CREATE TABLE sales (
    brand VARCHAR NOT NULL,
    segment VARCHAR NOT NULL,
    quantity INT NOT NULL,
    PRIMARY KEY (brand, segment)
);

INSERT INTO sales (brand, segment, quantity)
VALUES
    ('ABC', 'Premium', 100),
    ('ABC', 'Basic', 200),
    ('XYZ', 'Premium', 100),
    ('XYZ', 'Basic', 300);

```

The following query uses the `ROLLUP` clause to find the number of products sold by brand (subtotal) and by all brands and segments (total).

```
SELECT
    brand,
    segment,
    SUM (quantity)
FROM
    sales
GROUP BY
    ROLLUP (brand, segment)
ORDER BY
    brand,
    segment;

```

![PostgreSQL ROLLUP example](/postgresqltutorial/PostgreSQL-ROLLUP-example.png)
As you can see clearly from the output, the third row shows the sales of the `ABC` brand, the sixth row displays sales of the `XYZ` brand. The last row shows the grand total for all brands and segments. In this example, the hierarchy is `brand > segment`.

If you change the order of brand and segment, the result will be different as follows:

```sql
SELECT
    segment,
    brand,
    SUM (quantity)
FROM
    sales
GROUP BY
    ROLLUP (segment, brand)
ORDER BY
    segment,
    brand;

```

![PostgreSQL ROLLUP example 2](/postgresqltutorial/PostgreSQL-ROLLUP-example-2.png)
In this case, the hierarchy is the `segment > brand`.

The following statement performs a partial roll\-up:

```sql
SELECT
    segment,
    brand,
    SUM (quantity)
FROM
    sales
GROUP BY
    segment,
    ROLLUP (brand)
ORDER BY
    segment,
    brand;

```

![PostgreSQL ROLLUP - partial roll up](/postgresqltutorial/PostgreSQL-ROLLUP-partial-roll-up.png)
See the following `rental` table from the [sample database](../postgresql-getting-started/postgresql-sample-database).

![Rental Table](/postgresqltutorial/rental.png)
The following statement finds the number of rental per day, month, and year by using the `ROLLUP`:

```sql
SELECT
    EXTRACT (YEAR FROM rental_date) y,
    EXTRACT (MONTH FROM rental_date) M,
    EXTRACT (DAY FROM rental_date) d,
    COUNT (rental_id)
FROM
    rental
GROUP BY
    ROLLUP (
        EXTRACT (YEAR FROM rental_date),
        EXTRACT (MONTH FROM rental_date),
        EXTRACT (DAY FROM rental_date)
    );

```

![PostgreSQL ROLLUP example with year month and date](/postgresqltutorial/PostgreSQL-ROLLUP-example-with-year-month-and-date.png)
In this tutorial, you have learned how to use the PostgreSQL `ROLLUP` to generate multiple grouping sets.


# Set Operations

# UNION

---
title: 'PostgreSQL UNION'
page_title: 'PostgreSQL UNION Operator'
page_description: 'This tutorial shows you how to use the PostgreSQL UNION operator to combine the result sets of multiple queries into a single result set.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-union/'
ogImage: '/postgresqltutorial/PostgresQL-UNION.png'
updatedOn: '2024-02-06T01:38:07+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL HAVING'
  slug: 'postgresql-tutorial/postgresql-having'
nextLink:
  title: 'PostgreSQL INTERSECT Operator'
  slug: 'postgresql-tutorial/postgresql-intersect'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `UNION` operator to combine result sets of multiple queries into a single result set.

## Introduction to PostgreSQL UNION operator

The `UNION` operator allows you to combine the result sets of two or more [`SELECT`](postgresql-select) statements into a single result set.

Here’s the basic syntax of the `UNION` operator:

```sql
SELECT select_list
FROM A
UNION
SELECT select_list
FROM B;
```

In this syntax, the queries must conform to the following rules:

- The number and the order of the columns in the select list of both queries must be the same.
- The data types of the columns in select lists of the queries must be compatible.

The `UNION` operator removes all duplicate rows from the combined data set. To retain the duplicate rows, you use the `UNION ALL` instead.

Here’s the syntax of the `UNION ALL` operator:

```sql
SELECT select_list
FROM A
UNION ALL
SELECT select_list
FROM B;
```

The following Venn diagram illustrates how the `UNION` works:

![](/postgresqltutorial/PostgresQL-UNION.png)

### PostgreSQL UNION with ORDER BY clause

The `UNION` and `UNION ALL` operators may order the rows in the final result set in an unspecified order. For example, it may place rows from the second result set before/after the row from the first result set.

To sort rows in the final result set, you specify the [`ORDER BY`](postgresql-order-by) clause after the second query:

```
SELECT select_list
FROM A
UNION
SELECT select_list
FROM B
ORDER BY sort_expression;
```

Note that if you use the `ORDER BY` clause in the first query, PostgreSQL will issue an error.

## Setting up sample tables

The following statements create two tables `top_rated_films` and `most_popular_films`, and insert data into these tables:

```
CREATE TABLE top_rated_films(
  title VARCHAR NOT NULL,
  release_year SMALLINT
);

CREATE TABLE most_popular_films(
  title VARCHAR NOT NULL,
  release_year SMALLINT
);

INSERT INTO top_rated_films(title, release_year)
VALUES
   ('The Shawshank Redemption', 1994),
   ('The Godfather', 1972),
   ('The Dark Knight', 2008),
   ('12 Angry Men', 1957);

INSERT INTO most_popular_films(title, release_year)
VALUES
  ('An American Pickle', 2020),
  ('The Godfather', 1972),
  ('The Dark Knight', 2008),
  ('Greyhound', 2020);
```

The following statement retrieves data from the `top_rated_films` table:

```sql
SELECT * FROM top_rated_films;
```

Output:

```text
          title           | release_year
--------------------------+--------------
 The Shawshank Redemption |         1994
 The Godfather            |         1972
 The Dark Knight          |         2008
 12 Angry Men             |         1957
(4 rows)
```

The following statement retrieves data from the `most_popular_films` table:

```
SELECT * FROM most_popular_films;
```

Output:

```text
       title        | release_year
--------------------+--------------
 An American Pickle |         2020
 The Godfather      |         1972
 The Dark Knight    |         2008
 Greyhound          |         2020
(4 rows)
```

## PostgreSQL UNION examples

Let’s take some examples of using the PostgreSQL `UNION` operator.

### 1\) Basic PostgreSQL UNION example

The following statement uses the `UNION` operator to combine data from the queries that retrieve data from the `top_rated_films` and `most_popular_films`:

```
SELECT * FROM top_rated_films
UNION
SELECT * FROM most_popular_films;
```

Output:

```text
          title           | release_year
--------------------------+--------------
 An American Pickle       |         2020
 The Dark Knight          |         2008
 Greyhound                |         2020
 The Shawshank Redemption |         1994
 The Godfather            |         1972
 12 Angry Men             |         1957
(6 rows)
```

The result set includes six rows because the `UNION` operator removes two duplicate rows.

### 2\) PostgreSQL UNION ALL example

The following statement uses the `UNION ALL` operator to combine result sets from queries that retrieve data from `top_rated_films` and `most_popular_films` tables:

```
SELECT * FROM top_rated_films
UNION ALL
SELECT * FROM most_popular_films;
```

Output:

```text
          title           | release_year
--------------------------+--------------
 The Shawshank Redemption |         1994
 The Godfather            |         1972
 The Dark Knight          |         2008
 12 Angry Men             |         1957
 An American Pickle       |         2020
 The Godfather            |         1972
 The Dark Knight          |         2008
 Greyhound                |         2020
(8 rows)
```

The output indicates that the `UNION ALL` operator retains the duplicate rows.

### 3\) PostgreSQL UNION ALL with ORDER BY clause example

To sort the result returned by the `UNION` operator, you place the `ORDER BY` clause after the second query:

```
SELECT * FROM top_rated_films
UNION ALL
SELECT * FROM most_popular_films
ORDER BY title;
```

Output:

```
          title           | release_year
--------------------------+--------------
 12 Angry Men             |         1957
 An American Pickle       |         2020
 Greyhound                |         2020
 The Dark Knight          |         2008
 The Dark Knight          |         2008
 The Godfather            |         1972
 The Godfather            |         1972
 The Shawshank Redemption |         1994
(8 rows)
```

## Summary

- Use the `UNION` to combine result sets of two queries and return distinct rows.
- Use the `UNION ALL` to combine the result sets of two queries but retain the duplicate rows.


# INTERSECT

---
title: 'PostgreSQL INTERSECT Operator'
page_title: 'PostgreSQL INTERSECT Operator'
page_description: 'Show you how to use the PostgreSQL INTERSECT operator to combine two result sets and return the rows that appear in both result sets.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-intersect/'
ogImage: '/postgresqltutorial/PostgreSQL-INTERSECT-Operator-300x206.png'
updatedOn: '2024-07-01T01:03:14+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL UNION'
  slug: 'postgresql-tutorial/postgresql-union'
nextLink:
  title: 'PostgreSQL EXCEPT'
  slug: 'postgresql-tutorial/postgresql-except'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `INTERSECT` operator to combine result sets of two or more queries.

## Introduction to PostgreSQL INTERSECT operator

Like the [UNION](postgresql-union) and [EXCEPT](postgresql-except) operators, the PostgreSQL `INTERSECT` operator combines result sets of two [SELECT](postgresql-except) statements into a single result set. The `INTERSECT` operator returns a result set containing rows available in both results sets.

Here is the basic syntax of the `INTERSECT` operator:

```plaintextsql
SELECT select_list
FROM A
INTERSECT
SELECT select_list
FROM B;
```

To use the `INTERSECT` operator, the columns that appear in the `SELECT` statements must follow these rules:

- The number of columns and their order in queries must be the same.
- The [data types](postgresql-data-types) of the columns in the queries must be compatible.

The following diagram illustrates how the `INTERSECT` operator combines the result sets A and B. The final result set is represented by the yellow area where circle A intersects circle B.

![PostgreSQL INTERSECT Operator](/postgresqltutorial/PostgreSQL-INTERSECT-Operator-300x206.png)

### PostgreSQL INTERSECT with ORDER BY clause

If you want to sort the result set returned by the `INTERSECT` operator, you place the `ORDER BY` after the final query:

```sql
SELECT select_list
FROM A
INTERSECT
SELECT select_list
FROM B
ORDER BY sort_expression;
```

## Setting up sample tables

We’ll create two tables `top_rated_films` and `most_popular_films` for demonstration:

```sql
CREATE TABLE top_rated_films(
  title VARCHAR NOT NULL,
  release_year SMALLINT
);

CREATE TABLE most_popular_films(
  title VARCHAR NOT NULL,
  release_year SMALLINT
);

INSERT INTO top_rated_films(title, release_year)
VALUES
   ('The Shawshank Redemption', 1994),
   ('The Godfather', 1972),
   ('The Dark Knight', 2008),
   ('12 Angry Men', 1957);

INSERT INTO most_popular_films(title, release_year)
VALUES
  ('An American Pickle', 2020),
  ('The Godfather', 1972),
  ('The Dark Knight', 2008),
  ('Greyhound', 2020);

SELECT * FROM top_rated_films;
SELECT * FROM most_popular_films;
```

The contents of the `top_rated_films` table:

```text
          title           | release_year
--------------------------+--------------
 The Shawshank Redemption |         1994
 The Godfather            |         1972
 The Dark Knight          |         2008
 12 Angry Men             |         1957
(4 rows)
```

The contents of the `most_popular_films` table:

```plaintext
       title        | release_year
--------------------+--------------
 An American Pickle |         2020
 The Godfather      |         1972
 The Dark Knight    |         2008
 Greyhound          |         2020
(4 rows)
```

## PostgreSQL INTERSECT operator examples

Let’s explore some examples of using the `INTERSECT` operator.

### 1\) Basic INTERSECT operator example

The following example uses the `INTERSECT` operator to retrieve the popular films that are also top\-rated:

```plaintext
SELECT *
FROM most_popular_films
INTERSECT
SELECT *
FROM top_rated_films;
```

Output:

```text
      title      | release_year
-----------------+--------------
 The Godfather   |         1972
 The Dark Knight |         2008
(2 rows)
```

The result set returns one film that appears on both tables.

### 2\) Using the INTERSECT operator with ORDER BY clause example

The following statement uses the `INTERSECT` operator to find the most popular films which are also the top\-rated films and sort the films by release year:

```plaintext
SELECT *
FROM most_popular_films
INTERSECT
SELECT *
FROM top_rated_films
ORDER BY release_year;
```

Output:

```
      title      | release_year
-----------------+--------------
 The Godfather   |         1972
 The Dark Knight |         2008
(2 rows)
```

## Summary

- Use the PostgreSQL `INTERSECT` operator to combine two result sets and return a single result set containing rows appearing in both.
- Place the `ORDER BY` clause after the second query to sort the rows in the result set returned by the `INTERSECT` operator.


# EXCEPT

---
title: 'PostgreSQL EXCEPT'
page_title: 'PostgreSQL EXCEPT'
page_description: 'Show you how to the PostgreSQL EXCEPT operator to combine the result sets of two queries.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-except/'
ogImage: '/postgresqltutorial/PostgreSQL-EXCEPT-300x202.png'
updatedOn: '2024-07-01T00:51:42+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL INTERSECT Operator'
  slug: 'postgresql-tutorial/postgresql-intersect'
nextLink:
  title: 'PostgreSQL GROUPING SETS'
  slug: 'postgresql-tutorial/postgresql-grouping-sets'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `EXCEPT` operator to return a result set containing the rows in the first query that does not appear in the output of the second query.

## Introduction to the PostgreSQL EXCEPT operator

Like the [UNION](postgresql-union) and [INTERSECT](postgresql-intersect) operators, the `EXCEPT` operator returns rows by comparing the result sets of two or more queries.

The `EXCEPT` operator returns distinct rows from the first (left) query that are not in the second (right) query.

The following illustrates the syntax of the `EXCEPT` operator.

```sql
SELECT select_list
FROM A
EXCEPT
SELECT select_list
FROM B;
```

The queries that involve the `EXCEPT` need to follow these rules:

- The number of columns and their orders must be the same in the two queries.
- The data types of the respective columns must be compatible.

The following Venn diagram illustrates the `EXCEPT` operator:

![PostgreSQL EXCEPT](/postgresqltutorial/PostgreSQL-EXCEPT-300x202.png)If you want to sort the rows in the combined result sets, you need to place the [`ORDER BY`](postgresql-order-by) clause after the second query:

```sql
SELECT select_list
FROM A
EXCEPT
SELECT select_list
FROM B
ORDER BY sort_expression;
```

## Setting up sample tables

We’ll create the `top_rated_films` and `most_popular_films` tables for demonstration:

```sql
CREATE TABLE top_rated_films(
  title VARCHAR NOT NULL,
  release_year SMALLINT
);

CREATE TABLE most_popular_films(
  title VARCHAR NOT NULL,
  release_year SMALLINT
);

INSERT INTO top_rated_films(title, release_year)
VALUES
   ('The Shawshank Redemption', 1994),
   ('The Godfather', 1972),
   ('The Dark Knight', 2008),
   ('12 Angry Men', 1957);

INSERT INTO most_popular_films(title, release_year)
VALUES
  ('An American Pickle', 2020),
  ('The Godfather', 1972),
  ('The Dark Knight', 2008),
  ('Greyhound', 2020);

SELECT * FROM top_rated_films;
SELECT * FROM most_popular_films;
```

The contents of the `top_rated_films` table:

```text
          title           | release_year
--------------------------+--------------
 The Shawshank Redemption |         1994
 The Godfather            |         1972
 The Dark Knight          |         2008
 12 Angry Men             |         1957
(4 rows)
```

The contents of the `most_popular_films` table:

```text
       title        | release_year
--------------------+--------------
 An American Pickle |         2020
 The Godfather      |         1972
 The Dark Knight    |         2008
 Greyhound          |         2020
(4 rows)
```

## PostgreSQL EXCEPT operator examples

Let’s take some examples of using the `EXCEPT` operator

### 1\) Basic EXCEPT operator example

The following statement uses the `EXCEPT` operator to find the top\-rated films that are not popular:

```sql
SELECT * FROM top_rated_films
EXCEPT
SELECT * FROM most_popular_films;
```

Output:

```text
          title           | release_year
--------------------------+--------------
 The Shawshank Redemption |         1994
 12 Angry Men             |         1957
(2 rows)
```

### 2\) Using the EXCEPT operator with the ORDER BY clause

The following statement uses the `ORDER BY` clause in the query to sort the result set returned by the `EXCEPT` operator by titles:

```sql
SELECT * FROM top_rated_films
EXCEPT
SELECT * FROM most_popular_films
ORDER BY title;
```

Output:

```text
          title           | release_year
--------------------------+--------------
 12 Angry Men             |         1957
 The Shawshank Redemption |         1994
(2 rows)
```

Notice that we placed the [ORDER BY](postgresql-order-by) clause after the second query to sort the films by titles.

## Summary

- Use the PostgreSQL `EXCEPT` operator to combine rows from two result sets and return a result set containing rows from the first result set that do not appear in the second result set.


# Common Table Expression (CTE)

# Common Table Expression (CTE)

---
title: 'PostgreSQL CTE'
page_title: 'PostgreSQL Common Table Expression (CTE)'
page_description: 'This tutorial shows you how to use the PostgreSQL common table expression (CTE) to simplify complex queries.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-cte/'
ogImage: ''
updatedOn: '2024-01-22T06:27:22+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL EXISTS Operator'
  slug: 'postgresql-tutorial/postgresql-exists'
nextLink:
  title: 'PostgreSQL Recursive Query'
  slug: 'postgresql-tutorial/postgresql-recursive-query'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL common table expression (CTE) to simplify complex queries.

## Introduction to PostgreSQL common table expression (CTE)

A common table expression (CTE) allows you to create a temporary result set within a [query](postgresql-select).

A CTE helps you enhance the readability of a complex query by breaking it down into smaller and more reusable parts

Here’s the basic syntax for creating a common table expression:

```sql
WITH cte_name (column1, column2, ...) AS (
    -- CTE query
    SELECT ...
)
-- Main query using the CTE
SELECT ...
FROM cte_name;
```

In this syntax:

- **WITH clause**: Introduce the common table expression (CTE). It is followed by the name of the CTE and a list of column names in parentheses. The column list is optional and is only necessary if you want to explicitly define the columns for the CTE.
- **CTE name**: Specify the name of the CTE. The CTE name exists within the scope of the query. Ensure that the CTE name is unique within the query.
- **Column List (optional)**: Specify the list of column names within the parentheses after the CTE name. If not specified, the columns implicitly inherit the column names from `SELECT` statement inside the CTE.
- **AS keyword**: The AS keyword indicates the beginning of the CTE definition.
- **CTE query**: This is a query that defines the CTE, which may include [JOINs](postgresql-joins), [WHERE](postgresql-where), [GROUP BY](postgresql-group-by) clauses, and other valid SQL constructs.
- **Main query**: After defining the CTE, you can reference it in the main query by its name. In the main query, you can use the CTE as if it were a regular table, simplifying the structure of complex queries.

## PostgreSQL CTE examples

Let’s explore some examples of using common table expressions (CTE).

### 1\) Basic PostgreSQL common table expression example

The following example uses a common table expression (CTE) to select the `title` and `length` of films in the `'Action'` category and returns all the columns of the CTE:

```sql
WITH action_films AS (
  SELECT
    f.title,
    f.length
  FROM
    film f
    INNER JOIN film_category fc USING (film_id)
    INNER JOIN category c USING(category_id)
  WHERE
    c.name = 'Action'
)
SELECT * FROM action_films;
```

Output:

```text
          title          | length
-------------------------+--------
 Amadeus Holy            |    113
 American Circus         |    129
 Antitrust Tomatoes      |    168
 Ark Ridgemont           |     68
...
```

In this example:

- First, the CTE query combines data from three tables `film`, `film_category`, and `category` using the `INNER JOIN` clauses.
- Then, the main query retrieves data from the `action_films` CTE using a simple `SELECT` statement.

### 2\) Join a CTE with a table example

We’ll use the `rental` and `staff` tables from the [sample database](../postgresql-getting-started/postgresql-sample-database) in this example:

The following example join a CTE with a table to find the staff and rental count for each:

```
WITH cte_rental AS (
  SELECT
    staff_id,
    COUNT(rental_id) rental_count
  FROM
    rental
  GROUP BY
    staff_id
)
SELECT
  s.staff_id,
  first_name,
  last_name,
  rental_count
FROM
  staff s
  INNER JOIN cte_rental USING (staff_id);
```

In this example:

- First, the CTE returns a result set that includes the staff id and the rental counts.
- Then, the main query joins the `staff` table with the CTE using the `staff_id` column.

Output:

```text
 staff_id | first_name | last_name | rental_count
----------+------------+-----------+--------------
        1 | Mike       | Hillyer   |         8040
        2 | Jon        | Stephens  |         8004
(2 rows)
```

### 3\) Multiple CTEs example

The following example uses multiple CTEs to calculate various statistics related to films and customers:

```
WITH film_stats AS (
    -- CTE 1: Calculate film statistics
    SELECT
        AVG(rental_rate) AS avg_rental_rate,
        MAX(length) AS max_length,
        MIN(length) AS min_length
    FROM film
),
customer_stats AS (
    -- CTE 2: Calculate customer statistics
    SELECT
        COUNT(DISTINCT customer_id) AS total_customers,
        SUM(amount) AS total_payments
    FROM payment
)
-- Main query using the CTEs
SELECT
    ROUND((SELECT avg_rental_rate FROM film_stats), 2) AS avg_film_rental_rate,
    (SELECT max_length FROM film_stats) AS max_film_length,
    (SELECT min_length FROM film_stats) AS min_film_length,
    (SELECT total_customers FROM customer_stats) AS total_customers,
    (SELECT total_payments FROM customer_stats) AS total_payments;

```

Output:

```
 avg_film_rental_rate | max_film_length | min_film_length | total_customers | total_payments
----------------------+-----------------+-----------------+-----------------+----------------
                 2.98 |             185 |              46 |             599 |       61312.04
(1 row)
```

In this example, we create two CTEs:

- **`film_stats`:** Calculates statistics related to films including the average rental rate, maximum length, and minimum length.
- **`customer_stats`:** Calculates statistics related to customers including the total number of distinct customers and the overall payments made.

The main query retrieves specific values from each CTE to create a summary report.

## PostgreSQL CTE advantages

The following are some advantages of using common table expressions or CTEs:

- Improve the readability of complex queries. You use CTEs to organize complex queries in a more organized and readable manner.
- Ability to create [recursive queries](postgresql-recursive-query), which are queries that reference themselves. The recursive queries come in handy when you want to query hierarchical data such as organization charts.
- Use in conjunction with [window functions](../postgresql-window-function). You can use CTEs in conjunction with window functions to create an initial result set and use another select statement to further process this result set.

## Summary

- Use a common table expression (CTE) to create a temporary result set within a query.
- Leverage CTEs to simplify complex queries and make them more readable.


# Recursive CTE

---
title: 'PostgreSQL Recursive Query'
page_title: 'PostgreSQL Recursive Query'
page_description: 'In this tutorial, you will learn about the PostgreSQL recursive query using the recursive common table expressions (CTEs).'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-recursive-query/'
ogImage: ''
updatedOn: '2024-01-22T07:25:18+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CTE'
  slug: 'postgresql-tutorial/postgresql-cte'
nextLink:
  title: 'PostgreSQL INSERT'
  slug: 'postgresql-tutorial/postgresql-insert'
---

**Summary**: in this tutorial, you will learn about the PostgreSQL recursive query using recursive common table expressions or CTEs.

## Introduction to the PostgreSQL recursive query

In PostgreSQL, a [common table expression (CTE)](postgresql-cte) is a named temporary result set within a query.

A recursive CTE allows you to perform recursion within a query using the `WITH RECURSIVE` syntax.

A recursive CTE is often referred to as a recursive query.

Here’s the basic syntax of a recursive CTE:

```phpsql
WITH RECURSIVE cte_name (column1, column2, ...)
AS(
    -- anchor member
    SELECT select_list FROM table1 WHERE condition

    UNION [ALL]

    -- recursive term
    SELECT select_list FROM cte_name WHERE recursive_condition
)
SELECT * FROM cte_name;
```

In this syntax:

- `cte_name`: Specify the name of the CTE. You can reference this CTE name in the subsequent parts of the query.
- `column1`, `column2`, … Specify the columns selected in both the anchor and recursive members. These columns define the CTE’s structure.
- Anchor member: Responsible for forming the base result set of the CTE structure.
- Recursive member: Refer to the CTE name itself. It combines with the anchor member using the `UNION` or `UNION ALL` operator.
- `recursive_condition`: Is a condition used in the recursive member that determines how the recursion stops.

PostgreSQL executes a recursive CTE in the following sequence:

- First, execute the anchor member to create the base result set (R0\).
- Second, execute the recursive member with Ri as an input to return the result set Ri\+1 as the output.
- Third, repeat step 2 until an empty set is returned. (termination check)
- Finally, return the final result set that is a [UNION](postgresql-union) or `UNION ALL` of the result sets R0, R1, … Rn.

A recursive CTE can be useful when dealing with hierarchical or nested data structures, such as trees or graphs.

## PostgreSQL recursive query example

Let’s take an example of using a recursive query.

### 1\) Setting up a sample table

First, [create a new table](postgresql-create-table) called employees:

```sql
CREATE TABLE employees (
  employee_id SERIAL PRIMARY KEY,
  full_name VARCHAR NOT NULL,
  manager_id INT
);
```

The `employees` table has three columns: `employee_id`, `full_name`, and `manager_id`. The `manager_id` column specifies the manager id of an employee.

Second, [insert some rows](postgresql-insert-multiple-rows) into the `employees` table:

```sql
INSERT INTO employees (employee_id, full_name, manager_id)
VALUES
  (1, 'Michael North', NULL),
  (2, 'Megan Berry', 1),
  (3, 'Sarah Berry', 1),
  (4, 'Zoe Black', 1),
  (5, 'Tim James', 1),
  (6, 'Bella Tucker', 2),
  (7, 'Ryan Metcalfe', 2),
  (8, 'Max Mills', 2),
  (9, 'Benjamin Glover', 2),
  (10, 'Carolyn Henderson', 3),
  (11, 'Nicola Kelly', 3),
  (12, 'Alexandra Climo', 3),
  (13, 'Dominic King', 3),
  (14, 'Leonard Gray', 4),
  (15, 'Eric Rampling', 4),
  (16, 'Piers Paige', 7),
  (17, 'Ryan Henderson', 7),
  (18, 'Frank Tucker', 8),
  (19, 'Nathan Ferguson', 8),
  (20, 'Kevin Rampling', 8);
```

### 2\) Basic PostgreSQL recursive query example

The following statement uses a recursive CTE to find all subordinates of the manager with the id 2\.

```
WITH RECURSIVE subordinates AS (
  SELECT
    employee_id,
    manager_id,
    full_name
  FROM
    employees
  WHERE
    employee_id = 2
  UNION
  SELECT
    e.employee_id,
    e.manager_id,
    e.full_name
  FROM
    employees e
    INNER JOIN subordinates s ON s.employee_id = e.manager_id
)
SELECT * FROM subordinates;
```

Output:

```text
 employee_id | manager_id |    full_name
-------------+------------+-----------------
           2 |          1 | Megan Berry
           6 |          2 | Bella Tucker
           7 |          2 | Ryan Metcalfe
           8 |          2 | Max Mills
           9 |          2 | Benjamin Glover
          16 |          7 | Piers Paige
          17 |          7 | Ryan Henderson
          18 |          8 | Frank Tucker
          19 |          8 | Nathan Ferguson
          20 |          8 | Kevin Rampling
(10 rows)
```

How it works:

- The recursive CTE `subordinates` defines an anchor member and a recursive member.
- The anchor member returns the base result set R0 which is the employee with the id 2\.

```
 employee_id | manager_id |  full_name
-------------+------------+-------------
           2 |          1 | Megan Berry
```

The recursive member returns the direct subordinate(s) of the employee id 2\. This is the result of joining between the `employees` table and the `subordinates` CTE. The first iteration of the recursive term returns the following result set:

```text
 employee_id | manager_id |    full_name
-------------+------------+-----------------
           6 |          2 | Bella Tucker
           7 |          2 | Ryan Metcalfe
           8 |          2 | Max Mills
           9 |          2 | Benjamin Glover
```

PostgreSQL executes the recursive member repeatedly. The second iteration of the recursive member uses the result set above step as the input value, and returns this result set:

```text
 employee_id | manager_id |    full_name
-------------+------------+-----------------
          16 |          7 | Piers Paige
          17 |          7 | Ryan Henderson
          18 |          8 | Frank Tucker
          19 |          8 | Nathan Ferguson
          20 |          8 | Kevin Rampling
```

The third iteration returns an empty result set because no employee is reporting to the employee with the id 16, 17, 18, 19, and 20\.

PostgreSQL returns the final result set which is the union of all result sets in the first and second iterations generated by the non\-recursive and recursive members.

```
 employee_id | manager_id |    full_name
-------------+------------+-----------------
           2 |          1 | Megan Berry
           6 |          2 | Bella Tucker
           7 |          2 | Ryan Metcalfe
           8 |          2 | Max Mills
           9 |          2 | Benjamin Glover
          16 |          7 | Piers Paige
          17 |          7 | Ryan Henderson
          18 |          8 | Frank Tucker
          19 |          8 | Nathan Ferguson
          20 |          8 | Kevin Rampling
(10 rows)
```

## Summary

- Use the `WITH RECURSIVE` syntax to define a recursive query.
- Use a recursive query to deal with hierarchical or nested data structures such as trees or graphs.


# Modifying Data

# INSERT

---
title: 'PostgreSQL INSERT'
page_title: 'PostgreSQL INSERT'
page_description: 'This tutorial shows you how to use the PostgreSQL INSERT statement to insert a new row into a table and return the last inserted id.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-insert/'
ogImage: ''
updatedOn: '2024-07-01T01:09:33+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Recursive Query'
  slug: 'postgresql-tutorial/postgresql-recursive-query'
nextLink:
  title: 'PostgreSQL INSERT Multiple Rows'
  slug: 'postgresql-tutorial/postgresql-insert-multiple-rows'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `INSERT` statement to insert a new row into a table.

## Introduction to PostgreSQL INSERT statement

The PostgreSQL `INSERT` statement allows you to insert a new row into a table.

Here’s the basic syntax of the `INSERT` statement:

```shellsqlsql
INSERT INTO table1(column1, column2, …)
VALUES (value1, value2, …);
```

In this syntax:

- First, specify the name of the table (`table1`) that you want to insert data after the `INSERT INTO` keywords and a list of comma\-separated columns (`colum1, column2, ....`).
- Second, supply a list of comma\-separated values in parentheses `(value1, value2, ...)` after the `VALUES` keyword. The column and value lists must be in the same order.

The `INSERT` statement returns a command tag with the following form:

```sql
INSERT oid count
```

In this syntax:

- The `OID` is an object identifier. PostgreSQL used the `OID` internally as a [primary key](postgresql-primary-key) for its system tables. Typically, the `INSERT` statement returns `OID` with a value of 0\.
- The `count` is the number of rows that the `INSERT` statement inserted successfully.

If you insert a new row into a table successfully, the return will typically look like:

```
INSERT 0 1
```

### RETURNING clause

The `INSERT` statement has an optional `RETURNING` clause that returns the information of the inserted row.

If you want to return the entire inserted row, you use an asterisk (`*`) after the `RETURNING` keyword:

```
INSERT INTO table1(column1, column2, …)
VALUES (value1, value2, …)
RETURNING *;
```

If you want to return some information about the inserted row, you can specify one or more columns after the `RETURNING` clause.

For example, the following statement returns the `id` of the inserted row:

```sql
INSERT INTO table1(column1, column2, …)
VALUES (value1, value2, …)
RETURNING id;
```

To rename the returned value, you use the `AS` keyword followed by the name of the output. For example:

```sql
INSERT INTO table1(column1, column2, …)
VALUES (value1, value2, …)
RETURNING output_expression AS output_name;
```

To insert multiple rows into a table simultaneously, you can use the [INSERT multiple rows statement](postgresql-insert-multiple-rows).

## PostgreSQL INSERT statement examples

The following statement [creates a new table](postgresql-create-table 'PostgreSQL CREATE TABLE') called `links` for the demonstration:

```sql
CREATE TABLE links (
  id SERIAL PRIMARY KEY,
  url VARCHAR(255) NOT NULL,
  name VARCHAR(255) NOT NULL,
  description VARCHAR (255),
  last_update DATE
);
```

Note that you will learn how to [create a new table](postgresql-create-table 'PostgreSQL CREATE TABLE') in the subsequent tutorial. In this tutorial, you need to execute it to create a new table.

### 1\) Basic PostgreSQL INSERT statement example

The following example uses the `INSERT` statement to insert a new row into the `links` table:

```sql
INSERT INTO links (url, name)
VALUES('https://neon.tech/postgresql','PostgreSQL Tutorial');
```

The statement returns the following output:

```sql
INSERT 0 1
```

To insert [character data](postgresql-char-varchar-text), you enclose it in single quotes (‘) for example `'PostgreSQL Tutorial'`.

If you omit the not null columns in the `INSERT` statement, PostgreSQL will issue an error. But if you omit the null column, PostgreSQL will use the column default value for insertion.

In this example, the `description` is a nullable column because it doesn’t have a `NOT NULL` constraint. Therefore, PostgreSQL uses `NULL` to insert into the `description` column.

PostgreSQL automatically generates a sequential number for the [serial column](postgresql-serial) so you do not have to supply a value for the serial column in the `INSERT` statement.

The following [`SELECT`](postgresql-select) statement shows the contents of the `links` table:

```
SELECT	* FROM links;
```

Output:

```text
 id |                url                 |        name         | description | last_update
----+------------------------------------+---------------------+-------------+-------------
  1 | https://neon.tech/postgresql | PostgreSQL Tutorial | null        | null
(1 row)
```

### 2\) Inserting character string that contains a single quote

If you want to insert a string that contains a single quote (`'`) such as `O'Reilly Media`, you have to use an additional single quote (`'`) to escape it. For example:

```sql
INSERT INTO links (url, name)
VALUES('http://www.oreilly.com','O''Reilly Media');
```

Output:

```sql
INSERT 0 1
```

The following statement verifies the insert:

```
SELECT * FROM links;
```

Output:

```
 id |                url                 |        name         | description | last_update
----+------------------------------------+---------------------+-------------+-------------
  1 | https://neon.tech/postgresql | PostgreSQL Tutorial | null        | null
  2 | http://www.oreilly.com             | O'Reilly Media      | null        | null
(2 rows)
```

### 3\) Inserting a date value

To insert a date into a [`DATE`](postgresql-date) column, you use the date in the format `'YYYY-MM-DD'`.

For example, the following statement inserts a new row with a specified date into the `links` table:

```sql
INSERT INTO links (url, name, last_update)
VALUES('https://www.google.com','Google','2013-06-01');
```

Output:

```sql
INSERT 0 1
```

The following statement retrieves all data from the links table to verify the insert:

```
 id |                url                 |        name         | description | last_update
----+------------------------------------+---------------------+-------------+-------------
  1 | https://neon.tech/postgresql | PostgreSQL Tutorial | null        | null
  2 | http://www.oreilly.com             | O'Reilly Media      | null        | null
  3 | https://www.google.com             | Google              | null        | 2013-06-01
(3 rows)

```

### 4\) Getting the last inserted ID

To get the last inserted ID from the inserted row, you use the `RETURNING` clause of the `INSERT`statement.

For example, the following statement inserts a new row into the `links` table and returns the last inserted id:

```
INSERT INTO links (url, name)
VALUES('https://www.postgresql.org','PostgreSQL')
RETURNING id;
```

Output:

```
 id
----
  4
(1 row)
```

## Summary

- Use PostgreSQL `INSERT` statement to insert a new row into a table.
- Use the `RETURNING` clause to get the inserted rows.


# INSERT Multiple Rows

---
title: 'PostgreSQL INSERT Multiple Rows'
page_title: 'PostgreSQL INSERT - Inserting Multiple Rows into a Table'
page_description: 'In this tutorial, you will learn how to use a single PostgreSQL INSERT statement to insert multiple rows into a table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-insert-multiple-rows/'
ogImage: ''
updatedOn: '2024-01-22T13:22:27+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL INSERT'
  slug: 'postgresql-tutorial/postgresql-insert'
nextLink:
  title: 'PostgreSQL UPDATE'
  slug: 'postgresql-tutorial/postgresql-update'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `INSERT` statement to insert multiple rows into a table.

## Inserting multiple rows into a table

To insert multiple rows into a table using a single [`INSERT`](postgresql-insert) statement, you use the following syntax:

```shellsql
INSERT INTO table_name (column_list)
VALUES
    (value_list_1),
    (value_list_2),
    ...
    (value_list_n);
```

In this syntax:

- First, specify the name of the table that you want to insert data after the `INSERT INTO` keywords.
- Second, list the required columns or all columns of the table in parentheses that follow the table name.
- Third, supply a comma\-separated list of rows after the `VALUES` keyword.

To insert multiple rows and return the inserted rows, you add the `RETURNING` clause as follows:

```sql
INSERT INTO table_name (column_list)
VALUES
    (value_list_1),
    (value_list_2),
    ...
    (value_list_n)
RETURNING * | output_expression;
```

Inserting multiple rows at once has advantages over inserting one row at a time:

- **Performance:** Inserting multiple rows in a single statement is often more efficient than multiple individual inserts because it reduces the number of round\-trips between the application and the PostgreSQL server.
- **Atomicity:** The entire `INSERT` statement is atomic, meaning that either all rows are inserted, or none are. This ensures data consistency.

## Inserting multiple rows into a table examples

Let’s take some examples of inserting multiple rows into a table.

### Setting up a sample table

The following statement [creates a new table](postgresql-create-table) called `contacts` that has four columns `id`, `first_name`, `last_name`, and `email`:

```sql
CREATE TABLE contacts (
    id SERIAL PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    email VARCHAR(384) NOT NULL UNIQUE
);
```

### 1\) Basic inserting multiple rows example

The following statement uses the `INSERT` statement to insert three rows into the `links` table:

```sql
INSERT INTO contacts (first_name, last_name, email)
VALUES
    ('John', 'Doe', '[[email protected]](../cdn-cgi/l/email-protection.html)'),
    ('Jane', 'Smith', '[[email protected]](../cdn-cgi/l/email-protection.html)'),
    ('Bob', 'Johnson', '[[email protected]](../cdn-cgi/l/email-protection.html)');
```

PostgreSQL returns the following message:

```sql
INSERT 0 3
```

To verify the inserts, you use the following statement:

```
SELECT * FROM contacts;
```

Output:

```text
 id | first_name | last_name |          email
----+------------+-----------+-------------------------
  1 | John       | Doe       | [[email protected]](../cdn-cgi/l/email-protection.html)
  2 | Jane       | Smith     | [[email protected]](../cdn-cgi/l/email-protection.html)
  3 | Bob        | Johnson   | [[email protected]](../cdn-cgi/l/email-protection.html)
(3 rows)

```

### 2\) Inserting multiple rows and returning inserted rows

The following statement uses the `INSERT` statement to insert two rows into the `contacts` table and returns the inserted rows:

```
INSERT INTO contacts (first_name, last_name, email)
VALUES
    ('Alice', 'Johnson', '[[email protected]](../cdn-cgi/l/email-protection.html)'),
    ('Charlie', 'Brown', '[[email protected]](../cdn-cgi/l/email-protection.html)')
RETURNING *;
```

Output:

```text
 id | first_name | last_name |           email
----+------------+-----------+---------------------------
  4 | Alice      | Johnson   | [[email protected]](../cdn-cgi/l/email-protection.html)
  5 | Charlie    | Brown     | [[email protected]](../cdn-cgi/l/email-protection.html)
(2 rows)


INSERT 0 2
```

If you just want to return the inserted id list, you can specify the `id` column in the `RETURNING` clause like this:

```
INSERT INTO contacts (first_name, last_name, email)
VALUES
    ('Eva', 'Williams', '[[email protected]](../cdn-cgi/l/email-protection.html)'),
    ('Michael', 'Miller', '[[email protected]](../cdn-cgi/l/email-protection.html)'),
    ('Sophie', 'Davis', '[[email protected]](../cdn-cgi/l/email-protection.html)')
RETURNING id;
```

Output:

```
 id
----
  6
  7
  8
(3 rows)


INSERT 0 3
```

## Summary

- Specify multiple value lists in the `INSERT` statement to insert multiple rows into a table.
- Use `RETURNING` clause to return the inserted rows.


# UPDATE

---
title: 'PostgreSQL UPDATE'
page_title: 'PostgreSQL UPDATE Statement'
page_description: 'This tutorial shows you how to use the PostgreSQL UPDATE statement to update data of one or more columns of a table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-update/'
ogImage: ''
updatedOn: '2024-01-22T13:47:38+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL INSERT Multiple Rows'
  slug: 'postgresql-tutorial/postgresql-insert-multiple-rows'
nextLink:
  title: 'PostgreSQL UPDATE Join'
  slug: 'postgresql-tutorial/postgresql-update-join'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `UPDATE` statement to update existing data in a table.

## Introduction to the PostgreSQL UPDATE statement

The PostgreSQL `UPDATE` statement allows you to update data in one or more columns of one or more rows in a table.

Here’s the basic syntax of the `UPDATE` statement:

```shellsqlsql
UPDATE table_name
SET column1 = value1,
    column2 = value2,
    ...
WHERE condition;
```

In this syntax:

- First, specify the name of the table that you want to update data after the `UPDATE` keyword.
- Second, specify columns and their new values after `SET` keyword. The columns that do not appear in the `SET` clause retain their original values.
- Third, determine which rows to update in the condition of the [`WHERE`](postgresql-where) clause.

The `WHERE` clause is optional. If you omit the `WHERE` clause, the `UPDATE` statement will update all rows in the table.

When the `UPDATE` statement is executed successfully, it returns the following command tag:

```sql
UPDATE count
```

The `count` is the number of rows updated including rows whose values did not change.

### Returning updated rows

The `UPDATE` statement has an optional `RETURNING` clause that returns the updated rows:

```
UPDATE table_name
SET column1 = value1,
    column2 = value2,
    ...
WHERE condition
RETURNING * | output_expression AS output_name;
```

## PostgreSQL UPDATE examples

Let’s take some examples of using the PostgreSQL `UPDATE` statement.

### Setting up a sample table

The following statements [create a table](postgresql-create-table) called `courses` and [insert](postgresql-insert) data into it:

```sql
CREATE TABLE courses(
  course_id serial PRIMARY KEY,
  course_name VARCHAR(255) NOT NULL,
  price DECIMAL(10,2) NOT NULL,
  description VARCHAR(500),
  published_date date
);


INSERT INTO courses( course_name, price, description, published_date)
VALUES
('PostgreSQL for Developers', 299.99, 'A complete PostgreSQL for Developers', '2020-07-13'),
('PostgreSQL Admininstration', 349.99, 'A PostgreSQL Guide for DBA', NULL),
('PostgreSQL High Performance', 549.99, NULL, NULL),
('PostgreSQL Bootcamp', 777.99, 'Learn PostgreSQL via Bootcamp', '2013-07-11'),
('Mastering PostgreSQL', 999.98, 'Mastering PostgreSQL in 21 Days', '2012-06-30');

SELECT * FROM courses;

```

Output:

```text
 course_id |         course_name         | price  |             description              | published_date
-----------+-----------------------------+--------+--------------------------------------+----------------
         1 | PostgreSQL for Developers   | 299.99 | A complete PostgreSQL for Developers | 2020-07-13
         2 | PostgreSQL Admininstration  | 349.99 | A PostgreSQL Guide for DBA           | null
         3 | PostgreSQL High Performance | 549.99 | null                                 | null
         4 | PostgreSQL Bootcamp         | 777.99 | Learn PostgreSQL via Bootcamp        | 2013-07-11
         5 | Mastering PostgreSQL        | 999.98 | Mastering PostgreSQL in 21 Days      | 2012-06-30
(5 rows)
```

### 1\) Basic PostgreSQL UPDATE example

The following statement uses the `UPDATE` statement to update the course with id 3 by changing the `published_date` to `'2020-08-01'`.

```
UPDATE courses
SET published_date = '2020-08-01'
WHERE course_id = 3;
```

The statement returns the following message indicating that one row has been updated:

```sql
UPDATE 1
```

The following statement retrieves the course with id 3 to verify the update:

```
SELECT course_id, course_name, published_date
FROM courses
WHERE course_id = 3;
```

Output:

```text
 course_id |         course_name         | published_date
-----------+-----------------------------+----------------
         3 | PostgreSQL High Performance | 2020-08-01
(1 row)
```

### 2\) Updating a row and returning the updated row

The following statement uses the `UPDATE` statement update `published_date` of the course id 2 to `2020-07-01` and returns the updated course.

```
UPDATE courses
SET published_date = '2020-07-01'
WHERE course_id = 2
RETURNING *;
```

Output:

```
 course_id |        course_name         | price  |        description         | published_date
-----------+----------------------------+--------+----------------------------+----------------
         2 | PostgreSQL Admininstration | 349.99 | A PostgreSQL Guide for DBA | 2020-07-01
(1 row)
```

### 3\) Updating a column with an expression

The following statement uses an `UPDATE` statement to increase the price of all the courses 5%:

```
UPDATE courses
SET price = price * 1.05;
```

Because we don’t use a WHERE clause, the UPDATE statement updates all the rows in the `courses` table.

Output:

```
UPDATE 5
```

The following statement retrieves data from the `courses` table to verify the update:

```
SELECT * FROM courses;
```

Output:

```
SELECT
  course_name,
  price
FROM
  courses;
```

Output:

```
         course_name         |  price
-----------------------------+---------
 PostgreSQL for Developers   |  314.99
 PostgreSQL Bootcamp         |  816.89
 Mastering PostgreSQL        | 1049.98
 PostgreSQL High Performance |  577.49
 PostgreSQL Admininstration  |  367.49
(5 rows)
```

## Summary

- Use the `UPDATE` statement to update data in one or more columns of a table.
- Specify a condition in a WHERE clause to determine which rows to update data.
- Use the `RETURNING` clause to return the updated rows from the `UPDATE` statement


# UPDATE Join

---
title: 'PostgreSQL UPDATE Join'
page_title: 'PostgreSQL UPDATE Join with Practical Examples'
page_description: 'this tutorial shows you how to use the PostgreSQL UPDATE join syntax to update data in a table based on values in another table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-update-join/'
ogImage: '/postgresqltutorial/PostgreSQL-UPDATE-JOIN-Sample-Database.png'
updatedOn: '2024-02-01T08:42:46+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL UPDATE'
  slug: 'postgresql-tutorial/postgresql-update'
nextLink:
  title: 'PostgreSQL DELETE'
  slug: 'postgresql-tutorial/postgresql-delete'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `UPDATE` join syntax to update data in a table based on values in another table.

## Introduction to the PostgreSQL UPDATE join syntax

Sometimes, you need to update data in a table based on values in another table. In this case, you can use the PostgreSQL [`UPDATE`](postgresql-update) join.

Here’s the basic syntax of the `UPDATE` join statement:

```sql
UPDATE table1
SET table1.c1 = new_value
FROM table2
WHERE table1.c2 = table2.c2;
```

To join a table (table1\) with another table (table2\) in the `UPDATE` statement, you specify the joined table (table2\) in the `FROM` clause and provide the join condition in the `WHERE` clause. The `FROM` clause must appear immediately after the `SET` clause.

For each row of the table `table1`, the `UPDATE` statement examines every row of the table `table2`.

If the values in the `c2` column of table `table1` equals the values in the `c2` column of table `table2`, the `UPDATE` statement updates the value in the `c1` column of the table `table1` the new value (`new_value`).

## PostgreSQL UPDATE JOIN example

Let’s take a look at an example to understand how the PostgreSQL `UPDATE` join works. We will use the following database tables for the demonstration:

![PostgreSQL UPDATE join sample database](/postgresqltutorial/PostgreSQL-UPDATE-JOIN-Sample-Database.png)First, [create a new table](postgresql-create-table) called `product_segment` that stores the product segments such as grand luxury, luxury, and mass.

The `product_segment` table has the `discount` column that stores the discount percentage based on a specific segment. For example, products with the grand luxury segment have `5%` discount while luxury and mass products have `6%` and `10%` discounts respectively.

```sql
CREATE TABLE product_segment (
    id SERIAL PRIMARY KEY,
    segment VARCHAR NOT NULL,
    discount NUMERIC (4, 2)
);


INSERT INTO
    product_segment (segment, discount)
VALUES
    ('Grand Luxury', 0.05),
    ('Luxury', 0.06),
    ('Mass', 0.1);

```

Second, create another table named `product` that stores the product data. The `product` table has the [foreign key column](postgresql-foreign-key) `segment_id` that links to the `id` of the `segment` table.

```sql
CREATE TABLE product(
    id SERIAL PRIMARY KEY,
    name VARCHAR NOT NULL,
    price NUMERIC(10,2),
    net_price NUMERIC(10,2),
    segment_id INT NOT NULL,
    FOREIGN KEY(segment_id) REFERENCES product_segment(id)
);


INSERT INTO
    product (name, price, segment_id)
VALUES
    ('diam', 804.89, 1),
    ('vestibulum aliquet', 228.55, 3),
    ('lacinia erat', 366.45, 2),
    ('scelerisque quam turpis', 145.33, 3),
    ('justo lacinia', 551.77, 2),
    ('ultrices mattis odio', 261.58, 3),
    ('hendrerit', 519.62, 2),
    ('in hac habitasse', 843.31, 1),
    ('orci eget orci', 254.18, 3),
    ('pellentesque', 427.78, 2),
    ('sit amet nunc', 936.29, 1),
    ('sed vestibulum', 910.34, 1),
    ('turpis eget', 208.33, 3),
    ('cursus vestibulum', 985.45, 1),
    ('orci nullam', 841.26, 1),
    ('est quam pharetra', 896.38, 1),
    ('posuere', 575.74, 2),
    ('ligula', 530.64, 2),
    ('convallis', 892.43, 1),
    ('nulla elit ac', 161.71, 3);
```

Third, suppose you have to calculate the net price of every product based on the discount of the product segment. To do this, you can apply the `UPDATE` join statement as follows:

```sql
UPDATE product
SET net_price = price - price * discount
FROM product_segment
WHERE product.segment_id = product_segment.id;
```

You can utilize the table aliases to make the query shorter like this:

```sql
UPDATE
    product p
SET
    net_price = price - price * discount
FROM
    product_segment s
WHERE
    p.segment_id = s.id;
```

This statement joins the `product` table to the `product_segment` table. If there is a match in both tables, it gets a discount from the `product_segment` table, calculates the net price based on the following formula, and updates the `net_price` column.

```
net_price = price - price * discount;
```

The following [`SELECT`](postgresql-select) statement retrieves the data of the `product` table to verify the update:

```sql
SELECT * FROM product;
```

![PostgreSQL UPDATE Join Example](/postgresqltutorial/PostgreSQL-UPDATE-JOIN-example.png)
The output indicates that the `net_price` column has been updated with the correct values.

## Summary

- Use the PostgreSQL `UPDATE` join statement to update data in a table based on values in another table.


# DELETE

---
title: 'PostgreSQL DELETE'
page_title: 'PostgreSQL DELETE Statement'
page_description: 'This tutorial shows you how to use the PostgreSQL DELETE statement to remove one or more rows of a table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-delete/'
ogImage: ''
updatedOn: '2024-01-23T01:09:16+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL UPDATE Join'
  slug: 'postgresql-tutorial/postgresql-update-join'
nextLink:
  title: 'PostgreSQL DELETE JOIN'
  slug: 'postgresql-tutorial/postgresql-delete-join'
---

**Summary**: in this tutorial, you will learn how to use the **PostgreSQL DELETE** statement to delete data from a table.

## Introduction to PostgreSQL DELETE statement

The PostgreSQL `DELETE` statement allows you to delete one or more rows from a table.

The following shows the basic syntax of the `DELETE` statement:

```shellsql
DELETE FROM table_name
WHERE condition;
```

In this syntax:

- First, specify the name (`table_name`) of the table from which you want to delete data after the `DELETE FROM` keywords.
- Second, specify a condition in the [`WHERE`](postgresql-where) clause to determine which rows to delete.

The `WHERE` clause is optional. If you omit the `WHERE` clause, the `DELETE` statement will delete all rows in the table.

The `DELETE` statement returns the number of rows deleted. It returns zero if the `DELETE` statement did not delete any row.

To return the deleted row(s) to the client, you use the `RETURNING` clause as follows:

```sql
DELETE FROM table_name
WHERE condition
RETURNING (select_list | *)
```

The asterisk (`*`) allows you to return all columns of the deleted row(s). If you want to return the values in a specific column, you can also specify them after the `RETURNING` keyword.

For example, the following statement deletes rows from a table and returns the values of the id of the deleted rows:

```sql
DELETE FROM table_name
WHERE condition
RETURNING id;
```

If you delete data from a table based on data from another table, you can use the [DELETE JOIN](postgresql-delete-join) statement.

To delete data that have a [foreign key](postgresql-foreign-key) relationship, you use the `ON DELETE CASCADE` option.

Note that the `DELETE` statement removes data from a table but doesn’t modify the structure of the table. If you want to change the structure of a table such as removing a column, you should use the [`ALTER TABLE`](postgresql-alter-table) statement instead.

## PostgreSQL DELETE statement examples

Let’s explore some examples of using the `DELETE` statement.

### Setting up a sample table

The following statements [create a new table](postgresql-create-table) called `todos` and [insert some sample data](postgresql-insert):

```sql
CREATE TABLE todos (
    id SERIAL PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    completed BOOLEAN NOT NULL DEFAULT false
);

INSERT INTO todos (title, completed) VALUES
    ('Learn basic SQL syntax', true),
    ('Practice writing SELECT queries', false),
    ('Study PostgreSQL data types', true),
    ('Create and modify tables', false),
    ('Explore advanced SQL concepts', true),
    ('Understand indexes and optimization', false),
    ('Backup and restore databases', true),
    ('Implement transactions', false),
    ('Master PostgreSQL security features', true),
    ('Build a sample application with PostgreSQL', false);

SELECT * FROM todos;
```

Output:

```text
 id |                   title                    | completed
----+--------------------------------------------+-----------
  1 | Learn basic SQL syntax                     | t
  2 | Practice writing SELECT queries            | f
  3 | Study PostgreSQL data types                | t
  4 | Create and modify tables                   | f
  5 | Explore advanced SQL concepts              | t
  6 | Understand indexes and optimization        | f
  7 | Backup and restore databases               | t
  8 | Implement transactions                     | f
  9 | Master PostgreSQL security features        | t
 10 | Build a sample application with PostgreSQL | f
(10 rows)
```

### 1\) Using PostgreSQL DELETE to delete one row from the table

The following statement uses the `DELETE` statement to delete one row with the id 1 from the `todos` table:

```sql
DELETE FROM todos
WHERE id = 1;
```

The statement returns 1 indicating that one row has been deleted:

```sql
DELETE 1
```

The following statement uses the `DELETE` statement to delete the row with id 100:

```shell
DELETE FROM todos
WHERE id = 100;
```

Since the row with the id 100 does not exist, the `DELETE` statement returns 0:

```sql
DELETE 0
```

### 2\) Using PostgreSQL DELETE to delete a row and return the deleted row

The following statement uses the `DELETE` statement to delete the row with id 2 and return the deleted row to the client:

```
DELETE FROM todos
WHERE id = 2
RETURNING *;
```

PostgreSQL returns the following deleted row:

```text
 id |              title              | completed
----+---------------------------------+-----------
  2 | Practice writing SELECT queries | f
(1 row)
```

### 3\) Using PostgreSQL DELETE to delete multiple rows from the table

The following statement uses the `DELETE` statement to delete all rows from the `todos` table with the value in the value in the completed column `true` and return deleted rows:

```
DELETE FROM todos
WHERE completed = true
RETURNING *;
```

Output:

```text
 id |                title                | completed
----+-------------------------------------+-----------
  3 | Study PostgreSQL data types         | t
  5 | Explore advanced SQL concepts       | t
  7 | Backup and restore databases        | t
  9 | Master PostgreSQL security features | t
(4 rows)


DELETE 4
```

It deleted four rows from the `todos` table.

### 4\) Using PostgreSQL DELETE to delete all rows from the table

The following statement uses the `DELETE` statement without a `WHERE` clause to delete all rows from the `todos` table:

```
DELETE FROM todos;
```

Output:

```
DELETE 4
```

The `todos` table now is empty.

## Summary

- Use the `DELETE FROM` statement to delete one or more rows from a table.
- Use the `WHERE` clause to specify which rows to be deleted.
- Use the `RETURNING` clause to return the deleted rows.


# DELETE Join

---
title: 'PostgreSQL DELETE JOIN'
page_title: 'PostgreSQL DELETE JOIN - How to Emulate it Correctly'
page_description: 'This tutorial shows you how to emulate the PostgreSQL DELETE JOIN by utilizing the DELETE USING statement or a subquery.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-delete-join/'
ogImage: ''
updatedOn: '2024-01-23T06:55:56+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL DELETE'
  slug: 'postgresql-tutorial/postgresql-delete'
nextLink:
  title: 'PostgreSQL UPSERT using INSERT ON CONFLICT Statement'
  slug: 'postgresql-tutorial/postgresql-upsert'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `DELETE` statement to emulate delete join operations.

## Introduction to PostgreSQL DELETE statement with USING clause

PostgreSQL does not support the [DELETE JOIN statement like MySQL](https://www.mysqltutorial.org/mysql-basics/mysql-delete-join/). Instead, it offers the `USING` clause in the [`DELETE`](postgresql-delete) statement that provides similar functionality to the `DELETE JOIN`.

Here’s the syntax of the `DELETE USING` statement:

```shellsql
DELETE FROM table1
USING table2
WHERE condition
RETURNING returning_columns;
```

In this syntax:

- First, specify the name of the table (`table1`) from which you want to delete data after the `DELETE FROM` keywords
- Second, provide a table (`table2`) to join with the main table after the `USING` keyword.
- Third, define a condition in the `WHERE` clause for joining two tables.
- Finally, return the deleted rows in the `RETURNING` clause. The `RETURNING` clause is optional.

For example, the following statement uses the `DELETE` statement with the `USING` clause to delete data from `t1` that has the same id as `t2`:

```sql
DELETE FROM t1
USING t2
WHERE t1.id = t2.id
```

## PostgreSQL DELETE JOIN examples

Let’s explore some examples of using the `DELETE USING` statement.

### Setting up sample tables

The following statements create `member` and `denylist` tables and insert some sample data into them:

```
CREATE TABLE member(
   id SERIAL PRIMARY KEY,
   first_name VARCHAR(50) NOT NULL,
   last_name VARCHAR(50) NOT NULL,
   phone VARCHAR(15) NOT NULL
);


CREATE TABLE denylist(
    phone VARCHAR(15) PRIMARY KEY
);


INSERT INTO member(first_name, last_name, phone)
VALUES ('John','Doe','(408)-523-9874'),
       ('Jane','Doe','(408)-511-9876'),
       ('Lily','Bush','(408)-124-9221');


INSERT INTO denylist(phone)
VALUES ('(408)-523-9874'),
       ('(408)-511-9876');

SELECT * FROM member;

SELECT * FROM denylist;
```

The member table:

```text
 id | first_name | last_name |     phone
----+------------+-----------+----------------
  1 | John       | Doe       | (408)-523-9874
  2 | Jane       | Doe       | (408)-511-9876
  3 | Lily       | Bush      | (408)-124-9221
(3 rows)
```

The denylist table:

```
     phone
----------------
 (408)-523-9874
 (408)-511-9876
(2 rows)
```

### 1\) Basic PostgreSQL delete join example

The following statement deletes rows in the `members` table with the phone number exists in the `denylist` table:

```
DELETE FROM member
USING denylist
WHERE member.phone = denylist.phone;
```

Output:

```sql
DELETE 2
```

The output indicates that the `DELETE` statement has deleted two rows from the `member` table.

Verify the deletion by retrieving data from the `contacts` table:

```
SELECT * FROM member;
```

Output:

```text
 id | first_name | last_name |     phone
----+------------+-----------+----------------
  3 | Lily       | Bush      | (408)-124-9221
(1 row)
```

### 2\) Delete join using a subquery example

The `USING` clause is not a part of the SQL standard, meaning that it may not be available in other database systems.

If you intend to ensure compatibility with various database products, you should avoid using the `USING` clause in the `DELETE` statement. Instead, you may consider using a [subquery](postgresql-subquery).

The following statement uses the `DELETE` statement to delete all rows from the member table whose phones are in the `denylist` table:

```
DELETE FROM member
WHERE phone IN (
    SELECT
      phone
    FROM
      denylist
);
```

In this example:

- First, the subquery returns a list of phones from the `denylist` table.
- Second, the `DELETE` statement deletes rows in the member table whose values in the phone column are in the list of phones returned by the subquery.

## Summary

- Use the `DELETE USING` statement or a subquery to emulate the `DELETE JOIN` operation.


# Upsert

---
title: 'PostgreSQL UPSERT using INSERT ON CONFLICT Statement'
page_title: 'PostgreSQL UPSERT Statement'
page_description: 'This tutorial shows you how to use the PostgreSQL UPSERT to either update an existing row or insert a new row if it does not exist.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-upsert/'
ogImage: ''
updatedOn: '2024-03-27T06:05:16+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL DELETE JOIN'
  slug: 'postgresql-tutorial/postgresql-delete-join'
nextLink:
  title: 'PostgreSQL MERGE Statement'
  slug: 'postgresql-tutorial/postgresql-merge'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL upsert feature to insert a new row into a table if the row does not exist, or update an existing row if it already exists.

## Introduction to the PostgreSQL UPSERT Statement

Upsert is a combination of [update](postgresql-update) and [insert](postgresql-insert). The upsert allows you to update an existing row or insert a new one if it doesn’t exist.

PostgreSQL does not have the `UPSERT` statement but it supports the upsert operation via the `INSERT...ON CONFLICT` statement.

If you use PostgreSQL 15 or later, you can use the [MERGE](postgresql-merge) statement which is equivalent to the `UPSERT` statement.

Here’s the basic syntax of the `INSERT...ON CONFLICT` statement:

```sql
INSERT INTO table_name (column1, column2, ...)
VALUES (value1, value2, ...)
ON CONFLICT (conflict_column)
DO NOTHING | DO UPDATE SET column1 = value1, column2 = value2, ...;
```

In this syntax:

- `table_name`: This is the name of the table into which you want to insert data.
- `(column1, column2, ...)`: The list of columns you want to insert values into the table.
- `VALUES(value1, value2, ...)`: The values you want to insert into the specified columns `(column1, column2, ...)`.
- `ON CONFLICT (conflict_column):` This clause specifies the conflict target, which is the [unique constraint](postgresql-unique-constraint) or [unique index](../postgresql-indexes/postgresql-unique-index) that may cause a conflict.
- `DO NOTHING`: This instructs PostgreSQL to do nothing when a conflict occurs.
- `DO UPDATE`: This performs an update if a conflict occurs.
- `SET column = value1, column = value2, ...`: This list of the columns to be updated and their corresponding values in case of conflict.

How the `INSERT ... ON CONFLICT` statement works.

First, the `ON CONFLICT` clause identifies the conflict target which is usually a unique constraint (or a unique index). If the data that you insert violates the constraint, a conflict occurs.

Second, the `DO UPDATE` instructs PostgreSQL to update existing rows or do nothing rather than aborting the entire operation when a conflict occurs.

Third, the `SET` clause defines the columns and values to update. You can use new values or reference the values you attempted to insert using the `EXCLUDED` keyword.

## PostgreSQL UPSERT examples

The following statements create the `inventory` table and [insert data into it](postgresql-insert):

```sql
CREATE TABLE inventory(
   id INT PRIMARY KEY,
   name VARCHAR(255) NOT NULL,
   price DECIMAL(10,2) NOT NULL,
   quantity INT NOT NULL
);

INSERT INTO inventory(id, name, price, quantity)
VALUES
	(1, 'A', 15.99, 100),
	(2, 'B', 25.49, 50),
	(3, 'C', 19.95, 75)
RETURNING *;
```

Output:

```text
 id | name | price | quantity
----+------+-------+----------
  1 | A    | 15.99 |      100
  2 | B    | 25.49 |       50
  3 | C    | 19.95 |       75
(3 rows)


INSERT 0 3
```

The `inventory` table contains information about various products, including their names, prices, and quantities in stock.

Suppose you’ve received an updated list of products with new prices, and now you need to update the inventory accordingly.

In this case, the upsert operation can be handy to handle the following situations:

- **Updating existing products**. If a product already exists in the `inventory` table, you want to update its price and quantity with the new information.
- **Insert new products**. If a product is not in the `inventory` table, you want to insert it into the table.

### 1\) Basic PostgreSQL INSERT … ON CONFLICT statement example

The following example uses the `INSERT ... ON CONFLICT` statement to insert a new row into the `inventory` table:

```
INSERT INTO inventory (id, name, price, quantity)
VALUES (1, 'A', 16.99, 120)
ON CONFLICT(id)
DO UPDATE SET
  price = EXCLUDED.price,
  quantity = EXCLUDED.quantity;
```

Output:

```sql
INSERT 0 1
```

In this example, we attempt to insert a new row into the `inventory` table.

However, the `inventory` table already has a row with id 1, therefore, a conflict occurs.

The `DO UPDATE` changes the price and quantity of the product to the new values being inserted. The `EXCLUDED` allows you to access the new values.

The following statement verifies the update:

```
SELECT * FROM inventory
WHERE id = 1;
```

Output:

```text
 id | name | price | quantity
----+------+-------+----------
  1 | A    | 16.99 |      120
(1 row)
```

### 2\) Inserting data example

The following example uses the `INSERT ... ON CONFLICT` statement to insert a new row into the `inventory` table:

```
INSERT INTO inventory (id, name, price, quantity)
VALUES (4, 'D', 29.99, 20)
ON CONFLICT(id)
DO UPDATE SET
  price = EXCLUDED.price,
  quantity = EXCLUDED.quantity;
```

Output:

```sql
INSERT 0 1
```

In this case, the statement [inserts a new row](../postgresql-python/insert) into the `inventory` table because the product id 4 does not exist in the `inventory` table.

The following statement verifies the insert:

```
SELECT * FROM inventory
ORDER BY id;
```

Output:

```
 id | name | price | quantity
----+------+-------+----------
  1 | A    | 16.99 |      120
  2 | B    | 25.49 |       50
  3 | C    | 19.95 |       75
  4 | D    | 29.99 |       20
(4 rows)
```

## Summary

- Use the PostgreSQL upsert to update data if it already exists or insert the data if it does not.
- Use the `INSERT...ON CONFLICT` statement for upsert.


# MERGE

---
title: 'PostgreSQL MERGE Statement'
page_title: 'PostgreSQL MERGE Statement'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL MERGE statement to conditionally insert, update, and delete rows of a table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-merge/'
ogImage: ''
updatedOn: '2024-03-27T06:10:50+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL UPSERT using INSERT ON CONFLICT Statement'
  slug: 'postgresql-tutorial/postgresql-upsert'
nextLink:
  title: 'PostgreSQL Transaction'
  slug: 'postgresql-tutorial/postgresql-transaction'
tag: new
---

**Summary**: In this tutorial, you will learn how to use the PostgreSQL `MERGE` statement to conditionally insert, update, and delete rows of a table.

## Introduction to the PostgreSQL MERGE statement

Have you ever needed to update a table but weren't sure whether to insert new records or update existing ones? PostgreSQL's `MERGE` command solves this common problem. Think of `MERGE` as a smart helper that can look at your data and decide whether to add new records, update existing ones, or even delete records, all in a single command.

## Basic Concepts

Before we dive into `MERGE`, let's understand some basic terms:

- **Target Table**: The table you want to modify
- **Source Table**: The table containing your new or updated data
- **Match Condition**: The rule that determines if records match between your tables

## Basic MERGE Syntax

Here's the basic structure of a `MERGE` command:

```sql
MERGE INTO target_table
USING source_table
ON match_condition
WHEN MATCHED AND condition THEN
    UPDATE SET column1 = value1, column2 = value2
WHEN MATCHED AND NOT condition THEN
    DELETE
WHEN NOT MATCHED THEN
    INSERT (column1, column2) VALUES (value1, value2)
RETURNING merge_action(), target_table.*;
```

This `MERGE` statement performs three conditional actions on `target_table` based on rows from `source_table`:

1. **Update rows**: If a match is found (`ON match_condition`) and `condition` is true, it updates `column1` and `column2` in `target_table`.
2. **Delete rows**: If a match is found but `condition` is false, it deletes the matching rows in `target_table`.
3. **Insert rows**: If no match is found, it inserts new rows into `target_table` using values from `source_table`.
4. The `RETURNING` clause provides details of the operation (`merge_action()`) and the affected rows.

## Key Features in PostgreSQL 17

The new RETURNING clause support in PostgreSQL 17 offers several advantages:

1. **Action Tracking**: The `merge_action()` function tells you exactly what happened to each row
2. **Complete Row Access**: You can return both old and new values for affected rows
3. **Immediate Feedback**: No need for separate queries to verify the results

## Setting Up Our Example

Let's create a sample database tracking a company's products and their inventory status:

```sql
-- Create the main products table
CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    name TEXT UNIQUE,
    price DECIMAL(10,2),
    stock INTEGER,
    status TEXT,
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Insert some initial data
INSERT INTO products (name, price, stock, status) VALUES
    ('Laptop', 999.99, 50, 'active'),
    ('Keyboard', 79.99, 100, 'active'),
    ('Mouse', 29.99, 200, 'active');

-- Create a table for our updates
CREATE TABLE product_updates (
    name TEXT,
    price DECIMAL(10,2),
    stock INTEGER,
    status TEXT
);

-- Insert mixed update data (new products, updates, and discontinuations)
INSERT INTO product_updates VALUES
    ('Laptop', 1099.99, 75, 'active'),      -- Update: price and stock change
    ('Monitor', 299.99, 30, 'active'),      -- Insert: new product
    ('Keyboard', NULL, 0, 'discontinued'),  -- Delete: mark as discontinued
    ('Headphones', 89.99, 50, 'active');    -- Insert: another new product
```

## Using MERGE with RETURNING

Now let's see how PostgreSQL 17's enhanced `MERGE` command can handle all three operations (`INSERT`, `UPDATE`, `DELETE`) while providing detailed feedback through the RETURNING clause:

```sql
MERGE INTO products p
USING product_updates u
ON p.name = u.name
WHEN MATCHED AND u.status = 'discontinued' THEN
    DELETE
WHEN MATCHED AND u.status = 'active' THEN
    UPDATE SET
        price = COALESCE(u.price, p.price),
        stock = u.stock,
        status = u.status,
        last_updated = CURRENT_TIMESTAMP
WHEN NOT MATCHED AND u.status = 'active' THEN
    INSERT (name, price, stock, status)
    VALUES (u.name, u.price, u.stock, u.status)
RETURNING
    merge_action() as action,
    p.product_id,
    p.name,
    p.price,
    p.stock,
    p.status,
    p.last_updated;
```

## Understanding the Output

The `RETURNING` clause will provide detailed information about each operation:

```
 action  | product_id |    name    |  price   | stock |   status    |      last_updated
---------+------------+------------+----------+-------+-------------+------------------------
 UPDATE  |     1      | Laptop     | 1099.99  |   75  | active      | 2024-12-04 17:41:58.226807
 INSERT  |     4      | Monitor    |  299.99  |   30  | active      | 2024-12-04 17:41:58.226807
 DELETE  |     2      | Keyboard   |   79.99  |  100  | active      | 2024-12-04 17:41:47.816064
 INSERT  |     5      | Headphones |   89.99  |   50  | active      | 2024-12-04 17:41:58.226807
```

Let's break down what happened:

1. **`UPDATE`**: The Laptop's price and stock were updated
2. **`DELETE`**: The Keyboard is deleted from the products table
3. **`INSERT`**: New Monitor and Headphones products were added

We can confirm the changes by querying the products table:

```sql
SELECT * FROM products
ORDER BY product_id;
```

```
 product_id |    name    |  price   | stock |   status    |      last_updated
------------+------------+----------+-------+-------------+------------------------
          1 | Laptop     | 1099.99  |   75  | active      | 2024-12-04 17:41:58.226807
          3 | Mouse      |   29.99  |  200  | active      | 2024-12-04 17:41:47.816064
          4 | Monitor    |  299.99  |   30  | active      | 2024-12-04 17:41:58.226807
          5 | Headphones |   89.99  |   50  | active      | 2024-12-04 17:41:58.226807
```

## Advanced Usage with Conditions

You can add more complex conditions to your `MERGE` statement:

```sql
MERGE INTO products p
USING (
    SELECT
        name,
        price,
        stock,
        status,
        CASE
            WHEN price IS NULL AND status = 'discontinued' THEN 'DELETE'
            WHEN stock = 0 THEN 'OUT_OF_STOCK'
            ELSE status
        END as action_type
    FROM product_updates
) u
ON p.name = u.name
WHEN MATCHED AND u.action_type = 'DELETE' THEN
    DELETE
WHEN MATCHED AND u.action_type = 'OUT_OF_STOCK' THEN
    UPDATE SET
        status = 'inactive',
        stock = 0,
        last_updated = CURRENT_TIMESTAMP
WHEN MATCHED THEN
    UPDATE SET
        price = COALESCE(u.price, p.price),
        stock = u.stock,
        status = u.status,
        last_updated = CURRENT_TIMESTAMP
WHEN NOT MATCHED AND u.action_type != 'DELETE' THEN
    INSERT (name, price, stock, status)
    VALUES (u.name, u.price, u.stock, u.status)
RETURNING
    merge_action() as action,
    p.*,
    u.action_type;
```

## Best Practices

1. **Handle Source Data Carefully**:

   - Validate input data before the `MERGE`
   - Use subqueries to transform or clean data
   - Consider using CTEs for complex data preparation

2. **Leverage RETURNING for Validation**:
   - Include the `merge_action()` for operation tracking
   - Consider returning both old and new values for logging purposes and validation

## Common Pitfalls to Avoid

1. **Ambiguous Matches**: Ensure your `ON` clause creates unique matches
2. **NULL Handling**: Use `COALESCE` or `IS NOT DISTINCT FROM` for `NULL` values
3. **Missing Conditions**: Always handle all possible cases in your `WHEN` clauses

## Conclusion

PostgreSQL 17's enhanced `MERGE` command with `RETURNING` clause support provides a powerful tool for data synchronization and maintenance. The ability to perform multiple operations in a single statement while getting immediate feedback makes it an invaluable feature for modern applications.


# Transactions

# PostgreSQL Transaction

---
title: 'PostgreSQL Transaction'
page_title: 'PostgreSQL Transaction'
page_description: 'This tutorial shows you how to manage PostgreSQL transactions using the BEGIN, COMMIT, and ROLLBACK statements.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-transaction/'
ogImage: '/postgresqltutorial/PostgreSQL-Transaction-from-current-transaction.png'
updatedOn: '2024-02-13T15:07:37+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL MERGE Statement'
  slug: 'postgresql-tutorial/postgresql-merge'
nextLink:
  title: 'Import CSV File Into PostgreSQL Table'
  slug: 'postgresql-tutorial/import-csv-file-into-posgresql-table'
---

**Summary**: in this tutorial, you will learn how to handle PostgreSQL transactions using the `BEGIN`, `COMMIT`, and `ROLLBACK` statements.

## What is a database transaction?

A database transaction is a single unit of work that consists of one or more operations.

A classical example of a transaction is a bank transfer from one account to another. A complete transaction must ensure a balance between the sender and receiver accounts.

This implies that if the sender account transfers X amount, the receiver receives exactly X amount, neither more nor less.

A PostgreSQL transaction is atomic, consistent, isolated, and durable. These properties are often referred to collectively as ACID:

- **Atomicity** guarantees that the transaction is completed in an all\-or\-nothing manner.
- **Consistency** ensures that changes to data written to the database are valid and adhere to predefined rules.
- **Isolation** determines how the integrity of a transaction is visible to other transactions.
- **Durability** ensures that transactions that have been committed are permanently stored in the database.

## Setting up a sample table

Let’s [create a new table](postgresql-create-table) called `accounts` for the demonstration:

```sql
DROP TABLE IF EXISTS accounts;

CREATE TABLE accounts (
    id INT GENERATED BY DEFAULT AS IDENTITY,
    name VARCHAR(100) NOT NULL,
    balance DEC(15,2) NOT NULL CHECK(balance >= 0),
    PRIMARY KEY(id)
);
```

## Begin a transaction

When you execute a statement, PostgreSQL implicitly wraps it in a transaction.

For example, when you execute the following [`INSERT`](postgresql-insert) statement, PostgreSQL immediately inserts a new row into the `accounts` table:

```sql
INSERT INTO accounts(name,balance)
VALUES('Bob',10000);
```

To start a transaction explicitly, you execute either one of the following statements:

```sql
BEGIN TRANSACTION;
```

Or

```sql
BEGIN WORK;
```

Or

```sql
BEGIN;
```

For example, the following statements start a new transaction and insert a new account into the `accounts` table:

```sql
BEGIN;

INSERT INTO accounts(name,balance)
VALUES('Alice',10000);
```

From the current session, you can see the change by retrieving data from the `accounts` table:

```sql
SELECT
    id,
    name,
    balance
FROM
    accounts;
```

![PostgreSQL Transaction - from current session](/postgresqltutorial/PostgreSQL-Transaction-from-current-transaction.png)
However, you will not see the change if you connect to the PostgreSQL server in a new session and execute the query above:

```sql
SELECT
    id,
    name,
    balance
FROM
    accounts;
```

![PostgreSQL Transaction - from another session](/postgresqltutorial/PostgreSQL-Transaction-from-another-transaction.png)

## Commit a transaction

To permanently apply the change to the database, you commit the transaction by using the `COMMIT WORK` statement:

```sql
COMMIT WORK;
```

or

```sql
COMMIT TRANSACTION;
```

or simply:

```sql
COMMIT;
```

Other sessions can view the change by retrieving data from the `accounts` table:

```sql
SELECT
    id,
    name,
    balance
FROM
    accounts;
```

![PostgreSQL Transaction - commit](/postgresqltutorial/PostgreSQL-Transaction-from-current-transaction.png)
After executing the `COMMIT` statement, PostgreSQL guarantees that the change will be durable if a crash happens.

Put it all together.

```sql
-- start a transaction
BEGIN;

-- insert a new row into the accounts table
INSERT INTO accounts(name,balance)
VALUES('Alice',10000);

-- commit the change (or roll it back later)
COMMIT;
```

## Roll back a transaction

If you want to undo the changes to the database, you can use the ROLLBACK statement:

```
ROLLBACK;
```

Or more clear:

```
ROLLBACK TRANSACTION;
```

Or:

```
ROLLBACK WORK;
```

The `ROLLBACK` statement undos the changes that you made within the transaction.

For example, the following example uses the `ROLLBACK` statement to roll back the changes made to the account 1:

```
-- start a transaction
BEGIN;

UPDATE accounts
SET balance = balance - 1000
WHERE id =  1;

-- rollback the changes
ROLLBACK;
```

If you retrieve data from the accounts table, you’ll won’t see the changes because it was rolled back.

```
SELECT * FROM accounts;
```

Output:

```
 id | name  | balance
----+-------+----------
  1 | Bob   | 10000.00
  2 | Alice | 10000.00
(2 rows)
```

In practice, you’ll use transactions in [stored procedures](../postgresql-plpgsql/postgresql-create-procedure) in PostgreSQL and in the application code such as [PHP](../postgresql-php/transaction), [Java](../postgresql-jdbc/transaction), and [Python](../postgresql-python/transaction).

## Summary

- Use the `BEGIN` statement to explicitly start a transaction
- Use the `COMMIT` statement to apply the changes permanently to the database.
- Use the `ROLLBACK` statement to undo the changes made to the database during the transaction.


# Import / Export

# Import CSV File into Table

---
title: 'Import CSV File Into PostgreSQL Table'
page_title: 'Import CSV File Into PosgreSQL Table'
page_description: 'In this tutorial, you will learn how to to import a CSV file into a PosgreSQL table using the COPY command or pgAdmin client tool.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/import-csv-file-into-posgresql-table/'
ogImage: '/postgresqltutorial/posgresql-import-csv.jpg'
updatedOn: '2024-02-01T14:45:15+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Transaction'
  slug: 'postgresql-tutorial/postgresql-transaction'
nextLink:
  title: 'Export PostgreSQL Table to CSV File'
  slug: 'postgresql-tutorial/export-postgresql-table-to-csv-file'
---

**Summary**: in this tutorial, we will show you various ways to import a CSV file into a PostgreSQL table.

First, [create a new table](postgresql-create-table) named `persons` with the following columns:

- `id`: the person id
- `first_name`: first name
- `last_name:` last name
- `dob` date of birth
- `email`: the email address

```shellsql
CREATE TABLE persons (
  id SERIAL,
  first_name VARCHAR(50),
  last_name VARCHAR(50),
  dob DATE,
  email VARCHAR(255),
  PRIMARY KEY (id)
);
```

![posgresql import csv](/postgresqltutorial/posgresql-import-csv.jpg)
Second, prepare a CSV data file with the following format:

![csv data](/postgresqltutorial/csv-data.jpg)
![csv file](/postgresqltutorial/csv-file.jpg)The path of the CSV file is as follows: `C:\sampledb\persons.csv`

[Download the persons.csv file](/postgresqltutorial/persons.csv)

## Import a CSV file into a table using COPY statement

To import this CSV file into the `persons` table, you use `COPY` statement as follows:

```sql
COPY persons(first_name, last_name, dob, email)
FROM 'C:\sampledb\persons.csv'
DELIMITER ','
CSV HEADER;
```

PostgreSQL gives back the following message:

```sql
COPY 2
```

It means that two rows have been copied. Let’s check the `persons` table.

```
SELECT * FROM persons;
```

![](/postgresqltutorial/PostgreSQL-Import-CSV.png)
It works as expected.

Let’s dive into the COPY statement in more detail.

First, you specify the table with column names after the `COPY` keyword. The order of the columns must be the same as the ones in the CSV file. In case the CSV file contains all columns of the table, you don’t need to specify them explicitly, for example:

```sql
COPY sample_table_name
FROM 'C:\sampledb\sample_data.csv'
DELIMITER ','
CSV HEADER;
```

Second, you put the CSV file path after the `FROM` keyword. Because CSV file format is used, you need to specify `DELIMITER` as well as `CSV` clauses.

Third, specify the `HEADER` keyword to indicate that the CSV file contains a header. When the `COPY` command imports data, it ignores the header of the file.

Notice that the file must be read directly by the PostgreSQL server, not by the client application. Therefore, it must be accessible by the PostgreSQL server machine. Also, you need to have superuser access to execute the `COPY` statement successfully.

## Import CSV file into a table using pgAdmin

In case you need to import a CSV file from your computer into a table on the PostgreSQL database server, you can use the pgAdmin.

The following statement [truncates](postgresql-truncate-table) the `persons` table so that you can re\-import the data.

```sql
TRUNCATE TABLE persons
RESTART IDENTITY;
```

First, right\-click the `persons` table and select the **Import/Export…** menu item:

![](/postgresqltutorial/PostgreSQL-Import-CSV-pgAdmin-Step-1.png)
Second, (1\) switch to import, (2\) browse to the import file, (3\) select the format as CSV, (4\) select the delimiter as comma (`,`):

![](/postgresqltutorial/PostgreSQL-Import-CSV-pgAdmin-Step-2.png)
Third, click the columns tab, uncheck the id column, and click the OK button:

![](/postgresqltutorial/PostgreSQL-Import-CSV-pgAdmin-Step-3.png)
Finally, wait for the import process to complete. The following shows the dialog that informs you of the progress of the import:

![](/postgresqltutorial/PostgreSQL-Import-CSV-pgAdmin-Step-4.png)
In this tutorial, you have learned how to import data from a CSV file into a table on the PostgreSQL database server using the `COPY` statement and pgAdmin tool.


# Export Table to CSV File

---
title: 'Export PostgreSQL Table to CSV File'
page_title: 'Export a PostgreSQL Table to a CSV File'
page_description: 'In this tutorial, you will learn various techniques to export data from PostgreSQL tables to CSV files.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/export-postgresql-table-to-csv-file/'
ogImage: '/postgresqltutorial/posgresql-import-csv.jpg'
updatedOn: '2024-02-01T14:54:49+00:00'
enableTableOfContents: true
previousLink:
  title: 'Import CSV File Into PostgreSQL Table'
  slug: 'postgresql-tutorial/import-csv-file-into-posgresql-table'
nextLink:
  title: 'PostgreSQL Data Types'
  slug: 'postgresql-tutorial/postgresql-data-types'
---

**Summary**: in this tutorial, you will learn various techniques to export data from PostgreSQL tables to CSV files.

In the previous tutorial, we showed you how to [import data from a CSV file into a table](import-csv-file-into-posgresql-table). We will use the same `persons` table for importing data from a CSV file.

![posgresql export csv](/postgresqltutorial/posgresql-import-csv.jpg)
The following statement retrieves the data from the `persons` table.

```sql
SELECT * FROM persons;
```

Output:

```text
 id | first_name | last_name |    dob     |              email
----+------------+-----------+------------+---------------------------------
  1 | John       | Doe       | 1995-01-05 | [[email protected]](../cdn-cgi/l/email-protection.html)
  2 | Jane       | Doe       | 1995-02-05 | [[email protected]](../cdn-cgi/l/email-protection.html)
(2 rows)
```

## Export data from a table to CSV using the COPY statement

The `COPY` statement allows you to export data from a table to a CSV file.

For example, if you want to export the data of the `persons` table to a CSV file named `persons_db.csv` in the `C:\temp` folder, you can use the following statement:

```
COPY persons TO 'C:\temp\persons_db.csv' DELIMITER ',' CSV HEADER;
```

Output:

```sql
COPY 2
```

The output indicates that the command exported two rows.

In this example, the COPY statement exports all data from all columns of the `persons` table to the `persons_db.csv` file.

![postgresql export csv](/postgresqltutorial/postgresql-export-csv.jpg)Sometimes, you may want to export data from some columns of a table to a CSV file. To achieve this, you can specify the column names together with the table name after `COPY` keyword.

For example, the following statement exports data from the `first_name`, `last_name`, and `email`  columns of the `persons` table to `person_partial_db.csv`

```
COPY persons(first_name,last_name,email)
TO 'C:\temp\persons_partial_db.csv' DELIMITER ',' CSV HEADER;
```

![postgresql export csv partially](/postgresqltutorial/postgresql-export-csv-partially.jpg)
If you don’t want to export the header, which contains the column names of the table, you can remove the `HEADER` flag in the `COPY` statement.

For example, the following statement exports only data from the `email` column of the `persons` table to a CSV file:

```sql
COPY persons(email)
TO 'C:\temp\persons_email_db.csv' DELIMITER ',' CSV;
```

![postgresql export csv partially without header](/postgresqltutorial/postgresql-export-csv-partially-without-header.jpg)
Notice that the CSV file name that you specify in the `COPY` command must be written directly by the server.

It means that the CSV file must reside on the database server machine, not your local machine. The CSV file also needs to be writable by the user that the PostgreSQL server runs as.

## Export data from a table to a CSV file using the \\copy command

If you have access to a remote PostgreSQL database server, but you don’t have sufficient privileges to write to a file on it, you can use the PostgreSQL built\-in command `\copy`.

The `\copy` command runs the `COPY` statement behind the scenes. However, instead of the server writing the CSV file, psql writes the CSV file and transfers data from the server to your local file system.

To use `\copy` command, you need to have sufficient privileges to your local machine. It does not require PostgreSQL superuser privileges.

For example, if you want to export all data from the `persons` table into `persons_client.csv` file, you can execute the `\copy` command from the psql client as follows:

```text
\copy (SELECT * FROM persons) to 'C:\temp\persons_client.csv' with csv
```

In this tutorial, we have shown you how to use `COPY` statement and `\copy` command to export data from a table to CSV files.


# Subquery

# Subquery

---
title: 'PostgreSQL Subquery'
page_title: 'PostgreSQL Subquery'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL subquery that allows you to construct complex queries.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-subquery/'
ogImage: ''
updatedOn: '2024-07-01T01:04:57+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CUBE'
  slug: 'postgresql-tutorial/postgresql-cube'
nextLink:
  title: 'PostgreSQL Correlated Subquery'
  slug: 'postgresql-tutorial/postgresql-correlated-subquery'
---

**Summary**: in this tutorial, you will learn how to use the **PostgreSQL subquery** that allows you to construct complex queries.

## Introduction to PostgreSQL subquery

A subquery is a [query](postgresql-select) nested within another query. A subquery is also known as an inner query or nested query.

A subquery can be useful for retrieving data that will be used by the main query as a condition for further data selection.

The basic syntax of the subquery is as follows:

```sql
SELECT
  select_list
FROM
  table1
WHERE
  columnA operator (
    SELECT
      columnB
    FROM
      table2
    WHERE
      condition
  );
```

In this syntax, the subquery is enclosed within parentheses and is executed first:

```sql
SELECT
  columnB
FROM
  table2
WHERE
  condition
```

The main query will use the result of the subquery to filter data in the [`WHERE`](postgresql-where) clause.

## PostgreSQL subquery examples

Let’s take some examples of using subqueries.

### 1\) Basic PostgreSQL subquery example

First, retrieve the country id of the `United States` from the `country` table:

```sql
SELECT
  country_id
FROM
  country
WHERE
  country = 'United States';
```

It returns the following output:

```text
 country_id
------------
        103
(1 row)
```

Second, retrieve cities from the `city` table where `country_id` is `103`:

```
SELECT
  city
FROM
  city
WHERE
  country_id = 103
ORDER BY
  city;
```

Output:

```text
         city
-------------------------
 Akron
 Arlington
 Augusta-Richmond County
 Aurora
 Bellevue
 Brockton
 Cape Coral
 Citrus Heights
...
```

Instead of executing two queries, you can combine them into one, making the first query as a subquery and the second query as the main query as follows:

```
SELECT
  city
FROM
  city
WHERE
  country_id = (
    SELECT
      country_id
    FROM
      country
    WHERE
      country = 'United States'
  )
ORDER BY
  city;
```

In this query, the following is the subquery:

```sql
SELECT
  country_id
FROM
  country
WHERE
  country = 'United States';
```

PostgreSQL executes the subquery first to get the country id and uses it for the `WHERE` clause to retrieve the cities.

### 2\) Using a subquery with the IN operator

A subquery can return zero or more rows. If the query returns more than one row, you can use it with the [IN](postgresql-in 'PostgreSQL IN') operator. For example:

First, retrieve `film_id` of the film with the category `Action`:

```sql
SELECT
  film_id
FROM
  film_category
  INNER JOIN category USING(category_id)
WHERE
  name = 'Action';
```

Output:

```text
 film_id
---------
      19
      21
      29
      38
      56
...
```

Second, use the query above as a subquery to retrieve the film title from the `film` table:

```
SELECT
  film_id,
  title
FROM
  film
WHERE
  film_id IN (
    SELECT
      film_id
    FROM
      film_category
      INNER JOIN category USING(category_id)
    WHERE
      name = 'Action'
  )
ORDER BY
  film_id;
```

Output:

```
film_id |          title
---------+-------------------------
      19 | Amadeus Holy
      21 | American Circus
      29 | Antitrust Tomatoes
      38 | Ark Ridgemont
      56 | Barefoot Manchurian
...
```

## Summary

- A subquery is a query nested inside another query
- A subquery is also known as an inner query or nested query.


# Correlated Subquery

---
title: 'PostgreSQL Correlated Subquery'
page_title: 'PostgreSQL Correlated Subquery'
page_description: 'How to use the PostgreSQL correlated subquery to perform a query that depends on the values of the current row being processed.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-correlated-subquery/'
ogImage: '/postgresqltutorial/film.png'
updatedOn: '2024-01-22T03:48:45+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Subquery'
  slug: 'postgresql-tutorial/postgresql-subquery'
nextLink:
  title: 'PostgreSQL ANY Operator'
  slug: 'postgresql-tutorial/postgresql-any'
---

**Summary**: in this tutorial, you will learn about PostgreSQL correlated subquery to perform a query that depends on the values of the current row being processed.

## Introduction to PostgreSQL correlated subquery

In PostgreSQL, a correlated subquery is a [subquery](postgresql-subquery) that references the columns from the outer query.

Unlike a regular subquery, PostgreSQL evaluates the correlated subquery once for each row processed by the outer query.

Since PostgreSQL reevaluates the correlated subquery for every row in the outer query, this may lead to performance issues, especially when dealing with large datasets.

A correlated subquery can be useful when you need to perform a query that depends on the values of the current being processed.

## PostgreSQL correlated subquery example

We’ll use the `film` table from the [sample database](../postgresql-getting-started/postgresql-sample-database) for the demonstration:

![](/postgresqltutorial/film.png)The following example uses a correlated subquery to find the films with higher lengths than average for their respective ratings:

```sql
SELECT film_id, title, length, rating
FROM film f
WHERE length > (
    SELECT AVG(length)
    FROM film
    WHERE rating = f.rating
);
```

Output:

```text
 film_id |            title            | length | rating
---------+-----------------------------+--------+--------
     133 | Chamber Italian             |    117 | NC-17
       4 | Affair Prejudice            |    117 | G
       5 | African Egg                 |    130 | G
       6 | Agent Truman                |    169 | PG
...
```

How it works.

The outer query retrieves id, title, length, and rating from the `film` table that has the alias `f`:

```
SELECT film_id, title, length, rating
FROM film f
WHERE length > (...)
```

For each row processed by the outer query, the correlated subquery calculates the average `length` of films that have the same `rating` as the current row (`f.rating`).

The [`WHERE`](postgresql-where) clause (`WHERE length > (...)`) checks if the length of the current film is greater than the average.

The correlated subquery calculates the [average](../postgresql-aggregate-functions/postgresql-avg-function) length for films with the same rating as the current row in the outer query:

```sql
SELECT AVG(length)
FROM film
WHERE rating = f.rating
```

The `WHERE` clause ensures that the correlated subquery considers only films with the same rating as the current row in the outer query. The condition `rating = f.rating` creates the correlation.

As a result, the outer query returns rows where the `length` of the film is greater than the average `length` for films with the same `rating`.

## Summary

- Use a correlated subquery to perform a query that depends on the values of the current row being processed.


# ANY Operator

---
title: 'PostgreSQL ANY Operator'
page_title: 'PostgreSQL ANY Operator'
page_description: 'This tutorial shows you how to use the PostgreSQL ANY operator to compare a value to a set of values returned by a subquery.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-any/'
ogImage: ''
updatedOn: '2024-04-24T06:18:58+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Correlated Subquery'
  slug: 'postgresql-tutorial/postgresql-correlated-subquery'
nextLink:
  title: 'PostgreSQL ALL Operator'
  slug: 'postgresql-tutorial/postgresql-all'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `ANY` operator to compare a scalar value with a set of values returned by a subquery.

## Introduction to PostgreSQL ANY operator

The PostgreSQL `ANY` operator compares a value with a set of values returned by a [subquery](postgresql-subquery). It is commonly used in combination with comparison operators such as \=, \<, \>, \<\=, \>\=, and \<\>.

Here’s the basic syntax of  the `ANY` operator:

```csssql
expression operator ANY(subquery)
```

In this syntax:

- `expression` is a value that you want to compare.
- `operator` is a comparison operator including \=, \<, \>, \<\=, \>\=, and \<\>.
- `subquery` is a subquery that returns a set of values to compare against. It must return exactly one column.

The `ANY` operator returns `true` if the comparison returns `true` for at least one of the values in the set, and `false` otherwise.

If the subquery returns an empty set, the result of `ANY` comparison is always `true`.

Besides the subquery, you can use any construct that returns a set of values such as an [`ARRAY`](postgresql-array).

Note that `SOME` is a synonym for `ANY`, which means that you can use them interchangeably.

## PostgreSQL ANY operator examples

Let’s take some examples of using the `ANY` operator.

### Setting up a sample table

First, create a table called `employees` and `managers`, and insert some data into it:

```sql
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    first_name VARCHAR(255) NOT NULL,
    last_name VARCHAR(255) NOT NULL,
    salary DECIMAL(10, 2) NOT NULL
);

CREATE TABLE managers(
    id SERIAL PRIMARY KEY,
    first_name VARCHAR(255) NOT NULL,
    last_name VARCHAR(255) NOT NULL,
    salary DECIMAL(10, 2) NOT NULL
);

INSERT INTO employees (first_name, last_name, salary)
VALUES
('Bob', 'Williams', 45000.00),
('Charlie', 'Davis', 55000.00),
('David', 'Jones', 50000.00),
('Emma', 'Brown', 48000.00),
('Frank', 'Miller', 52000.00),
('Grace', 'Wilson', 49000.00),
('Harry', 'Taylor', 53000.00),
('Ivy', 'Moore', 47000.00),
('Jack', 'Anderson', 56000.00),
('Kate', 'Hill',  44000.00),
('Liam', 'Clark', 59000.00),
('Mia', 'Parker', 42000.00);

INSERT INTO managers(first_name, last_name, salary)
VALUES
('John', 'Doe',  60000.00),
('Jane', 'Smith', 55000.00),
('Alice', 'Johnson',  58000.00);
```

Second, retrieve the data from the `employees` table:

```sql
SELECT * FROM employees;
```

Output:

```text
 id | first_name | last_name |  salary
----+------------+-----------+----------
  1 | Bob        | Williams  | 45000.00
  2 | Charlie    | Davis     | 55000.00
  3 | David      | Jones     | 50000.00
  4 | Emma       | Brown     | 48000.00
  5 | Frank      | Miller    | 52000.00
  6 | Grace      | Wilson    | 49000.00
  7 | Harry      | Taylor    | 53000.00
  8 | Ivy        | Moore     | 47000.00
  9 | Jack       | Anderson  | 56000.00
 10 | Kate       | Hill      | 44000.00
 11 | Liam       | Clark     | 59000.00
 12 | Mia        | Parker    | 42000.00
 13 | John       | Doe       | 60000.00
 14 | Jane       | Smith     | 55000.00
 15 | Alice      | Johnson   | 58000.00
(15 rows)
```

Third, retrieve the data from the `managers` table:

```
SELECT * FROM managers;
```

Output:

```text
 id | first_name | last_name |  type   |  salary
----+------------+-----------+---------+----------
  1 | John       | Doe       | manager | 60000.00
  2 | Jane       | Smith     | manager | 55000.00
  3 | Alice      | Johnson   | manager | 58000.00
(3 rows)
```

### 1\) Using ANY operator with the \= operator example

The following statement uses the ANY operator to find employees who have the salary the same as manager:

```
SELECT
  *
FROM
  employees
WHERE
  salary = ANY (
    SELECT
      salary
    FROM
      managers
  );

```

It returns one row:

```text
 id | first_name | last_name |  salary
----+------------+-----------+----------
  2 | Charlie    | Davis     | 55000.00
(1 row)
```

How it works.

First, execute the subquery in the `ANY` operator that returns the salary of managers:

```
SELECT salary FROM managers;
```

Output:

```text
  salary
----------
 60000.00
 55000.00
 58000.00
(3 rows)
```

Second, compare the salary of each row in the `employees` table with the values returned by the subquery and include the row that has a salary equal to the one in the set (`60K`, `55K`, and `58K`).

### 2\) Using ANY operator with \> operator example

The following example uses the `ANY` operator to find employees who have salaries greater than the manager’s salaries:

```
SELECT
  *
FROM
  employees
WHERE
  salary > ANY (
    SELECT
      salary
    FROM
      managers
  );
```

Output:

```text
 id | first_name | last_name |  salary
----+------------+-----------+----------
  9 | Jack       | Anderson  | 56000.00
 11 | Liam       | Clark     | 59000.00
(2 rows)
```

The output indicates that the two employees have a higher salary than the manager’s.

- Jack has a salary of 56K which is greater than 55K.
- Liam has a salary of 59K which is greater than 55K and 58K.

### 3\) Using ANY operator with \< operator example

The following example uses the `ANY` operator to find employees who have salaries less than the manager’s salaries:

```
SELECT
  *
FROM
  employees
WHERE
  salary < ANY (
    SELECT
      salary
    FROM
      employees
  );
```

Output:

```
 id | first_name | last_name |  salary
----+------------+-----------+----------
  1 | Bob        | Williams  | 45000.00
  2 | Charlie    | Davis     | 55000.00
  3 | David      | Jones     | 50000.00
  4 | Emma       | Brown     | 48000.00
  5 | Frank      | Miller    | 52000.00
  6 | Grace      | Wilson    | 49000.00
  7 | Harry      | Taylor    | 53000.00
  8 | Ivy        | Moore     | 47000.00
  9 | Jack       | Anderson  | 56000.00
 10 | Kate       | Hill      | 44000.00
 12 | Mia        | Parker    | 42000.00
(11 rows)

```

It returns all the rows with the `employee` type because they have a value in the `salary` column less than any value in the set (55K, 58K, and 60K).

## Summary

- Use the PostgreSQL `ANY` operator to compare a value to a set of values returned by a subquery.


# ALL Operator

---
title: 'PostgreSQL ALL Operator'
page_title: 'PostgreSQL ALL Operator'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL ALL operator to compare a value with a list of values returned by a subquery.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-all/'
ogImage: ''
updatedOn: '2024-07-01T01:08:50+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL ANY Operator'
  slug: 'postgresql-tutorial/postgresql-any'
nextLink:
  title: 'PostgreSQL EXISTS Operator'
  slug: 'postgresql-tutorial/postgresql-exists'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `ALL` operator to compare a value with a list of values returned by a subquery.

## Overview of the PostgreSQL ALL operator

The PostgreSQL `ALL` operator allows you to compare a value with all values in a set returned by a [subquery](postgresql-subquery).

Here’s the basic syntax of the `ALL` operator:

```sql
expression operator ALL(subquery)
```

In this syntax:

- The `ALL` operator must be preceded by a comparison operator such as equal (\=), not equal (\<\>), greater than (\>), greater than or equal to (\>\=), less than (\<), and less than or equal to (\<\=).
- The `ALL` operator must be followed by a subquery which also must be surrounded by the parentheses.

If the subquery returns a non\-empty result set, the `ALL` operator works as follows:

- `value > ALL (subquery)` returns true if the value is greater than the biggest value returned by the subquery.
- `value >= ALL (subquery)` returns true if the value is greater than or equal to the biggest value returned by the subquery.
- `value < ALL (subquery)` returns true if the value is less than the smallest value returned by the subquery.
- `value <= ALL (subquery)` returns true if the value is less than or equal to the smallest value returned by the subquery.
- `value = ALL (subquery)` returns true if the value equals every value returned by the subquery.
- `value != ALL (subquery)` returns true if the value does not equal any value returned by the subquery.

If the subquery returns no row, then the `ALL` operator always evaluates to true.

## PostgreSQL ALL operator examples

Let’s explore some examples of using the PostgreSQL `ALL` operator.

### Setting up a sample table

```sql
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    first_name VARCHAR(255) NOT NULL,
    last_name VARCHAR(255) NOT NULL,
    salary DECIMAL(10, 2) NOT NULL
);

CREATE TABLE managers(
    id SERIAL PRIMARY KEY,
    first_name VARCHAR(255) NOT NULL,
    last_name VARCHAR(255) NOT NULL,
    salary DECIMAL(10, 2) NOT NULL
);

INSERT INTO employees (first_name, last_name, salary)
VALUES
('Bob', 'Williams', 75000.00),
('Charlie', 'Davis', 55000.00),
('David', 'Jones', 50000.00),
('Emma', 'Brown', 48000.00),
('Frank', 'Miller', 52000.00),
('Grace', 'Wilson', 49000.00),
('Harry', 'Taylor', 53000.00),
('Ivy', 'Moore', 47000.00),
('Jack', 'Anderson', 56000.00),
('Kate', 'Hill',  44000.00),
('Liam', 'Clark', 59000.00),
('Mia', 'Parker', 42000.00);

INSERT INTO managers(first_name, last_name, salary)
VALUES
('John', 'Doe',  60000.00),
('Jane', 'Smith', 55000.00),
('Alice', 'Johnson',  58000.00);
```

### 1\) Using the ALL operator with the greater than operator (\>) example

The following example uses the `ALL` operator for employees who have salaries greater than all managers

```sql
SELECT
  *
FROM
  employees
WHERE
  salary > ALL(
    select
      salary
    from
      managers
  );
```

Output:

```text
 id | first_name | last_name |  salary
----+------------+-----------+----------
  1 | Bob        | Williams  | 75000.00
(1 row)
```

The query returns one row with a salary of 75K greater than the highest salary of all managers (60K).

### 2\) Using the ALL operator with the less than operator (\<) example

The following example uses the `ALL` operator for employees who have salaries less than all managers:

```
SELECT
  *
FROM
  employees
WHERE
  salary < ALL(
    select
      salary
    from
      managers
  )
ORDER BY salary DESC;
```

Output:

```
 id | first_name | last_name |  salary
----+------------+-----------+----------
  7 | Harry      | Taylor    | 53000.00
  5 | Frank      | Miller    | 52000.00
  3 | David      | Jones     | 50000.00
  6 | Grace      | Wilson    | 49000.00
  4 | Emma       | Brown     | 48000.00
  8 | Ivy        | Moore     | 47000.00
 10 | Kate       | Hill      | 44000.00
 12 | Mia        | Parker    | 42000.00
(8 rows)
```

It returns all the employees whose salaries are less than the lowest salary of all managers which is 55K.

## Summary

- Use the PostgreSQL `ALL` operator to compare a value with all values in a set of values returned by a subquery.


# EXISTS Operator

---
title: 'PostgreSQL EXISTS Operator'
page_title: 'PostgreSQL EXISTS Operator'
page_description: 'This tutorial shows you how to use the PostgreSQL EXISTS operator to check the existence of rows in the subquery.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-exists/'
ogImage: '/postgresqltutorial/customer-and-payment-tables.png'
updatedOn: '2024-07-01T01:05:42+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL ALL Operator'
  slug: 'postgresql-tutorial/postgresql-all'
nextLink:
  title: 'PostgreSQL CTE'
  slug: 'postgresql-tutorial/postgresql-cte'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `EXISTS` operator to test for the existence of rows in a subquery.

## Introduction to PostgreSQL EXISTS operator

The `EXISTS` operator is a boolean operator that checks the existence of rows in a [subquery](postgresql-subquery).

Here’s the basic syntax of the `EXISTS` operator:

```sql
EXISTS (subquery)
```

Typically, you use the `EXISTS` operator in the [`WHERE`](postgresql-where) clause of a `SELECT` statement:

```
SELECT
  select_list
FROM
  table1
WHERE
  EXISTS(
    SELECT
      select_list
    FROM
      table2
    WHERE
      condition
  );
```

If the subquery returns at least one row, the `EXISTS` operator returns `true`. If the subquery returns no row, the `EXISTS` returns `false`.

Note that if the subquery returns `NULL`, the `EXISTS` operator returns `true`.

The result of `EXISTS` operator depends on whether any row is returned by the subquery, and not on the row contents. Therefore, columns that appear in the `select_list` of the subquery are not important.

For this reason, the common coding convention is to write `EXISTS` in the following form:

```sql
SELECT
  select_list
FROM
  table1
WHERE
  EXISTS(
    SELECT
      1
    FROM
      table2
    WHERE
      condition
  );
```

To negate the `EXISTS` operator, you use the `NOT EXISTS` operator:

```sql
NOT EXISTS (subquery)
```

The `NOT EXISTS` operator returns `true` if the subquery returns no row or `false` if the subquery returns at least one row.

In practice, you often use the `EXISTS` operator in conjunction with the [correlated subqueries](postgresql-correlated-subquery).

## PostgreSQL EXISTS examples

We will use the following `customer` and `payment` tables in the [sample database](../postgresql-getting-started/postgresql-sample-database) for the demonstration:

![customer and payment tables](/postgresqltutorial/customer-and-payment-tables.png)

### 1\) Basic EXISTS operator example

The following example uses the `EXISTS` operator to check if the payment value is zero exists in the `payment` table:

```
SELECT
  EXISTS(
    SELECT
      1
    FROM
      payment
    WHERE
      amount = 0
  );
```

Output:

```text
 exists
--------
 t
(1 row)
```

### 2\) Using the EXISTS operator to check the existence of a row

The following example uses the `EXISTS` operator to find customers who have paid at least one rental with an amount greater than 11:

```
SELECT
  first_name,
  last_name
FROM
  customer c
WHERE
  EXISTS (
    SELECT
      1
    FROM
      payment p
    WHERE
      p.customer_id = c.customer_id
      AND amount > 11
  )
ORDER BY
  first_name,
  last_name;
```

The query returns the following output:

```text
 first_name | last_name
------------+-----------
 Karen      | Jackson
 Kent       | Arsenault
 Nicholas   | Barfield
 Rosemary   | Schmidt
 Tanya      | Gilbert
 Terrance   | Roush
 Vanessa    | Sims
 Victoria   | Gibson
(8 rows)
```

In this example, for each customer in the `customer` table, the subquery checks the `payment` table to find if that customer made at least one payment (`p.customer_id = c.customer_id`) and the amount is greater than 11 ( `amount > 11`)

### 2\) NOT EXISTS example

The following example uses the `NOT EXISTS` operator to find customers who have not made any payment more than 11\.

```
SELECT
  first_name,
  last_name
FROM
  customer c
WHERE
  NOT EXISTS (
    SELECT
      1
    FROM
      payment p
    WHERE
      p.customer_id = c.customer_id
      AND amount > 11
  )
ORDER BY
  first_name,
  last_name;
```

Here is the output:

```sql
first_name  |  last_name
-------------+--------------
 Aaron       | Selby
 Adam        | Gooch
 Adrian      | Clary
 Agnes       | Bishop
 Alan        | Kahn
...
```

### 3\) EXISTS and NULL example

The following example returns all rows from the `customers` table because the subquery in the `EXISTS` operator returns `NULL`:

```sql
SELECT
  first_name,
  last_name
FROM
  customer
WHERE
  EXISTS(
    SELECT NULL
  )
ORDER BY
  first_name,
  last_name;
```

Output:

```
first_name  |  last_name
-------------+--------------
 Aaron       | Selby
 Adam        | Gooch
 Adrian      | Clary
 Agnes       | Bishop
...
```

## Summary

- Use the PostgreSQL `EXISTS` to check the existence of rows in a subquery.


# Managing Tables

# PostgreSQL Data Types

---
title: 'PostgreSQL Data Types'
page_title: 'Getting Started with PostgreSQL Data Types'
page_description: 'In this tutorial, you will learn about PostgreSQL data types including Boolean, character, number, temporal, special types, and array.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-data-types/'
ogImage: '/postgresqltutorial/PostgreSQL-Data-Types-300x254.png'
updatedOn: '2024-05-08T22:50:24+00:00'
enableTableOfContents: true
previousLink:
  title: 'Export PostgreSQL Table to CSV File'
  slug: 'postgresql-tutorial/export-postgresql-table-to-csv-file'
nextLink:
  title: 'PostgreSQL CREATE TABLE'
  slug: 'postgresql-tutorial/postgresql-create-table'
---

**Summary**: in this tutorial, you will learn about **PostgreSQL data types** including Boolean, character, numeric, temporal, array, json, UUID, and special types.

## PostgreSQL Data TypesOverview of PostgreSQL data types

PostgreSQL supports the following data types:

- [Boolean](postgresql-boolean)
- [Character](postgresql-char-varchar-text) types such as [`char`, `varchar`, and `text`](postgresql-char-varchar-text).
- Numeric types such as integer and floating\-point number.
- Temporal types such as [date](postgresql-date), [time](postgresql-time), [timestamp](postgresql-timestamp), and [interval](postgresql-interval)
- [UUID](postgresql-uuid) for storing Universally Unique Identifiers
- [Array](postgresql-array) for storing array strings, numbers, etc.
- [JSON](postgresql-json) stores JSON data
- [hstore](postgresql-hstore) stores key\-value pair
- Special types such as network address and geometric data.

## Boolean

A [Boolean](postgresql-boolean) data type can hold one of three possible values: true, false, or null. You use `boolean` or `bool` keyword to declare a column with the Boolean data type.

When you [insert data](postgresql-insert) into a Boolean column, PostgreSQL converts it to a Boolean value

- `1`, `yes`, `y`, `t`, `true` values are converted to `true`
- `0`, `no`, `false`, `f` values are converted to `false`.

When you [select data](postgresql-select) from a Boolean column, PostgreSQL converts the values back e.g., `t` to true, `f` to `false` and `space` to `null`.

## Character

PostgreSQL provides three [character data types](postgresql-char-varchar-text): `CHAR(n)`, `VARCHAR(n)`, and `TEXT`

- `CHAR(n)` is the fixed\-length character with space padded. If you insert a string that is shorter than the length of the column, PostgreSQL pads spaces. If you insert a string that is longer than the length of the column, PostgreSQL will issue an error.
- `VARCHAR(n)` is the variable\-length character string. The `VARCHAR(n)` allows you to store up to `n` characters. PostgreSQL does not pad spaces when the stored string is shorter than the length of the column.
- `TEXT` is the variable\-length character string. Theoretically, text data is a character string with unlimited length.

## Numeric

PostgreSQL provides two distinct types of numbers:

- [integers](postgresql-integer)
- floating\-point numbers

### Integer

There are three kinds of integers in PostgreSQL:

- Small integer ( `SMALLINT`) is a 2\-byte signed integer that has a range from \-32,768 to 32,767\.
- Integer ( `INT`) is a 4\-byte integer that has a range from \-2,147,483,648 to 2,147,483,647\.
- [Serial](postgresql-serial) is the same as integer except that PostgreSQL will automatically generate and populate values into the `SERIAL` column. This is similar to [`AUTO_INCREMENT`](https://www.mysqltutorial.org/mysql-basics/mysql-auto_increment/) column in MySQL or [`AUTOINCREMENT`](http://www.sqlitetutorial.net/sqlite-autoincrement/) column in SQLite.

### Floating\-point number

There are three main types of floating\-point numbers:

- `float(n)`  is a floating\-point number whose precision, is at least, n, up to a maximum of 8 bytes.
- `real`or `float8`is a 4\-byte floating\-point number.
- [`numeric`](postgresql-numeric)or `numeric(p,s)` is a real number with p digits with s number after the decimal point. This `numeric(p,s)` is the exact number.

## Temporal data types

The temporal data types allow you to store date and /or time data. PostgreSQL has five main temporal data types:

- [`DATE`](postgresql-date) stores the dates only.
- [`TIME`](postgresql-time) stores the time of day values.
- [`TIMESTAMP`](postgresql-timestamp) stores both date and time values.
- [`TIMESTAMPTZ`](postgresql-timestamp) is a timezone\-aware timestamp data type. It is the abbreviation for [timestamp](postgresql-timestamp) with the time zone.
- [`INTERVAL`](postgresql-interval) stores periods.

The `TIMESTAMPTZ` is PostgreSQL’s extension to the SQL standard’s temporal data types.

## Arrays

In PostgreSQL, you can store an [array](postgresql-array) of strings, an array of integers, etc., in array columns. The array comes in handy in some situations e.g., storing days of the week, and months of the year.

## JSON

PostgreSQL provides two JSON data types: [`JSON`](postgresql-json) and `JSONB` for storing JSON data.

The `JSON` data type stores plain JSON data that requires reparsing for each processing, while `JSONB` data type stores `JSON` data in a binary format which is faster to process but slower to insert. In addition, `JSONB` supports indexing, which can be an advantage.

## UUID

The `UUID` data type allows you to store Universal Unique Identifiers defined by [RFC 4122](https://tools.ietf.org/html/rfc4122 'UUID') . The `UUID` values guarantee a better uniqueness than [`SERIAL`](postgresql-serial) and can be used to hide sensitive data exposed to the public such as values of `id` in URL.

## Special data types

Besides the primitive data types, PostgreSQL also provides several special data types related to geometry and network.

- `box` – a rectangular box.
- `line`– a set of points.
- `point` – a geometric pair of numbers.
- `lseg` – a line segment.
- `polygon` – a closed geometric.
- `inet` – an IP4 address.
- `macaddr`– a MAC address.

In this tutorial, we have introduced you to the PostgreSQL data types so that you can use them to create tables in the next tutorial.


# Create Table

---
title: 'PostgreSQL CREATE TABLE'
page_title: 'PostgreSQL CREATE TABLE Statement'
page_description: 'This tutorial shows you how to use the PostgreSQL CREATE TABLE statement to create a new table in the database.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-create-table/'
ogImage: ''
updatedOn: '2024-02-16T13:40:04+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Data Types'
  slug: 'postgresql-tutorial/postgresql-data-types'
nextLink:
  title: 'PostgreSQL SELECT INTO'
  slug: 'postgresql-tutorial/postgresql-select-into'
---

**Summary**: in this tutorial, you will learn how to use the **PostgreSQL CREATE TABLE** statement to create a new table.

## Introduction to PostgreSQL CREATE TABLE statement

Typically, a relational database consists of multiple related tables. Tables allow you to store structured data like customers, products, and employees.

To create a new table, you use the `CREATE TABLE` statement. Here’s the basic syntax of the `CREATE TABLE` statement:

```phpsql
CREATE TABLE [IF NOT EXISTS] table_name (
   column1 datatype(length) column_constraint,
   column2 datatype(length) column_constraint,
   ...
   table_constraints
);
```

In this syntax:

First, specify the name of the table that you want to create after the `CREATE TABLE` keywords. The table name must be unique in a [schema](../postgresql-administration/postgresql-schema). If you create a table with a name that already exists, you’ll get an error.

A [schema](../postgresql-administration/postgresql-schema) is a named collection of database objects including tables. If you create a table without a schema, it defaults to public. You’ll learn more about the schema in the schema tutorial.

Second, use the `IF NOT EXISTS` option to create a new table only if it does not exist. When you use the `IF NOT EXISTS` option and the table already exists, PostgreSQL will issue a notice instead of an error.

Third, specify table columns separated by commas. Each column definition consists of the column name, data type, size, and constraint.

The constraint of a column specifies a rule that is applied to data within a column to ensure data integrity. The column constraints include [primary key](postgresql-primary-key), [foreign key](postgresql-foreign-key), [not null](postgresql-not-null-constraint), [unique](postgresql-unique-constraint), [check](postgresql-check-constraint), and default.

For example, the `NOT NULL` constraint ensures that the values in a column cannot be NULL.

Finally, specify constraints for the table including primary key, foreign key, and check constraints.

A table constraint is a rule that is applied to the data within the table to maintain data integrity.

Note that some column constraints can be defined as table constraints such as primary key, foreign key, unique, and check constraints.

### Constraints

PostgreSQL includes the following column constraints:

- [NOT NULL](postgresql-not-null-constraint)– ensures that the values in a column cannot be `NULL`.
- [UNIQUE](postgresql-unique-constraint) – ensures the values in a column are unique across the rows within the same table.
- [PRIMARY KEY](postgresql-primary-key) – a primary key column uniquely identifies rows in a table. A table can have one and only one primary key. The primary key constraint allows you to define the primary key of a table.
- [CHECK](postgresql-check-constraint) – ensures the data must satisfy a boolean expression. For example, the value in the price column must be zero or positive.
- [FOREIGN KEY](postgresql-foreign-key) – ensures that the values in a column or a group of columns from a table exist in a column or group of columns in another table. Unlike the primary key, a table can have many foreign keys.

Table constraints are similar to column constraints except that you can include more than one column in the table constraint.

## PostgreSQL CREATE TABLE example

We will create a new table called `accounts` in the `dvdrental` [sample database](../postgresql-getting-started/postgresql-sample-database). The `accounts` table has the following columns:

- `user_id` – primary key
- `username` – unique and not null
- `password` – not null
- `email` – unique and not null
- `created_at` – not null
- `last_login` – null

The following example uses the `CREATE TABLE` statement to create the `accounts` table:

```sql
CREATE TABLE accounts (
  user_id SERIAL PRIMARY KEY,
  username VARCHAR (50) UNIQUE NOT NULL,
  password VARCHAR (50) NOT NULL,
  email VARCHAR (255) UNIQUE NOT NULL,
  created_at TIMESTAMP NOT NULL,
  last_login TIMESTAMP
);
```

To create a table in a database, you need to execute the `CREATE TABLE` statement using a PostgreSQL client such as psql and pgAdmin.

We’ll show you step\-by\-step how to create the `accounts` table using the psql client tool.

First, open the Command Prompt on Windows or Terminal on Unix\-like systems and connect to the PostgreSQL:

```
psql -U postgres
```

It’ll prompt you to enter a password for the user `postgres`.

```
Password for user postgres:
```

When you enter a password correctly, you’ll see the following command prompt:

```
postgres=#
```

Second, connect to the `dvdrental` database:

```php
\c dvdrental
```

Third, enter the following `CREATE TABLE` statement and press Enter:

```
CREATE TABLE accounts (
  user_id SERIAL PRIMARY KEY,
  username VARCHAR (50) UNIQUE NOT NULL,
  password VARCHAR (50) NOT NULL,
  email VARCHAR (255) UNIQUE NOT NULL,
  created_at TIMESTAMP NOT NULL,
  last_login TIMESTAMP
);
```

Output:

```php
CREATE TABLE
```

The output indicates that the table has been created.

To view the accounts table, you can use the `\d` command:

```
\d accounts
```

Output:

```
                                           Table "public.accounts"
   Column   |            Type             | Collation | Nullable |                  Default
------------+-----------------------------+-----------+----------+-------------------------------------------
 user_id    | integer                     |           | not null | nextval('accounts_user_id_seq'::regclass)
 username   | character varying(50)       |           | not null |
 password   | character varying(50)       |           | not null |
 email      | character varying(255)      |           | not null |
 created_at | timestamp without time zone |           | not null |
 last_login | timestamp without time zone |           |          |
Indexes:
    "accounts_pkey" PRIMARY KEY, btree (user_id)
    "accounts_email_key" UNIQUE CONSTRAINT, btree (email)
    "accounts_username_key" UNIQUE CONSTRAINT, btree (username)
```

## Summary

- Use the `CREATE TABLE` statement to create a new table.
- Use the `IF NOT EXISTS` option to create the new table only if it does not exist.


# Select Into

---
title: 'PostgreSQL SELECT INTO'
page_title: 'PostgreSQL SELECT INTO Statement by Practical Examples'
page_description: 'This tutorial shows you how to use the PostgreSQL SELECT INTO statement to create a new table and fill it with the data returned by a query.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-select-into/'
ogImage: '/postgresqltutorial/film_table.png'
updatedOn: '2024-01-24T04:16:44+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CREATE TABLE'
  slug: 'postgresql-tutorial/postgresql-create-table'
nextLink:
  title: 'PostgreSQL CREATE TABLE AS'
  slug: 'postgresql-tutorial/postgresql-create-table-as'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `SELECT INTO` statement to create a new table from the result set of a query.

If you want to select data into variables, check out the [PL/pgSQL SELECT INTO statement](https://neon.tech/postgresql/plpgsql-select-into/).

## Introduction to PostgreSQL SELECT INTO statement

The PostgreSQL `SELECT INTO` statement [creates a new table](postgresql-create-table) and [inserts data](postgresql-insert) returned from a query into the table.

The new table will have columns with the same names as the columns of the result set of the query. Unlike a regular [`SELECT`](postgresql-select) statement, the `SELECT INTO` statement does not return a result to the client.

Here’s the basic syntax of the PostgreSQL `SELECT INTO` statement:

```sql
SELECT
  select_list I
INTO [ TEMPORARY | TEMP ] [ TABLE ] new_table_name
FROM
  table_name
WHERE
  search_condition;
```

To create a new table with the structure and data derived from a result set, you specify the new table name after the `INTO` keyword.

The `TEMP` or `TEMPORARY` keyword is optional; it allows you to create a [temporary table](postgresql-temporary-table) instead.

The `TABLE` keyword is optional, which enhances the clarity of the statement.

The [`WHERE`](postgresql-where) clause allows you to specify a condition that determines which rows from the original tables should be filled into the new table.

Besides the `WHERE` clause, you can use other clauses in the `SELECT` statement for the `SELECT INTO` statement such as [`INNER JOIN`](postgresql-inner-join), [`LEFT JOIN`](postgresql-left-join), [`GROUP BY`](postgresql-group-by), and [`HAVING`](postgresql-having).

Note that you cannot use the [`SELECT INTO`](https://neon.tech/postgresql/plpgsql-select-into/) statement in PL/pgSQL because it interprets the `INTO` clause differently. In this case, you can use the [`CREATE TABLE AS`](postgresql-create-table-as) statement which provides more functionality than the `SELECT INTO` statement.

## PostgreSQL SELECT INTO examples

We will use the `film` table from the [sample database](../postgresql-getting-started/postgresql-sample-database) for the demonstration.

![PostgreSQL SELECT INTO sample table](/postgresqltutorial/film_table.png)

### 1\) Basic PostgreSQL SELECT INTO statement example

The following statement uses the `SELECT INTO` statement to create a new table called `film_r` that contains films with the rating `R` and rental duration 5 days from the `film` table.

```sql
SELECT
    film_id,
    title,
    rental_rate
INTO TABLE film_r
FROM
    film
WHERE
    rating = 'R'
AND rental_duration = 5
ORDER BY
    title;
```

To verify the table creation, you can query data from the `film_r` table:

```sql
SELECT * FROM film_r;
```

![](/postgresqltutorial/PostgreSQL-Select-Into-Example.png)

### 2\) Using the SELECT INTO statement to create a new temporary table

The following example uses the `SELECT INTO` statement to create a temporary table named `short_film` that contains films whose lengths are under 60 minutes.

```sql
SELECT
    film_id,
    title,
    length
INTO TEMP TABLE short_film
FROM
    film
WHERE
    length < 60
ORDER BY
    title;
```

The following shows the data from the `short_film` table:

```sql
SELECT * FROM short_film
ORDER BY length DESC;
```

Output:

```
 film_id |        title         | length
---------+----------------------+--------
     486 | Jet Neighbors        |     59
     465 | Interview Liaisons   |     59
     409 | Heartbreakers Bright |     59
     947 | Vision Torque        |     59
...
```

## Summary

- Use the PostgreSQL `SELECT INTO` statement to create a new table from the result set of a query.


# Create Table As

---
title: 'PostgreSQL CREATE TABLE AS'
page_title: 'PostgreSQL CREATE TABLE AS Statement By Examples'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL CREATE TABLE AS statement to create a new table from the result set of a query.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-create-table-as/'
ogImage: '/postgresqltutorial/film_and_film_category_tables.png'
updatedOn: '2024-02-13T13:42:10+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL SELECT INTO'
  slug: 'postgresql-tutorial/postgresql-select-into'
nextLink:
  title: 'Using PostgreSQL SERIAL to Create Auto-increment Column'
  slug: 'postgresql-tutorial/postgresql-serial'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `CREATE TABLE AS` statement to create a new table from the result set of a query.

## Introduction to the PostgreSQL CREATE TABLE statement

The `CREATE TABLE AS` statement [creates a new table](postgresql-create-table) and fills it with the data returned by a query. The following shows the syntax of the `CREATE TABLE AS` statement:

```sql
CREATE TABLE new_table_name
AS query;
```

In this syntax:

1. First, specify the new table name after the `CREATE TABLE` clause.
2. Second, provide a query whose result set is added to the new table after the `AS` keyword.

The `TEMPORARY` or `TEMP` keyword allows you to create a [temporary table](postgresql-temporary-table):

```sql
CREATE TEMP TABLE new_table_name
AS query;
```

The `UNLOGGED` keyword allows the new table to be created as an unlogged table:

```sql
CREATE UNLOGGED TABLE new_table_name
AS query;
```

The columns of the new table will have the names and data types associated with the output columns of the `SELECT` clause.

If you want the table columns to have different names, you can specify the new table columns after the new table name:

```sql
CREATE TABLE new_table_name ( column_name_list)
AS query;
```

If you want to avoid an error by creating a new table that already exists, you can use the `IF NOT EXISTS` option as follows:

```sql
CREATE TABLE IF NOT EXISTS new_table_name
AS query;
```

## PostgreSQL CREATE TABLE AS statement examples

We will use the `film` and `film_category` table from the [sample database](../postgresql-getting-started/postgresql-sample-database) for the demonstration.

![film_and_film_category_tables](/postgresqltutorial/film_and_film_category_tables.png)The following example uses the CREATE TABLE AS statement to create a new table that contains the films whose category is 1:

```sql
CREATE TABLE action_film
AS
SELECT
    film_id,
    title,
    release_year,
    length,
    rating
FROM
    film
INNER JOIN film_category USING (film_id)
WHERE
    category_id = 1;
```

To verify the table creation, you can query data from the `action_film` table:

```sql
SELECT * FROM action_film
ORDER BY title;
```

![PostgreSQL CREATE TABLE AS data verification](/postgresqltutorial/PostgreSQL-CREATE-TABLE-AS-data-verification.png)
To check the structure of the `action_film`, you can use the following command in the psql tool:

```text
\d action_film;
```

It returns the following output:

![PostgreSQL CREATE TABLE AS example](/postgresqltutorial/PostgreSQL-CREATE-TABLE-AS-example.png)
As clearly shown in the output, the names and data types of the `action_film` table are derived from the columns of the `SELECT` clause.

If the `SELECT` clause contains expressions, it is a good practice to override the columns, for example:

```sql
CREATE TABLE IF NOT EXISTS film_rating (rating, film_count)
AS
SELECT
    rating,
    COUNT (film_id)
FROM
    film
GROUP BY
    rating;
```

This example statement created a new table `film_rating` and filled it with the summary data from the `film` table. It explicitly specified the column names for the new table instead of using the column names from the `SELECT` clause.

To check the structure of the `film_rating` table, you use the following command in psql tool:

```text
\d film_rating
```

The following is the output:

![PostgreSQL CREATE TABLE AS with explicit column names](/postgresqltutorial/PostgreSQL-CREATE-TABLE-AS-with-explicit-column-names.png)
Note that the `CREATE TABLE AS` statement is similar to the [`SELECT INTO`](postgresql-select-into) statement, but the `CREATE TABLE AS` statement is preferred because it is not confused with other uses of the `SELECT INTO` syntax in [PL/pgSQL](../postgresql-plpgsql). In addition, the `CREATE TABLE AS` statement provides a superset of the functionality offered by the `SELECT INTO` statement.

## Summary

- Use the PostgreSQL `CREATE TABLE AS` statement to create a new table from the result of a query.


# SERIAL

---
title: 'Using PostgreSQL SERIAL to Create Auto-increment Column'
page_title: 'Using PostgreSQL SERIAL to Create Auto-increment Columns'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL SERIAL to create an auto-increment column in a database table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-serial/'
ogImage: '/postgresqltutorial/PostgreSQL-Serial-268x300.png'
updatedOn: '2024-02-01T08:57:58+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CREATE TABLE AS'
  slug: 'postgresql-tutorial/postgresql-create-table-as'
nextLink:
  title: 'PostgreSQL Sequences'
  slug: 'postgresql-tutorial/postgresql-sequences'
---

![PostgreSQL Serial](/postgresqltutorial/PostgreSQL-Serial-268x300.png?alignright)**Summary**: in this tutorial,  you will learn about the PostgreSQL `SERIAL` pseudo\-type and how to use the `SERIAL` pseudo\-type to define auto\-increment columns in tables.

## Introduction to the PostgreSQL SERIAL pseudo\-type

In PostgreSQL, a [sequence](postgresql-sequences) is a special kind of database object that generates a sequence of integers. A sequence is often used as the [primary key](postgresql-primary-key) column in a table.

When [creating a new table](postgresql-create-table), the sequence can be created through the `SERIAL` pseudo\-type as follows:

```phpsql
CREATE TABLE table_name(
    id SERIAL
);
```

By assigning the `SERIAL` pseudo\-type to the `id` column, PostgreSQL performs the following:

- First, create a sequence object and set the next value generated by the sequence as the default value for the column.
- Second, add a [`NOT NULL`](postgresql-not-null-constraint) constraint to the `id` column because a sequence always generates an integer, which is a non\-null value.
- Third, assign the owner of the sequence to the `id` column; as a result, the sequence object is deleted when the `id` column or table is dropped

Behind the scenes, the following statement:

```sql
CREATE TABLE table_name(
    id SERIAL
);
```

is equivalent to the following statements:

```sql
CREATE SEQUENCE table_name_id_seq;

CREATE TABLE table_name (
    id integer NOT NULL DEFAULT nextval('table_name_id_seq')
);

ALTER SEQUENCE table_name_id_seq
OWNED BY table_name.id;
```

PostgreSQL provides three serial pseudo\-types `SMALLSERIAL`, `SERIAL`, and `BIGSERIAL` with the following characteristics:

| **Name**    | **Storage Size** | **Range**                      |
| ----------- | ---------------- | ------------------------------ |
| SMALLSERIAL | 2 bytes          | 1 to 32,767                    |
| SERIAL      | 4 bytes          | 1 to 2,147,483,647             |
| BIGSERIAL   | 8 bytes          | 1 to 9,223,372,036,854,775,807 |

## PostgreSQL SERIAL examples

Let’s take some examples of using the SERIAL columns.

### 1\) Basic PostgreSQL SERIAL example

It is important to note that the `SERIAL` does not implicitly [create an index](../postgresql-indexes/postgresql-create-index) on the column or make the column the [primary key](postgresql-primary-key) column. However, this can be done easily by specifying the `PRIMARY KEY` constraint for the `SERIAL` column.

The following statement creates the `fruits` table with the `id` column as the `SERIAL` column:

```sql
CREATE TABLE fruits(
   id SERIAL PRIMARY KEY,
   name VARCHAR NOT NULL
);
```

To assign a default value to a serial column when [inserting a row into the table](postgresql-insert), you ignore the column name or use the `DEFAULT` keyword in the [`INSERT`](postgresql-insert) statement. For example:

```sql
INSERT INTO fruits(name)
VALUES('Orange');
```

Or

```sql
INSERT INTO fruits(id,name)
VALUES(DEFAULT,'Apple');
```

PostgreSQL inserted two rows into the `fruits` table with the values for the `id` column are 1 and 2\.

```sql
SELECT * FROM fruits;
```

```text
 id |  name
----+--------
  1 | Apple
  2 | Orange
(2 rows)
```

### 2\) Getting the sequence name

To get the sequence name of a `SERIAL` column in a table, you use the `pg_get_serial_sequence()` function as follows:

```sql
pg_get_serial_sequence('table_name','column_name')
```

You can pass a sequence name to the  `currval()` function to get the recent value generated by the sequence. For example, the following statement returns the recent value generated by the `fruits_id_seq` object:

```sql
SELECT currval(pg_get_serial_sequence('fruits', 'id'));
```

```sql
currval
---------
2
(1 row)
```

### 3\) Retrieving the generated value

If you want to get the value generated by the sequence when you insert a new row into the table, you use the `RETURNING id` clause in the `INSERT` statement.

The following statement inserts a new row into the `fruits` table and returns the value generated for the id column.

```sql
INSERT INTO fruits(name)
VALUES('Banana')
RETURNING id;
```

```sql
id
----
3
(1 row)
```

The sequence generator operation is not transaction\-safe. It means that if two concurrent database connections attempt to get the next value from a sequence, each client will get a different value.

If one client rolls back the transaction, the sequence number of that client will be unused, creating a gap in the sequence.

### 4\) Adding a serial column to an existing table

First, create a new table called `baskets` without a primary key column:

```
CREATE TABLE baskets(
    name VARCHAR(255) NOT NULL
);
```

Second, add a `SERIAL` column to the `baskets` table:

```php
ALTER TABLE baskets
ADD COLUMN id SERIAL PRIMARY KEY;
```

Third, describe the table `baskets` to verify the change:

```
\d baskets
```

Output:

```
                                    Table "public.baskets"
 Column |          Type          | Collation | Nullable |               Default
--------+------------------------+-----------+----------+-------------------------------------
 name   | character varying(255) |           | not null |
 id     | integer                |           | not null | nextval('baskets_id_seq'::regclass)
Indexes:
    "baskets_pkey" PRIMARY KEY, btree (id)
```

## Summary

- Use the PostgreSQL pseudo\-type `SERIAL` to create an auto\-increment column for a table.


# Sequences

---
title: 'PostgreSQL Sequences'
page_title: 'PostgreSQL Sequences'
page_description: 'In this tutorial, you will learn about the PostgreSQL sequences and how to use a sequence object to generate a sequence of numbers.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-sequences/'
ogImage: '/postgresqltutorial/PostgreSQL-Sequence-simple-example.png'
updatedOn: '2024-02-08T06:01:43+00:00'
enableTableOfContents: true
previousLink:
  title: 'Using PostgreSQL SERIAL to Create Auto-increment Column'
  slug: 'postgresql-tutorial/postgresql-serial'
nextLink:
  title: 'PostgreSQL Identity Column'
  slug: 'postgresql-tutorial/postgresql-identity-column'
---

**Summary**: in this tutorial, you will learn about the PostgreSQL sequences and how to use a sequence object to generate a sequence of numbers.

## Introduction to PostgreSQL sequences

In PostgreSQL, a sequence is a database object that allows you to generate a sequence of unique integers.

Typically, you use a sequence to generate a unique identifier for a primary key in a table. Additionally, you can use a sequence to generate unique numbers across tables.

To create a new sequence, you use the `CREATE SEQUENCE` statement.

## PostgreSQL CREATE SEQUENCE statement

The following illustrates the syntax of the `CREATE SEQUENCE` statement:

```sql
CREATE SEQUENCE [ IF NOT EXISTS ] sequence_name
    [ AS { SMALLINT | INT | BIGINT } ]
    [ INCREMENT [ BY ] increment ]
    [ MINVALUE minvalue | NO MINVALUE ]
    [ MAXVALUE maxvalue | NO MAXVALUE ]
    [ START [ WITH ] start ]
    [ CACHE cache ]
    [ [ NO ] CYCLE ]
    [ OWNED BY { table_name.column_name | NONE } ]
```

### sequence_name

Specify the name of the sequence after the `CREATE SEQUENCE` clause. The `IF NOT EXISTS` conditionally creates a new sequence only if it does not exist.

The sequence name must be distinct from any other sequences, tables, [indexes](../postgresql-indexes), [views](../postgresql-views), or foreign tables in the same schema.

### \[ AS \{ SMALLINT \| INT \| BIGINT \} \]

Specify the [data type](postgresql-data-types) of the sequence. The valid data type is [`SMALLINT`](postgresql-integer), [`INT`](postgresql-interval), and [`BIGINT`](postgresql-integer). The default data type is `BIGINT` if you skip it.

The data type of the sequence which determines the sequence’s minimum and maximum values.

### \[ INCREMENT \[ BY ] increment ]

The `increment` specifies which value to add to the current sequence value.

A positive number will make an ascending sequence whereas a negative number will form a descending sequence.

The default increment value is 1\.

### \[ MINVALUE minvalue \| NO MINVALUE ]

### \[ MAXVALUE maxvalue \| NO MAXVALUE ]

Define the minimum value and maximum value of the sequence. If you use `NO MINVALUE` and `NO MAXVALUE`, the sequence will use the default value.

For an ascending sequence, the default maximum value is the maximum value of the data type of the sequence and the default minimum value is 1\.

In the case of a descending sequence, the default maximum value is \-1 and the default minimum value is the minimum value of the data type of the sequence.

### \[ START \[ WITH ] start ]

The `START` clause specifies the starting value of the sequence.

The default starting value is `minvalue` for ascending sequences and `maxvalue` for descending ones.

### cache

The `CACHE` determines how many sequence numbers are preallocated and stored in memory for faster access. One value can be generated at a time.

By default, the sequence generates one value at a time i.e., no cache.

### CYCLE \| NO CYCLE

The `CYCLE` allows you to restart the value if the limit is reached. The next number will be the minimum value for the ascending sequence and the maximum value for the descending sequence.

If you use `NO CYCLE`, when the limit is reached, attempting to get the next value will result in an error.

The `NO CYCLE` is the default if you don’t explicitly specify `CYCLE` or `NO CYCLE`.

### OWNED BY table_name.column_name

The `OWNED BY` clause allows you to associate the table column with the sequence so that when you drop the column or table, PostgreSQL will automatically drop the associated sequence.

Note that when you use the [`SERIAL`](postgresql-serial) pseudo\-type for a column of a table, behind the scenes, PostgreSQL automatically creates a sequence associated with the column.

## PostgreSQL CREATE SEQUENCE examples

Let’s take some examples of creating sequences to get a better understanding.

### 1\) Creating an ascending sequence example

This statement uses the `CREATE SEQUENCE` statement to create a new ascending sequence starting from 100 with an increment of 5:

```sql
CREATE SEQUENCE mysequence
INCREMENT 5
START 100;
```

To get the next value from the sequence, you use the `nextval()` function:

```sql
SELECT nextval('mysequence');
```

![PostgreSQL Sequence - simple example](/postgresqltutorial/PostgreSQL-Sequence-simple-example.png)
If you execute the statement again, you will get the next value from the sequence:

```sql
SELECT nextval('mysequence');
```

![PostgreSQL Sequence - nextval example](/postgresqltutorial/PostgreSQL-Sequence-nextval-example.png)

### 2\) Creating a descending sequence example

The following statement creates a descending sequence from 3 to 1 with the cycle option:

```sql
CREATE SEQUENCE three
INCREMENT -1
MINVALUE 1
MAXVALUE 3
START 3
CYCLE;
```

When you execute the following statement multiple times, you will see the number starting from 3, 2, 1 and back to 3, 2, 1, and so on:

```sql
SELECT nextval('three');
```

### 3\) Creating a sequence associated with a table column

First, [create a new table](postgresql-create-table) named `order_details`:

```sql
CREATE TABLE order_details(
    order_id SERIAL,
    item_id INT NOT NULL,
    item_text VARCHAR NOT NULL,
    price DEC(10,2) NOT NULL,
    PRIMARY KEY(order_id, item_id)
);
```

Second, create a new sequence associated with the `item_id` column of the `order_details` table:

```sql
CREATE SEQUENCE order_item_id
START 10
INCREMENT 10
MINVALUE 10
OWNED BY order_details.item_id;
```

Third, [insert](postgresql-insert) three order line items into the `order_details` table:

```sql
INSERT INTO
    order_details(order_id, item_id, item_text, price)
VALUES
    (100, nextval('order_item_id'),'DVD Player',100),
    (100, nextval('order_item_id'),'Android TV',550),
    (100, nextval('order_item_id'),'Speaker',250);
```

In this statement, we used the `nextval()` function to fetch the item id value from the `order_item_id` sequence.

Fourth, [query](postgresql-select) data from the `order_details` table:

```sql
SELECT
    order_id,
    item_id,
    item_text,
    price
FROM
    order_details;
```

![PostgreSQL Sequence in a table](/postgresqltutorial/PostgreSQL-Sequence-in-a-table.png)

## Listing all sequences in a database

To list all sequences in the current database, you use the following query:

```sql
SELECT
    relname sequence_name
FROM
    pg_class
WHERE
    relkind = 'S';
```

## Deleting sequences

If a sequence is associated with a table column, it will be automatically dropped once the table column is removed or the table is dropped.

You can also remove a sequence manually using the `DROP SEQUENCE` statement:

```sql
DROP SEQUENCE [ IF EXISTS ] sequence_name [, ...]
[ CASCADE | RESTRICT ];
```

In this syntax:

- First, specify the name of the sequence which you want to drop. The `IF EXISTS` option conditionally deletes the sequence if it exists. If you want to drop multiple sequences at once, you can use a list of comma\-separated sequence names.
- Then, use the `CASCADE` option if you want to drop objects that depend on the sequence recursively, objects that depend on the dependent objects, and so on.

### PostgreSQL DROP SEQUENCE statement examples

This statement drops the table `order_details`. Since the sequence `order_item_id` associates with the `item_id` of the `order_details`, it is also dropped automatically:

```sql
DROP TABLE order_details;
```

In this tutorial, you have learned about PostgreSQL sequences and how to use a sequence object to generate a list of sequences.


# Identity Column

---
title: 'PostgreSQL Identity Column'
page_title: 'PostgreSQL Identity Column'
page_description: 'This tutorial shows you how to use the GENERATED AS IDENTITY constraint to create the PostgreSQL identity column for a table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-identity-column/'
ogImage: '/postgresqltutorial/PostgreSQL-identity-column-generated-as-always-example.png'
updatedOn: '2024-02-01T09:08:44+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Sequences'
  slug: 'postgresql-tutorial/postgresql-sequences'
nextLink:
  title: 'PostgreSQL Generated Columns'
  slug: 'postgresql-tutorial/postgresql-generated-columns'
---

**Summary**: in this tutorial, you will learn how to use the `GENERATED AS IDENTITY` constraint to create the PostgreSQL identity column for a table.

## Introduction to PostgreSQL identity column

PostgreSQL version 10 introduced a new constraint `GENERATED AS IDENTITY` that allows you to automatically assign a unique number to a column.

The `GENERATED AS IDENTITY` constraint is the SQL standard\-conforming variant of the good old [`SERIAL`](postgresql-serial) column.

The following illustrates the syntax of the `GENERATED AS IDENTITY` constraint:

```shellsql
column_name type
GENERATED { ALWAYS | BY DEFAULT }
AS IDENTITY[ ( sequence_option ) ]
```

In this syntax:

- The type can be [`SMALLINT`](postgresql-integer), `INT`, or `BIGINT`.
- The `GENERATED ALWAYS` instructs PostgreSQL to always generate a value for the identity column. If you attempt to insert (or update) values into the `GENERATED ALWAYS AS IDENTITY` column, PostgreSQL will issue an error.
- The `GENERATED BY DEFAULT` instructs PostgreSQL to generate a value for the identity column. However, if you supply a value for insert or update, PostgreSQL will use that value to insert into the identity column instead of using the system\-generated value.

PostgreSQL allows a table to have more than one identity column. Like the `SERIAL`, the `GENERATED AS IDENTITY` constraint also uses the [`SEQUENCE`](postgresql-sequences) object internally.

## PostgreSQL identity column examples

Let’s take some examples of using the PostgreSQL identity columns.

### 1\) GENERATED ALWAYS example

First, [create a table](postgresql-create-table) named `color` with the `color_id` as the identity column:

```sql
CREATE TABLE color (
    color_id INT GENERATED ALWAYS AS IDENTITY,
    color_name VARCHAR NOT NULL
);
```

Second, insert a new row into the `color` table:

```sql
INSERT INTO color(color_name)
VALUES ('Red');
```

Because `color_id` column has the `GENERATED AS IDENTITY` constraint, PostgreSQL generates a value for it as shown in the query below:

```sql
SELECT * FROM color;
```

![PostgreSQL Identity Column - GENERATED AS ALWAYS example](/postgresqltutorial/PostgreSQL-identity-column-generated-as-always-example.png)
Third, insert a new row by supplying values for both `color_id` and `color_name` columns:

```sql
INSERT INTO color (color_id, color_name)
VALUES (2, 'Green');
```

PostgreSQL issued the following error:

```sql
[Err] ERROR:  cannot insert into column "color_id"
DETAIL:  Column "color_id" is an identity column defined as GENERATED ALWAYS.
HINT:  Use OVERRIDING SYSTEM VALUE to override.
```

To fix the error, you can use the `OVERRIDING SYSTEM VALUE` clause as follows:

```sql
INSERT INTO color (color_id, color_name)
OVERRIDING SYSTEM VALUE
VALUES(2, 'Green');
```

![PostgreSQL identity column - OVERRIDING SYSTEM VALUE example](/postgresqltutorial/PostgreSQL-identity-column-OVERRIDING-SYSTEM-VALUE-example.png)
Alternatively, you can use `GENERATED BY DEFAULT AS IDENTITY` instead.

### 2\) GENERATED BY DEFAULT AS IDENTITY example

First, [drop](postgresql-drop-table) the `color` table and recreate it. This time we will use the `GENERATED BY DEFAULT AS IDENTITY` instead:

```sql
DROP TABLE color;

CREATE TABLE color (
    color_id INT GENERATED BY DEFAULT AS IDENTITY,
    color_name VARCHAR NOT NULL
);

```

Second, insert a row into the `color` table:

```sql
INSERT INTO color (color_name)
VALUES ('White');
```

It works as expected.

Third, insert another row with a value for the `color_id` column:

```sql
INSERT INTO color (color_id, color_name)
VALUES (2, 'Yellow');
```

Unlike the previous example that uses the `GENERATED ALWAYS AS IDENTITY` constraint, the statement above works perfectly fine.

### 3\) Sequence options example

Because the `GENERATED AS IDENTITY` constraint uses the `SEQUENCE` object, you can specify the sequence options for the system\-generated values.

For example, you can specify the starting value and the increment as follows:

```sql
DROP TABLE color;

CREATE TABLE color (
    color_id INT GENERATED BY DEFAULT AS IDENTITY
    (START WITH 10 INCREMENT BY 10),
    color_name VARCHAR NOT NULL
);

```

In this example, the system\-generated value for the `color_id` column starts with 10 and the increment value is also 10\.

First, insert a new row into the color table:

```sql
INSERT INTO color (color_name)
VALUES ('Orange');
```

The starting value for `color_id` column is ten as shown below:

```sql
SELECT * FROM color;
```

![PostgreSQL identity column - sequence options example](/postgresqltutorial/PostgreSQL-identity-column-sequence-options-example.png)
Second, insert another row into the `color` table:

```sql
INSERT INTO color (color_name)
VALUES ('Purple');
```

The value of the `color_id` of the second row is 20 because of the increment option.

```sql
SELECT * FROM color;
```

![PostgreSQL identity column - increment example](/postgresqltutorial/PostgreSQL-identity-column-increment-example.png)

## Adding an identity column to an existing table

You can add identity columns to an existing table by using the following form of the [`ALTER TABLE`](postgresql-alter-table) statement:

```sql
ALTER TABLE table_name
ALTER COLUMN column_name
ADD GENERATED { ALWAYS | BY DEFAULT } AS IDENTITY { ( sequence_option ) }
```

For example:

First, create a new table named `shape`:

```sql
CREATE TABLE shape (
    shape_id INT NOT NULL,
    shape_name VARCHAR NOT NULL
);
```

Second, change the `shape_id` column to the identity column:

```sql
ALTER TABLE shape
ALTER COLUMN shape_id ADD GENERATED ALWAYS AS IDENTITY;
```

Note that the `shape_id` needs to have the [`NOT NULL`](postgresql-not-null-constraint) constraint so that it can be changed to an identity column. Otherwise, you’ll get the following error:

```sql
ERROR:  column "shape_id" of relation "shape" must be declared NOT NULL before identity can be added
SQL state: 55000
```

The following command describes the `shape` table in psql tool:

```shell
\d shape
```

It returns the following output which is what we expected:

![](/postgresqltutorial/PostgreSQL-identity-column-alter-column-example.png)

## Changing an identity column

You can change the characteristics of an existing identity column by using the following `ALTER TABLE` statement:

```shell
ALTER TABLE table_name
ALTER COLUMN column_name
{ SET GENERATED { ALWAYS| BY DEFAULT } |
  SET sequence_option | RESTART [ [ WITH ] restart ] }
```

For example, the following statement changes the `shape_id` column of the `shape` table to `GENERATED BY DEFAULT`:

```sql
ALTER TABLE shape
ALTER COLUMN shape_id SET GENERATED BY DEFAULT;
```

The following command describes the structure of the shape table in the psql tool:

```text
\d shape
```

![](/postgresqltutorial/PostgreSQL-identity-column-changing-identity-column-example.png)
As you can see from the output, the `shape_id` column changed from `GENERATED ALWAYS` to `GENERATED BY DEFAULT`.

## Removing the GENERATED AS IDENTITY constraint

The following statement removes the `GENERATED AS IDENTITY` constraint from an existing table:

```
ALTER TABLE table_name
ALTER COLUMN column_name
DROP IDENTITY [ IF EXISTS ]
```

For example, you can remove the `GENERATED AS IDENTITY` constraint column from the `shape_id` column of the `shape` table as follows:

```sql
ALTER TABLE shape
ALTER COLUMN shape_id
DROP IDENTITY IF EXISTS;
```

In this tutorial, you have learned how to use the PostgreSQL identity column and how to manage it by using the `GENERATED AS IDENTITY` constraint.


# Generated Columns

---
title: 'PostgreSQL Generated Columns'
page_title: 'PostgreSQL Generated Columns'
page_description: 'In this tutorial, you will learn about PostgreSQL generated columns whose values are automatically calculated from other columns.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-generated-columns/'
ogImage: ''
updatedOn: '2024-03-25T08:00:13+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Identity Column'
  slug: 'postgresql-tutorial/postgresql-identity-column'
nextLink:
  title: 'PostgreSQL ALTER TABLE'
  slug: 'postgresql-tutorial/postgresql-alter-table'
---

**Summary**: in this tutorial, you will learn about PostgreSQL generated columns whose values are automatically calculated from other columns.

## Introduction to PostgreSQL Generated Columns

In PostgreSQL, a generated column is a special type of column whose values are automatically calculated based on expressions or values from other columns.

A generated column is referred to as a [computed column in the SQL Server](https://www.sqlservertutorial.net/sql-server-basics/sql-server-computed-columns/) or a [virtual column in Oracle](https://www.oracletutorial.com/oracle-basics/oracle-virtual-column/).

There are two kinds of generated columns:

- Stored: A stored generated column is calculated when it is inserted or updated and occupies storage space.
- Virtual: A virtual generated column is computed when it is read and does not occupy storage space.

A virtual generated column is like a [view](../postgresql-views), whereas a stored generated column is similar to a [materialized view](../postgresql-views/postgresql-materialized-views). Unlike a material view, PostgreSQL automatically updates data for stored generated columns.

**PostgreSQL currently implements only stored generated columns.**

### Defining generated columns

Typically, you define a generated column when [creating a table](postgresql-create-table) with the following syntax:

```plaintextsql
CREATE TABLE table_name(
   ...,
   colum_name type GENERATED ALWAYS AS (expression ) STORED | VIRTUAL,
   ...
);
```

In this syntax:

- `column_name`: Specify the name of the generated column.
- `type`: Specify the data type for the column.
- `expression`: Provide an expression that returns values for the calculated column.
- `STORED` keyword: Indicate that the data of the generated column is physically stored in the table.
- `VIRTUAL` keyword: Indicate that the data of the generated column is computed when queried, not stored physically.

To add a generated column to a table, you can use the [ALTER TABLE … ADD COLUMN](postgresql-add-column) statement:

```sql
ALTER TABLE table_name
ADD COLUMN column_name type GENERATED ALWAYS AS (expression) STORED;
```

When defining an expression for a generated column, ensure that it meets the following requirements:

- The expression can only use immutable functions and cannot involve [subqueries](postgresql-subquery) or reference anything beyond the current row. For example, the expression cannot use the [CURRENT_TIMESTAMP](../postgresql-date-functions/postgresql-current_timestamp) function.
- The expression cannot reference another generated column or a system column, except `tableoid`.

A generated column cannot have a default value or an identity definition. Additionally, it cannot be a part of the partition key.

## PostgreSQL Generated Column examples

Let’s explore some examples of using generated columns.

### 1\) Concatenating columns

First, create a new table called `contacts`:

```sql
CREATE TABLE contacts(
   id SERIAL PRIMARY KEY,
   first_name VARCHAR(50) NOT NULL,
   last_name VARCHAR(50) NOT NULL,
   full_name VARCHAR(101) GENERATED ALWAYS AS (first_name || ' ' || last_name) STORED,
   email VARCHAR(300) UNIQUE
);

```

Second, insert rows into the `contacts` table. The values of the `full_name` column will be automatically updated from the values in the `first_name` and `last_name` columns:

```sql
INSERT INTO contacts(first_name, last_name, email)
VALUES
   ('John', 'Doe', '[[email protected]](../cdn-cgi/l/email-protection.html)'),
   ('Jane', 'Doe', '[[email protected]](../cdn-cgi/l/email-protection.html)')
RETURNING *;
```

Output:

```text
 id | first_name | last_name | full_name |              email
----+------------+-----------+-----------+---------------------------------
  1 | John       | Doe       | John Doe  | [[email protected]](../cdn-cgi/l/email-protection.html)
  2 | Jane       | Doe       | Jane Doe  | [[email protected]](../cdn-cgi/l/email-protection.html)
(2 rows)
```

### 2\) Calculating net prices

First, create a table called `products` that stores the product information:

```
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    list_price DECIMAL(10, 2) NOT NULL,
    tax DECIMAL(5, 2) DEFAULT 0,
    discount DECIMAL(5, 2) DEFAULT 0,
    net_price DECIMAL(10, 2) GENERATED ALWAYS AS ((list_price + (list_price * tax / 100)) - (list_price * discount / 100)) STORED
);
```

In the `products` table, the `net_price` column is a generated column whose values are calculated based on the list price, tax, and discount with the following formula:

```sql
list_price = list_price + (list_price * tax / 100)) - (list_price * discount / 100)
```

Second, insert rows into the `products` table:

```
INSERT INTO products (name, list_price, tax, discount)
VALUES
    ('A', 100.00, 10.00, 5.00),
    ('B', 50.00, 8.00, 0.00),
    ('C', 120.00, 12.50, 10.00)
RETURNING *;
```

Output:

```
 id | name | list_price |  tax  | discount | net_price
----+------+------------+-------+----------+-----------
  1 | A    |     100.00 | 10.00 |     5.00 |    105.00
  2 | B    |      50.00 |  8.00 |     0.00 |     54.00
  3 | C    |     120.00 | 12.50 |    10.00 |    123.00
(3 rows)
```

## Summary

- Use generated columns to automate calculations within your table.


# Alter Table

---
title: 'PostgreSQL ALTER TABLE'
page_title: 'PostgreSQL ALTER TABLE'
page_description: 'This tutorial shows you how to modify the structure of a table by using the PostgreSQL ALTER TABLE statement.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-alter-table/'
ogImage: '/postgresqltutorial/PostgreSQL-ALTER-TABLE-SET-DEFAULT.png'
updatedOn: '2024-03-26T15:18:38+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Generated Columns'
  slug: 'postgresql-tutorial/postgresql-generated-columns'
nextLink:
  title: 'PostgreSQL Rename Table: A Step-by-Step Guide'
  slug: 'postgresql-tutorial/postgresql-rename-table'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `ALTER TABLE` statement to modify the structure of a table.

## Introduction to PostgreSQL ALTER TABLE statement

To change the structure of an existing table, you use PostgreSQL `ALTER TABLE` statement.

The following illustrates the basic syntax of the `ALTER TABLE` statement:

```shellsql
ALTER TABLE table_name action;
```

PostgreSQL provides you with many actions:

- [Add a column](postgresql-add-column)
- [Drop a column](postgresql-drop-column)
- [Change the data type of a column](postgresql-change-column-type)
- [Rename a column](postgresql-rename-column)
- [Set a default value for the column](postgresql-default-value)
- Add a constraint to a column.
- [Rename a table](postgresql-rename-table)

To add a new column to a table, you use [`ALTER TABLE ADD COLUMN`](postgresql-add-column) statement:

```sql
ALTER TABLE table_name
ADD COLUMN column_name datatype column_constraint;
```

To drop a column from a table, you use [`ALTER TABLE DROP COLUMN`](postgresql-drop-column) statement:

```sql
ALTER TABLE table_name
DROP COLUMN column_name;
```

To rename a column, you use the `[ALTER TABLE RENAME COLUMN](postgresql-rename-column) TO` statement:

```sql
ALTER TABLE table_name
RENAME COLUMN column_name
TO new_column_name;
```

To change a default value of the column, you use `ALTER TABLE ALTER COLUMN SET DEFAULT` or  `DROP DEFAULT`:

```sql
ALTER TABLE table_name
ALTER COLUMN column_name
[SET DEFAULT value | DROP DEFAULT];
```

To change the [`NOT NULL` constraint](postgresql-not-null-constraint), you use `ALTER TABLE ALTER COLUMN` statement:

```sql
ALTER TABLE table_name
ALTER COLUMN column_name
[SET NOT NULL| DROP NOT NULL];
```

To add a `CHECK` constraint, you use `ALTER TABLE ADD CHECK` statement:

```sql
ALTER TABLE table_name
ADD CHECK expression;
```

Generally, to add a constraint to a table, you use `ALTER TABLE ADD CONSTRAINT` statement:

```sql
ALTER TABLE table_name
ADD CONSTRAINT constraint_name constraint_definition;
```

To [rename a table](postgresql-rename-table) you use `ALTER TABLE RENAME TO` statement:

```sql
ALTER TABLE table_name
RENAME TO new_table_name;
```

## PostgreSQL ALTER TABLE examples

Let’s [create a new table](postgresql-create-table 'PostgreSQL CREATE TABLE') called `links` for practicing with the `ALTER TABLE` statement.

```sql
DROP TABLE IF EXISTS links;

CREATE TABLE links (
   link_id serial PRIMARY KEY,
   title VARCHAR (512) NOT NULL,
   url VARCHAR (1024) NOT NULL
);
```

To [add a new column](postgresql-add-column) named `active`, you use the following statement:

```sql
ALTER TABLE links
ADD COLUMN active boolean;
```

The following statement removes the `active`column from the `links`table:

```sql
ALTER TABLE links
DROP COLUMN active;
```

To change the name of the `title` column to `link_title`, you use the following statement:

```sql
ALTER TABLE links
RENAME COLUMN title TO link_title;
```

The following statement adds a new column named `target`to the `links`table:

```sql
ALTER TABLE links
ADD COLUMN target VARCHAR(10);
```

To set `_blank` as the default value for the `target`column in the `links`table, you use the following statement:

```sql
ALTER TABLE links
ALTER COLUMN target
SET DEFAULT '_blank';
```

If you [insert the new row](postgresql-insert) into the `links` table without specifying a value for the `target` column, the `target` column will take the `_blank` as the default value. For example:

```sql
INSERT INTO links (link_title, url)
VALUES('PostgreSQL Tutorial','https://neon.tech/postgresql/');
```

The following statement selects data from the `links` table:

```sql
SELECT * FROM links;
```

![PostgreSQL ALTER TABLE SET DEFAULT](/postgresqltutorial/PostgreSQL-ALTER-TABLE-SET-DEFAULT.png)
The following statement adds a `CHECK`condition to the `target`column so that the `target`column only accepts the following values: `_self`, `_blank`, `_parent`, and `_top`:

```sql
ALTER TABLE links
ADD CHECK (target IN ('_self', '_blank', '_parent', '_top'));
```

If you attempt to insert a new row that violates the `CHECK` constraint set for the `target`column, PostgreSQL will issue an error as shown in the following example:

```sql
INSERT INTO links(link_title,url,target)
VALUES('PostgreSQL','http://www.postgresql.org/','whatever');
```

```sql
ERROR:  new row for relation "links" violates check constraint "links_target_check"
DETAIL:  Failing row contains (2, PostgreSQL, http://www.postgresql.org/, whatever).DETAIL:  Failing row contains (2, PostgreSQL, http://www.postgresql.org/, whatever).
```

The following statement adds a `UNIQUE` constraint to the `url` column of the `links` table:

```shell
ALTER TABLE links
ADD CONSTRAINT unique_url UNIQUE ( url );
```

The following statement attempts to insert the url that already exists:

```sql
INSERT INTO links(link_title,url)
VALUES('PostgreSQL','https://neon.tech/postgresql/');
```

It causes an error due to the unique_url constraint:

```sql
ERROR:  duplicate key value violates unique constraint "unique_url"
DETAIL:  Key (url)=(https://neon.tech/postgresql/) already exists.
```

The following statement changes the name of the `links` table to `urls`:

```
ALTER TABLE links
RENAME TO urls;
```

In this tutorial, you have learned how to use the PostgreSQL `ALTER TABLE` statement to change the structure of an existing table.


# Rename Table

---
title: 'PostgreSQL Rename Table: A Step-by-Step Guide'
page_title: 'PostgreSQL Rename Table'
page_description: 'In this tutorial, you will learn how to rename a table to a new one using the ALTER TABLE ... RENAME TO statement.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-rename-table/'
ogImage: ''
updatedOn: '2024-02-19T04:29:25+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL ALTER TABLE'
  slug: 'postgresql-tutorial/postgresql-alter-table'
nextLink:
  title: 'PostgreSQL ADD COLUMN:  Add One or More Columns to a Table'
  slug: 'postgresql-tutorial/postgresql-add-column'
---

**Summary**: in this tutorial, you will show how to rename a table using the PostgreSQL `ALTER TABLE RENAME TO` statement.

## Introduction to PostgreSQL RENAME TABLE statement

To change the name of an existing table, you use the `ALTER TABLE... RENAME TO` statement as follows:

```phpsql
ALTER TABLE table_name
RENAME TO new_table_name;
```

In this statement:

- First, specify the name of the table which you want to rename after the `ALTER TABLE` clause.
- Second, assign the new table name after the `RENAME TO` clause.

If you rename a table that does not exist, PostgreSQL will issue an error.

To avoid the error, you can use the `IF EXISTS` option:

```sql
ALTER TABLE IF EXISTS table_name
RENAME TO new_table_name;
```

In this case, if the `table_name` does not exist, PostgreSQL will issue a notice instead.

To rename multiple tables, you have to execute multiple `ALTER TABLE ... RENAME TO` statements. It’s not possible to rename multiple tables using a single `ALTER TABLE` statement.

## PostgreSQL rename table examples

Let’s take some examples of using the `ALTER TABLE ... RENAME TO` statement.

### 1\) Basic PostgreSQL rename table statement example

First, [create a new table](postgresql-create-table) called `vendors` for the demonstration purpose:

```sql
CREATE TABLE vendors (
    id serial PRIMARY KEY,
    name VARCHAR NOT NULL
);
```

Second, describe the `vendors` table using the `\d` command in `psql`:

```text
\d vendors
```

Output:

```
                                 Table "public.vendors"
 Column |       Type        | Collation | Nullable |               Default
--------+-------------------+-----------+----------+-------------------------------------
 id     | integer           |           | not null | nextval('vendors_id_seq'::regclass)
 name   | character varying |           | not null |
Indexes:
    "vendors_pkey" PRIMARY KEY, btree (id)
```

Third, change the name of the `vendors` table to `suppliers` using the `ALTER TABLE...RENAME TO` statement:

```php
ALTER TABLE vendors
RENAME TO suppliers;
```

Finally, describe the `suppliers` table:

```text
                                Table "public.suppliers"
 Column |       Type        | Collation | Nullable |               Default
--------+-------------------+-----------+----------+-------------------------------------
 id     | integer           |           | not null | nextval('vendors_id_seq'::regclass)
 name   | character varying |           | not null |
Indexes:
    "vendors_pkey" PRIMARY KEY, btree (id)
```

Notice that the name of the table changed but the [sequence](postgresql-sequences) (`vendors_id_seq`) remains intact.

### 1\) Renaming a table that has dependent objects

First, create new tables called `customers` and `groups`:

```php
CREATE TABLE customer_groups(
    id SERIAL PRIMARY KEY,
    name VARCHAR NOT NULL
);

CREATE TABLE customers(
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    group_id INT NOT NULL,
    FOREIGN KEY (group_id) REFERENCES customer_groups(id)
       ON DELETE CASCADE
       ON UPDATE CASCADE
);
```

Second, [create a view](../postgresql-views/postgresql-materialized-views) based on the `customers` and `customer_groups` tables:

```sql
CREATE VIEW customer_data
AS SELECT
    c.id,
    c.name,
    g.name customer_group
FROM
    customers c
INNER JOIN customer_groups g ON g.id = c.group_id;
```

When you rename a table, PostgreSQL will automatically update its dependent objects such as [foreign key constraints](postgresql-foreign-key), [views](../postgresql-views), and [indexes](../postgresql-indexes).

Third, rename the `customer_groups` table to `groups`:

```sql
ALTER TABLE customer_groups
RENAME TO groups;
```

Fourth, verify the foreign key constraint in the `customers` table by showing the table via `\d` command in `psql`:

```
\d customers
```

Output:

```
                                     Table "public.customers"
  Column  |          Type          | Collation | Nullable |                Default
----------+------------------------+-----------+----------+---------------------------------------
 id       | integer                |           | not null | nextval('customers_id_seq'::regclass)
 name     | character varying(255) |           | not null |
 group_id | integer                |           | not null |
Indexes:
    "customers_pkey" PRIMARY KEY, btree (id)
Foreign-key constraints:
    "customers_group_id_fkey" FOREIGN KEY (group_id) REFERENCES groups(id) ON UPDATE CASCADE ON DELETE CASCADE
```

The output indicates that the foreign key constraint was updated and referenced the `groups` table instead of the `customer_groups` table.

Fifth, show the `customer_data` view in psql:

```php
\d+ customer_data
```

Output:

```
                                    View "public.customer_data"
     Column     |          Type          | Collation | Nullable | Default | Storage  | Description
----------------+------------------------+-----------+----------+---------+----------+-------------
 id             | integer                |           |          |         | plain    |
 name           | character varying(255) |           |          |         | extended |
 customer_group | character varying      |           |          |         | extended |
View definition:
 SELECT c.id,
    c.name,
    g.name AS customer_group
   FROM customers c
     JOIN groups g ON g.id = c.group_id;
```

The output shows that the `customer_groups` table in the [`SELECT`](postgresql-select) statement of the view was also updated to `groups` table.

## Summary

- Use the `ALTER TABLE ... RENAME TO` statement to rename a table.


# Add Column

---
title: 'PostgreSQL ADD COLUMN:  Add One or More Columns to a Table'
page_title: 'PostgreSQL ADD COLUMN: Add One or More Columns to a Table'
page_description: 'This tutorial shows you how to use the PostgreSQL ADD COLUMN statement to add one or more columns to an existing database table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-add-column/'
ogImage: '/postgresqltutorial/PostgreSQL-Add-Column-300x128.png'
updatedOn: '2024-01-25T04:01:41+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Rename Table: A Step-by-Step Guide'
  slug: 'postgresql-tutorial/postgresql-rename-table'
nextLink:
  title: 'PostgreSQL DROP COLUMN: Remove One or More Columns of a Table'
  slug: 'postgresql-tutorial/postgresql-drop-column'
---

![PostgreSQL Add Column](/postgresqltutorial/PostgreSQL-Add-Column-300x128.png?alignright)
**Summary**: in this tutorial, you will learn how to use the PostgreSQL `ADD COLUMN` statement to add one or more columns to an existing table.

## Introduction to the PostgreSQL ADD COLUMN statement

To add a new column to an existing table, you use the [`ALTER TABLE`](postgresql-alter-table) `ADD COLUMN` statement as follows:

```phpsqlsql
ALTER TABLE table_name
ADD COLUMN new_column_name data_type constraint;
```

In this syntax:

- First, specify the name of the table to which you want to add a new column after the `ALTER TABLE` keyword.
- Second, specify the name of the new column as well as its data type and constraint after the `ADD COLUMN` keywords.

When you add a new column to the table, PostgreSQL appends it at the end of the table. PostgreSQL has no option to specify the position of the new column in the table.

To add multiple columns to an existing table, you use multiple `ADD COLUMN` clauses in the `ALTER TABLE` statement as follows:

```sql
ALTER TABLE table_name
ADD COLUMN column_name1 data_type constraint,
ADD COLUMN column_name2 data_type constraint,
...
ADD COLUMN column_namen data_type constraint;

```

## PostgreSQL ADD COLUMN statement examples

Let’s take some examples of using the `ALTER TABLE...ADD COLUMN` statement.

### Creating a sample table

The following [`CREATE TABLE`](postgresql-create-table) statement creates a new table named `customers` with two columns: `id` and `customer_name`:

```sql
DROP TABLE IF EXISTS customers CASCADE;

CREATE TABLE customers (
    id SERIAL PRIMARY KEY,
    customer_name VARCHAR(255) NOT NULL
);
```

### 1\) Adding a new column to a table

First, add the `phone` column to the `customers` table using the `ALTER TABLE...ADD COLUMN` statement:

```sql
ALTER TABLE customers
ADD COLUMN phone VARCHAR(25);
```

Second, view the `customers` table in psql:

```text
\d customers
```

Output:

```
                                       Table "public.customers"
    Column     |          Type          | Collation | Nullable |                Default
---------------+------------------------+-----------+----------+---------------------------------------
 id            | integer                |           | not null | nextval('customers_id_seq'::regclass)
 customer_name | character varying(255) |           | not null |
 phone         | character varying(25)  |           |          |
Indexes:
    "customers_pkey" PRIMARY KEY, btree (id)
```

### 2\) Adding multiple columns to a table

First, add the `fax` and `email` columns to the `customers` table:

```php
ALTER TABLE customers
ADD COLUMN fax VARCHAR (25),
ADD COLUMN email VARCHAR (400);
```

Second, view the structure of the `customers` table in `psql`:

```text
\d customers
```

Output:

```text
                                       Table "public.customers"
    Column     |          Type          | Collation | Nullable |                Default
---------------+------------------------+-----------+----------+---------------------------------------
 id            | integer                |           | not null | nextval('customers_id_seq'::regclass)
 customer_name | character varying(255) |           | not null |
 phone         | character varying(25)  |           |          |
 fax           | character varying(25)  |           |          |
 email         | character varying(400) |           |          |
Indexes:
    "customers_pkey" PRIMARY KEY, btree (id)
```

The output shows the `fax` and `email` columns were added to the `customers` table.

### 3\) Adding a column with a NOT NULL constraint to a table that already has data

First, [insert data](postgresql-insert) into the `customers` table:

```
INSERT INTO
   customers (customer_name)
VALUES
   ('Apple'),
   ('Samsung'),
   ('Sony')
RETURNING *;
```

Output:

```text
 id | customer_name | phone | fax  | email
----+---------------+-------+------+-------
  4 | Apple         | null  | null | null
  5 | Samsung       | null  | null | null
  6 | Sony          | null  | null | null
(3 rows)


INSERT 0 3
```

Second, attempt to add the `contact_name` column to the `customers` table:

```
ALTER TABLE customers
ADD COLUMN contact_name VARCHAR(255) NOT NULL;
```

PostgreSQL issued an error:

```sql
ERROR:  column "contact_name" of relation "customers" contains null values
```

This is because the `contact_name` column has the [`NOT NULL`](postgresql-not-null-constraint) constraint. When PostgreSQL added the column, this new column received `NULL`, which violates the `NOT NULL` constraint.

To address this issue, you can follow these steps:

First, add the `contact_name` column without the `NOT NULL` constraint:

```sql
ALTER TABLE customers
ADD COLUMN contact_name VARCHAR(255);
```

Second, update the values in the `contact_name` column.

```sql
UPDATE customers
SET contact_name = 'John Doe'
WHERE id = 1;

UPDATE customers
SET contact_name = 'Mary Doe'
WHERE id = 2;

UPDATE customers
SET contact_name = 'Lily Bush'
WHERE id = 3;
```

If you have contact data from other tables, you can update the contact names in the `customers` table based on the data from those tables using the [update join statement](postgresql-update-join).

Third, modify the `contact_name` column to add the `NOT NULL` constraint:

```sql
ALTER TABLE customers
ALTER COLUMN contact_name
SET NOT NULL;
```

## Summary

- Use the PostgreSQL `ALTER TABLE...ADD COLUMN` statement to add one or more columns to a table.


# Drop Column

---
title: 'PostgreSQL DROP COLUMN: Remove One or More Columns of a Table'
page_title: 'PostgreSQL DROP COLUMN'
page_description: 'This tutorial shows you how to use the PostgreSQL DROP COLUMN clause in the ALTER TABLE statement to remove one or more columns of a table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-drop-column/'
ogImage: '/postgresqltutorial/PostgreSQL-Drop-Column-300x128.png'
updatedOn: '2024-01-25T04:15:44+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL ADD COLUMN:  Add One or More Columns to a Table'
  slug: 'postgresql-tutorial/postgresql-add-column'
nextLink:
  title: 'PostgreSQL Change Column Type'
  slug: 'postgresql-tutorial/postgresql-change-column-type'
---

![PostgreSQL DROP COLUMN](/postgresqltutorial/PostgreSQL-Drop-Column-300x128.png?alignright)
**Summary**: In this tutorial, you will learn how to use the PostgreSQL `DROP COLUMN` clause in the `ALTER TABLE` statement to remove one or more columns from a table.

## Introduction to PostgreSQL DROP COLUMN clause

To drop a column of a table, you use the `DROP COLUMN` clause in the [`ALTER TABLE`](postgresql-alter-table) statement as follows:

```shellsql
ALTER TABLE table_name
DROP COLUMN column_name;
```

When you remove a column from a table, PostgreSQL will automatically remove all of the [indexes](../postgresql-indexes) and constraints that involved the dropped column.

If the column that you want to remove is used in other database objects such as [views](../postgresql-views), [triggers](../postgresql-triggers), and [stored procedures](https://neon.tech/postgresql/postgresql-stored-procedures/), you cannot drop the column because other objects depend on it.

In this case, you can use the `CASCADE` option in the `DROP COLUMN` clause to drop the column and all of its dependent objects:

```sql
ALTER TABLE table_name
DROP COLUMN column_name CASCADE;
```

If you remove a column that does not exist, PostgreSQL will issue an error. To remove a column if it exists only, you can use the `IF EXISTS` option as follows:

```sql
ALTER TABLE table_name
DROP COLUMN IF EXISTS column_name;
```

In this syntax, if you remove a column that does not exist, PostgreSQL will issue a notice instead of an error.

If you want to drop multiple columns of a table simultaneously, you use multiple `DROP COLUMN` clauses in the `ALTER TABLE` statement like this:

```sql
ALTER TABLE table_name
DROP COLUMN column_name1,
DROP COLUMN column_name2,
...;
```

Notice that you need to add a comma (`,`) after each `DROP COLUMN` clause.

If a table has one column, you can use drop it using the `ALTER TABLE...DROP COLUMN` statement. Consequently, the table will have no columns.

It’s worth noting that while PostgreSQL allows a table that has no column, it may be not allowed according to the standard SQL.

## PostgreSQL DROP COLUMN examples

Let’s look at some examples to see how the `ALTER TABLE...DROP COLUMN` statement works.

We will create three tables: `books`, `categories`, and `publishers` for the demonstration.

![PostgreSQL DROP COLUMN Example Diagram](/postgresqltutorial/PostgreSQL-DROP-COLUMN-Example-Diagram.png)In this diagram, each book has only one publisher and each publisher can publish many books. Each book is assigned to a category and each category can have many books.

The following statements create the three tables:

```sql
CREATE TABLE publishers (
    publisher_id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL
);

CREATE TABLE categories (
    category_id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL
);

CREATE TABLE books (
    book_id SERIAL PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    isbn VARCHAR(255) NOT NULL,
    published_date DATE NOT NULL,
    description VARCHAR,
    category_id INT NOT NULL,
    publisher_id INT NOT NULL,
    FOREIGN KEY (publisher_id)
       REFERENCES publishers (publisher_id),
    FOREIGN KEY (category_id)
       REFERENCES categories (category_id)
);

```

Additionally, we [create a view](../postgresql-views/managing-postgresql-views) based on the `books` and `publishers` tables as follows:

```sql
CREATE VIEW book_info
AS SELECT
    book_id,
    title,
    isbn,
    published_date,
    name
FROM
    books b
INNER JOIN publishers
    USING(publisher_id)
ORDER BY title;
```

### 1\) Drop a column example

First, drop the `category_id` column in the `books` table using the `ALTER TABLE...DROP COLUMN` statement:

```sql
ALTER TABLE books
DROP COLUMN category_id;
```

Second, view the structure of the `books` table in psql:

```text
\d books
```

Output:

```
                                          Table "public.books"
     Column     |          Type          | Collation | Nullable |                Default
----------------+------------------------+-----------+----------+----------------------------------------
 book_id        | integer                |           | not null | nextval('books_book_id_seq'::regclass)
 title          | character varying(255) |           | not null |
 isbn           | character varying(255) |           | not null |
 published_date | date                   |           | not null |
 description    | character varying      |           |          |
 publisher_id   | integer                |           | not null |
Indexes:
    "books_pkey" PRIMARY KEY, btree (book_id)
Foreign-key constraints:
    "books_publisher_id_fkey" FOREIGN KEY (publisher_id) REFERENCES publishers(publisher_id)
```

The output indicates that the statement removes both the `category_id` column and the [foreign key constraint](postgresql-foreign-key) that involves the `category_id` column.

### 2\) Drop a column that is referenced by a constraint

First, attempt to remove the `publisher_id` column from the `books` table:

```shell
ALTER TABLE books
DROP COLUMN publisher_id;
```

PostgreSQL issued the following error:

```sql
ERROR:  cannot drop table books column publisher_id because other objects depend on it
DETAIL:  view book_info depends on table books column publisher_id
HINT:  Use DROP ... CASCADE to drop the dependent objects too.

```

The output states that the `book_info` view is using the column `publisher_id` of the `books` table. You need to use the `CASCADE` option to remove both the `publisher_id` column and `book_info` view as shown in the following statement:

```php
ALTER TABLE books
DROP COLUMN publisher_id CASCADE;
```

The statement issued the following notice indicating that the view book_info was also removed:

```sql
NOTICE:  drop cascades to view book_info
ALTER TABLE
```

### 3\) Drop multiple columns example

To remove both `isbn` and `description` columns simultaneously, you can use multiple `DROP COLUMN` clauses as follows:

```sql
ALTER TABLE books
  DROP COLUMN isbn,
  DROP COLUMN description;
```

When viewing the books table, you’ll see that those columns were removed:

```
\d books
```

Output:

```
                                          Table "public.books"
     Column     |          Type          | Collation | Nullable |                Default
----------------+------------------------+-----------+----------+----------------------------------------
 book_id        | integer                |           | not null | nextval('books_book_id_seq'::regclass)
 title          | character varying(255) |           | not null |
 published_date | date                   |           | not null |
Indexes:
    "books_pkey" PRIMARY KEY, btree (book_id)
```

## Summary

- Use the PostgreSQL `ALTER TABLE ... DROP COLUMN` statement to drop one or more columns from a table.


# Change Column's Data Type

---
title: 'PostgreSQL Change Column Type'
page_title: 'PostgreSQL Change Column Type'
page_description: 'This tutorial shows you step by step how to change the data type of a column by using the ALTER TABLE ALTER COLUMN SET DATA TYPE statement.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-change-column-type/'
ogImage: ''
updatedOn: '2024-01-25T05:13:35+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL DROP COLUMN: Remove One or More Columns of a Table'
  slug: 'postgresql-tutorial/postgresql-drop-column'
nextLink:
  title: 'PostgreSQL RENAME COLUMN: Renaming a column'
  slug: 'postgresql-tutorial/postgresql-rename-column'
---

**Summary**: this tutorial shows you step\-by\-step how to change the data type of a column by using the `ALTER TABLE... ALTER COLUMN` statement.

## PostgreSQL change column type statement

To change the [data type](postgresql-time) of a column, you use the [`ALTER TABLE`](postgresql-alter-table) statement as follows:

```sqlsql
ALTER TABLE table_name
ALTER COLUMN column_name
[SET DATA] TYPE new_data_type;
```

In this syntax:

- First, specify the name of the table to which the column you want to change after the `ALTER TABLE` keywords.
- Second, provide the name of the column that you want to change the data type after the `ALTER COLUMN` clause.
- Third, supply the new data type for the column after the `TYPE` keyword. The `SET DATA TYPE` and `TYPE` are equivalent.

To change the data types of multiple columns in a single statement, you use multiple `ALTER COLUMN` clauses like this:

```sql
ALTER TABLE table_name
ALTER COLUMN column_name1 [SET DATA] TYPE new_data_type,
ALTER COLUMN column_name2 [SET DATA] TYPE new_data_type,
...;
```

In this syntax, you add a comma (`,`) after each `ALTER COLUMN` clause.

PostgreSQL allows you to convert the values of a column to the new ones while changing its data type by adding a `USING` clause as follows:

```sql
ALTER TABLE table_name
ALTER COLUMN column_name TYPE new_data_type USING expression;
```

The `USING` clause specifies an expression that allows you to convert the old values to the new ones.

If you omit the `USING` clause, PostgreSQL will cast the values to the new ones implicitly. If the cast fails, PostgreSQL will issue an error and recommend you provide the `USING` clause with an expression for the data conversion.

The expression after the `USING` keyword can be as simple as `column_name::new_data_type` such as `price::numeric` or as complex as a custom function.

## PostgreSQL change column type examples

Let’s take some examples of changing column type.

### Setting up a sample table

The following [creates a new table](postgresql-create-table) called `assets` and [insert](postgresql-insert) some rows into the table:

```sql
CREATE TABLE assets (
    id serial PRIMARY KEY,
    name TEXT NOT NULL,
    asset_no VARCHAR NOT NULL,
    description TEXT,
    location TEXT,
    acquired_date DATE NOT NULL
);

INSERT INTO assets(name,asset_no,location,acquired_date)
VALUES('Server','10001','Server room','2017-01-01'),
      ('UPS','10002','Server room','2017-01-01')
RETURNING *;
```

Output:

```text
 id |  name  | asset_no | description |  location   | acquired_date
----+--------+----------+-------------+-------------+---------------
  1 | Server | 10001    | null        | Server room | 2017-01-01
  2 | UPS    | 10002    | null        | Server room | 2017-01-01
(2 rows)
```

### 1\) Changing one column example

The following example uses the `ALTER TABLE ... ALTER COLUMN` statement to change the data type of the `name` column to [`VARCHAR`](postgresql-char-varchar-text):

```
ALTER TABLE assets
ALTER COLUMN name TYPE VARCHAR(255);
```

Output:

```sql
ALTER TABLE
```

The output indicates that the statement successfully changed the type of the column.

### 2\) Changing multiple columns example

The following statement changes the data types of `description` and `location` columns from [`TEXT`](postgresql-char-varchar-text) to `VARCHAR`:

```
ALTER TABLE assets
    ALTER COLUMN location TYPE VARCHAR(255),
    ALTER COLUMN description TYPE VARCHAR(255);
```

Output:

```sql
ALTER TABLE
```

### 3\) Changing a column from VARCHAR to INT example

The following example uses the `ALTER TABLE ... ALTER COLUMN` statement to change the data type of the `asset_no` column to [integer](postgresql-integer):

```
ALTER TABLE assets
ALTER COLUMN asset_no TYPE INT;
```

PostgreSQL issued an error and a helpful hint:

```sql
ERROR:  column "asset_no" cannot be cast automatically to type integer
HINT:  You might need to specify "USING asset_no::integer".
```

To both change the type of a column and cast data from `VARCHAR` to `INT`, you can use the `USING` clause:

```sql
ALTER TABLE assets
ALTER COLUMN asset_no TYPE INT
USING asset_no::integer;
```

Output:

```
ALTER TABLE
```

## Summary

- Use the `ALTER TABLE ... ALTER COLUMN` statement to change the data type of a column.


# Rename Column

---
title: 'PostgreSQL RENAME COLUMN: Renaming a column'
page_title: 'PostgreSQL RENAME COLUMN'
page_description: 'You will learn how to use the PostgreSQL RENAME COLUMN clause in the ALTER TABLE statement to rename a column of a table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-rename-column/'
ogImage: '/postgresqltutorial/postgresql-rename-column-300x254.png'
updatedOn: '2024-01-25T06:33:58+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Change Column Type'
  slug: 'postgresql-tutorial/postgresql-change-column-type'
nextLink:
  title: 'PostgreSQL DROP TABLE'
  slug: 'postgresql-tutorial/postgresql-drop-table'
---

![PostgreSQL RENAME COLUMN](/postgresqltutorial/postgresql-rename-column-300x254.png?alignright)**Summary**: in this tutorial, you will learn how to use the PostgreSQL `RENAME COLUMN` clause in the `ALTER TABLE` statement to rename one or more columns of a table.

## Introduction to PostgreSQL RENAME COLUMN clause

To rename a column of a table, you use the [`ALTER TABLE`](postgresql-alter-table) statement with `RENAME COLUMN` clause as follows:

```shellsql
ALTER TABLE table_name
RENAME COLUMN column_name TO new_column_name;
```

In this statement:

- First, specify the name of the table that contains the column which you want to rename after the `ALTER TABLE` clause.
- Second, provide the name of the column that you want to rename after the `RENAME COLUMN` keywords.
- Third, specify the new name for the column after the `TO` keyword.

The `COLUMN` keyword in the statement is optional therefore you can omit it like this:

```sql
ALTER TABLE table_name
RENAME column_name TO new_column_name;
```

For some reason, if you try to rename a column that does not exist, PostgreSQL will issue an error. Unfortunately, PostgreSQL does not support the `IF EXISTS` option for the `RENAME` clause.

To rename multiple columns, you execute the `ALTER TABLE RENAME COLUMN` statement multiple times, one column at a time:

```sql
ALTER TABLE table_name
RENAME column_name1 TO new_column_name1;

ALTER TABLE table_name
RENAME column_name2 TO new_column_name2;
```

If you rename a column referenced by other database objects such as [views](../postgresql-views), [foreign key constraints](postgresql-foreign-key), [triggers](../postgresql-triggers), and [stored procedures](https://neon.tech/postgresql/postgresql-stored-procedures/), PostgreSQL will automatically change the column name in the dependent objects.

## PostgreSQL RENAME COLUMN examples

Let’s take some examples of using the `ALTER TABLE RENAME COLUMN` statement to rename a column.

### Setting up sample tables

First, [create two new tables](postgresql-create-table) `customers` and `customer_groups`.

```sql
CREATE TABLE customer_groups (
  id serial PRIMARY KEY,
  name VARCHAR NOT NULL
);
CREATE TABLE customers (
  id serial PRIMARY KEY,
  name VARCHAR NOT NULL,
  phone VARCHAR NOT NULL,
  email VARCHAR,
  group_id INT,
  FOREIGN KEY (group_id) REFERENCES customer_groups (id)
);
```

Then, [create a new view](../postgresql-views/managing-postgresql-views) named `customer_data` based on the `customers` and `customer_groups` tables.

```sql
CREATE VIEW customer_data AS
SELECT
  c.id,
  c.name,
  g.name customer_group
FROM
  customers c
  INNER JOIN customer_groups g ON g.id = c.group_id;
```

### 1\) Renaming one column example

The following statement uses the `ALTER TABLE RENAME COLUMN` statement to rename the `email` column of the `customers` table to `contact_email`:

```sql
ALTER TABLE customers
RENAME COLUMN email TO contact_email;
```

### 2\) Renaming a column that has dependent objects example

This example uses the `ALTER TABLE RENAME COLUMN` statement to change the `name` column of the `customer_groups` table to `group_name`:

```sql
ALTER TABLE customer_groups
RENAME COLUMN name TO group_name;
```

Note that the name column is used in the `customer_data` view.

Now, you can check whether the change in the `name` column was cascaded to the `customer_data` view:

```text
\d+ customer_data
```

Output:

```
                       View "public.customer_data"
     Column     |       Type        | Modifiers | Storage  | Description
----------------+-------------------+-----------+----------+-------------
 id             | integer           |           | plain    |
 name           | character varying |           | extended |
 customer_group | character varying |           | extended |
View definition:
 SELECT c.id,
    c.name,
    g.group_name AS customer_group
   FROM customers c
     JOIN customer_groups g ON g.id = c.group_id;
```

The output indicates that the `name` column has been changed to `group_name`.

### 3\) Using multiple RENAME COLUMN statements to rename multiple columns example

These statements rename two columns `name` and `phone` of the `customers` table to `customer_name` and `contact_phone` respectively:

```
ALTER TABLE customers
RENAME COLUMN name TO customer_name;

ALTER TABLE customers
RENAME COLUMN phone TO contact_phone;
```

## Summary

- Use the PostgreSQL `ALTER TABLE...RENAME COLUMN` statement to rename a column.


# Drop Table

---
title: 'PostgreSQL DROP TABLE'
page_title: 'PostgreSQL DROP TABLE'
page_description: 'in this tutorial, you will learn how to use the PostgreSQL DROP TABLE statement to remove one or more tables from the database.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-drop-table/'
ogImage: ''
updatedOn: '2024-01-24T10:32:29+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL RENAME COLUMN: Renaming a column'
  slug: 'postgresql-tutorial/postgresql-rename-column'
nextLink:
  title: 'PostgreSQL TRUNCATE TABLE'
  slug: 'postgresql-tutorial/postgresql-truncate-table'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `DROP TABLE` statement to remove one or more tables from the database.

## Introduction to PostgreSQL DROP TABLE statement

To drop a table from the database, you use the `DROP TABLE` statement as follows:

```shellsql
DROP TABLE [IF EXISTS] table_name
[CASCADE | RESTRICT];
```

In this syntax:

- First, specify the name of the table that you want to drop after the `DROP TABLE` keywords.
- Second, use the `IF EXISTS` option to remove the table only if it exists.

If you remove a table that does not exist, PostgreSQL issues an error. To avoid the error, you can use the `IF EXISTS` option.

If the table is used in other database objects such as [views](../postgresql-views), [triggers](../postgresql-triggers/enable-triggers), functions, and stored procedures, you cannot remove it. In this case, you have two options:

- Use the `CASCADE` option to remove the table and its dependent objects.
- Use the `RESTRICT` option rejects the removal if there is any object depending on the table. The `RESTRICT` option is the default if you don’t explicitly specify it in the `DROP TABLE` statement.

To remove multiple tables simultaneously, you can place the tables separated by commas after the `DROP TABLE` keywords:

```sql
DROP TABLE [IF EXISTS]
   table_name_1,
   table_name_2,
   ...
[CASCADE | RESTRICT];
```

Note that you need to have the roles of the superuser, schema owner, or table owner to drop tables.

## PostgreSQL DROP TABLE examples

Let’s take some examples of using the PostgreSQL `DROP TABLE` statement.

### 1\) Drop a table that does not exist

The following statement removes a table named `author` in the database:

```sql
DROP TABLE author;
```

PostgreSQL issues an error because the `author` table does not exist.

```sql
[Err] ERROR:  table "author" does not exist
```

To avoid the error, you can use the `IF EXISTS` option like this.

```shell
DROP TABLE IF EXISTS author;
```

```sql
NOTICE:  table "author" does not exist, skipping DROP TABLE
```

The output indicates that PostgreSQL issued a notice instead of an error.

### 2\) Drop a table that has dependent objects

The following [creates new tables](postgresql-create-table 'PostgreSQL CREATE TABLE') called `authors` and `pages`. The `pages` table has a foreign key that references the `authors` table.

```shell
CREATE TABLE authors (
  author_id INT PRIMARY KEY,
  firstname VARCHAR (50) NOT NULL,
  lastname VARCHAR (50) NOT NULL
);

CREATE TABLE pages (
  page_id SERIAL PRIMARY KEY,
  title VARCHAR (255) NOT NULL,
  contents TEXT,
  author_id INT NOT NULL,
  FOREIGN KEY (author_id) REFERENCES authors (author_id)
);
```

The following statement uses the `DROP TABLE` to drop the `authors` table:

```sql
DROP TABLE IF EXISTS authors;
```

Because the `authors` table has a dependent object which is a foreign key that references the `pages` table, PostgreSQL issues an error message:

```sql
ERROR:  cannot drop table authors because other objects depend on it
DETAIL:  constraint pages_author_id_fkey on table pages depends on table authors
HINT:  Use DROP ... CASCADE to drop the dependent objects too.
```

In this case, you need to remove all dependent objects first before dropping the `author` table or use `CASCADE` option as follows:

```shell
DROP TABLE authors CASCADE;
```

This statement deletes the `authors` table as well as the constraint in the `pages` table.

If the `DROP TABLE` statement removes the dependent objects of the table that are being dropped, it will issue a notice like this:

```sql
NOTICE:  drop cascades to constraint pages_author_id_fkey on table pages
DROP TABLE
```

### 3\) Drop multiple tables

The following statements create two tables for the demo purposes:

```
CREATE TABLE tvshows(
  tvshow_id INT GENERATED ALWAYS AS IDENTITY,
  title VARCHAR,
  release_year SMALLINT,
  PRIMARY KEY(tvshow_id)
);

CREATE TABLE animes(
  anime_id INT GENERATED ALWAYS AS IDENTITY,
  title VARCHAR,
  release_year SMALLINT,
  PRIMARY KEY(anime_id)
);
```

The following example uses a single `DROP TABLE` statement to drop the `tvshows` and `animes` tables:

```sql
DROP TABLE tvshows, animes;
```

## Summary

- Use the `DROP TABLE` statement to drop one or more tables.
- Use the `CASCADE` option to drop a table and all of its dependent objects.


# Temporary Table

---
title: 'PostgreSQL Temporary Table'
page_title: 'PostgreSQL Temporary Table'
page_description: 'You will learn about the PostgreSQL temporary table and how to manage it using the CREATE TEMP TABLE and DROP TABLE statements.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-temporary-table/'
ogImage: '/postgresqltutorial/PostgreSQL-Temporary-Table-300x254.png'
updatedOn: '2024-02-18T10:49:32+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL TRUNCATE TABLE'
  slug: 'postgresql-tutorial/postgresql-truncate-table'
nextLink:
  title: 'PostgreSQL Copy Table: A Step-by-Step Guide with Practical Examples'
  slug: 'postgresql-tutorial/postgresql-copy-table'
---

![PostgreSQL Temporary Table](/postgresqltutorial/PostgreSQL-Temporary-Table-300x254.png?alignright)**Summary**: in this tutorial, you will learn about the PostgreSQL temporary table and how to manage it effectively.

## Introduction to the PostgreSQL temporary tables

In PostgreSQL, a temporary table is a table that exists only during a database session. It is created and used within a single database session and is automatically dropped at the end of the session.

### Creating a temporary table

To create a temporary table, you use the `CREATE TEMPORARY TABLE` statement:

```sqlsqlsql
CREATE TEMPORARY TABLE table_name(
   column1 datatype(size) constraint,
   column1 datatype(size) constraint,
   ...,
   table_constraints
);
```

In this syntax:

- First, specify the name of the temporary table that you want to create after the `CREATE TEMPORARY TABLE` keywords.
- Second, define a list of columns for the table.

The `TEMP` and `TEMPORARY` keywords are equivalent so you can use them interchangeably:

```sql
CREATE TEMP TABLE table_name(
   ...
);
```

The following example uses the `CREATE TEMP TABLE` to create a new temporary table `mytemp`:

```sql
CREATE TEMP TABLE mytemp(id INT);

INSERT INTO mytemp(id) VALUES(1), (2), (3)
RETURNING *;
```

Output:

```
 id
----
  1
  2
  3
(3 rows)
```

If you open a second database session and query data from the `mytemp` table, you’ll get an error

```
SELECT * FROM mytemp;
```

Error:

```
ERROR:  relation "mytemp" does not exist
LINE 1: SELECT * FROM mytemp;
```

The output indicates that the second session could not see the `mytemp` table.

If you terminate the current database session and attempt to query data from the `mytemp` table, you’ll encounter an error. This is because the temporary table was dropped when the session that created it ended.

### PostgreSQL temporary table names

A temporary table can have the same name as a permanent table, even though it is not recommended.

When you create a temporary table that shares the same name as a permanent table, you cannot access the permanent table until the temporary table is removed. Consider the following example:

First, [create a table](postgresql-create-table) named `customers`:

```
CREATE TABLE customers(
   id SERIAL PRIMARY KEY,
   name VARCHAR NOT NULL
);
```

Second, create a temporary table with the same name: `customers`

```sql
CREATE TEMP TABLE customers(
    customer_id INT
);
```

Now, query data from the  `customers` table:

```sql
SELECT * FROM customers;
```

Output:

```text
 customer_id
-------------
(0 rows)
```

This time PostgreSQL accessed the temporary table `customers` instead of the permanent one.

Note that PostgreSQL creates temporary tables in a special [schema](../postgresql-administration/postgresql-schema), therefore, you cannot specify the schema in the `CREATE TEMP TABLE` statement.

If you [list the tables](../postgresql-administration/postgresql-show-tables) in psql, you will see the temporary table `customers` only, not the permanent one:

```
\dt+
```

Output:

```
  Schema   |   Name    | Type  |  Owner   | Persistence | Access method |    Size    | Description
-----------+-----------+-------+----------+-------------+---------------+------------+-------------
 pg_temp_3 | customers | table | postgres | temporary   | heap          | 0 bytes    |
 pg_temp_3 | mytemp    | table | postgres | temporary   | heap          | 8192 bytes |
(2 rows)
```

The output shows the schema of the `customers` temporary table is `pg_temp_3`.

In this case, access to the permanent table requires qualifying the table name with its schema. For example:

```sql
SELECT * FROM public.customers;
```

### Removing a PostgreSQL temporary table

To drop a temporary table, you use the [`DROP TABLE`](postgresql-drop-table) statement. The following statement uses the `DROP TABLE` statement to drop a temporary table:

```
DROP TABLE temp_table_name;
```

Unlike the `CREATE TABLE` statement, the `DROP TABLE` statement does not have the `TEMP` or `TEMPORARY` keyword created specifically for temporary tables.

For example, the following statement drops the temporary table `customers` that we have created in the above example:

```sql
DROP TABLE customers;
```

## When to use temporary tables

**Isolation of data**: Since the temporary tables are session\-specific, different sessions or transactions can use the same table name for temporary tables without causing a conflict. This allows you to isolate data for a specific task or session.

**Intermediate storage**: Temporary tables can be useful for storing the intermediate results of a complex query. For example, you can break down a complex query into multiple simple ones and use temporary tables as the intermediate storage for storing the partial results.

**Transaction scope**: Temporary tables can be also useful if you want to store intermediate results within a transaction. In this case, the temporary tables will be visible only to that transaction

## Summary

- A temporary table is a short\-lived table that exists during a database session or a transaction.
- Use `the CREATE TEMP TABLE` statement to create a temporary table.
- Use the `DROP TABLE` statement to drop a temporary table.


# Truncate Table

---
title: 'PostgreSQL TRUNCATE TABLE'
page_title: 'PostgreSQL TRUNCATE TABLE'
page_description: 'This tutorial shows you how to use the PostgreSQL TRUNCATE TABLE statement to delete data from large tables quickly and more efficiently.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-truncate-table/'
ogImage: ''
updatedOn: '2024-01-25T02:04:03+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL DROP TABLE'
  slug: 'postgresql-tutorial/postgresql-drop-table'
nextLink:
  title: 'PostgreSQL Temporary Table'
  slug: 'postgresql-tutorial/postgresql-temporary-table'
---

**Summary**: in this tutorial, you will learn how to use PostgreSQL `TRUNCATE TABLE` statement to quickly delete all data from large tables.

## Introduction to PostgreSQL TRUNCATE TABLE statement

To remove all data from a table, you use the [`DELETE`](postgresql-delete) statement without a [WHERE](postgresql-where) clause. However, when the table has numerous data, the `DELETE` statement is not efficient. In this case, you can use the `TRUNCATE TABLE` statement.

The `TRUNCATE TABLE` statement deletes all data from a table very fast. Here’s the basic syntax of the `TRUNCATE TABLE` statement:

```phpsqlsql
TRUNCATE TABLE table_name;
```

In this syntax, you specify the name of the table that you want to delete data after the TRUNCATE TABLE keywords.

### Remove all data from multiple tables

To remove all data from multiple tables at once, you separate the tables by commas (,) as follows:

```sql
TRUNCATE TABLE
    table_name1,
    table_name2,
    ...;
```

In this syntax, you specify the name of the tables that you want to delete all data after the `TRUNCATE TABLE` keywords.

### Remove all data from a table that has foreign key references

In practice, the table you want to delete all data often has [foreign key](postgresql-foreign-key) references from other tables.

By default, the `TRUNCATE TABLE` statement does not remove any data from the table that has foreign key references.

To remove data from a table and other tables that have foreign key references the table, you use `CASCADE` option in the `TRUNCATE TABLE` statement as follows :

```sql
TRUNCATE TABLE table_name
CASCADE;
```

## PostgreSQL TRUNCATE TABLE statement examples

Let’s explore some examples of using the `TRUNCATE TABLE` statement.

### 1\) Basic PostgreSQL TRUNCATE TABLE statement example

First, create a new table called `products`:

```sql
CREATE TABLE products(
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    price DECIMAL(10,2) NOT NULL DEFAULT 0
);
```

Second, insert some rows into the `products` table:

```sql
INSERT INTO products (name, price)
VALUES
    ('A', 19.99),
    ('B', 29.99),
    ('C', 39.99),
    ('D', 49.99)
RETURNING *;
```

Output:

```text
 id | name | price
----+------+-------
  1 | A    | 19.99
  2 | B    | 29.99
  3 | C    | 39.99
  4 | D    | 49.99
(4 rows)
```

Third, delete all data from the `products` table using the `TRUNCATE TABLE` statement:

```
TRUNCATE TABLE products;
```

Output:

```sql
TRUNCATE TABLE
```

### 2\) Using PostgreSQL TRUNCATE TABLE statement to delete all data from multiple tables

First, create a table called `customers` and insert data into it:

```
CREATE TABLE customers(
   id SERIAL PRIMARY KEY,
   name VARCHAR(255) NOT NULL,
   phone VARCHAR(25) NOT NULL
);

INSERT INTO customers (name, phone) VALUES
    ('John Doe', '123-456-7890'),
    ('Jane Smith', '987-654-3210'),
    ('Robert Johnson', '555-123-4567')

RETURNING *;
```

Second, create a table called `vendors` and insert data into it:

```sql
CREATE TABLE vendors(
   id SERIAL PRIMARY KEY,
   name VARCHAR(255) NOT NULL,
   phone VARCHAR(25) NOT NULL
);

INSERT INTO vendors (name, phone) VALUES
    ('ABC Electronics', '555-123-4567'),
    ('XYZ Supplies', '999-888-7777'),
    ('Tech Solutions Inc.', '111-222-3333')

RETURNING *;
```

Third, delete data from the customers and vendors tables using the TRUNCATE TABLE statement:

```sql
TRUNCATE TABLE customers, vendors;
```

### 3\) Using PostgreSQL TRUNCATE TABLE statement to delete data from a table referenced by a foreign key

First, create tables `orders` and `order_details`:

```sql
CREATE TABLE orders(
  order_id SERIAL PRIMARY KEY,
  customer_name VARCHAR(255) NOT NULL,
  ordered_date DATE NOT NULL,
  status VARCHAR(20) NOT NULL
);

CREATE TABLE order_items (
  order_id INT NOT NULL,
  item_id INT NOT NULL,
  product_name VARCHAR(255) NOT NULL,
  quantity INT NOT NULL,
  FOREIGN KEY (order_id)
     REFERENCES orders(order_id) ON DELETE CASCADE ON UPDATE CASCADE,
  PRIMARY KEY (order_id, item_id)
);

INSERT INTO orders (customer_name, ordered_date, status)
VALUES
  ('John Doe', '2024-01-25', 'Processing'),
  ('Jane Smith', '2024-01-26', 'Shipped'),
  ('Bob Johnson', '2024-01-27', 'Delivered');

INSERT INTO order_items (order_id, item_id, product_name, quantity)
VALUES
  (1, 1, 'A', 2),
  (1, 2, 'B', 1),
  (2, 1, 'C', 3),
  (3, 1, 'D', 5),
  (3, 2, 'E', 2);
```

Second, attempt to truncate data from the `orders` table:

```sql
TRUNCATE TABLE orders;
```

PostgreSQL issues the following error:

```sql
DETAIL:  Table "order_items" references "orders".
HINT:  Truncate table "order_items" at the same time, or use TRUNCATE ... CASCADE.
```

The reason is that the `orders` table is referenced by the `order_items` table. To truncate both the `orders` and `order_items` tables at the same time, you can use the `CASCADE` option.

Third, truncate data from both `orders` and `order_items` tables:

```
TRUNCATE TABLE orders CASCADE;
```

PostgreSQL issues the following notice indicating that the `order_items` is also truncated:

```sql
NOTICE:  truncate cascades to table "order_items"
TRUNCATE TABLE
```

Note that the `TRUNCATE TABLE` statement uses the `RESTRICT` option by default to prevent a table that is referenced by a foreign key from being truncated.

## Restarting sequence

Besides removing data, you may want to reset the values of the [identity column](postgresql-identity-column) by using the `RESTART IDENTITY` option like this:

```
TRUNCATE TABLE table_name
RESTART IDENTITY;
```

For example, the following statement removes all rows from the `products` table and resets the [sequence](postgresql-sequences) associated with the `id` column:

```sql
TRUNCATE TABLE products
RESTART IDENTITY;
```

By default, the  `TRUNCATE TABLE` statement uses the `CONTINUE IDENTITY` option. This option does not restart the value in the sequence associated with the column in the table.

## TRUNCATE TABLE statement and ON DELETE trigger

Even though the `TRUNCATE TABLE` statement removes all data from a table, it does not fire any `ON DELETE` [triggers](../postgresql-triggers) associated with the table.

To fire the trigger when the `TRUNCATE TABLE` statement executes, you need to define  `BEFORE TRUNCATE` and/or  `AFTER TRUNCATE` triggers for that table.

## TRUNCATE TABLE statement and transactions

The `TRUNCATE TABLE` is transaction\-safe, meaning that you can place it within a transaction.

## Why TRUNCATE TABLE statement is more efficient than the DELETE statement

The `TRUNCATE TABLE` statement is more efficient than the `DELETE` statement due to the following main reasons:

- **Minimal logging**: The `TRUNCATE TABLE` statement doesn’t generate individual row deletion logs. Instead, it deallocates entire data pages making it faster than the `DELETE` statement.
- **Fewer resources**: The truncate operation is more lightweight than the delete option because it doesn’t generate as much undo and redo information. It releases storage space without scanning individual rows.
- **Lower\-level locking mechanism**: The truncate operation often requires lower\-level locks and is less prone to conflicts with other transactions, which improves overall system concurrency.

## Summary

- Use the `TRUNCATE TABLE` statement to delete all data from a large table very fast.
- Use the `CASCADE` option to truncate a table that is referenced by foreign key constraints.
- The `TRUNCATE TABLE` deletes data but does not fire `ON DELETE` triggers. Instead, it fires the `BEFORE TRUNCATE` and `AFTER TRUNCATE` triggers.
- The `TRUNCATE TABLE` statement is transaction\-safe.


# Database Constraints

# Primary Key

---
title: 'PostgreSQL Primary Key'
page_title: 'PostgreSQL Primary Key'
page_description: 'In this tutorial, we will show you what is the primary key is and how to manage PostgreSQL primary key constraints through SQL statements.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-primary-key/'
ogImage: ''
updatedOn: '2024-01-25T07:25:38+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Copy Table: A Step-by-Step Guide with Practical Examples'
  slug: 'postgresql-tutorial/postgresql-copy-table'
nextLink:
  title: 'PostgreSQL Foreign Key'
  slug: 'postgresql-tutorial/postgresql-foreign-key'
---

**Summary**: in this tutorial, you will learn about the PostgreSQL primary key and how to manage primary key constraints effectively.

## Introduction to PostgreSQL primary key

A primary key is a column or a group of columns used to uniquely identify a row in a table. The column that participates in the primary key is known as the primary key column.

A table can have zero or one primary key. It cannot have more than one primary key.

It is a good practice to add a primary key to every table. When you add a primary key to a table, PostgreSQL creates a unique B\-tree index on the column or a group of columns used to define the primary key.

Technically, a primary key constraint is the combination of a [not\-null constraint](postgresql-not-null-constraint) and [a UNIQUE constraint](postgresql-unique-constraint).

Typically, you define primary for a table when creating it:

```phpsql
CREATE TABLE table_name (
  column_1 data_type PRIMARY KEY,
  column_2 data_type,
  …
);
```

In this syntax, you define the primary key as the column constraint of the primary key column.

If the primary key consists of more than one column, you can define it using the table constraint:

```sql
CREATE TABLE table_name (
  column_1 data_type,
  column_2 data_type,
  column_3 data_type,
  …
  PRIMARY KEY(column_1, column2, ...)
);
```

To add a primary key to an existing table, you the `ALTER TABLE ... ADD PRIMARY KEY` statement:

```
ALTER TABLE table_name
ADD PRIMARY KEY (column_1, column_2, ...);
```

If you don’t explicitly specify the name for the primary key constraint, PostgreSQL will assign a default name to the primary key constraint.

By default, PostgreSQL uses the format `table-name_pkey` as the default name for the primary key constraint.

To assign a name for the primary key, you can use the `CONSTRAINT` clause as follows:

```
CONSTRAINT constraint_name
PRIMARY KEY(column_1, column_2,...);
```

## PostgreSQL primary key examples

Let’s explore some examples of using the PostgreSQL primary key.

### 1\) Creating a table with a primary key that consists of one column

The following statement creates a table with a primary key that consists of one column:

```
CREATE TABLE orders(
  order_id SERIAL PRIMARY KEY,
  customer_id VARCHAR(255) NOT NULL,
  order_date DATE NOT NULL
);
```

In this example, we create the orders with the order_id as the primary key.

We define the order_id column with the type SERIAL so that PostgreSQL will generate a unique integer (1, 2, 3, and so on) when you insert a new row into the table without providing the value for the order_id column.

This ensures the value in the order_id is unique for every row in the table.

### 2\) Creating a table with a primary key that consists of two columns

The following example shows how to define a primary key that consists of two columns `order_id` and `item_no`:

```sql
CREATE TABLE order_items(
  order_id INT,
  item_no SERIAL,
  item_description VARCHAR NOT NULL,
  quantity INTEGER NOT NULL,
  price DEC(10, 2),
  PRIMARY KEY (order_id, item_no)
);

```

### 3\) Adding a primary key to an existing table

First, create a table called `products` without defining any primary key.

```sql
CREATE TABLE products (
  product_id INT,
  name VARCHAR(255) NOT NULL,
  description TEXT,
  price DEC(10, 2) NOT NULL
);
```

Second, add a primary key constraint to the `products` table using the `ALTER TABLE ... ADD PRIMARY KEY` statement:

```sql
ALTER TABLE products
ADD PRIMARY KEY (product_id);
```

### 4\) Adding an auto\-incremented primary key to an existing table

First, create a new table called `vendors` that does not have a primary key:

```sql
CREATE TABLE vendors (
  name VARCHAR(255)
);
```

Second, insert some rows into the `vendors` table:

```sql
INSERT INTO vendors (name)
VALUES
  ('Microsoft'),
  ('IBM'),
  ('Apple'),
  ('Samsung')
RETURNING *;
```

Output:

```text
   name
-----------
 Microsoft
 IBM
 Apple
 Samsung
(4 rows)

```

Third, add a primary key named `vendor_id` into the `vendors` table with the type `SERIAL`:

```sql
ALTER TABLE vendors
ADD COLUMN vendor_id SERIAL PRIMARY KEY;
```

Finally, verify the vendor_id column:

```sql
SELECT
  vendor_id,
  name
FROM
  vendors;
```

Output:

```text
 vendor_id |   name
-----------+-----------
         1 | Microsoft
         2 | IBM
         3 | Apple
         4 | Samsung
(4 rows)
```

## Drop a primary key

To remove a primary key from a table, you use the following `ALTER TABLE` statement:

```
ALTER TABLE table_name
DROP CONSTRAINT primary_key_constraint;
```

In this syntax:

- First, specify the name of the table from which you want to remove the primary key.
- Second, provide the primary key constraint to drop.

Let’s take an example of removing the primary key constraint from the `vendors` table using psql.

First, display the structure of the `vendors` table using the \\d command:

```text
\d vendors
```

Output:

```
                                         Table "public.vendors"
  Column   |          Type          | Collation | Nullable |                  Default
-----------+------------------------+-----------+----------+--------------------------------------------
 name      | character varying(255) |           |          |
 vendor_id | integer                |           | not null | nextval('vendors_vendor_id_seq'::regclass)
Indexes:
    "vendors_pkey" PRIMARY KEY, btree (vendor_id)


```

The output indicates that the primary key constraint is vendors_pkey.

Second, drop the primary key from the `vendors` table using the `ALTER TABLE ... DROP CONSTRAINT` statement:

```
ALTER TABLE vendors
DROP CONSTRAINT vendors_pkey;
```

Output:

```
ALTER TABLE
```

The statement removes only the primary key constraint but does not remove the vendor_id column:

```
SELECT vendor_id, name
FROM vendors;
```

Output:

```
 vendor_id |   name
-----------+-----------
         1 | Microsoft
         2 | IBM
         3 | Apple
         4 | Samsung
(4 rows)
```

## Summary

- Use the `PRIMARY KEY` constraint to define a primary key for a table when creating the table.
- Use the `ALTER TABLE ... ADD PRIMARY KEY` statement to add a primary key to a table.
- Use the `ALTER TABLE ... DROP CONSTRAINT` statement to drop a primary key from a table.


# Foreign Key

---
title: 'PostgreSQL Foreign Key'
page_title: 'PostgreSQL Foreign Key'
page_description: 'In this tutorial, you will learn about PostgreSQL foreign key and how to add foreign keys to tables using foreign key constraints.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-foreign-key/'
ogImage: ''
updatedOn: '2024-01-25T08:23:10+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Primary Key'
  slug: 'postgresql-tutorial/postgresql-primary-key'
nextLink:
  title: 'PostgreSQL DELETE CASCADE'
  slug: 'postgresql-tutorial/postgresql-delete-cascade'
---

**Summary**: in this tutorial, you will learn about the PostgreSQL foreign key and how to add foreign keys to tables using foreign key constraints.

## Introduction to PostgreSQL Foreign Key Constraint

In PostgreSQL, a foreign key is a column or a group of columns in a table that uniquely identifies a row in **another table**.

A foreign key establishes a link between the data in two tables by referencing the [primary key](postgresql-primary-key) or a [unique constraint](postgresql-unique-constraint) of the referenced table.

The table containing a foreign key is referred to as the referencing table or child table. Conversely, the table referenced by a foreign key is known as the referenced table or parent table.

The main purpose of foreign keys is to maintain referential integrity in a relational database, ensuring that relationships between the parent and child tables are valid.

For example, a foreign key prevents the insertion of values that do not have corresponding values in the referenced table.

Additionally, a foreign key maintains consistency by automatically updating or deleting related rows in the child table when changes occur in the parent table.

A table can have multiple foreign keys depending on its relationships with other tables.

To define a foreign key, you can use a foreign key constraint.

## PostgreSQL foreign key constraint syntax

The following illustrates a foreign key constraint syntax:

```csssqlsql
[CONSTRAINT fk_name]
   FOREIGN KEY(fk_columns)
   REFERENCES parent_table(parent_key_columns)
   [ON DELETE delete_action]
   [ON UPDATE update_action]
```

In this syntax:

- First, specify the name for the foreign key constraint after the `CONSTRAINT` keyword. The `CONSTRAINT` clause is optional. If you omit it, PostgreSQL will assign an auto\-generated name.
- Second, specify one or more foreign key columns in parentheses after the `FOREIGN KEY` keywords.
- Third, specify the parent table and parent key columns referenced by the foreign key columns in the `REFERENCES` clause.
- Finally, specify the desired delete and update actions in the `ON DELETE` and `ON UPDATE` clauses.

The delete and update actions determine the behaviors when the primary key in the parent table is deleted and updated.

Since the primary key is rarely updated, the `ON UPDATE action` is infrequently used in practice. We’ll focus on the `ON DELETE` action.

PostgreSQL supports the following actions:

- SET NULL
- SET DEFAULT
- RESTRICT
- NO ACTION
- CASCADE

## PostgreSQL foreign key constraint examples

The following statements create the `customers` and `contacts` tables:

```shell
DROP TABLE IF EXISTS customers;
DROP TABLE IF EXISTS contacts;

CREATE TABLE customers(
   customer_id INT GENERATED ALWAYS AS IDENTITY,
   customer_name VARCHAR(255) NOT NULL,
   PRIMARY KEY(customer_id)
);

CREATE TABLE contacts(
   contact_id INT GENERATED ALWAYS AS IDENTITY,
   customer_id INT,
   contact_name VARCHAR(255) NOT NULL,
   phone VARCHAR(15),
   email VARCHAR(100),
   PRIMARY KEY(contact_id),
   CONSTRAINT fk_customer
      FOREIGN KEY(customer_id)
        REFERENCES customers(customer_id)
);
```

In this example, the `customers` table is the parent table and the `contacts` table is the child table.

Each customer has zero or many contacts and each contact belongs to zero or one customer.

The `customer_id` column in the `contacts` table is the foreign key column that references the primary key column with the same name in the `customers` table.

The following foreign key constraint `fk_customer` in the `contacts` table defines the `customer_id` as the foreign key:

```sql
CONSTRAINT fk_customer
   FOREIGN KEY(customer_id)
      REFERENCES customers(customer_id)
```

Because the foreign key constraint does not have the `ON DELETE` and `ON UPDATE` action, they default to `NO ACTION`.

### NO ACTION

The following inserts data into the `customers` and `contacts` tables:

```sql
INSERT INTO customers(customer_name)
VALUES('BlueBird Inc'),
      ('Dolphin LLC');

INSERT INTO contacts(customer_id, contact_name, phone, email)
VALUES(1,'John Doe','(408)-111-1234','[[email protected]](../cdn-cgi/l/email-protection.html)'),
      (1,'Jane Doe','(408)-111-1235','[[email protected]](../cdn-cgi/l/email-protection.html)'),
      (2,'David Wright','(408)-222-1234','[[email protected]](../cdn-cgi/l/email-protection.html)');
```

The following statement deletes the customer id 1 from the `customers` table:

```sql
DELETE FROM customers
WHERE customer_id = 1;
```

Because of the `ON DELETE NO ACTION`, PostgreSQL issues a constraint violation because the referencing rows of the customer id 1 still exist in the `contacts` table:

```sql
ERROR:  update or delete on table "customers" violates foreign key constraint "fk_customer" on table "contacts"
DETAIL:  Key (customer_id)=(1) is still referenced from table "contacts".
SQL state: 23503
```

The `RESTRICT` action is similar to the `NO ACTION`. The difference only arises when you define the foreign key constraint as `DEFERRABLE` with an `INITIALLY DEFERRED` or `INITIALLY IMMEDIATE` mode. We’ll discuss more on this in the upcoming tutorial.

### SET NULL

The `SET NULL` automatically sets `NULL` to the foreign key columns in the referencing rows of the child table when the referenced rows in the parent table are deleted.

First, drop the sample tables and re\-create them with the foreign key that uses the `SET NULL` action in the `ON DELETE` clause:

```
DROP TABLE IF EXISTS contacts;
DROP TABLE IF EXISTS customers;

CREATE TABLE customers(
   customer_id INT GENERATED ALWAYS AS IDENTITY,
   customer_name VARCHAR(255) NOT NULL,
   PRIMARY KEY(customer_id)
);

CREATE TABLE contacts(
   contact_id INT GENERATED ALWAYS AS IDENTITY,
   customer_id INT,
   contact_name VARCHAR(255) NOT NULL,
   phone VARCHAR(15),
   email VARCHAR(100),
   PRIMARY KEY(contact_id),
   CONSTRAINT fk_customer
      FOREIGN KEY(customer_id)
	  REFERENCES customers(customer_id)
	  ON DELETE SET NULL
);
```

Second, insert data into the `customers` and `contacts` tables:

```sql
INSERT INTO customers(customer_name)
VALUES('BlueBird Inc'),
      ('Dolphin LLC');

INSERT INTO contacts(customer_id, contact_name, phone, email)
VALUES(1,'John Doe','(408)-111-1234','[[email protected]](../cdn-cgi/l/email-protection.html)'),
      (1,'Jane Doe','(408)-111-1235','[[email protected]](../cdn-cgi/l/email-protection.html)'),
      (2,'David Wright','(408)-222-1234','[[email protected]](../cdn-cgi/l/email-protection.html)');
```

Third, delete the customer with id 1 from the `customers` table:

```sql
DELETE FROM customers
WHERE customer_id = 1;
```

Because of the `ON DELETE SET NULL` action, the referencing rows in the `contacts` table are set to NULL.

Finally, display the data in the `contacts` table:

```sql
SELECT * FROM contacts;
```

Output:

```
 contact_id | customer_id | contact_name |     phone      |          email
------------+-------------+--------------+----------------+--------------------------
          3 |           2 | David Wright | (408)-222-1234 | [[email protected]](../cdn-cgi/l/email-protection.html)
          1 |        null | John Doe     | (408)-111-1234 | [[email protected]](../cdn-cgi/l/email-protection.html)
          2 |        null | Jane Doe     | (408)-111-1235 | [[email protected]](../cdn-cgi/l/email-protection.html)
(3 rows)
```

The output indicates that the values of customer id 1 changed to `NULL`.

### CASCADE

The `ON DELETE CASCADE` automatically deletes all the referencing rows in the child table when the referenced rows in the parent table are deleted. In practice, the `ON DELETE CASCADE` is the most commonly used option.

The following statements recreate the sample tables with the delete action of the `fk_customer` changes to `CASCADE`:

```
DROP TABLE IF EXISTS contacts;
DROP TABLE IF EXISTS customers;

CREATE TABLE customers(
   customer_id INT GENERATED ALWAYS AS IDENTITY,
   customer_name VARCHAR(255) NOT NULL,
   PRIMARY KEY(customer_id)
);

CREATE TABLE contacts(
   contact_id INT GENERATED ALWAYS AS IDENTITY,
   customer_id INT,
   contact_name VARCHAR(255) NOT NULL,
   phone VARCHAR(15),
   email VARCHAR(100),
   PRIMARY KEY(contact_id),
   CONSTRAINT fk_customer
      FOREIGN KEY(customer_id)
	  REFERENCES customers(customer_id)
	  ON DELETE CASCADE
);

INSERT INTO customers(customer_name)
VALUES('BlueBird Inc'),
      ('Dolphin LLC');

INSERT INTO contacts(customer_id, contact_name, phone, email)
VALUES(1,'John Doe','(408)-111-1234','[[email protected]](../cdn-cgi/l/email-protection.html)'),
      (1,'Jane Doe','(408)-111-1235','[[email protected]](../cdn-cgi/l/email-protection.html)'),
      (2,'David Wright','(408)-222-1234','[[email protected]](../cdn-cgi/l/email-protection.html)');
```

The following statement deletes the customer id 1:

```sql
DELETE FROM customers
WHERE customer_id = 1;
```

Because of the `ON DELETE CASCADE` action, all the referencing rows in the `contacts` table are automatically deleted:

```
SELECT * FROM contacts;
```

Output:

```
 contact_id | customer_id | contact_name |     phone      |          email
------------+-------------+--------------+----------------+--------------------------
          3 |           2 | David Wright | (408)-222-1234 | [[email protected]](../cdn-cgi/l/email-protection.html)
(1 row)
```

### SET DEFAULT

The `ON DELETE SET DEFAULT` sets the default value to the foreign key column of the referencing rows in the child table when the referenced rows from the parent table are deleted.

## Add a foreign key constraint to an existing table

To add a foreign key constraint to the existing table, you use the following form of the [ALTER TABLE](postgresql-alter-table) statement:

```
ALTER TABLE child_table
ADD CONSTRAINT constraint_name
FOREIGN KEY (fk_columns)
REFERENCES parent_table (parent_key_columns);
```

When adding a foreign key constraint with `ON DELETE CASCADE` option to an existing table, you need to follow these steps:

First, drop existing foreign key constraint:

```sql
ALTER TABLE child_table
DROP CONSTRAINT constraint_fkey;
```

Second, add a new foreign key constraint with  `ON DELETE CASCADE` action:

```sql
ALTER TABLE child_table
ADD CONSTRAINT constraint_fk
FOREIGN KEY (fk_columns)
REFERENCES parent_table(parent_key_columns)
ON DELETE CASCADE;
```

## Summary

- Use foreign keys to ensure the referential integrity and consistency of data between two tables.
- Use the `FOREIGN KEY` constraint to define a foreign key constraint when creating a table.
- Use the `ALTER TABLE ... ADD CONSTRAINT ... FOREIGN KEY` to add a foreign key constraint to an existing table.


# CHECK Constraint

---
title: 'PostgreSQL CHECK Constraints'
page_title: 'PostgreSQL CHECK Constraints'
page_description: 'You will learn how to use PostgreSQL CHECK constraints to ensure the data integrity of values in a column or a group of columns in a table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-check-constraint/'
ogImage: ''
updatedOn: '2024-01-25T09:16:13+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL DELETE CASCADE'
  slug: 'postgresql-tutorial/postgresql-delete-cascade'
nextLink:
  title: 'PostgreSQL UNIQUE Constraint'
  slug: 'postgresql-tutorial/postgresql-unique-constraint'
---

**Summary**: in this tutorial, you will learn about the PostgreSQL `CHECK` constraints and how to use them to constrain values in columns of a table based on a boolean expression.

## Introduction to PostgreSQL CHECK constraints

In PostgreSQL, a `CHECK` constraint ensures that values in a column or a group of columns meet a specific condition.

A check constraint allows you to enforce data integrity rules at the database level. A check constraint uses a boolean expression to evaluate the values, ensuring that only valid data is [inserted](postgresql-insert) or [updated](postgresql-update) in a table.

### Creating CHECK constraints

Typically, you create a check constraint when creating a table using the `CREATE TABLE` statement:

```shellsqlsql
CREATE TABLE table_name(
   column1 datatype,
   ...,
   CONSTRAINT constraint_name CHECK(condition)
);
```

In this syntax:

- First, specify the constraint name after the `CONSTRAINT` keyword. This is optional. If you omit it, PostgreSQL will automatically generate a name for the `CHECK` constraint.
- Second, define a condition that must be satisfied for the constraint to be valid.

If the `CHECK` constraint involves only one column, you can define it as a column constraint like this:

```
CREATE TABLE table_name(
   column1 datatype,
   column1 datatype CHECK(condition),
   ...,
);
```

By default, PostgreSQL assigns a name to a `CHECK` constraint using the following format:

```
{table}_{column}_check
```

### Adding CHECK constraints to tables

To add a `CHECK` constraint to an existing table, you use the `ALTER TABLE ... ADD CONSTRAINT` statement:

```sql
ALTER TABLE table_name
ADD CONSTRAINT constraint_name CHECK (condition);
```

### Removing CHECK constraints

To drop a `CHECK` constraint, you use the `ALTER TABLE ... DROP CONSTRAINT` statement:

```
ALTER TABLE table_name
DROP CONSTRAINT constraint_name;
```

## PostgreSQL CHECK constraint examples

Let’s explore some examples of using the `CHECK` constraints.

### 1\) Defining PostgreSQL CHECK constraint for a new table

First, create a new table called `employees` with some `CHECK` constraints:

```
CREATE TABLE employees (
  id SERIAL PRIMARY KEY,
  first_name VARCHAR (50) NOT NULL,
  last_name VARCHAR (50) NOT NULL,
  birth_date DATE NOT NULL,
  joined_date DATE NOT NULL,
  salary numeric CHECK(salary > 0)
);

```

In this statement, the `employees` table has one `CHECK` constraint that enforces the values in the salary column greater than zero.

Second, attempt to [insert](postgresql-insert) a new row with a negative salary into the `employees` table:

```sql
INSERT INTO employees (first_name, last_name, birth_date, joined_date, salary)
VALUES ('John', 'Doe', '1972-01-01', '2015-07-01', -100000);

```

Error:

```sql
ERROR:  new row for relation "employees" violates check constraint "employees_salary_check"
DETAIL:  Failing row contains (1, John, Doe, 1972-01-01, 2015-07-01, -100000).
```

The insert fails because the `CHECK` constraint on the `salary` column accepts only positive values.

### 2\) Adding PostgreSQL CHECK constraints for existing tables

First, use the `ALTER TABLE ... ADD CONSTRAINT` statement to add a `CHECK` constraint to the `employees` table:

```
ALTER TABLE employees
ADD CONSTRAINT joined_date_check
CHECK ( joined_date >  birth_date );
```

The `CHECK` constraint ensures that the joined date is later than the birthdate.

Second, attempt to insert a new row into the `employees` table with the joined date is earlier than the birth date:

```
INSERT INTO employees (first_name, last_name, birth_date, joined_date, salary)
VALUES ('John', 'Doe', '1990-01-01', '1989-01-01', 100000);
```

Output:

```sql
ERROR:  new row for relation "employees" violates check constraint "joined_date_check"
DETAIL:  Failing row contains (2, John, Doe, 1990-01-01, 1989-01-01, 100000).
```

The output indicates that the data violates the check constraint “joined_date_check”.

### 3\) Using functions in CHECK constraints

The following example adds a `CHECK` constraint to ensure that the first name has at least 3 characters:

```sql
ALTER TABLE employees
ADD CONSTRAINT first_name_check
CHECK ( LENGTH(TRIM(first_name)) >= 3);
```

In this example, we define a condition using the `TRIM()` and `LENGTH()` functions:

- First, the [`TRIM()`](../postgresql-string-functions/postgresql-trim-function) function removes leading and trailing whitespaces from the first_name.
- Second, the [`LENGTH()`](../postgresql-string-functions/postgresql-length-function) function returns the character length of the result of the `TRIM()` function.

The whole expression `LENGTH(TRIM(first_name)) >= 3` ensures the first name contains three or more characters.

The following statement will fail because it attempts to insert a row into the `employees` table with the first name that has 2 characters:

```
INSERT INTO employees (first_name, last_name, birth_date, joined_date, salary)
VALUES ('Ab', 'Doe', '1990-01-01', '2008-01-01', 100000);
```

Error:

```sql
ERROR:  new row for relation "employees" violates check constraint "first_name_check"
DETAIL:  Failing row contains (4, Ab, Doe, 1990-01-01, 2008-01-01, 100000).
```

### 4\) Removing a CHECK constraint example

The following statement removes the `CHECK` constraint `joined_date_check` from the `employees` table:

```
ALTER TABLE employees
DROP CONSTRAINT joined_date_check;
```

## Summary

- Use PostgreSQL `CHECK` constraint to check the values of columns based on a boolean expression.


# UNIQUE Constraint

---
title: 'PostgreSQL UNIQUE Constraint'
page_title: 'PostgreSQL UNIQUE Constraint'
page_description: 'Learn how to use a PostgreSQL UNIQUE constraint to ensure values stored in a column or a group of columns are unique across rows.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-unique-constraint/'
ogImage: ''
updatedOn: '2024-01-25T09:57:33+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CHECK Constraints'
  slug: 'postgresql-tutorial/postgresql-check-constraint'
nextLink:
  title: 'PostgreSQL Not-Null Constraint'
  slug: 'postgresql-tutorial/postgresql-not-null-constraint'
---

**Summary**: in this tutorial, you will learn about PostgreSQL `UNIQUE` constraint to make sure that values stored in a column or a group of columns are unique across rows in a table.

## Introduction to PostgreSQL UNIQUE constraint

Sometimes, you want to ensure that values stored in a column or a group of columns are unique across the whole table such as email addresses or usernames.

PostgreSQL provides you with the `UNIQUE` constraint that maintains the uniqueness of the data correctly.

When a `UNIQUE` constraint is in place, every time you [insert a new row](postgresql-insert), it checks if the value is already in the table. It rejects the change and issues an error if the value already exists. The same process is carried out for [updating existing data](postgresql-update).

When you add a `UNIQUE` constraint to a column or a group of columns, PostgreSQL will automatically create a [unique index](../postgresql-indexes/postgresql-unique-index) on the column or the group of columns.

## PostgreSQL UNIQUE constraint example

The following statement [creates a new table](postgresql-create-table) named `person` with a `UNIQUE` constraint for the `email` column.

```sql
CREATE TABLE person (
  id SERIAL PRIMARY KEY,
  first_name VARCHAR (50),
  last_name VARCHAR (50),
  email VARCHAR (50) UNIQUE
);
```

Note that the `UNIQUE` constraint above can be rewritten as a table constraint as shown in the following query:

```sql
CREATE TABLE person (
  id SERIAL PRIMARY KEY,
  first_name VARCHAR (50),
  last_name VARCHAR (50),
  email VARCHAR (50),
  UNIQUE(email)
);
```

First, insert a new row into the `person` table using [`INSERT`](postgresql-insert) statement:

```sql
INSERT INTO person(first_name,last_name,email)
VALUES('john','doe','[[email protected]](../cdn-cgi/l/email-protection.html)');
```

Second, insert another row with a duplicate email.

```sql
INSERT INTO person(first_name,last_name,email)
VALUES('jack','doe','[[email protected]](../cdn-cgi/l/email-protection.html)');
```

PostgreSQL issued an error message.

```sql
[Err] ERROR:  duplicate key value violates unique constraint "person_email_key"
DETAIL:  Key (email)=([[email protected]](../cdn-cgi/l/email-protection.html)) already exists.
```

## Creating a UNIQUE constraint on multiple columns

PostgreSQL allows you to create a `UNIQUE` constraint to a group of columns using the following syntax:

```sql
CREATE TABLE table (
    c1 data_type,
    c2 data_type,
    c3 data_type,
    UNIQUE (c2, c3)
);
```

The combination of values in the columns c2 and c3 will be unique across the whole table. The value of the column c2 or c3 needs not to be unique.

## Adding unique constraints using a unique index

Sometimes, you may want to add a unique constraint to an existing column or group of columns. Let’s take a look at the following example.

First, suppose you have a table named `equipment`:

```sql
CREATE TABLE equipment (
  id SERIAL PRIMARY KEY,
  name VARCHAR (50) NOT NULL,
  equip_id VARCHAR (16) NOT NULL
);
```

Second, create a unique index based on the `equip_id` column.

```sql
CREATE UNIQUE INDEX CONCURRENTLY equipment_equip_id
ON equipment (equip_id);
```

Third, add a unique constraint to the `equipment` table using the `equipment_equip_id` index.

```sql
ALTER TABLE equipment
ADD CONSTRAINT unique_equip_id
UNIQUE USING INDEX equipment_equip_id;
```

Notice that the [`ALTER TABLE`](postgresql-alter-table) statement acquires an exclusive lock on the table. If you have any pending transactions, it will wait for all transactions to complete before changing the table. Therefore, you should check the pg_stat_activity table to see the current pending transactions that are ongoing using the following query:

```sql
SELECT
  datid,
  datname,
  usename,
  state
FROM
  pg_stat_activity;
```

You should look at the result to find the `state` column with the value  `idle in transaction`. Those are the transactions that are pending to complete.

## Summary

- Use the `UNIQUE` constraints to enforce values stored in a column or a group of columns unique across rows within the same table.


# NOT NULL Constraint

---
title: 'PostgreSQL Not-Null Constraint'
page_title: 'PostgreSQL NOT NULL Constraints'
page_description: 'You will learn about the NULL concept and how to use PostgreSQL NOT NULL constraint to ensure values in a column are not NULL.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-not-null-constraint/'
ogImage: ''
updatedOn: '2024-01-25T10:09:49+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL UNIQUE Constraint'
  slug: 'postgresql-tutorial/postgresql-unique-constraint'
nextLink:
  title: 'PostgreSQL DEFAULT Value'
  slug: 'postgresql-tutorial/postgresql-default-value'
---

**Summary**: in this tutorial, you will learn about PostgreSQL not\-null constraints to ensure the values of a column are not null.

## Introduction to NULL

In the database world, NULL represents unknown or missing information. NULL is not the same as an empty string or the number zero.

Suppose you need to insert the email address of a contact into a table. You can request his or her email address.

However, if you don’t know whether the contact has an email address or not, you can insert NULL into the email address column. In this case, NULL indicates that the email address is unknown at the recording time.

NULL is very special. It does not equal anything, even itself. The expression `NULL = NULL` returns NULL because it makes sense that two unknown values should not be equal.

To check if a value is NULL or not, you use the [`IS NULL`](postgresql-is-null) boolean operator. For example, the following expression returns true if the value in the email address is NULL.

```phpsqlsql
email_address IS NULL
```

The `IS NOT NULL` operator negates the result of the `IS NULL` operator.

## PostgreSQL NOT NULL constraints

To control whether a column can accept NULL, you use the `NOT NULL` constraint:

```php
CREATE TABLE table_name(
   ...
   column_name data_type NOT NULL,
   ...
);
```

If a column has a `NOT NULL` constraint, any attempt to [insert](postgresql-insert) or [update](postgresql-update) NULL in the column will result in an error.

## Declaring NOT NULL columns

The following `CREATE TABLE` statement creates a new table name `invoices` with the not\-null constraints.

```
CREATE TABLE invoices(
  id SERIAL PRIMARY KEY,
  product_id INT NOT NULL,
  qty numeric NOT NULL CHECK(qty > 0),
  net_price numeric CHECK(net_price > 0)
);
```

This example uses the `NOT NULL` keywords that follow the [data type](postgresql-data-types) of the product_id and qty columns to declare `NOT NULL` constraints.

Note that a column can have multiple constraints such as `NOT NULL`, [check](postgresql-check-constraint), [unique](postgresql-unique-constraint), [foreign key](postgresql-foreign-key) appearing next to each other. The order of the constraints is not important. PostgreSQL may check constraints in any order.

If you use `NULL` instead of `NOT NULL`, the column will accept both `NULL` and non\-NULL values. If you don’t explicitly specify `NULL` or `NOT NULL`, it will accept `NULL` by default.

## Adding NOT NULL Constraints to existing columns

To add the `NOT NULL` constraint to a column of an existing table, you use the following form of the [`ALTER TABLE`](postgresql-alter-table) statement:

```sql
ALTER TABLE table_name
ALTER COLUMN column_name SET NOT NULL;
```

To add multiple `NOT NULL` constraints to multiple columns, you use the following syntax:

```sql
ALTER TABLE table_name
ALTER COLUMN column_name_1 SET NOT NULL,
ALTER COLUMN column_name_2 SET NOT NULL,
...;
```

Let’s take a look at the following example.

First, [create a new table](postgresql-create-table) called production orders ( `production_orders`):

```sql
CREATE TABLE production_orders (
	id SERIAL PRIMARY KEY,
	description VARCHAR (40) NOT NULL,
	material_id VARCHAR (16),
	qty NUMERIC,
	start_date DATE,
	finish_date DATE
);
```

Next, insert a new row into the `production_orders` table:

```sql
INSERT INTO production_orders (description)
VALUES('Make for Infosys inc.');
```

Then, to make sure that the `qty` field is not null, you can add the not\-null constraint to the `qty` column. However, the column already contains data. If you try to add the not\-null constraint, PostgreSQL will issue an error.

To add the `NOT NULL` constraint to a column that already contains NULL, you need to update `NULL` to non\-NULL first, like this:

```sql
UPDATE production_orders
SET qty = 1;
```

The values in the `qty` column is updated to one. Now, you can add the `NOT NULL` constraint to the `qty` column:

```sql
ALTER TABLE production_orders
ALTER COLUMN qty
SET NOT NULL;
```

After that, you can update the not\-null constraints for `material_id`, `start_date`, and `finish_date` columns:

```sql
UPDATE production_orders
SET material_id = 'ABC',
    start_date = '2015-09-01',
    finish_date = '2015-09-01';
```

Add not\-null constraints to multiple columns:

```sql
ALTER TABLE production_orders
ALTER COLUMN material_id SET NOT NULL,
ALTER COLUMN start_date SET NOT NULL,
ALTER COLUMN finish_date SET NOT NULL;
```

Finally, attempt to update values in the `qty` column to NULL:

```sql
UPDATE production_orders
SET qty = NULL;
```

PostgreSQL issued an error message:

```sql
[Err] ERROR:  null value in column "qty" violates not-null constraint
DETAIL:  Failing row contains (1, make for infosys inc., ABC, null, 2015-09-01, 2015-09-01).
```

## The special case of NOT NULL constraint

Besides the `NOT NULL` constraint, you can use a [CHECK constraint](postgresql-check-constraint) to force a column to accept not NULL values. The `NOT NULL` constraint is equivalent to the following `CHECK` constraint:

```sql
CHECK(column IS NOT NULL)
```

This is useful because sometimes you may want either column `a` or `b` is not null, but not both.

For example, you may want either `username` or `email` column of the user tables is not null or empty. In this case, you can use the `CHECK` constraint as follows:

```sql
CREATE TABLE users (
  id serial PRIMARY KEY,
  username VARCHAR (50),
  password VARCHAR (50),
  email VARCHAR (50),
  CONSTRAINT username_email_notnull CHECK (
    NOT (
      (
        username IS NULL
        OR username = ''
      )
      AND (
        email IS NULL
        OR email = ''
      )
    )
  )
);
```

The following statement works.

```sql
INSERT INTO users (username, email)
VALUES
	('user1', NULL),
	(NULL, '[[email protected]](../cdn-cgi/l/email-protection.html)'),
	('user2', '[[email protected]](../cdn-cgi/l/email-protection.html)'),
	('user3', '');
```

However, the following statement will not work because it violates the `CHECK` constraint:

```sql
INSERT INTO users (username, email)
VALUES
	(NULL, NULL),
	(NULL, ''),
	('', NULL),
	('', '');
```

```
[Err] ERROR:  new row for relation "users" violates check constraint "username_email_notnull"
```

## Summary

- Use the `NOT NULL` constraint for a column to enforce a column not accept `NULL`. By default, a column can hold NULL.
- To check if a value is `NULL` or not, you use the `IS NULL` operator. The `IS NOT NULL` negates the result of the `IS NULL`.
- Never use equal operator `=` to compare a value with `NULL` because it always returns `NULL`.


# DEFAULT Constraint

---
title: 'PostgreSQL DEFAULT Value'
page_title: 'PostgreSQL DEFAULT Value'
page_description: 'In this tutorial, you will learn how to assign a default value to a column using the PostgreSQL default constraint.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-default-value/'
ogImage: ''
updatedOn: '2024-03-15T04:07:10+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Not-Null Constraint'
  slug: 'postgresql-tutorial/postgresql-not-null-constraint'
nextLink:
  title: 'PostgreSQL Boolean Data Type with Practical Examples'
  slug: 'postgresql-tutorial/postgresql-boolean'
---

**Summary**: in this tutorial, you will learn how to assign a default value to a column using the PostgreSQL DEFAULT constraint.

## Defining the DEFAULT value for a column of a new table

When [creating a table](postgresql-create-table), you can define a default value for a column in the table using the `DEFAULT` constraint. Here’s the basic syntax:

```phpsql
CREATE TABLE table_name(
    column1 type,
    column2 type DEFAULT default_value,
    column3 type,
    ...
);
```

In this syntax, the `column2` will receive the `default_value` when you [insert a new row](postgresql-insert) into the `table_name` without specifying a value for the column.

If you don’t specify the `DEFAULT` constraint for the column, its default value is `NULL`:

```sql
CREATE TABLE table_name(
    column1 type,
    column2 type,
    column3 type,
    ...
);
```

This often makes sense because `NULL` represents unknown data.

The default value can be a literal value such as a number, a string, a JSON object, etc. Additionally, it can be an expression that will be evaluated when the default value is inserted into the table:

```sql
CREATE TABLE table_name(
    column1 type,
    column2 type DEFAULT expression,
    column3 type,
    ...
);
```

When inserting a new row into a table, you can ignore the column that has a default value. In this case, PostgreSQL will use the default value for the insertion:

```sql
INSERT INTO table_name(column1, colum3)
VALUES(value1, value2);
```

If you specify the column with a default constraint in the `INSERT` statement and want to use the default value for the insertion, you can use the `DEFAULT` keyword as follows:

```sql
INSERT INTO table_name(column1, column2, colum3)
VALUES(value1,DEFAULT,value2);
```

## Defining the DEFAULT value for a column of an existing table

If you want to specify a default value for a column of an existing table, you can use the `ALTER TABLE` statement:

```sql
ALTER TABLE table_name
ALTER COLUMN column2
SET DEFAULT default_value;
```

In this syntax:

- First, specify the table name in the `ALTER TABLE` clause (`table_name`).
- Second, provide the name of the column that you want to assign a default value in the `ALTER COLUMN` clause.
- Third, specify a default value for the column in the `SET DEFAULT` clause.

## Removing the DEFAULT value from a column

To drop a default value later, you can also use the `ALTER TABLE ... ALTER COLUMN ... DROP DEFAULT` statement:

```php
ALTER TABLE table_name
ALTER COLUMN column2
DROP DEFAULT;
```

In this syntax:

- First, specify the table name in the `ALTER TABLE` clause.
- Second, provide the name of the column that you want to remove the default value in the `ALTER COLUMN` clause.
- Third, use the `DROP DEFAULT` to remove the default value from the column.

## PostgreSQL default value examples

Let’s take some examples of using the `DEFAULT` constraint to specify a default value for a column.

### 1\) Basic PostgreSQL default value examples

First, [create a new table](postgresql-create-table) called `products` to store product data:

```php
CREATE TABLE products(
   id SERIAL PRIMARY KEY,
   name VARCHAR(255) NOT NULL,
   price DECIMAL(19,2) NOT NULL DEFAULT 0
);
```

Second, insert a row into the `products` table:

```sql
INSERT INTO products(name)
VALUES('Laptop')
RETURNING *;
```

Output:

```text
 id |  name  | price
----+--------+-------
  1 | Laptop |  0.00
(1 row)
```

In this example, we don’t specify a value for the `price` column in the `INSERT` statement; therefore, PostgreSQL uses the default value `0.00` for the `price` column.

Third, insert one more row into the `products` table:

```sql
INSERT INTO products(name, price)
VALUES
   ('Smartphone', DEFAULT)
RETURNING *;
```

Output:

```text
 id |    name    | price
----+------------+-------
  2 | Smartphone |  0.00
(1 row)
```

In this example, we use the `DEFAULT` keyword as the value for the `price` column in the `INSERT` statement, PostgreSQL uses the default value as `0.00` for the column.

Finally, insert a new row into the `products` table:

```sql
INSERT INTO products(name, price)
VALUES
   ('Tablet', 699.99)
RETURNING *;
```

Output:

```text
 id |  name  | price
----+--------+--------
  3 | Tablet | 699.99
(1 row)
```

In this example, we explicitly specify a value for the price column, and PostgreSQL uses the provided value instead of the default value for the insertion.

### 2\) Using DEFAULT constraint with TIMESTAMP columns

First, create a new table called `logs` that stores the log messages:

```sql
CREATE TABLE logs(
   id SERIAL PRIMARY KEY,
   message TEXT NOT NULL,
   created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

The `created_at` column uses the current timestamp returned by the `CURRENT_TIMESTAMP` function as the default value.

Second, insert rows into the `logs` table:

```sql
INSERT INTO logs(message)
VALUES('Started the server')
RETURNING *;
```

Output:

```text
 id |      message       |         created_at
----+--------------------+----------------------------
  1 | Started the server | 2024-03-15 10:22:48.680802
(1 row)
```

In the `INSERT` statement, we don’t specify the value for the `created_at` column, PostgreSQL uses the current timestamp for the insertion.

### 3\) Using DEFAULT constraint with JSONB type

First, create a table called `settings` to store configuration data:

```sql
CREATE TABLE settings(
   id SERIAL PRIMARY KEY,
   name VARCHAR(50) NOT NULL,
   configuration JSONB DEFAULT '{}'
);
```

The `configuration` column has the [JSONB](postgresql-json) type with the default value as an empty JSON object.

Second, insert a new row into the `settings` table:

```sql
INSERT INTO settings(name)
VALUES('global')
RETURNING *;
```

Output:

```text
 id |  name  | configuration
----+--------+---------------
  1 | global | {}
(1 row)
```

Since we don’t specify a value for the `configuration` column, PostgreSQL uses the empty JSON object `{}` for the insertion.

To remove the default JSONB value from the `configuration` column of the `settings` table, you can use the following `ALTER TABLE` statement:

```
ALTER TABLE settings
ALTER COLUMN configuration
DROP DEFAULT;
```

## Summary

- Use the `DEFAULT` constraint to define a default value for a table column.
- Use the `DEFAULT` keyword to explicitly use the default value specified in the `DEFAULT` constraint in the `INSERT` statement.


# PostgreSQL Data Types

# Boolean

---
title: 'PostgreSQL Boolean Data Type with Practical Examples'
page_title: 'PostgresQL BOOLEAN Data Type with Practical Examples'
page_description: 'In this tutorial, you will learn about the PostgreSQL Boolean data type and how to use it in designing the database tables.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-boolean/'
ogImage: '/postgresqltutorial/PostgreSQL-Boolean-300x146.png'
updatedOn: '2024-02-01T01:09:16+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL DEFAULT Value'
  slug: 'postgresql-tutorial/postgresql-default-value'
nextLink:
  title: 'PostgreSQL Character Types: CHAR, VARCHAR, and TEXT'
  slug: 'postgresql-tutorial/postgresql-char-varchar-text'
---

**Summary**: in this tutorial, you will learn about the PostgreSQL Boolean data type and how to use it in designing database tables.

## Introduction to the PostgreSQL Boolean type

![PostgreSQL Boolean](/postgresqltutorial/PostgreSQL-Boolean-300x146.png?alignright)
PostgreSQL supports a single Boolean [data type](postgresql-data-types): `BOOLEAN` that can have three values: `true`, `false` and `NULL`.

PostgreSQL uses one byte for storing a boolean value in the database. The `BOOLEAN` can be abbreviated as `BOOL`.

In standard SQL, a Boolean value can be `TRUE`, `FALSE`, or `NULL`. However, PostgreSQL is quite flexible when dealing with `TRUE` and `FALSE` values.

The following table shows the valid literal values for `TRUE` and `FALSE` in PostgreSQL.

| True   | False   |
| ------ | ------- |
| true   | false   |
| ‘t’    | ‘f ‘    |
| ‘true’ | ‘false’ |
| ‘y’    | ‘n’     |
| ‘yes’  | ‘no’    |
| ‘1’    | ‘0’     |

Note that the leading or trailing whitespace does not matter and all the constant values except for `true` and `false` must be enclosed in single quotes.

## PostgreSQL Boolean examples

Let’s take a look at some examples of using the PostgreSQL Boolean data type.

First, [create a new table](postgresql-create-table) called `stock_availability` to log which products are available.

```sql
CREATE TABLE stock_availability (
   product_id INT PRIMARY KEY,
   available BOOLEAN NOT NULL
);
```

Second, [insert some sample data](postgresql-insert) into the `stock_availability` table. We use various literal values for the boolean values.

```sql
INSERT INTO stock_availability (product_id, available)
VALUES
  (100, TRUE),
  (200, FALSE),
  (300, 't'),
  (400, '1'),
  (500, 'y'),
  (600, 'yes'),
  (700, 'no'),
  (800, '0');
```

Third, check for the availability of products:

```sql
SELECT *
FROM stock_availability
WHERE available = 'yes';
```

```text
 product_id | available
------------+-----------
        100 | t
        300 | t
        400 | t
        500 | t
        600 | t
(5 rows)
```

You can imply the true value by using the Boolean column without any operator. For example, the following query returns all available products:

```sql
SELECT *
FROM stock_availability
WHERE available;
```

Similarly, if you want to look for `false` values, you compare the value of the Boolean column against any valid Boolean constants.

The following query returns the products that are not available.

```sql
SELECT
  *
FROM
  stock_availability
WHERE
  available = 'no';
```

```text
 product_id | available
------------+-----------
        200 | f
        700 | f
        800 | f
(3 rows)
```

Alternatively, you can use the `NOT` operator to check if values in the Boolean column are false like this:

```sql
SELECT
  *
FROM
  stock_availability
WHERE
  NOT available;
```

## Set the default values for Boolean columns

To set a default value for an existing Boolean column, you use the `SET DEFAULT` clause in the [ALTER TABLE](postgresql-alter-table) statement.

For example, the following `ALTER TABLE` statement sets the default value for the `available` column in the `stock_availability` table:

```sql
ALTER TABLE stock_availability
ALTER COLUMN available
SET DEFAULT FALSE;
```

If you insert a row without specifying the value for the `available` column, PostgreSQL will use `FALSE` by default:

```sql
INSERT INTO stock_availability (product_id)
VALUES (900);
```

```sql
SELECT *
FROM stock_availability
WHERE product_id = 900;
```

```text
 product_id | available
------------+-----------
        900 | f
(1 row)
```

Likewise, if you want to set a default value for a Boolean column when you [create a table](postgresql-create-table), you use the `DEFAULT` constraint in the column definition as follows:

```sql
CREATE TABLE boolean_demo (
   ...
   is_ok BOOL DEFAULT 't'
);
```

## Summary

- Use the PostgreSQL `BOOLEAN` datatype to store the boolean data.


# CHAR, VARCHAR, and TEXT

---
title: 'PostgreSQL Character Types: CHAR, VARCHAR, and TEXT'
page_title: 'PostgreSQL Character Types: CHAR, VARCHAR, And TEXT'
page_description: 'This tutorial introduces you to PostgreSQL character data types including char, varchar, and text, and give you tips to choose the suitable one for tables.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-char-varchar-text/'
ogImage: ''
updatedOn: '2024-02-02T07:00:36+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Boolean Data Type with Practical Examples'
  slug: 'postgresql-tutorial/postgresql-boolean'
nextLink:
  title: 'PostgreSQL NUMERIC Type'
  slug: 'postgresql-tutorial/postgresql-numeric'
---

**Summary**: in this tutorial, you will learn about the PostgreSQL character data types including `CHAR`, `VARCHAR`, and `TEXT`, and how to select the appropriate character types for your tables.

## Introduction to the PostgreSQL character types

PostgreSQL provides three primary character types:

- `CHARACTER(n)` or `CHAR(n)`
- `CHARACTER VARYING(n)` or `VARCHAR(n)`
- `TEXT`

In this syntax, `n` is a positive integer that specifies the number of characters.

The following table illustrates the character types in PostgreSQL:

| **Character Types**                  | **Description**                    |
| ------------------------------------ | ---------------------------------- |
| `CHARACTER VARYING(n)`, `VARCHAR(n)` | variable\-length with length limit |
| `CHARACTER(n)`, `CHAR(n)`            | fixed\-length, blank padded        |
| `TEXT`, `VARCHAR`                    | variable unlimited length          |

Both `CHAR(n)` and `VARCHAR(n)` can store up to `n` characters. If you attempt to store a string that has more than `n` characters, PostgreSQL will issue an error.

However, one exception is that if the excessive characters are all spaces, PostgreSQL truncates the spaces to the maximum length (`n`) and stores the trimmed characters.

If a string explicitly [casts](postgresql-cast) to a `CHAR(n)` or `VARCHAR(n)`, PostgreSQL will truncate the string to `n` characters before inserting it into the table.

The `TEXT` data type can store a string with unlimited length.

If you do not specify the n integer for the `VARCHAR` data type, it behaves like the `TEXT` datatype. The performance of the `VARCHAR` (without the size `n`) and `TEXT` are the same.

The advantage of specifying the length specifier for the `VARCHAR` data type is that PostgreSQL will issue an error if you attempt to insert a string that has more than `n` characters into the `VARCHAR(n)` column.

Unlike `VARCHAR`, The `CHARACTER` or `CHAR` without the length, specifier (`n`) is the same as the `CHARACTER(1)` or `CHAR(1)`.

Different from other database systems, in PostgreSQL, there is no performance difference among the three character types.

In most cases, you should use `TEXT`or `VARCHAR` and use the `VARCHAR(n)` only when you want PostgreSQL to check the length.

## PostgreSQL character type examples

Let’s take a look at an example to understand how the `CHAR`, `VARCHAR`, and `TEXT` data types work.

First, [create a new table](postgresql-create-table) called `character_tests`:

```shellsql
CREATE TABLE character_tests (
  id serial PRIMARY KEY,
  x CHAR (1),
  y VARCHAR (10),
  z TEXT
);
```

Then, [insert a new row](postgresql-insert) into the `character_tests` table:

```sql
INSERT INTO character_tests (x, y, z)
VALUES
  (
    'Yes', 'This is a test for varchar',
    'This is a very long text for the PostgreSQL text column'
  );
```

PostgreSQL issued an error:

```sql
ERROR:  value too long for type character(1)
```

This is because the data type of the `x` column is `char(1)` and we attempted to insert a string with three characters into this column.

Let’s fix it:

```sql
INSERT INTO character_tests (x, y, z)
VALUES
  (
    'Y',
    'This is a test for varchar',
    'This is a very long text for the PostgreSQL text column'
  );
```

PostgreSQL issues a different error:

```sql
ERROR:  value too long for type character varying(10)
```

This is because we attempted to insert a string with more than 10 characters into the column `y` that has the `varchar(10)` datatype.

The following statement inserts a new row into the `character_tests` table successfully.

```shell
INSERT INTO character_tests (x, y, z)
VALUES
  (
    'Y',
    'varchar(n)',
    'This is a very long text for the PostgreSQL text column'
  )
RETURNING *;
```

Output:

```
 id | x |     y      |                            z
----+---+------------+---------------------------------------------------------
  1 | Y | varchar(n) | This is a very long text for the PostgreSQL text column
(1 row)
```

## Summary

- PostgreSQL supports `CHAR`, `VARCHAR`, and `TEXT` data types. The `CHAR` is a fixed\-length character type while the `VARCHAR` and `TEXT` are varying length character types.
- Use `VARCHAR(n)` if you want to validate the length of the string (`n`) before inserting into or updating to a column.
- `VARCHAR` (without the length specifier) and `TEXT` are equivalent.


# NUMERIC

---
title: 'PostgreSQL NUMERIC Type'
page_title: 'PostgreSQL NUMERIC Data Type'
page_description: 'You will learn about the PostgreSQL NUMERIC data type and how to use the NUMERIC column for storing values that precision is required.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-numeric/'
ogImage: ''
updatedOn: '2024-04-18T12:27:09+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Character Types: CHAR, VARCHAR, and TEXT'
  slug: 'postgresql-tutorial/postgresql-char-varchar-text'
nextLink:
  title: 'PostgreSQL DOUBLE PRECISION Data Type'
  slug: 'postgresql-tutorial/postgresql-double-precision-type'
---

**Summary**: in this tutorial, you will learn about the PostgreSQL `NUMERIC` type for storing numeric data.

## Introduction to PostgreSQL NUMERIC data type

The `NUMERIC` type can store numbers with a lot of digits. Typically, you use the `NUMERIC` type for storing numbers that require exactness such as monetary amounts or quantities.

Here’s the syntax for declaring a column with the `NUMERIC` type:

```shellsqlsql
column_name NUMERIC(precision, scale)
```

In this syntax:

- The `precision` is the total number of digits
- The `scale` is the number of digits in the fraction part.

The storage type of the numeric type depends on the `precision` and `scale`.

The `NUMERIC` type can hold a value of up to `131,072` digits before the decimal point `16,383` digits after the decimal point.

The scale of the `NUMERIC` type can be zero, positive, or negative.

PostgreSQL 15 or later allows you to declare a numeric column with a negative scale.

The following declares the price column with the numeric type that can store total numbers with 7 digits, 5 before the decimal points and 2 digits after the decimal point:

```sql
price NUMERIC(7,2)
```

If you use a negative scale, you can store up to precision \+ scale digits on the left and no digits on the right of the decimal point. For example:

```
amount NUMERIC(5,-2)
```

In this example, you can store up to 7 digits before and 0 digits after the decimal point.

The following example shows how to declare a column of type numeric with a zero scale:

```
quantity NUMERIC(5, 0)
```

It’s equivalent to the following declaration that does not explicitly specify the zero scale:

```sql
quantity NUMERIC(5)
```

If you omit precision and scale, they will default to 131072 and 16383, respectively.

```
NUMERIC
```

### NUMERIC, DECIMAL, and DEC types

In PostgreSQL, the `NUMERIC` and `DECIMAL` types are synonyms so you can use them interchangeably:

```sql
DECIMAL(p,s)
```

If you prefer a shorter name, you can use the name DEC because DEC and DECIMAL are the same type:

```
DEC(p,s)
```

If precision is not required, you should not use the `NUMERIC` type because calculations on `NUMERIC` values are typically slower than [integers](postgresql-integer), float, and double precisions.

### Special values

Besides the ordinal numeric values, the `numeric` type has several special values:

- `Infinity`
- `-Infinity`
- `NaN`

These values represent “infinity”, “negative infinity”, and “not\-a\-number”, respectively.

## PostgreSQL NUMERIC data type examples

Let’s take some examples of using the PostgreSQL `NUMERIC` type.

### 1\) Storing numeric values

If you store a value with a scale greater than the declared scale of the `NUMERIC` column, PostgreSQL will [round](../postgresql-math-functions/postgresql-round) the value to a specified number of fractional digits. For example:

First, [create a new table](postgresql-create-table) called `products`:

```
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    price NUMERIC(5,2)
);
```

Second, [insert](../postgresql-python/insert) some products with prices whose scales exceed the scale declared in the `price` column:

```sql
INSERT INTO products (name, price)
VALUES ('Phone',500.215),
       ('Tablet',500.214);
```

Because the scale of the `price` column is 2, PostgreSQL rounds the value `500.215` up to `500.22` and rounds the value `500.214` down to `500.21` :

The following [query](postgresql-select) returns all rows of the `products` table:

```sql
SELECT * FROM products;
```

Output:

```text
 id |  name  | price
----+--------+--------
  1 | Phone  | 500.22
  2 | Tablet | 500.21
(2 rows)
```

If you store a value whose precision exceeds the declared precision, PostgreSQL will raise an error as shown in the following example:

```
INSERT INTO products (name, price)
VALUES('Phone',123456.21);
```

PostgreSQL issued the following error:

```sql
ERROR:  numeric field overflow
DETAIL:  A field with precision 5, scale 2 must round to an absolute value less than 10^3.
```

### 2\) PostgreSQL NUMERIC type and NaN

In addition to holding numeric values, the `NUMERIC` type can also hold a special value called `NaN` which stands for not\-a\-number.

The following example updates the price of product id 1 to `NaN` :

```
UPDATE products
SET price = 'NaN'
WHERE id = 1;
```

Notice that you must use single quotes to wrap the `NaN` as shown in the [`UPDATE`](postgresql-update) statement above.

The following query returns the data of the `products` table:

```sql
SELECT * FROM products;
```

Output:

```
 id |  name  | price
----+--------+--------
  2 | Tablet | 500.21
  1 | Phone  |    NaN
(2 rows)
```

Typically, the `NaN` is not equal to any number including itself. It means that the expression `NaN = NaN` returns `false`. You’ll find this implementation [in JavaScript for [NaN](https://www.javascripttutorial.net/javascript-nan/)](https://www.javascripttutorial.net/javascript-nan/).

But in PostgreSQL, two `NaN` values are equal. Also, `NaN` values are greater than regular numbers such as 1, 2, 3\. This implementation allows PostgreSQL to sort `NUMERIC` values and use them in tree\-based [indexes](../postgresql-indexes).

The following query [sorts](postgresql-order-by) the products based on prices from high to low:

```sql
SELECT * FROM products
ORDER BY price DESC;
```

Output:

```
 id |  name  | price
----+--------+--------
  1 | Phone  |    NaN
  2 | Tablet | 500.21
(2 rows)
```

The output indicates that the `NaN` is greater than `500.21`

## Summary

- Use the PostgreSQL `NUMERIC` data type to store numbers that require exactness.


# DOUBLE PRECISION

---
title: 'PostgreSQL DOUBLE PRECISION Data Type'
page_title: 'PostgreSQL DOUBLE PRECISION Data Type'
page_description: 'In this tutorial, you will learn about the PostgreSQL DOUBLE PRECISION data type and its features.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-double-precision-type/'
ogImage: ''
updatedOn: '2024-04-19T03:25:47+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL NUMERIC Type'
  slug: 'postgresql-tutorial/postgresql-numeric'
nextLink:
  title: 'PostgreSQL REAL Data Type'
  slug: 'postgresql-tutorial/postgresql-real-data-type'
---

**Summary**: in this tutorial, you will learn about the PostgreSQL `DOUBLE PRECISION` data type and its features.

## Introduction to the PostgreSQL double precision type

In PostgreSQL, the `DOUBLE PRECISION` is an inexact, variable\-precision numeric type.

Inexact means that PostgreSQL cannot exactly convert some values into an internal format and can only store them as approximations. Consequently, storing and querying a value might show a slight difference.

If your application requires exact storage and calculation, it’s recommended to use the [numeric](postgresql-numeric) type instead.

Note that PostgreSQL double precision data type is an implementation of the [IEEE Standard 754 for Floating\-Point Arithmetic.](https://ieeexplore.ieee.org/document/8766229)

The following shows how to define a column with the `DOUBLE PRECISION` type:

```csssql
column_name double precision
```

Alternatively, you can use the `float8` or `float` data type which is the same as `DOUBLE PRECISION`:

```sql
colum_name float
```

A column of `DOUBLE PRECISION` type can store values that have a range around `1E-307` to `1E+308` with a precision of at least 15 digits.

If you store a value that is out of the range, PostgreSQL will be unable to store it and raise an error.

If you store numbers with very high precision, PostgreSQL may round them to fit within the limitation of double precision. This may potentially lose some precision in the calculation.

If you store very small numbers close to zero, PostgreSQL may raise an underflow error due to the limitations of double precision data type, which may be unable to accurately represent such small values distinct from zero.

In practice, you’ll use the double precision type for storing scientific measurements.

## PostgreSQL double precision type examples

Let’s take some examples of using the `DOUBLE PRECISION` data type.

### 1\) Basic double precision data type example

First, [create a table](postgresql-create-table) called `temperatures` to store temperature readings:

```sql
CREATE TABLE temperatures (
    id SERIAL PRIMARY KEY,
    location TEXT NOT NULL,
    temperature DOUBLE PRECISION
);
```

Second, insert some rows into the `temperatures` table:

```sql
INSERT INTO
  temperatures (location, temperature)
VALUES
  ('Lab Room 1', 23.5),
  ('Server Room 1', 21.8),
  ('Server Room 2', 24.3)
RETURNING *;
```

Output:

```text
 id |   location    | temperature
----+---------------+-------------
  1 | Lab Room 1    |        23.5
  2 | Server Room 1 |        21.8
  3 | Server Room 2 |        24.3
(3 rows)
```

Third, calculate the average temperature of all locations:

```
SELECT AVG(temperature)
FROM temperatures;
```

Output:

```text
 avg
------
 23.2
```

### 2\) Storing inexact values

First, [create a table](postgresql-create-table) `t` with the column `c` of `DOUBLE PRECISION` type:

```
CREATE TABLE t(c double precision);
```

Second, [insert rows](postgresql-insert-multiple-rows) into the `t` table:

```sql
INSERT INTO t(c) VALUES(0.1), (0.1), (0.1)
RETURNING *;
```

Output:

```text
  c
-----
 0.1
 0.1
 0.1
(3 rows)
```

Third, calculate the sum of values in the c column using the [`SUM()`](../postgresql-aggregate-functions/postgresql-sum-function) function:

```sql
SELECT SUM(c) FROM t;
```

Output:

```text
         sum
---------------------
 0.30000000000000004
(1 row)
```

The output indicates that the sum of `0.1`, `0.1`, and `0.1` is not `0.3` but `0.30000000000000004`. This indicates that PostgreSQL cannot store the exact number `0.1` using the `DOUBLE PRECISION` type.

### 2\) Inserting too small numbers

The following statement attempts to [insert](postgresql-insert) a very small number into the `c` column of the `t` table:

```sql
INSERT INTO t(c)
VALUES (1E-400);
```

It returns the following error:

```sql
ERROR:  "0.0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001" is out of range for type double precision
```

The reason is that the number is too small and very close to zero. PostgreSQL cannot store it due to the limitation of the double precision type.

## Summary

- `DOUBLE PRECISION` data type represents the inexact numbers.
- `DOUBLE PRECISION`, `FLOAT8`, or `FLOAT` are synonyms.
- Use `DOUBLE PRECISION` type to store inexact numbers and `NUMERIC` type to store exact numbers.


# REAL

---
title: 'PostgreSQL REAL Data Type'
page_title: 'PostgreSQL REAL Data Type'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL REAL data type to store single-precision floating-point numbers in the database.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-real-data-type/'
ogImage: ''
updatedOn: '2024-04-19T03:13:41+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL DOUBLE PRECISION Data Type'
  slug: 'postgresql-tutorial/postgresql-double-precision-type'
nextLink:
  title: 'PostgreSQL Integer Data Types'
  slug: 'postgresql-tutorial/postgresql-integer'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `REAL` data type to store single\-precision floating\-point numbers in the database.

## Introduction to the PostgreSQL REAL data type

The `REAL` data type allows you to store single\-precision floating\-point numbers in the database.

A value of the real type takes 4 bytes of storage space. Its valid range is from `-3.40282347 × 1038` and `3.40282347 × 1038`.

Typically, you use the `REAL` data type to store floating\-point numbers with relatively large ranges and precision is not critical, or when you are concerned about the storage space.

However, you can use the [double precision](postgresql-double-precision-type) data type if you need higher precision.

## PostgreSQL REAL data type example

First, [create a table](postgresql-create-table) called `weathers` to store wind speed (meter per second) and temperature (celsius) data:

```sql
CREATE TABLE weathers(
    id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    location VARCHAR(255) NOT NULL,
    wind_speed_mps REAL NOT NULL,
    temperature_celsius REAL NOT NULL,
    recorded_at TIMESTAMP NOT NULL
);
```

Second, [insert rows](postgresql-insert) into the `weathers` table:

```sql
INSERT INTO weathers (location, wind_speed_mps, temperature_celsius, recorded_at)
VALUES
    ('New York', 5.2, 15.3, '2024-04-19 09:00:00'),
    ('New York', 4.8, 14.9, '2024-04-19 10:00:00'),
    ('New York', 6.0, 16.5, '2024-04-19 11:00:00'),
    ('New York', 5.5, 15.8, '2024-04-19 12:00:00'),
    ('New York', 4.3, 14.2, '2024-04-19 13:00:00'),
    ('New York', 5.9, 16.1, '2024-04-19 14:00:00'),
    ('New York', 6.8, 17.3, '2024-04-19 15:00:00'),
    ('New York', 5.1, 15.6, '2024-04-19 16:00:00'),
    ('New York', 4.7, 14.8, '2024-04-19 17:00:00'),
    ('New York', 5.3, 15.9, '2024-04-19 18:00:00');
```

Third, calculate the [average](../postgresql-aggregate-functions/postgresql-avg-function) wind speed and temperature in `New York` on `April 19, 2024`:

```sql
SELECT
  AVG(wind_speed_mps)       wind_speed,
  AVG(temperature_celsius) temperature_celsius
FROM
  weathers
WHERE
  location = 'New York'
  AND DATE(recorded_at) = '2024-04-19';
```

Output:

```text
    wind_speed     | temperature_celsius
-------------------+---------------------
 5.360000038146973 |  15.639999961853027
(1 row)
```

## Summary

- Use the PostgreSQL `REAL` data type to store single\-precision floating\-point numbers in the database.


# Integer

---
title: 'PostgreSQL Integer Data Types'
page_title: 'PostgreSQL Integer Data Types'
page_description: 'This tutorial introduces you to various PostgreSQL integer data types including SMALLINT, INTEGER, and BIGINT for designing tables.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-integer/'
ogImage: '/postgresqltutorial/postgresql-integer-300x59.png'
updatedOn: '2024-02-02T07:01:29+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL REAL Data Type'
  slug: 'postgresql-tutorial/postgresql-real-data-type'
nextLink:
  title: 'PostgreSQL DATE Data Type'
  slug: 'postgresql-tutorial/postgresql-date'
---

**Summary**: this tutorial introduces you to various PostgreSQL integer types including `SMALLINT`, `INTEGER`, and `BIGINT`.

## Introduction to PostgreSQL integer types

![postgresql integer](/postgresqltutorial/postgresql-integer-300x59.png?alignright)
To store the whole numbers in PostgreSQL, you can use one of the following integer types:

- `SMALLINT`
- `INTEGER`
- `BIGINT`

The following table illustrates the specification of each integer type:

| Name       | Storage Size | Min                         | Max                         |
| ---------- | ------------ | --------------------------- | --------------------------- |
| `SMALLINT` | 2 bytes      | \-32,768                    | \+32,767                    |
| `INTEGER`  | 4 bytes      | \-2,147,483,648             | \+2,147,483,647             |
| `BIGINT`   | 8 bytes      | \-9,223,372,036,854,775,808 | \+9,223,372,036,854,775,807 |

If you attempt to store a value outside of the permitted ranges, PostgreSQL will issue an error.

Unlike [MySQL integer](https://www.mysqltutorial.org/mysql-basics/mysql-int/), PostgreSQL does not provide unsigned integer types.

### SMALLINT

The `SMALLINT` requires 2 bytes storage size which can store any integer numbers that are in the range of (\-32,767, 32,767\).

You can use the `SMALLINT` type for storing something like the ages of people, the number of pages of a book, and so on.

The following statement [creates a table](postgresql-create-table) named `books`:

```sql
CREATE TABLE books (
    book_id SERIAL PRIMARY KEY,
    title VARCHAR (255) NOT NULL,
    pages SMALLINT NOT NULL CHECK (pages > 0)
);
```

In this example, the `pages` column is a `SMALLINT` column. Because the number of pages must be positive, we added a [`CHECK`](postgresql-check-constraint) constraint to enforce this rule.

### INTEGER

The `INTEGER` is the most common choice between integer types because it offers the best balance between storage size, range, and performance.

The `INTEGER` type requires 4 bytes storage size that can store numbers in the range of (\-2,147,483,648, 2,147,483,647\).

You can use the `INTEGER` type for a column that stores quite big whole numbers like the population of a city or even country as the following example:

```sql
CREATE TABLE cities (
    city_id serial PRIMARY KEY,
    city_name VARCHAR (255) NOT NULL,
    population INT NOT NULL CHECK (population >= 0)
);
```

Notice that `INT` is the synonym of `INTEGER`.

### BIGINT

If you want to store the whole numbers that are out of the range of the `INTEGER` type, you can use the `BIGINT` type.

The `BIGINT` type requires 8 bytes storage size that can store any number in the range of (\-9,223,372,036,854,775,808,\+9,223,372,036,854,775,807\).

Using `BIGINT` type is not only consuming a lot of storage but also decreasing the performance of the database, therefore, you should have a good reason to use it.

## Summary

- Use `SMALLINT`, `INT`, and `BIGINT` data types to store integers in the database.


# SERIAL

---
title: 'Using PostgreSQL SERIAL to Create Auto-increment Column'
page_title: 'Using PostgreSQL SERIAL to Create Auto-increment Columns'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL SERIAL to create an auto-increment column in a database table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-serial/'
ogImage: '/postgresqltutorial/PostgreSQL-Serial-268x300.png'
updatedOn: '2024-02-01T08:57:58+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CREATE TABLE AS'
  slug: 'postgresql-tutorial/postgresql-create-table-as'
nextLink:
  title: 'PostgreSQL Sequences'
  slug: 'postgresql-tutorial/postgresql-sequences'
---

![PostgreSQL Serial](/postgresqltutorial/PostgreSQL-Serial-268x300.png?alignright)**Summary**: in this tutorial,  you will learn about the PostgreSQL `SERIAL` pseudo\-type and how to use the `SERIAL` pseudo\-type to define auto\-increment columns in tables.

## Introduction to the PostgreSQL SERIAL pseudo\-type

In PostgreSQL, a [sequence](postgresql-sequences) is a special kind of database object that generates a sequence of integers. A sequence is often used as the [primary key](postgresql-primary-key) column in a table.

When [creating a new table](postgresql-create-table), the sequence can be created through the `SERIAL` pseudo\-type as follows:

```phpsql
CREATE TABLE table_name(
    id SERIAL
);
```

By assigning the `SERIAL` pseudo\-type to the `id` column, PostgreSQL performs the following:

- First, create a sequence object and set the next value generated by the sequence as the default value for the column.
- Second, add a [`NOT NULL`](postgresql-not-null-constraint) constraint to the `id` column because a sequence always generates an integer, which is a non\-null value.
- Third, assign the owner of the sequence to the `id` column; as a result, the sequence object is deleted when the `id` column or table is dropped

Behind the scenes, the following statement:

```sql
CREATE TABLE table_name(
    id SERIAL
);
```

is equivalent to the following statements:

```sql
CREATE SEQUENCE table_name_id_seq;

CREATE TABLE table_name (
    id integer NOT NULL DEFAULT nextval('table_name_id_seq')
);

ALTER SEQUENCE table_name_id_seq
OWNED BY table_name.id;
```

PostgreSQL provides three serial pseudo\-types `SMALLSERIAL`, `SERIAL`, and `BIGSERIAL` with the following characteristics:

| **Name**    | **Storage Size** | **Range**                      |
| ----------- | ---------------- | ------------------------------ |
| SMALLSERIAL | 2 bytes          | 1 to 32,767                    |
| SERIAL      | 4 bytes          | 1 to 2,147,483,647             |
| BIGSERIAL   | 8 bytes          | 1 to 9,223,372,036,854,775,807 |

## PostgreSQL SERIAL examples

Let’s take some examples of using the SERIAL columns.

### 1\) Basic PostgreSQL SERIAL example

It is important to note that the `SERIAL` does not implicitly [create an index](../postgresql-indexes/postgresql-create-index) on the column or make the column the [primary key](postgresql-primary-key) column. However, this can be done easily by specifying the `PRIMARY KEY` constraint for the `SERIAL` column.

The following statement creates the `fruits` table with the `id` column as the `SERIAL` column:

```sql
CREATE TABLE fruits(
   id SERIAL PRIMARY KEY,
   name VARCHAR NOT NULL
);
```

To assign a default value to a serial column when [inserting a row into the table](postgresql-insert), you ignore the column name or use the `DEFAULT` keyword in the [`INSERT`](postgresql-insert) statement. For example:

```sql
INSERT INTO fruits(name)
VALUES('Orange');
```

Or

```sql
INSERT INTO fruits(id,name)
VALUES(DEFAULT,'Apple');
```

PostgreSQL inserted two rows into the `fruits` table with the values for the `id` column are 1 and 2\.

```sql
SELECT * FROM fruits;
```

```text
 id |  name
----+--------
  1 | Apple
  2 | Orange
(2 rows)
```

### 2\) Getting the sequence name

To get the sequence name of a `SERIAL` column in a table, you use the `pg_get_serial_sequence()` function as follows:

```sql
pg_get_serial_sequence('table_name','column_name')
```

You can pass a sequence name to the  `currval()` function to get the recent value generated by the sequence. For example, the following statement returns the recent value generated by the `fruits_id_seq` object:

```sql
SELECT currval(pg_get_serial_sequence('fruits', 'id'));
```

```sql
currval
---------
2
(1 row)
```

### 3\) Retrieving the generated value

If you want to get the value generated by the sequence when you insert a new row into the table, you use the `RETURNING id` clause in the `INSERT` statement.

The following statement inserts a new row into the `fruits` table and returns the value generated for the id column.

```sql
INSERT INTO fruits(name)
VALUES('Banana')
RETURNING id;
```

```sql
id
----
3
(1 row)
```

The sequence generator operation is not transaction\-safe. It means that if two concurrent database connections attempt to get the next value from a sequence, each client will get a different value.

If one client rolls back the transaction, the sequence number of that client will be unused, creating a gap in the sequence.

### 4\) Adding a serial column to an existing table

First, create a new table called `baskets` without a primary key column:

```
CREATE TABLE baskets(
    name VARCHAR(255) NOT NULL
);
```

Second, add a `SERIAL` column to the `baskets` table:

```php
ALTER TABLE baskets
ADD COLUMN id SERIAL PRIMARY KEY;
```

Third, describe the table `baskets` to verify the change:

```
\d baskets
```

Output:

```
                                    Table "public.baskets"
 Column |          Type          | Collation | Nullable |               Default
--------+------------------------+-----------+----------+-------------------------------------
 name   | character varying(255) |           | not null |
 id     | integer                |           | not null | nextval('baskets_id_seq'::regclass)
Indexes:
    "baskets_pkey" PRIMARY KEY, btree (id)
```

## Summary

- Use the PostgreSQL pseudo\-type `SERIAL` to create an auto\-increment column for a table.


# DATE

---
title: 'PostgreSQL DATE Data Type'
page_title: 'PostgreSQL DATE Data Type'
page_description: 'This tutorial discusses PostgreSQL DATE data type and shows how to use some handy date functions to handle date values.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-date/'
ogImage: ''
updatedOn: '2024-04-19T09:05:26+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Integer Data Types'
  slug: 'postgresql-tutorial/postgresql-integer'
nextLink:
  title: 'PostgreSQL Timestamp Data Types'
  slug: 'postgresql-tutorial/postgresql-timestamp'
---

**Summary**: This tutorial discusses PostgreSQL `DATE` data type and shows how to use some handy date functions to handle date values.

## Introduction to the PostgreSQL DATE data type

PostgreSQL offers the `DATE` data type that allows you to store date data.

PostgreSQL uses 4 bytes to store a date value. The lowest and highest values of the `DATE` data type are 4713 BC and 5874897 AD, respectively.

When storing a date value, PostgreSQL uses the  `yyyy-mm-dd` format such as 2000\-12\-31\. It also uses the same format for [inserting data](postgresql-insert) into a `DATE` column.

If you [create a table](postgresql-create-table) that has a `DATE` column and want to use the current date of the PostgreSQL server as the default value, you can use the `CURRENT_DATE` as the default value of the column using a [DEFAULT constraint](postgresql-default-value)

For example, the following statement creates the `documents` table that has the `posting_date` column with the `DATE` data type.

```phpsqlsql
CREATE TABLE documents (
  document_id SERIAL PRIMARY KEY,
  header_text VARCHAR (255) NOT NULL,
  posting_date DATE NOT NULL DEFAULT CURRENT_DATE
);
```

The `posting_date` column accepts the current date as the default value. It means that if you don’t provide a value when inserting a new row into the `documents` table, PostgreSQL will insert the current date into the `posting_date` column. For example:

```sql
INSERT INTO documents (header_text)
VALUES ('Billing to customer XYZ')
RETURNING *;
```

Output:

```
 document_id |       header_text       | posting_date
-------------+-------------------------+--------------
           1 | Billing to customer XYZ | 2024-02-01
(1 row)
```

Note that you may get a different posting date value based on the current date of your database server.

## PostgreSQL DATE functions

For the demonstration, we will [create a new `employees` table](postgresql-create-table) that consists of `employee_id`, `first_name`, `last_name`, `birth_date`, and `hire_date` columns, where the data types of the `birth_date` and `hire_date` columns are `DATE`.

```sql
CREATE TABLE employees (
  employee_id SERIAL PRIMARY KEY,
  first_name VARCHAR (255) NOT NULL,
  last_name VARCHAR (255) NOT NULL,
  birth_date DATE NOT NULL,
  hire_date DATE NOT NULL
);

INSERT INTO employees (first_name, last_name, birth_date, hire_date)
VALUES ('Shannon','Freeman','1980-01-01','2005-01-01'),
       ('Sheila','Wells','1978-02-05','2003-01-01'),
       ('Ethel','Webb','1975-01-01','2001-01-01')
RETURNING *;
```

Output:

```css
 employee_id | first_name | last_name | birth_date | hire_date
-------------+------------+-----------+------------+------------
           1 | Shannon    | Freeman   | 1980-01-01 | 2005-01-01
           2 | Sheila     | Wells     | 1978-02-05 | 2003-01-01
           3 | Ethel      | Webb      | 1975-01-01 | 2001-01-01
(3 rows)


INSERT 0 3
```

### 1\) Get the current date

To get the current date and time, you use the built\-in `NOW()` function:

```
SELECT NOW();
```

Output:

```
              now
-------------------------------
 2024-02-01 08:48:09.599933+07
(1 row)
```

To get the date part only (without the time part), you use the cast operator (::) to cast a `DATETIME` value to a `DATE` value:

```
SELECT NOW()::date;
```

Output:

```text
    now
------------
 2024-02-01
(1 row)
```

A quick way to get the current date is to use the `CURRENT_DATE` function:

```
SELECT CURRENT_DATE;
```

Output:

```text
 current_date
--------------
 2024-02-01
(1 row)

```

The result is in the format `yyyy-mm-dd`. However, you can use a different format by formatting the date value using the `TO_CHAR()` function.

### 2\) Output a PostgreSQL date value in a specific format

To output a date value in a specific format, you use the `TO_CHAR()` function.

The `TO_CHAR()` function accepts two parameters. The first parameter is the value you want to format, and the second is the template that defines the output format.

For example, to display the current date in `dd/mm/yyyy` format, you use the following statement:

```
SELECT TO_CHAR(CURRENT_DATE, 'dd/mm/yyyy');
```

```text
  to_char
------------
 01/02/2024
(1 row)
```

To display a date in a format like `Feb 01, 2024`, you use the following statement:

```sql
SELECT TO_CHAR(CURRENT_DATE, 'Mon dd, yyyy');
```

```text
   to_char
--------------
 Feb 01, 2024
(1 row)
```

### 3\) Get the interval between two dates

To get the [interval](postgresql-interval) between two dates, you use the minus (`-`) operator.

The following example retrieves the service days of employees by subtracting the values in the `hire_date` column from today’s date:

```sql
SELECT
  first_name,
  last_name,
  now() - hire_date as diff
FROM
  employees;
```

Output:

```text
 first_name | last_name |           diff
------------+-----------+---------------------------
 Shannon    | Freeman   | 6970 days 08:51:20.824847
 Sheila     | Wells     | 7701 days 08:51:20.824847
 Ethel      | Webb      | 8431 days 08:51:20.824847
(3 rows)
```

### 4\) Calculate ages in years, months, and days

To calculate age at the current date in years, months, and days, you use the `AGE()` function.

The following statement uses the [`AGE()`](../postgresql-date-functions/postgresql-age) function to calculate the ages of employees in the `employees` table.

```sql
SELECT
	employee_id,
	first_name,
	last_name,
	AGE(birth_date)
FROM
	employees;
```

Output:

```text
 employee_id | first_name | last_name |           age
-------------+------------+-----------+--------------------------
           1 | Shannon    | Freeman   | 44 years 1 mon
           2 | Sheila     | Wells     | 45 years 11 mons 24 days
           3 | Ethel      | Webb      | 49 years 1 mon
(3 rows)
```

If you pass a date value to the `AGE()` function, it will subtract the date value from the current date.

If you pass two arguments to the `AGE()` function, it will subtract the second argument from the first argument.

For example, to get the age of employees on `01/01/2015`, you use the following statement:

```sql
SELECT
  employee_id,
  first_name,
  last_name,
  age('2015-01-01', birth_date)
FROM
  employees;
```

Output:

```text
 employee_id | first_name | last_name |           age
-------------+------------+-----------+--------------------------
           1 | Shannon    | Freeman   | 35 years
           2 | Sheila     | Wells     | 36 years 10 mons 24 days
           3 | Ethel      | Webb      | 40 years
(3 rows)
```

### 5\) Extract year, quarter, month, week, and day from a date value

To get the year, quarter, month, week, and day from a date value, you use the [`EXTRACT()`](../postgresql-date-functions/postgresql-extract) function.

The following statement extracts the year, month, and day from the birth dates of employees:

```sql
SELECT
	employee_id,
	first_name,
	last_name,
	EXTRACT (YEAR FROM birth_date) AS YEAR,
	EXTRACT (MONTH FROM birth_date) AS MONTH,
	EXTRACT (DAY FROM birth_date) AS DAY
FROM
	employees;
```

Output:

```text
 employee_id | first_name | last_name | year | month | day
-------------+------------+-----------+------+-------+-----
           1 | Shannon    | Freeman   | 1980 |     1 |   1
           2 | Sheila     | Wells     | 1978 |     2 |   5
           3 | Ethel      | Webb      | 1975 |     1 |   1
(3 rows)
```

In this tutorial, you have learned about the PostgreSQL `DATE` data type and some handy functions to handle date data.


# TIMESTAMP

---
title: 'PostgreSQL Timestamp Data Types'
page_title: 'PostgreSQL Timestamp Data Types'
page_description: 'This tutorial explains the PostgreSQL TIMESTAMP data types including TIMESTAMP and TIMESTAMPTZ for storing timestamp data.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-timestamp/'
ogImage: '/postgresqltutorial/PostgreSQL-Timestamp-300x171.jpg'
updatedOn: '2024-02-01T02:32:23+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL DATE Data Type'
  slug: 'postgresql-tutorial/postgresql-date'
nextLink:
  title: 'PostgreSQL Interval Data Type'
  slug: 'postgresql-tutorial/postgresql-interval'
---

**Summary**: in this tutorial, you will learn about the PostgreSQL timestamp data types including `timestamp` and `timestamptz`. You will also learn how to use some handy functions to handle timestamp data effectively.

## Introduction to PostgreSQL timestamp

![PostgreSQL Timestamp](/postgresqltutorial/PostgreSQL-Timestamp-300x171.jpg?alignright)PostgreSQL provides you with two temporal [data types](postgresql-data-types) for handling timestamps:

- `timestamp`: a timestamp without a timezone one.
- `timestamptz`: timestamp with a timezone.

The `timestamp` datatype allows you to store both [date](postgresql-date) and time. However, it does not have any time zone data. It means that when you change the timezone of your database server, the timestamp value stored in the database will not change automatically.

The `timestamptz` datatype is the timestamp with a timezone. The `timestamptz` data type is a time zone\-aware date and time data type.

Internally, PostgreSQL stores the `timestamptz` in UTC value.

- When you insert a value into a `timestamptz` column, PostgreSQL converts the `timestamptz` value into a UTC value and stores the UTC value in the table.
- When you retrieve data from a `timestamptz` column, PostgreSQL converts the UTC value back to the time value of the timezone set by the database server, the user, or the current database connection.

Notice that both `timestamp` and `timestamptz` uses 8 bytes for storing the timestamp values as shown in the following query:

```csssqlsql
SELECT
  typname,
  typlen
FROM
  pg_type
WHERE
  typname ~ '^timestamp';
```

Output:

```text
   typname   | typlen
-------------+--------
 timestamp   |      8
 timestamptz |      8
(2 rows)
```

It’s important to note that PostgreSQL stores `timestamptz` values in the database using UTC values. It does not store any timezone data with the `timestamptz` value.

## PostgreSQL timestamp example

Let’s take a look at an example of using the `timestamp` and `timestamptz`to have a better understanding of how PostgreSQL handles them.

First, [create a table](postgresql-create-table) that consists of both `timestamp` the `timestamptz` columns.

```sql
CREATE TABLE timestamp_demo (
    ts TIMESTAMP,
    tstz TIMESTAMPTZ
);
```

Next, set the time zone of the database server to  `America/Los_Angeles`.

```sql
SET timezone = 'America/Los_Angeles';
```

By the way, you can see the current time zone using the `SHOW TIMEZONE` command:

```sql
SHOW TIMEZONE;
```

```text
      TimeZone
---------------------
 America/Los_Angeles
(1 row)
```

Then, [insert a new row](postgresql-insert) into the `timstamp_demo`table:

```sql
INSERT INTO timestamp_demo (ts, tstz)
VALUES('2016-06-22 19:10:25-07','2016-06-22 19:10:25-07');
```

After that, [query data](postgresql-select) from the `timestamp` and `timestamptz` columns.

```sql
SELECT
   ts, tstz
FROM
   timestamp_demo;
```

```text
         ts          |          tstz
---------------------+------------------------
 2016-06-22 19:10:25 | 2016-06-22 19:10:25-07
(1 row)
```

The query returns the same timestamp values as the inserted values.

Finally, change the timezone of the current session to `America/New_York` and query data again.

```sql
SET timezone = 'America/New_York';
```

```sql
SELECT
  ts,
  tstz
FROM
  timestamp_demo;
```

```text
         ts          |          tstz
---------------------+------------------------
 2016-06-22 19:10:25 | 2016-06-22 22:10:25-04
(1 row)
```

The value in the `timestamp` column does not change whereas the value in the `timestamptz` column is adjusted to the new time zone of `'America/New_York'`.

Generally, it is a good practice to use the `timestamptz` data type to store the timestamp data.

## PostgreSQL timestamp functions

To handle timestamp data effectively, PostgreSQL provides some handy functions as follows:

### Getting the current time

To get the current timestamp you use the `NOW()` function as follows:

```sql
SELECT NOW();
```

Output:

```text
              now
-------------------------------
 2024-01-31 21:01:58.985943-05
(1 row)

```

Alternatively, you can use the `CURRENT_TIMESTAMP` function:

```sql
SELECT CURRENT_TIMESTAMP;
```

Output:

```text
       current_timestamp
-------------------------------
 2024-01-31 21:02:04.715486-05
(1 row)

```

To get the current time without a date, you use the `CURRENT_TIME` function:

```css
SELECT CURRENT_TIME;
```

Output:

```
    current_time
--------------------
 21:02:13.648512-05
(1 row)

```

Note that both `CURRENT_TIMESTAMP` and `CURRENT_TIME` return the current time with the time zone.

To get the time of day in the string format, you use the `timeofday()` function.

```sql
SELECT TIMEOFDAY();
```

```text
              timeofday
-------------------------------------
 Wed Jan 31 21:02:20.840159 2024 EST
(1 row)
```

### Convert between timezones

To convert a timestamp to another time zone, you use the `timezone(zone, timestamp)` function.

```sql
SHOW TIMEZONE;
```

```text
     TimeZone
------------------
 America/New_York
(1 row)
```

The current timezone is `America/New_York`.

To convert `2016-06-01 00:00` to `America/Los_Angeles` timezone, you use the `timezone()` function as follows:

```sql
SELECT timezone('America/Los_Angeles','2016-06-01 00:00');
```

```text
      timezone
---------------------
 2016-05-31 21:00:00
(1 row)
```

Note that we pass the timestamp as a string to the `timezone()` function, PostgreSQL casts it to `timestamptz` implicitly. It is better to cast a timestamp value to the `timestamptz` data type explicitly as the following statement:

```sql
SELECT timezone('America/Los_Angeles','2016-06-01 00:00'::timestamptz);
```

Output:

```
      timezone
---------------------
 2016-05-31 21:00:00
(1 row)
```

## Using default values for timestamp columns

First, create a new table called `department`:

```php
CREATE TABLE department (
    id SERIAL PRIMARY KEY,
    name VARCHAR NOT NULL,
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);
```

The default values for the `created_at` and `updated_at` columns are the current timestamp provided by the `CURRENT_TIMESTAMP` function.

Second, insert a new row into the `department` table without specifying the values for the `created_at` and `updated_at` columns:

```
INSERT INTO department(name)
VALUES('IT')
RETURNING *;
```

Output:

```text
 id | name |          created_at           |          updated_at
----+------+-------------------------------+-------------------------------
  1 | IT   | 2024-01-31 21:25:31.162808-05 | 2024-01-31 21:25:31.162808-05
(1 row)
```

The output indicates that PostgreSQL uses the current time to insert into the `created_at` and `updated_at` columns.

When you update a row in the `department` table, the `updated_at` column will not be updated to the current time automatically.

To update the value in the updated_at column to the time the row is updated, you can create a `BEFORE UPDATE` trigger to change the value in the `updated_at` column.

Note that MySQL offers the `ON UPDATE CURRENT_TIMESTAMP` to automatically update a `TIMESTAMP` column to the current timestamp. PostgreSQL does not support this feature at the moment.

Third, create a `BEFORE UPDATE` trigger to update the `updated_at` column of the `department` table:

```
CREATE OR REPLACE FUNCTION update_updated_at()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = current_timestamp;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER department_updated_at_trigger
BEFORE UPDATE ON department
FOR EACH ROW
EXECUTE FUNCTION update_updated_at();
```

Fourth, update the name of the IT department to ITD without specifying a value for the `updated_at` column:

```
UPDATE department
SET name = 'ITD'
WHERE id = 1
RETURNING *;
```

Output:

```
 id | name |          created_at           |          updated_at
----+------+-------------------------------+-------------------------------
  1 | ITD  | 2024-01-31 21:25:31.162808-05 | 2024-01-31 21:25:51.318803-05
(1 row)
```

The output indicates that the value in the `updated_at` column has been updated automatically by the trigger.

## Summary

- Use `timestamp` and `timestamptz` to store timestamp data.
- PostgreSQL stores the `timestamptz` values in the database as UTC values.


# Interval

---
title: 'PostgreSQL Interval Data Type'
page_title: 'PostgreSQL Interval Data Type'
page_description: 'This tutorial introduces PostgreSQL interval type and shows you how to manipulate interval values using arithmetic operators and functions.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-interval/'
ogImage: ''
updatedOn: '2024-02-01T02:58:18+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Timestamp Data Types'
  slug: 'postgresql-tutorial/postgresql-timestamp'
nextLink:
  title: 'PostgreSQL TIME Data Type'
  slug: 'postgresql-tutorial/postgresql-time'
---

**Summary**: in this tutorial, you will learn about the PostgreSQL interval data type and how to manipulate interval values.

## Introduction to PostgreSQL interval data type

The interval data type allows you to store and manipulate a period in years, months, days, hours, minutes, and seconds.

The following illustrates the interval type:

```sql
@ interval [ fields ] [ (p) ]
```

An interval value requires 16 bytes of storage that can store a period with the allowed range from `-178,000,000` years to `178,000,000` years.

Additionally, an interval value can have an optional precision value `p` with the permitted range from 0 to 6\. The precision `p` is the number of fraction digits retained in the second field.

The at sign ( `@`) is optional so you can omit it.

The following  examples show some interval values:

```sql
interval '2 months ago';
interval '3 hours 20 minutes';
```

Internally, PostgreSQL stores interval values as months, days, and seconds. The months and days values are integers while the seconds field can have fractions.

The interval values are very useful when doing [date](postgresql-date) or time arithmetic. For example, if you want to know the time of 3 hours 2 minutes ago at the current time of last year, you can use the following statement:

```sql
SELECT
	now(),
	now() - INTERVAL '1 year 3 hours 20 minutes'
             AS "3 hours 20 minutes ago of last year";
```

Output:

```text
              now              | 3 hours 20 minutes ago of last year
-------------------------------+-------------------------------------
 2024-01-31 21:34:52.242914-05 | 2023-01-31 18:14:52.242914-05
(1 row)
```

Let’s see how to format interval values for input and output.

## PostgreSQL interval input format

PostgreSQL provides you with the following verbose syntax to write the interval values:

```
quantity unit [quantity unit...] [direction]
```

- `quantity` is a number, sign `+` or `-` is also accepted
- `unit` can be any of millennium, century, decade, year, month, week, day, hour, minute, second, millisecond, microsecond, or abbreviation (y, m, d, etc.,) or plural forms (months, days, etc.).
- `direction` can be `ago` or empty string `''`

This format is called `postgres_verbose` which is also used for the interval output format. The following examples illustrate some interval values that use the verbose syntax:

```sql
INTERVAL '1 year 2 months 3 days';
INTERVAL '2 weeks ago';
```

### ISO 8601 interval format

In addition to the verbose syntax, PostgreSQL allows you to write the interval values using `ISO 8601` time intervals in two ways: format with designators and alternative format.

The `ISO 8601` format with designators is like this:

```sql
P quantity unit [ quantity unit ...] [ T [ quantity unit ...]]
```

In this format, the interval value must start with the letter `P`. The letter `T` is for determining the time\-of\-day unit.

The following table illustrates the `ISO 8601` interval unit abbreviations:

| Abbreviation | Description                |
| ------------ | -------------------------- |
| Y            | Years                      |
| M            | Months (in the date part)  |
| W            | Weeks                      |
| D            | Days                       |
| H            | Hours                      |
| M            | Minutes (in the time part) |
| S            | Seconds                    |

Note that `M` can be months or minutes depending on whether it appears before or after the letter `T`.

For example, the interval of 6 years 5 months 4 days 3 hours 2 minutes 1 second can be written in the ISO 8601 designators format as follows:

```sql
P6Y5M4DT3H2M1S
```

The alternative form of `ISO 8601` is:

```sql
P [ years-months-days ] [ T hours:minutes:seconds ]
```

It must start with the letter `P`, and the letter `T` separates the date and time parts of the interval value.

For example, the interval of `6 years 5 months 4 days 3 hours 2 minutes 1 second` can be written in the `ISO 8601` alternative form as:

```sql
P0006-05-04T03:02:01
```

## PostgreSQL interval output format

The output style of interval values is set by using the `SET intervalstyle` command, for example:

```sql
SET intervalstyle = 'sql_standard';
```

PostgreSQL provides four output formats:

- `sql standard`
- `postgres`
- `postgresverbose`
- `iso_8601`

PostgreSQL uses the `postgres` style by default for formatting the interval values.

The following represents the interval of `6 years 5 months 4 days 3 hours 2 minutes 1 second` in the four styles:

```sql
SET intervalstyle = 'sql_standard';
SELECT
  INTERVAL '6 years 5 months 4 days 3 hours 2 minutes 1 second';

SET intervalstyle = 'postgres';
SELECT
  INTERVAL '6 years 5 months 4 days 3 hours 2 minutes 1 second';

SET intervalstyle = 'postgres_verbose';
SELECT
  INTERVAL '6 years 5 months 4 days 3 hours 2 minutes 1 second';

SET intervalstyle = 'iso_8601';
SELECT
  INTERVAL '6 years 5 months 4 days 3 hours 2 minutes 1 second';
```

| sql standard       | postgres                         | postgres verbose                               | iso_8601         |
| ------------------ | -------------------------------- | ---------------------------------------------- | ---------------- |
| `+6-5 +4 +3:02:01` | `6 years 5 mons 4 days 03:02:01` | `@ 6 years 5 mons 4 days 3 hours 2 mins 1 sec` | `P6Y5M4DT3H2M1S` |

## PostgreSQL interval\-related operators and functions

### Interval operators

You can apply the arithmetic operator ( `+`, `-`, `*`, etc.,) to the interval values, for example:

```sql
SELECT INTERVAL '2h 50m' + INTERVAL '10m'; -- 03:00:00
SELECT INTERVAL '2h 50m' - INTERVAL '50m'; -- 02:00:00
SELECT 600 * INTERVAL '1 minute'; -- 10:00:00
```

### Converting PostgreSQL interval to string

To convert an interval value to a string, you use the `TO_CHAR()` function.

```sql
TO_CHAR(interval,format)
```

The [`TO_CHAR()`](../postgresql-string-functions/postgresql-to_char) function takes the first argument as an interval value, the second one as the format, and returns a string that represents the interval in the specified format.

See the following example:

```sql
SELECT
    TO_CHAR(
        INTERVAL '17h 20m 05s',
        'HH24:MI:SS'
    );
```

Output:

```text
 to_char
----------
 17:20:05
(1 row)
```

### Extracting data from a PostgreSQL interval

To extract fields such as year, month, date, etc., from an interval, you use the [`EXTRACT()`](../postgresql-date-functions/postgresql-extract) function.

```sql
EXTRACT(field FROM interval)
```

The field can be the year, month, date, hour, minutes, etc., that you want to extract from the interval. The extract function returns a value of type double precision.

See the following example:

```sql
SELECT
    EXTRACT (
        MINUTE
        FROM
            INTERVAL '5 hours 21 minutes'
    );
```

In this example, we extracted the minute from the interval of `5 hours 21 minutes` and it returned `21` as expected:

```text
 date_part
-----------
        21
(1 row)
```

### Adjusting interval values

PostgreSQL provides two functions `justifydays` and `justifyhours` that allows you to adjust the interval of 30\-day as one month and the interval of 24 hours as one day:

```sql
SELECT
    justify_days(INTERVAL '30 days'),
    justify_hours(INTERVAL '24 hours');
```

```text
 justify_days | justify_hours
--------------+---------------
 1 mon        | 1 day
(1 row)
```

In addition, the `justify_interval` function adjusts interval using `justifydays` and  `justifyhours` with additional sign adjustments:

```
SELECT
    justify_interval(interval '1 year -1 hour');
```

```text
     justify_interval
--------------------------
 11 mons 29 days 23:00:00
(1 row)
```

## Using interval type in a table

First, create a table called `event` that has three columns `id`, `event_name`, and `duration`. The duration column is `interval` type:

```sql
CREATE TABLE event (
    id SERIAL PRIMARY KEY,
    event_name VARCHAR(255) NOT NULL,
    duration INTERVAL NOT NULL
);
```

Second, insert some rows into the `event` table:

```sql
INSERT INTO event (event_name, duration)
VALUES
    ('pgConf', '1 hour 30 minutes'),
    ('pgDAY', '2 days 5 hours')
RETURNING *;
```

Output:

```text
 id | event_name | duration
----+------------+----------
  1 | pgConf     | PT1H30M
  2 | pgDAY      | P2DT5H
(2 rows)


INSERT 0 2
```

Third, extract components (days, hours, minutes) from values in the `interval` column:

```
SELECT
    event_name,
    duration,
    EXTRACT(DAY FROM duration) AS days,
    EXTRACT(HOUR FROM duration) AS hours,
    EXTRACT(MINUTE FROM duration) AS minutes
FROM event;
```

Output:

```text
 event_name | duration | days | hours | minutes
------------+----------+------+-------+---------
 pgConf     | PT1H30M  |    0 |     1 |      30
 pgDAY      | P2DT5H   |    2 |     5 |       0
(2 rows)
```

Fourth, retrieve the events with a duration longer than one day:

```
SELECT *
FROM event
WHERE duration > INTERVAL '1 day';
```

Output:

```text
 id | event_name | duration
----+------------+----------
  2 | pgDAY      | P2DT5H
(1 row)
```

Finally, calculate the total duration for all events:

```
SELECT
    SUM(duration) AS total_duration
FROM event
;
```

Output:

```text
 total_duration
----------------
 P2DT6H30M
(1 row)
```

To make the output more clear, you can extract components of the total duration using a common table expression (CTE):

```
WITH cte AS(
   SELECT SUM(duration) AS total_duration
   FROM event
)
SELECT
    total_duration,
    EXTRACT(DAY FROM total_duration ) AS days,
    EXTRACT(HOUR FROM total_duration ) AS hours,
    EXTRACT(MINUTE FROM total_duration ) AS minutes
FROM cte;
```

Output:

```
 total_duration | days | hours | minutes
----------------+------+-------+---------
 P2DT6H30M      |    2 |     6 |      30
(1 row)
```

In this tutorial, you have learned about the PostgreSQL interval data type and how to manipulate interval values.


# TIME

---
title: 'PostgreSQL TIME Data Type'
page_title: 'PostgreSQL TIME Data Type'
page_description: 'This tutorial introduces you to the PostgreSQL TIME data type and some useful time-related functions to handle time values effectively.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-time/'
ogImage: '/postgresqltutorial/PostgreSQL-TIME-example.png'
updatedOn: '2024-02-02T06:49:37+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Interval Data Type'
  slug: 'postgresql-tutorial/postgresql-interval'
nextLink:
  title: 'PostgreSQL UUID Data Type'
  slug: 'postgresql-tutorial/postgresql-uuid'
---

**Summary**: in this tutorial, you will learn about the PostgreSQL `TIME` data types and some handy functions to handle time values.

## Introduction to PostgreSQL TIME data type

PostgreSQL provides the `TIME` data type that allows you to store the time data in the database.

Here’s the syntax for declaring a column with the `TIME` data type:

```phpsqlsql
column_name TIME(precision);
```

In this syntax, the `precision` specifies the fractional seconds precision for the time value, which ranges from 1 to 6\.

The `TIME` data type requires 8 bytes and its allowed range is from `00:00:00` to `24:00:00`.

The following illustrates the common formats of the `TIME` values:

```sql
HH:MI
HH:MI:SS
HHMISS
```

For example:

```sql
01:02
01:02:03
010203
```

To use a time value with the precision, you can utilize the following formats:

```sql
MI:SS.pppppp
HH:MI:SS.pppppp
HHMISS.pppppp
```

In this syntax, `p` specifies the precision. For example:

```sql
04:59.999999
04:05:06.777777
040506.777777
```

PostgreSQL accepts almost any reasonable `TIME` format including SQL\-compatible, ISO 8601, and so on.

## PostgreSQL TIME data type example

In practice, you often use the `TIME` data type for the columns that store the time of day only such as the time of an event or a shift. For example:

First, [create a new table](postgresql-create-table) named `shifts` by using the following `CREATE TABLE` statement:

```sql
CREATE TABLE shifts (
    id serial PRIMARY KEY,
    shift_name VARCHAR NOT NULL,
    start_at TIME NOT NULL,
    end_at TIME NOT NULL
);
```

Second, [insert](postgresql-insert) some rows into the `shifts` table:

```sql
INSERT INTO shifts(shift_name, start_at, end_at)
VALUES('Morning', '08:00:00', '12:00:00'),
      ('Afternoon', '13:00:00', '17:00:00'),
      ('Night', '18:00:00', '22:00:00');
```

Third, [query](postgresql-select) data from the `shifts` table:

```sql
SELECT * FROM shifts;
```

Output:

```text
 id | shift_name | start_at |  end_at
----+------------+----------+----------
  1 | Morning    | 08:00:00 | 12:00:00
  2 | Afternoon  | 13:00:00 | 17:00:00
  3 | Night      | 18:00:00 | 22:00:00
(3 rows)
```

## PostgreSQL TIME WITH TIME ZONE type

Besides the `TIME` data type, PostgreSQL provides the `TIME WITH TIME ZONE` data type that allows you to store and manipulate the time of day with time zone.

The following statement illustrates how to declare a column whose data type is `TIME WITH TIME ZONE`:

```
column TIME WITH TIME ZONE
```

The storage size of the `TIME WITH TIME ZONE` data type is 12 bytes, allowing you to store a time value with the time zone that ranges from `00:00:00+1459` to `24:00:00-1459`.

The following are some examples of the `TIME WITH TIME ZONE` type:

```sql
04:05:06 PST
04:05:06.789-8
```

When dealing with timezone, it is recommended to use [`TIMESTAMP`](postgresql-timestamp) instead of the `TIME WITH TIME ZONE` type. This is because the time zone has very little meaning unless it is associated with both date and time.

## Handling PostgreSQL TIME values

Let’s explore some functions that handle time values.

### 1\) Getting the current time

To get the current time with the time zone, you use the [`CURRENT_TIME`](../postgresql-date-functions/postgresql-current_time) function as follows:

```sql
SELECT CURRENT_TIME;
```

Output:

```
timetz
--------------------
 00:51:02.746572-08
(1 row)
```

To obtain the current time with a specific precision, you use the `CURRENT_TIME(precision)` function:

```sql
SELECT CURRENT_TIME(5);
```

Output:

```
   current_time
-------------------
 00:52:12.19515-08
(1 row)
```

Notice that without specifying the precision, the `CURRENT_TIME` function returns a time value with the full available precision.

To get the local time, you use the `LOCALTIME` function:

```sql
SELECT LOCALTIME;
```

Output:

```
      localtime
-----------------
 00:52:40.227186
(1 row)
```

Similarly, to get the local time with a specific precision, you use the `LOCALTIME(precision)` function:

```sql
SELECT LOCALTIME(0);
```

Output:

```
 localtime
----------
 00:56:08
(1 row)
```

### 2\) Converting time to a different time zone

To convert time to a different time zone, you use the following form:

```sql
[TIME with time zone] AT TIME ZONE time_zone
```

For example, to convert the local time to the time at the time zone UTC\-7, you use the following statement:

```sql
SELECT LOCALTIME AT TIME ZONE 'UTC-7';
```

Output:

```
      timezone
--------------------
 16:02:38.902271+07
(1 row)
```

### 2\) Extracting hours, minutes, and seconds from a time value

To extract hours, minutes, and seconds from a time value, you use the [`EXTRACT`](../postgresql-date-functions/postgresql-extract) function as follows:

```sql
EXTRACT(field FROM time_value);
```

The field can be the hour, minute, second, or milliseconds. For example:

```sql
SELECT
    LOCALTIME,
    EXTRACT (HOUR FROM LOCALTIME) as hour,
    EXTRACT (MINUTE FROM LOCALTIME) as minute,
    EXTRACT (SECOND FROM LOCALTIME) as second,
    EXTRACT (milliseconds FROM LOCALTIME) as milliseconds;
```

### PostgreSQL TIME example

### 3\) Arithmetic operations on time values

PostgreSQL allows you to apply arithmetic operators such as \+, \-,  and \*  on time values and between time and [interval](postgresql-interval) values.

The following statement returns an [interval](postgresql-interval) between two times:

```sql
SELECT time '10:00' - time '02:00' AS result;
```

Output:

```php
  result
----------
 08:00:00
(1 row)
```

The following statement adds 2 hours to the local time:

```sql
SELECT LOCALTIME + interval '2 hours' AS result;
```

Output:

```
    result
-----------------
 03:16:18.020418
(1 row)
```

In this example, the sum of a time value and an interval value is a time value.

## Summary

- Use the PostgreSQL `TIME` data type to store time data.


# UUID

---
title: 'PostgreSQL UUID Data Type'
page_title: 'PostgreSQL UUID Data Type'
page_description: 'In this tutorial, you will learn how to use PostgreSQL UUID data type and how to generate UUID values using the gen_random_uuid() function.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-uuid/'
ogImage: ''
updatedOn: '2024-02-01T09:53:47+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL TIME Data Type'
  slug: 'postgresql-tutorial/postgresql-time'
nextLink:
  title: 'PostgreSQL Array'
  slug: 'postgresql-tutorial/postgresql-array'
---

**Summary**: in this tutorial, you will learn about the PostgreSQL UUID data type and how to generate UUID values using a supplied module.

## Introduction to PostgreSQL UUID type

UUID stands for Universal Unique Identifier defined by [RFC 4122](https://tools.ietf.org/html/rfc4122 'UUID') and other related standards.

A UUID value is a 128\-bit quantity generated by an algorithm that makes it unique in the known universe using the same algorithm.

The following shows some examples of UUID values:

```sql
40e6215d-b5c6-4896-987c-f30f3678f608
6ecd8c99-4036-403d-bf84-cf8400f67836
3f333df6-90a4-4fda-8dd3-9485d27cee36
```

A UUID is a sequence of 32 digits of hexadecimal digits represented in groups separated by hyphens.

Because of its uniqueness feature, you often find UUID in distributed systems because it guarantees a better uniqueness than the [`SERIAL`](postgresql-serial) data type which generates unique values within a single database.

To store UUID values in the PostgreSQL database, you use the UUID data type.

## Generating UUID values

PostgreSQL provides you with a function to generate a UUID:

```sql
gen_random_uuid()
```

The `gen_random_uuid()` function returns a version 4 (random) UUID. For example:

```
SELECT gen_random_uuid();
```

Output:

```
           gen_random_uuid
--------------------------------------
 d6eb621f-6dd0-4cdc-93f5-07f51b249b51
(1 row)
```

## Creating a table with a UUID column

We will [create a table](postgresql-create-table) whose [primary key](postgresql-primary-key) is a UUID data type. Additionally, the values of the primary key column will be generated automatically using the `gen_random_uuid()` function.

First, create the `contacts` table:

```
CREATE TABLE contacts (
    contact_id uuid DEFAULT gen_random_uuid(),
    first_name VARCHAR NOT NULL,
    last_name VARCHAR NOT NULL,
    email VARCHAR NOT NULL,
    phone VARCHAR,
    PRIMARY KEY (contact_id)
);
```

In this statement, the data type of the `contact_id` column is `UUID`.

The `contact_id` column has a default value provided by the `gen_random_uuid()` function, therefore, whenever you insert a new row without specifying the value for the contact_id `column`, PostgreSQL will call the `gen_random_uuid()` function to generate the value for it.

Second, [insert](postgresql-insert) some data into the `contacts` table:

```sql
INSERT INTO contacts ( first_name, last_name, email, phone)
VALUES
  ('John', 'Smith', '[[email protected]](../cdn-cgi/l/email-protection.html)',  '408-237-2345'),
  ('Jane', 'Smith', '[[email protected]](../cdn-cgi/l/email-protection.html)', '408-237-2344'),
  ('Alex', 'Smith', '[[email protected]](../cdn-cgi/l/email-protection.html)', '408-237-2343')
RETURNING *;
```

Output:

```text
              contact_id              | first_name | last_name |         email          |    phone
--------------------------------------+------------+-----------+------------------------+--------------
 ca61da8c-938a-48a6-8eb6-55aa08cd1b08 | John       | Smith     | [[email protected]](../cdn-cgi/l/email-protection.html) | 408-237-2345
 fe2af584-8576-4d0e-b10d-6ec970732f8e | Jane       | Smith     | [[email protected]](../cdn-cgi/l/email-protection.html) | 408-237-2344
 141aefe8-f553-43b9-bfbf-91361e83b15e | Alex       | Smith     | [[email protected]](../cdn-cgi/l/email-protection.html) | 408-237-2343
(3 rows)

```

The output indicates that the `contact_id` column has been populated by the UUID values generated by the `gen_random_uuid()` function.

## Using uuid\-ossp module in the old version of PostgreSQL

If you use an old version of PostgreSQL, you need to use a third\-party module [uuid\-ossp](https://www.postgresql.org/docs/16/uuid-ossp.html) that provides specific algorithms to generate UUIDs

To install the `uuid-ossp` module, you use the `CREATE EXTENSION` statement as follows:

```
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
```

The `IF NOT EXISTS` clause allows you to avoid re\-installing the module.

If you want to generate a UUID value, you can use the `uuid_generate_v4()` function. For example:

```sql
SELECT uuid_generate_v4();
```

Output:

```
           uuid_generate_v4
--------------------------------------
 351c1afe-21b2-486c-951b-66bc9e852530
(1 row)
```

For more information on the functions for UUID generation, check out the [uuid\-ossp](https://www.postgresql.org/docs/9.5/static/uuid-ossp.html) module documentation.

## Summary

- UUID stands for Universal Unique Identifier.
- Use the `gen_random_uuid()` function to generate a version 4 (random) UUID.


# JSON

---
title: 'PostgreSQL JSON'
page_title: 'PostgreSQL JSON Tutorial'
page_description: 'In this tutorial, you will learn about JSON and how to work with JSON data in PostgreSQL using the PostgreSQL JSON and JSONB data types.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-json/'
ogImage: ''
updatedOn: '2024-02-23T10:29:43+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL hstore'
  slug: 'postgresql-tutorial/postgresql-hstore'
nextLink:
  title: 'A Look at PostgreSQL User-defined Data Types'
  slug: 'postgresql-tutorial/postgresql-user-defined-data-types'
---

**Summary**: in this tutorial, you will learn about JSON and how to work with JSON data in PostgreSQL using the PostgreSQL JSON and JSONB data types.

## What is JSON

JSON stands for JavaScript Object Notation. JSON is a lightweight data interchange format that is readable for humans and simple for computers to parse.

JSON is based on two main data structures **objects** and **arrays**:

### Objects

An object is defined as an unordered collection of key\-value pairs enclosed in curly braces `{}`. Each pair includes:

- A key which is a string surrounded by double quotes (“).
- A colon `:` that separates the key and value.
- A value that can be a string, a number, or even an object.

For example, the following illustrates a JSON object that represents a film:

```jsonsqlsql
{"title": "Chamber Italian", "release_year": 2006, "length": 117}
```

The film object has three keys `title`, `release_year`, and `length` with associated values.

### Arrays

An array is an ordered list of values enclosed in square brackets `[]`. The values do not have to be the same type. Additionally, an array may contain values of any valid JSON data type including objects and arrays.

For example, the following shows an array that stores three film titles as strings:

```json
["Chamber Italian", "Grosse Wonderful", " Airport Pollock"]
```

### Data types in JSON

JSON supports some data types including:

- String: “Joe”
- Number: 100, 9\.99, …
- Boolean: true and false.
- Null: null

JSON data can be particularly useful for creating configuration files or exchanging data between a client and a server.

## PostgreSQL JSON data types

PostgreSQL offers two data types for storing JSON:

- JSON – store an exact copy of the JSON text.
- JSONB – store the JSON data in binary format.

### JSON vs. JSONB

The following table illustrates the key differences between JSON and JSONB types:

| Feature           | JSON                                                            | JSONB                                                                |
| ----------------- | --------------------------------------------------------------- | -------------------------------------------------------------------- |
| Storage           | Textual representation (verbatim)                               | Binary storage format                                                |
| Size              | Typically larger because it retains the whitespace in JSON data | Typically smaller                                                    |
| Indexing          | Full\-text search indexes                                       | Binary indexes                                                       |
| Performance       | Slightly slower                                                 | Generally faster                                                     |
| Query performance | Slower due to parsing                                           | Faster due to binary storage                                         |
| Parsing           | Parse each time                                                 | Parse once, store in binary format                                   |
| Data manipulation | Simple and easy                                                 | More complex                                                         |
| Ordering of keys  | Preserved                                                       | Not preserved                                                        |
| Duplicate keys    | Allow duplicate key, the last value is retained                 | Do not allow duplicate keys.                                         |
| Use cases         | Storing configuration data, log data, simple JSON documents     | Storing JSON documents where fast querying and indexing are required |

In practice, you should use JSONB to store JSON data unless you have specialized requirements such as retaining the ordering of keys in the JSON documents.

## PostgreSQL JSON examples

Let’s take some examples of storing JSON data in the PostgreSQL database.

### 1\) Storing JSON objects example

First, [create a new table](postgresql-create-table) called `products`:

```
CREATE TABLE products(
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    properties JSONB
);
```

The `products` table includes three columns:

1. The `id` column is the primary key column that uniquely identifies the product.
2. The `name` column stores the product name.
3. The `properties` column stores various properties of a product such as size, and color.

Second, insert JSON data into the `products` table:

```sql
INSERT INTO products(name, properties)
VALUES('Ink Fusion T-Shirt','{"color": "white", "size": ["S","M","L","XL"]}')
RETURNING *;
```

Output:

```text
 id |        name        |                    properties
----+--------------------+---------------------------------------------------
  1 | Ink Fusion T-Shirt | {"size": ["S", "M", "L", "XL"], "color": "white"}
(1 row)
```

Third, [insert multiple rows](postgresql-insert-multiple-rows) into the `products` table:

```sql
INSERT INTO products(name, properties)
VALUES('ThreadVerse T-Shirt','{"color": "black", "size": ["S","M","L","XL"]}'),
      ('Design Dynamo T-Shirt','{"color": "blue", "size": ["S","M","L","XL"]}')
RETURNING *;
```

Output:

```text
 id |        name         |                    properties
----+---------------------+---------------------------------------------------
  2 | ThreadVerse T-Shirt | {"size": ["S", "M", "L", "XL"], "color": "white"}
  3 | Design Dynamo       | {"size": ["S", "M", "L", "XL"], "color": "blue"}
(2 rows)
```

Fourth, retrieve JSON data from the `products` table:

```sql
SELECT id, name, properties
FROM products;
```

Output:

```text
 id |         name          |                    properties
----+-----------------------+---------------------------------------------------
  1 | Ink Fusion T-Shirt    | {"size": ["S", "M", "L", "XL"], "color": "white"}
  2 | ThreadVerse T-Shirt   | {"size": ["S", "M", "L", "XL"], "color": "black"}
  3 | Design Dynamo T-Shirt | {"size": ["S", "M", "L", "XL"], "color": "blue"}
(3 rows)
```

Fifth, retrieve the product with the colors extracted from the JSON data in the `properties` column:

```sql
SELECT
  id,
  name,
  properties -> 'color' color
FROM
  products;
```

Output:

```text
 id |         name          |  color
----+-----------------------+---------
  1 | Ink Fusion T-Shirt    | "white"
  2 | ThreadVerse T-Shirt   | "black"
  3 | Design Dynamo T-Shirt | "blue"
(3 rows)
```

The `->` operator extracts a JSON object field by a key. In this example, we use the \-\> operator `->` to extract the color of the properties object:

```sql
properties -> 'color'
```

The values in the color column are surrounded by double quotes (“).

To extract a JSON object field by a key as text, you can use the `->>` operator. For example:

```sql
SELECT
  id,
  name,
  properties ->> 'color' color
FROM
  products;
```

Output:

```text
 id |         name          | color
----+-----------------------+-------
  1 | Ink Fusion T-Shirt    | white
  2 | ThreadVerse T-Shirt   | black
  3 | Design Dynamo T-Shirt | blue
(3 rows)
```

Sixth, retrieve the products with the colors black and white using the `->>` operator in the [WHERE](postgresql-where) clause:

```
SELECT
  id,
  name,
  properties ->> 'color' color
FROM
  products
WHERE
  properties ->> 'color' IN ('black', 'white');
```

Output:

```text
 id |        name         | color
----+---------------------+-------
  1 | Ink Fusion T-Shirt  | white
  2 | ThreadVerse T-Shirt | black
(2 rows)
```

### 2\) Storing JSON arrays example

First, create a table called `contacts` for storing the contact persons:

```
CREATE TABLE contacts(
   id SERIAL PRIMARY KEY,
   name VARCHAR(255) NOT NULL,
   phones JSONB
);
```

The `phones` column has the JSONB data type. We’ll store both work phone and personal number numbers in a JSON array in the `phones` column.

Second, insert new rows into the `contacts` table:

```sql
INSERT INTO contacts(name, phones)
VALUES
   ('John Doe','["408-111-2222", "408-111-2223"]'),
   ('Jane Doe','["212-111-2222", "212-111-2223"]')
RETURNING *;
```

Output:

```text
 id |   name   |              phones
----+----------+----------------------------------
  1 | John Doe | ["408-111-2222", "408-111-2223"]
  2 | Jane Doe | ["212-111-2222", "212-111-2223"]
(2 rows)
```

Third, retrieve the contacts with the work phone numbers from the `contacts` table:

```
SELECT
  name,
  phones ->> 0 "work phone"
FROM
  contacts;
```

Output:

```
   name   |  work phone
----------+--------------
 John Doe | 408-111-2222
 Jane Doe | 212-111-2222
(2 rows)
```

The `->> index` extract the index element in an array. In this example, we use the `->> 0` to extract the first elements in the `phones` array as text.

[Check JSON functions to process JSON data](../postgresql-json-functions).

## Summary

- JSON stands for JavaScript Object Notation.
- Use JSONB data type to store JSON data.


# HSTORE

---
title: 'PostgreSQL hstore'
page_title: 'PostgreSQL hstore Tutorial'
page_description: 'We introduce you to PostgreSQL hstore data type. You will learn know how to perform practical and useful operations on PostgreSQL hstore columns.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-hstore/'
ogImage: '/postgresqltutorial/postgresql-hstore-query.jpg'
updatedOn: '2024-02-01T12:53:20+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Array'
  slug: 'postgresql-tutorial/postgresql-array'
nextLink:
  title: 'PostgreSQL JSON'
  slug: 'postgresql-tutorial/postgresql-json'
---

**Summary**: in this tutorial, you’ll learn how to work with **PostgreSQL hstore** data type.

The hstore module implements the hstore data type for storing key\-value pairs in a single value. The keys and values are text strings only.

In practice, you can find the hstore data type useful in some cases, such as semi\-structured data or rows with many attributes that are rarely queried.

## Enable PostgreSQL hstore extension

Before working with the hstore data type, you need to enable the hstore extension which loads the **contrib** module to your PostgreSQL instance.

The following statement creates the hstore extension:

```sql
CREATE EXTENSION hstore;
```

## Create a table with hstore data type

We create a table named `books` that has three columns:

- `id` is the primary key that identifies the book.
- `title` is the title of the products
- `attr` stores attributes of the book such as ISBN, weight, and paperback. The data type of the `attr` column is hstore.

We use the [CREATE TABLE statement](postgresql-create-table) to create the `books` table as follows:

```sql
CREATE TABLE books (
	id serial primary key,
	title VARCHAR (255),
	attr hstore
);
```

## Insert data into the PostgreSQL hstore column

The following [`INSERT`](postgresql-insert) statement inserts data into the hstore column:

```sql
INSERT INTO books (title, attr)
VALUES
  (
    'PostgreSQL Tutorial', '"paperback" => "243",
     "publisher" => "postgresqltutorial.com",
     "language"  => "English",
     "ISBN-13"   => "978-1449370000",
     "weight"    => "11.2 ounces"'
  );

```

The data that we insert into the hstore column is a list of comma\-separated key \=\>value pairs. Both keys and values are quoted using double quotes (“”).

Let’s insert one more row.

```sql
INSERT INTO books (title, attr)
VALUES
  (
    'PostgreSQL Cheat Sheet', '
"paperback" => "5",
"publisher" => "postgresqltutorial.com",
"language"  => "English",
"ISBN-13"   => "978-1449370001",
"weight"    => "1 ounces"'
  );

```

## Query data from an hstore column

Querying data from an hstore column is similar to querying data from a column with native data type using the [`SELECT`](postgresql-select) statement as follows:

```sql
SELECT attr FROM books;
```

[![postgresql hstore query](/postgresqltutorial/postgresql-hstore-query.jpg)](/postgresqltutorial/postgresql-hstore-query.jpg)

## Query value for a specific key

Postgresql hstore provides the `->` operator to query the value of a specific key from an hstore column. For example, if we want to know ISBN\-13 of all available books in the `books` table, we can use the `->` operator as follows:

```sql
SELECT
	attr -> 'ISBN-13' AS isbn
FROM
	books;
```

![postgresql hstore query key](/postgresqltutorial/postgresql-hstore-query-key.jpg)

## Use value in the WHERE clause

You can use the `->` operator in the [`WHERE`](postgresql-where) clause to filter the rows whose values of the hstore column match the input value. For example, the following  query retrieves the `title` and `weight` of a book that has `ISBN-13` value matches `978-1449370000:`

```sql
SELECT
	title, attr -> 'weight' AS weight
FROM
	books
WHERE
	attr -> 'ISBN-13' = '978-1449370000';

```

![postgresql hstore WHERE clause](/postgresqltutorial/postgresql-hstore-WHERE-clause.jpg)

## Add key\-value pairs to existing rows

With a hstore column, you can easily add a new key\-value pair to existing rows e.g., you can add a free shipping key to the `attr` column of the `books` table as follows:

```sql
UPDATE books
SET attr = attr || '"freeshipping"=>"yes"' :: hstore;
```

Now, you can check to see if the `"freeshipping" => "yes"` pair has been added successfully.

```sql
SELECT
	title,
        attr -> 'freeshipping' AS freeshipping
FROM
	books;
```

![postgresql hstore add key-value](/postgresqltutorial/postgresql-hstore-add-key-value.jpg)

## Update existing key\-value pair

You can update the existing key\-value pair using the [`UPDATE`](postgresql-update) statement. The following statement updates the value of the `"freeshipping"` key to `"no"`.

```sql
UPDATE books
SET attr = attr || '"freeshipping"=>"no"' :: hstore;
```

## Remove existing key\-value pair

PostgreSQL allows you to remove existing key\-value pair from an hstore column. For example, the following statement removes the `"freeshipping"=>"no"` key\-value pair in the `attr` column.

```sql
UPDATE books
SET attr = delete(attr, 'freeshipping');
```

## Check for a specific key in hstore column

You can check for a specific key in an hstore column using the `?` operator in the `WHERE` clause. For example, the following statement returns all rows with attr contains key `publisher`.

```sql
SELECT
  title,
  attr->'publisher' as publisher,
  attr
FROM
	books
WHERE
	attr ? 'publisher';
```

![postgesql hstore check key](/postgresqltutorial/postgesql-hstore-check-key.jpg)

## Check for a key\-value pair

You can query based on the hstore key\-value pair using the @\> operator. The following statement retrieves all rows whose `attr` column contains a key\-value pair that matches `"weight"=>"11.2 ounces"`.

```sql
SELECT
	title
FROM
	books
WHERE
	attr @> '"weight"=>"11.2 ounces"' :: hstore;
```

![postgresql hstore check key-pair](/postgresqltutorial/postgresql-hstore-check-key-pair.jpg)

## Query rows that contain multiple specified keys

You can query the rows whose hstore column contains multiple keys using `?&` operator. For example, you can get books where `attr` column contains both `language` and `weight` keys.

```sql
SELECT
	title
FROM
	books
WHERE
	attr ?& ARRAY [ 'language', 'weight' ];
```

![postgresql hstore check multiple keys](/postgresqltutorial/postgresql-hstore-check-multiple-keys.jpg)
To check if a row whose hstore column contains any key from a list of keys, you use the `?|` operator instead of the `?&` operator.

## Get all keys from an hstore column

To get all keys from an hstore column, you use the `akeys()` function as follows:

```sql
SELECT
	akeys (attr)
FROM
	books;
```

![postgresql hstore akeys function](/postgresqltutorial/postgresql-hstore-akeys-function.jpg)
Or you can use the `skey()` function if you want PostgreSQL to return the result as a set.

```sql
SELECT
	skeys (attr)
FROM
	books;
```

![postgresql hstore skeys function](/postgresqltutorial/postgresql-hstore-skeys-function.jpg)

## Get all values from an hstore column

Like keys, you can get all values from an hstore column using the  `avals()` function in the form of arrays.

```sql
SELECT
	avals (attr)
FROM
	books;
```

[![postgresql hstore avals function](/postgresqltutorial/postgresql-hstore-avals-function.jpg)](/postgresqltutorial/postgresql-hstore-avals-function.jpg)Or you can use the  `svals()` function if you want to get the result as a set.

```sql
SELECT
	svals (attr)
FROM
	books;
```

![postgresql hstore svals](/postgresqltutorial/postgresql-hstore-svals.jpg)

## Convert hstore data to JSON

PostgreSQL provides the `hstore_to_json()` function to convert hstore data to [JSON](postgresql-json). See the following statement:

```sql
SELECT
  title,
  hstore_to_json (attr) json
FROM
  books;
```

![postgresql hstore to json](/postgresqltutorial/postgresql-hstore-to-json.jpg)

## Convert hstore data to sets

To convert hstore data to sets, you use the  `each()` function as follows:

```
SELECT
	title,
	(EACH(attr) ).*
FROM
	books;
```

![postgresql hstore to sets](/postgresqltutorial/postgresql-hstore-to-sets.jpg)
In this tutorial, we have shown you how to work with the PostgreSQL hstore data type and introduced you to the most useful operations that you can perform against the hstore data type.


# Array

---
title: 'PostgreSQL Array'
page_title: 'PostgreSQL Array'
page_description: 'In this tutorial, we show you how to work with PostgreSQL Array and introduce you to some handy functions for array manipulation.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-array/'
ogImage: ''
updatedOn: '2024-02-01T12:38:39+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL UUID Data Type'
  slug: 'postgresql-tutorial/postgresql-uuid'
nextLink:
  title: 'PostgreSQL hstore'
  slug: 'postgresql-tutorial/postgresql-hstore'
---

**Summary**: in this tutorial, you will learn how to work with **PostgreSQL array** and how to use some handy functions for array manipulation.

## Introduction to PostgreSQL array data type

In PostgreSQL, an array of a collection of elements that have the same data type.

Arrays can be one\-dimensional, multidimensional, or even nested arrays.

Every [data type](postgresql-data-types) has its companion array type e.g., `integer` has an `integer[]` array type, `character` has `character[]` array type.

If you define a [user\-defined data type](postgresql-user-defined-data-types), PostgreSQL also creates a corresponding array type automatically for you.

To define a column with an array type, you use the following syntax:

```csssql
column_name datatype []
```

In the syntax, we define a one\-dimensional array of the datatype.

For example, the following statement creates a new table called `contacts` with the `phones` column defined with an array of text.

```css
CREATE TABLE contacts (
  id SERIAL PRIMARY KEY,
  name VARCHAR (100),
  phones TEXT []
);
```

The `phones` column is a one\-dimensional array that holds various phone numbers that a contact may have.

To define multiple dimensional array, you add the square brackets.

For example, you can define a two\-dimensional array as follows:

```sql
column_name data_type [][]
```

## Inserting data into an array

The following statement inserts a new contact into the `contacts` table.

```
INSERT INTO contacts (name, phones)
VALUES('John Doe',ARRAY [ '(408)-589-5846','(408)-589-5555' ]);
```

In this example, we use the `ARRAY` constructor to construct an array and insert it into the `contacts` table.

Alternatively, you can use curly braces as follows:

```sql
INSERT INTO contacts (name, phones)
VALUES('Lily Bush','{"(408)-589-5841"}'),
      ('William Gate','{"(408)-589-5842","(408)-589-58423"}');
```

In this statement, we insert two rows into the `contacts` table.

Notice that when using curly braces, you use single quotes `'` to wrap the array and double\-quotes `"` to wrap text array items.

## Querying array data

The following statement retrieves data from the `contacts` table:

```sql
SELECT
  name,
  phones
FROM
  contacts;
```

Output:

```text
     name     |              phones
--------------+----------------------------------
 John Doe     | {(408)-589-5846,(408)-589-5555}
 Lily Bush    | {(408)-589-5841}
 William Gate | {(408)-589-5842,(408)-589-58423}
(3 rows)
```

To access an array element, you use the subscript within square brackets `[]`.

By default, PostgreSQL uses one\-based numbering for array elements. It means the first array element starts with the number 1\.

The following statement retrieves the contact’s name and the first phone number:

```
SELECT
  name,
  phones [ 1 ]
FROM
  contacts;
```

Output:

```text
     name     |     phones
--------------+----------------
 John Doe     | (408)-589-5846
 Lily Bush    | (408)-589-5841
 William Gate | (408)-589-5842
(3 rows)
```

You can use the array element in the [WHERE clause](postgresql-where) as the condition to filter the rows.

For example, the following query finds the contacts who have the phone number `(408)-589-58423` as the second phone number:

```
SELECT
  name
FROM
  contacts
WHERE
  phones [ 2 ] = '(408)-589-58423';
```

Output:

```text
     name
--------------
 William Gate
(1 row)
```

## Modifying PostgreSQL array

PostgreSQL allows you to update each element of an array or the whole array.

The following statement updates the second phone number of `William Gate`.

```
UPDATE contacts
SET phones [2] = '(408)-589-5843'
WHERE ID = 3
RETURNING *;
```

Output:

```text
 id |     name     |             phones
----+--------------+---------------------------------
  3 | William Gate | {(408)-589-5842,(408)-589-5843}
(1 row)
```

The following statement updates an array as a whole.

```sql
UPDATE
  contacts
SET
  phones = '{"(408)-589-5843"}'
WHERE
  id = 3
RETURNING *;
```

Output:

```text
 id |     name     |      phones
----+--------------+------------------
  3 | William Gate | {(408)-589-5843}
(1 row)
```

## Searching in PostgreSQL Array

Suppose, you want to know who has the phone number `(408)-589-5555` regardless of the position of the phone number in the `phones` array, you can use `ANY()` function as follows:

```sql
SELECT
  name,
  phones
FROM
  contacts
WHERE
  '(408)-589-5555' = ANY (phones);
```

Output:

```text
   name   |             phones
----------+---------------------------------
 John Doe | {(408)-589-5846,(408)-589-5555}
(1 row)
```

## Expanding Arrays

PostgreSQL provides the `unnest()` function to expand an array to a list of rows. For example, the following query expands all phone numbers of the `phones` array.

```
SELECT
  name,
  unnest(phones)
FROM
  contacts;
```

Output:

```
     name     |     unnest
--------------+----------------
 John Doe     | (408)-589-5846
 John Doe     | (408)-589-5555
 Lily Bush    | (408)-589-5841
 William Gate | (408)-589-5843
(4 rows)
```

## Summary

- In PostgreSQL, an array is a collection of elements with the same data type.
- Use the `data_type []` to define a one\-dimensional array for a column.
- Use the `[index]` syntax to access the `index` element of an array. The first element has an index of one.
- Use the `unnest()` function to expand an array to a list of rows.


# User-defined Data Types

---
title: 'A Look at PostgreSQL User-defined Data Types'
page_title: 'A Look at PostgreSQL User-defined Data Types'
page_description: 'This tutorial shows you how to create PostgreSQL user-defined data type using CREATE DOMAIN and CREATE TYPE statements.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-user-defined-data-types/'
ogImage: '/postgresqltutorial/PostgreSQL-User-defined-Type-Example.png'
updatedOn: '2020-07-10T01:18:36+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL JSON'
  slug: 'postgresql-tutorial/postgresql-json'
nextLink:
  title: 'PostgreSQL enum'
  slug: 'postgresql-tutorial/postgresql-enum'
---

**Summary**: in this tutorial, you will learn how to create PostgreSQL user\-defined data type using `CREATE DOMAIN` and `CREATE TYPE` statements.

Besides built\-in [data types](postgresql-data-types), PostgreSQL allows you to create user\-defined data types through the following statements:

- `CREATE DOMAIN` creates a user\-defined data type with constraints such as [`NOT NULL`](postgresql-not-null-constraint), [`CHECK`](postgresql-check-constraint), etc.
- `CREATE TYPE` creates a composite type used in [stored procedures](https://neon.tech/postgresql/postgresql-stored-procedures/) as the data types of returned values.

## PostgreSQL CREATE DOMAIN statement

In PostgreSQL, a domain is a data type with optional constraints e.g., [`NOT NULL`](postgresql-not-null-constraint) and [`CHECK`](postgresql-check-constraint). A domain has a unique name within the schema scope.

Domains are useful for centralizing the management of fields with common constraints. For example, some tables may have the same column that do not accept NULL and spaces.

The following statement [create a table](postgresql-create-table) named `mailing_list`:

```sqlsql
CREATE TABLE mailing_list (
    id SERIAL PRIMARY KEY,
    first_name VARCHAR NOT NULL,
    last_name VARCHAR NOT NULL,
    email VARCHAR NOT NULL,
    CHECK (
        first_name !~ '\s'
        AND last_name !~ '\s'
    )
);
```

In this table, both `first_name` and `last_name` columns do not accept null and spaces. Instead of defining the `CHECK` constraint, you can create a `contact_name` domain and reuse it in multiple columns.

The following statement uses the `CREATE DOMAIN` to create a new domain called `contact_name` with the `VARCHAR` datatype and do not accept NULL and spaces:

```sql
CREATE DOMAIN contact_name AS
   VARCHAR NOT NULL CHECK (value !~ '\s');
```

And you use `contact_name` as the datatype of the `first_name` and `last_name` columns as a regular built\-in type:

```sql
CREATE TABLE mailing_list (
    id serial PRIMARY KEY,
    first_name contact_name,
    last_name contact_name,
    email VARCHAR NOT NULL
);
```

The following statement inserts a new row into the `mailing_list` table:

```sql
INSERT INTO mailing_list (first_name, last_name, email)
VALUES('Jame V','Doe','[[email protected]](../cdn-cgi/l/email-protection.html)');
```

PostgreSQL issued the following error because the first name contains a space:

```sql
ERROR:  value for domain contact_name violates check constraint "contact_name_check"

```

The following statement works because it does not violate any constraints of the `contact_name` type:

```sql
INSERT INTO mailing_list (first_name, last_name, email)
VALUES('Jane','Doe','[[email protected]](../cdn-cgi/l/email-protection.html)');
```

To change or remove a domain, you use the `ALTER DOMAIN` or `DROP DOMAIN` respectively.

To view all domains in the current database, you use the `\dD` command as follows:

```sql
test=#\dD
                                     List of domains
 Schema |     Name     |       Type        | Modifier |               Check
--------+--------------+-------------------+----------+-----------------------------------
 public | contact_name | character varying | not null | CHECK (VALUE::text !~ '\s'::text)
(1 row)

```

### Getting domain information

To get all domains in a specific schema, you use the following query:

```sql
SELECT typname
FROM pg_catalog.pg_type
  JOIN pg_catalog.pg_namespace
  	ON pg_namespace.oid = pg_type.typnamespace
WHERE
	typtype = 'd' and nspname = '<schema_name>';
```

The following statement returns domains in the `public` schema of the current database:

```sql
SELECT typname
FROM pg_catalog.pg_type
  JOIN pg_catalog.pg_namespace
  	ON pg_namespace.oid = pg_type.typnamespace
WHERE
	typtype = 'd' and nspname = 'public';
```

![](/postgresqltutorial/PostgreSQL-User-defined-Type-Example.png)

## PostgreSQL CREATE TYPE

The `CREATE TYPE` statement allows you to create a composite type, which can be used as the return type of a function.

Suppose you want to have a function that returns several values: `film_id`, `title`, and `release_year`. The first step is to create a type e.g., `film_summary` as follows:

```
CREATE TYPE film_summary AS (
    film_id INT,
    title VARCHAR,
    release_year SMALLINT
);

```

Second, use the `film_summary` data type as the return type of a function:

```sql
CREATE OR REPLACE FUNCTION get_film_summary (f_id INT)
    RETURNS film_summary AS
$$
SELECT
    film_id,
    title,
    release_year
FROM
    film
WHERE
    film_id = f_id ;
$$
LANGUAGE SQL;
```

Third, call the `get_film_summary()` function:

```sql
SELECT * FROM get_film_summary (40);
```

![PostgreSQL user-defined type example](/postgresqltutorial/postgresql-user-defined-type.png)
To change a user\-defined type, you use the `ALTER TYPE` statement. To remove a user\-defined type, you use the `DROP TYPE` statement.

If you use the `psql` program, you can list all user\-defined types in the current database using the `\dT` or `\dT+` command:

```sql
dvdrental=# \dT
         List of data types
 Schema |     Name     | Description
--------+--------------+-------------
 public | contact_name |
 public | film_summary |
 public | mpaa_rating  |
(3 rows)
```

In this tutorial, you have learned how to create PostgreSQL user\-defined types using the `CREATE DOMAIN` and `CREATE TYPE` statements.


# Enum

---
title: 'PostgreSQL enum'
page_title: 'PostgreSQL Enum'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL enum data type to define a list of fixed values for a column.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-enum/'
ogImage: ''
updatedOn: '2024-04-19T10:27:07+00:00'
enableTableOfContents: true
previousLink:
  title: 'A Look at PostgreSQL User-defined Data Types'
  slug: 'postgresql-tutorial/postgresql-user-defined-data-types'
nextLink:
  title: 'PostgreSQL XML Data Type'
  slug: 'postgresql-tutorial/postgresql-xml-data-type'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL enum data type to define a list of fixed values for a column.

## Introduction to the PostgreSQL enum data type

In PostgreSQL, an enum type is a [custom data type](postgresql-user-defined-data-types) that allows you to define a list of possible values for a column.

Here’s the syntax for creating a new enum type:

```sql
CREATE TYPE enum_name
AS
ENUM('value1', 'value2', 'value3', ...);
```

In this syntax:

- First, specify the name of the enum after the `CREATE` `TYPE` keyword.
- Second, provide a list of comma\-separated enum values within the parentheses followed by the `ENUM` keyword. These values are case\-sensitive.

When you define a column with an enum type, you specify that the column can only accept a fixed of values declared in the enum.:

```sql
column_name enum_type
```

If you attempt to [insert](postgresql-insert) or [update](postgresql-update) a row with a value not in the list, PostgreSQL will issue an error.

The ordering of values in an enum is the order in which you list them when you define the enum.

In the syntax, PostgreSQL will place the value1 before the value2, value2 before value3, and so on.

Additionally, you can use all standard comparison operators (\>, \>\=, \=, \<\>, \<, \<\=) and related aggregation functions with enum values.

## PostgreSQL enum data type example

First, create a new enum type called `priority` that includes three possible values ‘low’, ‘medium’, and ‘high’.

```sql
CREATE TYPE priority AS ENUM('low','medium','high');
```

Second, [create a table](postgresql-create-table) called `requests` that has a column using `priority` enum:

```sql
CREATE TABLE requests(
    id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    priority PRIORITY NOT NULL,
    request_date DATE NOT NULL
);
```

Third, [insert some rows](postgresql-insert) into the `requests` table:

```sql
INSERT INTO requests(title, priority, request_date)
VALUES
   ('Create an enum tutorial in PostgreSQL', 'high', '2019-01-01'),
   ('Review the enum tutorial', 'medium', '2019-01-01'),
   ('Publish the PostgreSQL enum tutorial', 'low', '2019-01-01')
RETURNING *;
```

Output:

```text
 id |                 title                 | priority | request_date
----+---------------------------------------+----------+--------------
  1 | Create an enum tutorial in PostgreSQL | high     | 2019-01-01
  2 | Review the enum tutorial              | medium   | 2019-01-01
  3 | Publish the PostgreSQL enum tutorial  | low      | 2019-01-01
(3 rows)
```

Fourth, retrieve the requests and sort them by priority from low to high:

```sql
SELECT *
FROM requests
ORDER BY priority;
```

Output:

```text
 id |                 title                 | priority | request_date
----+---------------------------------------+----------+--------------
  3 | Publish the PostgreSQL enum tutorial  | low      | 2019-01-01
  2 | Review the enum tutorial              | medium   | 2019-01-01
  1 | Create an enum tutorial in PostgreSQL | high     | 2019-01-01
(3 rows)
```

Fifth, find the requests whose priority is higher than `low`:

```sql
SELECT *
FROM requests
WHERE priority > 'low'
ORDER BY priority;
```

Output:

```text
 id |                 title                 | priority | request_date
----+---------------------------------------+----------+--------------
  2 | Review the enum tutorial              | medium   | 2019-01-01
  1 | Create an enum tutorial in PostgreSQL | high     | 2019-01-01
(2 rows)
```

Note that enum values are case\-sensitive.

Sixth, attempt to find the requests whose priority is ‘`HIGH`‘:

```sql
SELECT *
FROM requests
WHERE priority = 'HIGH'
ORDER BY priority;
```

PostgreSQL issues the following error:

```sql
ERROR:  invalid input value for enum priority: "HIGH"
LINE 3: WHERE priority = 'HIGH'
                         ^
```

Finally, attempt to insert a new row into the `requests` table with an invalid value for the priority column:

```sql
INSERT INTO requests(title, priority, request_date)
VALUES
   ('Revise the enum tutorial', 'urgent', '2019-01-02')
RETURNING *;
```

Error:

```sql
ERROR:  invalid input value for enum priority: "urgent"
LINE 3:    ('Revise the enum tutorial', 'urgent', '2019-01-02')
                                        ^
```

## Adding new values to enums

To add a new value to an enum, you use the `ALTER TYPE ... ADD VALUE` statement:

```sql
ALTER TYPE enum_name
ADD VALUE [IF NOT EXISTS] 'new_value'
[{BEFORE | AFTER } 'existing_enum_value';
```

In this syntax:

- First, specify the name of the enum you want to add a new value after the `ALTER TYPE` keywords.
- Second, specify the new value after the `ADD VALUE` keywords. Use the `IF NOT EXISTS` to conditionally add a new value only if it does not exist.
- Third, specify the position of the new value relative to an existing value. By default, the statement adds the new enum value at the end of the list.

For example, the following statement adds a new value `'urgent'` to the `priority` enum:

```sql
ALTER TYPE priority
ADD VALUE 'urgent';
```

## Retrieving a list of enum values

To get a list of values of an enum, you use the `enum_range()` function:

```sql
enum_range(null::enum_name)
```

It returns a list of values of the `enum_name` as an ordered array

For example, the following statement uses the `enum_range()` function to retrieve a list of enum values from the priority enum:

```sql
SELECT enum_range(null::priority);
```

Output:

```text
        enum_range
--------------------------
 {low,medium,high,urgent}
(1 row)
```

## Getting the first and last values in an enum

To get the first and last values in an enum, you use the `enum_first()` and `enum_last()` functions respectively.

```sql
SELECT
  enum_first(NULL::priority) first_value,
  enum_last(NULL::priority)  last_value;
```

Output:

```text
 first_value | last_value
-------------+------------
 low         | urgent
(1 row)
```

## Renaming an enum value

To rename a value in an enum, you use the `ALTER TYPE ... RENAME VALUE` statement as follows:

```sql
ALTER TYPE enum_name
RENAME VALUE existing_enum_value TO new_enum_value;
```

For example, the following statement changes the `'urgent'` value in the priority enum to `'very high'`:

```sql
ALTER TYPE priority
RENAME VALUE 'urgent' TO 'very high';
```

The following statement verifies the change:

```sql
SELECT enum_range(null::priority);
```

Output:

```text
          enum_range
-------------------------------
 {low,medium,high,"very high"}
(1 row)
```

Notice that if the value has a space, PostgreSQL uses quotes to surround it as indicated in the output.

## When to use enums

There is some similarity between enums and [foreign keys](postgresql-foreign-key). Both allow you to define a set of values for a column.

However, enums have the following advantages:

- **Performance**: you need to query from a single table instead of using join to retrieve data from two tables.
- **Simplicity**: it’s much simpler to write an SQL statement to work with enum values.

But enums also have the following disadvantages:

- **Limited flexibility**: changing enum values requires changing the database schema instead of adding values to the lookup table.
- **Portability**: not all database systems support enum. If you ever want to migrate your PostgreSQL database schema to a database system that does not support enum, you’ll have an issue.

It is recommended to use enums when you have a fixed set of values that are unlikely to change, for example, RGB colors (red, green, blue).

## Summary

- Use enums to define a list of fixed values for a table column.
- Use the `CREATE TYPE` statement to define a new enum data type.
- The order of values in an enum is the order in which you declare them when defining the enum type.
- Use the `ALTER TYPE ... ADD VALUE` to add a new value to an enum.
- Use the `ALTER TYPE ... RENAME VALUE` to rename an enum value.
- Use enum only when you have a small list of fixed values. Otherwise, use a lookup table with foreign keys instead.


# XML

---
title: 'PostgreSQL XML Data Type'
page_title: 'PostgreSQL XML Data Type'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL XML data type to store XML documents in the database.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-xml-data-type/'
ogImage: ''
updatedOn: '2024-04-20T03:57:22+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL enum'
  slug: 'postgresql-tutorial/postgresql-enum'
nextLink:
  title: 'PostgreSQL BYTEA Data Type'
  slug: 'postgresql-tutorial/postgresql-bytea-data-type'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL XML data type to store XML documents in the database.

## Introduction to the PostgreSQL XML data type

PostgreSQL supports built\-in `XML` data type that allows you to store XML documents directly within the database.

Here’s the syntax for declaring a column with the `XML` type:

```sql
column_name XML
```

The XML data type offers the following benefits:

- **Type Safety**: PostgreSQL can validate when inserting/updating data, ensuring XML data conforms to XML standards.
- **Built\-in XML functions and operators**: PostgreSQL supports many XML functions and operators to manipulate XML data effectively.

## PostgreSQL XML data type example

First, [create a table](postgresql-create-table) called `person`:

```sql
CREATE TABLE person(
    id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    info XML
);
```

In this `person` table:

- `id` is an [identity column](postgresql-identity-column) that serves as the [primary key](postgresql-primary-key) column of the table.
- `info` is a column with the type XML that will store the XML data.

Second, [insert a row](postgresql-insert) into the `person` table:

```sql
INSERT INTO person (info)
VALUES (
    XMLPARSE(DOCUMENT '<?xml version="1.0" encoding="UTF-8"?>
    <person>
        <name>John Doe</name>
        <age>35</age>
        <city>San Francisco</city>
    </person>')
);
```

In this statement:

- `DOCUMENT` indicates that the input string is a complete XML document starting with the XML declaration `<?xml version="1.0" encoding="UTF-8"?>` and having the root element `<person>`
- `XMLPARSE` function converts the string into an XML document.
- The `INSERT` statement inserts the new XML document into the info column of the `persons` table.

Third, [insert multiple rows](postgresql-insert-multiple-rows) into the `person` table:

```sql
INSERT INTO person (info)
VALUES
(
    XMLPARSE(DOCUMENT '<?xml version="1.0" encoding="UTF-8"?>
    <person>
        <name>Jane Doe</name>
        <age>30</age>
        <city>San Francisco</city>
    </person>')
),
(
    XMLPARSE(DOCUMENT '<?xml version="1.0" encoding="UTF-8"?>
    <person>
        <name>John Smith</name>
        <age>40</age>
        <city>New York</city>
    </person>')
),
(
    XMLPARSE(DOCUMENT '<?xml version="1.0" encoding="UTF-8"?>
    <person>
        <name>Alice Johnson</name>
        <age>30</age>
        <city>Los Angeles</city>
    </person>')
);
```

Fourth, retrieve the names of persons from the XML documents using `xpath()` function:

```sql
SELECT xpath('/person/name/text()', info) AS name
FROM person;
```

Output:

```text
       name
-------------------
 {"John Doe"}
 {"Jane Doe"}
 {"John Smith"}
 {"Alice Johnson"}
(4 rows)
```

Each row in the result set is an array of XML values representing person names. Since each person has one name, the result array has only one element.

Fourth, retrieve person names as text from the XML documents using `xpath()` function:

```sql
SELECT (xpath('/person/name/text()', info))[1]::text AS name
FROM person;
```

Output:

```text
     name
---------------
 John Doe
 Jane Doe
 John Smith
 Alice Johnson
(4 rows)
```

How it works.

- First, the XPath `'/person/name/text()'` returns the text of the name node of the XML document. It returns an array that includes all matching values.
- Second, the `[1]` subscript returns the first element of the array.
- Third, the `::text` casts the XML value to the text.

Fifth, retrieve the ages of persons:

```sql
SELECT (xpath('/person/age/text()', info))[1]::text::integer AS age
FROM person;
```

Output:

```text
 age
-----
  35
  30
  40
  30
(4 rows)
```

In this query:

- The xpath `/person/age/text()` returns the text of the age nodes as an array of text.
- The `[1]` subscript returns the first element of the array.
- The `::text` cast the element to the text.
- The `::integer` casts the text to an integer.

In this example, we cast an XML value to text and text to an integer because we cannot cast an XML value directly to an integer.

Sixth, retrieve the name, age, and city from the XML document:

```sql
SELECT
    (xpath('/person/name/text()', info))[1]::text AS name,
    (xpath('/person/age/text()', info))[1]::text::integer AS age,
    (xpath('/person/city/text()', info))[1]::text AS city
FROM
    person;
```

Output:

```text
     name      | age |     city
---------------+-----+---------------
 John Doe      |  35 | San Francisco
 Jane Doe      |  30 | San Francisco
 John Smith    |  40 | New York
 Alice Johnson |  30 | Los Angeles
(4 rows)
```

Seventh, find the person with the name “Jane Doe”:

```sql
SELECT *
FROM person
WHERE (xpath('/person/name/text()', info))[1]::text = 'Jane Doe';
```

Output:

```text
 id |                info
----+------------------------------------
  2 |     <person>                      +
    |         <name>Jane Doe</name>     +
    |         <age>30</age>             +
    |         <city>San Francisco</city>+
    |     </person>
(1 row)
```

## Creating indexes for XML data

If the person table has many rows, finding the person by name will be slow. You can create an expression index for the XML documents to improve the query performance.

First, create an [index expression](../postgresql-indexes/postgresql-index-on-expression) that extracts the name of a person as an array of text:

```sql
CREATE INDEX person_name
ON person USING BTREE
    (cast(xpath('/person/name', info) as text[])) ;
```

Second, create a function that inserts 1000 rows into the `person` table for testing purposes:

```sql
CREATE OR REPLACE FUNCTION generate_persons()
RETURNS void AS
$$
BEGIN
    INSERT INTO person (info)
    SELECT
        XMLPARSE(DOCUMENT '<?xml version="1.0" encoding="UTF-8"?>
        <person>
            <name>' || 'Person' || generate_series || '</name>
            <age>' || (generate_series % 80 + 18) || '</age>
            <city>' || CASE WHEN generate_series % 3 = 0 THEN 'New York'
                            WHEN generate_series % 3 = 1 THEN 'Los Angeles'
                            ELSE 'San Francisco' END || '</city>
        </person>')
    FROM generate_series(1, 1000);
END;
$$ LANGUAGE plpgsql;
```

Third, call the `generate_persons` to insert 1000 rows into the `person` table:

```sql
SELECT generate_persons();
```

Fifth, find a person with the name `Jane Doe`:

```sql
EXPLAIN ANALYZE
SELECT *
FROM person
WHERE cast(xpath('/person/name', info) as text[]) = '{<name>Jane Doe</name>}';
```

Output:

```text
                                                      QUERY PLAN
-----------------------------------------------------------------------------------------------------------------------
 Bitmap Heap Scan on person  (cost=4.31..17.81 rows=5 width=178) (actual time=0.039..0.040 rows=0 loops=1)
   Recheck Cond: ((xpath('/person/name'::text, info, '{}'::text[]))::text[] = '{"<name>Jane Doe</name>"}'::text[])
   ->  Bitmap Index Scan on person_name  (cost=0.00..4.31 rows=5 width=0) (actual time=0.036..0.037 rows=0 loops=1)
         Index Cond: ((xpath('/person/name'::text, info, '{}'::text[]))::text[] = '{"<name>Jane Doe</name>"}'::text[])
 Planning Time: 0.144 ms
 Execution Time: 0.069 ms
(6 rows)
```

The output indicates that the query utilizes the index expression of the `person` table.

## Summary

- Use the `XML` data type to store XML documents in the database.
- Use the `xpath()` function to retrieve a value from XML documents.


# BYTEA

---
title: 'PostgreSQL BYTEA Data Type'
page_title: 'PostgreSQL BYTEA Data Type'
page_description: 'In this tutorial, you will learn about PostgreSQL BYTEA data type and how to use it to store binary strings in the database.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-bytea-data-type/'
ogImage: ''
updatedOn: '2024-04-20T13:26:12+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL XML Data Type'
  slug: 'postgresql-tutorial/postgresql-xml-data-type'
nextLink:
  title: 'PostgreSQL Composite Types'
  slug: 'postgresql-tutorial/postgresql-composite-types'
---

**Summary**: in this tutorial, you will learn about PostgreSQL `BYTEA` data type and how to use it to store binary strings in the database.

## Introduction to the PostgreSQL BYTEA data type

In PostgreSQL, `BYTEA` is a binary data type that you can use to store binary strings or byte sequences. `BYTEA` stands for the binary array.

The following shows how to define a table column with the `BYTEA` data type:

```sql
column_name BYTEA
```

The maximum size of a `BYTEA` column is 1GB. It means you can only store binary data up to 1GB in a single `BYTEA` column. However, storing a large amount of binary data in a `BYTEA` column is not efficient.

If files are larger than a few megabytes, you can store them externally and save the paths to the files in the database.

If you work with PHP or Python and want to know how to store binary data in a `BYTEA` column, you can follow these tutorials:

- [Storing files in a `BYTEA` column using PHP](../postgresql-php/postgresql-blob).
- [Storing images in a `BYTEA` column using Python](../postgresql-python/blob).

## PostgreSQL BYTEA data type example

First, [create a table](postgresql-create-table) called `binary_data` to store binary strings:

```sql
CREATE TABLE binary_data(
    id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    data BYTEA
);
```

Second, [insert](postgresql-insert) a binary string into the `binary_data` table:

```sql
INSERT INTO binary_data(data)
VALUES ('\x012345');
```

Third, retrieve data from the `BYTEA` column:

```sql
SELECT * FROM binary_data;
```

Output:

```text
 id |   data
----+----------
  1 | \x012345
(1 row)
```

## Summary

- Use the `BYTEA` data type to store small binary data in the database.


# Composite Types

---
title: 'PostgreSQL Composite Types'
page_title: 'PostgreSQL Composite Types'
page_description: 'In this tutorial, you will learn how to define PostgreSQL composite types to represent the structure of a row or record.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-composite-types/'
ogImage: ''
updatedOn: '2024-04-21T14:05:08+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL BYTEA Data Type'
  slug: 'postgresql-tutorial/postgresql-bytea-data-type'
nextLink:
  title: 'How to Compare Two Tables in PostgreSQL'
  slug: 'postgresql-tutorial/compare-two-tables-in-postgresql'
---

**Summary**: in this tutorial, you will learn how to define PostgreSQL composite types to represent the structure of a row or record.

In PostgreSQL, composite types allow you to define [custom data types](postgresql-user-defined-data-types) with multiple fields. These fields can be any built\-in or user\-defined types, including other composite types.

## Defining PostgreSQL composite types

To define a composite type, use the `CREATE TYPE` statement followed by the type name and a list of fields with their corresponding data types.

Here’s the basic syntax for defining a composite type:

```sql
CREATE TYPE type_name AS (
    field1 data_type1,
    field2 data_type2,
    ...
);
```

In this syntax:

- First, specify the name of the composite type (`type_name`) after the `CREATE TYPE` keywords.
- Second, define a list of fields of the composite type along with their respective data types.

For example, the following statement defines the address type that stores address information including street, city, state, zip code, and country:

```sql
CREATE TYPE address_type AS(
   street text,
   city text,
   state text,
   zip_code integer,
   country text
);
```

After defining a composite type, you can use it as a data type of a table column.

For example, the following statement [creates a table](postgresql-create-table) called `contacts` whose type of `address` column is the `address_type`:

```sql
CREATE TABLE contacts(
    id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address address_type
);
```

Please note that when creating a table, PostgreSQL implicitly creates a corresponding composite type. In this example, PostgreSQL automatically creates the `contacts` composite type.

## Inserting values into a composite column

To construct a composite value, you use the `ROW` expression syntax:

```sql
ROW(value1, value2, ...)
```

In this syntax, the `ROW` keyword is optional when you have multiple fields in the expression. Therefore, you can simplify the composite value as follows:

```sql
(value1, value2, ...)
```

To indicate a `NULL`, you can use the `NULL` keyword:

```sql
(value1, NULL, value3, ...)
```

Alternatively, you can omit it in the expression:

```sql
(value1,, value3, ...)
```

For example, the following statement inserts a new row into the `contacts` table:

```sql
INSERT INTO contacts (name, address)
VALUES (
    'John Smith',
    ROW('123 St', 'Houston', 'TX', 77001, 'USA')
);
```

In this example, we use the following composite value to insert into the `address` column:

```sql
ROW('123 St', 'Houston', 'TX', 77001, 'USA')
```

The following statement inserts a value into individual fields of the `address` column:

```sql
INSERT INTO contacts (
    name,
    address.street,
    address.city,
    address.state,
    address.zip_code
  )
VALUES
  ('Jane Doe', '4000 N. 1st Street', 'San Jose', 'CA', 95134);
```

In this statement, we use the column name, followed by a dot, and field name to indicate the field of a composite type.

## Querying composite values

The following statement retrieves the rows from the `contacts` table:

```sql
SELECT * FROM contacts;
```

Output:

```text
 id |    name    |                   address
----+------------+---------------------------------------------
  1 | John Smith | ("123 St",Houston,TX,77001,USA)
  2 | Jane Doe   | ("4000 N. 1st Street","San Jose",CA,95134,)
(2 rows)
```

To query individual fields of a composite type, you use the following syntax:

```sql
(column_name).field_name
```

For example, the following statement retrieves the id, name, city, state, and zip code of contacts:

```sql
SELECT
  id,
  name,
  (address).city,
  (address).state,
  (address).zip_code
FROM
  contacts;
```

Output:

```text
 id |    name    |   city   | state | zip_code
----+------------+----------+-------+----------
  1 | John Smith | Houston  | TX    |    77001
  2 | Jane Doe   | San Jose | CA    |    95134
(2 rows)
```

If you retrieve all fields from a composite value, you can use the asterisk (`*`) shorthand:

```sql
SELECT
  id,
  name,
  (address).*
FROM
  contacts;
```

Output:

```text
 id |    name    |       street       |   city   | state | zip_code | country
----+------------+--------------------+----------+-------+----------+---------
  1 | John Smith | 123 St             | Houston  | TX    |    77001 | USA
  2 | Jane Doe   | 4000 N. 1st Street | San Jose | CA    |    95134 | null
(2 rows)
```

## Updating composite values

The following example [updates](postgresql-update) the country of the contact id 2 to `USA`:

```sql
UPDATE contacts
SET
  address.country= 'USA'
WHERE
  id = 2
RETURNING *;
```

Output:

```text
 id |   name   |                    address
----+----------+------------------------------------------------
  2 | Jane Doe | ("4000 N. 1st Street","San Jose",CA,95134,USA)
(1 row)
```

In this example, you cannot put the parentheses around the column name of the composite type after the `SET` keyword.

## Summary

- Composite types allow you to define custom data types that include multiple fields.


# Set Operators

# UNION

---
title: 'PostgreSQL UNION'
page_title: 'PostgreSQL UNION Operator'
page_description: 'This tutorial shows you how to use the PostgreSQL UNION operator to combine the result sets of multiple queries into a single result set.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-union/'
ogImage: '/postgresqltutorial/PostgresQL-UNION.png'
updatedOn: '2024-02-06T01:38:07+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL HAVING'
  slug: 'postgresql-tutorial/postgresql-having'
nextLink:
  title: 'PostgreSQL INTERSECT Operator'
  slug: 'postgresql-tutorial/postgresql-intersect'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `UNION` operator to combine result sets of multiple queries into a single result set.

## Introduction to PostgreSQL UNION operator

The `UNION` operator allows you to combine the result sets of two or more [`SELECT`](postgresql-select) statements into a single result set.

Here’s the basic syntax of the `UNION` operator:

```sql
SELECT select_list
FROM A
UNION
SELECT select_list
FROM B;
```

In this syntax, the queries must conform to the following rules:

- The number and the order of the columns in the select list of both queries must be the same.
- The data types of the columns in select lists of the queries must be compatible.

The `UNION` operator removes all duplicate rows from the combined data set. To retain the duplicate rows, you use the `UNION ALL` instead.

Here’s the syntax of the `UNION ALL` operator:

```sql
SELECT select_list
FROM A
UNION ALL
SELECT select_list
FROM B;
```

The following Venn diagram illustrates how the `UNION` works:

![](/postgresqltutorial/PostgresQL-UNION.png)

### PostgreSQL UNION with ORDER BY clause

The `UNION` and `UNION ALL` operators may order the rows in the final result set in an unspecified order. For example, it may place rows from the second result set before/after the row from the first result set.

To sort rows in the final result set, you specify the [`ORDER BY`](postgresql-order-by) clause after the second query:

```
SELECT select_list
FROM A
UNION
SELECT select_list
FROM B
ORDER BY sort_expression;
```

Note that if you use the `ORDER BY` clause in the first query, PostgreSQL will issue an error.

## Setting up sample tables

The following statements create two tables `top_rated_films` and `most_popular_films`, and insert data into these tables:

```
CREATE TABLE top_rated_films(
  title VARCHAR NOT NULL,
  release_year SMALLINT
);

CREATE TABLE most_popular_films(
  title VARCHAR NOT NULL,
  release_year SMALLINT
);

INSERT INTO top_rated_films(title, release_year)
VALUES
   ('The Shawshank Redemption', 1994),
   ('The Godfather', 1972),
   ('The Dark Knight', 2008),
   ('12 Angry Men', 1957);

INSERT INTO most_popular_films(title, release_year)
VALUES
  ('An American Pickle', 2020),
  ('The Godfather', 1972),
  ('The Dark Knight', 2008),
  ('Greyhound', 2020);
```

The following statement retrieves data from the `top_rated_films` table:

```sql
SELECT * FROM top_rated_films;
```

Output:

```text
          title           | release_year
--------------------------+--------------
 The Shawshank Redemption |         1994
 The Godfather            |         1972
 The Dark Knight          |         2008
 12 Angry Men             |         1957
(4 rows)
```

The following statement retrieves data from the `most_popular_films` table:

```
SELECT * FROM most_popular_films;
```

Output:

```text
       title        | release_year
--------------------+--------------
 An American Pickle |         2020
 The Godfather      |         1972
 The Dark Knight    |         2008
 Greyhound          |         2020
(4 rows)
```

## PostgreSQL UNION examples

Let’s take some examples of using the PostgreSQL `UNION` operator.

### 1\) Basic PostgreSQL UNION example

The following statement uses the `UNION` operator to combine data from the queries that retrieve data from the `top_rated_films` and `most_popular_films`:

```
SELECT * FROM top_rated_films
UNION
SELECT * FROM most_popular_films;
```

Output:

```text
          title           | release_year
--------------------------+--------------
 An American Pickle       |         2020
 The Dark Knight          |         2008
 Greyhound                |         2020
 The Shawshank Redemption |         1994
 The Godfather            |         1972
 12 Angry Men             |         1957
(6 rows)
```

The result set includes six rows because the `UNION` operator removes two duplicate rows.

### 2\) PostgreSQL UNION ALL example

The following statement uses the `UNION ALL` operator to combine result sets from queries that retrieve data from `top_rated_films` and `most_popular_films` tables:

```
SELECT * FROM top_rated_films
UNION ALL
SELECT * FROM most_popular_films;
```

Output:

```text
          title           | release_year
--------------------------+--------------
 The Shawshank Redemption |         1994
 The Godfather            |         1972
 The Dark Knight          |         2008
 12 Angry Men             |         1957
 An American Pickle       |         2020
 The Godfather            |         1972
 The Dark Knight          |         2008
 Greyhound                |         2020
(8 rows)
```

The output indicates that the `UNION ALL` operator retains the duplicate rows.

### 3\) PostgreSQL UNION ALL with ORDER BY clause example

To sort the result returned by the `UNION` operator, you place the `ORDER BY` clause after the second query:

```
SELECT * FROM top_rated_films
UNION ALL
SELECT * FROM most_popular_films
ORDER BY title;
```

Output:

```
          title           | release_year
--------------------------+--------------
 12 Angry Men             |         1957
 An American Pickle       |         2020
 Greyhound                |         2020
 The Dark Knight          |         2008
 The Dark Knight          |         2008
 The Godfather            |         1972
 The Godfather            |         1972
 The Shawshank Redemption |         1994
(8 rows)
```

## Summary

- Use the `UNION` to combine result sets of two queries and return distinct rows.
- Use the `UNION ALL` to combine the result sets of two queries but retain the duplicate rows.


# INTERSECT

---
title: 'PostgreSQL INTERSECT Operator'
page_title: 'PostgreSQL INTERSECT Operator'
page_description: 'Show you how to use the PostgreSQL INTERSECT operator to combine two result sets and return the rows that appear in both result sets.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-intersect/'
ogImage: '/postgresqltutorial/PostgreSQL-INTERSECT-Operator-300x206.png'
updatedOn: '2024-07-01T01:03:14+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL UNION'
  slug: 'postgresql-tutorial/postgresql-union'
nextLink:
  title: 'PostgreSQL EXCEPT'
  slug: 'postgresql-tutorial/postgresql-except'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `INTERSECT` operator to combine result sets of two or more queries.

## Introduction to PostgreSQL INTERSECT operator

Like the [UNION](postgresql-union) and [EXCEPT](postgresql-except) operators, the PostgreSQL `INTERSECT` operator combines result sets of two [SELECT](postgresql-except) statements into a single result set. The `INTERSECT` operator returns a result set containing rows available in both results sets.

Here is the basic syntax of the `INTERSECT` operator:

```plaintextsql
SELECT select_list
FROM A
INTERSECT
SELECT select_list
FROM B;
```

To use the `INTERSECT` operator, the columns that appear in the `SELECT` statements must follow these rules:

- The number of columns and their order in queries must be the same.
- The [data types](postgresql-data-types) of the columns in the queries must be compatible.

The following diagram illustrates how the `INTERSECT` operator combines the result sets A and B. The final result set is represented by the yellow area where circle A intersects circle B.

![PostgreSQL INTERSECT Operator](/postgresqltutorial/PostgreSQL-INTERSECT-Operator-300x206.png)

### PostgreSQL INTERSECT with ORDER BY clause

If you want to sort the result set returned by the `INTERSECT` operator, you place the `ORDER BY` after the final query:

```sql
SELECT select_list
FROM A
INTERSECT
SELECT select_list
FROM B
ORDER BY sort_expression;
```

## Setting up sample tables

We’ll create two tables `top_rated_films` and `most_popular_films` for demonstration:

```sql
CREATE TABLE top_rated_films(
  title VARCHAR NOT NULL,
  release_year SMALLINT
);

CREATE TABLE most_popular_films(
  title VARCHAR NOT NULL,
  release_year SMALLINT
);

INSERT INTO top_rated_films(title, release_year)
VALUES
   ('The Shawshank Redemption', 1994),
   ('The Godfather', 1972),
   ('The Dark Knight', 2008),
   ('12 Angry Men', 1957);

INSERT INTO most_popular_films(title, release_year)
VALUES
  ('An American Pickle', 2020),
  ('The Godfather', 1972),
  ('The Dark Knight', 2008),
  ('Greyhound', 2020);

SELECT * FROM top_rated_films;
SELECT * FROM most_popular_films;
```

The contents of the `top_rated_films` table:

```text
          title           | release_year
--------------------------+--------------
 The Shawshank Redemption |         1994
 The Godfather            |         1972
 The Dark Knight          |         2008
 12 Angry Men             |         1957
(4 rows)
```

The contents of the `most_popular_films` table:

```plaintext
       title        | release_year
--------------------+--------------
 An American Pickle |         2020
 The Godfather      |         1972
 The Dark Knight    |         2008
 Greyhound          |         2020
(4 rows)
```

## PostgreSQL INTERSECT operator examples

Let’s explore some examples of using the `INTERSECT` operator.

### 1\) Basic INTERSECT operator example

The following example uses the `INTERSECT` operator to retrieve the popular films that are also top\-rated:

```plaintext
SELECT *
FROM most_popular_films
INTERSECT
SELECT *
FROM top_rated_films;
```

Output:

```text
      title      | release_year
-----------------+--------------
 The Godfather   |         1972
 The Dark Knight |         2008
(2 rows)
```

The result set returns one film that appears on both tables.

### 2\) Using the INTERSECT operator with ORDER BY clause example

The following statement uses the `INTERSECT` operator to find the most popular films which are also the top\-rated films and sort the films by release year:

```plaintext
SELECT *
FROM most_popular_films
INTERSECT
SELECT *
FROM top_rated_films
ORDER BY release_year;
```

Output:

```
      title      | release_year
-----------------+--------------
 The Godfather   |         1972
 The Dark Knight |         2008
(2 rows)
```

## Summary

- Use the PostgreSQL `INTERSECT` operator to combine two result sets and return a single result set containing rows appearing in both.
- Place the `ORDER BY` clause after the second query to sort the rows in the result set returned by the `INTERSECT` operator.


# EXCEPT

---
title: 'PostgreSQL EXCEPT'
page_title: 'PostgreSQL EXCEPT'
page_description: 'Show you how to the PostgreSQL EXCEPT operator to combine the result sets of two queries.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-except/'
ogImage: '/postgresqltutorial/PostgreSQL-EXCEPT-300x202.png'
updatedOn: '2024-07-01T00:51:42+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL INTERSECT Operator'
  slug: 'postgresql-tutorial/postgresql-intersect'
nextLink:
  title: 'PostgreSQL GROUPING SETS'
  slug: 'postgresql-tutorial/postgresql-grouping-sets'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `EXCEPT` operator to return a result set containing the rows in the first query that does not appear in the output of the second query.

## Introduction to the PostgreSQL EXCEPT operator

Like the [UNION](postgresql-union) and [INTERSECT](postgresql-intersect) operators, the `EXCEPT` operator returns rows by comparing the result sets of two or more queries.

The `EXCEPT` operator returns distinct rows from the first (left) query that are not in the second (right) query.

The following illustrates the syntax of the `EXCEPT` operator.

```sql
SELECT select_list
FROM A
EXCEPT
SELECT select_list
FROM B;
```

The queries that involve the `EXCEPT` need to follow these rules:

- The number of columns and their orders must be the same in the two queries.
- The data types of the respective columns must be compatible.

The following Venn diagram illustrates the `EXCEPT` operator:

![PostgreSQL EXCEPT](/postgresqltutorial/PostgreSQL-EXCEPT-300x202.png)If you want to sort the rows in the combined result sets, you need to place the [`ORDER BY`](postgresql-order-by) clause after the second query:

```sql
SELECT select_list
FROM A
EXCEPT
SELECT select_list
FROM B
ORDER BY sort_expression;
```

## Setting up sample tables

We’ll create the `top_rated_films` and `most_popular_films` tables for demonstration:

```sql
CREATE TABLE top_rated_films(
  title VARCHAR NOT NULL,
  release_year SMALLINT
);

CREATE TABLE most_popular_films(
  title VARCHAR NOT NULL,
  release_year SMALLINT
);

INSERT INTO top_rated_films(title, release_year)
VALUES
   ('The Shawshank Redemption', 1994),
   ('The Godfather', 1972),
   ('The Dark Knight', 2008),
   ('12 Angry Men', 1957);

INSERT INTO most_popular_films(title, release_year)
VALUES
  ('An American Pickle', 2020),
  ('The Godfather', 1972),
  ('The Dark Knight', 2008),
  ('Greyhound', 2020);

SELECT * FROM top_rated_films;
SELECT * FROM most_popular_films;
```

The contents of the `top_rated_films` table:

```text
          title           | release_year
--------------------------+--------------
 The Shawshank Redemption |         1994
 The Godfather            |         1972
 The Dark Knight          |         2008
 12 Angry Men             |         1957
(4 rows)
```

The contents of the `most_popular_films` table:

```text
       title        | release_year
--------------------+--------------
 An American Pickle |         2020
 The Godfather      |         1972
 The Dark Knight    |         2008
 Greyhound          |         2020
(4 rows)
```

## PostgreSQL EXCEPT operator examples

Let’s take some examples of using the `EXCEPT` operator

### 1\) Basic EXCEPT operator example

The following statement uses the `EXCEPT` operator to find the top\-rated films that are not popular:

```sql
SELECT * FROM top_rated_films
EXCEPT
SELECT * FROM most_popular_films;
```

Output:

```text
          title           | release_year
--------------------------+--------------
 The Shawshank Redemption |         1994
 12 Angry Men             |         1957
(2 rows)
```

### 2\) Using the EXCEPT operator with the ORDER BY clause

The following statement uses the `ORDER BY` clause in the query to sort the result set returned by the `EXCEPT` operator by titles:

```sql
SELECT * FROM top_rated_films
EXCEPT
SELECT * FROM most_popular_films
ORDER BY title;
```

Output:

```text
          title           | release_year
--------------------------+--------------
 12 Angry Men             |         1957
 The Shawshank Redemption |         1994
(2 rows)
```

Notice that we placed the [ORDER BY](postgresql-order-by) clause after the second query to sort the films by titles.

## Summary

- Use the PostgreSQL `EXCEPT` operator to combine rows from two result sets and return a result set containing rows from the first result set that do not appear in the second result set.


# Conditional Expressions & Operators

# CASE

---
title: 'PostgreSQL CASE'
page_title: 'PostgreSQL CASE'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL CASE expression to form conditional queries.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-case/'
ogImage: '/postgresqltutorial/film.png'
updatedOn: '2024-02-01T03:34:12+00:00'
enableTableOfContents: true
previousLink:
  title: 'How To Delete Duplicate Rows in PostgreSQL'
  slug: 'postgresql-tutorial/how-to-delete-duplicate-rows-in-postgresql'
nextLink:
  title: 'PostgreSQL COALESCE'
  slug: 'postgresql-tutorial/postgresql-coalesce'
---

**Summary**: in this tutorial, you will learn how to use the **PostgreSQL CASE** conditional expression to form conditional queries.

The PostgreSQL `CASE` expression is the same as `IF/ELSE` statement in other programming languages. It allows you to add if\-else logic to the query to form a powerful query.

Since `CASE` is an expression, you can use it in any place where you would use an expression such as [`SELECT`](postgresql-select), [`WHERE`](postgresql-where), [`GROUP BY`](postgresql-group-by), and [`HAVING`](postgresql-having) clauses.

The `CASE` expression has two forms:

- General
- Simple

## General PostgreSQL CASE expression

The following illustrates the general form of the `CASE` statement:

```phpsql
CASE
      WHEN condition_1  THEN result_1
      WHEN condition_2  THEN result_2
      [WHEN ...]
      [ELSE else_result]
END
```

In this syntax, each condition (`condition_1`, `condition_2`…) is a boolean expression that returns either `true` or `false`.

When a condition evaluates to `false`, the `CASE` expression evaluates the next condition from top to bottom until it finds a condition that evaluates to `true`.

If a condition evaluates to `true`, the `CASE` expression returns the corresponding result that follows the condition.

For example, if the `condition_2` evaluates to `true`, the `CASE` expression returns the `result_2`. Also, it immediately stops evaluating the remaining expressions.

If all conditions are `false`, the `CASE` expression returns the result (`else_result`) that follows the `ELSE` keyword. If you omit the `ELSE` clause, the `CASE` expression returns `NULL`.

### 1\) The general CASE example

Let’s take a look at the `film` table from the [sample database](../postgresql-getting-started/postgresql-sample-database).

![](/postgresqltutorial/film.png)Suppose you want to label the films by their lengths based on the following logic:

- If the length is less than 50 minutes, the film is short.
- If the length is greater than 50 minutes and less than or equal to 120 minutes, the film is medium.
- If the length is greater than 120 minutes, the film is long.

To apply this logic, you can use the `CASE` expression in the `SELECT` statement as follows:

```sql
SELECT
  title,
  length,
  CASE WHEN length > 0
  AND length <= 50 THEN 'Short' WHEN length > 50
  AND length <= 120 THEN 'Medium' WHEN length > 120 THEN 'Long' END duration
FROM
  film
ORDER BY
  title;
```

Output:

```php
            title            | length | duration
-----------------------------+--------+----------
 Academy Dinosaur            |     86 | Medium
 Ace Goldfinger              |     48 | Short
 Adaptation Holes            |     50 | Short
 Affair Prejudice            |    117 | Medium
 African Egg                 |    130 | Long
 Agent Truman                |    169 | Long
```

Note that we placed a [column alias](postgresql-column-alias) `duration` after the `CASE` expression.

### 2\) Using CASE with an aggregate function example

Suppose that you want to assign price segments to films with the following logic:

- If the rental rate is 0\.99, the film is economic.
- If the rental rate is 1\.99, the film is mass.
- If the rental rate is 4\.99, the film is premium.

And you want to know the number of films that belong to economy, mass, and premium.

In this case, you can use the `CASE` expression to construct the query as follows:

```
SELECT
  SUM (
    CASE WHEN rental_rate = 0.99 THEN 1 ELSE 0 END
  ) AS "Economy",
  SUM (
    CASE WHEN rental_rate = 2.99 THEN 1 ELSE 0 END
  ) AS "Mass",
  SUM (
    CASE WHEN rental_rate = 4.99 THEN 1 ELSE 0 END
  ) AS "Premium"
FROM
  film;

```

The result of the query is as follows:

```text
 Economy | Mass | Premium
---------+------+---------
     341 |  323 |     336
(1 row)
```

In this example, we used the `CASE` expression to return 1 or 0 if the rental rate falls into each price segment. We applied the [`SUM`](../postgresql-aggregate-functions/postgresql-sum-function) function to calculate the total of films for each price segment.

## Simple PostgreSQL CASE expression

PostgreSQL provides another form of the `CASE` expression called simple form as follows:

```
CASE expression
   WHEN value_1 THEN result_1
   WHEN value_2 THEN result_2
   [WHEN ...]
ELSE
   else_result
END
```

The `CASE` first evaluates the `expression` and compares the result with each value( `value_1`, `value_2`, …) in the `WHEN` clauses sequentially until it finds the match.

Once the result of the `expression` equals a value (value1, value2, etc.) in a `WHEN` clause, the `CASE` returns the corresponding result in the `THEN` clause.

If `CASE` does not find any matches, it returns the `else_result` in that follows the `ELSE`, or `NULL` value if the `ELSE` is not available.

### 1\) Simple PostgreSQL CASE expression example

The following statement uses the `CASE` expression to add the rating description to the output:

```
SELECT title,
       rating,
       CASE rating
           WHEN 'G' THEN 'General Audiences'
           WHEN 'PG' THEN 'Parental Guidance Suggested'
           WHEN 'PG-13' THEN 'Parents Strongly Cautioned'
           WHEN 'R' THEN 'Restricted'
           WHEN 'NC-17' THEN 'Adults Only'
       END rating_description
FROM film
ORDER BY title;
```

Output:

```php
            title            | rating |     rating_description
-----------------------------+--------+-----------------------------
 Academy Dinosaur            | PG     | Parental Guidance Suggested
 Ace Goldfinger              | G      | General Audiences
 Adaptation Holes            | NC-17  | Adults Only
 Affair Prejudice            | G      | General Audiences
 African Egg                 | G      | General Audiences
 Agent Truman                | PG     | Parental Guidance Suggested
 Airplane Sierra             | PG-13  | Parents Strongly Cautioned
...
```

In this example, we used a simple `CASE` expression to compare the rating from the `film` table with some literal values like G, PG, NC17, PG\-13 and return the corresponding rating description.

### 2\) Using simple PostgreSQL CASE expression with aggregate function example

The following statement uses `CASE` expression with the `SUM` function to calculate the number of films in each rating:

```
SELECT
  SUM(CASE rating WHEN 'G' THEN 1 ELSE 0 END) "General Audiences",
  SUM(
    CASE rating WHEN 'PG' THEN 1 ELSE 0 END
  ) "Parental Guidance Suggested",
  SUM(
    CASE rating WHEN 'PG-13' THEN 1 ELSE 0 END
  ) "Parents Strongly Cautioned",
  SUM(CASE rating WHEN 'R' THEN 1 ELSE 0 END) "Restricted",
  SUM(
    CASE rating WHEN 'NC-17' THEN 1 ELSE 0 END
  ) "Adults Only"
FROM
  film;

```

Output:

```
 General Audiences | Parental Guidance Suggested | Parents Strongly Cautioned | Restricted | Adults Only
-------------------+-----------------------------+----------------------------+------------+-------------
               178 |                         194 |                        223 |        195 |         210
(1 row)
```

In this tutorial, you have learned how to use the PostgreSQL `CASE` expression to form complex queries.


# COALESCE

---
title: 'PostgreSQL COALESCE'
page_title: 'PostgreSQL COALESCE() Function'
page_description: 'In this tutorial, you will learn about the PostgreSQL COALESCE() function that returns the first non-null argument.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-coalesce/'
ogImage: ''
updatedOn: '2024-02-01T03:59:29+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CASE'
  slug: 'postgresql-tutorial/postgresql-case'
nextLink:
  title: 'PostgreSQL ISNULL'
  slug: 'postgresql-tutorial/postgresql-isnull'
---

**Summary**: in this tutorial, you will learn about the PostgreSQL `COALESCE()` function that returns the first non\-null argument.

## PostgreSQL COALESCE function syntax

The `COALESCE()` function accepts a list of arguments and returns the first non\-null argument.

Here’s the basic syntax of the `COALESCE()` function:

```sqlsql
COALESCE (argument_1, argument_2, …);
```

The `COALESCE()` function accepts multiple arguments and returns the first argument that is not null. If all arguments are null, the `COALESCE()` function will return null.

The `COALESCE()` function evaluates arguments from left to right until it finds the first non\-null argument. All the remaining arguments from the first non\-null argument are not evaluated.

The `COALESCE` function provides the same functionality as `NVL` or `IFNULL` function provided by SQL standard. MySQL has the [IFNULL function](https://www.mysqltutorial.org/mysql-control-flow-functions/mysql-ifnull/) whereas Oracle Database offers the [`NVL`](https://www.oracletutorial.com/oracle-comparison-functions/oracle-nvl/) function.

## PostgreSQL COALESCE() Function examples

Let’s take some examples of using the `COALESCE()` function.

### 1\) Basic PostgreSQL COALESCE() function examples

The following example uses the `COALESCE()` function to return the first non\-null argument:

```sql
SELECT COALESCE (1, 2);
```

Since both arguments are non\-null, the function returns the first argument:

```text
 coalesce
----------
        1
(1 row)
```

The following example uses the `COALESCE()` function to return the first non\-null argument:

```
SELECT COALESCE (NULL, 2 , 1);
```

Because the first argument is NULL and the second argument is non\-null, the function returns the second argument:

```text
 coalesce
----------
        2
(1 row)
```

In practice, you often use the `COLAESCE()` function to substitute a default value for null when querying data from nullable columns.

For example, if you want to display the excerpt from a blog post and the excerpt is not provided, you can use the first 150 characters of the content of the post.

To achieve this, you can use the `COALESCE` function as follows:

```
SELECT
  COALESCE (
    excerpt,
    LEFT(content, 150)
  )
FROM
  posts;
```

### 2\) Using the COALESCE() function with table data

First, [create a table](postgresql-create-table) called `items`:

```sql
CREATE TABLE items (
  id SERIAL PRIMARY KEY,
  product VARCHAR (100) NOT NULL,
  price NUMERIC NOT NULL,
  discount NUMERIC
);
```

The `items` table has four columns:

- `id`: the primary key that identifies the item in the `items` table.
- `product`: the product name.
- `price`: the price of the product.
- `discount`: the discount on the product.

Second, [insert some rows](postgresql-insert-multiple-rows) into the `items` table:

```sql
INSERT INTO items (product, price, discount)
VALUES
  ('A', 1000, 10),
  ('B', 1500, 20),
  ('C', 800, 5),
  ('D', 500, NULL);
```

Third, retrieve the net prices of the products from the `items` table:

```sql
SELECT
  product,
  (price - discount) AS net_price
FROM
  items;
```

Output:

```text
 product | net_price
---------+-----------
 A       |       990
 B       |      1480
 C       |       795
 D       |      null
(4 rows)
```

The output indicates that the net price of the product `D` is null.

The issue is that the `discount` of the product `D` is null. Therefore, the net price is NULL because it involves NULL in the calculation.

With an assumption that if the discount is null, the net price is zero, you can use the `COALESCE()` function in the query as follows:

```
SELECT
  product,
  (
    price - COALESCE(discount, 0)
  ) AS net_price
FROM
  items;
```

Output:

```text
 product | net_price
---------+-----------
 A       |       990
 B       |      1480
 C       |       795
 D       |       500
(4 rows)
```

Now the net price of the product `D` is `500` because the query uses zero instead of NULL when calculating the net price.

Besides using the `COALESCE()` function, you can use the [CASE](postgresql-case) expression to handle the NULL in this example.

For example, the following query uses the `CASE` expression to achieve the same result:

```
SELECT
  product,
  (
    price - CASE WHEN discount IS NULL THEN 0 ELSE discount END
  ) AS net_price
FROM
  items;
```

In this query, if the discount is null then use zero (0\) otherwise use the discount value to calculate the net price.

In terms of performance, the `COALESCE()` function and `CASE` expression are the same.

It is recommended to use `COALESCE()` function because it makes the query shorter and easier to read.

## Summary

- Use the `COALESCE()` function to substitute null values in the query.


# NULLIF

---
title: 'PostgreSQL NULLIF'
page_title: 'PostgreSQL NULLIF function'
page_description: 'Show you how to apply the PostgreSQL NULLIF function to substitute the null values for displaying data and preventing division by zero error.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-nullif/'
ogImage: ''
updatedOn: '2024-02-01T04:37:20+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL ISNULL'
  slug: 'postgresql-tutorial/postgresql-isnull'
nextLink:
  title: 'PostgreSQL CAST: Convert a value of One Type to Another'
  slug: 'postgresql-tutorial/postgresql-cast'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `NULLIF()` function to handle null values.

## Introduction to PostgreSQL NULLIF function

The `NULLIF()` function is one of the most common conditional expressions provided by PostgreSQL.

Here’s the basic syntax of the `NULLIF` function:

```phpsqlsql
NULLIF(argument_1,argument_2);
```

The `NULLIF` function returns a null value if `argument_1` equals to `argument_2`, otherwise, it returns `argument_1`.

## PostgreSQL NULLIF function examples

Let’s take some examples of using the `NULLIF()` function.

### 1\) Basic PostgreSQL NULLIF examples

The following statements illustrate how to use the `NULLIF()` function:

```sql
SELECT NULLIF (1, 1); -- return NULL
```

Output:

```text
 nullif
--------
   null
(1 row)

```

It returns null because the two arguments are equal.

The following example returns the first argument because the two arguments are not equal:

```sql
SELECT NULLIF (1, 0); -- return 1
```

Output:

```text
 nullif
--------
      1
(1 row)
```

The following example uses the `NULLIF()` function with two unequal text arguments:

```
SELECT NULLIF ('A', 'B');
```

Output:

```text
 nullif
--------
 A
(1 row)

```

### 2\) Using the NULLIF function with table data

First, [create a table](postgresql-create-table) called `posts`:

```
CREATE TABLE posts (
  id serial primary key,
  title VARCHAR (255) NOT NULL,
  excerpt VARCHAR (150),
  body TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP
);
```

Second, [insert some sample data](postgresql-insert) into the `posts` table.

```sql
INSERT INTO posts (title, excerpt, body)
VALUES
      ('test post 1','test post excerpt 1','test post body 1'),
      ('test post 2','','test post body 2'),
      ('test post 3', null ,'test post body 3')
RETURNING *;
```

Output:

```text
 id |    title    |       excerpt       |       body       |         created_at         | updated_at
----+-------------+---------------------+------------------+----------------------------+------------
  1 | test post 1 | test post excerpt 1 | test post body 1 | 2024-02-01 11:28:38.779881 | null
  2 | test post 2 |                     | test post body 2 | 2024-02-01 11:28:38.779881 | null
  3 | test post 3 | null                | test post body 3 | 2024-02-01 11:28:38.779881 | null
(3 rows)
```

The goal is to retrieve data for displaying them on the post overview page that includes the title and excerpt of each post. To achieve this, you can use the first 40 characters of the post body as the excerpt.

Third, use the [COALESCE function](postgresql-coalesce) to handle `NULL` in the `body` column:

```sql
SELECT
  id,
  title,
  COALESCE (
    excerpt,
    LEFT(body, 40)
  )
FROM
  posts;
```

Output:

```text
 id |    title    |      coalesce
----+-------------+---------------------
  1 | test post 1 | test post excerpt 1
  2 | test post 2 |
  3 | test post 3 | test post body 3
(3 rows)
```

Unfortunately, there is a mix between null value and ” (empty) in the `excerpt` column. To address this issue, you can use the `NULLIF` function:

```
SELECT
  id,
  title,
  COALESCE (
    NULLIF (excerpt, ''),
    LEFT (body, 40)
  )
FROM
  posts;
```

Output:

```text
 id |    title    |      coalesce
----+-------------+---------------------
  1 | test post 1 | test post excerpt 1
  2 | test post 2 | test post body 2
  3 | test post 3 | test post body 3
(3 rows)
```

In this statement:

- First, the `NULLIF` function returns a null value if the excerpt is empty or the excerpt otherwise. The result of the `NULLIF` function is used by the `COALESCE` function.
- Second, the `COALESCE` function checks if the first argument, which is provided by the `NULLIF` function, if it is null, then it returns the first 40 characters of the body; otherwise, it returns the excerpt in case the excerpt is not null.

## Using NULLIF() function to prevent division\-by\-zero

Another good example of using the `NULLIF` function is to prevent division\-by\-zero error.

First, [create a new table](postgresql-create-table) named members:

```
CREATE TABLE members (
  id serial PRIMARY KEY,
  first_name VARCHAR (50) NOT NULL,
  last_name VARCHAR (50) NOT NULL,
  gender SMALLINT NOT NULL -- 1: male, 2 female
);
```

Second, [insert some rows](postgresql-insert) for testing:

```sql
INSERT INTO members (first_name, last_name, gender)
VALUES
  ('John', 'Doe', 1),
  ('David', 'Dave', 1),
  ('Bush', 'Lily', 2)
RETURNING *;
```

Output:

```text
 id | first_name | last_name | gender
----+------------+-----------+--------
  1 | John       | Doe       |      1
  2 | David      | Dave      |      1
  3 | Bush       | Lily      |      2
(3 rows)
```

Third, calculate the ratio between male and female members:

```
SELECT
  (
    SUM (CASE WHEN gender = 1 THEN 1 ELSE 0 END) / SUM (CASE WHEN gender = 2 THEN 1 ELSE 0 END)
  ) * 100 AS "Male/Female ratio"
FROM
  members;
```

In this example, we use the [SUM function](../postgresql-aggregate-functions/postgresql-sum-function) and [CASE expression](postgresql-case) to calculate the total number of male members. Then we divide the total of male members by the total of female members to get the ratio. In this case, it returns 200%:

```text
 Male/Female ratio
-------------------
               200
(1 row)
```

Fourth, delete a female member:

```
DELETE FROM members
WHERE gender = 2;
```

And execute the query to calculate the male/female ratio again:

```sql
SELECT
  (
    SUM (CASE WHEN gender = 1 THEN 1 ELSE 0 END) / SUM (CASE WHEN gender = 2 THEN 1 ELSE 0 END)
  ) * 100 AS "Male/Female ratio"
FROM
  members;
```

We got the following error message:

```http
ERROR:  division by zero
```

The reason is that the number of females is zero now. To prevent this division by zero error, you can use the `NULLIF` function as follows:

```
SELECT
  (
    SUM (CASE WHEN gender = 1 THEN 1 ELSE 0 END) / NULLIF (
      SUM (CASE WHEN gender = 2 THEN 1 ELSE 0 END),
      0
    )
  ) * 100 AS "Male/Female ratio"
FROM
  members;
```

Output:

```
 Male/Female ratio
-------------------
              null
(1 row)

```

The `NULLIF` function checks if the number of female members is zero, it returns null. The total of male members is divided by `NULL` will return `NULL` .

## Summary

- Use the `NULLIF()` function to substitute NULL for displaying data and to prevent division by zero.


# CAST

---
title: 'PostgreSQL CAST: Convert a value of One Type to Another'
page_title: 'PostgreSQL CAST: Convert a Value of One Data Type to Another'
page_description: 'You will learn how to use the PostgreSQL CAST() function and cast operator (::) to cast a value of one type to another.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-cast/'
ogImage: ''
updatedOn: '2024-02-01T06:59:27+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL NULLIF'
  slug: 'postgresql-tutorial/postgresql-nullif'
nextLink:
  title: 'PostgreSQL EXPLAIN'
  slug: 'postgresql-tutorial/postgresql-explain'
---

**Summary**: in this tutorial, you will learn how to use PostgreSQL `CAST()` function and operator to convert a value of one type to another.

## Introduction to PostgreSQL CAST() function and cast operator (::)

There are many cases in which you want to convert a value of one [type](postgresql-data-types) into another. PostgreSQL offers the `CAST()` function and cast operator (`::`) to do this.

### PostgreSQL CAST() function

Here’s the basic syntax of the type `CAST()` function:

```phpsqlsql
CAST(<code>value</code> AS target_type );
```

In this syntax:

- First, provide a `value` that you want to convert. It can be a constant, a table column, or an expression.
- Then, specify the target [data type](postgresql-data-types) to which you want to convert the `value`.

The `CAST()` returns a value after it has been cast to the specified target data type. If the `CAST()` function cannot cast the value to a target type, it’ll raise an error. The error message will depend on the nature of the conversion failure.

### PostgreSQL cast operator (::)

Besides the type `CAST()` function, you can use the following cast operator (`::`) to convert a value of one type into another:

```sql
value::target_type
```

In this syntax:

- `value` is a value that you want to convert.
- `target_type` specifies the target type that you want to cast the value to.

The cast operator `::` returns a value after casting the `value` to the `target_type` or raise an error if the cast fails.

Notice that the cast operator (::) is PostgreSQL\-specific and does not conform to the SQL standard

## PostgreSQL CAST() function and cast operator (::) examples

Let’s take some examples of using the `CAST` operator to convert a value of one type to another.

### 1\) Cast a string to an integer example

The following statement uses the `CAST()` operator to convert a string to an integer:

```sql
SELECT
  CAST ('100' AS INTEGER);
```

Output:

```text
 int4
------
  100
(1 row)
```

If the expression cannot be converted to the target type, PostgreSQL will raise an error. For example:

```
SELECT
  CAST ('10C' AS INTEGER);
```

```sql
[Err] ERROR:  invalid input syntax for integer: "10C"
LINE 2:  CAST ('10C' AS INTEGER);
```

### 2\) Cast a string to a date example

This example uses the `CAST()` function to convert a string to a [date](postgresql-date):

```php
SELECT
   CAST ('2015-01-01' AS DATE),
   CAST ('01-OCT-2015' AS DATE);
```

Output:

```text
    date    |    date
------------+------------
 2015-01-01 | 2015-10-01
(1 row)
```

In this example, we converted `2015-01-01` literal string into `January 1st 2015` and `01-OCT-2015` to `October 1st 2015`.

### 3\) Cast a string to a double example

The following example uses the CAST() function to convert a string `'10.2'` into a double:

```
SELECT
	CAST ('10.2' AS DOUBLE);
```

Whoops, we got the following error message:

```sql
[Err] ERROR:  type "double" does not exist
LINE 2:  CAST ('10.2' AS DOUBLE)
```

To fix this, you need to use `DOUBLE PRECISION` instead of `DOUBLE` as follows:

```css
SELECT
   CAST ('10.2' AS DOUBLE PRECISION);
```

Output:

```text
 float8
--------
   10.2
(1 row)
```

### 4\) Cast a string to a boolean example

This example uses the `CAST()` to convert the string ‘true’, ‘T’ to true and ‘false’, ‘F’ to false:

```css
SELECT
   CAST('true' AS BOOLEAN),
   CAST('false' as BOOLEAN),
   CAST('T' as BOOLEAN),
   CAST('F' as BOOLEAN);
```

Output:

```text
 bool | bool | bool | bool
------+------+------+------
 t    | f    | t    | f
(1 row)

```

### 5\) Cast a string to a timestamp example

This example uses the cast operator (::) to convert a string to a [timestamp](postgresql-timestamp):

```
SELECT '2019-06-15 14:30:20'::timestamp;
```

Output:

```text
      timestamp
---------------------
 2019-06-15 14:30:20
(1 row)
```

### 6\) Cast a string to an interval example

This example uses the cast operator to convert a string to an [interval](postgresql-interval):

```php
SELECT
  '15 minute' :: interval,
  '2 hour' :: interval,
  '1 day' :: interval,
  '2 week' :: interval,
  '3 month' :: interval;
```

Output:

```text
 interval | interval | interval | interval | interval
----------+----------+----------+----------+----------
 00:15:00 | 02:00:00 | 1 day    | 14 days  | 3 mons
(1 row)
```

### 7\) Cast a timestamp to a date example

The following example uses the `CAST()` to convert a timestamp to a date:

```
SELECT CAST('2024-02-01 12:34:56' AS DATE);
```

Output:

```text
    date
------------
 2024-02-01
(1 row)
```

### 8\) Cast an interval to text

The following example uses `CAST()` function to convert an interval to text:

```
SELECT CAST('30 days' AS TEXT);
```

Output:

```text
  text
---------
 30 days
(1 row)
```

### 10\) Cast a JSON to a JSONB

The following example uses the `CAST()` function to convert JSON to JSONB:

```
SELECT CAST('{"name": "John"}' AS JSONB);
```

Output:

```text
      jsonb
------------------
 {"name": "John"}
(1 row)
```

### 11\) Cast a double precision to an integer

The following example uses `CAST()` function to convert double precision to integer:

```
SELECT CAST(9.99 AS INTEGER);
```

Output:

```text
 int4
------
   10
(1 row)
```

### 12\) Cast an array to a text

The following example uses `CAST()` function to convert an array to text:

```
SELECT CAST(ARRAY[1, 2, 3] AS TEXT);
```

Output:

```php
  array
---------
 {1,2,3}
(1 row)
```

### 13\) Cast text to an array

The following example shows how to use the cast operator (::) to convert text to an array:

```php
SELECT '{1,2,3}'::INTEGER[] AS result_array;
```

Output:

```
 result_array
--------------
 {1,2,3}
(1 row)
```

### 14\) Using CAST with table data example

First, [create](postgresql-create-table) a `ratings` table that consists of two columns: `id` and `rating`:

```
CREATE TABLE ratings (
  id SERIAL PRIMARY KEY,
  rating VARCHAR (1) NOT NULL
);
```

Second, [insert some sample data](postgresql-insert) into the `ratings` table.

```sql
INSERT INTO ratings (rating)
VALUES
  ('A'),
  ('B'),
  ('C');
```

Because the requirements change, we have to use the same `ratings` table to store ratings as numbers 1, 2, and 3 instead of A, B, and C:

```sql
INSERT INTO ratings (rating)
VALUES
  (1),
  (2),
  (3);
```

Consequentially, the `ratings` table stores both alphabets \& numbers.

```sql
SELECT * FROM ratings;
```

Output:

```text
 id | rating
----+--------
  1 | A
  2 | B
  3 | C
  4 | 1
  5 | 2
  6 | 3
(6 rows)
```

Now, we have to convert all values in the `rating` column into integers, all other A, B, C ratings will be displayed as zero.

To achieve this, you can use the [`CASE`](../postgresql-plpgsql/plpgsql-case-statement) expression with the type `CAST` as shown in the following query:

```
SELECT
  id,
  CASE WHEN rating~E'^\\d+$' THEN CAST (rating AS INTEGER) ELSE 0 END as rating
FROM
  ratings;
```

Output:

```
 id | rating
----+--------
  1 |      0
  2 |      0
  3 |      0
  4 |      1
  5 |      2
  6 |      3
(6 rows)
```

In this example:

- `rating ~ E'^\\d+$'`: This expression matches the values in the rating column with a regular expression `E'^\\d+$'`. The pattern checks if a value contains only digits (`\d+`) from the beginning (`^`) to the end (`$`). The letter `E` before the string indicates is an escape string.
- If the value contains only digits, the `CAST()` function converts it to an integer. Otherwise, it returns zero.

In this tutorial, you have learned how to use PostgreSQL `CAST` to convert a value of one type to another.


# Administration

---
title: 'PostgreSQL Administration'
page_title: 'PostgreSQL Administration'
page_description: 'PostgreSQL administration covers common database administrative tasks including role and database management, backup, and restore.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/'
ogImage: ''
updatedOn: '2024-02-22T07:13:56+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL JSON Index'
  slug: 'postgresql-indexes/postgresql-json-index'
nextLink:
  title: 'PostgreSQL CREATE DATABASE'
  slug: 'postgresql-administration/postgresql-create-database'
---

The **PostgreSQL administration** covers the most important PostgreSQL database server administration tasks.

## Section 1\. Managing Databases

In this section, you will learn how to manage databases in PostgreSQL including creating databases, modifying existing database features, and deleting databases.

- [Create Database](postgresql-administration/postgresql-create-database 'PostgreSQL CREATE DATABASE') – create a new database using `CREATE DATABASE` statement.
- [Alter Database](postgresql-administration/postgresql-alter-database 'PostgreSQL ALTER DATABASE') – modify the features of an existing database using the `ALTER DATABASE` statement.
- [Rename Database](postgresql-administration/postgresql-rename-database) – change the name of the database to a new one.
- [Drop Database](postgresql-administration/postgresql-drop-database 'PostgreSQL DROP DATABASE') – remove a database permanently using the `DROP DATABASE` statement.
- [Copy a Database](postgresql-administration/postgresql-copy-database) – copy a database within a database server or from one server to another.
- [Get Database Object Sizes](postgresql-administration/postgresql-database-indexes-table-size) – introduce you to various handy functions to get the database size, table, and indexes.

## Section 2\. Managing Schemas

- [Schema](postgresql-administration/postgresql-schema) – introduce the schema concept and explain how the schema search path works in PostgreSQL.
- [Create Schema](postgresql-administration/postgresql-create-schema) – show you how to create a new schema in a database.
- [Alter Schema](postgresql-administration/postgresql-alter-schema) – rename a schema or change its owner to the new one.
- [Drop schema](postgresql-administration/postgresql-drop-schema) – delete one or more schemas with their objects from a database.

## Section 3\. Managing Tablespaces

PostgreSQL tablespaces allow you to control how data is stored in the file system. The tablespaces are very useful in many cases such as managing large tables and improving database performance.

- [Creating Tablespaces](postgresql-administration/postgresql-create-tablespace 'PostgreSQL Creating Tablespaces') – introduce you to PostgreSQL tablespaces and shows you how to create tablespaces by using `CREATE TABLESPACE` statement.
- [Changing Tablespaces](postgresql-administration/postgresql-alter-tablespace 'PostgreSQL ALTER TABLESPACE') – show you how to rename, change owner, and set the parameter for a tablespace by using `ALTER TABLESPACE` statement.
- [Delete Tablespaces](postgresql-administration/postgresql-drop-tablespace 'Deleting Tablespaces Using PostgreSQL DROP TABLESPACE Statement') – learn how to delete tablespaces by using `DROP TABLESPACE` statement.

## Section 4\. Roles \& Privileges

PostgreSQL represents user accounts as roles. Roles that can log in are called login roles or users. Roles that contain other roles are called group roles. In this section, you will learn how to manage roles and groups effectively.

- [Create role](postgresql-administration/postgresql-roles 'PostgresQL Roles Management') – introduce you to the concept of the role and show you how to create roles and groups.
- [Grant](postgresql-administration/postgresql-grant) – show you how to grant privileges on database objects to a role.
- [Revoke](postgresql-administration/postgresql-revoke) – guide you on revoking granted privileges on database objects from a role.
- [Alter role](postgresql-administration/postgresql-alter-role) – show you how to use the alter role statement to modify the attributes of roles, rename roles, and set the configuration parameters.
- [Drop role](postgresql-administration/postgresql-drop-role) – learn how to drop a role, especially one with dependent objects.
- [Role membership](postgresql-administration/postgresql-role-membership) – learn how to create group roles to manage role membership better.
- [SET ROLE](postgresql-administration/postgresql-set-role) – show you how to temporarily switch the current role to one of its group roles using the SET ROLE statement.
- [CURRENT_USER](postgresql-administration/postgresql-current_user) – discover how to get the currently logged\-in user and show you the difference between current_user and session_user.
- [List roles](postgresql-administration/postgresql-list-users) – show you how to list all roles on the PostgreSQL server.
- [Superuser](postgresql-administration/create-superuser-postgresql) – learn about a special role called superuser in PostgreSQL.
- [Row\-level Security](postgresql-administration/postgresql-row-level-security) – show you how to use row\-level security (RLS) to restrict rows returned by a query based on a condition.

## Section 5\. Backup \& Restore Databases

This section shows you how to use various PostgreSQL backup and restore tools including `pg_dump`, `pg_dumpall`, `psql`,  `pg_restore` and  `pgAdmin` to backup and restore databases.

- [Backup](postgresql-administration/postgresql-backup-database 'PostgreSQL Backup') – introduce you to practical ways to perform a logical backup of a database or all databases in a PostgreSQL cluster using the `pg_dump` and `pg_dumpall` tools.
- [Restore](postgresql-administration/postgresql-restore-database 'PostgreSQL Restore Database') –  show how to restore a PostgreSQL database from an archive file using the `pg_restore` tool.

## Section 6\. PostgreSQL Tips

- [Reset Password](postgresql-administration/postgresql-reset-password) – show you how to reset the forgotten password of the postgres user.
- [psql Commands](postgresql-administration/psql-commands) – give you the most common psql command to help you query data from PostgreSQL faster and more effectively.
- [Describe Table](postgresql-administration/postgresql-describe-table) – get information on a particular table.
- [Show Databases](postgresql-administration/postgresql-show-databases) – list all databases in the current database server
- [Show Tables](postgresql-administration/postgresql-show-tables) – show all tables in the current database.


# Manage Databases

# Create Database

---
title: 'PostgreSQL CREATE DATABASE'
page_title: 'PostgreSQL CREATE DATABASE Statement'
page_description: 'This tutorial shows you how to use the PostgreSQL CREATE DATABASE statement to create new databases with various options.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-create-database/'
ogImage: '/postgresqltutorial/PostgreSQL-Create-Database-pgAdmin-Step-1.png'
updatedOn: '2024-02-16T13:35:08+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Administration'
  slug: 'postgresql-administration/'
nextLink:
  title: 'PostgreSQL ALTER DATABASE'
  slug: 'postgresql-administration/postgresql-alter-database'
---

**Summary**: in this tutorial, you will learn how to use the **PostgreSQL CREATE DATABASE** statement to create new databases in the PostgreSQL server.

## Introduction to PostgreSQL CREATE DATABASE statement

In PostgreSQL, a database is a collection of related data, which serves as a container for tables, [indexes](../postgresql-indexes/postgresql-index-types), [views](../postgresql-views), and other database objects.

To create a new database, you use the `CREATE DATABASE` statement.

Here’s the basic syntax of the `CREATE DATABASE` statement:

```sql
CREATE DATABASE database_name
WITH
   [OWNER =  role_name]
   [TEMPLATE = template]
   [ENCODING = encoding]
   [LC_COLLATE = collate]
   [LC_CTYPE = ctype]
   [TABLESPACE = tablespace_name]
   [ALLOW_CONNECTIONS = true | false]
   [CONNECTION LIMIT = max_concurrent_connection]
   [IS_TEMPLATE = true | false ];
```

In this syntax:

- First, specify the name of the new database that you want to create after the `CREATE DATABASE` keywords. The database name must be unique in the PostgreSQL server. If you attempt to create a database whose name already exists, PostgreSQL will issue an error.
- Then, use one or more parameters for the new database.

### Parameters

**OWNER**

Assign a [role](postgresql-roles) that will be the owner of the database. If you omit the `OWNER` option, the database owner is the role you use to execute the `CREATE DATABASE` statement.

**TEMPLATE**

Specify the template database for the new database. PostgreSQL uses the `template1` database as the default template database if you don’t explicitly specify the template database.

**ENCODING**

Determine the character set for the new database.

**LC_COLLATE**

Specify the collation order (`LC_COLLATE`) that the new database will use. This parameter affects the sort order of strings in queries that contain the [`ORDER BY`](../postgresql-tutorial/postgresql-order-by) clause. It defaults to the `LC_COLLATE` of the template database.

**LC_CTYPE**

Specify the character classification that the new database will use. It affects the classification of characters such as lower, upper, and digit. It defaults to the `LC_CTYPE` of the template database

**TABLESPACE**

Specify the [tablespace](postgresql-create-tablespace) name for the new database. The default is the tablespace of the template database.

**CONNECTION LIMIT**

Specify the maximum concurrent connections to the new database. The default is \-1 which means unlimited. This parameter can be useful in shared hosting environments where you can configure the maximum concurrent connections for a particular database.

**ALLOW_CONNECTIONS**

The `allow_connections` parameter is a boolean value. If it is `false`, you cannot connect to the database.

**TABLESPACE**

Specify the [tablespace](postgresql-create-tablespace) that the new database will use. It defaults to the tablespace of the template database.

**IS_TEMPLATE**

If the `IS_TEMPLATE` is true, any user with the `CREATEDB` privilege can clone it. If false, only superusers or the database owner can clone it.

To execute the `CREATE DATABASE` statement, you need to have a superuser role or a special `CREATEDB` privilege.

## PostgreSQL CREATE DATABASE examples

Let’s explore some examples of using the `CREATE DATABASE` statement.

### 1\) Create a database with default parameters

First, open the Command Prompt on Windows or Terminal on Unix\-like systems and connect to the PostgreSQL server:

```bash
psql -U postgres
```

Second, execute the `CREATE DATABASE` statement to a new database with default parameters:

```
CREATE DATABASE sales;
```

Output:

```php
CREATE DATABASE
```

PostgreSQL will create a new database called `sales` that has default parameters from the default template database (`template1`).

Third, show all the databases using the `\l` command:

```
\l
```

Output:

```
                                                                      List of databases
   Name    |  Owner   | Encoding | Locale Provider |          Collate           |           Ctype            | ICU Locale | ICU Rules |   Access privileges
-----------+----------+----------+-----------------+----------------------------+----------------------------+------------+-----------+-----------------------
 dvdrental | postgres | UTF8     | libc            | English_United States.1252 | English_United States.1252 |            |           |
 postgres  | postgres | UTF8     | libc            | English_United States.1252 | English_United States.1252 |            |           |
 tempdb    | postgres | UTF8     | libc            | English_United States.1252 | English_United States.1252 |            |           |
 template0 | postgres | UTF8     | libc            | English_United States.1252 | English_United States.1252 |            |           | =c/postgres          +
           |          |          |                 |                            |                            |            |           | postgres=CTc/postgres
 template1 | postgres | UTF8     | libc            | English_United States.1252 | English_United States.1252 |            |           | =c/postgres          +
           |          |          |                 |                            |                            |            |           | postgres=CTc/postgres
(5 rows)
```

Alternatively, you can retrieve the database names from the `pg_database` view:

```sql
SELECT datname FROM pg_database;
```

Output:

```
  datname
-----------
 postgres
 dvdrental
 template1
 template0
 tempdb
 sales
(6 rows)
```

### 2\) Create a database with options

The following example uses the `CREATE DATABASE` statement to create a database named `hr` with some parameters:

```
CREATE DATABASE hr
WITH
   ENCODING = 'UTF8'
   CONNECTION LIMIT = 100;
```

This statement creates a database called `hr` with the encoding UTF8 and the number of concurrent connections to the database is 100\.

### 3\) Creating a new database using pgAdmin

The pgAdmin tool provides an intuitive interface for creating a new database.

First, connect to the PostgreSQL database server using pgAdmin.

Second, right\-click the **Databases** node and select **Create \> Database…** menu item

![](/postgresqltutorial/PostgreSQL-Create-Database-pgAdmin-Step-1.png)It will show a dialog to enter detailed information on the new database.

Third, enter the name of the database and select an owner in the general tab.

![](/postgresqltutorial/PostgreSQL-Create-Database-pgAdmin-Step-2.png)
In this example, we create a new database called `sampledb` and owner `postgres`.

Fourth, select the **Definition** tab to set the properties for the database:

![](/postgresqltutorial/PostgreSQL-Create-Database-pgAdmin-Step-3.png)
In the **Definition** tab, you can select the encoding, a template, tablespace, collation, character type, and connection limit.

The **Security** tab allows you to define security labels and assign privileges. The **Privileges** tab allows you to assign privileges to a role.

Fifth, click the SQL tab to view the generated SQL statement that will execute.

![](/postgresqltutorial/PostgreSQL-Create-Database-pgAdmin-Step-4.png)
Finally, click the **Save** button to create the `sampledb` database. You will see the `sampledb` listed on the database list:

![](/postgresqltutorial/PostgreSQL-Create-Database-pgAdmin-Step-5.png)

## Summary

- Use the `CREATE DATABASE` statement to create a new database.


# Alter Database

---
title: 'PostgreSQL ALTER DATABASE'
page_title: 'PostgreSQL ALTER DATABASE Statement By Practical Examples'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL ALTER DATABASE to modify an existing database.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-alter-database/'
ogImage: ''
updatedOn: '2024-02-12T12:18:32+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CREATE DATABASE'
  slug: 'postgresql-administration/postgresql-create-database'
nextLink:
  title: 'PostgreSQL DROP DATABASE'
  slug: 'postgresql-administration/postgresql-drop-database'
---

**Summary**: in this tutorial, you will learn how to modify existing databases by using **PostgreSQL ALTER DATABASE** statement.

## Introduction to PostgreSQL ALTER DATABASE statement

The `ALTER DATABASE` statement allows you to carry the following action on the database:

- Change the attributes of the database
- Rename the database
- Change the owner of the database
- Change the default tablespace of a database
- Change the session default for a run\-time configuration variable for a database

### 1\) Changing attributes of a database

To change the attributes of a database, you use the following form of the `ALTER TABLE` statement:

```sql
ALTER DATABASE name WITH option;
```

The option can be:

- `IS_TEMPLATE`
- `CONNECTION LIMIT`
- `ALLOW_CONNECTIONS`

Note that only superusers or database owners can change these settings.

### 2\) Rename the database

The following `ALTER DATABASE RENAME TO` statement renames a database:

```sql
ALTER DATABASE database_name
RENAME TO new_name;
```

It is not possible to rename the current database. So, you need to connect to another database and rename it from that database.

Only superusers and database owners with CREATEDB privilege can rename the database.

### 3\) Change the owner of the database

The following `ALTER DATABASE` statement changes the owner of a database to the new one:

```sql
ALTER DATABASE database_name
OWNER TO new_owner | current_user | session_user;
```

The following users can change the owner of the database:

- The database owner with `CREATEDB` privilege and is a direct or indirect member of the new owning role.
- The superusers

### 4\) Change the default tablespace of a database

The following statement changes the default [tablespace](postgresql-create-tablespace 'PostgreSQL Creating Tablespaces') of the database:

```sql
ALTER DATABASE database_name
SET TABLESPACE new_tablespace;
```

The statement physically moves tables and indexes from the legacy tablespace to the new one.

To set the new tablespace, the tablespace needs to be empty and there is a connection to the database.

Superusers and database owners can change the default tablespace of the database

### 5\) Change session defaults for run\-time configuration variables

Whenever you connect to a database, PostgreSQL loads the configuration variables from the `postgresql.conf` file and uses these variables by default.

To override these settings for a particular database, you use `ALTER DATABASE SET` statement as follows:

```sql
ALTER DATABASE database_name
SET configuration_parameter = value;
```

In the subsequent sessions, PostgreSQL will override the settings in the `postgresql.conf` file.

Only superusers or database owners can change the session default for a run\-time configuration for the database.

## PostgreSQL ALTER DATABASE examples

First, log in to PostgreSQL using the `postgres` user and [create a new database](postgresql-create-database 'PostgreSQL CREATE DATABASE') named `testdb2` for the demonstration.

```sql
CREATE DATABASE testdb2;
```

Second, rename the `testdb2` to `testhrdb` using the following statement:

```sql
ALTER DATABASE testdb2
RENAME TO testhrdb;
```

Third, execute the following statement to change the owner of the `testhrdb`database from `postgres`to `hr`, with the assumption that the `hr` role already exists.

```sql
ALTER DATABASE testhrdb
OWNER TO hr;
```

If the `hr` role does not exist, you can create it by using the [`CREATE ROLE`](postgresql-roles) statement:

```sql
CREATE ROLE hr
LOGIN
CREATEDB
PASSWORD 'securePa$$1';
```

Fourth, change the default tablespace of the `testhrdb`from `pg_default` to `hr_default`, with the assumption that the `hr_default` tablespace already exists.

```sql
ALTER DATABASE testhrdb
SET TABLESPACE hr_default;
```

If the `hr_default` tablespace does not exist, you can create it by using the following statement:

```sql
CREATE TABLESPACE hr_default
OWNER hr
LOCATION 'C:\\sampledb\\hr';
```

Fifth, set `escape_string_warning`configuration variable to `off` by using the following statement:

```sql
ALTER DATABASE testhrdb
SET escape_string_warning = off;
```

In this tutorial, you have learned how to use the PostgreSQL `ALTER DATABASE` statement.


# Rename Database

---
title: 'PostgreSQL Rename Database'
page_title: 'PostgreSQL Rename Database: A Quick Guide'
page_description: 'In this tutorial, you will learn step by step how to rename a PostgreSQL database by using the ALTER TABLE RENAME TO statement.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-rename-database/'
ogImage: ''
updatedOn: '2024-02-12T12:21:09+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL DROP DATABASE'
  slug: 'postgresql-administration/postgresql-drop-database'
nextLink:
  title: 'PostgreSQL Copy Database Made Easy'
  slug: 'postgresql-administration/postgresql-copy-database'
---

**Summary**: in this tutorial, you will learn step\-by\-step how to rename a PostgreSQL database using the `ALTER DATABASE...RENAME TO` statement.

## PostgreSQL rename database steps

To rename a PostgreSQL database, you use the following steps:

- First, change the current database from the one that you want to rename to a different one.
- Second, terminate all active connections to the database that you want to rename.
- Third, use the [`ALTER DATABASE`](postgresql-alter-database) statement to rename the database to the new one.

Let’s take a look at an example of renaming a database.

First, open the Command Prompt on Windows or Terminal on a Unix\-like system and connect to the PostgreSQL server:

```sqlsql
psql -U postgres
```

Second, create a new database called db:

```
CREATE DATABASE db;
```

We’ll rename the `db` database to `newdb`:

Third, if you are already connected to the PostgreSQL server, you can change the current database to a different one, for example, postgres:

```
\c postgres
```

Fourth, retrieve all active connections to the `db` database:

```sql
SELECT  *
FROM pg_stat_activity
WHERE datname = 'db';
```

The query returned the following output:

```shell
-[ RECORD 1 ]----+------------------------------
datid            | 35918
datname          | db
pid              | 6904
usesysid         | 10
usename          | postgres
application_name | psql
client_addr      | ::1
client_hostname  |
client_port      | 56412
backend_start    | 2017-02-21 08:25:05.083705+07
xact_start       |
query_start      |
state_change     | 2017-02-21 08:25:05.092168+07
waiting          | f
state            | idle
backend_xid      |
backend_xmin     |
query            |

```

The output shows one connection to the `db` database.

In practice, a database may have many active connections. In this case, you need to inform the respective users as well as the application owners before terminating connections to avoid data loss.

Fifth, terminate all the connections to the `db` database:

```
SELECT
    pg_terminate_backend (pid)
FROM
    pg_stat_activity
WHERE
    datname = 'db';
```

Sixth, rename the `db` database to `newdb` using the `ALTER DATABASE RENAME TO` statement:

```sql
ALTER DATABASE db RENAME TO newdb;
```

## Summary

- Use the `ALTER DATABASE RENAME TO` statement to rename a database from the PostgreSQL server.


# Drop Database

---
title: 'PostgreSQL DROP DATABASE'
page_title: 'PostgreSQL DROP DATABASE Statement'
page_description: 'In this tutorial, you will learn how to use the DROP DATABASE statement to drop a database from a PostgreSQL server.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-drop-database/'
ogImage: ''
updatedOn: '2024-02-19T00:53:42+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL ALTER DATABASE'
  slug: 'postgresql-administration/postgresql-alter-database'
nextLink:
  title: 'PostgreSQL Rename Database'
  slug: 'postgresql-administration/postgresql-rename-database'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `DROP DATABASE` statement to drop a database.

## Introduction to PostgreSQL DROP DATABASE statement

The `DROP DATABASE` statement deletes a database from a PostgreSQL server.

Here’s the basic syntax of the `DROP DATABASE` statement:

```httpsqlsql
DROP DATABASE [IF EXISTS] database_name
[WITH (FORCE)]
```

In this syntax:

- First, specify the database name that you want to remove after the `DROP DATABASE` keywords.
- Second, if you delete a non\-existing database, PostgreSQL will issue an error. To prevent the error, you can use the `IF EXISTS` option. In this case, PostgreSQL will issue a notice instead.
- Third, the `DROP DATABASE` statement will fail if there are active connections to the target database unless you use the `FORCE` option. The `FORCE` option will attempt to terminate all existing connections to the target database.

The `DROP DATABASE` statement deletes the database from both catalog entry and data directory. Since PostgreSQL does not allow you to roll back this operation, you should use it with caution.

To execute the `DROP DATABASE` statement, you need to be the database owner.

Additionally, you cannot execute the `DROP DATABASE` statement while connecting to the target database. In this case, you can connect to the default `postgres` database or use the `dropdb` utility before executing the `DROP DATABASE` statement.

The `dropdb` is a command\-line utility that allows you to drop a database. The `dropdb` program executes the `DROP DATABASE` statement behind the scenes.

## PostgreSQL DROP DATABASE statement examples

Let’s take some examples of using the `DROP DATABASE` statement.

### Setting up sample databases

We’ll create some databases for the demonstration purposes:

```sql
CREATE DATABASE hr;
CREATE DATABASE test;
```

### 1\) Basic DROP DATABASE statement example

First, open Command Prompt on Windows or Terminal on Unix\-like systems and connect to the PostgreSQL server using psql:

```bash
psql -U postgres
```

Second, drop the database `hr` using the following `DROP DATABASE` statement:

```
DROP DATABASE hr;
```

### 2\) Removing a non\-existing database example

The following example attempts to drop a database that does not exist:

```sql
DROP DATABASE non_existing_database;
```

PostgreSQL will issue the following error:

```
ERROR:  database "non_existing_database" does not exist
```

If you use the `IF EXISTS` option, PostgreSQL will issue a notice instead:

```sql
DROP DATABASE IF EXISTS non_existing_database;
```

Output:

```
NOTICE:  database "non_existing_database" does not exist, skipping
DROP DATABASE
```

### 3\) Drop a database that has active connections example

First, establish a connection to the PostgreSQL server using the `psql` tool:

```
psql -U postgres
```

Next, open the second connection to the PostgreSQL server. You can use psql, pgAdmin, or any PostgreSQL client tool.

Then, attempt to delete the `test` database from the first session:

```
DROP DATABASE test;
```

PostgreSQL issues an error:

```sql
ERROR:  database "test" is being accessed by other users
DETAIL:  There is 1 other session using the database.
```

The output indicates that the `test` database is being accessed by other users.

To drop the database that has active connections, you can use the `FORCE` option.

After that, find the connections to the `test` database by retrieving data from the `pg_stat_activity` view:

```
SELECT
  datname,
  pid,
  usename,
  application_name,
  client_addr,
  client_port
FROM
  pg_stat_activity
WHERE
  datname = 'test';
```

Output:

```text
 datname | pid  | usename  | application_name | client_addr | client_port
---------+------+----------+------------------+-------------+-------------
 test    | 9724 | postgres | psql             | 127.0.0.1   |       61287
(1 row)
```

The `test` database has one connection from `localhost`. Therefore, it’s safe to terminate this connection and remove the database.

Finally, terminate the connections to the `test` database and drop it using the `WITH (FORCE)` option:

```
DROP DATABASE test WITH (FORCE)
```

Output:

```
DROP DATABASE
```

## Summary

- Use the PostgreSQL `DROP DATABASE` statement to drop a database.


# Copy a Database

---
title: 'PostgreSQL Copy Database Made Easy'
page_title: 'PostgreSQL Copy Database Made Easy'
page_description: 'You will learn how to copy a PostgreSQL database on the same database server or from a server to another. PostgreSQL copy database made easy.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-copy-database/'
ogImage: '/postgresqltutorial/postgresql-copy-database.jpg'
updatedOn: '2024-02-12T15:16:13+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Rename Database'
  slug: 'postgresql-administration/postgresql-rename-database'
nextLink:
  title: 'How to Get Sizes of Database Objects in PostgreSQL'
  slug: 'postgresql-administration/postgresql-database-indexes-table-size'
---

**Summary**: in this tutorial, you will learn how to copy a PostgreSQL database on the same server or from one server to another.

![](/postgresqltutorial/postgresql-copy-database.jpg)

## PostgreSQL copy database within the same server

Sometimes, you want to copy a PostgreSQL database within a database server for testing purposes.

PostgreSQL makes it easy to do so via the [`CREATE DATABASE`](https://www.postgrepgsqltutorial.com/postgrepgsql-create-database/) statement, as follows:

```sqlsql
CREATE DATABASE targetdb
WITH TEMPLATE sourcedb;
```

This statement copies the `sourcedb` to the `targetdb`. For example, to copy the `dvdrental` [sample database](https://www.postgrepgsqltutorial.com/postgrepgsql-sample-database/) to the `dvdrental_test` database, you use the following statement:

```sql
CREATE DATABASE dvdrental_test
WITH TEMPLATE dvdrental;
```

Depending on the [size of the source database](https://www.postgrepgsqltutorial.com/postgrepgsql-database-indexes-table-size/), copying may take some time to complete.

If the `dvdrental` database has active connections, you will encounter the following error:

```http
ERROR:  source database "dvdrental" is being accessed by other users
DETAIL:  There is 1 other session using the database.
```

The following query returns the active connections:

```sql
SELECT pid, usename, client_addr
FROM pg_stat_activity
WHERE datname ='dvdrental';
```

To terminate the active connections to the `dvdrental` database, you use the following query:

```sql
SELECT pg_terminate_backend (pid)
FROM pg_stat_activity
WHERE datname = 'dvdrental';
```

After that, you can execute the `CREATE DATABASE WITH TEMPLATE` statement again to copy the `dvdrental` database to `dvdrental_test` database.

## PostgreSQL copy database from one server to another

There are several ways to copy a database between PostgreSQL database servers.

If the size of the source database is big and the connection between the database servers is slow, you can dump the source database to a file, copy the file to the remote server, and restore it:

First, dump the source database into a file.

```
pg_dump -U postgres -d sourcedb -f sourcedb.sql
```

Second, copy the dump file to the remote server.

Third, create a new database in the remote server:

```sql
CREATE DATABASE targetdb;
```

Finally, restore the dump file on the remote server:

```bash
psql -U postgres -d targetdb -f sourcedb.sql
```

### Copying the dvdrental database example

The following steps illustrate how to copy the `dvdrental` database from the local server to the `remote` server.

First, dump the `dvdrental` database into a dump file such as `dvdrental.sql`:

```sql
pg_dump -U postgres -O dvdrental -f dvdrental.sql
```

Second, copy the dump file to the `remote` server.

Third, create the `dvdrental` database on the `remote` server:

```sql
CREATE DATABASE dvdrental;
```

Fourth, restore the `dvdrental.sql` dump file in the `remote` server:

```bash
psql -U postgres -d dvdrental -f dvdrental.sql
```

If the connection between the servers is fast and the size of the database is not big, you can use the following command:

```shell
pg_dump -C -h local -U localuser sourcedb | psql -h remote -U remoteuser targetdb
```

For example, to copy the `dvdrental` database from the `localhost` server to the `remote` server, you can execute the following command:

```shell
pg_dump -C -h localhost -U postgres dvdrental | psql -h remote -U postgres dvdrental

```

In this tutorial, you have learned how to copy a PostgreSQL database within a database server, or from one database server to another.


# Get Database Object Sizes

---
title: 'How to Get Sizes of Database Objects in PostgreSQL'
page_title: 'How to Get Sizes of Database Objects in PostgreSQL'
page_description: 'This tutorial shows you how to get the sizes of database objects including databases, tables, indexes, tablespaces, and values.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-database-indexes-table-size/'
ogImage: ''
updatedOn: '2024-02-19T04:10:36+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Copy Database Made Easy'
  slug: 'postgresql-administration/postgresql-copy-database'
nextLink:
  title: 'How to Change the Owner of a PostgreSQL Database'
  slug: 'postgresql-administration/postgres-change-database-owner'
---

**Summary**: in this tutorial, you will learn how to get the sizes of database objects including databases, tables, indexes, tablespaces, and values.

## Getting PostgreSQL table sizes

To get the size of a specific table, you use the `pg_relation_size()` function. For example, you can get the size of the `actor` table in the `dvdrental` [sample database](../postgresql-getting-started/postgresql-sample-database) as follows:

```sql
select pg_relation_size('actor');
```

The `pg_relation_size()` function returns the size of a specific table in bytes:

```sql
pg_relation_size
------------------
            16384

```

To make the result more human\-readable, you use the `pg_size_pretty()` function.

The `pg_size_pretty()` function formats a number using bytes, kB, MB, GB, or TB appropriately. For example:

```sql
SELECT
    pg_size_pretty (pg_relation_size('actor')) size;
```

The following is the output in kB

```text
 size
-------
 16 kB
(1 row)
```

Note that the `pg_relation_size()` function returns the size of the table only, not including indexes or additional objects.

To get the total size of a table, you use the `pg_total_relation_size()` function. For example, the following statement uses the `pg_total_relation_size()` to retrieve the total size of the `actor` table:

```sql
SELECT
    pg_size_pretty (
        pg_total_relation_size ('actor')
    ) size;
```

The following shows the output:

```text
 size
-------
 72 kB
(1 row)
```

You can use the `pg_total_relation_size()` function to find the size of the biggest tables including indexes.

For example, the following query returns the top 5 biggest tables in the `dvdrental` database:

```sql
SELECT
    relname AS "relation",
    pg_size_pretty (
        pg_total_relation_size (C .oid)
    ) AS "total_size"
FROM
    pg_class C
LEFT JOIN pg_namespace N ON (N.oid = C .relnamespace)
WHERE
    nspname NOT IN (
        'pg_catalog',
        'information_schema'
    )
AND C .relkind <> 'i'
AND nspname !~ '^pg_toast'
ORDER BY
    pg_total_relation_size (C .oid) DESC
LIMIT 5;
```

Here is the output:

```text
  relation  | total_size
------------+------------
 rental     | 2352 kB
 payment    | 1816 kB
 film       | 936 kB
 film_actor | 488 kB
 inventory  | 440 kB
(5 rows)
```

## Getting PostgreSQL database sizes

To get the size of the whole database, you use the `pg_database_size()` function. For example, the following statement returns the size of the `dvdrental` database:

```sql
SELECT
    pg_size_pretty (
        pg_database_size ('dvdrental')
    ) size;
```

The statement returns the following result:

```text
 size
-------
 15 MB
(1 row)

```

To get the size of each database in the current database server, you use the following statement:

```sql
SELECT
    pg_database.datname,
    pg_size_pretty(pg_database_size(pg_database.datname)) AS size
FROM pg_database;
```

Output:

```text
  datname  |  size
-----------+---------
 postgres  | 8452 kB
 template1 | 7892 kB
 template0 | 7681 kB
 dvdrental | 15 MB
(4 rows)
```

## Getting PostgreSQL index sizes

To get the total size of all indexes attached to a table, you use the `pg_indexes_size()` function.

The `pg_indexes_size()` function accepts the OID or table name as the argument and returns the total disk space used by all indexes attached to that table.

For example, to get the total size of all indexes attached to the `film` table, you use the following statement:

```
SELECT
    pg_size_pretty (pg_indexes_size('actor')) size;
```

Here is the output:

```text
 size
-------
 32 kB
(1 row)
```

## Getting PostgreSQL tablespace sizes

To get the size of a tablespace, you use the `pg_tablespace_size()` function.

The `pg_tablespace_size()` function accepts a tablespace name and returns the size in bytes. For example, the following statement returns the size of the `pg_default` tablespace:

```sql
SELECT
    pg_size_pretty (
        pg_tablespace_size ('pg_default')
    ) size;
```

Output:

```text
 size
-------
 48 MB
(1 row)
```

## Getting PostgreSQL value sizes

To find how much space is needed to store a specific value, you use the pg_column_size() function, for example:

```sql
SELECT
  pg_column_size(5 :: smallint) smallint_size,
  pg_column_size(5 :: int) int_size,
  pg_column_size(5 :: bigint) bigint_size;
```

Output:

```text
 smallint_size | int_size | bigint_size
---------------+----------+-------------
             2 |        4 |           8
(1 row)
```

## Summary

- Use the `pg_size_pretty()` function to format the size.
- Use the `pg_relation_size()` function to get the size of a table.
- Use the `pg_total_relation_size()` function to get the total size of a table.
- Use the `pg_database_size()` function to get the size of a database.
- Use the `pg_indexes_size()` function to get the size of an index.
- Use the `pg_total_index_size()` function to get the size of all indexes on a table.
- Use the `pg_tablespace_size()` function to get the size of a tablespace.
- Use the `pg_column_size()` function to obtain the size of a column of a specific type.


# Manage Schemas

# Schema

---
title: 'PostgreSQL Schema'
page_title: 'An Essential Guide to PostgreSQL Schema'
page_description: 'In this tutorial, you will learn what a PostgreSQL schema is and how PostgreSQL uses the schema search path to resolve objects in schemas.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-schema/'
ogImage: '/postgresqltutorial/PostgreSQL-Schema-Example.png'
updatedOn: '2024-02-12T12:30:41+00:00'
enableTableOfContents: true
previousLink:
  title: 'How to Change the Owner of a PostgreSQL Database'
  slug: 'postgresql-administration/postgres-change-database-owner'
nextLink:
  title: 'PostgreSQL CREATE SCHEMA'
  slug: 'postgresql-administration/postgresql-create-schema'
---

**Summary**: in this tutorial, you will learn about PostgreSQL schema and how to use the schema search path to resolve objects in schemas.

## Introduction to PostgreSQL schema

In PostgreSQL, a schema is a named collection of database objects, including tables, [views](../postgresql-views), [indexes](../postgresql-indexes), [data types](../postgresql-tutorial/postgresql-data-types), [functions](../postgresql-plpgsql/postgresql-create-function), [stored procedures](../postgresql-plpgsql/postgresql-create-procedure), and operators.

A schema allows you to organize and namespace database objects within a database.

To access an object in a schema, you need to qualify the object by using the following syntax:

```css
schema_name.object_name
```

A database may contain one or more schemas. However, a schema belongs to only one database. Additionally, two schemas can have different objects that share the same name.

For example, you may have `sales` schema that has `staff` table and the `public` schema which also has the `staff` table. When you refer to the `staff` table you must qualify it as follows:

```css
public.staff
```

Or

```css
sales.staff
```

Schemas can be very useful in the following scenarios:

- Schemas allow you to organize database objects e.g., tables into logical groups to make them more manageable.
- Schemas enable multiple users to use one database without interfering with each other.

## The public schema

PostgreSQL automatically creates a schema called `public` for every new database. Whatever object you create without specifying the schema name, PostgreSQL will place it into this `public` schema. Therefore, the following statements are equivalent:

```css
CREATE TABLE table_name(
  ...
);
```

and

```
CREATE TABLE public.table_name(
   ...
);
```

## The schema search path

In practice, you will refer to a table without its schema name e.g., `staff` table instead of a fully qualified name such as `sales.staff` table.

When you reference a table using its name only, PostgreSQL searches for the table by using the **schema search path**, which is a list of schemas to look in.

PostgreSQL will access the first matching table in the schema search path. If there is no match, it will return an error, even if the name exists in another schema in the database.

The first schema in the search path is called the current schema. Note that when you create a new object without explicitly specifying a schema name, PostgreSQL will also use the current schema for the new object.

The `current_schema()` function returns the current schema:

```php
SELECT current_schema();
```

Here is the output:

```
 current_schema
----------------
public
(1 row)
```

This is why PostgreSQL uses `public` for every new object that you create.

To view the current search path, you use the `SHOW` command in `psql` tool:

```php
SHOW search_path;
```

The output is as follows:

```
 search_path
-----------------
"$user", public
(1 row)
```

In this output:

- The `"$user"` specifies that the first schema that PostgreSQL will use to search for the object, which has the same name as the current user. For example, if you use the `postgres` user to log in and access the `staff` table. PostgreSQL will search for the `staff` table in the `postgres` schema. If it cannot find any object like that, it continues to look for the object in the `public` schema.
- The second element refers to the `public` schema as we have seen before.

To create a new schema, you use the `CREATE SCHEMA` statement:

```php
CREATE SCHEMA sales;
```

To add the new schema to the search path, you use the following command:

```
SET search_path TO sales, public;
```

Now, if you create a new table named `staff` without specifying the schema name, PostgreSQL will put this `staff` table into the `sales` schema:

```php
CREATE TABLE staff(
    staff_id SERIAL PRIMARY KEY,
    first_name VARCHAR(45) NOT NULL,
    last_name VARCHAR(45) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE
);
```

The following picture shows the new schema `sales` and the `staff` table that belongs to the `sales` schema:

![PostgreSQL Schema Example](/postgresqltutorial/PostgreSQL-Schema-Example.png)To access the `staff` table in the `sales` schema you can use one of the following statements:

```css
SELECT * FROM staff;
```

and

```
SELECT * FROM sales.staff;
```

The `public` schema is the second element in the search path, so to access the `staff` table in the public schema, you must qualify the table name as follows:

```css
SELECT * FROM public.staff;
```

If you use the following command, you will need to explicitly refer to objects in the `public` schema using a fully qualified name:

```php
SET search_path TO public;
```

The `public` schema is not a special schema, therefore, you can [drop](postgresql-drop-schema) it too.

## PostgreSQL schemas and privileges

Users can only access objects in the schemas that they own. It means they cannot access any objects in the schemas that do not belong to them.

To allow users to access the objects in the schema that they do not own, you must grant the `USAGE` privilege of the schema to the users:

```
GRANT USAGE ON SCHEMA schema_name
TO role_name;
```

To allow users to create objects in the schema that they do not own, you need to grant them the `CREATE` privilege of the schema to the users:

```
GRANT CREATE ON SCHEMA schema_name
TO user_name;
```

Note that, by default, every user has the `CREATE` and `USAGE` on the `public` schema.

## PostgreSQL schema operations

- To create a new schema, you use the [`CREATE SCHEMA`](postgresql-create-schema) statement.
- To rename a schema or change its owner, you use the [`ALTER SCHEMA`](postgresql-alter-schema) statement.
- To drop a schema, you use the [`DROP SCHEMA`](postgresql-drop-schema) statement.

## Summary

- A schema is a named collection of database objects, including tables, views, indexes, sequences, and so on.
- Use schemas to organize and namespace these objects within a database.
- Use the search path to resolve object names.


# Create Schema

---
title: 'PostgreSQL CREATE SCHEMA'
page_title: 'PostgreSQL CREATE SCHEMA Statement'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL CREATE SCHEMA statement to create a new schema in a database.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-create-schema/'
ogImage: '/postgresqltutorial/postgresql-create-schema-example.png'
updatedOn: '2024-02-12T12:34:40+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Schema'
  slug: 'postgresql-administration/postgresql-schema'
nextLink:
  title: 'PostgreSQL ALTER SCHEMA'
  slug: 'postgresql-administration/postgresql-alter-schema'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `CREATE SCHEMA` statement to create a new schema in a database.

## Introduction to PostgreSQL CREATE SCHEMA statement

The `CREATE SCHEMA` statement allows you to create a new [schema](postgresql-schema) in the current database.

The following illustrates the syntax of the `CREATE SCHEMA` statement:

```csssql
CREATE SCHEMA [IF NOT EXISTS] schema_name;
```

In this syntax:

- First, specify the name of the schema after the `CREATE SCHEMA` keywords. The schema name must be unique within the current database.
- Second, optionally use `IF NOT EXISTS` to conditionally create the new schema only if it does not exist. Attempting to create a new schema that already exists without using the `IF NOT EXISTS` option will result in an error.

Note that to execute the `CREATE SCHEMA` statement, you must have the `CREATE` privilege in the current database.

You can also create a schema for a user:

```css
CREATE SCHEMA [IF NOT EXISTS]
AUTHORIZATION username;
```

In this case, the schema will have the same name as the `username`.

PostgreSQL allows you to create a schema and a list of objects such as tables and [views](../postgresql-views) using a single statement as follows:

```css
CREATE SCHEMA schema_name
    CREATE TABLE table_name1 (...)
    CREATE TABLE table_name2 (...)
    CREATE VIEW view_name1
        SELECT select_list FROM table_name1;
```

Notice that each subcommand does not end with a semicolon (;).

## PostgreSQL CREATE SCHEMA statement examples

Let’s take some examples of using the `CREATE SCHEMA` statement.

### 1\) Basic CREATE SCHEMA statement example

The following statement uses the `CREATE SCHEMA` statement to create a new schema named `marketing`:

```
CREATE SCHEMA marketing;
```

The following statement returns all schemas from the current database:

```
SELECT *
FROM pg_catalog.pg_namespace
ORDER BY nspname;
```

This picture shows the output:

![postgresql create schema example](/postgresqltutorial/postgresql-create-schema-example.png)

### 2\) Using CREATE SCHEMA statement to create a schema for a user example

First, [create a new role](postgresql-roles) with named `john`:

```php
CREATE ROLE john
LOGIN
PASSWORD 'Postgr@s321!';
```

Second, create a schema for `john`:

```
CREATE SCHEMA AUTHORIZATION john;
```

Third, create a new schema called `doe` that will be owned by `john`:

```
CREATE SCHEMA IF NOT EXISTS doe AUTHORIZATION john;
```

### 3\) Using CREATE SCHEMA statement to create a schema and its objects example

The following example uses the `CREATE SCHEMA` statement to create a new schema named `scm`. It also creates a table named `deliveries` and a view named `delivery_due_list` that belongs to the `scm` schema:

```
CREATE SCHEMA scm
    CREATE TABLE deliveries(
        id SERIAL NOT NULL,
        customer_id INT NOT NULL,
        ship_date DATE NOT NULL
    )
    CREATE VIEW delivery_due_list AS
        SELECT ID, ship_date
        FROM deliveries
        WHERE ship_date <= CURRENT_DATE;
```

## Summary

- Use the PostgreSQL `CREATE SCHEMA` statement to create a new schema in a database.


# Alter Schema

---
title: 'PostgreSQL ALTER SCHEMA'
page_title: 'PostgreSQL ALTER SCHEMA Statement'
page_description: 'You will learn how to use the PostgreSQL ALTER SCHEMA statement to rename a schema or change the owner of a schema to a new one.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-alter-schema/'
ogImage: '/postgresqltutorial/PostgreSQL-ALTER-SCHEMA-change-owner-example.png'
updatedOn: '2024-02-12T13:22:23+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CREATE SCHEMA'
  slug: 'postgresql-administration/postgresql-create-schema'
nextLink:
  title: 'PostgreSQL DROP SCHEMA Statement'
  slug: 'postgresql-administration/postgresql-drop-schema'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `ALTER SCHEMA` statement to modify the definition of a schema.

## Introduction to PostgreSQL ALTER SCHEMA statement

The `ALTER SCHEMA` statement allows you to change the definition of a [schema](postgresql-schema). For example, you can rename a schema as follows:

```php
ALTER SCHEMA schema_name
RENAME TO new_name;
```

In this syntax:

- First, specify the name of the schema that you want to rename after the `ALTER SCHEMA` keywords.
- Second, specify the new name of the schema after the `RENAME TO` keywords.

Note that to execute this statement, you must be the owner of the schema and you must have the `CREATE` privilege for the database.

Besides renaming a schema, the `ALTER SCHEMA` also allows you to change the owner of a schema to the new one as shown in the following statement:

```
ALTER SCHEMA schema_name
OWNER TO { new_owner | CURRENT_USER | SESSION_USER};
```

In this statement:

- First, specify the name of the schema to which you want to change the owner in the `ALTER SCHEMA` clause.
- Second, specify the new owner in the `OWNER TO` clause.

## PostgreSQL ALTER SCHEMA statement examples

Let’s take some examples of using the `ALTER SCHEMA` statement to get a better understanding.

Notice that the examples in the following part are based on the schema created in the [`CREATE SCHEMA`](postgresql-create-schema) tutorial.

### 1\) Using ALTER SCHEMA statement to rename a schema examples

This example uses the `ALTER SCHEMA` statement to rename the schema `doe` to `finance`:

```
ALTER SCHEMA doe
RENAME TO finance;
```

Similarly, the following example renames the `john` schema to accounting:

```
ALTER SCHEMA john
RENAME TO accounting;
```

### 2\) Using ALTER SCHEMA statement to change the owner of a schema example

The following example uses the `ALTER SCHEMA` statement to change the owner of the schema accounting from `john` to `postgres`:

```
ALTER SCHEMA finance
OWNER TO postgres;
```

Here is the statement to query the user\-created schema:

```
SELECT *
FROM
    pg_catalog.pg_namespace
WHERE
    nspacl is NULL AND
    nspname NOT LIKE 'pg_%'
ORDER BY
    nspname;
```

The output is:

![PostgreSQL ALTER SCHEMA - change owner example](/postgresqltutorial/PostgreSQL-ALTER-SCHEMA-change-owner-example.png)
The output indicates that the `finance` schema now is owned by the owner with id 10, which is `postgres`.

Likewise, this statement changes the owner of the accounting schema to `postgres`:

```
ALTER SCHEMA accounting
OWNER TO postgres;
```

![PostgreSQL ALTER SCHEMA - change owner example 2](/postgresqltutorial/PostgreSQL-ALTER-SCHEMA-change-owner-example-2.png)
In this tutorial, you have learned how to use the PostgreSQL `ALTER SCHEMA` statement to rename a schema or change the owner of a schema to a new one.


# Drop Schema

---
title: 'PostgreSQL DROP SCHEMA Statement'
page_title: 'PostgreSQL DROP SCHEMA Explained by Practical Examples'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL DROP SCHEMA statement to delete a schema and its objects.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-drop-schema/'
ogImage: '/postgresqltutorial/PostgreSQL-DROP-Schema.png'
updatedOn: '2024-02-12T13:31:28+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL ALTER SCHEMA'
  slug: 'postgresql-administration/postgresql-alter-schema'
nextLink:
  title: 'PostgreSQL CREATE ROLE Statement'
  slug: 'postgresql-administration/postgresql-roles'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `DROP SCHEMA` statement to delete a schema and its objects.

## Introduction to PostgreSQL DROP SCHEMA statement

The `DROP SCHEMA` removes a [schema](postgresql-schema) and all of its objects from a database. The following illustrates the syntax of the `DROP SCHEMA` statement:

```css
DROP SCHEMA [IF EXISTS] schema_name
[ CASCADE | RESTRICT ];
```

In this syntax:

- First, specify the name of the schema from which you want to remove after the `DROP SCHEMA` keywords.
- Second, use the `IF EXISTS` option to conditionally delete schema only if it exists.
- Third, use `CASCADE` to delete schema and all of its objects, and in turn, all objects that depend on those objects. If you want to delete schema only when it is empty, you can use the `RESTRICT` option. By default, the `DROP SCHEMA` uses the `RESTRICT` option.

To execute the `DROP SCHEMA` statement, you must be the owner of the schema that you want to drop or a superuser.

PostgreSQL allows you to drop multiple schemas at the same time by using a single `DROP SCHEMA` statement:

```css
DROP SCHEMA [IF EXISTS] schema_name1 [,schema_name2,...]
[CASCADE | RESTRICT];
```

## PostgreSQL DROP SCHEMA statement examples

Note that the following examples use schemas created in the [`CREATE SCHEMA`](postgresql-create-schema) tutorial with some modifications in the [`ALTER SCHEMA`](postgresql-alter-schema) tutorial.

![PostgreSQL DROP Schema](/postgresqltutorial/PostgreSQL-DROP-Schema.png)

### 1\) Using the DROP SCHEMA statement to remove an empty schema example

This example uses the `DROP SCHEMA` statement to remove the accounting schema:

```css
DROP SCHEMA IF EXISTS accounting;
```

To refresh the schemas in the list, right\-click the Schemas node and select the Refresh menu item:

![PostgreSQL DROP Schema - drop empty schema example](/postgresqltutorial/PostgreSQL-DROP-Schema-drop-empty-schema-example.png)

![PostgreSQL DROP Schema - drop empty schema example result](/postgresqltutorial/PostgreSQL-DROP-Schema-drop-empty-schema-example-result.png)

### 2\) Using the DROP SCHEMA statement to drop multiple schemas example

The following example uses the `DROP SCHEMA` statement to drop multiple schemas `finance` and `marketing` using a single statement:

```
DROP SCHEMA IF EXISTS finance, marketing;
```

![PostgreSQL DROP Schema - drop multiple schemas](/postgresqltutorial/PostgreSQL-DROP-Schema-drop-multiple-schemas.png)

### 3\) Using DROP SCHEMA statement to remove non\-empty schema examples

This statement drops the `scm` schema:

```
DROP SCHEMA scm;
```

Here are the messages:

```
ERROR:  cannot drop schema scm because other objects depend on it
DETAIL:  table scm.deliveries depends on schema scm
view scm.delivery_due_list depends on schema scm
HINT:  Use DROP ... CASCADE to drop the dependent objects too.
SQL state: 2BP01
```

So, if the schema is not empty and you want to remove the schema and its objects, you must use the `CASCADE` option:

```
DROP SCHEMA scm CASCADE;
```

![PostgreSQL DROP Schema - drop a non-empty schema](/postgresqltutorial/PostgreSQL-DROP-Schema-drop-a-non-empty-schema.png)
Similarly, you can drop the `sales` schema and its objects using the following statement:

```
DROP SCHEMA sales CASCADE;
```

![PostgreSQL DROP Schema - drop a non-empty schema example](/postgresqltutorial/PostgreSQL-DROP-Schema-drop-a-non-empty-schema-example.png)

## Summary

- Use the PostgreSQL `DROP SCHEMA` statement to drop one or more schemas in a database.


# Manage Tablespaces

# Creating Tablespaces

---
title: 'PostgreSQL CREATE TABLESPACE'
page_title: 'PostgreSQL Create Tablespace'
page_description: 'This tutorial shows you how to create tablespaces by using the PostgreSQL CREATE TABLESPACE statement.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-create-tablespace/'
ogImage: ''
updatedOn: '2024-02-13T15:22:39+00:00'
enableTableOfContents: true
previousLink:
  title: 'How to Change the Password of a PostgreSQL User'
  slug: 'postgresql-administration/postgresql-change-password'
nextLink:
  title: 'PostgreSQL ALTER TABLESPACE'
  slug: 'postgresql-administration/postgresql-alter-tablespace'
---

**Summary**: in this tutorial, you will learn how to create tablespaces by using the **PostgreSQL CREATE TABLESPACE** statement.

## Introduction to PostgreSQL tablespace

A tablespace is a disk location where PostgreSQL stores data files containing database objects such as [indexes](../postgresql-indexes) and tables.

PostgreSQL uses a tablespace to associate a logical name to a physical location on the disk.

PostgreSQL comes with two default tablespaces:

- `pg_default` tablespace stores user data.
- `pg_global` tablespace stores global data.

Tablespaces enable you to control the disk layout of PostgreSQL. There are two primary advantages to using tablespaces:

- First, if a partition on which the cluster was initialized runs out of space, you can create a new tablespace on a different partition and utilize it until you reconfigure the system.
- Second, you can use statistics to optimize database performance. For example, you can place the frequent access indexes or tables on fast\-performing devices like solid\-state drives, and store the less frequently accessed archive data on slower devices.

## PostgreSQL CREATE TABLESPACE statement

To create a new tablespace, you use the `CREATE TABLESPACE` statement.

Here is the basic syntax of the `CREATE TABLESPACE` statement:

```sql
CREATE TABLESPACE tablespace_name
OWNER user_name
LOCATION directory_path;
```

The name of the tablespace should not start with `pg_` since these names are reserved for the system tablespaces.

By default, the user who executes the `CREATE TABLESPACE` become the owner of the tablespace. To assign ownership to another user, you specify it after the `OWNER` keyword.

The `directory_path` is the absolute path to an empty directory used for the tablespace. PostgreSQL system users must have onwership of this directory to read from and write data into it.

After creating a new table space, you can specify it in the [`CREATE DATABASE`](postgresql-create-database), [`CREATE TABLE`](../postgresql-tutorial/postgresql-create-table) and [`CREATE INDEX`](../postgresql-indexes/postgresql-create-index) statements to store data files of the objects in the tablespace.

## PostgreSQL CREATE TABLE examples

The following statement uses the `CREATE TABLESPACE` to create a new tablespace called `ts_primary` with the physical location `c:\pgdata\primary`.

```sql
CREATE TABLESPACE ts_primary
LOCATION 'c:\pgdata\primary';
```

Notice that this statement used Unix\-style slashes for the directory path. Additionally, the directory `c:\pgdata\primary` must exist before executing the command.

To list all tablespaces in the current PostgreSQL database server, you use the `\db` command:

```shell
\db
```

Output:

```shell
            List of tablespaces
    Name    |  Owner   |     Location
------------+----------+-------------------
 pg_default | postgres |
 pg_global  | postgres |
 ts_primary | postgres | c:\pgdata\primary
(3 rows)
```

The `\db+` command shows more information such as size and access privileges:

```shell
\db+
```

Output:

```
                                       List of tablespaces
    Name    |  Owner   |     Location      | Access privileges | Options |  Size   | Description
------------+----------+-------------------+-------------------+---------+---------+-------------
 pg_default | postgres |                   |                   |         | 62 MB   |
 pg_global  | postgres |                   |                   |         | 591 kB  |
 ts_primary | postgres | c:\pgdata\primary |                   |         | 0 bytes |
(3 rows)
```

The following statement creates the logistics database that uses the ts_primary tablespace:

```sql
CREATE DATABASE logistics
TABLESPACE ts_primary;
```

In this statement, we specify the tablespace `ts_primary` for the `logistics` database.

The following statement [creates a new table](../postgresql-tutorial/postgresql-create-table) called `deliveries` and [inserts](../postgresql-tutorial/postgresql-insert) a row into the table:

```sql
CREATE TABLE deliveries (
    delivery_id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    order_date DATE,
    customer_id INT
);

INSERT INTO deliveries(order_date, customer_id)
VALUES('2020-08-01',1);
```

Since the `ts_primary` tablespace has some data, you can view its information using the following command in psql:

```shell
\db+ ts_primary
```

Output:

```
    Name    |  Owner   |     Location      | Access privileges | Options |  Size   | Description
------------+----------+-------------------+-------------------+---------+---------+-------------
 ts_primary | postgres | c:\pgdata\primary |                   |         | 8004 kB |
(1 row)

```

## Summary

- A tablespace is a location on the storage device where PostgreSQL stores data files.
- Use the `CREATE TABLESAPCE` statement to create a new tablespace.


# Changing Tablespaces

---
title: 'PostgreSQL ALTER TABLESPACE'
page_title: 'PostgreSQL ALTER TABLESPACE'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL ALTER TABLESPACE statement to rename, change the owner, or set parameters for a tablespace.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-alter-tablespace/'
ogImage: ''
updatedOn: '2023-12-30T10:24:23+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CREATE TABLESPACE'
  slug: 'postgresql-administration/postgresql-create-tablespace'
nextLink:
  title: 'PostgreSQL DROP TABLESPACE Statement'
  slug: 'postgresql-administration/postgresql-drop-tablespace'
---

**Summary**: in this tutorial, you will learn how to use the **PostgreSQL ALTER TABLESPACE** statement to rename, change the owner, or set parameters for a tablespace.

## Introduction to ALTER TABLESPACE statement

After [creating a tablespace](postgresql-create-tablespace 'PostgreSQL creating tablespace'), you can change its definition by using the `ALTER TABLESPACE` statement as follows:

```sql
ALTER TABLESPACE tablespace_name
action;
```

The action can be:

- Rename the tablespace
- Change the owner
- Set the parameters for the tablespace.

To rename the tablespace, you use the `ALTER TABLESPACE RENAME TO` statement:

```sql
ALTER TABLESPACE tablespace_name
RENAME TO new_name;
```

To change the owner of the tablespace, you use the `ALTER TABLESPACE OWNER TO` statement:

```sql
ALTER TABLESPACE tablespace_name
OWNER TO new_owner;
```

The following statement changes the parameters for a tablespace:

```sql
ALTER TABLESPACE tablespace_name
SET parameter_name = value;
```

Only superusers or tablespace owners can execute the `ALTER TABLESPACE` statement.

## PostgreSQL ALTER TABLESPACE examples

The following statement changes `dvdrental` tablespace to `dvdrental_raid`:

```sql
ALTER TABLESPACE dvdrental
RENAME TO dvdrental_raid;
```

The following statement changes the owner of the  `dvdrental_raid` from `postgres`to `hr`:

```sql
ALTER TABLESPACE dvdrental_raid
OWNER to hr;
```

## Summary

- Use `ALTER TABLESPACE RENAME TO` statement to rename a tablespace.
- Use `ALTER TABLESPACE OWNER TO` to change the owner of a tablespace.
- Use `ALTER TABLESPACE SET` to set the parameters for a tablespace.


# Deleting Tablespaces

---
title: 'PostgreSQL DROP TABLESPACE Statement'
page_title: 'PostgreSQL DROP TABLESPACE Statement'
page_description: 'In this tutorial, you will learn how to remove a tablespace by using the PostgreSQL DROP TABLESPACE statement.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-drop-tablespace/'
ogImage: ''
updatedOn: '2024-02-15T01:34:04+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL ALTER TABLESPACE'
  slug: 'postgresql-administration/postgresql-alter-tablespace'
nextLink:
  title: 'PostgreSQL Backup'
  slug: 'postgresql-administration/postgresql-backup-database'
---

**Summary**: in this tutorial, you will learn how to use the **PostgreSQL DROP TABLESPACE** statement to remove a tablespace.

## Introduction to PostgreSQL DROP TABLESPACE statement

The `DROP TABLESPACE` statement delete a tablespace from a database:

Here’s the syntax of the `DROP TABLE` statement:

```phpsqlsql
DROP TABLESPACE [IF EXISTS] tablespace_name;
```

In this syntax:

- First, specify the name of the tablespace that you want to remove after the `DROP TABLESPACE` keywords.
- Second, use the `IF EXISTS` option to instruct PostgreSQL to issue a notice instead of an error when the tablespace does not exist.

Only tablespace owners or superusers can execute the `DROP TABLESPACE` statement to drop the tablespace.

## PostgreSQL DROP TABLESPACE examples

Let’s explore some examples of using the `DROP TABLESPACE` statement.

### 1\) Basic DROP TABLESPACE statement example

First, open the Command Prompt or Terminal on a Unix\-like system and create a new directory for the tablespace such as `C:\pgdata\demo`:

```sql
mkdir C:\pgdata\sample
```

Next, connect to the PostgreSQL server:

```
psql -U postgres
```

Then, create a new tablespace called sample_ts:

```
CREATE TABLESPACE sample_ts
LOCATION 'C:/pgdata/demo';
```

After that, drop the `sample_ts` tablespace using the `DROP TABLESPACE` statement:

```
DROP TABLESPACE sample_ts;
```

Finally, exit psql:

```
exit
```

### 2\) Dropping a tablespace that has objects

First, create a new directory called `C:/pgdata/demo` on your server. Replace the path with the actual one that you use:

```php
mkdir C:\pgdata\demo
```

Second, [create a new tablespace](postgresql-create-tablespace 'PostgreSQL Creating Tablespace') named `demo` and map it to the `c:\pgdata\demo` directory.

```
CREATE TABLESPACE demo_ts
LOCATION 'C:/pgdata/demo';
```

Third, [create a new database](postgresql-create-database 'PostgreSQL CREATE DATABASE') named `dbdemo` and set its tablespace to `demo`:

```sql
CREATE DATABASE demodb
TABLESPACE = demo;
```

Fourth, connect to the `demodb` database:

```text
\c demodb
```

Fifth, [create a new table](../postgresql-tutorial/postgresql-create-table 'PostgreSQL CREATE TABLE') named `test`in the `dbdemo` and set it `tablespace` to `demo_ts`:

```
CREATE TABLE test (
  id serial PRIMARY KEY,
  title VARCHAR (255) NOT NULL
) TABLESPACE demo;
```

Sixth, attempt to drop the `demo` tablespace:

```sql
DROP TABLESPACE demo_ts;
```

PostgreSQL issues an error:

```sql
[Err] ERROR: tablespace "demo_ts" is not empty
```

Because the `demo_ts` tablespace is not empty, you cannot drop it.

Seventh, connect to the `postgres` database:

```
\c postgres
```

Eight, drop the `demodb` database:

```
DROP DATABASE demodb;
```

Ninth, drop the `demo_ts` tablespace:

```
DROP TABLESPACE demo_ts;
```

Instead of [dropping the database](postgresql-drop-database 'PostgreSQL DROP DATABASE'), you can move it to another tablespace such as `pg_default` by using the [ALTER TABLE](postgresql-alter-database 'PostgreSQL ALTER DATABASE') statement as follows:

```sql
ALTER DATABASE demodb
SET TABLESPACE = pg_default;
```

And then delete the `demo_ts` tablespace again:

```sql
DROP TABLESPACE demo_ts
```

## Summary

- Use the PostgreSQL `DROP TABLESPACE` statement to drop a tablespace.


# Roles & Privileges

# Create Roles

---
title: 'PostgreSQL CREATE ROLE Statement'
page_title: 'PostgreSQL CREATE ROLE Statement'
page_description: 'In this tutorial, you will learn about the PostgreSQL roles concept and how to use PostgreSQL create role statement to create roles.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-roles/'
ogImage: '/postgresqltutorial/PostgreSQL-Roles.png'
updatedOn: '2024-02-22T07:00:29+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL DROP SCHEMA Statement'
  slug: 'postgresql-administration/postgresql-drop-schema'
nextLink:
  title: 'PostgreSQL GRANT'
  slug: 'postgresql-administration/postgresql-grant'
---

**Summary**: in this tutorial, you will learn about the PostgreSQL roles and how to use the PostgreSQL `CREATE ROLE` statement to create new roles.

![PostgreSQL Roles](/postgresqltutorial/PostgreSQL-Roles.png?alignright)PostgreSQL uses the concept of **roles** to represent user accounts. It doesn’t use the concept of users like other database systems.

Typically, roles that can log in to the PostgreSQL server are called login roles. They are equivalent to user accounts in other database systems.

When roles contain other roles, they are referred to as **[group roles](postgresql-role-membership)**.

Note that PostgreSQL combined the users and groups into roles since version 8\.1

## Introduction to PostgreSQL CREATE ROLE statement

To create a new role in a PostgreSQL server, you use the `CREATE ROLE` statement.

Here’s the basic syntax of the `CREATE ROLE` statement:

```sqlsqlsql
CREATE ROLE role_name;
```

In this syntax, you specify the name of the role that you want to create after the `CREATE ROLE` keywords.

When you create a role, it is valid in all databases within the database server (or cluster).

For example, the following statement uses the `CREATE ROLE` statement to create a new role called `bob`:

```sql
CREATE ROLE bob;
```

To retrieve all roles in the current PostgreSQL server, you can query them from the `pg_roles` system catalog as follows:

```sql
SELECT rolname FROM pg_roles;
```

Output:

```text
           rolname
-----------------------------
 pg_database_owner
 pg_read_all_data
 pg_write_all_data
 pg_monitor
 pg_read_all_settings
 pg_read_all_stats
 pg_stat_scan_tables
 pg_read_server_files
 pg_write_server_files
 pg_execute_server_program
 pg_signal_backend
 pg_checkpoint
 pg_use_reserved_connections
 pg_create_subscription
 postgres
 bob
(16 rows)
```

Notice that the roles whose names start with `pg_` are system roles. The `postgres` is a [superuser](create-superuser-postgresql) role created by the PostgreSQL installer.

In `psql`, you can use the `\du` command to show all roles that you create including the postgres role in the current PostgreSQL server:

```text
\du
```

Output:

```shell
                             List of roles
 Role name |                         Attributes
-----------+------------------------------------------------------------
 bob       | Cannot login
 postgres  | Superuser, Create role, Create DB, Replication, Bypass RLS
```

The output indicates that the role `bob` cannot log in.

To allow the `bob` to log in to the PostgreSQL server, you need to add the `LOGIN` attribute to it.

### Role attributes

The attributes of a role define privileges for that role, including login, [superuser](create-superuser-postgresql) status, database creation, role creation, password management, and so on.

Here’s the syntax for creating a new role with attributes.

```sql
CREATE ROLE name WITH option;
```

In this syntax, the `WITH` keyword is optional. The `option` can be one or more attributes like `SUPERUSER`, `CREATEDB`, `CREATEROLE`, etc.

### 1\) Create login roles

For example, the following statement creates a role called `alice` that has the login privilege and an initial password:

```sql
CREATE ROLE alice
LOGIN
PASSWORD 'securePass1';
```

Note that you place the password in single quotes (`'`).

Here’s the new roles list:

```shell
 Role name |                         Attributes
-----------+------------------------------------------------------------
 alice     |
 bob       | Cannot login
 postgres  | Superuser, Create role, Create DB, Replication, Bypass RLS
```

Now, you can use the role `alice` to log in to the PostgreSQL database server using the `psql` client tool:

```
psql -U alice
```

It will prompt you for a password. You need to enter the password that you entered in the `CREATE ROLE` statement to log in to the PostgreSQL server.

### 2\) Create superuser roles

The following statement creates a role called `john` that has the `superuser` attribute.

```sql
CREATE ROLE john
SUPERUSER
LOGIN
PASSWORD 'securePass1';
```

The superuser role has all permissions within the PostgreSQL server. Therefore, you should create the superuser role only when necessary.

Notice that only a superuser role can create another superuser role.

### 3\) Create roles with database creation permission

If you want to create roles that have the database creation privilege, you can use the `CREATEDB` attribute:

```
CREATE ROLE dba
CREATEDB
LOGIN
PASSWORD 'securePass1';
```

### 4\) Create roles with a validity period

To set a date and time after which the role’s password is no longer valid, you use the `VALID UNTIL` attribute:

```sql
VALID UNTIL 'timestamp'
```

For example, the following statement creates a `dev_api` role with password valid until the end of 2049:

```
CREATE ROLE dev_api WITH
LOGIN
PASSWORD 'securePass1'
VALID UNTIL '2050-01-01';
```

After one second tick in 2050, the password of `dev_api` is no longer valid.

### 5\) Create roles with connection limit

To specify the number of concurrent connections a role can make, you use the `CONNECTION LIMIT` attribute:

```sql
CONNECTION LIMIT connection_count
```

The following creates a new role called `api` that can make 1000 concurrent connections:

```sql
CREATE ROLE api
LOGIN
PASSWORD 'securePass1'
CONNECTION LIMIT 1000;
```

The following `psql` command shows all the roles that we have created so far:

```shell
\du
```

```shell
                             List of roles
 Role name |                         Attributes
-----------+------------------------------------------------------------
 alice     |
 api       | 1000 connections
 bob       | Cannot login
 dba       | Create DB
 dev_api   | Password valid until 2050-01-01 00:00:00+07
 john      | Superuser
 postgres  | Superuser, Create role, Create DB, Replication, Bypass RLS
```

## Summary

- PostgreSQL uses roles to represent user accounts. A role that can log in is equivalent to a user account in other database systems.
- Use the role attributes to specify the privileges of the roles such as `LOGIN` allows the role to log in, `CREATEDB` allows the role to create a new database, `SUPERUSER` allows the role to have all privileges.


# Grant Privileges

---
title: 'PostgreSQL GRANT'
page_title: 'PostgreSQL GRANT Statement'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL GRANT statement to grant privileges on database objects to a role.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-grant/'
ogImage: ''
updatedOn: '2024-02-22T00:47:34+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CREATE ROLE Statement'
  slug: 'postgresql-administration/postgresql-roles'
nextLink:
  title: 'PostgreSQL REVOKE Statement'
  slug: 'postgresql-administration/postgresql-revoke'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `GRANT` statement to grant privileges on database objects to a role.

## Introduction to PostgreSQL GRANT statement

After [creating a role](postgresql-roles) with the `LOGIN` attribute, the role can log in to the PostgreSQL database server.

However, it cannot do anything to the database objects like tables, [views](../postgresql-views), [functions](../postgresql-plpgsql/postgresql-create-function), etc. For example, the role cannot [select data from a table](../postgresql-tutorial/postgresql-select) or execute a specific function.

To allow a role to interact with database objects, you need to grant privileges on the database objects to the role using the `GRANT` statement.

The following shows the simple form of the `GRANT` statement that grants one or more privileges on a table to a role:

```sql
GRANT privilege_list | ALL
ON  table_name
TO  role_name;
```

In this syntax:

- First, specify the `privilege_list` that can be [`SELECT`](../postgresql-tutorial/postgresql-select), [`INSERT`](../postgresql-tutorial/postgresql-insert),[`UPDATE`](../postgresql-tutorial/postgresql-update), [`DELETE`](../postgresql-tutorial/postgresql-delete),[`TRUNCATE`](../postgresql-tutorial/postgresql-truncate-table), etc. Use the `ALL` option to grant all privileges on a table to the role.
- Second, provide the name of the table after the `ON` keyword.
- Third, indicate the name of the role to which you want to grant privileges.

## PostgreSQL GRANT statement examples

First, use the `postgres` user to connect to the PostgreSQL server using any client tool of your choice, for example, psql:

```bash
psql -U postgres
```

Second, [create a new user role](postgresql-roles) called `joe` that can log in to the PostgreSQL server:

```
create role joe
login
password 'YourPassword';
```

Replace the `YourPassword` with the one you want.

Third, [create a new table](../postgresql-tutorial/postgresql-create-table) called `candidates`:

```sql
create table candidates (
    candidate_id int generated always as identity,
    first_name varchar(100) not null,
    last_name varchar(100) not null,
    email varchar(255) not null unique,
    phone varchar(25) not null,
    primary key(candidate_id)
);
```

Fourth, use the role `joe` to log in to the PostgreSQL server in a separate session.

Fifth, attempt to select data from the `candidates` table from the `joe`‘s session:

```sql
SELECT * FROM candidates;
```

PostgreSQL issued an error:

```sql
ERROR:  permission denied for table candidates
```

The output indicates that the role joe does not have the privilege of retrieving data from the `candidates` table.

To grant the `SELECT` privilege on the `candidates` table to the role `joe`, you execute the following `GRANT` statement in the `postgres`‘ session:

```sql
GRANT SELECT
ON candidates
TO joe;
```

Sixth, execute the `SELECT` statement from the `joe`‘s session:

```sql
SELECT * FROM candidates;
```

PostgreSQL returns an empty result set instead of an error.

Seventh, execute the following [`INSERT`](../postgresql-tutorial/postgresql-insert) statement:

```sql
INSERT INTO candidates(first_name, last_name, email, phone)
VALUES('Joe','Com','[[email protected]](../cdn-cgi/l/email-protection.html)','408-111-2222');
```

PostgreSQL issued the following error because `joe` does not have the `INSERT` privilege on the `candidates` table:

```sql
ERROR:  permission denied for table candidates
```

Eighth, grant `INSERT`, `UPDATE`, and `DELETE` privileges on the `candidates` table to the role `joe`:

```sql
GRANT INSERT, UPDATE, DELETE
ON candidates
TO joe;
```

Ninth, execute the `INSERT` statement again from the `joe`‘s session:

```sql
INSERT INTO candidates(first_name, last_name, email, phone)
VALUES('Joe','Com','[[email protected]](../cdn-cgi/l/email-protection.html)','408-111-2222');
```

Now, `joe` can insert data into the `candidates` table. Additionally, it can update or delete data from the table.

## More PostgreSQL GRANT statement examples

Let’s take some more examples of using the `GRANT` statement.

### 1\) Grant all privileges on a table to a role

The following statement grants all privileges on the `candidates` table to the role `joe`:

```sql
GRANT ALL
ON candidates
TO joe;
```

### 2\) Grant all privileges on all tables in a schema to a role

The following statement grants all privileges on all tables in the `public` schema of the `dvdrental` sample database to the role `joe`:

```sql
GRANT ALL
ON ALL TABLES
IN SCHEMA "public"
TO joe;
```

### 3\) Grant SELECT on all tables

Sometimes, you want to create a readonly role that can only select data from all tables in a specified schema.

To do that, you can grant the `SELECT` privilege on all tables in the `public` schema like this:

```sql
GRANT SELECT
ON ALL TABLES
IN SCHEMA "public"
TO reader;
```

So far, you have learned how to grant privileges on tables. To grant privileges to a role on other database objects, check [the `GRANT` statement syntax](https://www.postgresql.org/docs/current/sql-grant.html).

## Summary

- Use the `GRANT` statement to grant privileges on database objects to a role.


# Revoke Privileges

---
title: 'PostgreSQL REVOKE Statement'
page_title: 'PostgreSQL REVOKE Statement'
page_description: 'In this tutorial, you will learn about the PostgreSQL REVOKE statement to remove privileges from a role.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-revoke/'
ogImage: ''
updatedOn: '2024-02-22T00:49:28+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL GRANT'
  slug: 'postgresql-administration/postgresql-grant'
nextLink:
  title: 'PostgreSQL Role Membership'
  slug: 'postgresql-administration/postgresql-role-membership'
---

**Summary**: in this tutorial, you will learn about the PostgreSQL `REVOKE` statement to remove privileges from a role.

## Introduction to the PostgreSQL REVOKE statement

The `REVOKE` statement revokes previously [granted privileges](postgresql-grant) on database objects from a [role](postgresql-roles).

The following shows the syntax of the `REVOKE` statement that revokes privileges on one or more tables from a role:

```sql
REVOKE privilege | ALL
ON TABLE table_name |  ALL TABLES IN SCHEMA schema_name
FROM role_name;
```

In this syntax:

- First, specify one or more privileges that you want to revoke or use the `ALL` option to revoke all privileges.
- Second, provide the name of the table after the `ON` keyword or use the `ALL TABLES` to revoke specified privileges from all tables in a schema.
- Third, specify the name of the role from which you want to revoke privileges.

## PostgreSQL REVOKE statement example

Let’s take an example of using the `REVOKE` statement.

### Step 1\. Create a role and grant privileges

First, use the `postgres` user to log in to the `dvdrental` [sample database](../postgresql-getting-started/postgresql-sample-database):

```bash
psql -U postgres -d dvdrental
```

Second, [create a new role](postgresql-roles) called `jim` with the `LOGIN` and `PASSWORD` attributes:

```sql
CREATE ROLE jim LOGIN PASSWORD 'YourPassword';
```

Replace the `YourPassword` with the one you want.

Third, grant all privileges to the role `jim` on the `film` table:

```sql
GRANT ALL ON film TO jim;
```

Finally, grant the `SELECT` privilege on the `actor` table to the role `jim`:

```sql
GRANT SELECT ON actor TO jim;
```

### Step 2\. Revoke privileges from a role

To revoke the `SELECT` privilege on the `actor` table from the role `jim`, you use the following statement:

```sql
REVOKE SELECT ON actor FROM jim;
```

To revoke all privileges on the `film` table from the role `jim`, you use `REVOKE` statement with the `ALL` option like this:

```sql
REVOKE ALL ON film FROM jim;
```

## Revoking privileges on other database objects

To revoke privileges from other database objects such as [sequences](../postgresql-tutorial/postgresql-sequences), [functions](../postgresql-functions), [stored procedures](../postgresql-plpgsql/postgresql-create-procedure), [schemas](postgresql-schema), and [databases](postgresql-create-database), check out the [REVOKE statement](https://www.postgresql.org/docs/current/sql-revoke.html).

## Summary

- Use the PostgreSQL `REVOKE` statement to revoke previously granted privileges on database objects from a role.


# Alter roles

---
title: 'PostgreSQL ALTER ROLE Statement'
page_title: 'PostgreSQL ALTER ROLE Statement'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL ALTER ROLE statement to modify a role.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-alter-role/'
ogImage: ''
updatedOn: '2024-02-21T14:36:22+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CURRENT_USER'
  slug: 'postgresql-administration/postgresql-current_user'
nextLink:
  title: 'PostgreSQL DROP ROLE Statement'
  slug: 'postgresql-administration/postgresql-drop-role'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `ALTER ROLE` statement to modify the attributes of a role, rename a role, and change a role’s session default for a configuration variable.

## Using the PostgreSQL ALTER ROLE to modify attributes of roles

To change attributes of a [role](postgresql-roles), you use the following form of `ALTER ROLE` statement.

Here’s the basic syntax of the

```sql
ALTER ROLE role_name [WITH] option;
```

The option can be:

- `SUPERUSER` \| `NOSUPERUSER` – determine if the role is a `superuser` or not.
- `CREATEDB` \| `NOCREATEDB`– allow the role to create new databases.
- `CREATEROLE` \| `NOCREATEROLE` – allow the role to create or change roles.
- `INHERIT` \| `NOINHERIT` – determine if the role inherits the privileges of roles of which it is a member.
- `LOGIN` \| `NOLOGIN` – allow the role to log in.
- `REPLICATION` \| `NOREPLICATION` – determine if the role is a replication role.
- `BYPASSRLS` \| `NOBYPASSRLS` – determine if the role is to bypass the row\-level security (RLS) policy.
- `CONNECTION LIMIT limit` – specify the number of concurrent connections a role can make, \-1 means unlimited.
- `PASSWORD 'password' | PASSWORD NULL` – change the role’s password.
- `VALID UNTIL 'timestamp'` – set the date and time after which the role’s password is no longer valid.

The following rules are applied:

- Superusers can change any of those attributes for any role.
- Roles that have the `CREATEROLE` attribute can change any of these attributes for only non\-superusers and no\-replication roles.
- Ordinal roles can only change their passwords.

First, log in to PostgreSQL server using the `postgres` role.

Second, [create a new role](postgresql-roles) called `calf` using the `CREATE ROLE` statement:

```sql
create role calf login password 'securePwd1';
```

The `calf` role can log in with a password.

Because `postgres` is a superuser, it can change the role `calf` to be a superuser:

```sql
alter role calf superuser;
```

View the role `calf`:

```text
\du calf
```

Output:

```text
        List of roles
Role name | Attributes | Member of
-----------+------------+-----------
calf      | Superuser  | {}

```

The following statement sets the password of the role `calf` to expire until the end of `2050`:

```sql
alter role calf
valid until '2050-01-01';
```

Use the `\du` command to see the effect:

```text
\du calf
```

Output:

```text
                            List of roles
Role name |                 Attributes                  | Member of
-----------+---------------------------------------------+-----------
calf      | Superuser                                  +| {}
          | Password valid until 2050-01-01 00:00:00-08 |

```

## Using the PostgreSQL ALTER ROLE to rename roles

To change the name of a role, you use the following form of the `ALTER ROLE` statement:

```sql
ALTER ROLE role_name
TO new_name;
```

In this syntax, you specify the name of the role after the `ALTER ROLE` keywords and the new name of the role after the `TO` keyword.

A superuser can rename any role. A role that has the `CREATEROLE` privilege can rename no\-superuser roles.

If you use a role to log in to the PostgreSQL database server and rename it in the current session, you will get an error:

```sql
ERROR:  session user cannot be renamed
```

In this case, you need to connect to the PostgreSQL database server using a different role to rename that role.

You execute the following statement from the `postgres`‘ session to rename the role `calf` to `elephant`:

```sql
ALTER ROLE calf
RENAME TO elephant;
```

## Changing a role’s session default for a configuration variable

The following `ALTER ROLE` statement changes the role’s session default for a configuration variable:

```sql
ALTER ROLE role_name | CURRENT_USER | SESSION_USER | ALL
[IN DATABASE database_name]
SET configuration_param = { value | DEFAULT }
```

In this syntax:

- First, specify the name of the role that you want to modify the role’s session default, or use the `CURRENT_USER`, or `SESSION_USER`. You use the `ALL` option to change the settings for all roles.
- Second, specify a database name after the `IN DATABASE` keyword to change only for sessions in the named database. In case you omit the `IN DATABASE` clause, the change will be applied to all databases.
- Third, specify the configuration parameter and the new value in the `SET` clause.

Superusers can change the session defaults of any role. Roles with the `CREATEROLE` attribute can set the defaults for non\-superuser roles. Ordinary roles can only set defaults for themselves. Only superusers can change a setting for all roles in all databases.

The following example uses the `ALTER ROLE` to give the role elephant a non\-default, database\-specific setting of the `client_min_messages` parameter:

```sql
ALTER ROLE elephant
IN DATABASE dvdrental
SET client_min_messages = NOTICE;
```

## Summary

- Use the `ALTER ROLE role_name option` to modify the attributes of a role.
- Use the `ALTER ROLE role_name RENAME TO new_role` statement to rename a role.
- Use the `ALTER ROLE role_name SET param=value` statement to change a role’s session default for a configuration variable.


# Drop Roles

---
title: 'PostgreSQL DROP ROLE Statement'
page_title: 'PostgreSQL DROP ROLE Statement'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL DROP ROLE statement to remove a role.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-drop-role/'
ogImage: ''
updatedOn: '2024-02-21T14:37:07+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL ALTER ROLE Statement'
  slug: 'postgresql-administration/postgresql-alter-role'
nextLink:
  title: 'PostgreSQL List Users'
  slug: 'postgresql-administration/postgresql-list-users'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `DROP ROLE` statement to remove a role.

## Introduction to PostgreSQL DROP ROLE statement

The `DROP ROLE` statement allows you to delete a [role](postgresql-roles):

```sql
DROP ROLE [IF EXISTS] target_role;
```

In this syntax:

- First, specify the name of the role that you want to remove after the `DROP ROLE` keywords.
- Second, use the `IF EXISTS` option to conditionally remove the role only if it exists.

To remove a superuser role, you need to be a superuser. To drop non\-superuser roles, you need to have the `CREATEROLE` privilege.

When you remove a role referenced in any database, PostgreSQL will raise an error. In this case, you need to take two steps:

- First, either remove the database objects owned by the role using the `DROP OWNED` statement or reassign the ownership of the database objects to another role `REASSIGN OWNED`.
- Second, revoke any privileges granted to the role.

The `REASSIGN OWNED` statement reassigns the ownership of all dependent objects of a target role to another role. Because the `REASSIGN OWNED` statement can only access objects in the current database, you need to execute this statement in each database that contains objects owned by the target role.

After transferring the ownership of objects to another role, you need to drop any remaining objects owned by the target role by executing the `DROP OWNED` statement in each database that contains objects owned by the target role.

In other words, you should execute the following statements in sequence to drop a role:

```sql
-- execute these statements in the database that contains
-- the object owned by the target role
REASSIGN OWNED BY target_role TO another_role;

DROP OWNED BY target_role;

-- drop the role
DROP ROLE target_role;
```

## PostgreSQL DROP ROLE statement example

Let’s take an example of how to use the `DROP ROLE` statement:

- First, create a new role called `alice`
- Second, use the `alice` role to create a table called `customers`.
- Third, remove the role `alice`.

We’ll use the psql client tool. But, you can use any client tool of your choice.

### Step 1\. Setting a new role and database

First, open the Command Prompt on Windows or Terminal on Linux and log in to PostgreSQL using the `postgres` role:

```bash
psql -U postgres
```

Second, create a new database called sales:

```sql
CREATE DATABASE sales;
```

Third, create a new role called `alice`:

```
create role alice
with login
password 'Password';
```

Replace the `Password` with the actual one.

Fourth, grant `createdb` privilege to `alice`:

```sql
alter role alice createdb;
```

Fifth, grant all privileges on the `sales` database to `alice`:

```php
grant all privileges on database sales to alice;
```

Sixth, switch the current database to sales:

```
\c sales
```

Sixth, grant all privileges of the `public` schema database to `alice`:

```
grant all on schema public to alice;
```

Finally, exit the current session:

```text
\q
```

### Step 2\. Using the new role to create database objects

First, log in to the PostgreSQL server using the `alice` role:

```bash
psql -U alice -W sales
```

Second, [create a new table](../postgresql-tutorial/postgresql-create-table) in the `sales` database:

```sql
create table customers(
    customer_id int generated always as identity,
    customer_name varchar(150) not null,
    primary key(customer_id)
);
```

Third, [show the table list](postgresql-show-tables) in the `sales` database:

```text
\dt
```

Output:

```
        List of relations
Schema |   Name    | Type  | Owner
--------+-----------+-------+-------
public | customers | table | alice
(1 row)

```

Finally, quit the current session:

```text
\q
```

### Step 3\. Removing the role alice

First, log in to the PostgreSQL server using the `postgres` role:

```bash
psql -U postgres
```

Second, attempt to drop the role `alice`:

```sql
drop role alice;
```

PostgreSQL issued the following error:

```sql
ERROR:  role "alice" cannot be dropped because some objects depend on it
DETAIL:  privileges for database sales
3 objects in database sales
```

The role `alice` cannot be dropped because it has dependent objects.

Third, switch to the `sales` database:

```text
\c sales
```

Fourth, reassign owned objects of `alice` to `postgres`:

```sql
reassign owned by alice to postgres;
```

Fifth, drop owned objects by `alice`:

```sql
drop owned by alice;
```

Sixth, drop the role `alice`:

```sql
drop role alice;
```

Seventh, list the current roles:

```text
\du
```

You will see that the role `alice` has been removed.

Finally, quit the current session:

```text
\q
```

## Summary

- Use the PostgreSQL `DROP ROLE` statement to remove a role.
- If a role has dependent objects, use the `REASSIGN OWNED` and `DROP OWNED` statements in sequence to remove dependent objects of the role before executing the `DROP ROLE` statement.


# Role Membership

---
title: 'PostgreSQL Role Membership'
page_title: 'PostgreSQL Role Membership'
page_description: 'In this tutorial, you will learn about PostgreSQL group roles and how to use them to manage privileges more effectively.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-role-membership/'
ogImage: ''
updatedOn: '2024-02-22T02:54:15+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL REVOKE Statement'
  slug: 'postgresql-administration/postgresql-revoke'
nextLink:
  title: 'PostgreSQL SET ROLE Statement'
  slug: 'postgresql-administration/postgresql-set-role'
---

**Summary**: in this tutorial, you will learn about PostgreSQL group roles and how to use them to manage privileges more effectively.

## Introduction to PostgreSQL group roles

In PostgreSQL, a group role is a role that serves as a container for other individual roles.

Unlike individual roles, which typically represent users, a group role is used to manage collections of roles.

Typically, you create a role to represent a group and then grant a membership in the group role to individual roles.

Group roles allow you to simplify permission management. Instead of granting privileges to individual roles, you can group these roles into a group, grant privileges to a group role, and all the members of that group role will inherit those privileges.

Group roles can have individual roles or other group roles as their members. This allows you to create hierarchical structures where you can manage privileges at different levels.

Individual roles can be members of multiple group roles. This allows for flexible assignment of permissions and roles within the database.

### Creating a group role

Creating a group role is like creating a role by using the [`CREATE ROLE`](postgresql-roles) statement:

```sqlsqlsql
CREATE ROLE group_role;
```

In this syntax, you specify the name of the group role after the `CREATE ROLE` keyword.

By convention, a group role does not have the `LOGIN` privilege, meaning that you will not use the group role to log in to PostgreSQL even though you can.

For example, the following statement creates a group role called `sales`:

```sql
CREATE ROLE sales;
```

When you use the `\du` command in the `psql` tool, you will see that the group roles are listed together with individual roles:

```shell
                             List of roles
 Role name |                         Attributes
-----------+------------------------------------------------------------
 alice     |
 api       | 1000 connections
 bob       | Cannot login
 dba       | Create DB
 dev_api   | Password valid until 2050-01-01 00:00:00+07
 jim       |
 joe       |
 john      | Superuser
 postgres  | Superuser, Create role, Create DB, Replication, Bypass RLS
 sales     | Cannot login
```

### Adding a role to a group role

To add a role to a group, you use the following form of the `GRANT` statement:

```sql
GRANT group_role TO role;
```

In this syntax:

- First, specify the name of the group role after the `GRANT` keyword.
- Second, specify the name of the role after the `TO` keyword.

For example, the following statement creates a new role `alice` and adds it to the group role `sales`:

```
GRANT sales TO alice;
```

After you execute this statement, the `alice` role will automatically inherit all privileges of the `sales` group role if the `alice` role has `INHERIT` attribute.

Note that if your PostgreSQL server does not have the `alice` role, you can run the following command first to create it:

```sql
CREATE ROLE alice
WITH LOGIN
PASSWORD 'SecurePass1';
```

This CREATE ROLE implicitly uses the `INHERIT` attribute to ensure that the role `alice` automatically inherits privileges from the group roles to which it belongs.

If you don’t want the role `alice` to inherit the privileges of its group roles, you can use the `NOINHERIT` attribute:

```sql
CREATE ROLE alice
WITH LOGIN NOINHERIT
PASSWORD 'SecurePass1';
```

The following grants the `SELECT` privilege on the rental table to the `sales` group role:

```
GRANT SELECT ON rental TO sales;
```

The role `alice` will automatically inherit the `SELECT` privilege on the `rental` table from the `sales` group role.

Let’s test it out.

First, connect to the PostgreSQL server using the `alice` role:

```
psql -U alice -d dvdrental
```

Second, retrieve data from the rental table:

```
SELECT count(*) FROM rental;
```

Output:

```
 count
-------
 16044
(1 row)
```

The output indicates that the role `alice` has the `SELECT` privilege on the `rental` table even though we did not explicitly assign it.

### Removing a role to a group role

To remove a role from a group role, you use the `REVOKE` statement:

```
REVOKE group_role FROM role;
```

In this syntax:

- First, specify the name of the group role after the `REVOKE` keyword.
- Second, specify the name of the role after the `FROM` keyword.

A useful tip to remember when using `GRANT` and `REVOKE` statements with the group role is that the **group role should come first**, followed by the individual role.

For example, the following statement uses the `REVOKE` statement to remove the role `alice` from the group role `sales`:

```sql
REVOKE sales FROM alice;
```

Notice that PostgreSQL does not permit circular membership loops, where a role is the member of another role and vice versa.

## Summary

- A group role is a role that serves as a container for other roles.
- All individual roles of a group role automatically inherit privileges granted to the group role. Use the `NOINHERIT` attribute if you don’t want a role to inherit the privileges from its group roles.
- Use the `GRANT` statement to add a role to a group role.
- Use the `REVOKE` statement to remove a role from a group.


# SET ROLE Statement

---
title: 'PostgreSQL SET ROLE Statement'
page_title: 'PostgreSQL SET ROLE Statement'
page_description: 'In this tutorial, you will learn how to use the SET ROLE statement to temporarily change the current role within a database session.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-set-role/'
ogImage: ''
updatedOn: '2024-02-22T03:14:57+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Role Membership'
  slug: 'postgresql-administration/postgresql-role-membership'
nextLink:
  title: 'PostgreSQL CURRENT_USER'
  slug: 'postgresql-administration/postgresql-current_user'
---

**Summary**: in this tutorial, you will learn how to use the `SET ROLE` statement to temporarily change the current role within a database session.

## Introduction to the PostgreSQL SET ROLE statement

The `SET ROLE` statement allows you to temporarily change the current role within a database session

Here’s the syntax of the `SET ROLE` statement:

```sql
SET ROLE role_name;
```

In this syntax, you specify the name of the role to which you want to switch.

The `role_name` must be a role of which the current session user is a member.

If the session user is a superuser, you can switch to any role.

## PostgreSQL SET ROLE statement example

We’ll take an example of using the `SET ROLE` statement.

First, [connect](../postgresql-getting-started/connect-to-postgresql-database) to the `dvdrental` database using `psql`:

```bash
psql -U postres -d dvdrental
```

Second, [create a group role](postgresql-role-membership) called `marketing`:

```sql
CREATE ROLE marketing;
```

Third, [grant](postgresql-grant) the `SELECT` privilege on the `film` table:

```sql
GRANT SELECT ON film TO marketing;
```

Fourth, [create a role](postgresql-role-membership) called `lily` that is a member of the `marketing` role:

```sql
CREATE ROLE lily
WITH LOGIN PASSWORD 'SecurePass1'
IN ROLE marketing;
```

Sixth, connect to the `dvdrental` database using the `lily` role in a separate session:

```bash
psql -U lily -d dvdrental
```

Seventh, retrieve the current role:

```sql
SELECT current_role;
```

Output:

```text
 current_role
--------------
 lily
(1 row)
```

Eight, switch the current role to `marketing`:

```sql
SET ROLE marketing;
```

Ninth, retrieve the current role:

```text
 current_role
--------------
 marketing
(1 row)
```

Output:

```text
 current_role
--------------
 marketing
(1 row)
```

The output indicates that the current role is `marketing`, not `lily` due to the `SET ROLE` statement.

If you attempt to switch the current role to a [superuser](create-superuser-postgresql) such as `postgres`, you’ll get an error because the current role is not a `superuser` role.

Tenth, switch the current role to `postgres`:

```sql
SET ROLE postgres;
```

Output:

```sql
ERROR:  permission denied to set role "postgres"
```

To set the current role back to the original one, you use the `RESET` `ROLE` statement:

```sql
RESET ROLE;
```

Eleventh, select the current role:

```text
 current_role
--------------
 lily
(1 row)
```

The current role is back to `lily`.

## Summary

- Use the `SET` `ROLE` statement to temporarily change the current role within a database session.
- Use the `RESET` `ROLE` statement to reset the role to the original one.


# CURRENT_USER

---
title: 'PostgreSQL CURRENT_USER'
page_title: 'PostgreSQL CURRENT_USER Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL CURRENT_USER function to return the name of the currently logged-in database user.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-current_user/'
ogImage: ''
updatedOn: '2024-02-22T06:48:14+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL SET ROLE Statement'
  slug: 'postgresql-administration/postgresql-set-role'
nextLink:
  title: 'PostgreSQL ALTER ROLE Statement'
  slug: 'postgresql-administration/postgresql-alter-role'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `CURRENT_USER` function to return the name of the currently logged\-in database user.

## Introduction to the PostgreSQL CURRENT_USER function

The PostgreSQL `CURRENT_USER` is a function that returns the name of the currently logged\-in database user.

Here’s the syntax of the `CURRENT_USER` function:

```sqlsql
CURRENT_USER
```

The function returns the name of the current effective user within the session.

In other words, if you use the [`SET ROLE`](postgresql-set-role) statement to change the role of the current user to the new one, the `CURRENT_USER` will reflect the new role.

In PostgreSQL, a role with the `LOGIN` attribute represents a user. Therefore, we use the terms role and user interchangeably.

To get the original user who connected to the session, you use the `SESSION_USER` function.

## PostgreSQL CURRENT_USER function example

First, open the command prompt on Windows or a terminal on Unix\-like systems and connect to the PostgreSQL server using psql:

```bash
psql -U postgres
```

Second, use the `CURRENT_USER` function to get the currently logged\-in user:

```sql
SELECT CURRENT_USER;
```

Output:

```text
 current_user
--------------
 postgres
(1 row)
```

Third, [create a new role](postgresql-roles) called `bob`:

```sql
CREATE ROLE bob
WITH LOGIN PASSWORD 'SecurePass1';
```

Fourth, change the role of the current user to `bob`:

```
SET ROLE bob;
```

Fifth, execute the `CURRENT_USER` function:

```sql
SELECT CURRENT_USER;
```

It returns `bob` instead:

```text
 current_user
--------------
 bob
(1 row)
```

Six, use the `SESSION_USER` function to retrieve the original user who connected to the session:

```sql
SELECT SESSION_USER;
```

Output:

```text
 session_user
--------------
 postgres
(1 row)
```

The `SESSION_USER` function returns `postgres`, not `bob`.

## Summary

- Use the `CURRENT_USER` function to return the current effective user within the session.
- Use the `SESSION_USER` function to return the original user who connected to the session.


# List Roles

---
title: 'PostgreSQL List Users'
page_title: 'PostgreSQL List Users: Shows PostgreSQL Users'
page_description: 'This tutorial shows you how to use the PostgreSQL list users command to show all users in a database server.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-list-users/'
ogImage: '/postgresqltutorial/PostgreSQL-List-User-Example-1.png'
updatedOn: '2024-02-15T02:21:52+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL DROP ROLE Statement'
  slug: 'postgresql-administration/postgresql-drop-role'
nextLink:
  title: 'How to Create Superuser in PostgreSQL'
  slug: 'postgresql-administration/create-superuser-postgresql'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL list user command to show all users in a PostgreSQL database server.

## Listing users using the psql tool

First, [connect to the PostgreSQL database server](../postgresql-jdbc/connecting-to-postgresql-database) using the `postgres` user:

```shellsql
psql -U postgres
```

It will prompt you for a password:

```
Password:
```

Once you enter the password for the `postgres` user, you will see the following PostgreSQL command prompt:

```shell
postgres=#
```

Second, use the `\du` to list all user accounts (or roles) in the current PostgreSQL database server:

```shell
\du
```

![](/postgresqltutorial/PostgreSQL-List-User-Example-1.png)If you want to show more information, you can use the `\du+` command:

```shell
postgres=#\du+
```

The `\du+` command adds column called `description`.

## Listing users using SQL statement

The following statement returns all users in the current database server by [querying data](../postgresql-tutorial/postgresql-select) from the `pg_catalog.pg_user` catalog:

```
SELECT usename AS role_name,
  CASE
     WHEN usesuper AND usecreatedb THEN
	   CAST('superuser, create database' AS pg_catalog.text)
     WHEN usesuper THEN
	    CAST('superuser' AS pg_catalog.text)
     WHEN usecreatedb THEN
	    CAST('create database' AS pg_catalog.text)
     ELSE
	    CAST('' AS pg_catalog.text)
  END role_attributes
FROM pg_catalog.pg_user
ORDER BY role_name desc;
```

![](/postgresqltutorial/PostgreSQL-List-User-Using-SQL-example.png)

## Summary

- Use `\du` or `\du+` psql command to list all users in the current database server.
- Use the `SELECT` statement to query the user information from the `pg_catalog.pg_user` catalog.


# Create Superusers

---
title: 'How to Create Superuser in PostgreSQL'
page_title: 'How to Create Superuser in PostgreSQL'
page_description: 'In this tutorial, you will learn about PostgreSQL superusers and how to create them using the CREATE ROLE statement.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/create-superuser-postgresql/'
ogImage: ''
updatedOn: '2024-02-22T08:40:18+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL List Users'
  slug: 'postgresql-administration/postgresql-list-users'
nextLink:
  title: 'PostgreSQL Row-Level Security'
  slug: 'postgresql-administration/postgresql-row-level-security'
---

**Summary**: in this tutorial, you will learn about PostgreSQL superusers and how to create them using the `CREATE` `ROLE` statement.

## Introduction to PostgreSQL superuser

In PostgreSQL, a superuser is a special role with the highest privileges. A superuser has full access to all databases and tables. Additionally, it can perform administrative tasks such as [creating databases](postgresql-create-database), [dropping databases](postgresql-drop-database), [managing user roles](postgresql-roles), modifying database configuration, and so on.

In other words, a superuser can bypass all security checks except the right to log in.

By default, PostgreSQL has a superuser role called `postgres`. Typically, you use the `postgres` user role for performing administrative tasks and don’t need to create additional users with the superuser privilege.

However, if you need additional superuser roles, you can create them using the `CREATE ROLE` statement or change a regular user to a superuser using the `ALTER ROLE` statement.

### Creating new superusers

First, connect to the PostgreSQL database using a client such as `psql`:

```bash
psql -U postgres
```

Second, execute the following `CREATE ROLE` command to create a superuser:

```sql
CREATE ROLE username SUPERUSER;
```

You need to replace `username` with your desired username for the superuser. For example:

```sql
CREATE ROLE spiderman SUPERUSER
LOGIN
PASSWORD 'moreSecurePass';
```

Third, verify the user creation:

```text
\du spiderman
```

Output:

```text
     List of roles
 Role name | Attributes
-----------+------------
 spiderman | Superuser
```

The output indicates that `spiderman` role is a superuser.

### Changing a user to a superuser

It’s possible to change a user to a superuser using the `ALTER` `ROLE` statement.

First, create a regular role with a login privilege and a password:

```sql
CREATE ROLE batman LOGIN PASSWORD 'moreSecurePass';
```

Second, make the `batman` role become a superuser using the `ALTER` `ROLE` statement:

```sql
ALTER ROLE batman SUPERUSER;
```

Third, verify the user modification:

```text
\du batman
```

Output:

```text
     List of roles
 Role name | Attributes
-----------+------------
 batman    | Superuser
```

### Revoking superuser from a user

To revoke a superuser status of a user, you can use the following `ALTER` `ROLE` statement:

```sql
ALTER USER username NOSUPERUSER;
```

For example, the following statement revokes the `SUPERUSER` status from the `spiderman` role:

```sql
ALTER USER spiderman NOSUPERUSER;
```

You can verify the `spiderman` role as follows:

```text
\du spiderman
```

Output:

```text
     List of roles
 Role name | Attributes
-----------+------------
 spiderman |
```

## Summary

- In PostgreSQL, a superuser bypass all permission checks except the permission to log in.
- Use the `CREATE ROLE...SUPERUSER` statement to create a superuser.
- Use the `ALTER ROLE...SUPERUSER` statement to make a role a superuser.
- Use the `ALTER ROLE...NOSUPERUSER` statement to revoke the superuser from a user.


# PostgreSQL Row-Level Security

---
title: 'PostgreSQL Row-Level Security'
page_title: 'PostgreSQL Row-Level Security'
page_description: 'in this tutorial, you will learn how to use PostgreSQL row-level security to control access to individual rows in a table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-row-level-security/'
ogImage: ''
updatedOn: '2024-02-22T04:16:15+00:00'
enableTableOfContents: true
previousLink:
  title: 'How to Create Superuser in PostgreSQL'
  slug: 'postgresql-administration/create-superuser-postgresql'
nextLink:
  title: 'Reset Forgotten Password For postgres User'
  slug: 'postgresql-administration/postgresql-reset-password'
---

**Summary**: in this tutorial, you will learn how to use PostgreSQL row\-level security to control access to individual rows in a table.

<CTA title="Looking to use Postgres RLS?" description="<a href='/docs/guides/neon-authorize'>Neon Authorize</a> uses the open-source <a href='https://github.com/neondatabase/pg_session_jwt'>pg_session_jwt</a> extension to help you write RLS policies that map to your app's or service's auth." buttonText="Learn More" buttonUrl="/docs/guides/neon-authorize" />

## Introduction to the PostgreSQL Row\-Level Security

Row\-level security (RLS) is a feature that allows you to restrict rows returned by a query based on the user executing the query.

The RLS allows you to control access to individual rows in tables based on the current user and specific conditions defined by policies.

The basic steps for implementing row\-level security are as follows:

First, enable row\-level security on a table using the `ALTER TABLE` statement:

```sql
ALTER TABLE table_name
ENABLE ROW LEVEL SECURITY;
```

Second, create a new row\-level security policy for a table using the `CREATE POLICY` statement:

```sql
CREATE POLICY name ON table_name
USING (condition);
```

In the policy, you define a condition that determines which rows are visible.

Note that superusers and roles with the `BYPASSRLS` attribute can bypass the row security system when accessing a table.

Additionally, table owners also bypass row\-level security. To enforce the row\-level security to the table owners, you can modify the table using the `FORCE ROW LEVEL SECURITY` option:

```sql
ALTER TABLE table_name
FORCE ROW LEVEL SECURITY;
```

## PostgreSQL Row\-Level Security example

We’ll take an example of creating a table and roles where the roles can retrieve data from the table whose `manager` column matches the current role.

1\) [Create a new database](postgresql-create-database) called `hr`:

```sql
create database hr;
```

2\) Change the current database to the `hr` database:

```text
\c hr
```

3\) [Create a new table](../postgresql-tutorial/postgresql-create-table) called `departments` to store department data:

```sql
create table departments(
   id serial primary key,
   name VARCHAR(255) NOT NULL UNIQUE,
   manager VARCHAR(255) NOT NULL
);
```

4\) [Insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `departments` table:

```sql
INSERT INTO departments(name, manager)
VALUES('Sales', 'alice'),
      ('Marketing', 'bob'),
      ('IT', 'jack');
```

5\) [Create a group role](postgresql-role-membership) called `managers`:

```sql
CREATE ROLE managers;
```

6\) [Grant](postgresql-grant) the `SELECT` privileges of all tables in the `public` schema to the group role `managers`:

```sql
GRANT SELECT ON ALL TABLES
IN SCHEMA public
TO managers;
```

7\) Create three new roles `alice`, `bob`, `peter` and assign them as members of the `managers` group role:

```sql
CREATE ROLE alice WITH LOGIN PASSWORD 'SecurePass1'
IN ROLE managers;
CREATE ROLE bob WITH LOGIN PASSWORD 'SecurePass2'
IN ROLE managers;
CREATE ROLE jack WITH LOGIN PASSWORD 'SecurePass3'
IN ROLE managers;
```

The roles `alice`, `bob`, and `jack` will implicitly inherit privileges from the group role managers. In other words, they can retrieve data from all tables in the `public` schema.

8\) Enable row\-level security on the `departments` table:

```sql
ALTER TABLE departments
ENABLE ROW LEVEL SECURITY;
```

9\) Create a policy that the current user can access the rows whose value in the `manager` column of the `departments` table matches the current role name:

```sql
CREATE POLICY department_managers
ON departments
TO managers
USING (manager = current_user);
```

10\) Connect to the `hr` database using the `alice` role in a separate session:

```bash
psql -U alice -d hr
```

11\) Retrieve data from the `departments` table:

```sql
SELECT * FROM departments;
```

Output:

```text
 id | name  | manager
----+-------+---------
  1 | Sales | alice
(1 row)
```

The query returns the rows whose manager column is `alice`.

12\) Connect to the `hr` database using the `bob` role in a separate session:

```bash
psql -U bob -d hr
```

13\) Select data from the `departments` table:

```sql
SELECT * FROM departments;
```

Output:

```text
 id |   name    | manager
----+-----------+---------
  2 | Marketing | bob
(1 row)
```

Like `alice`, `bob` can only retrieve data whose manager is `bob`.

## Summary

- Use the `ALTER TABLE table_name ENABLE ROW LEVEL SECURITY` statement to enable row\-level security of a table.
- Use the `CREATE POLICY` statement to define a new row\-level security policy for a table.


# Backup & Restore

# Backup Databases

---
title: 'PostgreSQL Backup'
page_title: 'PostgreSQL Backup - pg_dump & pg_dumpall'
page_description: 'This tutorial shows you how to use PostgreSQL backup tools including pg_dump and pg_dumpall to backup databases in PostgreSQL.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-backup-database/'
ogImage: ''
updatedOn: '2024-02-20T02:00:57+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL DROP TABLESPACE Statement'
  slug: 'postgresql-administration/postgresql-drop-tablespace'
nextLink:
  title: 'PostgreSQL Restore Database'
  slug: 'postgresql-administration/postgresql-restore-database'
---

**Summary**: in this tutorial, you will learn how to backup the PostgreSQL databases using the `pg_dump` and `pg_dumpall` tools.

## Introduction to PostgreSQL backup

A PostgreSQL backup is a copy of the data that you can use to recover the database later. Typically, a backup includes all or selected data, schema, and configuration settings necessary to restore the database to a desired state.

You need to back up PostgreSQL databases regularly to prevent data loss in case of human errors, hardware failures, disasters, or other unforeseen circumstances.

Before backing up the databases, you should consider the following types of backups:

- Logical backups
- Physical backups

PostgreSQL comes with `pg_dump` and `pg_dumpall` tools that help you perform logical backups effectively.

### pg_dump

The `pg_dump` tool is a command\-line utility that you can use to create a logical backup of a PostgreSQL database.

The `pg_dump` extracts a PostgreSQL database into a script file or other archive file. The file represents the snapshot of the database at the time `pg_dump` begins running.

Here’s the syntax of the `pg_dump` command:

```csssql
pg_dump [connection_option] [option] [dbname]
```

The following table illustrates the options for the `pg_dump` command:

| Option                   | Description                                                                                            |
| ------------------------ | ------------------------------------------------------------------------------------------------------ |
| \-U, –username\=USERNAME | Specifies the username to connect to the database.                                                     |
| \-h, –host\=HOSTNAME     | Specifies the hostname of the server on which the PostgreSQL server is running.                        |
| \-p, –port\=PORT         | Specifies the port number on which the PostgreSQL server is listening.                                 |
| \-d, –dbname\=DBNAME     | Specifies the name of the database to be dumped.                                                       |
| \-n, –schema\=SCHEMA     | Specifies the schema(s) to be dumped. Multiple schemas can be specified, separated by commas.          |
| \-t, –table\=TABLE       | Specifies the table(s) to be dumped. Multiple tables can be specified, separated by commas.            |
| \-F, –format\=FORMAT     | Specifies the output file format (e.g., plain, custom, directory).                                     |
| \-f, –file\=FILENAME     | Specifies the name of the output file.                                                                 |
| \-W, –password           | Forces pg_dump to prompt for a password before connecting to the PostgreSQL server.                    |
| \-w, –no\-password       | Suppresses the password prompt, but the password might be supplied in other ways (e.g., .pgpass file). |
| \-c, –clean              | Adds SQL commands to clean (drop) database objects before recreating them.                             |
| \-C, –create             | Adds SQL commands to create the database before restoring data into it.                                |
| \-a, –data\-only         | Dumps only the data, not the schema (no schema\-creating commands are included).                       |
| \-s, –schema\-only       | Dumps only the schema, not the data.                                                                   |
| \-x, –no\-privileges     | Excludes access privileges (GRANT/REVOKE commands) from the dump.                                      |
| \-X, –no\-owner          | Prevents dumping of object ownership information (such as `OWNER TO`).                                 |
| \-h, –help               | Displays help and usage information.                                                                   |

### pg_dumpall

The `pg_dumpall` tool is a command\-line utility that you can use to create logical backups of the entire PostgreSQL cluster, including all databases, schemas, roles, and other cluster\-wide objects.

Unlike the `pg_dump` tool which backups individual databases or objects, the `pg_dumpall` tool offers a convenient way to make a backup of all databases in an PostgreSQL cluster (instance) in a single operation.

Here’s the syntax for `pg_dumpall` command:

```css
pg_dump [connection_option] [option]
```

The following table presents some common command\-line options for `pg_dumpall` utility:

| Option                   | Description                                                                        |
| ------------------------ | ---------------------------------------------------------------------------------- |
| \-U, –username\=USERNAME | Specifies the username to connect to the PostgreSQL server.                        |
| \-h, –host\=HOSTNAME     | Specifies the hostname of the server on which the PostgreSQL server is running.    |
| \-p, –port\=PORT         | Specifies the port number on which the PostgreSQL server is listening.             |
| \-g, –globals\-only      | Dumps only global objects (roles and tablespaces), no database\-specific objects.  |
| \-r, –roles\-only        | Dumps only role (user and group) definitions, no databases or tablespaces.         |
| \-t, –tablespaces\-only  | Dumps only the definitions of tablespaces, no databases or roles.                  |
| \-c, –clean              | Adds SQL commands to clean (drop) database objects before recreating them.         |
| \-C, –create             | Adds SQL commands to create the database before restoring data into it.            |
| \-x, –no\-privileges     | Excludes access privileges (GRANT/REVOKE commands) from the dump.                  |
| \-X, –no\-owner          | Prevents dumping of object ownership information (such as `OWNER TO`).             |
| \-s, –schema\-only       | Dumps only the schema, no data.                                                    |
| \-v, –verbose            | Displays verbose output, including informational messages during the dump process. |
| \-V, –version            | Displays the version of pg_dumpall and exits.                                      |
| \-?, –help               | Displays help and usage information.                                               |

## PostgreSQL backup examples

Let’s take some examples of backing up PostgreSQL databases.

### 1\) Backing up a single database using the pg_dump utility

First, open the Command Prompt on Windows or Terminal on Unix\-like systems.

Second, execute the following `pg_dump` to back up the `dvdrental` database on the local server:

```css
pg_dump -U postgres -d dvdrental -F tar -f d:\backup\dvdrental.tar
```

In this command:

- `-U postgres`:  specifies the user (`postgres`) that connects to the PostgreSQL database server.
- `-d dvdrental`: specifies the database name that you want to back up.
- `-F tar` : specifies `tar` as the output format of the archive file.
- `-f d:\backup\dvdrental.tar`: This is the file path of the output backup file. Note that the `D:\backup` directory must exist. Also, it is a good practice to place a backup file in a server that is not the same as the one the PostgreSQL server is running.

After you run the command, `pg_dump` will prompt you to enter a password for the `postgres` user:

```css
password:;
```

After you enter a valid password, the `pg_dump` will create the backup file `dvdrental.tar` in the `d:\backup` directory.

If you want to automate the backup regularly, you need to use [a password file](postgresql-password-file-pgpass) (`.pgpass` on Unix\-like systems and `pgpass.conf` on Windows) so that when the command executes, it doesn’t ask for the password.

### 2\) Backing up all databases using the pg_dumpall utility

First, open the Command Prompt on Windows or Terminal on Unix\-like systems.

Second, run the `pg_dumpall` command to back up all databases in the local PostgreSQL server into the all_databases.sql file:

```
pg_dumpall -U postgres > D:\backup\all_databases.sql
```

This command will prompt you to enter a password for each database in the PostgreSQL server.

To suppress the password prompt, you can use the `-w` option:

```
pg_dumpall -U postgres > D:\backup\all_databases.sql
```

However, you need to use a [password file](postgresql-password-file-pgpass) with the following entry:

```css
hostname:port:database:username:password
```

For example:

```css
localhost:5432:*:postgres:SecurePass1
```

The asterisk (\*) means all databases.

### 3\) Backing up database objects using the pg_dumpall utility

Sometimes, you want to backup only database object definitions, not the data. This is helpful in the testing phase, in which you do not want to move test data to the live system.

To back up objects in all databases, including roles, tablespaces, databases, schemas, tables, indexes, triggers, functions, constraints, views, ownerships, and privileges, you use the following command:

```plaintext
pg_dumpall --schema-only > d:\backup\schemas.sql
```

If you want to back up role definition only, use the following command:

```plaintext
pg_dumpall --roles-only > D:\backup\roles.sql
```

If you want to back up [tablespaces](postgresql-create-tablespace 'PostgreSQL Tablespaces') definition, use the following command:

```plaintext
pg_dumpall --tablespaces-only > d:\backup\tablespaces.sql
```

## Creating backup script on Windows

The following backup script assumes that you have [a password file](postgresql-password-file-pgpass) setup properly.

First, open a text editor such a Notepad.

Second, write a batch script to generate backup file with a date and timestamp:

```bash
@echo off
REM Set variables for database connection
set PGUSER=your_username
set PGDATABASE=your_database_name

REM Set the path where you want to store the backup files
set BACKUP_DIR=C:\path\to\backup\directory

REM Get current date and time
for /f "tokens=2-4 delims=/ " %%a in ('date /t') do (set "datestamp=%%c-%%a-%%b")
for /f "tokens=1-2 delims=: " %%a in ('time /t') do (set "timestamp=%%a%%b")

REM Execute pg_dump command to dump the database
pg_dump -U %PGUSER% -d %PGDATABASE% -f "%BACKUP_DIR%\%PGDATABASE%_%datestamp%_%timestamp%.sql"
```

In the script, you need to replace `your_username`, `your_database_name`, and the `C:\path\to\backup\directory` with your actual ones that you want to use.

Third, save the script to a file with the .bat extension such as backup.bat.

Finally, run the script by double\-clicking it.

If you want to make a regular backup, you can use the Task Scheduler on Windows to run the backup.bat file periodically.

## Creating backup script on Linux or macOS

The following backup script assumes that you have a [password file](postgresql-password-file-pgpass) setup properly.

First, open a text editor.

Second, write a shell script to generate a backup file with a date and timestamp:

```shell
#!/bin/bash

# Set variables for database connection
PGUSER=your_username
PGDATABASE=your_database_name

# Set the path where you want to store the backup files
BACKUP_DIR=/path/to/backup/directory

# Get current date and time
datestamp=$(date +'%Y-%m-%d')
timestamp=$(date +'%H%M')

# Execute pg_dump command to dump the database
pg_dump -U "$PGUSER" -d "$PGDATABASE" > "$BACKUP_DIR/$PGDATABASE"_"$datestamp"_"$timestamp".sql

```

In this script, you need to replace `your_username`, `your_database_name`, and `/path/to/backup/directory` with your actual ones that you want to use.

Third, save the script with a `.sh` extension such as `backup.sh`.

Fourth, make the script executable by executing the following command on your terminal:

```css
chmod +x backup_script.sh
```

Fifth, run the script by executing it in your terminal:

```
./backup.sh
```

This will execute the `pg_dump` command to dump your database into a backup file with extension .sql with the current date and timestamp appended to its name.

If you want to backup a database regularly, you can create a cron job to run the script periodically.

## Summary

- Back up PostgreSQL databases regularly for recovery later.
- Use the `pg_dump` and `pg_dumpall` tools to perform logical backups.
- Use a password file to automate the backup processes.


# Restore Databases

---
title: 'PostgreSQL Restore Database'
page_title: 'PostgreSQL Restore Database'
page_description: 'In this tutorial, you will learn how to restore a PostgreSQL database by using the pg_restore utility.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-restore-database/'
ogImage: ''
updatedOn: '2024-02-18T14:24:02+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Backup'
  slug: 'postgresql-administration/postgresql-backup-database'
nextLink:
  title: 'PostgreSQL Show Databases'
  slug: 'postgresql-administration/postgresql-show-databases'
---

**Summary**: in this tutorial, you will learn how to restore a database by using a **PostgreSQL restore** tool called `pg_restore`.

## Introduction to the PostgreSQL pg_restore tool

[To perform a logical backup of a PostgreSQL database](postgresql-backup-database), you use the `pg_dump` tool. To back up all the databases on a PostgreSQL cluster, you use the `pg_dumpall` tool.

Both `pg_dump` and `pg_dumpall` tools create a snapshot of one or all databases at the time the command starts running.

To restore a database created by the `pg_dump` or `pg_dumpall` tools, you can use the `pg_restore` tool.

The `pg_restore` tool allows you to restore the PostgreSQL database from an archive file.

Here’s the syntax of the `pg_restore` command:

```csssql
pg_restore [connection-option] [option] [filename]
```

The following table presents the most commonly used command\-line options for the `pg_restore` utility:

| Option                       | Description                                                                                                                                                                   |
| ---------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| \-U, –username\=USERNAME     | Specifies the username that you use to connect to the PostgreSQL server.                                                                                                      |
| \-h, –host\=HOSTNAME         | Specifies the hostname of the server on which the PostgreSQL server is running.                                                                                               |
| \-p, –port\=PORT             | Specifies the port number on which the PostgreSQL server is listening.                                                                                                        |
| \-d, –dbname\=DBNAME         | Specifies the name of the database that you want to restore into.                                                                                                             |
| \-t, –table\=TABLE           | Specifies one or more tables that you want to restore. If you restore multiple tables, you need to separate them by commas.                                                   |
| \-v, –verbose                | Shows verbose output that including information about the objects being restored.                                                                                             |
| \-c, –clean                  | Drops existing database objects from the database before restoring the dump.                                                                                                  |
| \-C, –create                 | Creates the database before restoring it.                                                                                                                                     |
| \-e, –exit\-on\-error        | Stops the restore process in case of an error.                                                                                                                                |
| \-F, –format\=FORMAT         | Specifies the format of the input file (e.g., custom, directory, tar).                                                                                                        |
| \-j, –jobs\=NUM              | Specifies the number of parallel jobs to use when restoring data.                                                                                                             |
| \-n, –schema\=SCHEMA         | Specifies one or more schema of the database objects that you want to restore the objects. If you restore objects from multiple schemas, you need to separate them by commas. |
| \-L, –use\-list\=FILENAME    | Specifies a file containing a list of files that you want to restore.                                                                                                         |
| \-t, –tablespace\=TABLESPACE | Specifies the tablespace for the tables that you want to restore.                                                                                                             |
| \-v, –version                | Shows the version of pg_restore and exits.                                                                                                                                    |
| \-?, –help                   | Shows help and usage information.                                                                                                                                             |

## PostgreSQL Restore Database example

First, open the Command Prompt on Windows or Terminal on Unix\-like systems.

Second, back up the dvdrental database to a directory such as D:\\backup\\

```css
pg_dump -U postgres -d dvdrental -F tar -f d:\backup\dvdrental.tar

```

It’ll prompt you to enter the password for the user `postgres`. After entering a valid password, the `pg_dump` will create an archive file dvdrental.tar in the `D:\backup` file.

Third, connect to the PostgreSQL server:

```php
psql -U postgres
```

Fourth, drop the `dvdrental` database:

```
drop database dvdrental;
```

Fifth, create a new empty `dvdrental` database:

```
create database dvdrental;
```

Sixth, exit the psql:

```
exit
```

Seven, restore the dvdrental database from the backup file using the pg_restore tool:

```php
pg_restore -U postgres -d dvdrental D:/backup/dvdrental.tar
```

Eight, connect to the dvdrental database:

```
psql -U postgres -d dvdrental
```

Ninth, show the tables:

```
\dt
```

It returns all the tables in the dvdrental database.

Finally, exit the psql:

```
exit
```

## Summary

- Use the `pg_restore` tool to restore a PostgreSQL database from an archive file.


# Administration Tips

# Reset Password

---
title: 'Reset Forgotten Password For postgres User'
page_title: 'How To Reset Forgotten Password Of postgres User'
page_description: 'In this tutorial, we will show you step by step how to reset forgotten password of postgres user in PostgreSQL.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-reset-password/'
ogImage: ''
updatedOn: '2024-01-31T11:04:04+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Row-Level Security'
  slug: 'postgresql-administration/postgresql-row-level-security'
nextLink:
  title: 'How to Change the Password of a PostgreSQL User'
  slug: 'postgresql-administration/postgresql-change-password'
---

**Summary**: in this tutorial, you will learn step\-by\-step how to reset the password of the `postgres` user in PostgreSQL.

For some reason, after [installing PostgreSQL](../postgresql-getting-started/install-postgresql), you may forget the password of the `postgres` user. In such cases, you need to know how to reset the password to regain access to the PostgreSQL server.

PostgreSQL uses the `pg_hba.conf` configuration file stored in the database data directory (e.g., `C:\Program Files\PostgreSQL\16\data` on Windows) to control the client authentication. The `hba` in `pg_hba.conf` means host\-based authentication.

To reset the password for the `postgres` user, you need to follow these steps:

- First, modify some parameters in the `pg_hba.conf` configuration file.
- Log in to the PostgreSQL server using the `postgres` user account without a password.
- Reset the password.

The following steps show you how to reset a password for the `postgres` user:

**Step 1**. Backup the `pg_hba.conf` file by copying it to a different location or rename it to `pg_hba.conf.bk`

**Step 2**. Edit the `pg_dba.conf` file and change all local connections from `scram-sha-256` to `trust`. By doing this, you can log in to the PostgreSQL database server without using a password.

```phpsqlsql
# TYPE  DATABASE        USER            ADDRESS                 METHOD

# IPv4 local connections:
host    all             all             127.0.0.1/32            trust
# IPv6 local connections:
host    all             all             ::1/128                 trust
# Allow replication connections from localhost, by a user with the
# replication privilege.
host    replication     all             127.0.0.1/32            trust
host    replication     all             ::1/128                 trust
```

**Step 3**. Restart the PostgreSQL server. If you are on Windows, you can restart the PostgreSQL from **Services**.

Alternatively, you can run the following command from the Command Prompt (notice that you need to run the Command Prompt as the Administrator):

```
pg_ctl -D "C:\Program Files\PostgreSQL\16\data" restart
```

The `"C:\Program Files\PostgreSQL\16\data"` is the data directory.

**Step 4**. Connect to PostgreSQL database server using any tool such as psql or pgAdmin:

```
psql -U postgres
```

PostgreSQL will not require a password to log in.

**Step 5**. Execute the following command to set a new password for the `postgres` user.

```
postgres=# ALTER USER postgres WITH PASSWORD 'new_password';
```

**Step 6**. Restore the `pg_dba.conf` file, restart the PostgreSQL database server, and connect to the PostgreSQL database server with the new password.

In this tutorial, you have learned how to reset the password of the `postgres` user.


# Describe Table

---
title: 'PostgreSQL Describe Table'
page_title: 'PostgreSQL DESCRIBE TABLE'
page_description: 'Show you how to query information on columns of a table using psql tool and information_schema in PostgreSQL, like DESCRIBE TABLE in MySQL.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-describe-table/'
ogImage: ''
updatedOn: '2024-02-01T08:44:30+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Show Tables'
  slug: 'postgresql-administration/postgresql-show-tables'
nextLink:
  title: '17 Practical psql Commands You Don’t Want to Miss'
  slug: 'postgresql-administration/psql-commands'
---

**Summary**: in this tutorial, you will learn how to use the `psql` tool and `information_schema` to describe tables in PostgreSQL.

If you have been using MySQL, you typically use the [`DESCRIBE`](https://www.mysqltutorial.org/mysql-administration/mysql-show-columns/) statement to find the information about a table.

PostgreSQL does not support the `DESCRIBE`statement. However, you can query the information in columns of a table in a couple of ways.

## 1\) PostgreSQL DESCRIBE TABLE using psql

First, [connect to the PostgreSQL server](../postgresql-getting-started/connect-to-postgresql-database) using the `psql` tool:

```shellsql
psql -U postgres
```

It’ll prompt you to enter a password for the `postgres` user.

Second, change the current database to `dvdrental` [sample database](../postgresql-getting-started/postgresql-sample-database):

```shell
\c dvdrental
```

Third, execute the `\d table_name` to or `\d+ table_name` to show the structure of a table. For example, the following shows the structure of the `film` table in the sample database:

```php
\d film
```

Output:

```
                                              Table "public.film"
      Column      |            Type             | Collation | Nullable |                Default
------------------+-----------------------------+-----------+----------+---------------------------------------
 film_id          | integer                     |           | not null | nextval('film_film_id_seq'::regclass)
 title            | character varying(255)      |           | not null |
 description      | text                        |           |          |
 release_year     | year                        |           |          |
 language_id      | smallint                    |           | not null |
 rental_duration  | smallint                    |           | not null | 3
 rental_rate      | numeric(4,2)                |           | not null | 4.99
 length           | smallint                    |           |          |
 replacement_cost | numeric(5,2)                |           | not null | 19.99
 rating           | mpaa_rating                 |           |          | 'G'::mpaa_rating
 last_update      | timestamp without time zone |           | not null | now()
 special_features | text[]                      |           |          |
 fulltext         | tsvector                    |           | not null |
Indexes:
    "film_pkey" PRIMARY KEY, btree (film_id)
    "film_fulltext_idx" gist (fulltext)
    "idx_fk_language_id" btree (language_id)
    "idx_title" btree (title)
Foreign-key constraints:
    "film_language_id_fkey" FOREIGN KEY (language_id) REFERENCES language(language_id) ON UPDATE CASCADE ON DELETE RESTRICT
Referenced by:
    TABLE "film_actor" CONSTRAINT "film_actor_film_id_fkey" FOREIGN KEY (film_id) REFERENCES film(film_id) ON UPDATE CASCADE ON DELETE RESTRICT
    TABLE "film_category" CONSTRAINT "film_category_film_id_fkey" FOREIGN KEY (film_id) REFERENCES film(film_id) ON UPDATE CASCADE ON DELETE RESTRICT
    TABLE "inventory" CONSTRAINT "inventory_film_id_fkey" FOREIGN KEY (film_id) REFERENCES film(film_id) ON UPDATE CASCADE ON DELETE RESTRICT
Triggers:
    film_fulltext_trigger BEFORE INSERT OR UPDATE ON film FOR EACH ROW EXECUTE FUNCTION tsvector_update_trigger('fulltext', 'pg_catalog.english', 'title', 'description')
    last_updated BEFORE UPDATE ON film FOR EACH ROW EXECUTE FUNCTION last_updated()
```

The command returns a lot of information on the structure of the `film` table. Additionally, it returns [indexes](../postgresql-indexes), [foreign key constraints](../postgresql-tutorial/postgresql-foreign-key), and [triggers](../postgresql-triggers).

## 2\) PostgreSQL DESCRIBE TABLE using information_schema

The `information_schema.columns` catalog contains the information on columns of all tables. To get information on columns of a table, you query the `information_schema.columns` catalog.

For example:

```php
SELECT
  column_name,
  data_type,
  character_maximum_length,
  is_nullable,
  column_default
FROM
  information_schema.columns
WHERE
  table_name = 'film';
```

Output:

```
   column_name    |          data_type          | character_maximum_length | is_nullable |            column_default
------------------+-----------------------------+--------------------------+-------------+---------------------------------------
 film_id          | integer                     |                     null | NO          | nextval('film_film_id_seq'::regclass)
 title            | character varying           |                      255 | NO          | null
 description      | text                        |                     null | YES         | null
 release_year     | integer                     |                     null | YES         | null
 language_id      | smallint                    |                     null | NO          | null
 rental_duration  | smallint                    |                     null | NO          | 3
 rental_rate      | numeric                     |                     null | NO          | 4.99
 length           | smallint                    |                     null | YES         | null
 replacement_cost | numeric                     |                     null | NO          | 19.99
 rating           | USER-DEFINED                |                     null | YES         | 'G'::mpaa_rating
 last_update      | timestamp without time zone |                     null | NO          | now()
 special_features | ARRAY                       |                     null | YES         | null
 fulltext         | tsvector                    |                     null | NO          | null
(13 rows)
```

Note that the `SELECT *` from the `information_schema.columns` will retrieve a comprehensive set of information.

## Summary

- Use the `\d table_name` to show the structure of the table using `psql`.
- Query data from the `information_schema.columns` to retrieve the column information.


# Show Databases

---
title: 'PostgreSQL Show Databases'
page_title: 'PostgreSQL Show Databases'
page_description: 'In this tutorial, you will learn how to show databases in a PostgreSQL server using psql and pg_database catalog.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-show-databases/'
ogImage: ''
updatedOn: '2024-02-07T13:11:13+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Restore Database'
  slug: 'postgresql-administration/postgresql-restore-database'
nextLink:
  title: 'PostgreSQL Show Tables'
  slug: 'postgresql-administration/postgresql-show-tables'
---

**Summary**: in this tutorial, you will learn how to show databases in a PostgreSQL database server.

In MySQL, you can show all databases in the server using [`SHOW DATABASES`](https://www.mysqltutorial.org/mysql-administration/mysql-show-databases/) statement.

PostgreSQL does not directly support the `SHOW DATABASES` statement but offers you something similar. PostgreSQL provides you with two ways to show databases in a PostgreSQL database server.

## Listing databases in PostgreSQL using psql command

First, open the Command Prompt on Windows or Terminal on Unix\-like systems and connect to the PostgreSQL server:

```phpsql
psql -U postgres
```

This statement uses the postgres user to connect to the local PostgreSQL server. It’ll prompt you to enter a password.

Second, show all the databases in the current server using the `\l` command:

```
\l
```

It’ll show the following output:

```
                                                                      List of databases
   Name    |  Owner   | Encoding | Locale Provider |          Collate           |           Ctype            | ICU Locale | ICU Rules |   Access privileges
-----------+----------+----------+-----------------+----------------------------+----------------------------+------------+-----------+-----------------------
 dvdrental | postgres | UTF8     | libc            | English_United States.1252 | English_United States.1252 |            |           |
 postgres  | postgres | UTF8     | libc            | English_United States.1252 | English_United States.1252 |            |           |
 template0 | postgres | UTF8     | libc            | English_United States.1252 | English_United States.1252 |            |           | =c/postgres          +
           |          |          |                 |                            |                            |            |           | postgres=CTc/postgres
 template1 | postgres | UTF8     | libc            | English_United States.1252 | English_United States.1252 |            |           | =c/postgres          +
           |          |          |                 |                            |                            |            |           | postgres=CTc/postgres
(4 rows)
```

To display more information on databases, you can use the `\l+` command:

```shell
\l+
```

## Listing databases in PostgreSQL using SELECT statement

The following statement retrieves the database names from the `pg_database` view:

```shell
SELECT datname FROM pg_database;
```

Output:

```
  datname
-----------
 postgres
 dvdrental
 template1
 template0
(4 rows)
```

The query returns four databases in the current PostgreSQL server.

## Summary

- Use `\l` or `\l+` in `psql` to show all databases in a PostgreSQL database server.
- Use the `SELECT` statement to query data from the `pg_database` to retrieve all the database names in a PostgreSQL database server.


# Show Tables

---
title: 'PostgreSQL Show Tables'
page_title: 'PostgreSQL Show Tables'
page_description: 'This tutorial shows you various ways to show tables in a specific database using psql and querying pg_catalog schema in PostgreSQL'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-show-tables/'
ogImage: ''
updatedOn: '2024-02-01T08:32:56+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Show Databases'
  slug: 'postgresql-administration/postgresql-show-databases'
nextLink:
  title: 'PostgreSQL Describe Table'
  slug: 'postgresql-administration/postgresql-describe-table'
---

**Summary**: in this tutorial, you will learn how to show tables in PostgreSQL using `psql` tool and `pg_catalog` schema.

MySQL offers a popular [`SHOW TABLES`](http://www.mysqltutorial.org/mysql-show-tables/) statement that displays all tables in a specific database.

Unfortunately, PostgreSQL does not support the `SHOW TABLES` statement directly but provides you with alternatives.

## Showing tables from PostgreSQL using psql

First, open the Command Prompt on Windows or Terminal on Unix\-like systems and connect to the PostgreSQL using psql client tool:

```phpsql
psql -U postgres
```

Second, change the current database to the one that you want to show tables:

```
\c dvdrental
```

Note that you can connect to a specific database when you log in to the PostgreSQL database server:

```
psql -U postgres -d dvdrental
```

In this command, the `-d` flag means **d**atabase. In this command, you connect to the `dvdrental` database using the `postgres` user.

Third, use the `\dt` command from the PostgreSQL command prompt to show tables in the `dvdrental` database:

```
\dt
```

Output:

```
             List of relations
 Schema |     Name      | Type  |  Owner
--------+---------------+-------+----------
 public | actor         | table | postgres
 public | address       | table | postgres
 public | category      | table | postgres
 public | city          | table | postgres
 public | country       | table | postgres
 public | customer      | table | postgres
 public | film          | table | postgres
 public | film_actor    | table | postgres
 public | film_category | table | postgres
 public | inventory     | table | postgres
 public | language      | table | postgres
 public | payment       | table | postgres
 public | rental        | table | postgres
 public | staff         | table | postgres
 public | store         | table | postgres
(15 rows)
```

To get more information on tables, you can use the `\dt+` command. It will add the `size` and `description` columns:

```php
\dt+
```

Output:

```
                                         List of relations
 Schema |     Name      | Type  |  Owner   | Persistence | Access method |    Size    | Description
--------+---------------+-------+----------+-------------+---------------+------------+-------------
 public | actor         | table | postgres | permanent   | heap          | 40 kB      |
 public | address       | table | postgres | permanent   | heap          | 88 kB      |
 public | category      | table | postgres | permanent   | heap          | 8192 bytes |
 public | city          | table | postgres | permanent   | heap          | 64 kB      |
 public | country       | table | postgres | permanent   | heap          | 8192 bytes |
 public | customer      | table | postgres | permanent   | heap          | 96 kB      |
 public | film          | table | postgres | permanent   | heap          | 736 kB     |
 public | film_actor    | table | postgres | permanent   | heap          | 272 kB     |
 public | film_category | table | postgres | permanent   | heap          | 72 kB      |
 public | inventory     | table | postgres | permanent   | heap          | 232 kB     |
 public | language      | table | postgres | permanent   | heap          | 8192 bytes |
 public | payment       | table | postgres | permanent   | heap          | 896 kB     |
 public | rental        | table | postgres | permanent   | heap          | 1232 kB    |
 public | staff         | table | postgres | permanent   | heap          | 16 kB      |
 public | store         | table | postgres | permanent   | heap          | 8192 bytes |
(15 rows)
```

To show the details of a specific table, you can specify the name of the table after the \\d command:

```php
\d table_name
```

Or

```
\d+ table_name
```

For example, the following shows the structure of the actor table:

```
\d actor
```

Output:

```
                                            Table "public.actor"
   Column    |            Type             | Collation | Nullable |                 Default
-------------+-----------------------------+-----------+----------+-----------------------------------------
 actor_id    | integer                     |           | not null | nextval('actor_actor_id_seq'::regclass)
 first_name  | character varying(45)       |           | not null |
 last_name   | character varying(45)       |           | not null |
 last_update | timestamp without time zone |           | not null | now()
Indexes:
    "actor_pkey" PRIMARY KEY, btree (actor_id)
    "idx_actor_first_name" btree (first_name)
    "idx_actor_last_name" btree (last_name)
Referenced by:
    TABLE "film_actor" CONSTRAINT "film_actor_actor_id_fkey" FOREIGN KEY (actor_id) REFERENCES actor(actor_id) ON UPDATE CASCADE ON DELETE RESTRICT
Triggers:
    last_updated BEFORE UPDATE ON actor FOR EACH ROW EXECUTE FUNCTION last_updated()
```

## Showing tables using pg_catalog schema

The following statement retrieves the table in PostgreSQL from the `pg_catalog.pg_tables` view:

```php
SELECT *
FROM pg_catalog.pg_tables
WHERE schemaname != 'pg_catalog' AND
    schemaname != 'information_schema';
```

Output:

```
 schemaname |   tablename   | tableowner | tablespace | hasindexes | hasrules | hastriggers | rowsecurity
------------+---------------+------------+------------+------------+----------+-------------+-------------
 public     | actor         | postgres   | null       | t          | f        | t           | f
 public     | store         | postgres   | null       | t          | f        | t           | f
 public     | address       | postgres   | null       | t          | f        | t           | f
 public     | category      | postgres   | null       | t          | f        | t           | f
 public     | city          | postgres   | null       | t          | f        | t           | f
 public     | country       | postgres   | null       | t          | f        | t           | f
 public     | customer      | postgres   | null       | t          | f        | t           | f
 public     | film_actor    | postgres   | null       | t          | f        | t           | f
 public     | film_category | postgres   | null       | t          | f        | t           | f
 public     | inventory     | postgres   | null       | t          | f        | t           | f
 public     | language      | postgres   | null       | t          | f        | t           | f
 public     | rental        | postgres   | null       | t          | f        | t           | f
 public     | staff         | postgres   | null       | t          | f        | t           | f
 public     | payment       | postgres   | null       | t          | f        | t           | f
 public     | film          | postgres   | null       | t          | f        | t           | f
(15 rows)
```

In this query, we use a condition in the [`WHERE`](../postgresql-tutorial/postgresql-where) clause to exclude the system tables. If you omit the `WHERE` clause, you will get many tables including the system ones.

## Summary

- Use the `\dt` or `\dt+` command in `psql` to show tables in a specific database.
- Use the `SELECT` statement to query table information from the `pg_catalog.pg_tables` catalog.


# Practical psql Commands

---
title: '17 Practical psql Commands You Don’t Want to Miss'
page_title: "17 Practical psql Commands That You Don't Want To Miss"
page_description: 'You will learn how to use practical psql commands to interact with the PostgreSQL database server effectively.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/psql-commands/'
ogImage: '/postgresqltutorial/psql-commands.jpg'
updatedOn: '2024-01-16T06:44:49+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Describe Table'
  slug: 'postgresql-administration/postgresql-describe-table'
nextLink:
  title: 'How to Uninstall PostgreSQL from Ubuntu'
  slug: 'postgresql-administration/uninstall-postgresql-ubuntu'
---

**Summary**: In this tutorial, you will learn how to use practical psql commands to interact with the PostgreSQL database server effectively.

## 1\) Connect to PostgreSQL database

The following command [connects to a database](../postgresql-jdbc/connecting-to-postgresql-database) under a specific user. After pressing `Enter` PostgreSQL will ask for the password of the user.

```phpsql
psql -d database -U  user -W
```

For example, to connect to `dvdrental` database under `postgres` user, you use the following command:

```bash
psql -d dvdrental -U postgres -W
Password for user postgres:
dvdrental=#
```

If you want to connect to a database that resides on another host, you add the \-h option as follows:

```bash
psql -h host -d database -U user -W
```

In case you want to use SSL mode for the connection, just specify it as shown in the following command:

```bash
psql -U user -h host "dbname=db sslmode=require"
```

## 2\) Switch connection to a new database

Once you are connected to a database, you can switch the connection to a new database under a user\-specified by `user`. The previous connection will be closed. If you omit the `user` parameter, the current `user` is assumed.

```text
\c dbname username
```

The following command connects to `dvdrental` database under `postgres` user:

```
postgres=# \c dvdrental
You are now connected to database "dvdrental" as user "postgres".
dvdrental=#
```

## 3\) List available databases

To [list all databases](postgresql-show-databases) in the current PostgreSQL database server, you use `\l` command:

```
\l
```

## 4\) List available tables

To [list all tables](postgresql-show-tables) in the current database, you use the `\dt` command:

```text
\dt
```

Note that this command shows the only table in the currently connected database.

## 5\) Describe a table

To [describe a table](postgresql-describe-table) such as a column, type, or modifiers of columns, you use the following command:

```text
\d table_name
```

## 6\) List available schema

To list all [schemas](postgresql-schema) of the currently connected database, you use the `\dn` command.

```text
\dn
```

## 7\) List available functions

To list available functions in the current database, you use the `\df` command.

```text
\df
```

## 8\) List available views

To list available [views](../postgresql-views) in the current database, you use the `\dv` command.

```text
\dv
```

## 9\) List users and their roles

To list all users and their assigned roles, you use `\du` command:

```text
\du
```

## 10\) Execute the previous command

To retrieve the current version of PostgreSQL server, you use the `version()` function as follows:

```sql
SELECT version();
```

Now, if you want to save time typing the previous command again, you can use `\g` command to execute the previous command:

```text
\g
```

psql executes the previous command again, which is the [SELECT statement](../postgresql-tutorial/postgresql-select),.

## 11\) Command history

To display command history, you use the `\s` command.

```text
\s
```

If you want to save the command history to a file, you need to specify the file name followed the `\s` command as follows:

```text
\s filename
```

## 12\) Execute psql commands from a file

In case you want to execute psql commands from a file, you use `\i` command as follows:

```text
\i filename
```

## 13\) Get help on psql commands

To know all available psql commands, you use the `\?` command.

```text
\?
```

To get help on specific PostgreSQL statement, you use the `\h` command.

For example, if you want to know detailed information on the [ALTER TABLE](../postgresql-tutorial/postgresql-alter-table) statement, you use the following command:

```text
\h ALTER TABLE
```

## 14\) Turn on query execution time

To turn on query execution time, you use the `\timing` command.

```sql
dvdrental=# \timing
Timing is on.
dvdrental=# select count(*) from film;
 count
-------
  1000
(1 row)

Time: 1.495 ms
dvdrental=#
```

You use the same command `\timing` to turn it off.

```sql
dvdrental=# \timing
Timing is off.
dvdrental=#
```

## 15\) Edit command in your editor

It is very handy if you can type the command in your favorite editor. To do this in psql, you `\e` command. After issuing the command, psql will open the text editor defined by your EDITOR environment variable and place the most recent command that you entered in psql into the editor.

![psql commands](/postgresqltutorial/psql-commands.jpg)After you type the command in the editor, save it, and close the editor, psql will execute the command and return the result.

![psql command example](/postgresqltutorial/psql-command-example.jpg)
It is more useful when you edit a function in the editor.

```text
\ef [function name]
```

![psql commadn ef edit function](/postgresqltutorial/psql-command-ef-edit-function.jpg)

## 16\) Switch output options

psql supports some types of output format and allows you to customize how the output is formatted on the fly.

- `\a` command switches from aligned to non\-aligned column output.
- `\H` command formats the output to HTML format.

## 17\) Quit psql

To quit psql, you use `\q` command and press `Enter` to exit psql.

```text
\q
```

In this tutorial, you have learned how to use psql commands to perform various commonly used tasks in PostgreSQL.


# Restart PostgreSQL on Windows

---
title: 'How to Restart PostgreSQL on Windows'
page_title: 'How to Restart PostgreSQL on Windows'
page_description: 'In this tutorial, you will learn how to restart PostgreSQL on Windows using Service Manager, command line, and pg_ctl command.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/restart-postgresql-windows/'
ogImage: ''
updatedOn: '2024-02-21T01:45:41+00:00'
enableTableOfContents: true
previousLink:
  title: 'How to Restart PostgreSQL on Ubuntu'
  slug: 'postgresql-administration/postgresql-restart-ubuntu'
nextLink:
  title: 'PostgreSQL pg_terminate_backend() Function'
  slug: 'postgresql-administration/postgresql-pg_terminate_backend'
---

**Summary**: in this tutorial, you will learn how to restart PostgreSQL on Windows using Service Manager, command line, and `pg_ctl` command.

## 1\) Restart PostgreSQL using Services Manager (GUI)

The following steps describe how to restart PostgreSQL on Windows using Service Manager (GUI):

### Step 1\. Stop PostgreSQL service

- Press `Win+R` to open the **Run** dialog.
- Type `services.msc` and press `Enter`.
- In the `Services` window, locate the PostgreSQL service. Typically, it is something like `postgresql-x64-<version>`.
- Right\-click on it and select **Stop** to stop the service.

### Step 2\. Start PostgreSQL service

- After stopping the service, right\-click on the service name.
- Select **Start** to start the service.

## 2\) Restart PostgreSQL from the command line

If you prefer working with command, you can follow these steps to restart PostgreSQL:

### Step 1\. Open command prompt

- Press `Win+R` to open the **Run** dialog
- Type `cmd` and `press Ctrl+Shift+Enter` (not Enter). This will allow you to run the command prompt as an Administrator.
- A **User Account Control** pop\-up will display, you can click the **Yes** button to acknowledge.

### Step 2\. Restart PostgreSQL service

Stop the PostgreSQL service using the following command:

```xmlsql
net stop postgresql-x64-<version>
```

You need to replace `<version>` with your [PostgreSQL version](postgresql-version) number. For example:

```xml
net stop postgresql-x64-16
```

Output:

```
The postgresql-x64-16 - PostgreSQL Server 16 service is stopping.
The postgresql-x64-16 - PostgreSQL Server 16 service was stopped successfully.
```

After the service has stopped, type the following command and press `Enter` to start the PostgreSQL service:

```
net start postgresql-x64-<version>
```

For example:

```xml
net start postgresql-x64-16
```

Output:

```
The postgresql-x64-16 - PostgreSQL Server 16 service is starting.
The postgresql-x64-16 - PostgreSQL Server 16 service was started successfully.
```

## 3\) Restart PostgreSQL using the pg_ctl command (CLI)

PostgreSQL offers the `pg_ctl` utility that allows you to initialize a PostgreSQL database instance, and start, stop, or restart the PostgreSQL database server.

The `pg_ctl` is typically located in the bin directory within the PostgreSQL installation directory.

The following shows you how to execute the `pg_ctl` command to restart PostgreSQL.

It assumes that the `bin` directory is included in the `PATH` environment variable, allowing you to call `pg_ctl` from any directory.

### Step 1\. Open a command prompt

- Press `Win+R` to open the **Run** dialog.
- Type `cmd` and `press` `Ctrl+Shift+Enter` to run the Command Prompt as an Administrator.

### Step 2\. Execute the pg_ctl command

Type the following `pg_ctl` command and press `Enter`:

```
pg_ctl -D "C:\Program Files\PostgreSQL\<version>\data" restart
```

Note that you need to replace the `<version>` with the actual version of your PostgreSQL and change the data directory path (“`C:\Program Files\PostgreSQL\<version>\data`“) if it is different.

For example, to restart PostgreSQL 16\.x, you can execute the following command:

```
pg_ctl -D "C:\Program Files\PostgreSQL\16\data" restart
```

This command will restart PostgreSQL.


# Restart PostgreSQL on Ubuntu

---
title: 'How to Restart PostgreSQL on Ubuntu'
page_title: 'How to Restart PostgreSQL on Ubuntu'
page_description: 'In this tutorial, you will how to restart PostgreSQL on Ubuntu using systemctl, service command, and pg_ctrl command.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-restart-ubuntu/'
ogImage: ''
updatedOn: '2024-02-20T09:45:29+00:00'
enableTableOfContents: true
previousLink:
  title: 'How to Check PostgreSQL Version'
  slug: 'postgresql-administration/postgresql-version'
nextLink:
  title: 'How to Restart PostgreSQL on Windows'
  slug: 'postgresql-administration/restart-postgresql-windows'
---

**Summary**: in this tutorial, you will how to restart PostgreSQL on Ubuntu using `systemctl`, `service` command, and `pg_ctrl` command.

We assume that you have sufficient permissions to restart the PostgreSQL service or can use `sudo` to execute the commands with root privileges.

## Restarting PostgreSQL on Ubuntu using systemctl

First, open a terminal or SSH to the server where the PostgreSQL server is running.

Second, run the following command to restart the PostgreSQL server:

```httpsql
sudo systemctl restart postgresql

```

Third, check the status of the PostgreSQL service using the following command:

```
/etc/init.d/postgresql status

```

## Restarting PostgreSQL on Ubuntu using the service command

Alternatively, you can use the service command to restart the PostgreSQL service:

```
sudo service postgresql restart

```

## Restarting PostgreSQL on Ubuntu using the pg_ctl command

If you show more information about the restart process, you can use the `pg_ctl` command:

```
sudo -u postgres pg_ctl restart -D /var/lib/postgresql/<version>/main

```

In this command, you need to replace `<version>` with your PostgreSQL version number.

Note that the data directory is `/var/lib/postgresql/<version>/main` by default. If your PostgreSQL data directory is different, you need to adjust it accordingly.

For example, to restart PostgreSQL 16\.x, you can use the following command:

```bash
sudo -u postgres pg_ctl restart -D /var/lib/postgresql/16/main
```

If you encounter the following error, the `pg_ctl` may not be in your system’s PATH:

```bash
sudo: pg_ctl: command not found
```

To fix it, you need to create a symbolic link to pg_ctrl in `/usr/local/bin/`:

```xml
sudo ln -s /usr/lib/postgresql/<version>/bin/pg_ctl /usr/local/bin/pg_ctl
```

Replace the `<version>` with your PostgreSQL version number.

For example, the following command restarts the PostgreSQL 16\.x on Ubuntu:

```
sudo -u postgres pg_ctl restart -D /var/lib/postgresql/16/main
```

Now, you should be able to use `pg_ctl` from any directory.


# Get PostgreSQL Version

---
title: 'How to Check PostgreSQL Version'
page_title: 'How to Check PostgreSQL Version'
page_description: 'In this tutorial, you will learn how to use various ways to check the PostgreSQL version on your system.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-version/'
ogImage: ''
updatedOn: '2024-02-20T06:42:26+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Uptime'
  slug: 'postgresql-administration/postgresql-uptime'
nextLink:
  title: 'How to Restart PostgreSQL on Ubuntu'
  slug: 'postgresql-administration/postgresql-restart-ubuntu'
---

**Summary**: in this tutorial, you will learn various ways to check the PostgreSQL version on your system.

## 1\) Checking PostgreSQL version using psql

First, open Command Prompt on Windows or Terminal on a Unix\-like system.

Second, run the following command:

```csssql
psql --version
```

This command will display the PostgreSQL version installed on your server.

## 2\) Getting the version using SQL statements

First, connect to the PostgreSQL server using psql or GUI tools like pgAdmin.

For example, you can connect to the PostgreSQL server using psql:

```
psql -U postgres
```

Second, run the following statement to retrieve the version:

```
SELECT version();

```

The query will return a text that includes the PostgreSQL version. For example:

```text
                          version
------------------------------------------------------------
 PostgreSQL 16.1, compiled by Visual C++ build 1937, 64-bit
(1 row)
```

## 3\) Querying version from the information schema

First, connect to the PostgreSQL database using psql or a PostgreSQL client.

Second, execute the following query to get the PostgreSQL version:

```css
SELECT
  setting
FROM
  pg_settings
WHERE
  name = 'server_version';
```

Output:

```
 setting
---------
 16.1
(1 row)
```

## Summary

- Use the `psql --version` command, `select version()` statement, and retrieve the `setting` from the `pg_settings` to get the PostgreSQL version.


# Check PostgreSQL Uptime

---
title: 'PostgreSQL Uptime'
page_title: 'PostgreSQL Uptime'
page_description: "In this tutorial, you will learn how to calculate the PostgreSQL uptime based on the current time and the server's started time."
prev_url: 'https://www.postgresqltutorial.com/postgresql-administration/postgresql-uptime/'
ogImage: ''
updatedOn: '2024-02-20T06:03:34+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Password File .pgpass'
  slug: 'postgresql-administration/postgresql-password-file-pgpass'
nextLink:
  title: 'How to Check PostgreSQL Version'
  slug: 'postgresql-administration/postgresql-version'
---

**Summary**: in this tutorial, you will learn how to calculate the PostgreSQL uptime based on the current time and the server’s started time.

## Checking PostgreSQL uptime

First, open the Command Prompt on Windows or Terminal on Unix\-like systems and connect to the PostgreSQL server:

```csssql
psql -U postgres
```

Second, execute the following query to get the PostgreSQL uptime:

```
SELECT
  date_trunc(
    'second',
    current_timestamp - pg_postmaster_start_time()
  ) as uptime;
```

How it works

PostgreSQL stores the time when it was started in the database server. To retrieve the start time, you use the `pg_postmaster_start_time()` function as follows:

```sql
SELECT pg_postmaster_start_time();
```

Output:

```text
   pg_postmaster_start_time
-------------------------------
 2024-02-14 03:41:32.048451-07
(1 row)
```

You can then calculate the uptime based on the current time and the start time returned by the `pg_postmaster_start_time()` function:

```css
SELECT current_timestamp - pg_postmaster_start_time() uptime;
```

Output:

```text
         uptime
------------------------
 6 days 07:39:06.006459
(1 row)
```

You can truncate the microsecond from the uptime using the [`DATE_TRUNC()`](../postgresql-date-functions/postgresql-date_trunc) function to make the output more human\-readable:

```css
SELECT
  date_trunc(
    'second',
    current_timestamp - pg_postmaster_start_time()
  ) as uptime;
```

Output:

```
     uptime
-----------------
 6 days 07:39:24
(1 row)
```

## Summary

- Calculate the PostgreSQL uptime using the current time and start time.


# Advanced

# PostgreSQL Views

---
title: 'PostgreSQL Views'
page_title: 'PostgreSQL Views'
page_description: 'This section introduces you to PostgreSQL views and shows you how to manage views in the PostgreSQL database server.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-views/'
ogImage: ''
updatedOn: '2024-03-16T08:31:02+00:00'
enableTableOfContents: true
previousLink:
  title: 'Creating a PostgreSQL Trigger with a When Condition'
  slug: 'postgresql-triggers/postgresql-trigger-when-condition'
nextLink:
  title: 'PostgreSQL CREATE VIEW'
  slug: 'postgresql-views/managing-postgresql-views'
---

![PostgreSQL Views](/postgresqltutorial/PostgreSQL-View.png?alignright)
A view is a named query stored in the PostgreSQL database server. A view is defined based on one or more tables which are known as base tables, and the query that defines the view is referred to as a defining query.

After [creating a view](postgresql-views/managing-postgresql-views), you can query data from it as you would from a regular table. Behind the scenes, PostgreSQL will rewrite the query against the view and its defining query, executing it to retrieve data from the base tables.

Views do not store data except the [materialized views](postgresql-views/postgresql-materialized-views). In PostgreSQL, you can create special views called materialized views that store data physically and periodically refresh it from the base tables.

The materialized views are handy in various scenarios, providing faster data access to a remote server and serving as an effective caching mechanism.

## Advantages of PostgreSQL views

Views offer many advantages:

### 1\) Simplifying complex queries

Views help simplify complex queries. Instead of dealing with [joins](postgresql-tutorial/postgresql-joins), [aggregations](postgresql-aggregate-functions), or [filtering conditions](postgresql-tutorial/postgresql-where), you can query from views as if they were regular tables.

Typically, first, you create views based on complex queries and store them in the database. Then, you can use simple queries based on views instead of using complex queries.

### 2\) Security and access control

Views enable fine\-grained control over data access. You can create views that expose subsets of data in the base tables, hiding sensitive information.

This is particularly useful when you have applications that require access to distinct portions of the data.

### 3\) Logical data independence

If your applications use views, you can freely modify the structure of the base tables. In other words, views enable you to create a layer of abstraction over the underlying tables.

## Section 1\. Basic PostgreSQL views

In this section, you’ll learn about the fundamentals of PostgreSQL views including creating new views and removing existing views. These essential operations lay the strong foundation for using views effectively.

- [Create View](postgresql-views/managing-postgresql-views 'Managing PostgreSQL Views') – show you how to create a new view in your database.
- [Drop view](postgresql-views/postgresql-drop-view) – learn to drop one or more views from the database.

## Section 2\. Updatable views

In this section, you’ll learn how to create updatable views, which allow you to modify data through them. Additionally, you’ll learn how to enforce data modification using the `WITH CHECK OPTION` clause.

- [Create updatable views](postgresql-views/postgresql-updatable-views) – show how to create updatable views.
- [WITH CHECK OPTION](postgresql-views/postgresql-views-with-check-option) – guide you on how to enforce the data modification through a view based on a condition of the defining query.

## Section 3\. Materialized views

- [Materialized views](postgresql-views/postgresql-materialized-views 'PosgreSQL Materialized Views')  – introduce you to materialized views and provide you with the steps of creating and refreshing data for materialized views.

## Section 4\. Recursive views

- [Create recursive views](postgresql-views/postgresql-recursive-view) – explain the recursive view and show you how to create a recursive view in PostgreSQL.

## Section 5\. Managing views

This section discusses the management of the PostgreSQL views including altering views and listing views in the current database.

- [Alter view](postgresql-views/postgresql-alter-view) – learn how to rename a view, modify the check option, change a column, and set a new schema for a view.
- [List views in the current database](postgresql-views/postgresql-list-views) – show you how to list views in the current database using the `\dv` command in psql or querying from the `information_schema.views` view.


# Create Views

---
title: 'PostgreSQL CREATE VIEW'
page_title: 'PosgreSQL CREATE VIEW'
page_description: 'This tutorial shows you how to use the CREATE VIEW statement to create a new view in your database.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-views/managing-postgresql-views/'
ogImage: '/postgresqltutorial/customer.png'
updatedOn: '2024-03-16T04:07:27+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Views'
  slug: 'postgresql-views/'
nextLink:
  title: 'PostgreSQL Drop View'
  slug: 'postgresql-views/postgresql-drop-view'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `CREATE VIEW` statement to create a new view in your database.

## PostgreSQL CREATE VIEW statement

In PostgreSQL, a view is a named query stored in the database server. To create a new view, you can use the `CREATE VIEW` statement.

Here’s the basic syntax of the `CREATE VIEW` statement:

```phpsql
CREATE VIEW view_name
AS
  query;
```

In this syntax:

- First, specify the name of the view after the `CREATE VIEW` keywords.
- Second, specify a `SELECT` statement (`query`) that defines the view. The query is often referred to as the **defining query** of the view.

## PostgreSQL CREATE VIEW statement examples

Let’s take some examples of using the `CREATE VIEW` statement.

We’ll use the `customer` table from the [sample database](../postgresql-getting-started/postgresql-sample-database):

![customer table](/postgresqltutorial/customer.png)

### 1\) Basic CREATE VIEW statement example

The following example uses the `CREATE VIEW` statement to create a view based on the `customer` table:

```sql
CREATE VIEW contact AS
SELECT
  first_name,
  last_name,
  email
FROM
  customer;
```

Output:

```sql
CREATE VIEW
```

The following query data from the `contact` view:

```
SELECT * FROM contact;
```

Output:

```text
 first_name  |  last_name   |                  email
-------------+--------------+------------------------------------------
 Jared       | Ely          | [[email protected]](../cdn-cgi/l/email-protection.html)
 Mary        | Smith        | [[email protected]](../cdn-cgi/l/email-protection.html)
 Patricia    | Johnson      | [[email protected]](../cdn-cgi/l/email-protection.html)
...
```

### 2\) Using the CREATE VIEW statement to create a view based on a complex query

The following example creates a view based on the tables `customer`, `address`, `city`, and `country`:

```
CREATE VIEW customer_info AS
SELECT
  first_name,
  last_name,
  email,
  phone,
  city,
  postal_code,
  country
FROM
  customer
  INNER JOIN address USING (address_id)
  INNER JOIN city USING (city_id)
  INNER JOIN country USING (country_id);
```

The following query retrieves data from the `customer_info` view:

```sql
SELECT * FROM customer_info;
```

Output:

```
 first_name  |  last_name   |                  email                   |    phone     |            city            | postal_code |                country
-------------+--------------+------------------------------------------+--------------+----------------------------+-------------+---------------------------------------
 Jared       | Ely          | [[email protected]](../cdn-cgi/l/email-protection.html)             | 35533115997  | Purwakarta                 | 25972       | Indonesia
 Mary        | Smith        | [[email protected]](../cdn-cgi/l/email-protection.html)            | 28303384290  | Sasebo                     | 35200       | Japan
 Patricia    | Johnson      | [[email protected]](../cdn-cgi/l/email-protection.html)      | 838635286649 | San Bernardino             | 17886       | United States
...
```

### 3\) Creating a view based on another view

The following statement creates a view called `customer_usa` based on the `customer_info` view. The `customer_usa` returns the customers who are in the `United States`:

```
CREATE VIEW customer_usa
AS
SELECT
  *
FROM
  customer_info
WHERE
  country = 'United States';
```

Here’s the query that retrieves data from the customer_usa view:

```sql
SELECT * FROM customer_usa;
```

Output:

```
 first_name | last_name  |                email                 |    phone     |          city           | postal_code |    country
------------+------------+--------------------------------------+--------------+-------------------------+-------------+---------------
 Zachary    | Hite       | [[email protected]](../cdn-cgi/l/email-protection.html)      | 191958435142 | Akron                   | 88749       | United States
 Richard    | Mccrary    | [[email protected]](../cdn-cgi/l/email-protection.html)   | 262088367001 | Arlington               | 42141       | United States
 Diana      | Alexander  | [[email protected]](../cdn-cgi/l/email-protection.html)   | 6171054059   | Augusta-Richmond County | 30695       | United States
...
```

## Replacing a view

To change the defining query of a view, you use the `CREATE OR REPLACE VIEW` statement:

```
CREATE OR REPLACE VIEW view_name
AS
  query;
```

In this syntax, you add the `OR REPLACE` between the `CREATE` and `VIEW` keywords. If the view already exists, the statement replaces the existing view; otherwise, it creates a new view.

For example, the following statement changes the defining query of the `contact` view to include the `phone` information from the `address` table:

```sql
CREATE OR REPLACE VIEW contact AS
SELECT
  first_name,
  last_name,
  email,
  phone
FROM
  customer
INNER JOIN address USING (address_id);
```

## Display a view on psql

To display a view on `psql`, you follow these steps:

First, open the Command Prompt on Windows or Terminal on Unix\-like systems and connect to the PostgreSQL server:

```
psql -U postgres
```

Second, change the current database to `dvdrental`:

```
\c dvdrental
```

Third, display the view information using the `\d+ view_name` command. For example, the following shows the `contact` view:

```
\d+ contact
```

Output:

```
                                    View "public.contact"
   Column   |         Type          | Collation | Nullable | Default | Storage  | Description
------------+-----------------------+-----------+----------+---------+----------+-------------
 first_name | character varying(45) |           |          |         | extended |
 last_name  | character varying(45) |           |          |         | extended |
 email      | character varying(50) |           |          |         | extended |
 phone      | character varying(20) |           |          |         | extended |
View definition:
 SELECT customer.first_name,
    customer.last_name,
    customer.email,
    address.phone
   FROM customer
     JOIN address USING (address_id);

```

## Summary

- Use the PostgreSQL `CREATE VIEW` statement to create a new view in your database.
- Use the `\d+` command in psql to display the information of a view.


# Drop Views

---
title: 'PostgreSQL Drop View'
page_title: 'PostgreSQL DROP VIEW Statement Explained By Practical Examples'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL DROP VIEW statement to remove one or more views from the database.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-views/postgresql-drop-view/'
ogImage: '/postgresqltutorial/film-film_category-category-tables.png'
updatedOn: '2024-03-16T04:09:52+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CREATE VIEW'
  slug: 'postgresql-views/managing-postgresql-views'
nextLink:
  title: 'Creating PostgreSQL Updatable Views'
  slug: 'postgresql-views/postgresql-updatable-views'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `DROP VIEW` statement to delete a view from your database.

## Introduction to PostgreSQL DROP VIEW statement

The `DROP VIEW` statement allows you to remove a view from the database.

Here’s the basic syntax of the `DROP VIEW` statement:

```sqlsql
DROP VIEW [IF EXISTS] view_name
[CASCADE | RESTRICT];
```

In this syntax:

- First, specify the name of the view in the `DROP VIEW` clause.
- Second, use `IF EXISTS` to prevent an error if the view does not exist. PostgreSQL will issue a notice instead of an error when you attempt to remove a non\-existing view. The `IF EXISTS` is optional.
- Third, use `CASCADE` option to remove dependent objects along with the view or the `RESTRICT` option to reject the removal of the view if other objects depend on the view. The `RESTRICT` option is the default.

### Dropping multiple views

To drop multiple views simultaneously, you specify the view names separated by commas after the `DROP VIEW` keywords:

```sql
DROP VIEW [IF EXISTS] view_name1, view_name2, ...
[CASCADE | RESTRICT];
```

### Permissions

To execute the `DROP VIEW` statement, you need to be the owner of the view or have a `DROP` privilege on it.

## PostgreSQL DROP VIEW statement examples

We’ll use the following tables `film`, `film_category`, and `category` from the [sample database](../postgresql-getting-started/postgresql-sample-database):

![film film_category category tables](/postgresqltutorial/film-film_category-category-tables.png)

### Creating views for practicing

The following statement creates a new view called `film_info` based on the `film`, `film_category`, and `category` tables:

```shell
CREATE VIEW film_info AS
SELECT
  film_id,
  title,
  release_year,
  length,
  name category
FROM
  film
  INNER JOIN film_category USING (film_id)
  INNER JOIN category USING(category_id);
```

The following statement creates a view called `horror_film` based on the `film_info` view:

```sql
CREATE VIEW horror_film AS
SELECT
  film_id,
  title,
  release_year,
  length
FROM
  film_info
WHERE
  category = 'Horror';
```

The following statement creates a view called `comedy_film` based on the `film_master` view:

```sql
CREATE VIEW comedy_film AS
SELECT
  film_id,
  title,
  release_year,
  length
FROM
  film_info
WHERE
  category = 'Comedy';
```

The following statement creates a view called `film_category_stat` that returns the number of films by category:

```sql
CREATE VIEW film_category_stat AS
SELECT
  name,
  COUNT(film_id)
FROM
  category
  INNER JOIN film_category USING (category_id)
  INNER JOIN film USING (film_id)
GROUP BY
  name;
```

The following creates a view called `film_length_stat` that returns the total length of films for each category:

```sql
CREATE VIEW film_length_stat AS
SELECT
  name,
  SUM(length) film_length
FROM
  category
  INNER JOIN film_category USING (category_id)
  INNER JOIN film USING (film_id)
GROUP BY
  name;
```

### 1\) Using the DROP VIEW statement to drop one view example

The following example uses the `DROP VIEW` statement to drop the `comedy_film` view:

```sql
DROP VIEW comedy_film;
```

### 2\) Using the DROP VIEW statement to drop a view that has dependent objects

The following statement uses the `DROP VIEW` statement to drop the `film_info` view:

```sql
DROP VIEW film_info;
```

PostgreSQL issued an error:

```sql
ERROR:  cannot drop view film_info because other objects depend on it
DETAIL:  view horror_film depends on view film_info
HINT:  Use DROP ... CASCADE to drop the dependent objects too.
```

The `film_info` has a dependent object which is the view `horror_film`.

To drop the view `film_info`, you need to drop its dependent object first or use the `CASCADE` option like this:

```http
DROP VIEW film_info
CASCADE;
```

This statement drops the `film_info` view as well as its dependent object which is the `horror_film`. It issued the following notice:

```sql
NOTICE:  drop cascades to view horror_film
```

### 3\) Using the DROP VIEW statement to drop multiple views

The following statement uses a single `DROP VIEW` statement to drop multiple views:

```
DROP VIEW film_length_stat, film_category_stat;
```

## Summary

- Use the `DROP VIEW` statement to remove one or more views from the database.
- Use the `IF EXISTS` option to remove a view if it exists.
- Use the `CASCADE` option to remove a view and its dependent objects recursively.


# Create Updatable Views

---
title: 'Creating PostgreSQL Updatable Views'
page_title: 'PostgreSQL Updatable Views'
page_description: 'In this tutorial, we will show you the requirements of PostgreSQL updatable views and how to create updatable views.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-views/postgresql-updatable-views/'
ogImage: ''
updatedOn: '2024-03-16T04:21:16+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Drop View'
  slug: 'postgresql-views/postgresql-drop-view'
nextLink:
  title: 'PostgreSQL WITH CHECK OPTION'
  slug: 'postgresql-views/postgresql-views-with-check-option'
---

**Summary**: in this tutorial, you will learn how to create PostgreSQL updatable views used for modifying data in the underlying table.

## Introduction to PostgreSQL updatable views

In PostgreSQL, a view is a named query stored in the database server. A view can be updatable if it meets certain conditions. This means that you can [insert](../postgresql-tutorial/postgresql-insert), [update](../postgresql-tutorial/postgresql-update), or [delete](../postgresql-tutorial/postgresql-delete) data from the underlying tables via the view.

A view is updatable when it meets the following conditions:

First, the defining query of the view must have exactly one entry in the `FROM` clause, which can be a table or another updatable view.

Second, the defining query must not contain one of the following clauses at the top level:

- [GROUP BY](../postgresql-tutorial/postgresql-group-by)
- [HAVING](../postgresql-tutorial/postgresql-having)
- [LIMIT](../postgresql-tutorial/postgresql-limit)
- [OFFSET FETCH](../postgresql-tutorial/postgresql-fetch)
- [DISTINCT](../postgresql-tutorial/postgresql-select-distinct)
- [WITH](../postgresql-tutorial/postgresql-cte)
- [UNION](../postgresql-tutorial/postgresql-union)
- [INTERSECT](../postgresql-tutorial/postgresql-intersect)
- [EXCEPT](https://neon.tech/postgresql/postgresql-tutorial/postgresql-tutorial/postgresql-except/)

Third, the selection list of the defining query must not contain any:

- [Window functions](../postgresql-window-function)
- [Set\-returning function](../postgresql-plpgsql/plpgsql-function-returns-a-table)
- [Aggregate functions](../postgresql-aggregate-functions)

An updatable view may contain both updatable and non\-updatable columns. If you attempt to modify a non\-updatable column, PostgreSQL will raise an error.

When you execute a modification statement such as [INSERT](../postgresql-tutorial/postgresql-insert), [UPDATE](../postgresql-tutorial/postgresql-update), or [DELETE](../postgresql-tutorial/postgresql-delete) to an updatable view, PostgreSQL will convert this statement into the corresponding statement of the underlying table.

If you have a [`WHERE`](../postgresql-tutorial/postgresql-where) condition in the defining query of a view, you still can update or delete the rows that are not visible through the view. However, if you want to avoid this, you can use the `WITH CHECK OPTION` to define the view.

## PostgreSQL updatable views examples

We’ll take some examples of creating updatable views.

### Setting up a sample table

The following statements create a table called `cities` and [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the table:

```phpsql
CREATE TABLE cities (
    id SERIAL PRIMARY KEY ,
    name VARCHAR(255),
    population INT,
    country VARCHAR(50)
);

INSERT INTO cities (name, population, country)
VALUES
    ('New York', 8419600, 'US'),
    ('Los Angeles', 3999759, 'US'),
    ('Chicago', 2716000, 'US'),
    ('Houston', 2323000, 'US'),
    ('London', 8982000, 'UK'),
    ('Manchester', 547627, 'UK'),
    ('Birmingham', 1141816, 'UK'),
    ('Glasgow', 633120, 'UK'),
    ('San Francisco', 884363, 'US'),
    ('Seattle', 744955, 'US'),
    ('Liverpool', 498042, 'UK'),
    ('Leeds', 789194, 'UK'),
    ('Austin', 978908, 'US'),
    ('Boston', 694583, 'US'),
    ('Manchester', 547627, 'UK'),
    ('Sheffield', 584853, 'UK'),
    ('Philadelphia', 1584138, 'US'),
    ('Phoenix', 1680992, 'US'),
    ('Bristol', 463377, 'UK'),
    ('Detroit', 673104, 'US');

SELECT * FROM cities;
```

### 1\) Creating an updatable view

First, [create an updatable view](managing-postgresql-views) called `city_us` that includes cities in the US only:

```sql
CREATE VIEW city_us
AS
SELECT
  *
FROM
  cities
WHERE
  country = 'US';
```

Second, insert a new row into the `cities` table via the `city_us` view:

```sql
INSERT INTO city_us(name, population, country)
VALUES ('San Jose', 983459, 'US');
```

Third, retrieve data from `cities` table:

```sql
SELECT * FROM cities
WHERE name = 'San Jose';
```

Output:

```text
 id |   name   | population | country
----+----------+------------+---------
 21 | San Jose |     983459 | US
(1 row)
```

Fourth, update the data in the cities table via the city_us view:

```
UPDATE city_us
SET population = 1000000
WHERE name = 'New York';
```

Fifth, verify the update:

```sql
SELECT * FROM cities
WHERE name = 'New York';
```

Output:

```text
 id |   name   | population | country
----+----------+------------+---------
  1 | New York |    1000000 | US
(1 row)
```

Sixth, delete a row from the `cities` table via the `city_us` view:

```
DELETE FROM city_us
WHERE id = 21;
```

Finally, verify the delete:

```sql
SELECT * FROM cities
WHERE id = 21;
```

Output:

```
 id | name | population | country
----+------+------------+---------
(0 rows)
```

The row with id 21 has been deleted.

## Summary

- A view can be updatable when its defining query meets certain conditions.


# WITH CHECK OPTION

---
title: 'PostgreSQL WITH CHECK OPTION'
page_title: 'Creating PostgreSQL Views WITH CHECK OPTION'
page_description: 'Show you create views using the PostgreSQL WITH CHECK OPTION to ensure that the changes to the base table satisfy the view-defining condition.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-views/postgresql-views-with-check-option/'
ogImage: ''
updatedOn: '2024-03-16T04:31:23+00:00'
enableTableOfContents: true
previousLink:
  title: 'Creating PostgreSQL Updatable Views'
  slug: 'postgresql-views/postgresql-updatable-views'
nextLink:
  title: 'PostgreSQL ALTER VIEW Statement'
  slug: 'postgresql-views/postgresql-alter-view'
---

**Summary**: in this tutorial, you will learn how to create an updatable view using the `WITH CHECK OPTION` clause to ensure that the changes to the base tables through the view satisfy the view\-defining condition.

## Introduction to the PostgreSQL WITH CHECK OPTION clause

In PostgreSQL, a view is a named query stored in the PostgreSQL database server. A simple [view can be updatable](postgresql-updatable-views).

To ensure that any data modification made through a view adheres to certain conditions in the view’s definition, you use the `WITH CHECK OPTION` clause.

Typically, you specify the `WITH CHECK OPTION` when creating a view using the `CREATE VIEW` statement:

```phpsqlsql
CREATE VIEW view_name AS
query
WITH CHECK OPTION;
```

When you create a view `WITH CHECK OPTION`, PostgreSQL will ensure that you can only modify data of the view that satisfies the condition in the view’s defining query (`query`).

### Scope of check

In PostgreSQL, you can specify a scope of check:

- `LOCAL`
- `CASCADED`

The `LOCAL` scope restricts the check option enforcement to the current view only. It does not enforce the check to the views that the current view is based on.

Here’s the syntax for creating a view with the `WITH LOCAL CHECK OPTION`:

```php
CREATE VIEW view_name AS
query
WITH LOCAL CHECK OPTION;
```

The `CASCADED` scope extends the check option enforcement to all underlying views of the current view. Here’s the syntax for creating a view with the `WITH CASCADED CHECK OPTION`.

```php
CREATE VIEW view_name AS
query
WITH CASCADED CHECK OPTION;
```

To change the scope of check for an existing view, you can use the [ALTER VIEW](postgresql-alter-view) statement.

## PostgreSQL WITH CHECK OPTION examples

Let’s take some examples of using the `WITH CHECK OPTION`.

### Setting up a sample table

The following statements [create a new table](../postgresql-tutorial/postgresql-create-table) called `employees` and [insert data into it](../postgresql-tutorial/postgresql-insert-multiple-rows):

```
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    department_id INT,
    employee_type VARCHAR(20)
       CHECK (employee_type IN ('FTE', 'Contractor'))
);

INSERT INTO employees (first_name, last_name, department_id, employee_type)
VALUES
    ('John', 'Doe', 1, 'FTE'),
    ('Jane', 'Smith', 2, 'FTE'),
    ('Bob', 'Johnson', 1, 'Contractor'),
    ('Alice', 'Williams', 3, 'FTE'),
    ('Charlie', 'Brown', 2, 'Contractor'),
    ('Eva', 'Jones', 1, 'FTE'),
    ('Frank', 'Miller', 3, 'FTE'),
    ('Grace', 'Davis', 2, 'Contractor'),
    ('Henry', 'Clark', 1, 'FTE'),
    ('Ivy', 'Moore', 3, 'Contractor');
```

### 1\) Basic PostgreSQL WITH CHECK OPTION example

First, create a view called `fte` that retrieves the employees with the type `FTE` from the `employees` table:

```sql
CREATE OR REPLACE VIEW fte AS
SELECT
  id,
  first_name,
  last_name,
  department_id,
  employee_type
FROM
  employees
WHERE
  employee_type = 'FTE';
```

Second, retrieve data from the `fte` view:

```sql
SELECT * FROM fte;
```

Output:

```
 id | first_name | last_name | department_id  |  employee_type
----+------------+-----------+----------------+-------------
  1 | John       | Doe       |             1  |  FTE
  2 | Jane       | Smith     |             2  |  FTE
  4 | Alice      | Williams  |             3  |  FTE
  6 | Eva        | Jones     |             1  |  FTE
  7 | Frank      | Miller    |             3  |  FTE
  9 | Henry      | Clark     |             1  |  FTE
(6 rows)
```

Third, insert a new row into the `employees` table via the `fte` view:

```
INSERT INTO fte(first_name, last_name, department_id, employee_type)
VALUES ('John', 'Smith', 1, 'Contractor');
```

It succeeds.

The issue is that we can insert an employee with the type of `Contractor` into the `employee` table via the view that exposes the employee to the type of `FTE`.

To ensure that we can insert only employees with the type `FTE` into the `employees` table via the `fte` view, you can use the `WITH CHECK OPTION`:

Fourth, replace the `fte` view and add the `WITH CHECK OPTION`:

```sql
CREATE OR REPLACE VIEW fte AS
SELECT
  id,
  first_name,
  last_name,
  department_id,
  employee_type
FROM
  employees
WHERE
  employee_type = 'FTE'
WITH CHECK OPTION;
```

After adding the `WITH CHECK OPTION`, you perform insert, [update](../postgresql-tutorial/postgresql-update), and [delete](../postgresql-tutorial/postgresql-delete) on `employees` table that satisfies the `WHERE` clause in the defining query of the view.

For example, the following `INSERT` statement will fail with an error:

```sql
INSERT INTO fte(first_name, last_name, department_id, employee_type)
VALUES ('John', 'Snow', 1, 'Contractor');
```

Error:

```sql
ERROR:  new row violates check option for view "fte"
DETAIL:  Failing row contains (12, John, Snow, 1, Contractor).
```

The reason is that the `employee_type` `Contractor` does not satisfy the condition defined in the defining query of the view:

```sql
employee_type = 'FTE';
```

But if you modify the row with the employee type `FTE`, it’ll be fine.

Fifth, change the last name of the employee id `2` to `'Doe'`:

```sql
UPDATE fte
SET last_name = 'Doe'
WHERE id = 2;
```

It works as expected.

### 2\) Using WITH LOCAL CHECK OPTION example

First, recreate the `fte` view without using the `WITH CHECK OPTION`:

```sql
CREATE OR REPLACE VIEW fte AS
SELECT
  id,
  first_name,
  last_name,
  department_id,
  employee_type
FROM
  employees
WHERE
  employee_type = 'FTE';
```

Second, create a new view `fte_1` based on the `fte` view that returns the `employees` of department `1`, with the `WITH LOCAL CHECK OPTION`:

```sql
CREATE OR REPLACE VIEW fte_1
AS
SELECT
  id,
  first_name,
  last_name,
  department_id,
  employee_type
FROM
  fte
WHERE
  department_id = 1
WITH LOCAL CHECK OPTION;
```

Third, retrieve the data from the `fte_1` view:

```sql
SELECT * FROM fte_1;
```

Output:

```text
 id | first_name | last_name | department_id | employee_type
----+------------+-----------+---------------+---------------
  1 | John       | Doe       |             1 | FTE
  6 | Eva        | Jones     |             1 | FTE
  9 | Henry      | Clark     |             1 | FTE
(3 rows)
```

Since we use the `WITH LOCAL CHECK OPTION`, PostgreSQL checks only the `fte_1` view when we modify the data in the `employees` table via the `fte_1` view.

Fourth, insert a new row into the `employees` table via the `fte_1` view:

```
INSERT INTO fte_1(first_name, last_name, department_id, employee_type)
VALUES ('Miller', 'Jackson', 1, 'Contractor');
```

It succeeded. The reason is that the `INSERT` statement inserts a row with department 1 that satisfies the condition in the `fte_1` view:

```sql
department_id = 1
```

Fifth, query data from the `employees` table:

```
SELECT
  *
FROM
  employees
WHERE
  first_name = 'Miller'
  and last_name = 'Jackson';
```

Output:

```text
 id | first_name | last_name | department_id | employee_type
----+------------+-----------+---------------+---------------
 12 | Miller     | Jackson   |             1 | Contractor
(1 row)
```

### 3\) Using WITH CASCADED CHECK OPTION example

First, recreate the view `fte_1` with the `WITH CASCADED CHECK OPTION`:

```
CREATE OR REPLACE VIEW fte_1
AS
SELECT
  id,
  first_name,
  last_name,
  department_id,
  employee_type
FROM
  fte
WHERE
  department_id = 1
WITH CASCADED CHECK OPTION;
```

Second, insert a new row into `employee` table via the `fte_1` view:

```sql
INSERT INTO fte_1(first_name, last_name, department_id, employee_type)
VALUES ('Peter', 'Taylor', 1, 'Contractor');
```

Error:

```
ERROR:  new row violates check option for view "fte"
DETAIL:  Failing row contains (24, Peter, Taylor, 1, Contractor).
```

The `WITH CASCADED CHECK OPTION` instructs PostgreSQL to check the constraint on the `fte_1` view and also its base view which is the `fte` view.

That’s why the `INSERT` statement fails the condition of both `fte_1` and `fte` views.

## Summary

- Use the `WITH CHECK OPTION` clause to enforce constraints on data modifications through views and ensure that only valid data can be changed.


# Materialized Views

---
title: 'PostgreSQL Materialized Views'
page_title: 'PostgreSQL Materialized Views'
page_description: 'Learn about PostgreSQL materialized views that allow you to store the result set of a query physically and update the data periodically.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-views/postgresql-materialized-views/'
ogImage: ''
updatedOn: '2024-03-16T04:34:33+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL ALTER VIEW Statement'
  slug: 'postgresql-views/postgresql-alter-view'
nextLink:
  title: 'PostgreSQL Recursive View'
  slug: 'postgresql-views/postgresql-recursive-view'
---

**Summary**: in this tutorial, you will learn about PostgreSQL materialized views that store the result of a query physically and refresh the data from base tables periodically.

## Introduction to the PostgreSQL materialized views

In PostgreSQL, views are virtual tables that represent data of the underlying tables. Simple views can be [updatable](postgresql-updatable-views).

PostgreSQL extends the view concept to the next level which allows views to store data physically. These views are called **materialized views**.

Materialized views cache the result set of an expensive query and allow you to refresh data periodically.

The materialized views can be useful in many cases that require fast data access. Therefore, you often find them in data warehouses and business intelligence applications.

### Creating materialized views

To create a materialized view, you use the `CREATE MATERIALIZED VIEW` statement as follows:

```phpsql
CREATE MATERIALIZED VIEW [IF NOT EXISTS] view_name
AS
query
WITH [NO] DATA;
```

How it works.

- First, specify the `view_name` after the `CREATE MATERIALIZED VIEW` clause
- Second, add the query that retrieves data from the underlying tables after the `AS` keyword.
- Third, if you want to load data into the materialized view at the creation time, use the `WITH DATA` option; otherwise, you use `WITH NO DATA` option. If you use the `WITH NO DATA` option, the view is flagged as unreadable. It means that you cannot query data from the view until you load data into it.
- Finally, use the IF NOT EXISTS option to conditionally create a view only if it does not exist.

### Refreshing data for materialized views

To load data into a materialized view, you use the  `REFRESH MATERIALIZED VIEW` statement:

```sql
REFRESH MATERIALIZED VIEW view_name;
```

When you refresh data for a materialized view, PostgreSQL locks the underlying tables. Consequently, you will not be able to retrieve data from underlying tables while data is loading into the view.

To avoid this, you can use the `CONCURRENTLY` option.

```sql
REFRESH MATERIALIZED VIEW CONCURRENTLY view_name;
```

With the `CONCURRENTLY` option, PostgreSQL creates a temporary updated version of the materialized view, compares two versions, and performs [INSERT](../postgresql-tutorial/postgresql-insert) and [UPDATE](../postgresql-tutorial/postgresql-update) only the differences.

PostgreSQL allows you to retrieve data from a materialized view while it is being updated. One requirement for using `CONCURRENTLY` option is that the materialized view must have a [`UNIQUE`](../postgresql-indexes/postgresql-unique-index) index.

Notice that `CONCURRENTLY` option is only available in PostgreSQL 9\.4 or later.

### Removing materialized views

To remove a materialized view, you use the `DROP MATERIALIZED VIEW` statement:

```sql
DROP MATERIALIZED VIEW view_name;
```

In this syntax, you specify the name of the materialized view that you want to drop after the `DROP MATERIALIZED VIEW` keywords.

## PostgreSQL materialized views example

We’ll use the tables in the [sample database](../postgresql-getting-started/postgresql-sample-database) for creating a materialized view.

First, create a materialized view named `rental_by_category` using the `CREATE MATERIALIZED VIEW` statement:

```sql
CREATE MATERIALIZED VIEW rental_by_category
AS
 SELECT c.name AS category,
    sum(p.amount) AS total_sales
   FROM (((((payment p
     JOIN rental r ON ((p.rental_id = r.rental_id)))
     JOIN inventory i ON ((r.inventory_id = i.inventory_id)))
     JOIN film f ON ((i.film_id = f.film_id)))
     JOIN film_category fc ON ((f.film_id = fc.film_id)))
     JOIN category c ON ((fc.category_id = c.category_id)))
  GROUP BY c.name
  ORDER BY sum(p.amount) DESC
WITH NO DATA;
```

Because of the `WITH NO DATA` option, you cannot query data from the view. If you attempt to do so, you’ll get the following error message:

```php
SELECT * FROM rental_by_category;
```

Output:

```sql
[Err] ERROR: materialized view "rental_by_category" has not been populated
HINT: Use the REFRESH MATERIALIZED VIEW command.
```

PostgreSQL is helpful to give you a hint to ask for loading data into the view.

Second, load data into the materialized view using the `REFRESH MATERIALIZED VIEW` statement:

```sql
REFRESH MATERIALIZED VIEW rental_by_category;
```

Third, retrieve data from the materialized view:

```sql
SELECT * FROM rental_by_category;
```

Output:

```
 category   | total_sales
-------------+-------------
 Sports      |     4892.19
 Sci-Fi      |     4336.01
 Animation   |     4245.31
 Drama       |     4118.46
 Comedy      |     4002.48
 New         |     3966.38
 Action      |     3951.84
 Foreign     |     3934.47
 Games       |     3922.18
 Family      |     3830.15
 Documentary |     3749.65
 Horror      |     3401.27
 Classics    |     3353.38
 Children    |     3309.39
 Travel      |     3227.36
 Music       |     3071.52
(16 rows)
```

From now on, you can refresh the data in the `rental_by_category` view using the `REFRESH MATERIALIZED VIEW` statement.

However, to refresh it with `CONCURRENTLY` option, you need to create a `UNIQUE` index for the view first.

```
CREATE UNIQUE INDEX rental_category
ON rental_by_category (category);
```

Let’s refresh data concurrently for the `rental_by_category` view.

```sql
REFRESH MATERIALIZED VIEW CONCURRENTLY rental_by_category;
```

## Summary

- A materialized view is a view that stores data that comes from the base tables.
- Use the `CREATE MATERIALIZED VIEW` statement to create a materialized view.
- Use the `REFRESH MATERIALIZED VIEW` statement to load data from the base tables into the view.
- Use the `DROP MATERIALIZED VIEW` statement to drop a materialized view.


# Recursive View

---
title: 'PostgreSQL Recursive View'
page_title: 'How To Create a PostgreSQL Recursive View'
page_description: 'This tutorial shows you step by step how to create a PostgreSQL recursive view using the CREATE RECURSIVE VIEW statement.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-views/postgresql-recursive-view/'
ogImage: ''
updatedOn: '2024-03-16T04:42:50+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Materialized Views'
  slug: 'postgresql-views/postgresql-materialized-views'
nextLink:
  title: 'PostgreSQL List Views'
  slug: 'postgresql-views/postgresql-list-views'
---

**Summary**: in this tutorial, you will learn how to create a PostgreSQL recursive view using the `CREATE RECURSIVE VIEW` statement.

## Introduction to the PostgreSQL recursive view

In PostgreSQL, a recursive view is a view whose defining query references the view name itself.

A recursive view can be useful in performing hierarchical or recursive queries on hierarchical data structures stored in the database.

PostgreSQL 9\.3 added a new syntax for creating a recursive view specified in the standard SQL. The `CREATE RECURSIVE VIEW` statement is syntax sugar for a standard [recursive query](../postgresql-tutorial/postgresql-recursive-query).

Here’s the basic syntax of the `CREATE RECURSIVE VIEW` statement:

```sql
CREATE RECURSIVE VIEW view_name(columns)
AS
query;
```

In this syntax:

- First, specify the name of the view you want to create in the `CREATE RECURSIVE VIEW` clause. You can add an optional schema to the name of the view.
- Second, add a [SELECT statement](../postgresql-tutorial/postgresql-select) to define the view. The `SELECT` statement references the `view_name` to make the view recursive.

The `CREATE RECURSIVE VIEW` statement is equivalent to the following statement:

```sql
CREATE VIEW view_name
AS
  WITH RECURSIVE cte_name (columns) AS (
    SELECT ...)
  SELECT columns FROM cte_name;
```

## Creating a recursive view example

We will use the `employees` table created in the [recursive query tutorial](../postgresql-tutorial/postgresql-recursive-query) for the demonstration.

The following recursive query returns the employee and their managers including the CEO using a common table expression (CTE):

```sql
WITH RECURSIVE reporting_line AS (
  SELECT
    employee_id,
    full_name AS subordinates
  FROM
    employees
  WHERE
    manager_id IS NULL
  UNION ALL
  SELECT
    e.employee_id,
    (
      rl.subordinates || ' > ' || e.full_name
    ) AS subordinates
  FROM
    employees e
    INNER JOIN reporting_line rl ON e.manager_id = rl.employee_id
)
SELECT
  employee_id,
  subordinates
FROM
  reporting_line
ORDER BY
  employee_id;
```

Output:

```text
 employee_id |                         subordinates
-------------+--------------------------------------------------------------
           1 | Michael North
           2 | Michael North > Megan Berry
           3 | Michael North > Sarah Berry
           4 | Michael North > Zoe Black
           5 | Michael North > Tim James
           6 | Michael North > Megan Berry > Bella Tucker
           7 | Michael North > Megan Berry > Ryan Metcalfe
           8 | Michael North > Megan Berry > Max Mills
           9 | Michael North > Megan Berry > Benjamin Glover
          10 | Michael North > Sarah Berry > Carolyn Henderson
          11 | Michael North > Sarah Berry > Nicola Kelly
          12 | Michael North > Sarah Berry > Alexandra Climo
          13 | Michael North > Sarah Berry > Dominic King
          14 | Michael North > Zoe Black > Leonard Gray
          15 | Michael North > Zoe Black > Eric Rampling
          16 | Michael North > Megan Berry > Ryan Metcalfe > Piers Paige
          17 | Michael North > Megan Berry > Ryan Metcalfe > Ryan Henderson
          18 | Michael North > Megan Berry > Max Mills > Frank Tucker
          19 | Michael North > Megan Berry > Max Mills > Nathan Ferguson
          20 | Michael North > Megan Berry > Max Mills > Kevin Rampling
```

You can use the `CREATE RECURSIVE VIEW` statement to convert a query into a recursive view as follows:

```sql
CREATE RECURSIVE VIEW reporting_line (employee_id, subordinates) AS
SELECT
  employee_id,
  full_name AS subordinates
FROM
  employees
WHERE
  manager_id IS NULL
UNION ALL
SELECT
  e.employee_id,
  (
    rl.subordinates || ' > ' || e.full_name
  ) AS subordinates
FROM
  employees e
  INNER JOIN reporting_line rl ON e.manager_id = rl.employee_id;
```

To view the reporting line of the employee id 10, you can query directly from the view:

```sql
SELECT
  subordinates
FROM
  reporting_line
WHERE
  employee_id = 10;
```

Output:

```text
                  subordinates
-------------------------------------------------
 Michael North > Sarah Berry > Carolyn Henderson
```

## Summary

- A recursive view is a view whose defining query references the view name.
- Use the `CREATE RECURSIVE VIEW` statement to create a recursive view.


# Alter Views

---
title: 'PostgreSQL ALTER VIEW Statement'
page_title: 'PostgreSQL ALTER VIEW Statement'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL ALTER VIEW statement to change the properties of a view.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-views/postgresql-alter-view/'
ogImage: ''
updatedOn: '2024-03-16T04:33:26+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL WITH CHECK OPTION'
  slug: 'postgresql-views/postgresql-views-with-check-option'
nextLink:
  title: 'PostgreSQL Materialized Views'
  slug: 'postgresql-views/postgresql-materialized-views'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `ALTER VIEW` statement to change the properties of a view.

## Introduction to the PostgreSQL ALTER VIEW statement

The `ALTER VIEW` statement allows you to change various properties of a view.

If you want to change the view’s defining query, use the [`CREATE OR REPLACE VIEW`](managing-postgresql-views) statement.

Here’s the basic syntax of the `ALTER VIEW` statement:

```sql
ALTER VIEW [IF EXISTS] view_name
action;
```

In this syntax:

First, specify the name of the view that you want to change in the `ALTER VIEW` clause.

Second, use the `IF EXISTS` option to modify the view only if it exists. The statement will issue an error if you don’t use the `IF EXISTS` and attempt to change a non\-existing view. But when you use the `IF EXISTS`, the statement issues a notice instead. The `IF EXISTS` is optional.

Third, provide the action that you want to do with the view. The action includes renaming the view, setting the view option, and so on.

### Renaming a view

The following `ALTER VIEW` statement changes the name of a view to the new one:

```sql
ALTER VIEW [ IF EXISTS ] view_name
RENAME TO new_view_name;
```

In this syntax, you specify the new view name (`new_view_name`) after the `RENAME TO` clause. For example:

First, create a new view called `film_type` that includes the `title` and `rating`:

```sql
CREATE VIEW film_type
AS
SELECT title, rating
FROM film;
```

Second, change the view `film_type` to `film_rating`:

```sql
ALTER VIEW film_type RENAME TO film_rating;
```

### Changing the view option

The following `ALTER VIEW` statement changes the view option:

```sql
ALTER VIEW [ IF EXISTS ] view_name
SET ( view_option_name [= view_option_value] [, ... ] );
```

The `view_option_name` can be:

- `check_option`: change the check option. The valid value is `local` or `cascaded`.
- `security_barrier`: change the security\-barrier property of a view. The valid value is `true` or `false`.
- `security_invoker`: change the security invoker of a view. The valid value is `true` or `false`.

For example, the following changes the check option of the `film_rating` view to `local`:

```sql
ALTER VIEW film_rating
SET (check_option = local);
```

To view the change, you can use the `\d+` command in `psql`:

```text
\d+ film_rating
```

Output:

```text
                                 View "public.film_rating"
 Column |          Type          | Collation | Nullable | Default | Storage  | Description
--------+------------------------+-----------+----------+---------+----------+-------------
 title  | character varying(255) |           |          |         | extended |
 rating | mpaa_rating            |           |          |         | plain    |
View definition:
 SELECT title,
    rating
   FROM film;
Options: check_option=local
```

### Changing the view column

The following statement changes a column name of a view to a new one:

```sql
ALTER VIEW [ IF EXISTS ] view_name
RENAME [ COLUMN ] column_name TO new_column_name;
```

For example, the following statement changes the `title` column of the `film_rating` view to `film_title`:

```sql
ALTER VIEW film_rating
RENAME title TO film_title;
```

Here’s the new view detail:

```text
\d+ film_rating
```

```text
                                   View "public.film_rating"
   Column   |          Type          | Collation | Nullable | Default | Storage  | Description
------------+------------------------+-----------+----------+---------+----------+-------------
 film_title | character varying(255) |           |          |         | extended |
 rating     | mpaa_rating            |           |          |         | plain    |
View definition:
 SELECT title AS film_title,
    rating
   FROM film;
Options: check_option=local
```

### Setting the new schema

The following statement sets the new schema for a view:

```sql
ALTER VIEW [ IF EXISTS ] view_name
SET SCHEMA new_schema;
```

For example:

First, create a new schema called `web`:

```sql
CREATE SCHEMA web;
```

Second, change the schema of the `film_rating` view to `web`:

```sql
ALTER VIEW film_rating
SET SCHEMA web;
```

Third, verify the change (in `psql`):

```text
\d+ web.film_rating
```

Output:

```text
                                    View "web.film_rating"
   Column   |          Type          | Collation | Nullable | Default | Storage  | Description
------------+------------------------+-----------+----------+---------+----------+-------------
 film_title | character varying(255) |           |          |         | extended |
 rating     | mpaa_rating            |           |          |         | plain    |
View definition:
 SELECT title AS film_title,
    rating
   FROM film;
Options: check_option=local
```

## Summary

- Use the `ALTER VIEW ... RENAME TO` statement to rename a view.
- Use the `ALTER VIEW ... (SET check_option)` statement to change the check option of a view.
- Use the `ALTER VIEW ... SET SCHEMA` statement to change the schema of a view.


# Listing Views

---
title: 'PostgreSQL List Views'
page_title: 'PostgreSQL List Views'
page_description: 'In this tutorial, you will learn how to list all the views in the current database in PostgreSQL using psql or SQL.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-views/postgresql-list-views/'
ogImage: ''
updatedOn: '2024-03-16T08:19:05+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Recursive View'
  slug: 'postgresql-views/postgresql-recursive-view'
nextLink:
  title: 'PostgreSQL Indexes'
  slug: 'postgresql-views/../postgresql-indexes'
---

**Summary**: in this tutorial, you will learn how to list views in the PostgreSQL database server using the `psql` command and SQL statements.

In PostgreSQL, views are named queries stored directly within the database server. These views allow you to encapsulate complex SQL queries, enabling you to retrieve specific subset data from underlying tables easily.

PostgreSQL offers some options for listing views within the current database. You can either use the `\dv` command in `psql` or query the `information_schema.views` and `pg_matviews` views directly.

## Listing views using psql

First, open the Command Prompt on Windows or Terminal on Unix\-like systems and connect to the PostgreSQL using the following `psql` command:

```plaintextsql
psql -U postgres
```

It’ll prompt you to enter a password for the `postgres` user.

Second, change the current database to the desired one where you want to list the views, for example, `dvdrental`:

```plaintext
\c dvdrental
```

Finally, list the view in the database using the `\dv` command:

```plaintext
\dv
```

In this command, `dv` stands for **d**isplay **v**iews. The `\dv` command allows you to quickly examine the views in the database without having to write SQL queries.

Output:

```plaintext
                   List of relations
 Schema |            Name            | Type |  Owner
--------+----------------------------+------+----------
 public | actor_info                 | view | postgres
 public | contact                    | view | postgres
 public | customer_info              | view | postgres
 public | customer_list              | view | postgres
 public | customer_usa               | view | postgres
 public | film_list                  | view | postgres
 public | nicer_but_slower_film_list | view | postgres
 public | sales_by_film_category     | view | postgres
 public | sales_by_store             | view | postgres
 public | staff_list                 | view | postgres
(10 rows)
```

The output has four columns:

- `Schema`: Indicates the schema of the view. When you create a view without a schema, it defaults to public.
- `Name`: Specifies the name of the view.
- `Type`: Denotes the type of the object, which is `view` in this case.
- `Owner`: Shows the user account that created the view.

## Listing view using SQL statement

PostgreSQL offers various database views that contain information about objects defined in the current database through the information schema.

To retrieve the information about database views, you can execute the following SQL statement:

```plaintext
SELECT
  table_schema,
  table_name
FROM
  information_schema.views
WHERE
  table_schema NOT IN (
    'information_schema', 'pg_catalog'
  )
ORDER BY
  table_schema,
  table_name;
```

The output will display the schema and the name of the views:

```text
 table_schema |         table_name
--------------+----------------------------
 public       | actor_info
 public       | contact
 public       | customer_info
 public       | customer_list
 public       | customer_usa
 public       | film_list
 public       | nicer_but_slower_film_list
 public       | sales_by_film_category
 public       | sales_by_store
 public       | staff_list
 web          | film_rating
(11 rows)
```

## Listing materialized views

To retrieve all [materialized views](postgresql-materialized-views), you can query them from the `pg_matviews` view:

```php
SELECT * FROM pg_matviews;
```

Output:

```text
 schemaname |    matviewname     | matviewowner | tablespace | hasindexes | ispopulated |                          definition
------------+--------------------+--------------+------------+------------+-------------+---------------------------------------------------------------
 public     | rental_by_category | postgres     | null       | t          | t           |  SELECT c.name AS category,                                  +
            |                    |              |            |            |             |     sum(p.amount) AS total_sales                             +
            |                    |              |            |            |             |    FROM (((((payment p                                       +
            |                    |              |            |            |             |      JOIN rental r ON ((p.rental_id = r.rental_id)))         +
            |                    |              |            |            |             |      JOIN inventory i ON ((r.inventory_id = i.inventory_id)))+
            |                    |              |            |            |             |      JOIN film f ON ((i.film_id = f.film_id)))               +
            |                    |              |            |            |             |      JOIN film_category fc ON ((f.film_id = fc.film_id)))    +
            |                    |              |            |            |             |      JOIN category c ON ((fc.category_id = c.category_id)))  +
            |                    |              |            |            |             |   GROUP BY c.name                                            +
            |                    |              |            |            |             |   ORDER BY (sum(p.amount)) DESC;
(1 row)
```

The output includes detailed information about materialized views, including their definitions.

If you solely want to get the names of the materialized view, you can use the following query:

```
SELECT
  matviewname AS materialized_view_name
FROM
  pg_matviews
ORDER BY
  materialized_view_name;
```

This query will return only the names of the materialized views.

Output:

```
 materialized_view_name
------------------------
 rental_by_category
(1 row)

```

## Summary

- Utilize the `\dv` command to list all views of a database using the `psql` program.
- Use the `information_schemas.views` view to retrieve information about views.
- Use the `pg_matviews` view to obtain the materialized views.


# PostgreSQL Indexes

---
title: 'PostgreSQL Indexes'
page_title: 'PostgreSQL Indexes'
page_description: 'In this tutorial, you will learn how to use PostgreSQL indexes to enhance the data retrieval speed and various index types.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-indexes/'
ogImage: ''
updatedOn: '2024-03-06T08:34:51+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL List Views'
  slug: 'postgresql-views/postgresql-list-views'
nextLink:
  title: 'PostgreSQL CREATE INDEX Statement'
  slug: 'postgresql-indexes/postgresql-create-index'
---

**Summary**: in this tutorial, you will learn how to use PostgreSQL indexes to enhance the data retrieval speed and various index types.

## Introduction to PostgreSQL indexes

In PostgreSQL, an index is a data structure that increases the data retrieval speed by providing a rapid way to locate rows within a table.

An index in PostgreSQL works like an index in a book, providing a quick reference to the page where specific content can be found.

Suppose you have a table called `contacts` with the following structure:

```sql
CREATE TABLE contacts (
    id INT PRIMARY KEY,
    name VACHAR(255) NOT NULL,
    phone VARCHAR(10) NOT NULL
);
```

And you issue the following query to find contacts by name:

```sql
SELECT * FROM contacts
WHERE name = 'John Doe';
```

PostgreSQL must scan the entire `contacts` table to find the matching rows. If the `contacts` table contains many rows, the method of locating relevant rows is inefficient.

However, with an index on the `name` column, PostgreSQL can use a more efficient method to find the relevant rows.

To create an index, you use the [CREATE INDEX](postgresql-indexes/postgresql-create-index) statement:

```sql
CREATE INDEX contacts_name
ON contacts(name);
```

This statement creates an index named `contacts_name` on the `name` column of the `contacts` table.

After creating an index on the `name` column, PostgreSQL extracts data from the `name` column of the `contacts` table and insert it into the index data structure.

This process may take time, depending on the number of rows in the `contacts` table.

By default, PostgreSQL allows data selection from a table during index creation but blocks [insert](postgresql-tutorial/postgresql-insert), [update](postgresql-tutorial/postgresql-update), and [delete](postgresql-tutorial/postgresql-delete) operations.

When executing the following `SELECT` statement, PostgreSQL can utilize the `contacts_name` index to quickly find the relevant rows in the `contacts` table:

```sql
SELECT * FROM contacts
WHERE name = 'John Doe';
```

After creating an index, PostgreSQL must keep it synchronized with the table.

For example, when inserting, updating, or deleting data from the `contacts` table, PostgreSQL updates the index to reflect the changes accordingly.

As a result, an index adds write overhead to the data manipulation operations (inserts, updates, deletes).

## Types of PostgreSQL indexes

PostgreSQL offers various index types, each designed to cater to specific data scenarios and query patterns.

By understanding these index types, you can enhance the query performance more effectively.

### B\-tree index

B\-tree is the default index type in PostgreSQL. B\-tree stands for balanced tree. B\-tree indexes maintain the sorted values, making them efficient for exact matches and range queries.

### Hash index

Hash indexes maintain 32\-bit hash code created from values of the indexed columns.

Therefore, hash indexes can only handle simple equality comparisons (\=).

### GIN index

GIN indexes are inverted indexes that are suitable for composite values such as [arrays](postgresql-tutorial/postgresql-array), [JSONB data](postgresql-indexes/postgresql-json-index), and [full\-text search](postgresql-indexes/postgresql-full-text-search).

Since a GIN index stores a separate entry for each component, it can handle queries that check for the existence of a specific component.

### GiST index

GiST indexes are versatile and support a wide range of [data types](postgresql-tutorial/postgresql-data-types), including geometric and full\-text data.

GiST indexes allow various search strategies such as nearest\-neighbor and partial match searches, making them useful for specialized applications.

### SP\-GiST index

SP\-GiST indexes are useful for indexing data with hierarchical structures or complex data types.

SP\-GiST indexes partition the index space into non\-overlapping regions, offering efficient search capabilities for specialized data structures.

### BRIN (Block Range Index) index

BRIN indexes are designed for very large tables where indexing every row is impractical.

A BRIN index divides the table into ranges of pages and stores summarized information about each range, making them efficient for range queries on large datasets while using minimal space.

## PostgreSQL indexes tutorials

- [Create Index](postgresql-indexes/postgresql-create-index) – Show you how to define a new index for a table.
- [Unique Index](postgresql-indexes/postgresql-unique-index) – Provide you with steps for defining unique indexes.
- [Index on Expression](postgresql-indexes/postgresql-index-on-expression) – Guide you on creating an index based on expressions.
- [Partial index](postgresql-indexes/postgresql-partial-index) – Learn about creating partial indexes that include a subset of rows of the indexed columns.
- [Multicolumn Indexes](postgresql-indexes/postgresql-multicolumn-indexes) – Show you how to define indexes that include multiple table columns.
- [Reindex](postgresql-indexes/postgresql-reindex) – Learn how to rebuild indexes.
- [List indexes](postgresql-indexes/postgresql-list-indexes) – Learn how to list all indexes in a table or database.
- [Drop Index](postgresql-indexes/postgresql-drop-index) – Show you how to delete an index.
- [Index Types](postgresql-indexes/postgresql-index-types) – Discuss various PostgreSQL index types in detail.
- [Full Text Search](postgresql-indexes/postgresql-full-text-search) – Show you how to use the GIN index to enable full\-text search in PostgreSQL.
- [JSON index](postgresql-indexes/postgresql-json-index) – Learn how to index a JSONB column for enhanced query performance.


# Create Indexes

---
title: 'PostgreSQL CREATE INDEX Statement'
page_title: 'PostgreSQL CREATE INDEX Statement'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL CREATE INDEX statement to create a new index for a table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-indexes/postgresql-create-index/'
ogImage: '/postgresqltutorial/address.png'
updatedOn: '2024-02-28T13:06:03+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Indexes'
  slug: 'postgresql-indexes/'
nextLink:
  title: 'PostgreSQL UNIQUE Index'
  slug: 'postgresql-indexes/postgresql-unique-index'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `CREATE INDEX` statement to define a new index for a table.

## Introduction to PostgreSQL CREATE INDEX statement

An index is a separate data structure that enhances the speed of data retrieval from a table, at the cost of additional writes and storage required to maintain it.

An index allows you to improve the query performance when using it appropriately, especially on large tables.

To create an index on one or more columns of a table, you use the `CREATE INDEX` statement.

Here’s the basic syntax of the `CREATE INDEX` statement:

```phpsql
CREATE INDEX [IF NOT EXISTS] index_name
ON table_name(column1, column2, ...);
```

In this syntax:

- First, specify the index name after the `CREATE INDEX` clause.
- Second, use the `IF NOT EXISTS` option to prevent an error if the index already exists.
- Third, provide the table name to which the index belongs.
- Finally, list out one or more indexed columns inside the () after the table name.

Note that the syntax of the `CREATE INDEX` statement is more complex than this. We’ll cover additional features of the `CREATE INDEX` statement in the upcoming tutorials such as [unique indexes](postgresql-unique-index), [indexes on expressions](postgresql-index-on-expression), [partial indexes](postgresql-partial-index), and [multicolumn indexes](postgresql-multicolumn-indexes).

By default, the `CREATE INDEX` statement creates a B\-tree index, which is appropriate for most cases. We’ll show you how to create other [index types](postgresql-index-types).

## PostgreSQL CREATE INDEX statement example

We’ll use the `address` table from the [sample database](../postgresql-getting-started/postgresql-sample-database) for the demonstration:

![address table](/postgresqltutorial/address.png)
First, [connect to the PostgreSQL](../postgresql-getting-started/connect-to-postgresql-database) `dvdrental` [sample database](../postgresql-getting-started/postgresql-sample-database) using `psql`:

```bash
psql -U postgres -d dvdrental
```

Second, execute the following [query](../postgresql-tutorial/postgresql-select) to find the address whose phone number is `223664661973`:

```
SELECT
  address_id,
  address,
  district,
  phone
FROM
  address
WHERE
  phone = '223664661973';
```

Output:

```text
 address_id |      address       | district  |    phone
------------+--------------------+-----------+--------------
         85 | 320 Baiyin Parkway | Mahajanga | 223664661973
(1 row)
```

To find the row whose value in the `phone` column is `223664661973`, PostgreSQL must scan the entire `address` table.

Third, show the query plan using the following `EXPLAIN` statement::

```
EXPLAIN SELECT
  address_id,
  address,
  district,
  phone
FROM
  address
WHERE
  phone = '223664661973';
```

Here is the output:

```text
                       QUERY PLAN
---------------------------------------------------------
 Seq Scan on address  (cost=0.00..15.54 rows=1 width=45)
   Filter: ((phone)::text = '223664661973'::text)
(2 rows)
```

The output indicates that the query optimizer has to perform a sequential scan on the `address` table.

Fourth, [create an index](postgresql-create-index) for the values in the `phone` column of the `address` table using the `CREATE INDEX` statement:

```php
CREATE INDEX idx_address_phone
ON address(phone);
```

When you run the `CREATE INDEX` statement, PostgreSQL scans the `address` table, extracts data from the `phone` column, and inserts it into the index `idx_address_phone`.

This process is called an index build. By default, PostgreSQL allows reads from the `address` table and blocks write operations while building the index.

Fifth, [show the indexes](postgresql-list-indexes) that belong to the `address` table from the `pg_indexes`:

```sql
SELECT
  indexname,
  indexdef
FROM
  pg_indexes
WHERE
  tablename = 'address';
```

Output:

```text
     indexname     |                                  indexdef
-------------------+-----------------------------------------------------------------------------
 address_pkey      | CREATE UNIQUE INDEX address_pkey ON public.address USING btree (address_id)
 idx_fk_city_id    | CREATE INDEX idx_fk_city_id ON public.address USING btree (city_id)
 idx_address_phone | CREATE INDEX idx_address_phone ON public.address USING btree (phone)
(3 rows)
```

The output shows that the `idx_address_phone` has been created successfully.

Two other indexes `address_pkey` and `idx_fk_city_id` were created implicitly when the `address` table was created.

More specifically, the `address_pkey` index was created for the [primary key](../postgresql-tutorial/postgresql-primary-key) column `address_id` and `idx_fk_city_id` was created for the [foreign key](../postgresql-tutorial/postgresql-foreign-key) city_id column.

Fifth, execute the following query again:

```php
EXPLAIN SELECT
  address_id,
  address,
  district,
  phone
FROM
  address
WHERE
  phone = '223664661973';
```

Output:

```
                                    QUERY PLAN
----------------------------------------------------------------------------------
 Index Scan using idx_address_phone on address  (cost=0.28..8.29 rows=1 width=45)
   Index Cond: ((phone)::text = '223664661973'::text)
(2 rows)
```

The output indicates that PostgreSQL uses the index `idx_address_phone` for the lookup.

## Summary

- Use the `CREATE INDEX` statement to create an index.
- Use the `EXPLAIN` statement to explain a query.


# Unique Indexes

---
title: 'PostgreSQL UNIQUE Index'
page_title: 'PostgreSQL UNIQUE Index'
page_description: 'In this tutorial, you will learn how to create a PostgreSQL UNIQUE index to ensure the uniqueness of values in one or more columns.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-indexes/postgresql-unique-index/'
ogImage: ''
updatedOn: '2024-02-28T13:08:05+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CREATE INDEX Statement'
  slug: 'postgresql-indexes/postgresql-create-index'
nextLink:
  title: 'PostgreSQL Index on Expression'
  slug: 'postgresql-indexes/postgresql-index-on-expression'
---

**Summary**: in this tutorial, you will learn how to create a PostgreSQL unique index to ensure the uniqueness of values in one or more columns.

## Introduction to PostgreSQL UNIQUE index

The PostgreSQL unique index enforces the uniqueness of values in one or multiple columns.

To create a unique index, you use the following `CREATE UNIQUE INDEX` statement:

```phpsql
CREATE UNIQUE INDEX index_name
ON table_name (column [, ...])
[ NULLS [ NOT ] DISTINCT ];
```

In this syntax:

- First, specify the index name in the `CREATE UNIQUE INDEX` statement.
- Second, provide the name of the table along with a list of indexed columns in the ON clause.
- Third, the `NULL NOT DISTINCT` option treats nulls as equal, whereas `NULLS DISTINCT` treats nulls as distinct values. By default, the statement uses `NULLS DISTINCT`, meaning that the indexed column may contain multiple nulls.

PostgreSQL offers [multiple index types](postgresql-index-types), but only the B\-tree index type supports unique indexes.

When you define a unique index for a column, the column cannot store multiple rows with the same values.

If you define a unique index for two or more columns, the combined values in these columns cannot be duplicated in multiple rows.

When you define a [primary key](../postgresql-tutorial/postgresql-primary-key) or a [unique constraint](../postgresql-tutorial/postgresql-unique-constraint) for a table, PostgreSQL automatically creates a corresponding unique index.

## PostgreSQL UNIQUE index examples

Let’s explore some examples of using the PostgreSQL unique indexes.

### 1\) Unique indexes for a primary key column and a column with a unique constraint

First, [create a table](../postgresql-tutorial/postgresql-create-table) called `employees` :

```sql
CREATE TABLE employees (
    employee_id SERIAL PRIMARY KEY,
    first_name VARCHAR(255) NOT NULL,
    last_name VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE
);
```

In this statement, the `employee_id` is the [primary key](../postgresql-tutorial/postgresql-primary-key) column and `email` column has a [unique constraint](../postgresql-tutorial/postgresql-unique-constraint), therefore, PostgreSQL creates two `UNIQUE` indexes, one for each column.

Second, show the indexes of the `employees` table:

```sql
SELECT
    tablename,
    indexname,
    indexdef
FROM
    pg_indexes
WHERE
    tablename = 'employees';
```

Here is the output:

```text
 tablename |      indexname      |                                     indexdef
-----------+---------------------+----------------------------------------------------------------------------------
 employees | employees_pkey      | CREATE UNIQUE INDEX employees_pkey ON public.employees USING btree (employee_id)
 employees | employees_email_key | CREATE UNIQUE INDEX employees_email_key ON public.employees USING btree (email)
(2 rows)
```

### 2\) Using PostgreSQL UNIQUE index for single column example

First, [add a column](../postgresql-tutorial/postgresql-add-column) named `mobile_phone` to the `employees` table:

```http
ALTER TABLE employees
ADD mobile_phone VARCHAR(20);
```

To ensure that the mobile phone numbers are distinct for all employees, you can define a unique index for the `mobile_phone` column using the `CREATE INDEX` statement.

Second, create a unique index on the `mobile_phone` column of the `employees` table:

```sql
CREATE UNIQUE INDEX idx_employees_mobile_phone
ON employees(mobile_phone);
```

Third, [insert a new row](../postgresql-tutorial/postgresql-insert) into the `employees` table:

```sql
INSERT INTO employees(first_name, last_name, email, mobile_phone)
VALUES ('John','Doe','[[email protected]](../cdn-cgi/l/email-protection.html)', '(408)-555-1234');
```

Fourth, attempt to insert another row with the same phone number:

```sql
INSERT INTO employees(first_name, last_name, email, mobile_phone)
VALUES ('Jane','Doe','[[email protected]](../cdn-cgi/l/email-protection.html)', '(408)-555-1234');
```

PostgreSQL issues the following error due to the duplicate mobile phone number:

```sql
ERROR:  duplicate key value violates unique constraint "idx_employees_mobile_phone"
DETAIL:  Key (mobile_phone)=((408)-555-1234) already exists.
```

### 3\) Using PostgreSQL UNIQUE index for multiple columns

First, [add two new columns](../postgresql-tutorial/postgresql-add-column) called `work_phone` and `extension` to the `employees` table:

```sql
ALTER TABLE employees
ADD work_phone VARCHAR(20),
ADD extension VARCHAR(5);
```

Multiple employees can share the same work phone number. However, they cannot have the same extension number.

To enforce this rule, you can define a unique index on both `work_phone` and `extension` columns.

Next, create a unique index that includes both `work_phone` and `extension` columns:

```sql
CREATE UNIQUE INDEX idx_employees_workphone
ON employees(work_phone, extension);
```

Then, insert a row into the `employees` table:

```sql
INSERT INTO employees(first_name, last_name, work_phone, extension)
VALUES('Lily', 'Bush', '(408)-333-1234','1212');
```

After that, insert another employee with the same work phone number but a different extension:

```sql
INSERT INTO employees(first_name, last_name, work_phone, extension)
VALUES('Joan', 'Doe', '(408)-333-1234','1211');
```

The statement works because the combination of values in the `work_phone` and `extension` column is unique.

Finally, attempt to insert a row with the same values in both `work_phone` and `extension` columns that already exist in the `employees` table:

```sql
INSERT INTO employees(first_name, last_name, work_phone, extension)
VALUES('Tommy', 'Stark', '(408)-333-1234','1211');
```

PostgreSQL issued the following error:

```
ERROR:  duplicate key value violates unique constraint "idx_employees_workphone"
DETAIL:  Key (work_phone, extension)=((408)-333-1234, 1211) already exists.
```

## Summary

- Use a PostgreSQL unique index to enforce the uniqueness of values in a column or a set of columns.
- PostgreSQL automatically creates a unique index for a primary key column or a column with a unique constraint.


# Indexes on Expressions

---
title: 'PostgreSQL Index on Expression'
page_title: 'PostgreSQL Index On Expression Explained By Practical Examples'
page_description: 'This tutorial explains the PostgreSQL index on expression and shows you how to leverage it to improve the performance of queries that contain expressions.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-indexes/postgresql-index-on-expression/'
ogImage: '/postgresqltutorial/customer-table.png'
updatedOn: '2024-02-28T13:11:22+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL UNIQUE Index'
  slug: 'postgresql-indexes/postgresql-unique-index'
nextLink:
  title: 'PostgreSQL Partial Index'
  slug: 'postgresql-indexes/postgresql-partial-index'
---

**Summary**: in this tutorial, you will learn how to leverage the PostgreSQL index on expression to improve the performance of queries that involve expressions.

## Introduction to PostgreSQL index on expression

In PostgreSQL, indexes play an important role in optimizing query performance.

Typically, you [create an index](postgresql-create-index) that references one or more columns of a table.

PostgreSQL also allows you to create an index based on an expression involving table columns. This type of index is called an **index on expression**.

Note that the indexes on expressions are also known as functional indexes.

Here’s the basic syntax for creating an index on expression:

```phpsql
CREATE INDEX index_name
ON table_name (expression);
```

In this statement:

- First, specify the index name in the [`CREATE INDEX`](postgresql-create-index) clause.
- Then, form an expression that involves table columns of the `table_name` in the `ON` clause.

After defining an index expression, PostgreSQL will consider using that index when the expression appears in the [`WHERE`](../postgresql-tutorial/postgresql-where) clause or in the [`ORDER BY`](../postgresql-tutorial/postgresql-order-by) clause of the SQL statement.

Note that maintaining indexes on expressions can incur additional costs. PostgreSQL evaluates the expression for each row during [insertion](../postgresql-tutorial/postgresql-insert) or [update](../postgresql-tutorial/postgresql-update) and utilizes the result for building the index.

Therefore, it’s recommended to use the indexes on expressions when prioritizing retrieval speed over insertion and update speed.

## PostgreSQL index on expression example

We’ll use the `customer` table from the [sample database](../postgresql-getting-started/postgresql-sample-database).

![customer table](/postgresqltutorial/customer-table.png)
The `customer` table has a b\-tree index defined for the `first_name` column.

First, retrieve the customers with the last names are `Purdy`:

```sql
SELECT
    customer_id,
    first_name,
    last_name
FROM
    customer
WHERE
    last_name = 'Purdy';
```

Output:

```text
 customer_id | first_name | last_name
-------------+------------+-----------
         333 | Andrew     | Purdy
(1 row)
```

It returns one matching row.

Second, use the `EXPLAIN` statement to show the query plan:

```
EXPLAIN
SELECT
    customer_id,
    first_name,
    last_name
FROM
    customer
WHERE
    last_name = 'Purdy';
```

Output:

```text
                                  QUERY PLAN
-------------------------------------------------------------------------------
 Index Scan using idx_last_name on customer  (cost=0.28..8.29 rows=1 width=17)
   Index Cond: ((last_name)::text = 'Purdy'::text)
(2 rows)
```

The output indicates that the query uses the `idx_last_name` index to improve the retrieval speed.

Third, find customers whose last name is `purdy` in lowercase:

```php
EXPLAIN
SELECT
    customer_id,
    first_name,
    last_name
FROM
    customer
WHERE
    LOWER(last_name) = 'purdy';
```

Output:

```text
                        QUERY PLAN
----------------------------------------------------------
 Seq Scan on customer  (cost=0.00..17.98 rows=3 width=17)
   Filter: (lower((last_name)::text) = 'purdy'::text)
(2 rows)
```

However, this time PostgreSQL could not utilize the index for lookup. To enhance the speed of the query, you can define an index on expression.

Fourth, define an index on expression using the `CREATE INDEX` statement:

```php
CREATE INDEX idx_ic_last_name
ON customer(LOWER(last_name));
```

Finally, retrieve the customers based on a last name in lowercase:

```sql
EXPLAIN
SELECT
    customer_id,
    first_name,
    last_name
FROM
    customer
WHERE
    LOWER(last_name) = 'purdy';
```

Output:

```
                                  QUERY PLAN
-------------------------------------------------------------------------------
 Bitmap Heap Scan on customer  (cost=4.30..11.15 rows=3 width=17)
   Recheck Cond: (lower((last_name)::text) = 'purdy'::text)
   ->  Bitmap Index Scan on idx_ic_last_name  (cost=0.00..4.30 rows=3 width=0)
         Index Cond: (lower((last_name)::text) = 'purdy'::text)
(4 rows)
```

This time PostgreSQL uses the index on the expression `idx_ic_last_name` to quickly locate the matching rows in the `customer` table.

## Summary

- Use the PostgreSQL index on expression to improve queries that have an expression involving table columns.


# Partial Indexes

---
title: 'PostgreSQL Partial Index'
page_title: 'PostgreSQL Partial Index'
page_description: 'This tutorial shows you how to create a PostgreSQL partial index that includes a subset of rows in a table specified by a condition.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-indexes/postgresql-partial-index/'
ogImage: '/postgresqltutorial/customer-table.png'
updatedOn: '2024-02-28T08:55:51+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Index on Expression'
  slug: 'postgresql-indexes/postgresql-index-on-expression'
nextLink:
  title: 'PostgreSQL Multicolumn Indexes'
  slug: 'postgresql-indexes/postgresql-multicolumn-indexes'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL partial index to create an index based on a subset of rows in a table based on specified conditions.

## Introduction to PostgreSQL partial index

When you [create an index](postgresql-create-index) on a column of a table, PostgreSQL uses all the values from that column for building the index.

Sometimes, you may want to include only some values from the indexed column in the index. To do that you can use a partial index.

A partial index is an index built on a subset of data of the indexed columns.

To define a subset of data, you use a predicate, which is a conditional expression, of the partial index. PostgreSQL will build an index for rows that satisfy the predicate.

This partial index can enhance query performance while reducing the index size. It can also improve table updates because PostgreSQL does not need to maintain the index in all cases.

To create a partial index, you use the `CREATE INDEX` statement with a `WHERE` clause:

```sql
CREATE [IF NOT EXISTS] INDEX index_name
ON table_name(column1, column2, ...)
WHERE predicate;
```

In this syntax:

- First, specify the index name in the `CREATE INDEX` statement. Use the `IF NOT EXISTS` to prevent an error of creating an index that already exists.
- Second, provide the table name along with indexed columns in the `ON` clause.
- Third, use a predicate in the `WHERE` clause to specify the condition for rows to be included in the index.

## PostgreSQL partial index example

Let’s take a look at the `customer` table from the [sample database](../postgresql-getting-started/postgresql-sample-database):

![customer table](/postgresqltutorial/customer-table.png)
The active column has two values:

- 0: inactive
- 1: active

When querying data from the database, you often work with inactive customers, not active ones. For example, you may want to follow up with inactive customers to get them back to order more films.

To speed up the query that retrieves the inactive customer, you can create a partial index.

First, create a partial index on the `active` column of the customer table:

```sql
CREATE INDEX customer_active
ON customer(active)
WHERE active = 0;
```

Second, show the query plan that retrieves the inactive customers:

```sql
EXPLAIN SELECT
  *
FROM
  customer
WHERE
  active = 0;
```

Output:

```
                                    QUERY PLAN
-----------------------------------------------------------------------------------
 Index Scan using customer_active on customer  (cost=0.14..16.12 rows=15 width=70)

```

The partial index customer_active improves the query performance while including the only rows that are often searched.

## Summary

- Use PostgreSQL partial index to create an index that includes a subset of rows in a table specified by a condition.


# Multicolumn Indexes

---
title: 'PostgreSQL Multicolumn Indexes'
page_title: 'PostgreSQL Multicolumn Indexes'
page_description: 'In this tutorial, you will learn how to create multicolumn indexes which are indexes defined on more than one column of a table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-indexes/postgresql-multicolumn-indexes/'
ogImage: ''
updatedOn: '2024-02-28T09:28:50+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Partial Index'
  slug: 'postgresql-indexes/postgresql-partial-index'
nextLink:
  title: 'PostgreSQL REINDEX'
  slug: 'postgresql-indexes/postgresql-reindex'
---

**Summary**: in this tutorial, you will learn how to create PostgreSQL multicolumn indexes, which are indexes defined on two or more columns of a table.

## Introduction to PostgreSQL multicolumn indexes

When you [create an index](postgresql-create-index) on two or more columns within a table, this type of index is called a multicolumn index.

A multicolumn index is often referred to as a composite index, a combined index, or a concatenated index.

A multicolumn index can have a maximum of 32 columns. The limit can be adjusted by modifying the `pg_config_manual.h` file when building PostgreSQL source code.

Additionally, only B\-tree, GIST, GIN, and BRIN index types support multicolumn indexes.

The following shows the syntax for creating a multicolumn index:

```csssql
CREATE INDEX [IF NOT EXISTS] index_name
ON table_name(column1, column2, ...);
```

In this syntax:

- First, specify the index name in the `CREATE INDEX` clause. Use the `IF NOT EXISTS` option to prevent an error from creating an index whose name already exists.
- Second, provide the table name along with the index columns in the parenthesis.

When defining a multicolumn index, you should place the columns that are frequently used in the [`WHERE`](../postgresql-tutorial/postgresql-where) clause at the beginning of the column list, followed by the columns that are less frequently used in the `WHERE` clause.

In the above syntax, the query optimizer will consider using the index in the following cases:

```php
WHERE column1 = v1 AND column2 = v2 AND column3 = v3;
```

Or

```
WHERE column1 = v1 AND column2 = v2;
```

Or

```
WHERE column1 = v1;
```

However, it will not consider using the index in the following cases:

```
WHERE column3 = v3;
```

or

```
WHERE column2 = v2 and column3 = v3;
```

Note that you can also use the `WHERE` clause to define a partially multicolumn index.

## PostgreSQL Multicolumn Index example

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `people` using the following `CREATE TABLE` statement:

```
CREATE TABLE people (
    id INT GENERATED BY DEFAULT AS IDENTITY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL
);
```

The `people` table consists of three columns: id, first name, and last name.

Second, execute the `INSERT` statement in the following file to load `10,000` rows into the `people` table:

[Script to load 10000 names](/postgresqltutorial/Script-to-load-10000-names.txt)

Third, show the query plan that finds the person whose last name is `Adams`:

```php
EXPLAIN SELECT
  id,
  first_name,
  last_name
FROM
  people
WHERE
  last_name = 'Adams';
```

Here is the output:

```text
                       QUERY PLAN
---------------------------------------------------------
 Seq Scan on people  (cost=0.00..83.88 rows=9 width=240)
   Filter: ((last_name)::text = 'Adams'::text)
(2 rows)
```

The output indicates that PostgreSQL performs a sequential scan on the `people` table to find the matching rows because there is no index defined for the `last_name` column.

Fourth, create an index that includes both the `last_name` and `first_name` columns. Assuming that searching for people by their last name is more common than by their first name, we define the index with the following column order:

```php
CREATE INDEX idx_people_names
ON people (last_name, first_name);
```

Fifth, show the plan of the query that searches for the person whose last name is `Adams`:

```
EXPLAIN SELECT
  id,
  first_name,
  last_name
FROM
  people
WHERE
  last_name = 'Adams';
```

Output:

```text
                                   QUERY PLAN
--------------------------------------------------------------------------------
 Bitmap Heap Scan on people  (cost=4.42..44.07 rows=18 width=17)
   Recheck Cond: ((last_name)::text = 'Adams'::text)
   ->  Bitmap Index Scan on idx_people_names  (cost=0.00..4.42 rows=18 width=0)
         Index Cond: ((last_name)::text = 'Adams'::text)
(4 rows)
```

The output indicates that the query optimizer uses the `idx_people_names` index.

Sixth, find the person whose last name is `Adams` and the first name is `Lou`.

```php
EXPLAIN SELECT
  id,
  first_name,
  last_name
FROM
  people
WHERE
  last_name = 'Adams'
  AND first_name = 'Lou';
```

Output:

```text
                                         QUERY PLAN
--------------------------------------------------------------------------------------------
 Index Scan using idx_people_names on people  (cost=0.29..8.30 rows=1 width=17)
   Index Cond: (((last_name)::text = 'Adams'::text) AND ((first_name)::text = 'Lou'::text))
(2 rows)
```

The output indicates that the query optimizer will use the index because both columns in the `WHERE` clause (`first_name` and `last_name`) are included in the index.

Seventh, search for the person whose first name is `Lou`:

```php
EXPLAIN SELECT
  id,
  first_name,
  last_name
FROM
  people
WHERE
  first_name = 'Lou';
```

Output:

```
                        QUERY PLAN
----------------------------------------------------------
 Seq Scan on people  (cost=0.00..186.00 rows=32 width=17)
   Filter: ((first_name)::text = 'Lou'::text)
(2 rows)
```

The output indicates that PostgreSQL performs a sequential scan of the `people` table instead of using the index even though the `first_name` column is a part of the index.

## Summary

- Use a PostgreSQL multicolumn index to define an index involving two or more columns from a table.
- Place the columns that are frequently used in the `WHERE` clause at the beginning of the column list of the multicolumn index.


# Reindexing with REINDEX

---
title: 'PostgreSQL REINDEX'
page_title: 'PostgreSQL REINDEX Explained'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL REINDEX statement to rebuild one or more indices.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-indexes/postgresql-reindex/'
ogImage: ''
updatedOn: '2024-02-28T10:26:12+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Multicolumn Indexes'
  slug: 'postgresql-indexes/postgresql-multicolumn-indexes'
nextLink:
  title: 'PostgreSQL DROP INDEX'
  slug: 'postgresql-indexes/postgresql-drop-index'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `REINDEX` statement to rebuild one or more indexes.

## Introduction to PostgreSQL REINDEX statement

In practice, an index can become corrupted and no longer contain valid data due to hardware failures or software bugs.

Additionally, when you create an index without the `CONCURRENTLY` option, the index may become invalid if the index build fails.

In such cases, you can rebuild the index. To rebuild the index, you can use the `REINDEX` statement as follows:

```plaintextsql
REINDEX [ ( option, ...) ]
{ INDEX | TABLE | SCHEMA | DATABASE | SYSTEM }
name;
```

In this syntax:

The `option` can be one or more values:

- `VERBOSE [boolean]` – show the progress as each index is reindexed.
- `TABLESPACE new_tablespace` – specify the new tablespace on which the indexes will be rebuilt.
- `CONCURRENTLY` – rebuild the index without taking any locks. If not used, reindex will lock out writes but not reads on the table until it is completed.

To rebuild a single index, you specify the index name after `REINDEX INDEX` clause:

```sql
REINDEX INDEX index_name;
```

To rebuild all the indexes of a table, you use the `TABLE` keyword and specify the name of the table:

```sql
REINDEX TABLE table_name;
```

If you want to rebuild all indexes in a specific schema, you use the `SCHEMA` keyword followed by the schema name:

```sql
REINDEX SCHEMA schema_name;
```

To rebuild all indexes in a specific database, you specify the database name after the `REINDEX DATABASE` clause:

```sql
REINDEX DATABASE database_name;
```

The following statement recreates all indexes on system catalogs in a specific database:

```sql
REINDEX SYSTEM database_name;
```

The `name` specifies the name of an index, a table name, a schema, a database respectively.

## PostgreSQL REINDEX example

First, connect to the `dvdrental` database using the psql:

```bash
psql -U postgres -d dvdrental
```

Second, rebuild all indexes in the `film` table of the `dvdrental` database using the `REINDEX` statement:

```plaintext
REINDEX (verbose, concurrently)
TABLE film;
```

Output:

```sql
INFO:  index "public.film_pkey" was reindexed
INFO:  index "public.film_fulltext_idx" was reindexed
INFO:  index "public.idx_fk_language_id" was reindexed
INFO:  index "public.idx_title" was reindexed
INFO:  index "pg_toast.pg_toast_27937_index" was reindexed
INFO:  table "public.film" was reindexed
DETAIL:  CPU: user: 0.01 s, system: 0.01 s, elapsed: 0.37 s.
REINDEX
```

Since the statement uses the `VERBOSE` option, the `REINDEX` statement displays the progress report once an index is rebuilt successfully. Additionally, the `CONCURRENTLY` option instructs PostgreSQL to not use any locks while rebuilding the index.

Third, rebuild all indexes in the `dvdrental` database using the `REINDEX` statement:

```
REINDEX DATABASE dvdrental;
```

Output:

```sql
REINDEX
```

## REINDEX vs. DROP INDEX \& CREATE INDEX

The `REINDEX` statement rebuilds the index from scratch, which has a similar effect as dropping and recreating the index. However, the locking mechanisms between them are different.

The `REINDEX` statement:

- Lock write but not read from the table to which the index belongs.
- Take an exclusive lock on the index that is being processed, which blocks the read that attempts to use the index.

The `DROP INDEX` \& `CREATE INDEX` statements:

- First, the `DROP INDEX` locks both writes and reads of the table to which the index belongs by acquiring an exclusive lock on the table.
- Then, the subsequent `CREATE INDEX` statement locks out writes but not reads from the index’s parent table. However, reads might be expensive during the creation of the index.

## Summary

- Use the PostgreSQL `REINDEX` statement to drop and recreate one or more indexes.


# Display Indexes

---
title: 'PostgreSQL List Indexes'
page_title: 'PostgreSQL List Indexes'
page_description: 'In this tutorial, you will learn how to list indexes from a PostgreSQL database using either pg_indexes view or psql command.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-indexes/postgresql-list-indexes/'
ogImage: ''
updatedOn: '2024-06-07T14:04:49+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL DROP INDEX'
  slug: 'postgresql-indexes/postgresql-drop-index'
nextLink:
  title: 'PostgreSQL Index Types'
  slug: 'postgresql-indexes/postgresql-index-types'
---

**Summary**: in this tutorial, you will learn how to list indexes from a PostgreSQL database by using either `pg_indexes` view or `psql` command.

PostgreSQL does not provide a command like [`SHOW INDEXES`](http://www.mysqltutorial.org/mysql-index/mysql-show-indexes/) to list the index information of a table or database.

However, it does provide you with access to the `pg_indexes` view so that you can query the index information.

If you use the `psql` program to interact with the PostgreSQL database, you can use the `\d` command to view the index information for a table.

## PostgreSQL List Indexes using pg_indexes View

The `pg_indexes` view allows you to access useful information on each index in the PostgreSQL database.

The `pg_indexes` view consists of five columns:

- `schemaname`: stores the name of the schema that contains tables and indexes.
- `tablename`: indicates the name of the table to which the index belongs.
- `indexname`: represents the name of the index.
- `tablespace`: identifies the name of the tablespace that contains indexes.
- `indexdef`: contains the index definition command in the form of [`CREATE INDEX`](postgresql-create-index) statement.

The following statement lists all indexes of the schema `public` in the current database:

```phpsql
SELECT
    tablename,
    indexname,
    indexdef
FROM
    pg_indexes
WHERE
    schemaname = 'public'
ORDER BY
    tablename,
    indexname;
```

Output:

```text
     tablename      |                      indexname                      |                                                                   indexdef
--------------------+-----------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------
 accounts           | accounts_email_key                                  | CREATE UNIQUE INDEX accounts_email_key ON public.accounts USING btree (email)
 accounts           | accounts_pkey                                       | CREATE UNIQUE INDEX accounts_pkey ON public.accounts USING btree (user_id)
 accounts           | accounts_username_key                               | CREATE UNIQUE INDEX accounts_username_key ON public.accounts USING btree (username)
 actor              | actor_pkey                                          | CREATE UNIQUE INDEX actor_pkey ON public.actor USING btree (actor_id)
 actor              | idx_actor_first_name                                | CREATE INDEX idx_actor_first_name ON public.actor USING btree (first_name)
 actor              | idx_actor_last_name                                 | CREATE INDEX idx_actor_last_name ON public.actor USING btree (last_name)
...
```

To show all the indexes of a table, you use the following statement:

```sql
SELECT
  indexname,
  indexdef
FROM
  pg_indexes
WHERE
  tablename = 'table_name';
```

For example, to list all the indexes for the `customer` table, you use the following statement:

```
SELECT
    indexname,
    indexdef
FROM
    pg_indexes
WHERE
    tablename = 'customer';
```

Here is the output:

```php
     indexname     |                                    indexdef
-------------------+--------------------------------------------------------------------------------
 customer_pkey     | CREATE UNIQUE INDEX customer_pkey ON public.customer USING btree (customer_id)
 idx_fk_address_id | CREATE INDEX idx_fk_address_id ON public.customer USING btree (address_id)
 idx_fk_store_id   | CREATE INDEX idx_fk_store_id ON public.customer USING btree (store_id)
 idx_last_name     | CREATE INDEX idx_last_name ON public.customer USING btree (last_name)
(4 rows)

```

If you want to get a list of indexes for tables whose names start with the letter `c`, you can use the following query:

```sql
SELECT
    tablename,
    indexname,
    indexdef
FROM
    pg_indexes
WHERE
    tablename LIKE 'c%'
ORDER BY
    tablename,
    indexname;
```

The following shows the output:

```php
 tablename  |     indexname     |                                      indexdef
------------+-------------------+------------------------------------------------------------------------------------
 categories | categories_pkey   | CREATE UNIQUE INDEX categories_pkey ON public.categories USING btree (category_id)
 category   | category_pkey     | CREATE UNIQUE INDEX category_pkey ON public.category USING btree (category_id)
 city       | city_pkey         | CREATE UNIQUE INDEX city_pkey ON public.city USING btree (city_id)
 city       | idx_fk_country_id | CREATE INDEX idx_fk_country_id ON public.city USING btree (country_id)
 country    | country_pkey      | CREATE UNIQUE INDEX country_pkey ON public.country USING btree (country_id)
 customer   | customer_pkey     | CREATE UNIQUE INDEX customer_pkey ON public.customer USING btree (customer_id)
 customer   | idx_fk_address_id | CREATE INDEX idx_fk_address_id ON public.customer USING btree (address_id)
 customer   | idx_fk_store_id   | CREATE INDEX idx_fk_store_id ON public.customer USING btree (store_id)
 customer   | idx_last_name     | CREATE INDEX idx_last_name ON public.customer USING btree (last_name)
(9 rows)

```

## PostgreSQL List Indexes using psql command

If you use `psql` to connect to a PostgreSQL database and want to list all indexes of a table, you can use the `\d` [psql command](../postgresql-administration/psql-commands) as follows:

```plaintext
\d table_name
```

The command will return all information about the table including the table’s structure, indexes, constraints, and [triggers](../postgresql-triggers).

For example, the following statement returns detailed information about the `customer` table:

```plaintext
\d customer
```

The output is:

```plaintext
                                             Table "public.customer"
   Column    |            Type             | Collation | Nullable |                    Default
-------------+-----------------------------+-----------+----------+-----------------------------------------------
 customer_id | integer                     |           | not null | nextval('customer_customer_id_seq'::regclass)
 store_id    | smallint                    |           | not null |
 first_name  | character varying(45)       |           | not null |
 last_name   | character varying(45)       |           | not null |
 email       | character varying(50)       |           |          |
 address_id  | smallint                    |           | not null |
 activebool  | boolean                     |           | not null | true
 create_date | date                        |           | not null | 'now'::text::date
 last_update | timestamp without time zone |           |          | now()
 active      | integer                     |           |          |
Indexes:
    "customer_pkey" PRIMARY KEY, btree (customer_id)
    "idx_fk_address_id" btree (address_id)
    "idx_fk_store_id" btree (store_id)
    "idx_last_name" btree (last_name)
Foreign-key constraints:
    "customer_address_id_fkey" FOREIGN KEY (address_id) REFERENCES address(address_id) ON UPDATE CASCADE ON DELETE RESTRICT
Referenced by:
    TABLE "payment" CONSTRAINT "payment_customer_id_fkey" FOREIGN KEY (customer_id) REFERENCES customer(customer_id) ON UPDATE CASCADE ON DELETE RESTRICT
    TABLE "rental" CONSTRAINT "rental_customer_id_fkey" FOREIGN KEY (customer_id) REFERENCES customer(customer_id) ON UPDATE CASCADE ON DELETE RESTRICT
Triggers:
    last_updated BEFORE UPDATE ON customer FOR EACH ROW EXECUTE FUNCTION last_updated()

```

The output shows the index of the table under the **Indexes** section.

## Summary

- Query data from the `pg_indexes` view to retrieve the index information.
- Use the `\d table_name` command to display the table information along with indexes.


# Drop Indexes

---
title: 'PostgreSQL DROP INDEX'
page_title: 'PostgreSQL DROP INDEX Statement'
page_description: 'This tutorial shows you step by step how to use the PostgreSQL DROP INDEX statement to remove an existing index.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-indexes/postgresql-drop-index/'
ogImage: '/postgresqltutorial/actor.png'
updatedOn: '2024-02-28T10:30:19+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL REINDEX'
  slug: 'postgresql-indexes/postgresql-reindex'
nextLink:
  title: 'PostgreSQL List Indexes'
  slug: 'postgresql-indexes/postgresql-list-indexes'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `DROP INDEX` statement to remove an existing index.

## Introduction to PostgreSQL DROP INDEX statement

Sometimes, you may want to remove an existing index from the database system. To do it, you use the `DROP INDEX` statement as follows:

```phpsql
DROP INDEX  [ CONCURRENTLY] [ IF EXISTS ]  index_name
[ CASCADE | RESTRICT ];
```

In this syntax:

### index_name

You specify the name of the index that you want to remove after the `DROP INDEX` clause.

### IF EXISTS

Attempting to remove a non\-existent index will result in an error. To avoid this, you can use the `IF EXISTS` option. In case you remove a non\-existent index with `IF EXISTS`, PostgreSQL issues a notice instead.

### CASCADE

If the index has dependent objects, you use the `CASCADE` option to automatically drop these objects and all objects that depend on those objects.

### RESTRICT

The `RESTRICT` option instructs PostgreSQL to refuse to drop the index if any objects depend on it. The `DROP INDEX` uses `RESTRICT` by default.

Note that you can drop multiple indexes at a time by separating the indexes by commas (,):

```sql
DROP INDEX index_name, index_name2,... ;
```

### CONCURRENTLY

When you execute the `DROP INDEX` statement, PostgreSQL acquires an exclusive lock on the table and blocks other accesses until the index removal is completed.

To force the command to wait until the conflicting transaction completes before removing the index, you can use the `CONCURRENTLY` option.

The `DROP INDEX CONCURRENTLY` has some limitations:

- First, the `CASCADE` option is not supported.
- Second, executing in a transaction block is also not supported.

## PostgreSQL DROP INDEX example

We will use the `actor` table from the [sample database](../postgresql-getting-started/postgresql-sample-database) for the demonstration.

![actor](/postgresqltutorial/actor.png)
The following statement [creates an index](postgresql-create-index) for the `first_name` column of the `actor` table:

```sql
CREATE INDEX idx_actor_first_name
ON actor (first_name);
```

Sometimes, the query optimizer does not use the index. For example, the following statement finds the actor with the name `John`:

```sql
SELECT * FROM actor
WHERE first_name = 'John';
```

The query did not use the `idx_actor_first_name` index defined earlier as explained in the following [`EXPLAIN`](../postgresql-tutorial/postgresql-explain) statement:

```sql
EXPLAIN SELECT *
FROM actor
WHERE first_name = 'John';
```

Output:

```
                      QUERY PLAN
------------------------------------------------------
 Seq Scan on actor  (cost=0.00..4.50 rows=1 width=25)
   Filter: ((first_name)::text = 'John'::text)
(2 rows)

```

This is because the query optimizer thinks that it is more optimal to just scan the entire table to locate the row. Hence, the `idx_actor_first_name` is not useful in this case, you can remove it:

```
DROP INDEX idx_actor_first_name;
```

The statement removed the index as expected.

## Summary

- Use the PostgreSQL `DROP INDEX` statement to delete an index.


# Types of Indexes

---
title: 'PostgreSQL Index Types'
page_title: 'PostgreSQL Index Types'
page_description: 'In this tutorial, you will learn about various PostgreSQL index types and how to use them properly.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-indexes/postgresql-index-types/'
ogImage: ''
updatedOn: '2024-02-01T08:10:12+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL List Indexes'
  slug: 'postgresql-indexes/postgresql-list-indexes'
nextLink:
  title: 'PostgreSQL Full Text Search'
  slug: 'postgresql-indexes/postgresql-full-text-search'
---

**Summary**: in this tutorial, you will learn about various PostgreSQL index types and how to use them appropriately.

PostgreSQL has several index types: B\-tree, Hash, GiST, SP\-GiST, GIN, and BRIN. Each index type uses a different storage structure and algorithm to cope with different kinds of queries.

When you use the [`CREATE INDEX`](postgresql-create-index) statement without specifying the index type, PostgreSQL uses the B\-tree index type by default because it is best to fit the most common queries.

## B\-tree indexes

B\-tree is a self\-balancing tree that maintains sorted data and allows searches, insertions, deletions, and sequential access in logarithmic time.

PostgreSQL query planner will consider using a B\-tree index whenever index columns are involved in a comparison that uses one of the following operators:

```phpsql
<
<=
=
>=
BETWEEN
IN
IS NULL
IS NOT NULL
```

In addition, the query planner can use a B\-tree index for queries that involve a pattern\-matching operator [`LIKE`](../postgresql-tutorial/postgresql-like) and `~` if the pattern is a constant and is anchor at the beginning of the pattern, for example:

```
column_name LIKE 'foo%'
column_name LKE 'bar%'
column_name  ~ '^foo'
```

Furthermore, the query planner will consider using B\-tree indexes for `ILIKE` and `~*` if the pattern starts with a non\-alphabetic character which are the characters that are not affected by upper/lower case conversion.

If you have started using an index to optimize your PostgreSQL database, B\-tree is probably the one that you want.

## Hash indexes

Hash indexes can handle only simple equality comparison (\=). It means that whenever an indexed column is involved in a comparison using the equal(\=) operator, the query planner will consider using a hash index.

To create a hash index, you use the `CREATE INDEX` statement with the `HASH` index type in the `USING` clause as follows:

```
CREATE INDEX index_name
ON table_name USING HASH (indexed_column);
```

## GIN indexes

GIN stands for **g**eneralized **in**verted indexes. It is commonly referred to as GIN.

GIN indexes are most useful when you have multiple values stored in a single column, for example, [hstore](../postgresql-tutorial/postgresql-hstore), [array](../postgresql-tutorial/postgresql-array), jsonb, and range types.

## BRIN

BRIN stands for **b**lock **r**ange **in**dexes. BRIN is much smaller and less costly to maintain in comparison with a B\-tree index.

BRIN allows the use of an index on a very large table that would previously be impractical using a B\-tree without horizontal partitioning.

BRIN is often used on a column that has a linear sort order, for example, the created date column of the sales order table.

## GiST Indexes

GiST stands for Generalized Search Tree. GiST indexes allow the building of general tree structures. GiST indexes are useful in indexing geometric data types and full\-text searches.

## SP\-GiST Indexes

SP\-GiST stands for space\-partitioned GiST. SP\-GiST supports partitioned search trees that facilitate the development of a wide range of different non\-balanced data structures.

SP\-GiST indexes are most useful for data that has a natural clustering element to it and is also not an equally balanced tree, for example, GIS, multimedia, phone routing, and IP routing.

In this tutorial, you have learned various PostgreSQL index types including B\-tree, Hash, BRIN, GiST, and SP\-GiST.


# Full Text Search

---
title: 'PostgreSQL Full Text Search'
page_title: 'PostgreSQL Full-text Search'
page_description: 'Learn about PostgreSQL full-text search and how to use it to perform complex searches on text stored in the database.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-indexes/postgresql-full-text-search/'
ogImage: ''
updatedOn: '2024-03-29T02:51:11+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Index Types'
  slug: 'postgresql-indexes/postgresql-index-types'
nextLink:
  title: 'PostgreSQL JSON Index'
  slug: 'postgresql-indexes/postgresql-json-index'
---

**Summary**: in this tutorial, you will learn about PostgreSQL full text search and how to use it to perform complex searches on text stored in the database.

## Introduction to the PostgreSQL full\-text search

In PostgreSQL, full\-text search is a built\-in feature that allows you to perform complex searches on text stored in the database.

Full\-text search enables efficient searching of documents, articles, or any form of text\-based content by indexing their words and phrases.

The following describes an overview of how the PostgreSQL full text search works:

- **Indexing**: PostgreSQL allows you to create indexes on columns with the tsvector data type. When creating a full\-text search index, PostgreSQL analyzes text data and generates a specialized data structure called **tsvector**, which represents the indexed document in a format optimized for searches.
- **Text analysis**: For building a full text index, PostgreSQL performs a text analysis process that involves tokenizing text into individual words or tokens, removing stop words ( like `the`, `and`,..) applying stemming (or lemmatization) to reduce words to their root forms, and performing other linguistic transformations to prepare the text for indexing.
- **Querying**: Once PostgreSQL creates the full text index, you can perform full\-text search queries using dedicated full text search functions and operators. For example, you can search for specific words or phrases, apply boolean operators to combine search terms, and more.
- **Ranking**: allows you to rank the search results based on their relevance to the query. PostgreSQL offers the `ts_rank()` function to calculate a rank score for each document based on its similarity to the search query. You can use the ranking feature to sort the search results based on relevance.
- **Highlighting**: PostgreSQL can generate snippets or summaries of documents containing the matching words from the search query.

In practice, you often use the full text search feature in applications including content management systems (`CMS`), document management systems, and so on to enable fast searches on a large volume of text.

## PostgreSQL full text search data types

PostgreSQL provides you with two data types unique to full text search: `tsvector` and `tsquery`:

### tsvector

`tsvector` is a data type that allows you to store preprocessed documents in a format optimized for efficient searching and retrieval of text.

A `tsvector` value contains a sorted list of lexemes (words) and their positions and weight within a document.

Note that lexemes are words without the variation created by suffixes, for example, `watches`, `watched`, and `watching` words have the lexeme `watch`.

For example, the following uses the `to_tsvector()` function to convert the words `watches`, `watched`, and `watching` to `tsvector`:

```sql
SELECT to_tsvector('waches'),
       to_tsvector('wached'),
       to_tsvector('waching');
```

Output:

```text
 to_tsvector | to_tsvector | to_tsvector
-------------+-------------+-------------
 'wach':1    | 'wach':1    | 'wach':1
(1 row)
```

In this example, the `to_tsvector()` function converts the words into tsvector values. Instead of returning the original words, it returns the lexemes of these words, which is `watch`.

The following example uses the `to_tsvector()` function to convert a string to a tsvector value. For example:

```sql
SELECT to_tsvector('The quick brown fox jumps over the lazy dog.');
```

Output:

```text
                      to_tsvector
-------------------------------------------------------
 'brown':3 'dog':9 'fox':4 'jump':5 'lazi':8 'quick':2
(1 row)
```

In this example:

- Each entry in the tsvector value represents a word (lexeme) and its position within the string (or document). For example, the word `quick` appears at position 2, the word `brown` appears at position 3, and so on.
- Words are sorted in alphabetical order.
- Articles and stop words are omitted like `The` and `over`.

### tsquery

`tsquery` is a data type that represents search queries in full\-text searches. It allows you to specify search conditions containing the indexed document’s words or phrases.

Additionally, a `tsquery` value can include search operators to refine the search conditions.

- **Boolean operators** AND (\&), OR (\|), and NOT (!): can combine search terms and define logical relationships between them.
- **Phrase search** (“”): Double quotes (“”) indicate that the enclosed words must appear together in the index document in the specified order.
- **Prefix search** (:) : A colon (:) after a word indicates that the search term should match words with the same prefix.
- **Negation** (\-): a negation excludes specific terms from the search results.
- **Grouping** (): You can use parentheses to group terms and operators to define flexible search conditions.

For example:

```sql
'quick' & 'brown' | 'fox'
```

This `tsquery` searches for the documents that contain the words “quick” and “brown” together (in any order), or the word “fox”.

The `to_tsquery()` converts a string to a `tsquery`. For example, the following statement uses the `to_tsquery()` to convert the word “jumping” to a `tsquery`:

```sql
SELECT to_tsquery('jumping');
```

Output:

```text
 to_tsquery
------------
 'jump'
(1 row)
```

### The match operator (@@)

The match operator (`@@`) evaluates the similarity between the text in a document (`tsvector`) and the terms specified in the search query (`tsquery`) and returns true if there is a match or false otherwise.

```sql
tsvector @@ tsquery
```

For example, the following statement uses the `@@` operator to determine if the string matches the `tsquery`:

```sql
SELECT
  to_tsvector(
    'The quick brown fox jumps over the lazy dog.'
  ) @@ to_tsquery('jumping') result;
```

Output:

```text
 result
--------
 t
(1 row)
```

It returns true because the tsvector contains the word jump which is the lexeme of the word jumping.

The following example uses the match operator (`@@`) to determine if the string contains the word cat:

```sql
SELECT
  to_tsvector(
    'The quick brown fox jumps over the lazy dog.'
  ) @@ to_tsquery('cat') result;
```

Output:

```text
 result
--------
 f
(1 row)
```

## Using PostgreSQL full\-text search index with table data

Let’s take some examples of using full\-text searches with boolean operators.

### 1\) Setting up a sample table

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `posts`:

```sql
CREATE TABLE posts(
   id SERIAL PRIMARY KEY,
   title TEXT NOT NULL,
   body TEXT,
   body_search TSVECTOR
      GENERATED ALWAYS AS (to_tsvector(body)) STORED
);
```

In the `posts` table, the `body_search` is a [generated column](../postgresql-tutorial/postgresql-generated-columns) with the data type `tsvector`.

Whenever you change data in the `body` column, PostgreSQL will convert it to a `tsvector` using the `to_tsvector()` function and store it in the `body_search` column.

Second, [insert some rows](../postgresql-tutorial/postgresql-insert) into the `posts` table:

```sql
INSERT INTO posts (title, body)
VALUES
    ('Introduction to PostgreSQL', 'This is an introductory post about PostgreSQL. It covers basic concepts and features.'),
    ('Advanced PostgresSQL Techniques', 'In this post, we delve into advanced PostgreSQL techniques for efficient querying and data manipulation.'),
    ('PostgreSQL Optimization Strategies', 'This post explores various strategies for optimizing PostgreSQL database performance and efficiency.');
```

Third, retrieve data from the `id` and `body_search` columns:

```sql
SELECT
  id,
  body_search
FROM
  posts;
```

Output:

```text
 id |                                                body_search
----+------------------------------------------------------------------------------------------------------------
  1 | 'basic':10 'concept':11 'cover':9 'featur':13 'introductori':4 'post':5 'postgresql':7
  2 | 'advanc':7 'data':14 'delv':5 'effici':11 'manipul':15 'post':3 'postgresql':8 'queri':12 'techniqu':9
  3 | 'databas':9 'effici':12 'explor':3 'optim':7 'perform':10 'post':2 'postgresql':8 'strategi':5 'various':4
(3 rows)
```

### 2\) Simple full\-text search

The following example uses the match operator (`@@`) to search for posts whose `body` contains the word `"PostgreSQL"`:

```sql
SELECT
  id,
  body
FROM
  posts
WHERE
  body_search @@ to_tsquery('PostgreSQL');
```

Output:

```text
 id |                                                   body
----+----------------------------------------------------------------------------------------------------------
  1 | This is an introductory post about PostgreSQL. It covers basic concepts and features.
  2 | In this post, we delve into advanced PostgreSQL techniques for efficient querying and data manipulation.
  3 | This post explores various strategies for optimizing PostgreSQL database performance and efficiency.
(3 rows)
```

### 3\) Full\-text search with AND operator

The following example uses the AND operator (\&) to search for posts whose body contains both words “PostgreSQL” and “techniques” that can appear in any order:

```sql
SELECT
  id,
  body
FROM
  posts
WHERE
  body_search @@ to_tsquery('PostgreSQL & techniques');
```

Output:

```text
 id |                                                   body
----+----------------------------------------------------------------------------------------------------------
  2 | In this post, we delve into advanced PostgreSQL techniques for efficient querying and data manipulation.
(1 row)

```

### 4\) Full\-text search with OR operator

The following example uses the OR operator (\|) to search for posts whose body contains either the word `"efficient"` or `"optimization"`:

```sql
SELECT
  id,
  body
FROM
  posts
WHERE
  body_search @@ to_tsquery('efficient | optimization');
```

Output:

```text
 id |                                                   body
----+----------------------------------------------------------------------------------------------------------
  2 | In this post, we delve into advanced PostgreSQL techniques for efficient querying and data manipulation.
  3 | This post explores various strategies for optimizing PostgreSQL database performance and efficiency.
(2 rows)
```

### 5\) full\-text search with phrase

The following example searches for posts whose body contains the phrase “PostgreSQL technique”:

```sql
SELECT
  id,
  body
FROM
  posts
WHERE
  body_search @@ to_tsquery('''PostgreSQL technique''');
```

Output:

```text
 id |                                                   body
----+----------------------------------------------------------------------------------------------------------
  2 | In this post, we delve into advanced PostgreSQL techniques for efficient querying and data manipulation.
(1 row)
```

### 6\) Full\-text search with negation

The following example searches for posts whose body does not contain the word “efficient”:

```sql
SELECT id, body
FROM posts
WHERE NOT body_search @@ to_tsquery('efficient');
```

Output:

```text
 id |                                         body
----+---------------------------------------------------------------------------------------
  1 | This is an introductory post about PostgreSQL. It covers basic concepts and features.
(1 row)
```

## Full text search using GIN indexes

In PostgreSQL, GIN stands for Generalized Inverted Index. GIN index is a type of index that is optimized for full\-text search vectors (`tsvector`).

First, drop the `posts` table and recreate it using the following statements:

```sql
DROP TABLE IF EXISTS posts;

CREATE TABLE posts(
   id SERIAL PRIMARY KEY,
   title TEXT NOT NULL,
   body TEXT
);
```

Second, [insert rows](../postgresql-tutorial/postgresql-insert) into the `posts` table:

```sql
INSERT INTO posts (title, body)
VALUES
    ('Introduction to PostgreSQL', 'This is an introductory post about PostgreSQL. It covers basic concepts and features.'),
    ('Advanced PostgresSQL Techniques', 'In this post, we delve into advanced PostgreSQL techniques for efficient querying and data manipulation.'),
    ('PostgreSQL Optimization Strategies', 'This post explores various strategies for optimizing PostgreSQL database performance and efficiency.');
```

Third, create a GIN index on the `body` column of the `posts` table:

```sql
CREATE INDEX body_fts
ON posts
USING GIN ((to_tsvector('english',body)));
```

Finally, search for the `posts` whose body contains either the word `basic` or `advanced`:

```sql
SELECT
  id,
  body
FROM
  posts
WHERE
  body @@ to_tsquery('basic | advanced');
```

Output:

```text
 id |                                                   body
----+----------------------------------------------------------------------------------------------------------
  1 | This is an introductory post about PostgreSQL. It covers basic concepts and features.
  2 | In this post, we delve into advanced PostgreSQL techniques for efficient querying and data manipulation.
(2 rows)
```

## Summary

- Use PostgreSQL full text search feature to perform complex searches on text stored in the database.
- Use tsvector and tsquery data types for full text searches.
- Use the match operator (`@@`) to check if documents match a query.
- Use the generated column with `tsvector` type to store the tsvector data for full text searches.
- Use `GIN` indexes for full\-text search vectors (`tsvector`).


# JSON Index

---
title: 'PostgreSQL JSON Index'
page_title: 'PostgreSQL JSON Index'
page_description: 'In this tutorial, you will learn how to create a PostgreSQL JSON index for a JSONB column to improve query performance.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-indexes/postgresql-json-index/'
ogImage: ''
updatedOn: '2024-03-06T08:18:53+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Full Text Search'
  slug: 'postgresql-indexes/postgresql-full-text-search'
nextLink:
  title: 'PostgreSQL Administration'
  slug: 'postgresql-indexes/../postgresql-administration'
---

**Summary**: in this tutorial, you will learn how to create a PostgreSQL JSON index for a JSONB column to improve query performance.

## Introduction to PostgreSQL JSON index

JSONB (binary JSON) is a data type that allows you to store JSON data and query it efficiently.

When a JSONB column has a complex JSON structure, utilizing an index can significantly improve query performance.

PostgreSQL uses the `GIN` index type for indexing a column with JSONB data type. `GIN` stands for Generalized Inverted Index.

Note that you can utilize the GIN index for tsvector or array columns.

To create a `GIN` index for a JSONB column, you can use the following `CREATE INDEX` statement:

```sql
CREATE INDEX index_name
ON table_name
USING GIN(jsonb_column);
```

This statement creates a `GIN` index on the `jsonb_column`. This `GIN` index is suitable for general\-purpose queries on JSONB data.

When creating a `GIN` index on a JSONB column, you can use a specific `GIN` operator class.

The operator class determines how PostgreSQL builds the index and how it optimizes the queries on the indexed column.

For example, The following `CREATE INDEX` statement creates a `GIN` index on the `jsonb_coumn` with `jsonb_path_ops` operator class:

```sql
CREATE INDEX index_name
ON table_name
USING GIN(jsonb_column jsonb_path_ops);
```

This index is optimized for the queries that use the @\> (contains), ? (exists), and @@ JSONB operators. It can be useful for searches involving keys or values within JSONB documents.

The following table displays the `GIN` operator classes:

| Name                     | Indexable Operators      |
| ------------------------ | ------------------------ |
| `array_ops`              | `&& (anyarray,anyarray)` |
| `@> (anyarray,anyarray)` |
| `<@ (anyarray,anyarray)` |
| `= (anyarray,anyarray)`  |
| `jsonb_ops`              | `@> (jsonb,jsonb)`       |
| `@? (jsonb,jsonpath)`    |
| `@@ (jsonb,jsonpath)`    |
| `? (jsonb,text)`         |
| `?                       | (jsonb,text[])`          |
| `?& (jsonb,text[])`      |
| `jsonb_path_ops`         | `@> (jsonb,jsonb)`       |
| `@? (jsonb,jsonpath)`    |
| `@@ (jsonb,jsonpath)`    |
| `tsvector_ops`           | `@@ (tsvector,tsquery)`  |
| `@@@ (tsvector,tsquery)` |

Note that if you don’t explicitly specify a `GIN` operator class, the statement will use the `jsonb_ops` operator by default, which is suitable for most cases.

Additionally, PostgreSQL allows you to create a `GIN` index for a specific field in JSON documents as follows:

```sql
CREATE INDEX index_name
ON table_name
USING GIN ((data->'field_name') jsonb_path_ops);
```

This index can improve the queries that involve searching values within the `field_name` of JSON documents stored in the JSONB column (data).

## PostgreSQL JSON index examples

We’ll use the tables in the [sample database](../postgresql-getting-started/postgresql-sample-database).

### 1\) Setting up a sample table

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `customer_json` that stores the customer information in JSON format:

```sql
CREATE TABLE customer_json(
   id SERIAL PRIMARY KEY,
   data JSONB NOT NULL
);
```

Second, insert data from the `customer`, `address`, `city`, and `country` tables into the `customer_json` table:

```sql
WITH json_cte AS(
  SELECT
    jsonb_build_object(
      'first_name',  first_name,
      'last_name',  last_name,
      'email',  email,
      'phone',  a.phone,
      'address',
      jsonb_build_object(
        'address', a.address,
        'city', i.city,
        'postal_code', a.postal_code,
        'district',  a.district,
        'country', o.country
      )
    ):: jsonb AS data
  FROM
    customer c
    INNER JOIN address a ON a.address_id = c.address_id
    INNER JOIN city i ON i.city_id = a.city_id
    INNER JOIN country o ON o.country_id = i.country_id
)
INSERT INTO customer_json(data)
SELECT
  data
FROM
  json_cte;
```

Third, retrieve the email of the customer whose first name is `John`:

```sql
SELECT
   data ->> 'first_name' first_name,
   data ->> 'last_name' last_name,
   data ->> 'phone' phone
FROM
   customer_json
WHERE
   data @> '{"first_name": "John"}';
```

Output:

```text
 first_name | last_name  |    phone
------------+------------+-------------
 John       | Farnsworth | 51917807050
(1 row)
```

Finally, explain and analyze the above query:

```sql
EXPLAIN ANALYZE
SELECT
   data ->> 'first_name' first_name,
   data ->> 'last_name' last_name,
   data ->> 'phone' phone
FROM
   customer_json
WHERE
   data @> '{"first_name": "John"}';
```

Output:

```text
                                               QUERY PLAN
---------------------------------------------------------------------------------------------------------
 Seq Scan on customer_json  (cost=0.00..31.50 rows=1 width=96) (actual time=0.063..0.118 rows=1 loops=1)
   Filter: (data @> '{"first_name": "John"}'::jsonb)
   Rows Removed by Filter: 598
 Planning Time: 1.109 ms
 Execution Time: 0.128 ms
(5 rows)
```

The output indicates that PostgreSQL has to scan the entire `customer_json` table to search for the customer.

To improve the performance of the query, you can create a `GIN` index on the data column of the `customer_json` table.

### 2\) Creating an index on the JSONB column

First, [create an index](postgresql-create-index) on the `data` column of the `customer_json` table:

```sql
CREATE INDEX customer_json_index
ON customer_json
USING GIN(data);
```

Second, execute the query that searches for the customer whose first name is `John`:

```sql
EXPLAIN ANALYZE
SELECT
   data ->> 'first_name' first_name,
   data ->> 'last_name' last_name,
   data ->> 'phone' phone
FROM
   customer_json
WHERE
   data @> '{"first_name": "John"}';
```

Output:

```text
                                                         QUERY PLAN
-----------------------------------------------------------------------------------------------------------------------------
 Bitmap Heap Scan on customer_json  (cost=21.51..25.53 rows=1 width=96) (actual time=0.024..0.024 rows=1 loops=1)
   Recheck Cond: (data @> '{"first_name": "John"}'::jsonb)
   Heap Blocks: exact=1
   ->  Bitmap Index Scan on customer_json_index  (cost=0.00..21.51 rows=1 width=0) (actual time=0.014..0.014 rows=1 loops=1)
         Index Cond: (data @> '{"first_name": "John"}'::jsonb)
 Planning Time: 0.164 ms
 Execution Time: 0.045 ms
(7 rows)
```

The query plan indicates that PostgreSQL uses the `customer_json_index` to improve the performance.

This time, the execution time is significantly smaller `0.045ms` vs. `0.128` ms, about 2 – 3 times faster than a query without using the `GIN` index.

### 3\) Creating an index on the JSONB column with the GIN operator class

First, [drop](postgresql-drop-index) the `customer_json_index` index:

```sql
DROP INDEX customer_json_index;
```

Second, create a `GIN` index on the data column of the `customer_json` table with a `GIN` operator class:

```sql
CREATE INDEX customer_json_index
ON customer_json
USING GIN(data jsonb_path_ops);
```

Third, explain the query that finds the customer whose first name is `John`:

```sql
EXPLAIN ANALYZE
SELECT
   data ->> 'first_name' first_name,
   data ->> 'last_name' last_name,
   data ->> 'phone' phone
FROM
   customer_json
WHERE
   data @> '{"first_name": "John"}';
```

Output:

```text
                                                         QUERY PLAN
-----------------------------------------------------------------------------------------------------------------------------
 Bitmap Heap Scan on customer_json  (cost=12.82..16.84 rows=1 width=96) (actual time=0.014..0.015 rows=1 loops=1)
   Recheck Cond: (data @> '{"first_name": "John"}'::jsonb)
   Heap Blocks: exact=1
   ->  Bitmap Index Scan on customer_json_index  (cost=0.00..12.82 rows=1 width=0) (actual time=0.008..0.008 rows=1 loops=1)
         Index Cond: (data @> '{"first_name": "John"}'::jsonb)
 Planning Time: 0.120 ms
 Execution Time: 0.034 ms
(7 rows)
```

The query plan shows that the query does use the `customer_json_index` for improved performance.

Finally, explain the query that searches for the customer where the value in the `first_name` field within the data column is John:

```sql
EXPLAIN ANALYZE
SELECT * FROM customer_json
WHERE data->>'first_name' = 'John';
```

Output:

```text
                                                QUERY PLAN
----------------------------------------------------------------------------------------------------------
 Seq Scan on customer_json  (cost=0.00..32.98 rows=3 width=275) (actual time=0.161..0.284 rows=1 loops=1)
   Filter: ((data ->> 'first_name'::text) = 'John'::text)
   Rows Removed by Filter: 598
 Planning Time: 0.085 ms
 Execution Time: 0.298 ms
(5 rows)
```

In this plan, the query cannot fully utilize the `GIN` index `customer_json_index`. The reason is that the query does not use the JSONB operator (`@`, `@?`, `@@`) that the `jsonb_path_ops` operator class is optimized for.

### 4\) Creating an index on a specific field of a JSONB column

First, drop the `customer_json_index` index:

```sql
DROP INDEX customer_json_index;
```

Second, create a `GIN` index on the `first_name` field of the `customer_json` table using the `GIN` operator class:

```sql
CREATE INDEX customer_json_index
ON customer_json
USING GIN((data->'first_name'));
```

Third, explain the query that finds the rows where the “`first_name`” field in the `data` JSONB column contains the value `"John"`:

```sql
EXPLAIN ANALYZE
SELECT
   data ->> 'first_name' first_name,
   data ->> 'last_name' last_name,
   data ->> 'phone' phone
FROM
   customer_json
WHERE
   data->'first_name' @> '"John"';
```

Output:

```text
                                                         QUERY PLAN
----------------------------------------------------------------------------------------------------------------------------
 Bitmap Heap Scan on customer_json  (cost=8.58..23.72 rows=6 width=96) (actual time=0.031..0.032 rows=1 loops=1)
   Recheck Cond: ((data -> 'first_name'::text) @> '"John"'::jsonb)
   Heap Blocks: exact=1
   ->  Bitmap Index Scan on customer_json_index  (cost=0.00..8.58 rows=6 width=0) (actual time=0.015..0.015 rows=1 loops=1)
         Index Cond: ((data -> 'first_name'::text) @> '"John"'::jsonb)
 Planning Time: 0.167 ms
 Execution Time: 0.133 ms
(7 rows)
```

The output indicates that the query uses the `customer_json_index` index.

## Summary

- Use the `GIN` index to create an index for a JSONB column of a table to improve query performance.


# PostgreSQL Trigger Basics

---
title: 'PostgreSQL Triggers'
page_title: 'PostgreSQL Triggers'
page_description: 'Show how to work with PostgreSQL triggers, which are the functions invoked automatically when an event occurs in the associated tables.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-triggers/'
ogImage: ''
updatedOn: '2024-04-10T15:08:37+00:00'
enableTableOfContents: true
previousLink:
  title: 'PL/pgSQL Cursor'
  slug: 'postgresql-plpgsql/plpgsql-cursor'
nextLink:
  title: 'Introduction to PostgreSQL Trigger'
  slug: 'postgresql-triggers/introduction-postgresql-trigger'
---

![](/postgresqltutorial/PostgreSQL-Trigger.png?alignright)
A PostgreSQL trigger is a database object that automatically executes a [function](postgresql-plpgsql/postgresql-create-function) in response to an event such as [insert](postgresql-tutorial/postgresql-insert), [update](postgresql-tutorial/postgresql-update), [delete](postgresql-tutorial/postgresql-delete), or [truncate](postgresql-tutorial/postgresql-truncate-table). In this section, you will learn about triggers and how to use them effectively.

## Section 1\. Basic PostgreSQL Triggers

- [Introduction to PostgreSQL trigger](postgresql-triggers/introduction-postgresql-trigger 'Introduction to PostgreSQL Trigger') – Give you a brief overview of PostgreSQL triggers, why you should use triggers, and when to use them.
- [Create trigger](postgresql-triggers/creating-first-trigger-postgresql 'Creating the First Trigger in PostgreSQL') – Show you how to create your first trigger in PostgreSQL.
- [Drop trigger](postgresql-triggers/postgresql-drop-trigger)– Describe steps for using the `DROP TRIGGER` statement to delete a trigger from a table.
- [Alter trigger](postgresql-triggers/postgresql-alter-trigger) – Guide you on how to use the `ALTER TRIGGER` statement to rename a trigger.

## Section 2\. INSERT triggers

- [BEFORE INSERT triggers](postgresql-triggers/postgresql-before-insert-trigger) – Show you how to create a trigger that is activated automatically before an INSERT event occurs on the associated table.
- [AFTER INSERT triggers](postgresql-triggers/postgresql-after-insert-trigger) – Guide you on defining a trigger activated automatically after an INSERT event occurs on the associated table.

## Section 3\. UPDATE triggers

- [BEFORE UPDATE triggers](postgresql-triggers/postgresql-before-update-trigger) – Define a BEFORE UPDATE trigger that is activated before an update event occurs.
- [AFTER UPDATE triggers](postgresql-triggers/postgresql-after-update-trigger) – Create an AFTER UPDATE trigger fired after an update event occurs.

## Section 4\. DELETE triggers

- [BEFORE DELETE triggers](postgresql-triggers/postgresql-before-delete-trigger) – Define a BEFORE DELETE trigger that fires before a delete event occurs.
- [AFTER DELETE triggers](postgresql-triggers/postgresql-after-update-trigger) – Create an AFTER DELETE trigger fired after a delete event occurs.

## Section 5\. INSTEAD OF triggers

- [INSTEAD OF triggers](postgresql-triggers/postgresql-instead-of-triggers) – Show you how to use the INSTEAD OF trigger to customize the behavior of the INSERT, UPDATE, and DELETE operations on a view.

## Section 6\. TRUNCATE triggers

- [BEFORE TRUNDCATE Trigger](postgresql-triggers/postgresql-before-truncate-trigger) –  Create a trigger to response before a TRUNCATE event occurs.

## Section 7\. Enabling \& Disabling triggers

- [Disable trigger](postgresql-triggers/managing-postgresql-trigger 'Managing PostgreSQL Trigger') –  Show how to disable a trigger or all triggers that belong to a table.
- [Enable triggers](postgresql-triggers/enable-triggers) – Learn how to enable a trigger or all triggers associated with a table.

## Section 8\. Listing triggers

- [Listing triggers](postgresql-triggers/how-to-list-all-triggers-in-postgresql) –  List all triggers associated with a table or all triggers in the current database.

## Section 9\. Advanced triggers

- [Event trigger](postgresql-triggers/postgresql-event-trigger) –  Introduce the event trigger that fires when an event related to a DDL statement occurs.
- [Conditional trigger](postgresql-triggers/postgresql-trigger-when-condition) – Define a conditional trigger that fires only when a condition is satisfied.


# noname

# PostgreSQL Triggers

---
title: 'Introduction to PostgreSQL Trigger'
page_title: 'Introduction to PostgreSQL Trigger'
page_description: 'In this tutorial, you will learn what a PostgreSQL trigger is, why you use should use it, and when you use it.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-triggers/introduction-postgresql-trigger/'
ogImage: ''
updatedOn: '2023-01-28T01:15:34+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Triggers'
  slug: 'postgresql-triggers/'
nextLink:
  title: 'PostgreSQL CREATE TRIGGER Statement'
  slug: 'postgresql-triggers/creating-first-trigger-postgresql'
---

**Summary**: in this tutorial, you will learn about PostgreSQL triggers, why you should use the triggers, and when to use them.

## What are PostgreSQL triggers

A PostgreSQL trigger is a [function](../postgresql-plpgsql/postgresql-create-function) invoked automatically whenever an event associated with a table occurs. An event could be any of the following: [INSERT](../postgresql-tutorial/postgresql-insert 'PostgreSQL INSERT'), [UPDATE](../postgresql-tutorial/postgresql-update 'PostgreSQL UPDATE'), [DELETE](../postgresql-tutorial/postgresql-delete 'PostgreSQL DELETE') or [TRUNCATE](../postgresql-tutorial/postgresql-truncate-table 'PostgreSQL TRUNCATE TABLE').

A trigger is a special [user\-defined function](https://neon.tech/postgresql/postgresql-stored-procedures/) associated with a table. To create a new trigger, you define a trigger function first, and then bind this trigger function to a table.

The difference between a trigger and a user\-defined function is that a trigger is automatically invoked when a triggering event occurs.

## PostgreSQL trigger types

PostgreSQL provides two main types of triggers:

- Row\-level triggers
- Statement\-level triggers.

The differences between the two kinds are how many times the trigger is invoked and at what time.

For example, if you issue an `UPDATE` statement that modifies 20 rows, the row\-level trigger will be invoked 20 times, while the statement\-level trigger will be invoked 1 time.

You can specify whether the trigger is invoked before or after an event. If the trigger is invoked before an event, it can skip the operation for the current row or even change the row being updated or inserted. In case the trigger is invoked after the event, all changes are available to the trigger.

## When to use triggers

Triggers are useful in case the database is accessed by various applications, and you want to keep the cross\-functionality within the database that runs automatically whenever the data of the table is modified. For example, if you want to keep the history of data without requiring the application to have logic to check for every event such as `INSERT` or `UDPATE`.

Also, you can use triggers to maintain complex data integrity rules which cannot implement elsewhere except at the database level. For example, when a new row is added into the `customer` table, other rows must be also created in tables of banks and credits.

The main drawback of using a trigger is that you must know the trigger exists and understand its logic to figure out the effects when data changes.

## PostgreSQL triggers vs SQL standard triggers

Even though PostgreSQL implements SQL standard, triggers in PostgreSQL has some specific features:

- PostgreSQL fires trigger for the [`TRUNCATE`](../postgresql-tutorial/postgresql-truncate-table) event.
- PostgreSQL allows you to define the statement\-level trigger on [views](../postgresql-views).
- PostgreSQL requires you to define a user\-defined function as the action of the trigger, while the SQL standard allows you to use any SQL commands.

## Summary

- A trigger is a function invoked automatically when an `INSERT`, `UPDATE`, `DELETE`, or `TRUNCATE` occurs on a table.
- PostgreSQL supports row\-level and statement\-level triggers.


# CREATE TRIGGER

---
title: 'PostgreSQL CREATE TRIGGER Statement'
page_title: 'PostgreSQL CREATE TRIGGER Statement'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL CREATE TRIGGER statement to create a trigger.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-triggers/creating-first-trigger-postgresql/'
ogImage: '/postgresqltutorial/PostgreSQL-Cretae-Trigger-Sample-Table.png'
updatedOn: '2024-03-30T03:13:57+00:00'
enableTableOfContents: true
previousLink:
  title: 'Introduction to PostgreSQL Trigger'
  slug: 'postgresql-triggers/introduction-postgresql-trigger'
nextLink:
  title: 'PostgreSQL DROP TRIGGER Statement'
  slug: 'postgresql-triggers/postgresql-drop-trigger'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `CREATE TRIGGER` statement to create a trigger.

To create a new trigger in PostgreSQL, you follow these steps:

- First, create a trigger function using [`CREATE FUNCTION`](../postgresql-plpgsql/postgresql-create-function) statement.
- Second, bind the trigger function to a table by using `CREATE TRIGGER` statement.

If you are not familiar with creating a user\-defined function, you can check out the [PL/pgSQL section](https://neon.tech/postgresql/postgresql-stored-procedures/ 'PostgreSQL Stored Procedures').

## Create trigger function syntax

A trigger function is similar to a regular [user\-defined function](../postgresql-plpgsql/postgresql-create-function). However, a trigger function does not take any arguments and has a return value with the type `trigger`.

The following illustrates the syntax of creating a trigger function:

```sql
CREATE FUNCTION trigger_function()
   RETURNS TRIGGER
   LANGUAGE PLPGSQL
AS $$
BEGIN
   -- trigger logic
END;
$$
```

Notice that you can create a trigger function using any language supported by PostgreSQL. In this tutorial, we will use PL/pgSQL.

A trigger function receives data about its calling environment through a special structure called `TriggerData` which contains a set of local variables.

For example, `OLD` and `NEW` represent the states of the row in the table before or after the triggering event.

PostgreSQL also provides other local variables preceded by `TG_` such as `TG_WHEN`, and `TG_TABLE_NAME`.

After creating a trigger function, you can bind it to one or more trigger events such as [`INSERT`](../postgresql-tutorial/postgresql-insert), [`UPDATE`](../postgresql-tutorial/postgresql-update), and [`DELETE`](../postgresql-tutorial/postgresql-delete).

## Introduction to PostgreSQL CREATE TRIGGER statement

The `CREATE TRIGGER` statement allows you to create a new trigger.

The following illustrates the basic syntax of the `CREATE TRIGGER` statement:

```sql
CREATE TRIGGER trigger_name
   {BEFORE | AFTER} { event }
   ON table_name
   [FOR [EACH] { ROW | STATEMENT }]
       EXECUTE PROCEDURE trigger_function
```

In this syntax:

First, provide the name of the trigger after the `TRIGGER` keywords.

Second, indicate the timing that causes the trigger to fire. It can be `BEFORE` or `AFTER` an event occurs.

Third, specify the event that invokes the trigger. The event can be `INSERT` , `DELETE`, `UPDATE` or `TRUNCATE`.

Fourth, specify the name of the table associated with the trigger after the `ON` keyword.

Fifth, define the type of triggers, which can be:

- The row\-level trigger that is specified by the `FOR EACH ROW` clause.
- The statement\-level trigger that is specified by the `FOR EACH STATEMENT` clause.

A row\-level trigger is fired for each row while a statement\-level trigger is fired for each transaction.

Suppose a table has 100 rows and two triggers that will be fired when a `DELETE` event occurs.

If the `DELETE` statement deletes 100 rows, the row\-level trigger will fire 100 times, once for each deleted row. On the other hand, a statement\-level trigger will be fired for one time regardless of how many rows are deleted.

Finally, give the name of the trigger function after the `EXECUTE PROCEDURE` keywords.

## PostgreSQL CREATE TRIGGER example

The following statement creates a new table called `employees`:

```sql
CREATE TABLE employees(
   id INT GENERATED ALWAYS AS IDENTITY,
   first_name VARCHAR(40) NOT NULL,
   last_name VARCHAR(40) NOT NULL,
   PRIMARY KEY(id)
);
```

Note that if your database already has the `employees` table, you can drop it first before creating a new one:

```sql
DROP TABLE IF EXISTS employees;
```

Suppose that when the name of an employee changes, you want to log it in a separate table called `employee_audits` :

```
CREATE TABLE employee_audits (
   id INT GENERATED ALWAYS AS IDENTITY,
   employee_id INT NOT NULL,
   last_name VARCHAR(40) NOT NULL,
   changed_on TIMESTAMP NOT NULL
);
```

First, create a new function called `log_last_name_changes`:

```sql
CREATE OR REPLACE FUNCTION log_last_name_changes()
  RETURNS TRIGGER
  LANGUAGE PLPGSQL
  AS
$$
BEGIN
	IF NEW.last_name <> OLD.last_name THEN
		 INSERT INTO employee_audits(employee_id,last_name,changed_on)
		 VALUES(OLD.id,OLD.last_name,now());
	END IF;

	RETURN NEW;
END;
$$
```

The function inserts the old last name into the `employee_audits` table including employee id, last name, and the time of change if the last name of an employee changes.

The `OLD` represents the row before the update while the `NEW` represents the new row that will be updated. The `OLD.last_name` returns the last name before the update and the `NEW.last_name` returns the new last name.

Second, bind the trigger function to the `employees` table. The trigger name is `last_name_changes`. Before the value of the `last_name` column is updated, the trigger function is automatically invoked to log the changes.

```sql
CREATE TRIGGER last_name_changes
  BEFORE UPDATE
  ON employees
  FOR EACH ROW
  EXECUTE PROCEDURE log_last_name_changes();
```

Third, [insert](../postgresql-tutorial/postgresql-insert) some rows into the `employees` table:

```sql
INSERT INTO employees (first_name, last_name)
VALUES ('John', 'Doe');

INSERT INTO employees (first_name, last_name)
VALUES ('Lily', 'Bush');
```

Fourth, examine the contents of the `employees` table:

```sql
SELECT * FROM employees;
```

![](/postgresqltutorial/PostgreSQL-Cretae-Trigger-Sample-Table.png)
Suppose that `Lily Bush` changes her last name to `Lily Brown`.

Fifth, update Lily’s last name to the new one:

```sql
UPDATE employees
SET last_name = 'Brown'
WHERE ID = 2;
```

Sixth, check if the last name of `Lily` has been updated:

```sql
SELECT * FROM employees;
```

![](/postgresqltutorial/PostgreSQL-Cretae-Trigger-after-update.png)
The output indicates that Lily’s last name has been updated.

Finally, verify the contents of the `employee_audits` table:

```sql
SELECT * FROM employee_audits;
```

![](/postgresqltutorial/PostgreSQL-Cretae-Trigger-example.png)
The change was logged in the `employee_audits` table by the trigger.

## Summary

- Use the PostgreSQL `CREATE TRIGGER` to create a new trigger.


# DROP TRIGGER

---
title: 'PostgreSQL DROP TRIGGER Statement'
page_title: 'PostgreSQL DROP TRIGGER Statement'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL DROP TRIGGER statement to drop a trigger from a table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-triggers/postgresql-drop-trigger/'
ogImage: '/postgresqltutorial/PostgreSQL-DROP-Trigger-Example.png'
updatedOn: '2024-03-30T03:14:07+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CREATE TRIGGER Statement'
  slug: 'postgresql-triggers/creating-first-trigger-postgresql'
nextLink:
  title: 'PostgreSQL ALTER TRIGGER Statement'
  slug: 'postgresql-triggers/postgresql-alter-trigger'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `DROP TRIGGER` statement to drop a trigger from a table.

## Introduction to PostgreSQL DROP TRIGGER statement

To delete a trigger from a table, you use the `DROP TRIGGER` statement with the following syntax:

```sql
DROP TRIGGER [IF EXISTS] trigger_name
ON table_name
[ CASCADE | RESTRICT ];
```

In this syntax:

- First, specify the name of the trigger you want to delete after the `DROP TRIGGER` keywords.
- Next, use `IF EXISTS` to conditionally delete the trigger only if it exists. Deleting a non\-existing trigger without specifying the `IF EXISTS` statement results in an error. If you use `IF EXISTS` to delete a non\-existing trigger, PostgreSQL issues a notice instead. The `IF EXISTS` is optional.
- Then, specify the name of the table to which the trigger belongs. If the table belongs to a specific schema, you can use the schema\-qualified name of the table such as `schema_name.table_name`.
- After that, use the `CASCADE` option to drop objects that depend on the trigger automatically. Note that `CASCADE` option will also delete objects that depend on objects that depend on the trigger.
- Finally, use the `RESTRICT` option to refuse to drop the trigger if any objects depend on it. By default, the `DROP TRIGGER` statement uses `RESTRICT`.

In SQL standard, trigger names are not local to tables so the `DROP TRIGGER` statement does not have the table to which the trigger belongs:

```sql
DROP TRIGGER trigger_name;
```

## PostgreSQL DROP TRIGGER statement example

First, [create a function](../postgresql-plpgsql/postgresql-create-function) that validates the username of a staff. The username is not null and its length must be at least 8\.

```sql
CREATE FUNCTION check_staff_user()
    RETURNS TRIGGER
AS $$
BEGIN
    IF length(NEW.username) < 8 OR NEW.username IS NULL THEN
        RAISE EXCEPTION 'The username cannot be less than 8 characters';
    END IF;
    IF NEW.NAME IS NULL THEN
        RAISE EXCEPTION 'Username cannot be NULL';
    END IF;
    RETURN NEW;
END;
$$
LANGUAGE plpgsql;
```

Second, [create a new trigger](creating-first-trigger-postgresql) on the `staff` table of the [sample database](../postgresql-getting-started/postgresql-sample-database) to check the username of a staff. This trigger will fire whenever you insert or update a row in the `staff` table:

```sql
CREATE TRIGGER username_check
    BEFORE INSERT OR UPDATE
ON staff
FOR EACH ROW
    EXECUTE PROCEDURE check_staff_user();

```

![PostgreSQL DROP Trigger Example](/postgresqltutorial/PostgreSQL-DROP-Trigger-Example.png)Third, use the `DROP TRIGGER` statement to delete the `username_check` trigger:

```sql
DROP TRIGGER username_check
ON staff;
```

## Summary

- Use the PostgreSQL `DROP TRIGGER` statement to delete a trigger from a table.


# ALTER TRIGGER

---
title: 'PostgreSQL ALTER TRIGGER Statement'
page_title: 'PostgreSQL ALTER TRIGGER Statement'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL ALTER TRIGGER statement to rename a trigger.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-triggers/postgresql-alter-trigger/'
ogImage: '/postgresqltutorial/PostgreSQL-ALTER-TRIGGER-example.png'
updatedOn: '2024-03-30T03:14:14+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL DROP TRIGGER Statement'
  slug: 'postgresql-triggers/postgresql-drop-trigger'
nextLink:
  title: 'PostgreSQL BEFORE INSERT Trigger'
  slug: 'postgresql-triggers/postgresql-before-insert-trigger'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `ALTER TRIGGER` statement to rename a trigger.

## Introduction to PostgreSQL ALTER TRIGGER statement

The `ALTER TRIGGER` statement allows you to rename a trigger. The following shows the syntax of the `ALTER TRIGGER` statement:

```sql
ALTER TRIGGER trigger_name
ON table_name
RENAME TO new_trigger_name;
```

In this syntax:

- First, specify the name of the trigger you want to rename after the `ALTER TRIGGER` keywords.
- Second, provide the name of the table associated with the trigger after the `ON` keyword.
- Third, specify the new name of the trigger after the `RENAME TO` keyword.

To execute the `ALTER TRIGGER` statement, you must be the owner of the table to which the trigger belongs.

## PostgreSQL ALTER TRIGGER example

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `employees`:

```sql
DROP TABLE IF EXISTS employees;

CREATE TABLE employees(
   employee_id INT GENERATED ALWAYS AS IDENTITY,
   first_name VARCHAR(50) NOT NULL,
   last_name VARCHAR(50) NOT NULL,
   salary decimal(11,2) NOT NULL DEFAULT 0,
   PRIMARY KEY(employee_id)
);
```

Second, [create a function](../postgresql-plpgsql/postgresql-create-function) that raises an exception if the new salary is greater than the old one 100%:

```sql
CREATE OR REPLACE FUNCTION check_salary()
  RETURNS TRIGGER
  LANGUAGE PLPGSQL
  AS
$$
BEGIN
	IF (NEW.salary - OLD.salary) / OLD.salary >= 1 THEN
		RAISE 'The salary increment cannot that high.';
	END IF;

	RETURN NEW;
END;
$$
```

Third, create a before\-update trigger that executes the `check_salary()` function before updating the salary:

```sql
CREATE TRIGGER before_update_salary
  BEFORE UPDATE
  ON employees
  FOR EACH ROW
  EXECUTE PROCEDURE check_salary();
```

Fourth, [insert a new row](../postgresql-tutorial/postgresql-insert) into the `employees` table:

```sql
INSERT INTO employees(first_name, last_name, salary)
VALUES('John','Doe',100000);
```

Fifth, update the salary of the employee id 1:

```sql
UPDATE employees
SET salary = 200000
WHERE employee_id = 1;
```

The trigger was fired and issued the following error:

```shell
ERROR:  The salary increment cannot that high.
CONTEXT:  PL/pgSQL function check_salary() line 4 at RAISE
SQL state: P0001
```

It works as expected.

Finally, use the `ALTER TRIGGER` statement to rename the `before_update_salary` trigger to `salary_before_update`:

```sql
ALTER TRIGGER before_update_salary
ON employees
RENAME TO salary_before_update;
```

If you use psql tool, you can view all triggers associated with a table using the `\dS` command:

```shell
 \dS employees
```

Notice that the letter `S` is uppercase.

![](/postgresqltutorial/PostgreSQL-ALTER-TRIGGER-example.png)

## Replacing triggers

PostgreSQL doesn’t support the `OR REPLACE` statement that allows you to modify the trigger definition like the function that will be executed when the trigger is fired.

To do so, you can use the `DROP TRIGGER` and `CREATE TRIGGER` statements. You can also wrap these statements within a [transaction](../postgresql-tutorial/postgresql-transaction).

The following example illustrates how to change the `check_salary` function of the `salary_before_update` trigger to `validate_salary`:

```sql
BEGIN;

DROP TRIGGER IF EXISTS salary_before_update
ON employees;

CREATE TRIGGER salary_before_udpate
  BEFORE UPDATE
  ON employees
  FOR EACH ROW
  EXECUTE PROCEDURE validate_salary();

COMMIT;
```

## Summary

- Use the `ALTER TRIGGER` statement to rename a trigger.
- Use the pair of the `DROP TRIGGER` and `CREATE TRIGGER` statements to replace a trigger with a new one.


# Insert Triggers

# AFTER INSERT Trigger

---
title: 'PostgreSQL AFTER INSERT Trigger'
page_title: 'PostgreSQL AFTER INSERT Trigger'
page_description: 'You will learn how to create a PostgreSQL AFTER INSERT trigger to call a function automatically after a row is inserted into a table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-triggers/postgresql-after-insert-trigger/'
ogImage: ''
updatedOn: '2024-03-28T03:30:39+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL BEFORE INSERT Trigger'
  slug: 'postgresql-triggers/postgresql-before-insert-trigger'
nextLink:
  title: 'PostgreSQL BEFORE UPDATE Trigger'
  slug: 'postgresql-triggers/postgresql-before-update-trigger'
---

**Summary**: in this tutorial, you will learn how to create a PostgreSQL `AFTER INSERT` trigger to call a function automatically after a row is inserted into a table.

## Introduction to the PostgreSQL AFTER INSERT trigger

In PostgreSQL, a trigger is a database object associated with a table, which is automatically fired in response to an [`INSERT`](../postgresql-tutorial/postgresql-insert), [`UPDATE`](../postgresql-tutorial/postgresql-update), [`DELETE`](../postgresql-tutorial/postgresql-delete), or [`TRUNCATE`](../postgresql-tutorial/postgresql-truncate-table) event.

An `AFTER INSERT` trigger is a trigger that is fired after an `INSERT` event occurs on a table.

The `AFTER INSERT` trigger can access the newly inserted data using the `NEW` record variable. This `NEW` variable allows you to access the values of columns in the inserted row:

```sql
NEW.column_name
```

Typically, you use `AFTER INSERT` triggers for logging changes, updating related tables, or sending notifications based on the inserted data.

To create an `AFTER` `INSERT` trigger, you follow these steps:

First, [define a function](../postgresql-plpgsql/postgresql-create-function) that will execute when the trigger is activated:

```sql
CREATE OR REPLACE FUNCTION trigger_function()
   RETURNS TRIGGER
   LANGUAGE PLPGSQL
AS
$$
BEGIN
   -- trigger logic
   -- ...
   RETURN NEW;
END;
$$
```

The `RETURN NEW` statement indicates that the function returns the modified row, which is the `NEW` row.

Second, create an `AFTER` `INSERT` trigger and bind the function to it:

```sql
CREATE TRIGGER trigger_name
AFTER INSERT
ON table_name
FOR EACH {ROW | STATEMENT}
EXECUTE FUNCTION trigger_function();
```

## PostgreSQL AFTER INSERT trigger example

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `members` to store the member data:

```sql
CREATE TABLE members (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE
);
```

The `members` table has three columns `id`, `name`, and `email`. The `id` column is a [serial](../postgresql-tutorial/postgresql-serial) and [primary key](../postgresql-tutorial/postgresql-primary-key) column. The `email` column has a unique constraint to ensure the uniqueness of emails.

Second, create another table called `memberships` to store the memberships of the members:

```sql
CREATE TABLE memberships (
    id SERIAL PRIMARY KEY,
    member_id INT NOT NULL REFERENCES members(id),
    membership_type VARCHAR(50) NOT NULL DEFAULT 'free'
);
```

The memberships table has three columns id, member_id, and membership_type:

- The `id` is a serial and primary key column.
- The `member_id` references the id column of the `members` table. It is a foreign key column.
- The `membership_type` column has a default value of “free”.

Third, define a trigger function that inserts a default free membership for every member:

```sql
CREATE OR REPLACE FUNCTION create_membership_after_insert()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO memberships (member_id)
    VALUES (NEW.id);
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

Fourth, define an `AFTER` `INSERT` trigger on the `members` table, specifying that it should execute the `create_membership_after_insert()` function for each row inserted:

```sql
CREATE TRIGGER after_insert_member_trigger
AFTER INSERT ON members
FOR EACH ROW
EXECUTE FUNCTION create_membership_after_insert();
```

Fifth, [insert a new row](../postgresql-tutorial/postgresql-insert) into the `members` table:

```sql
INSERT INTO members(name, email)
VALUES('John Doe', '[[email protected]](../cdn-cgi/l/email-protection.html)')
RETURNING *;
```

Output:

```text
 id |   name   |       email
----+----------+--------------------
  1 | John Doe | [[email protected]](../cdn-cgi/l/email-protection.html)
(1 row)
```

Sixth, retrieve data from the `memberships` table:

```sql
SELECT * FROM memberships;
```

Output:

```text
 id | member_id | membership_type
----+-----------+-----------------
  1 |         1 | free
(1 row)
```

## Summary

- Use an `AFTER` `INSERT` trigger to call a function automatically after an `INSERT` operation successfully on the associated table.


# BEFORE INSERT Trigger

---
title: 'PostgreSQL BEFORE INSERT Trigger'
page_title: 'PostgreSQL BEFORE INSERT Trigger'
page_description: 'In this tutorial, you will learn how to create a PostgreSQL BEFORE INSERT trigger associated with a table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-triggers/postgresql-before-insert-trigger/'
ogImage: ''
updatedOn: '2024-03-28T10:24:52+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL ALTER TRIGGER Statement'
  slug: 'postgresql-triggers/postgresql-alter-trigger'
nextLink:
  title: 'PostgreSQL AFTER INSERT Trigger'
  slug: 'postgresql-triggers/postgresql-after-insert-trigger'
---

**Summary**: in this tutorial, you will learn how to create a PostgreSQL `BEFORE INSERT` trigger associated with a table.

## Introduction to PostgreSQL BEFORE INSERT trigger

A trigger is a database object that automatically calls a function when an event such as `INSERT`, `UPDATE`, and `DELETE` statement occurs on the associated table.

A `BEFORE INSERT` trigger is activated before an `INSERT` event occurs on a table. To create a `BEFORE INSERT` trigger, you follow these steps:

First, define a trigger function that will execute before the `INSERT` event occurs:

```sqlsql
CREATE OR REPLACE FUNCTION trigger_function()
   RETURNS TRIGGER
   LANGUAGE PLPGSQL
AS
$$
BEGIN
   -- trigger logic
   -- ...
   RETURN NEW;
END;
$$
```

At the end of the function, you need to place the `RETURN NEW` statement

Second, create a `BEFORE INSERT` trigger and associate a trigger function with it:

```sql
CREATE TRIGGER trigger_name
BEFORE INSERT
ON table_name
FOR EACH {ROW | STATEMENT}
EXECUTE FUNCTION trigger_function();
```

## PostgreSQL BEFORE INSERT trigger example

First, create a table called `inventory` to store inventory data:

```sql
CREATE TABLE inventory(
    product_id INT PRIMARY KEY,
    quantity INT NOT NULL DEFAULT 0
);
```

Second, create a table called `inventory_stat` that stores the total quantity of all products:

```sql
CREATE TABLE inventory_stat(
    total_qty INT
);
```

Third, define a function that increases the total quantity in the `inventory_stat` before a row is inserted into the `inventory` table:

```sql
CREATE OR REPLACE FUNCTION update_total_qty()
RETURNS TRIGGER
LANGUAGE PLPGSQL
AS
$$
DECLARE
   p_row_count INT;
BEGIN
   SELECT COUNT(*) FROM inventory_stat
   INTO p_row_count;

   IF p_row_count > 0 THEN
      UPDATE inventory_stat
      SET total_qty = total_qty + NEW.quantity;
   ELSE
      INSERT INTO inventory_stat(total_qty)
      VALUES(new.quantity);
   END IF;
   RETURN NEW;
END;
$$;
```

If the inventory_stat table has no rows, the function inserts a new row with the quantity being inserted into the inventory table. Otherwise, it updates the existing quantity.

Fourth, define a `BEFORE INSERT` trigger associated with the `inventory` table:

```
CREATE TRIGGER inventory_before_insert
BEFORE INSERT
ON inventory
FOR EACH ROW
EXECUTE FUNCTION update_total_qty();
```

Fifth, insert a row into the inventory table:

```sql
INSERT INTO inventory(product_id, quantity)
VALUES(1, 100)
RETURNING *;
```

Output:

```text
 product_id | quantity
------------+----------
          1 |      100
(1 row)
```

Sixth, retrieve data from the `inventory_stat` table:

```
SELECT * FROM inventory_stat;
```

Output:

```text
 total_qty
-----------
       100
(1 row)
```

Seventh, insert another row into the `inventory` table:

```sql
INSERT INTO inventory(product_id, quantity)
VALUES(2, 200)
RETURNING *;
```

Output:

```text
 product_id | quantity
------------+----------
          2 |      200
(1 row)
```

Eighth, retrieve the data from the `inventory_stat` table:

```text
 total_qty
-----------
       300
(1 row)
```

## Summary

- A `BEFORE INSERT` trigger is activated before an `INSERT` event occurs on a table.


# Update Triggers

# BEFORE UPDATE Trigger

---
title: 'PostgreSQL BEFORE UPDATE Trigger'
page_title: 'PostgreSQL BEFORE UPDATE Trigger'
page_description: 'In this tutorial, you will learn how to define a PostgreSQL BEFORE UPDATE trigger that executes a function before an update operation occurs.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-triggers/postgresql-before-update-trigger/'
ogImage: ''
updatedOn: '2024-03-28T10:18:43+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL AFTER INSERT Trigger'
  slug: 'postgresql-triggers/postgresql-after-insert-trigger'
nextLink:
  title: 'PostgreSQL AFTER UPDATE Trigger'
  slug: 'postgresql-triggers/postgresql-after-update-trigger'
---

**Summary**: in this tutorial, you will learn how to define a PostgreSQL `BEFORE UPDATE` trigger that executes a function before an update event occurs.

## Introduction to the PostgreSQL BEFORE UPDATE trigger

In PostgreSQL, a trigger is a database object that is automatically activated when an event such as [`INSERT`](../postgresql-tutorial/postgresql-insert), [`UPDATE`](../postgresql-tutorial/postgresql-update), [`DELETE`](../postgresql-tutorial/postgresql-delete), or [`TRUNCATE`](../postgresql-tutorial/postgresql-truncate-table) occurs on the associated table.

A `BEFORE UPDATE` trigger is a type of trigger that activates before an `UPDATE` operation is applied to a table.

These `BEFORE UPDATE` triggers can be particularly useful when you want to modify data before an update occurs or enforce certain conditions.

In a `BEFORE UPDATE` trigger, you can access the following variables:

- `OLD`: This record variable allows you to access the row before the update.
- `NEW`: This record variable represents the row after the update.

Also, you can access the following variables:

- `TG_NAME`: Represent the name of the trigger.
- `TG_OP`: Represent the operation that activates the trigger, which is `UPDATE` for the `BEFORE UPDATE` triggers.
- `TG_WHEN`: Represent the trigger timing, which is `BEFORE` for the `BEFORE UPDATE` triggers.

To create a `BEFORE UPDATE` trigger, you follow these steps:

First, [define a trigger function](../postgresql-plpgsql/postgresql-create-function) that will execute when the `BEFORE UPDATE` trigger fires:

```sql
CREATE OR REPLACE FUNCTION trigger_function()
   RETURNS TRIGGER
   LANGUAGE PLPGSQL
AS
$$
BEGIN
   -- trigger logic
   -- ...
   RETURN NEW;
END;
$$
```

Second, create a `BEFORE UPDATE` trigger that executes the defined function:

```sql
CREATE TRIGGER trigger_name
BEFORE UPDATE
ON table_name
FOR EACH {ROW | STATEMENT}
EXECUTE FUNCTION trigger_function();
```

## PostgreSQL BEFORE UPDATE trigger example

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `employees` to store the employee data:

```sql
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    salary NUMERIC NOT NULL
);
```

Next, define a trigger function that [raises an exception](../postgresql-plpgsql/postgresql-exception) if the new salary is lower than the current salary. The trigger will prevent the update when the exception occurs.

```sql
CREATE OR REPLACE FUNCTION fn_before_update_salary()
RETURNS TRIGGER AS $$
BEGIN
    IF NEW.salary < OLD.salary THEN
        RAISE EXCEPTION 'New salary cannot be less than current salary';
    END IF;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

Then, create a `BEFORE UPDATE` trigger that executes the `fn_before_update_salary()` before the update:

```sql
CREATE TRIGGER before_update_salary_trigger
BEFORE UPDATE OF salary ON employees
FOR EACH ROW
EXECUTE FUNCTION fn_before_update_salary();
```

This `BEFORE UPDATE` trigger ensures that the salary of the employee cannot be decreased. If you attempt to reduce the salary, the trigger will raise an exception and abort the update.

After that, [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `employees` table:

```sql
INSERT INTO employees(name, salary)
VALUES
   ('John Doe', 70000),
   ('Jane Doe', 80000)
RETURNING *;
```

Output:

```text
 id |   name   | salary
----+----------+--------
  1 | John Doe |  70000
  2 | Jane Doe |  80000
(2 rows)
```

Finally, attempt to decrease the salary of `John Doe`:

```sql
UPDATE employees
SET salary = salary * 0.9
WHERE id = 1;
```

The `BEFORE UPDATE` trigger raises the following exception:

```sql
ERROR:  New salary cannot be less than current salary
CONTEXT:  PL/pgSQL function fn_before_update_salary() line 4 at RAISE
```

## Summary

- Use a `BEFORE UPDATE` trigger to automatically execute a function before an update.


# AFTER UPDATE Trigger

---
title: 'PostgreSQL AFTER UPDATE Trigger'
page_title: 'PostgreSQL AFTER UPDATE Trigger'
page_description: 'In this tutorial, you will learn how to define a PostgreSQL AFTER UPDATE trigger that executes a function after an update event occurs.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-triggers/postgresql-after-update-trigger/'
ogImage: ''
updatedOn: '2024-03-28T12:24:56+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL BEFORE UPDATE Trigger'
  slug: 'postgresql-triggers/postgresql-before-update-trigger'
nextLink:
  title: 'PostgreSQL BEFORE DELETE Trigger'
  slug: 'postgresql-triggers/postgresql-before-delete-trigger'
---

**Summary**: in this tutorial, you will learn how to define a PostgreSQL `AFTER UPDATE` trigger that executes a function after an update event occurs.

## Introduction to the PostgreSQL AFTER UPDATE trigger

In PostgreSQL, a trigger is a database object that is fired automatically when an event such as [`INSERT`](../postgresql-tutorial/postgresql-insert), [`UPDATE`](../postgresql-tutorial/postgresql-update), [`DELETE`](../postgresql-tutorial/postgresql-delete), or [`TRUNCATE`](../postgresql-tutorial/postgresql-truncate-table) occurs.

An `AFTER UPDATE` trigger is a type of trigger that fires after an `UPDATE` operation is completed successfully on a table.

Because the `AFTER UPDATE` triggers can access the row after the update, you can perform tasks such as logging changes, updating data in related tables, or sending notifications based on the modified data.

In an `AFTER UPDATE` trigger, you can access the following variables:

- `OLD`: This record variable allows you to access the row before the update.
- `NEW`: This record variable represents the row after the update.

Additionally, you can access the following variables:

- `TG_NAME`: Store the name of the trigger.
- `TG_OP`: Represent the operation that activates the trigger, which is `UPDATE` for the `AFTER` `UPDATE` trigger.
- `TG_WHEN`: Represent the trigger timing, which is `AFTER` for the `AFTER UPDATE` trigger.

To create a `AFTER UPDATE` trigger, you use the following steps:

First, [define a trigger function](../postgresql-plpgsql/postgresql-create-function) that will execute when the `AFTER UPDATE` trigger fires:

```sql
CREATE OR REPLACE FUNCTION trigger_function()
   RETURNS TRIGGER
   LANGUAGE PLPGSQL
AS
$$
BEGIN
   -- trigger logic
   -- ...
   RETURN NEW;
END;
$$
```

Second, create a `AFTER UPDATE` trigger that executes the trigger function:

```sql
CREATE TRIGGER trigger_name
AFTER UPDATE
ON table_name
FOR EACH {ROW | STATEMENT}
EXECUTE FUNCTION trigger_function();
```

## PostgreSQL AFTER UPDATE trigger example

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `salaries` to store the employee’s salaries:

```sql
CREATE TABLE salaries(
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    salary NUMERIC NOT NULL
);
```

Second, create a table called `salary_changes` that stores the updates to the `salary` column of the `salaries` table:

```sql
CREATE TABLE salary_changes (
    id SERIAL PRIMARY KEY,
    employee_id INT NOT NULL,
    old_salary NUMERIC NOT NULL,
    new_salary NUMERIC NOT NULL,
    changed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

```

Third, define the function `log_salary_changes()` that logs the changes of values in the `salary` column to the `salary_changes` table:

```sql
CREATE OR REPLACE FUNCTION log_salary_change()
RETURNS TRIGGER
AS
$$
BEGIN
    INSERT INTO salary_changes (employee_id, old_salary, new_salary)
    VALUES (NEW.id, OLD.salary, NEW.salary);

    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

Fourth, define an `AFTER UPDATE` trigger that calls the `log_salary_change()` function after an update occurs to the `salary` column of the `salaries` table:

```
CREATE TRIGGER after_update_salary_trigger
AFTER UPDATE OF salary ON salaries
FOR EACH ROW
EXECUTE FUNCTION log_salary_change();
```

Fifth, [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `salaries` table:

```sql
INSERT INTO salaries(name, salary)
VALUES
   ('John Doe', 90000),
   ('Jane Doe', 95000)
RETURNING *;
```

Output:

```text
 id |   name   | salary
----+----------+--------
  1 | John Doe |  90000
  2 | Jane Doe |  95000
(2 rows)
```

Sixth, increase the salary of `John Doe` by 5%:

```sql
UPDATE salaries
SET salary = salary * 1.05
WHERE id = 1;
```

Seventh, retrieve the data from `salary_changes` table:

```
SELECT * FROM salary_changes;
```

Output:

```
 id | employee_id | old_salary | new_salary |         changed_at
----+-------------+------------+------------+----------------------------
  1 |           1 |      90000 |   94500.00 | 2024-03-28 13:42:37.400673
(1 row)
```

The output shows that the salary before and after changes have been logged to the `salary_changes` table.

## Summary

- Use a `BEFORE` `UPDATE` trigger to execute a function before an update operation occurs.


# Delete Triggers

# BEFORE DELETE Trigger

---
title: 'PostgreSQL BEFORE DELETE Trigger'
page_title: 'PostgreSQL BEFORE DELETE Trigger'
page_description: 'In this tutorial, you will learn how to define a PostgreSQL BEFORE DELETE trigger that is fired before a row is deleted from a table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-triggers/postgresql-before-delete-trigger/'
ogImage: ''
updatedOn: '2024-03-28T09:57:59+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL AFTER UPDATE Trigger'
  slug: 'postgresql-triggers/postgresql-after-update-trigger'
nextLink:
  title: 'PostgreSQL AFTER DELETE Trigger'
  slug: 'postgresql-triggers/postgresql-after-delete-trigger'
---

**Summary**: in this tutorial, you will learn how to define a PostgreSQL `BEFORE DELETE` trigger that is fired before a row is deleted from a table.

## Introduction to the PostgreSQL BEFORE DELETE trigger

In PostgreSQL, a trigger is a database object that is automatically activated in response to an event including [`INSERT`](../postgresql-tutorial/postgresql-insert), [`UPDATE`](../postgresql-tutorial/postgresql-update), [`DELETE`](../postgresql-tutorial/postgresql-delete), or [`TRUNCATE`](../postgresql-tutorial/postgresql-truncate-table) occurring on a table.

A `BEFORE DELETE` trigger is activated before one or more rows are deleted from a table.

In practice, you’ll use `BEFORE DELETE` triggers for tasks such as logging deleted data, updating data in related tables, or enforcing complex business rules.

In a `BEFORE DELETE` trigger, you can access the `OLD` variable, which holds the value of the row being deleted. To access a column value of the deleted row, you can use the syntax `OLD.column_name`.

Please note that you cannot modify the column values (`OLD.column_name`) because they are read\-only.

To create a `BEFORE DELETE` trigger, follow these steps:

First, [define a trigger function](../postgresql-plpgsql/postgresql-create-function) that will execute before a `DELETE` operation:

```sql
CREATE OR REPLACE FUNCTION trigger_function_name()
RETURNS TRIGGER AS
$$
BEGIN
    -- This logic will be executed before the DELETE operation

    -- To access the values of rows being deleted:
    -- OLD.column_name

    RETURN OLD;
END;
$$
LANGUAGE plpgsql;
```

Second, create a trigger and associate the trigger function with it:

```sql
CREATE TRIGGER trigger_name
BEFORE DELETE ON table_name
FOR EACH ROW
EXECUTE FUNCTION trigger_function_name();
```

## PostgreSQL BEFORE DELETE trigger example

We’ll use a `BEFORE DELETE` trigger to prevent applications from deleting a row in a table.

First, [create a table](../postgresql-tutorial/postgresql-create-table) called `products` that stores the product data:

```sql
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    price NUMERIC(10, 2) NOT NULL,
    status BOOLEAN NOT NULL DEFAULT true
);
```

Next, [insert some rows](../postgresql-tutorial/postgresql-insert) into the `products` table:

```sql
INSERT INTO products (name, price, status)
VALUES
  ('A', 10.99, true),
  ('B', 20.49, false),
  ('C', 15.79, true)
RETURNING *;
```

Output:

```text
 id | name | price | status
----+------+-------+--------
  1 | A    | 10.99 | t
  2 | B    | 20.49 | f
  3 | C    | 15.79 | t
(3 rows)
```

Then, create a `BEFORE DELETE` trigger function that [raises an exception](../postgresql-plpgsql/postgresql-exception):

```sql
CREATE OR REPLACE FUNCTION fn_before_delete_product()
RETURNS TRIGGER
AS
$$
BEGIN
    RAISE EXCEPTION 'Deletion from the products table is not allowed.';
END;
$$
LANGUAGE plpgsql;
```

After that, create a `BEFORE DELETE` trigger on the `products` table:

```sql
CREATE TRIGGER before_delete_product_trigger
BEFORE DELETE ON products
FOR EACH ROW
EXECUTE FUNCTION fn_before_delete_product();
```

Finally, delete a row from the `products` table:

```sql
DELETE FROM products
WHERE id = 1;
```

Error:

```sql
ERROR:  Deletion from the products table is not allowed.
CONTEXT:  PL/pgSQL function fn_before_delete_product() line 3 at RAISE
```

## Summary

- Use a `BEFORE DELETE` trigger to automatically call a function before a row is deleted from a table.


# AFTER DELETE Trigger

---
title: 'PostgreSQL AFTER DELETE Trigger'
page_title: 'PostgreSQL AFTER DELETE Trigger'
page_description: 'In this tutorial, you will learn how to define a PostgreSQL AFTER DELETE trigger that is fired after a row is deleted from a table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-triggers/postgresql-after-delete-trigger/'
ogImage: ''
updatedOn: '2024-03-28T09:39:21+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL BEFORE DELETE Trigger'
  slug: 'postgresql-triggers/postgresql-before-delete-trigger'
nextLink:
  title: 'PostgreSQL INSTEAD OF Triggers'
  slug: 'postgresql-triggers/postgresql-instead-of-triggers'
---

**Summary**: in this tutorial, you will learn how to define a PostgreSQL `AFTER DELETE` trigger that is fired after a row is deleted from a table.

## Introduction to the PostgreSQL AFTER DELETE trigger

In PostgreSQL, a trigger is a database object that is automatically activated in response to an event including [`INSERT`](../postgresql-tutorial/postgresql-insert), [`UPDATE`](../postgresql-tutorial/postgresql-update), [`DELETE`](../postgresql-tutorial/postgresql-delete), or [`TRUNCATE`](../postgresql-tutorial/postgresql-truncate-table) occurring on a table.

An `AFTER DELETE` trigger is activated after one or more rows are deleted from a table.

An `AFTER DELETE` trigger can be particularly useful in some scenarios such as logging deleted data, updating data in related tables, or enforcing complex business rules.

In an `AFTER DELETE` trigger, the `OLD` variable, which holds the value of the row being deleted, is available. To access a column value of the deleted row, you can use the syntax `OLD.column_name`.

Notice that you cannot change the column values (`OLD.column_name`) because they are read\-only.

To create an `AFTER DELETE` trigger, you follow these steps:

First, [define a trigger function](../postgresql-plpgsql/postgresql-create-function) that will execute after a `DELETE` operation:

```sqlsql
CREATE OR REPLACE FUNCTION trigger_function_name()
RETURNS TRIGGER AS
$$
BEGIN
    -- This logic will be executed after the DELETE operation

    -- To access the values of a column of the deleted row:
    -- OLD.column_name

    RETURN OLD;
END;
$$
LANGUAGE plpgsql;
```

Second, create a trigger and associate the trigger function with it:

```sql
CREATE TRIGGER trigger_name
AFTER DELETE ON table_name
FOR EACH ROW
EXECUTE FUNCTION trigger_function_name();
```

## PostgreSQL AFTER DELETE trigger example

We’ll use an `AFTER DELETE` trigger to archive a deleted row in a separate table.

First, [create a table](../postgresql-tutorial/postgresql-create-table) called `employees` to store the employee data:

```sql
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    salary NUMERIC(10, 2) NOT NULL
);
```

Second, [insert two rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `employees` table:

```sql
INSERT INTO employees(name, salary)
VALUES
   ('John Doe', 90000),
   ('Jane Doe', 80000)
RETURNING *;
```

Output:

```
 id |   name   |  salary
----+----------+----------
  1 | John Doe | 90000.00
  2 | Jane Doe | 80000.00
(2 rows)
```

Third, create another table named `employee_archives` for archiving deleted employees:

```
CREATE TABLE employee_archives(
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,

    salary NUMERIC(10, 2) NOT NULL,
    deleted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

Fourth, define a function that [inserts](../postgresql-tutorial/postgresql-insert) a deleted employee into the `employee_archives` table:

```sql
CREATE OR REPLACE FUNCTION archive_deleted_employee()
RETURNS TRIGGER
AS
$$
BEGIN
    INSERT INTO employee_archives(id, name, salary)
    VALUES (OLD.id, OLD.name, OLD.salary);

    RETURN OLD;
END;
$$
LANGUAGE plpgsql;
```

Fifth, create an `AFTER DELETE` trigger that executes the `archive_deleted_employee()` function when a row is deleted from the `employees` table:

```sql
CREATE TRIGGER after_delete_employee_trigger
AFTER DELETE ON employees
FOR EACH ROW
EXECUTE FUNCTION archive_deleted_employee();
```

Sixth, [delete a row](../postgresql-tutorial/postgresql-delete) from the `employees` table:

```sql
DELETE FROM employees
WHERE id = 1
RETURNING *;
```

Output:

```
 id |   name   |  salary
----+----------+----------
  1 | John Doe | 90000.00
(1 row)
```

The `AFTER INSERT` trigger will be activated that calls the `archive_deleted_employee()` function to insert the deleted row into the `employee_archives` table.

Seventh, retrieve data from the `employee_archives` table:

```
SELECT * FROM employee_archives;
```

Output:

```
 id |   name   |  salary  |        deleted_at
----+----------+----------+---------------------------
  1 | John Doe | 90000.00 | 2024-03-28 16:30:37.89788
(1 row)
```

The output indicates that the `AFTER DELETE` trigger has successfully archived the deleted row into the `employee_archives` table.

## Summary

- Use a `BEFORE DELETE` trigger to automatically call a function before a row is deleted from a table.


# Instead Of Triggers

# INSTEAD OF Triggers

---
title: 'PostgreSQL INSTEAD OF Triggers'
page_title: 'PostgreSQL INSTEAD OF Triggers'
page_description: 'In this tutorial, you will learn about PostgreSQL INSTEAD OF a trigger to insert, update, or delete data of base tables through a view.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-triggers/postgresql-instead-of-triggers/'
ogImage: ''
updatedOn: '2024-03-28T13:58:28+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL AFTER DELETE Trigger'
  slug: 'postgresql-triggers/postgresql-after-delete-trigger'
nextLink:
  title: 'PostgreSQL BEFORE TRUNCATE Trigger'
  slug: 'postgresql-triggers/postgresql-before-truncate-trigger'
---

**Summary**: in this tutorial, you will learn about PostgreSQL `INSTEAD OF` a trigger to insert, update, or delete data of base tables through a view.

## Introduction to PostgreSQL INSTEAD OF triggers

In PostgreSQL, `INSTEAD OF` triggers are a special type of triggers that **intercept** insert, update, and delete operations on views.

It means that when you execute an [`INSERT`](../postgresql-tutorial/postgresql-insert), [`UPDATE`](../postgresql-tutorial/postgresql-update), or [`DELETE`](../postgresql-tutorial/postgresql-delete) statement on a view, PostgreSQL does not directly execute the statement. Instead, it executes the statements defined in the `INSTEAD OF` trigger.

To create an `INSTEAD OF` trigger, you follow these steps:

First, [define a function](../postgresql-plpgsql/postgresql-create-function) that will execute when a trigger is fired:

```sqlsql
CREATE OR REPLACE FUNCTION fn_trigger()
RETURNS TRIGGER AS
$$
   -- function body
$$
LANGUAGE plpgsql;
```

Inside the function, you can customize the behavior for each operation including `INSERT`, `UPDATE`, and `DELETE`.

Second, create an `INSTEAD OF` trigger and bind the function to it:

```sql
CREATE TRIGGER trigger_name
INSTEAD OF INSERT OR UPDATE OR DELETE
ON table_name
FOR EACH ROW
EXECUTE FUNCTION fn_trigger;
```

## PostgreSQL INSTEAD OF trigger example

Let’s take an example of creating an `INSTEAD OF` trigger.

### 1\) Setting up a view with an INSTEAD OF trigger

First, [create two tables](../postgresql-tutorial/postgresql-create-table) `employees` and `salaries`:

```sql
CREATE TABLE employees (
    employee_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL
);

CREATE TABLE salaries (
    employee_id INT,
    effective_date DATE NOT NULL,
    salary DECIMAL(10, 2) NOT NULL DEFAULT 0,
    PRIMARY KEY (employee_id, effective_date),
    FOREIGN KEY (employee_id) REFERENCES employees(employee_id)
);
```

Next, [insert rows](../postgresql-tutorial/postgresql-insert) into the `employees` and `salaries` tables:

```sql
INSERT INTO employees (name)
VALUES
   ('Alice'),
   ('Bob')
RETURNING *;

INSERT INTO salaries
VALUES
   (1, '2024-03-01', 60000.00),
   (2, '2024-03-01', 70000.00)
RETURNING *;
```

Then, [create a view](../postgresql-views/managing-postgresql-views) based on the `employees` and `salaries` tables:

```sql
CREATE VIEW employee_salaries
AS
SELECT e.employee_id, e.name, s.salary, s.effective_date
FROM employees e
JOIN salaries s ON e.employee_id = s.employee_id;
```

After that, create a function that will execute when the `INSTEAD` `OF` trigger associated with the view activates:

```sql
CREATE OR REPLACE FUNCTION update_employee_salaries()
RETURNS TRIGGER AS
$$
DECLARE
    p_employee_id INT;
BEGIN
    IF TG_OP = 'INSERT' THEN
	-- insert a new employee
        INSERT INTO employees(name)
        VALUES (NEW.name)
	RETURNING employee_id INTO p_employee_id;

	-- insert salary for the employee
        INSERT INTO salaries(employee_id, effective_date, salary)
	VALUES (p_employee_id, NEW.effective_date, NEW.salary);
    ELSIF TG_OP = 'UPDATE' THEN
        UPDATE salaries
	SET salary = NEW.salary
	WHERE employee_id = NEW.employee_id;

    ELSIF TG_OP = 'DELETE' THEN
        DELETE FROM salaries
	WHERE employee_id = OLD.employee_id;
    END IF;
    RETURN NULL;
END;
$$
LANGUAGE plpgsql;
```

If you execute an insert against the `employee_salaries` view, the `INSTEAD OF` trigger will insert a new row into the employees table first, then insert a new row into the salaries table.

When you update an employee’s salary by id, the `INSTEAD OF` trigger will update the data in the `salaries` table.

If you delete a row from the `employee_salaries` view, the `INSTEAD OF` trigger will delete a row from the `employees` table. The `DELETE CASCADE` will automatically delete a corresponding row from the salaries table.

Finally, create an `INSTEAD OF` trigger that will be fired for the `INSERT`, `UPDATE`, or `DELETE` on the `employee_salaries` view:

```
CREATE TRIGGER instead_of_employee_salaries
INSTEAD OF INSERT OR UPDATE OR DELETE
ON employee_salaries
FOR EACH ROW
EXECUTE FUNCTION update_employee_salaries();
```

### 1\) Inserting data into tables via the view

First, insert a new employee with a salary via the view:

```sql
INSERT INTO employee_salaries (name, salary, effective_date)
VALUES ('Charlie', 75000.00, '2024-03-01');
```

PostgreSQL does not execute this statement. Instead, it executes the statement defined in the `INSTEAD` `OF` trigger. More specifically, it executes two statements:

1\) Insert a new row into the `employees` table and get the employee id:

```sql
INSERT INTO employees(name)
VALUES (NEW.name)
RETURNING employee_id INTO p_employee_id;
```

2\) Insert a new row into the salaries table using the employee id, salary, and effective date:

```sql
INSERT INTO salaries(employee_id, effective_date, salary)
VALUES (p_employee_id, NEW.effective_date, NEW.salary);
```

Second, verify the inserts by retrieving data from the `employees` and `salaries` tables:

```sql
SELECT * FROM employees;
```

Output:

```text
 employee_id |  name
-------------+---------
           1 | Alice
           2 | Bob
           3 | Charlie
(3 rows)
```

```sql
SELECT * FROM salaries;
```

Output:

```text
 employee_id | effective_date |  salary
-------------+----------------+----------
           1 | 2024-03-01     | 60000.00
           2 | 2024-03-01     | 70000.00
           3 | 2024-03-01     | 75000.00
(3 rows)
```

### 2\) Updating data into tables via the view

First, update the salary of the employee id 3 via the `employee_salaries` view:

```sql
UPDATE employee_salaries
SET salary = 95000
WHERE employee_id = 3;
```

Second, retrieve data from the `salaries` table:

```sql
SELECT * FROM salaries;
```

Output:

```text
 employee_id | effective_date |  salary
-------------+----------------+----------
           1 | 2024-03-01     | 60000.00
           2 | 2024-03-01     | 70000.00
           3 | 2024-03-01     | 95000.00
(3 rows)
```

### 3\) Deleting data via views

First, delete the employee with id 3 via the `employee_salaries` view:

```sql
DELETE FROM employee_salaries
WHERE employee_id = 3;
```

Second, retrieve data from the `employees` table:

```sql
SELECT * FROM employees;
```

Output:

```text
 employee_id | effective_date |  salary
-------------+----------------+----------
           1 | 2024-03-01     | 60000.00
           2 | 2024-03-01     | 70000.00
(2 rows)
```

Because of the `DELETE` `CASCADE`, PostgreSQL also deletes the corresponding row in the `salaries` table:

```sql
SELECT * FROM salaries;
```

Output:

```text
 employee_id | effective_date |  salary
-------------+----------------+----------
           1 | 2024-03-01     | 60000.00
           2 | 2024-03-01     | 70000.00
(2 rows)
```

## Summary

- Use the `INSTEAD OF` trigger to customize the behavior of `INSERT`, `UPDATE`, and `DELETE` operations on a database view.


# Truncate Triggers

# BEFORE TRUNCATE Trigger

---
title: 'PostgreSQL BEFORE TRUNCATE Trigger'
page_title: 'PostgreSQL BEFORE TRUNCATE Trigger'
page_description: 'In this tutorial, you will learn how to define a PostgreSQL BEFORE TRUNCATE trigger that fires before a TRUNCATE event occurs on a table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-triggers/postgresql-before-truncate-trigger/'
ogImage: ''
updatedOn: '2024-03-29T02:17:22+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL INSTEAD OF Triggers'
  slug: 'postgresql-triggers/postgresql-instead-of-triggers'
nextLink:
  title: 'Disable Triggers'
  slug: 'postgresql-triggers/managing-postgresql-trigger'
---

**Summary**: in this tutorial, you will learn how to define a PostgreSQL `BEFORE TRUNCATE` trigger that fires before a `TRUNCATE` event occurs on a table.

## Introduction to the PostgreSQL BEFORE TRUNCATE trigger

A [`TRUNCATE TABLE`](../postgresql-tutorial/postgresql-truncate-table) statement removes all from a table without creating any logs, making it faster than a [`DELETE`](../postgresql-tutorial/postgresql-delete) operation.

PostgreSQL allows you to [create a trigger](creating-first-trigger-postgresql) that fires before a `TRUNCATE` event occurs.

A `BEFORE TRUNCATE` trigger is a statement\-level trigger because the `TRUNCATE` statement deletes all the rows from the table, not individual rows.

Although the `TRUNCATE` operation deletes rows from a table, it does not activate the `DELETE` trigger including `BEFORE` and `AFTER DELETE` triggers.

Here’s the step for creating a `BEFORE TRUNCATE` trigger:

First, [define a user\-defined function](../postgresql-plpgsql/postgresql-create-function) that will execute before the `TRUNCATE` event:

```sql
CREATE OR REPLACE FUNCTION trigger_function_name()
RETURNS TRIGGER AS
$$
BEGIN
    -- This logic will be executed before the TRUNCATE operation
    -- ...
    RETURN NULL;
END;
$$
LANGUAGE plpgsql;
```

The function returns `NULL` indicating that the trigger doesn’t return additional output.

Second, create a `BEFORE TRUNCATE` trigger and associate the function with it:

```sql
CREATE TRIGGER trigger_name
BEFORE TRUNCATE ON table_name
FOR EACH STATEMENT
EXECUTE FUNCTION trigger_function_name();
```

Since the `BEFORE TRUNCATE` trigger is a statement\-level trigger, you need to specify the `FOR EACH STATEMENT` clause in the `CREATE TRIGGER` statement.

Unlike `INSERT`, `UPDATE`, or `DELETE`, which support `BEFORE` and `AFTER` trigger types, `TRUNCATE` only supports `BEFORE` triggers.

## PostgreSQL BEFORE TRUNCATE trigger example

We’ll create a `BEFORE TRUNCATE` trigger to prevent applications from truncating a table.

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `companies` to store company data:

```sql
CREATE TABLE companies(
   id SERIAL PRIMARY KEY,
   name VARCHAR(255) NOT NULL
);
```

Second, [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `companies` table:

```sql
INSERT INTO companies(name)
VALUES ('Apple'),
       ('Microsoft'),
       ('Google')
RETURNING *;
```

Output:

```text
 id |   name
----+-----------
  1 | Apple
  2 | Microsoft
  3 | Google
(3 rows)
```

Third, define a function that will execute when a `TRUNCATE` event occurs:

```sql
CREATE OR REPLACE FUNCTION before_truncate_companies()
RETURNS TRIGGER AS
$$
BEGIN
    RAISE NOTICE 'Truncating the companies table is not allowed';
    RETURN NULL;
END;
$$
LANGUAGE plpgsql;
```

Fourth, create a trigger that fires before a `TRUNCATE` event occurs:

```sql
CREATE TRIGGER before_truncate_companies_trigger
BEFORE TRUNCATE ON companies
FOR EACH STATEMENT
EXECUTE FUNCTION before_truncate_companies();
```

Fifth, attempt to truncate the `companies` table:

```sql
TRUNCATE TABLE companies;
```

Output:

```sql
NOTICE:  Truncating the companies table is not allowed
TRUNCATE TABLE
```

The output indicates that the `BEFORE TRUNCATE` trigger fires, raising an exception that aborts the `TRUNCATE` operation.

## Summary

- A `BEFORE TRUNCATE` trigger is a statement\-level trigger.
- Create a `BEFORE TRUNCATE` trigger to fire before a `TRUNCATE` event.


# Enable & Disable Triggers

# Disable Triggers

---
title: 'Disable Triggers'
page_title: 'How to Disable PostgreSQL Triggers'
page_description: 'This tutorial shows you how to disable one or all PostgreSQL triggers associated with a table in the database.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-triggers/managing-postgresql-trigger/'
ogImage: ''
updatedOn: '2024-03-26T01:55:24+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL BEFORE TRUNCATE Trigger'
  slug: 'postgresql-triggers/postgresql-before-truncate-trigger'
nextLink:
  title: 'Enable Triggers'
  slug: 'postgresql-triggers/enable-triggers'
---

**Summary**: in this tutorial, you will learn how to disable triggers by using the `ALTER TABLE ... DISABLE TRIGGER` statement.

## Introduction to ALTER TABLE…DISABLE TRIGGER statement

To disable a trigger, you use the `ALTER TABLE...DISABLE TRIGGER` statement.

When you disable a trigger, it remains in the database but won’t activate when an event associated with the trigger occurs.

Here’s the basic syntax of the `ALTER TABLE...DISABLE TRIGGER` statement:

```sql
ALTER TABLE table_name
DISABLE TRIGGER trigger_name | ALL
```

In this syntax,

- First, specify the name of the table to which the trigger belongs after the `ALTER TABLE` keywords.
- Second, specify the name of the trigger you want to disable after the `DISABLE TRIGGER` keywords, or use the `ALL` keyword to disable all triggers associated with the table.

Suppose you want to disable the trigger associated with the `employees` table, you can use the following statement:

```sql
ALTER TABLE employees
DISABLE TRIGGER log_last_name_changes;
```

To disable all triggers associated with the `employees` table, you use the following statement:

```sql
ALTER TABLE employees
DISABLE TRIGGER ALL;
```

## Summary

- Use the `ALTER TABLE ... DISABLE TRIGGER` statement to disable a trigger or all triggers associated with a table.


# Enable Triggers

---
title: 'Enable Triggers'
page_title: 'How to Enable Triggers in PostgreSQL'
page_description: 'In this tutorial, you will learn how to enable a trigger or all triggers associated with a table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-triggers/enable-triggers/'
ogImage: ''
updatedOn: '2024-03-26T02:02:29+00:00'
enableTableOfContents: true
previousLink:
  title: 'Disable Triggers'
  slug: 'postgresql-triggers/managing-postgresql-trigger'
nextLink:
  title: 'How to List All Triggers in PostgreSQL'
  slug: 'postgresql-triggers/how-to-list-all-triggers-in-postgresql'
---

**Summary**: in this tutorial, you will learn how to enable a trigger or all triggers associated with a table.

## Introduction to ALTER TABLE…ENABLE TRIGGER statement

In PostgreSQL, a [trigger](introduction-postgresql-trigger) is a database object that automatically invokes a specified [function](../postgresql-plpgsql/postgresql-create-function) when an event occurs on a table or view. These events include `INSERT`, `UPDATE`, `DELETE`, or `TRUNCATE`.

If a [trigger is disabled](managing-postgresql-trigger), it doesn’t activate when the triggering event occurs. To activate the trigger, you’ll need to enable it.

To enable a trigger or all triggers associated with a table, you use the `ALTER TABLE ... ENABLE TRIGGER` statement:

```
ALTER TABLE table_name
ENABLE TRIGGER trigger_name |  ALL;
```

In this syntax:

- First, specify the name of the table to which the trigger belongs you want to enable in the `ALTER TABLE` clause.
- Second, specify the name of the trigger you want to enable in the `ENABLE TRIGGER` clause, or use the `ALL` option if you want to enable all triggers associated with the table.

## Enabling trigger example

The following statement enables the `salary_before_update` trigger on the `employees` table:

```
ALTER TABLE employees
ENABLE TRIGGER salary_before_update;
```

The following example enables all triggers that belong to the `employees` table:

```
ALTER TABLE employees
ENABLE TRIGGER ALL;
```

## Summary

- Use the `ALTER TABLE ENABLE TRIGGER` statement to enable a trigger or all triggers that belong to a table.


# Advanced Triggers

# Event Triggers

---
title: 'PostgreSQL Event Trigger'
page_title: 'PostgreSQL Event Trigger'
page_description: 'You will learn about PostgreSQL event triggers and how to use the CREATE EVENT TRIGGER statement to define a new event trigger.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-triggers/postgresql-event-trigger/'
ogImage: ''
updatedOn: '2024-03-29T06:08:37+00:00'
enableTableOfContents: true
previousLink:
  title: 'How to List All Triggers in PostgreSQL'
  slug: 'postgresql-triggers/how-to-list-all-triggers-in-postgresql'
nextLink:
  title: 'Creating a PostgreSQL Trigger with a When Condition'
  slug: 'postgresql-triggers/postgresql-trigger-when-condition'
---

<Admonition type="note">
Neon Postgres currently does not support event triggers. For more information, see [Event triggers](/docs/reference/compatibility#event-triggers) in our _Postgres compatibility_ guide.
</Admonition>

**Summary**: in this tutorial, you will learn about PostgreSQL event triggers and how to use the `CREATE EVENT TRIGGER` statement to define a new event trigger.

## Introduction to the PostgreSQL event trigger

A regular trigger fires whenever an `INSERT`, `UPDATE`, `DELETE`, or `TRUNCATE` event occurs on an associated table.

To automatically respond to events related to data definition language (`DDL`) statements, you can use an event trigger.

An event trigger is a trigger that fires whenever an associated event occurs in the database.

PostgreSQL supports the following events:

- `ddl_command_start`
- `ddl_command_end`
- `table_rewrite`
- `sql_drop`

The `ddl_command_start` events before PostgreSQL executes the `CREATE`, `ALTER`, `DROP`, `GRANT`, `REVOKE`, `SECURITY` `LABEL`, and `COMMENT` statements. For complete commands that the event trigger supports, read more on the [event trigger firing matrix](https://www.postgresql.org/docs/current/event-trigger-matrix.html).

Please note that the `ddl_command_start` does not occur for shared objects like databases, tablespaces, and roles.

The `ddl_command_end` occurs after the execution of the above DDL statements.

The `sql_drop` event occurs whenever you drop a database object, just before the `ddl_command_end` event.

The `table_rewrite` event occurs before you rewrite a table using the `ALTER TABLE` or `ALTER TYPE` statement.

To create an event trigger, you follow these steps:

First, [define a function](../postgresql-plpgsql/postgresql-create-function) that will execute when the event trigger fires:

```sql
CREATE OR REPLACE FUNCTION event_trigger_function_name()
RETURNS EVENT_TRIGGER
AS
$$
BEGIN
   -- trigger logic
   -- ...
   -- no RETURN statement
END;
$$;
```

The event trigger function returns `EVENT_TRIGGER` instead of `TRIGGER`. Additionally, it does not have any `RETURN` statement like a regular trigger function.

Second, create an event trigger using the `CREATE EVENT TRIGGER` statement:

```sql
CREATE EVENT TRIGGER trigger_name
ON event
EXECUTE FUNCTION event_trigger_function_name()
```

## PostgreSQL event trigger example

First, [create a table](../postgresql-tutorial/postgresql-create-table) called `audits` to store audit logs for commands:

```sql
CREATE TABLE audits (
    id SERIAL PRIMARY KEY,
    username VARCHAR(100) NOT NULL,
    event VARCHAR(50) NOT NULL,
    command TEXT NOT NULL,
    executed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

The `audits` table will record the username, event, command, and timestamp when the command is executed.

Second, define an event trigger function that executes whenever a relevant event occurs:

```sql
CREATE OR REPLACE FUNCTION audit_command()
RETURNS EVENT_TRIGGER
AS $$
BEGIN
    INSERT INTO audits (username, event , command)
    VALUES (session_user, TG_EVENT, TG_TAG );
END;
$$ LANGUAGE plpgsql;
```

The `audit_command()` function inserts audit records into the `audits` table.

Third, create an event trigger that associates the function with DDL commands:

```sql
CREATE EVENT TRIGGER audit_ddl_commands
ON ddl_command_end
EXECUTE FUNCTION audit_command();
```

Fourth, execute a `CREATE TABLE` command:

```sql
CREATE TABLE regions(
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL
);
```

Fifth, retrieve data from the `audits` table:

```sql
SELECT * FROM audits;
```

Output:

```text
 id | username |      event      |   command    |        executed_at
----+----------+-----------------+--------------+----------------------------
  1 | postgres | ddl_command_end | CREATE TABLE | 2024-03-29 12:12:38.773734
(1 row)
```

## Regular trigger vs. Event trigger

The following table compares regular triggers and event triggers:

| Feature        | Regular Trigger                                                                                                            | Event Trigger                                                                                        |
| -------------- | -------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------- |
| Trigger Level  | Table\-level trigger, associated with a specific table and fired on `INSERT`, `UPDATE`, `DELETE`, or `TRUNCATE` statement. | Database\-level triggers fired in response to DDL statements such as `CREATE`, `ALTER`, `DROP`, etc. |
| Execution Time | Can be fired `BEFORE`, `AFTER`, or `INSTEAD` `OF` `DML` operations                                                         | Fired at some events including `ddl_command_start`, `ddl_command_end`, `table_rewrite`, `sql_drop`   |
| Scope          | Can be defined at the row or statement level                                                                               | Executes at the database level                                                                       |
| Access to Data | Has access to the data being modified                                                                                      | Has access to metadata                                                                               |
| Use Cases      | Logging changes to a specific table, updating related tables, and enforcing business rules.                                | Auditing DDL commands, and monitoring user activities.                                               |

## Summary

- An event trigger is a trigger that fires when an event related to the DDL statement occurs.
- Use the `CREATE EVENT TRIGGER` statement to define a new event trigger.


# Conditional Triggers

---
title: 'Creating a PostgreSQL Trigger with a When Condition'
page_title: 'PostgreSQL Trigger When Condition'
page_description: 'In this tutorial, you will learn how to create a conditional trigger that fires only when a condition is true.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-triggers/postgresql-trigger-when-condition/'
ogImage: ''
updatedOn: '2024-03-30T03:13:16+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Event Trigger'
  slug: 'postgresql-triggers/postgresql-event-trigger'
nextLink:
  title: 'PostgreSQL Views'
  slug: 'postgresql-triggers/../postgresql-views'
---

**Summary**: in this tutorial, you will learn how to create a conditional trigger that fires only when a condition is true.

In PostgreSQL, a trigger is a database object that automatically executes a function when `INSERT`, `UPDATE`, `DELETE`, or `TRUNCATE` event occurs on a table.

Sometimes, you want the trigger to be activated only when a specific condition is met. To do that, you specify a boolean condition in the `WHEN` clause of the [CREATE TRIGGER](creating-first-trigger-postgresql) statement, like so:

```sql
CREATE TRIGGER trigger_name
ON table_name
WHEN condition
EXECUTE FUNCTION function_name(arguments);
```

In this syntax, the `condition` is a boolean expression. If the `condition` is true, the trigger is fired; otherwise, the trigger will not be activated.

In row\-level triggers, you can access the old/new values of columns of the row within the condition. However, in statement\-level triggers, you do not have access to column values.

## PostgreSQL Trigger When Condition example

First, [create a table](../postgresql-tutorial/postgresql-create-table) called `orders` to store order data:

```sql
CREATE TABLE orders (
    order_id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    customer_id INT NOT NULL,
    total_amount NUMERIC NOT NULL DEFAULT 0,
    status VARCHAR(20) NOT NULL
);
```

Second, create another table called `customer_stats` to store the total spent amount by customers:

```sql
CREATE TABLE customer_stats (
    customer_id INT PRIMARY KEY,
    total_spent NUMERIC NOT NULL DEFAULT 0
);
```

Third, create an [AFTER INSERT trigger](postgresql-after-insert-trigger) that inserts a row into the `customer_stats` table when a new row is inserted into the `orders` table:

```sql
CREATE OR REPLACE FUNCTION insert_customer_stats()
RETURNS TRIGGER
AS $$
BEGIN
   INSERT INTO customer_stats (customer_id)
   VALUES (NEW.customer_id);
   RETURN NULL;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER insert_customer_stats_trigger
AFTER INSERT ON orders
FOR EACH ROW
EXECUTE FUNCTION insert_customer_stats();
```

Fourth, define an `AFTER UPDATE` trigger on the `orders` table with a condition:

```sql
CREATE OR REPLACE FUNCTION update_customer_stats()
RETURNS TRIGGER
AS
$$
BEGIN
    IF NEW.status = 'completed' THEN
        -- Update the total_spent for the customer
        UPDATE customer_stats
        SET total_spent = total_spent + NEW.total_amount
        WHERE customer_id = NEW.customer_id;
    END IF;
    RETURN NULL;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_customer_stats_trigger
AFTER UPDATE ON orders
FOR EACH ROW
WHEN (OLD.status <> 'completed' AND NEW.status = 'completed')
EXECUTE FUNCTION update_customer_stats();
```

The `AFTER UPDATE` trigger fires only when the status of the row changes from non\-completed state to completed.

Fifth, [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `orders` table:

```sql
INSERT INTO orders (customer_id, total_amount, status)
VALUES
    (1, 100, 'pending'),
    (2, 200, 'pending');
```

The `AFTER INSERT` trigger fires and insert rows into the `customer_stats` table.

Sixth, change the order statuses of customer id 1 and 2 to `completed`:

```sql
UPDATE order
SET status = 'completed'
WHERE customer_id IN (1,2);
```

The `AFTER UPDATE` trigger fires and updates the `total_spent` column in the `customer_stats` table.

Finally, retrieve the data from the `customer_stats` table:

```sql
SELECT * FROM customer_stats;
```

Output:

```plaintext
 customer_id | total_spent
-------------+-------------
           1 |         100
           2 |         200
(2 rows)
```

## Summary

- Specify a condition in the `WHEN` clause of the `CREATE TRIGGER` statement to instruct PostgreSQL to fire the trigger when the condition is true.


# Functions

# PostgreSQL Aggregate Functions

---
title: 'PostgreSQL Aggregate Functions'
page_title: 'PostgreSQL Aggregate Functions'
page_description: 'This tutorial shows you how to use the PostgreSQL aggregate functions such as AVG(), COUNT(), MIN(), MAX(), and SUM() to summarize data.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-aggregate-functions/'
ogImage: 'https://www.postgresqltutorial.com//postgresqltutorial/aggregate-functions.png'
updatedOn: '2024-03-20T01:48:16+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Functions'
  slug: 'postgresql-functions'
nextLink:
  title: 'PostgreSQL AVG Function'
  slug: 'postgresql-aggregate-functions/postgresql-avg-function'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL aggregate functions such as `AVG()`, `COUNT()`, `MIN()`, `MAX()`, and `SUM()`.

## Introduction to PostgreSQL aggregate functions

Aggregate functions perform a calculation on a set of rows and return a single row. PostgreSQL provides all standard SQL’s aggregate functions as follows:

- [`AVG()`](postgresql-aggregate-functions/postgresql-avg-function) – return the average value.
- [`COUNT()`](postgresql-aggregate-functions/postgresql-count-function) – return the number of values.
- [`MAX()`](postgresql-aggregate-functions/postgresql-max-function) – return the maximum value.
- [`MIN()`](postgresql-aggregate-functions/postgresql-min-function) – return the minimum value.
- [`SUM()`](postgresql-aggregate-functions/postgresql-sum-function) – return the sum of all or distinct values.

In practice, you often use the aggregate functions with the [`GROUP BY`](postgresql-tutorial/postgresql-group-by) clause in the [`SELECT`](postgresql-tutorial/postgresql-select) statement:

```csssql
SELECT column1, AGGREGATE_FUNCTION(column2)
FROM table1
GROUP BY column1;
```

In this syntax, the `GROUP BY` clause divides the result set into groups of rows and the aggregate function performs a calculation on each group e.g., maximum, minimum, average, etc.

## PostgreSQL aggregate function examples

Let’s use the `film` table in the [sample database](postgresql-getting-started/postgresql-sample-database) for the demonstration.

![Film table](/postgresqltutorial/film_table.png)

## AVG() function examples

The following statement uses the `AVG()` function to calculate the average replacement cost of all films:

```sql
SELECT
  ROUND(AVG(replacement_cost), 2) avg_replacement_cost
FROM
  film;
```

The following is the result:

```text
 avg_replacement_cost
----------------------
                19.98
(1 row)
```

Noted that we use the [`ROUND()`](postgresql-math-functions/postgresql-round) function to round the result to 2 decimal places.

To calculate the average replacement cost of the `Drama` films whose category id is 7, you use the following statement:

```css
SELECT
  ROUND(
    AVG(replacement_cost),
    2
  ) avg_replacement_cost
FROM
  film
  INNER JOIN film_category USING(film_id)
  INNER JOIN category USING(category_id)
WHERE
  category_id = 7;
```

Here is the result:

```text
 avg_replacement_cost
----------------------
                21.09
(1 row)
```

## COUNT() function examples

To get the number of films, you use the `COUNT(*)` function as follows:

```css
SELECT
  COUNT(*)
FROM
  film;
```

Output:

```text
 count
-------
  1000
(1 row)
```

To get the number of drama films, you use the following statement:

```
SELECT
  COUNT(*) drama_films
FROM
  film
  INNER JOIN film_category USING(film_id)
  INNER JOIN category USING(category_id)
WHERE
  category_id = 7;
```

The result shows that there are 62 drama films:

```text
 drama_films
-------------
          62
(1 row)

```

## MAX() function examples

The following statement returns the maximum replacement cost of films.

```
SELECT
  MAX(replacement_cost)
FROM
  film;
```

Output:

```text
  max
-------
 29.99
(1 row)
```

To get the films that have the maximum replacement cost, you use the following query:

```css
SELECT
  film_id,
  title
FROM
  film
WHERE
  replacement_cost =(
    SELECT
      MAX(replacement_cost)
    FROM
      film
  )
ORDER BY
  title;
```

Output:

```sql
film_id |          title
---------+-------------------------
      34 | Arabia Dogma
      52 | Ballroom Mockingbird
      81 | Blindness Gun
      85 | Bonnie Holocaust
     138 | Chariots Conspiracy
...
```

The subquery returned the maximum replacement cost which then was used by the outer query for retrieving the film’s information.

## MIN() function examples

The following example uses the `MIN()` function to return the minimum replacement cost of films:

```
SELECT
  MIN(replacement_cost)
FROM
  film;
```

Output:

```text
 min
------
 9.99
(1 row)
```

To get the films that have the minimum replacement cost, you use the following query:

```plaintext
SELECT
  film_id,
  title
FROM
  film
WHERE
  replacement_cost =(
    SELECT
      MIN(replacement_cost)
    FROM
      film
  )
ORDER BY
  title;

```

Output:

```text
 film_id |         title
---------+------------------------
      23 | Anaconda Confessions
     150 | Cider Desire
     182 | Control Anthem
     203 | Daisy Menagerie
...
```

## SUM() function examples

The following statement uses the `SUM()` function to calculate the total length of films grouped by film’s rating:

```
SELECT
  rating,
  SUM(rental_duration)
FROM
  film
GROUP BY
  rating
ORDER BY
  rating;
```

The following picture illustrates the result:

```
 rating | sum
--------+------
 G      |  861
 PG     |  986
 PG-13  | 1127
 R      |  931
 NC-17  | 1080
(5 rows)
```

## Summary

- Aggregate functions perform a calculation on a set of rows and return a single row.
- Use aggregate functions to summarize data.
- Use the `AVG()` function to calculate the average value in a set of values.
- Use the `COUNT()` function to perform a count.
- Use the `SUM()` function to calculate the total of values.
- Use the `MIN()` function to get the minimum value in a set of values.
- Use the `MAX()` function to get the maximum value in a set of values.


# AVG

---
title: 'PostgreSQL AVG Function'
page_title: 'PostgreSQL AVG function'
page_description: 'In this tutorial, you will learn how to use PostgreSQL AVG function to calculate average value of a numeric column.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-aggregate-functions/postgresql-avg-function/'
ogImage: '/postgresqltutorial/payment-table.png'
updatedOn: '2024-01-25T13:26:11+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Aggregate Functions'
  slug: 'postgresql-aggregate-functions/'
nextLink:
  title: 'PostgreSQL COUNT Function'
  slug: 'postgresql-aggregate-functions/postgresql-count-function'
---

**Summary**: in this tutorial, you will learn how to use PostgreSQL `AVG()` function to calculate the average value of a set.

## Introduction to PostgreSQL AVG() function

The `AVG()` function is one of the most commonly used aggregate functions in PostgreSQL. The `AVG()` function allows you to calculate the average value of a set.

Here is the syntax of the `AVG()` function:

```sqlsql
AVG(column)
```

You can use the `AVG()` function in the [`SELECT`](../postgresql-tutorial/postgresql-select) and [`HAVING`](../postgresql-tutorial/postgresql-having) clauses.

To calculate the average value of distinct values in a set, you use the distinct option as follows:

```sql
AVG(DISTINCT column)
```

Notice that the `AVG()` function ignores `NULL`. If the column has no values, the `AVG()` function returns `NULL`.

## PostgreSQL AVG() function examples

Let’s take a look at some examples of using the `AVG` function.

We will use the following  `payment` table in the [dvdrental sample database](../postgresql-getting-started/postgresql-sample-database 'PostgreSQL Sample Database') for demonstration:

![payment table](/postgresqltutorial/payment-table.png)

### 1\) Basic PostgreSQL AVG() function example

The following example uses the `AVG()` function to calculate the average amount that customers paid:

```sql
SELECT AVG(amount)
FROM payment;
```

Output:

```shell
        avg
--------------------
 4.2006056453822965
(1 row)
```

To make the output more readable, you can use the [cast](../postgresql-tutorial/postgresql-cast) operator as follows:

```sql
SELECT AVG(amount)::numeric(10,2)
FROM payment;
```

Output:

```shell
 avg
------
 4.20
(1 row)
```

### 2\) Using AVG() function with DISTINCT operator example

The following query returns the average payment made by customers. Because we use `DISTINCT` PostgreSQL takes unique amounts and calculates the average.

```css
SELECT AVG(DISTINCT amount)::numeric(10,2)
FROM payment;
```

Output:

```text
 avg
------
 6.14
(1 row)
```

Notice that the result is different from the first example that does not use the `DISTINCT` option.

### 3\) Using AVG() function with SUM() function example

The following query uses the `AVG()` function with the `SUM()` function to calculate the total payment made by customers and the average of all transactions.

```css
SELECT
	AVG(amount)::numeric(10,2),
	SUM(amount)::numeric(10,2)
FROM
	payment;
```

```text
 avg  |   sum
------+----------
 4.20 | 61312.04
(1 row)
```

### 4\) Using PostgreSQL AVG() function with GROUP BY clause

Typically, you use the AVG() function with the GROUP BY clause to calculate the average value of per group.

- First, the `GROUP BY` clause divides rows of the table into groups
- Then, the `AVG()` function calculates the average value per group.

The following example uses the `AVG()` function with `GROUP BY` clause to calculate the average amount paid by each customer:

```
SELECT
  customer_id,
  first_name,
  last_name,
  AVG (amount):: NUMERIC(10, 2)
FROM
  payment
  INNER JOIN customer USING(customer_id)
GROUP BY
  customer_id
ORDER BY
  customer_id;
```

Output:

```text
 customer_id | first_name  |  last_name   | avg
-------------+-------------+--------------+------
           1 | Mary        | Smith        | 3.82
           2 | Patricia    | Johnson      | 4.76
           3 | Linda       | Williams     | 5.45
           4 | Barbara     | Jones        | 3.72
...
```

In the query, we joined the `payment` table with the `customer` table using [inner join](../postgresql-tutorial/postgresql-inner-join). We used `GROUP BY` clause to group customers into groups and applied the `AVG()` function to calculate the average per group.

### 5\) PostgreSQL AVG() function with HAVING clause example

You can use the `AVG()` function in the `HAVING` clause to filter groups based on a specified condition.

The following example uses the `AVG()` function to calculate the average payment of each customer and return only the ones who paid higher than 5 USD:

```
SELECT
  customer_id,
  first_name,
  last_name,
  AVG (amount):: NUMERIC(10, 2)
FROM
  payment
  INNER JOIN customer USING(customer_id)
GROUP BY
  customer_id
HAVING
  AVG (amount) > 5
ORDER BY
  customer_id;
```

Output:

```text
 customer_id | first_name | last_name | avg
-------------+------------+-----------+------
           3 | Linda      | Williams  | 5.45
          19 | Ruth       | Martinez  | 5.49
         137 | Rhonda     | Kennedy   | 5.04
         181 | Ana        | Bradley   | 5.08
         187 | Brittany   | Riley     | 5.62
         209 | Tonya      | Chapman   | 5.09
         259 | Lena       | Jensen    | 5.16
         272 | Kay        | Caldwell  | 5.07
         285 | Miriam     | Mckinney  | 5.12
         293 | Mae        | Fletcher  | 5.13
         310 | Daniel     | Cabral    | 5.30
         311 | Paul       | Trout     | 5.39
         321 | Kevin      | Schuler   | 5.52
         470 | Gordon     | Allard    | 5.09
         472 | Greg       | Robins    | 5.07
         477 | Dan        | Paine     | 5.09
         508 | Milton     | Howland   | 5.29
         522 | Arnold     | Havens    | 5.05
         542 | Lonnie     | Tirado    | 5.30
         583 | Marshall   | Thorn     | 5.12
(20 rows)
```

This query is similar to the one above with an additional `HAVING` clause. We used `AVG` function in the `HAVING` clause to filter the groups that have an average amount less than or equal to 5\.

### 6\) Using PostgreSQL AVG() function and NULL

Let’s see the behavior of the `AVG()` function when its input has NULL.

First, [create a table](../postgresql-tutorial/postgresql-create-table) named `t1`.

```
CREATE TABLE t1 (
  id serial PRIMARY KEY,
  amount INTEGER
);

```

Second, [insert](../postgresql-tutorial/postgresql-insert) some sample data:

```sql
INSERT INTO t1 (amount)
VALUES
  (10),
  (NULL),
  (30);
```

The data of the `t1` table is as follows:

```sql
SELECT
  *
FROM
  t1;
```

Third, use the `AVG()` function to calculate average values in the amount column.

```sql
SELECT AVG(amount)::numeric(10,2)
FROM t1;
```

Output:

```
  avg
-------
 20.00
(1 row)
```

It returns 20, meaning that the `AVG()` function ignores `NULL` values.

## Summary

- Use PostgreSQL `AVG()` function to calculate the average value of a set.
- The `AVG()` function ignores NULL in the calculation.
- The `AVG()` function returns NULL if the set is empty.


# ARRAY_AGG

---
title: 'PostgreSQL ARRAY_AGG Function'
page_title: 'PostgreSQL ARRAY_AGG Function By Practical Examples'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL ARRAY_AGG() aggregate function to return an array from a set of input values.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-aggregate-functions/postgresql-array_agg/'
ogImage: '/postgresqltutorial/PostgreSQL-ARRAY_AGG-example.png'
updatedOn: '2024-01-26T04:00:31+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL SUM Function'
  slug: 'postgresql-aggregate-functions/postgresql-sum-function'
nextLink:
  title: 'PostgreSQL BOOL_AND() Function'
  slug: 'postgresql-aggregate-functions/postgresql-bool_and'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `ARRAY_AGG()` aggregate function to return an array from a set of input values.

## Introduction to PostgreSQL ARRAY_AGG() function

The PostgreSQL `ARRAY_AGG()` function is an aggregate function that accepts a set of values and returns an [array](../postgresql-tutorial/postgresql-array) in which each value in the set is assigned to an element of the array.

The following shows the syntax of the `ARRAY_AGG()` function:

```css
ARRAY_AGG(expression [ORDER BY [sort_expression {ASC | DESC}], [...])
```

The `ARRAY_AGG()` accepts an expression that returns a value of any type that is valid for an array element.

The `ORDER BY` clause specifies the order of rows processed in the aggregation, which determines the order of the elements in the result array. The `ORDER BY` clause is optional.

Similar to other aggregate functions such as [`AVG()`](postgresql-avg-function), [`COUNT()`](postgresql-count-function), [`MAX()`](postgresql-max-function), [`MIN()`](postgresql-min-function), and [`SUM()`](postgresql-sum-function), the `ARRAY_AGG()` is often used with the [`GROUP BY`](../postgresql-tutorial/postgresql-group-by) clause.

## PostgreSQL ARRAY_AGG() function examples

We will use the `film`, `film_actor`, and `actor` tables from the [sample database](../postgresql-getting-started/postgresql-sample-database) for the demonstration.

### 1\) Using PostgreSQL ARRAY_AGG() function without the ORDER BY clause example

The following example uses the `ARRAY_AGG()` function to return the list of film titles and a list of actors for each film:

```sql
SELECT
    title,
    ARRAY_AGG (first_name || ' ' || last_name) actors
FROM
    film
INNER JOIN film_actor USING (film_id)
INNER JOIN actor USING (actor_id)
GROUP BY
    title
ORDER BY
    title;
```

Here is the partial output:

![](/postgresqltutorial/PostgreSQL-ARRAY_AGG-example.png)As you can see, the actors in each film are arbitrarily ordered. To sort the actors by last name or first name, you can use the `ORDER BY` clause in the `ARRAY_AGG()` function.

### 2\) Using PostgreSQL ARRAY_AGG() function with the ORDER BY clause example

This example uses the `ARRAY_AGG()` function to return a list of films and a list of actors for each film sorted by the actor’s first name:

```sql
SELECT
    title,
    ARRAY_AGG (
        first_name || ' ' || last_name
        ORDER BY
            first_name
    ) actors
FROM
    film
INNER JOIN film_actor USING (film_id)
INNER JOIN actor USING (actor_id)
GROUP BY
    title
ORDER BY
    title;
```

The following shows the partial output:

![](/postgresqltutorial/PostgreSQL-ARRAY_AGG-with-ORDER-BY-clause.png)
You can sort the actor list for each film by the actor’s first name and last name as shown in the following query:

```sql
SELECT
    title,
    ARRAY_AGG (
        first_name || ' ' || last_name
        ORDER BY
            first_name ASC,
            last_name DESC
    ) actors
FROM
    film
INNER JOIN film_actor USING (film_id)
INNER JOIN actor USING (actor_id)
GROUP BY
    title
ORDER BY
    title;
```

This picture shows the partial output of the query:

![](/postgresqltutorial/PostgreSQL-ARRAY_AGG-with-ORDER-BY-clause-example-2.png)

## Summary

- Use the PostgreSQL `ARRAY_AGG()` function to return an array from a set of input values.


# BOOL_AND

---
title: 'PostgreSQL BOOL_AND() Function'
page_title: 'PostgreSQL BOOL_AND() Function'
page_description: 'In this tutorial, you will learn about the PostgreSQL BOOL_AND() function to aggregate boolean values across rows within a group.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-aggregate-functions/postgresql-bool_and/'
ogImage: ''
updatedOn: '2024-03-22T02:49:19+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL ARRAY_AGG Function'
  slug: 'postgresql-aggregate-functions/postgresql-array_agg'
nextLink:
  title: 'PostgreSQL STRING_AGG Function'
  slug: 'postgresql-aggregate-functions/postgresql-string_agg-function'
---

**Summary**: in this tutorial, you will learn about the PostgreSQL `BOOL_AND()` function to aggregate boolean values across rows within a group.

## Introduction to the PostgreSQL BOOL_AND() function

The `BOOL_AND()` is an aggregate function that allows you to aggregate boolean values across rows within a group.

The following shows the syntax of the `BOOL_AND()` function:

```sqlsql
BOOL_AND(expression)
```

In this syntax:

- `expression`: This is a boolean expression to evaluate.

The `BOOL_AND()` function returns true if all values in the group are true, or false otherwise.

It’s important to note that the `BOOL_AND()` function ignores `NULL`s within the group.

## PostgreSQL BOOL_AND() function examples

Let’s explore some examples of using the `BOOL_AND()` function.

### 1\) Setting up sample tables

First, [create tables](../postgresql-tutorial/postgresql-create-table) called `teams` and `members`:

```sql
CREATE TABLE teams (
    team_id SERIAL PRIMARY KEY,
    team_name VARCHAR(100) NOT NULL
);

CREATE TABLE projects(
    project_id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    active BOOL,
    team_id INT NOT NULL REFERENCES teams(team_id)
);
```

Second, [insert rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the tables:

```sql
INSERT INTO teams (team_name)
VALUES
('Team A'),
('Team B'),
('Team C')
RETURNING *;

INSERT INTO projects(name, active, team_id)
VALUES
('Intranet', false, 1),
('AI Chatbot', true, 1),
('Robot', true, 2),
('RPA', true, 2),
('Data Analytics', true, 3),
('BI', NULL, 3)
RETURNING *;
```

The `teams` table:

```text
 team_id | team_name
---------+-----------
       1 | Team A
       2 | Team B
       3 | Team C
(3 rows)
```

The `members` table:

```text
 project_id |      name      | active | team_id
------------+----------------+--------+---------
          1 | Intranet       | f      |       1
          2 | AI Chatbot     | t      |       1
          3 | Robot          | t      |       2
          4 | RPA            | t      |       2
          5 | Data Analytics | t      |       3
          6 | BI             | null   |       3
(6 rows)
```

### 2\) Basic BOOL_AND() function example

The following example uses the `BOOL_AND()` function to test if all projects are active in the `projects` table:

```sql
SELECT
  BOOL_AND(active)
FROM
  projects;
```

Output:

```text
 bool_and
----------
 f
(1 row)

```

The `BOOL_AND()` function returns true indicating that there are inactive projects in the `projects` table.

### 2\) Using BOOL_AND() function with GROUP BY clause

The following example uses the `BOOL_AND()` function with the [`GROUP BY`](../postgresql-tutorial/postgresql-group-by) clause to check if there are active projects in each team:

```sql
SELECT
  team_name,
  BOOL_AND(active) active_projects
FROM
  projects
  INNER JOIN teams USING (team_id)
GROUP BY
  team_name;
```

Output:

```text
 team_name | active_projects
-----------+-----------------
 Team A    | f
 Team B    | t
 Team C    | t
(3 rows)
```

The output indicates that teams B and C have projects that are active (or NULL) whereas team C has inactive projects.

### 3\) Using BOOL_AND() function in HAVING clause

The following example uses the `BOOL_AND()` function with the [`GROUP BY`](../postgresql-tutorial/postgresql-group-by) and [HAVING](../postgresql-tutorial/postgresql-having) clauses to retrieve teams that have active projects:

```
SELECT
  team_name,
  BOOL_AND(active) active_projects
FROM
  projects
  INNER JOIN teams USING (team_id)
GROUP BY
  team_name
HAVING
  BOOL_AND(active) = true;
```

Output:

```
 team_name | active_projects
-----------+-----------------
 Team B    | t
 Team C    | t
(2 rows)

```

## Summary

- Use the `BOOL_AND()` function to aggregate boolean values across rows, which returns true if all values are true or false otherwise.
- The `BOOL_AND()` function ignores NULLs in the group.


# BOOL_OR

---
title: 'PostgreSQL BOOL_OR() Function'
page_title: 'PostgreSQL BOOL_OR() Function'
page_description: 'In this tutorial, you will learn about the PostgreSQL BOOL_OR() function to aggregate boolean values across rows within a group.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-aggregate-functions/postgresql-bool_or/'
ogImage: ''
updatedOn: '2024-03-22T02:28:16+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL STRING_AGG Function'
  slug: 'postgresql-aggregate-functions/postgresql-string_agg-function'
nextLink:
  title: 'PostgreSQL Date Functions'
  slug: 'postgresql-aggregate-functions/../postgresql-date-functions'
---

**Summary**: in this tutorial, you will learn about the PostgreSQL `BOOL_OR()` function to aggregate boolean values across rows within a group.

## Introduction to the PostgreSQL BOOL_OR() function

The `BOOL_OR()` is an aggregate function that allows you to aggregate boolean values across rows within a group.

Here’s the syntax of the `BOOL_OR()` function:

```sqlsql
bool_or(expression)
```

In this syntax, the `expression` is the boolean expression to evaluate.

The `BOOL_OR()` function returns true if at least one value in the group is true. If all values are false, the function returns false.

Please note that the `BOOL_OR` function ignores `NULL`s within the group.

## PostgreSQL BOOL_OR() function examples

Let’s explore some examples of using the `BOOL_OR()` function.

### 1\) Setting up sample tables

First, [create tables](../postgresql-tutorial/postgresql-create-table) called `teams` and `members`:

```sql
CREATE TABLE teams (
    team_id SERIAL PRIMARY KEY,
    team_name VARCHAR(100) NOT NULL
);

CREATE TABLE members (
    member_id SERIAL PRIMARY KEY,
    member_name VARCHAR(100) NOT NULL,
    active bool,
    team_id INT REFERENCES teams(team_id)
);
```

Second, [insert rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the tables:

```sql
INSERT INTO teams (team_name)
VALUES
('Team A'),
('Team B'),
('Team C')
RETURNING *;

INSERT INTO members (member_name, team_id, active)
VALUES
('Alice', 1, true),
('Bob', 2, true),
('Charlie', 1, null),
('David', 2, false),
('Peter', 3, false),
('Joe', 3, null)
RETURNING *;
```

The `teams` table:

```text
 team_id | team_name
---------+-----------
       1 | Team A
       2 | Team B
       3 | Team C
(3 rows)
```

The `members` table:

```text
 member_id | member_name | active | team_id
-----------+-------------+--------+---------
         1 | Alice       | t      |       1
         2 | Bob         | t      |       2
         3 | Charlie     | null   |       1
         4 | David       | f      |       2
         5 | Peter       | f      |       3
         6 | Joe         | null   |       3
(6 rows)
```

### 2\) Basic BOOL_OR() function example

The following example uses the `BOOL_OR()` function to test if there are any active members in the `members` table:

```sql
SELECT
  BOOL_OR(active) active_member_exists
FROM
  members;
```

Output:

```text
 active_member_exists
----------------------
 t
(1 row)
```

The `BOOL_OR()` function returns true indicating that the `members` table has active members.

### 2\) Using BOOL_OR() function with GROUP BY clause

The following example uses the `BOOL_OR()` function with the [`GROUP BY`](../postgresql-tutorial/postgresql-group-by) clause to check if there are any active members in each team:

```sql
SELECT
  team_name,
  BOOL_OR(active) active_member_exists
FROM
  members
  INNER JOIN teams USING (team_id)
GROUP BY
  team_name;
```

Output:

```text
 team_name | active_member_exists
-----------+----------------------
 Team A    | t
 Team B    | t
 Team C    | f
(3 rows)
```

The output indicates that teams A and B have active members whereas team C does not have any active members.

### 3\) Using BOOL_OR() function in HAVING clause

The following example uses the `BOOL_OR()` function with the [`GROUP BY`](../postgresql-tutorial/postgresql-group-by) and [HAVING](../postgresql-tutorial/postgresql-having) clauses to retrieve teams that have active members:

```
SELECT
  team_name,
  BOOL_OR(active) active_member_exists
FROM
  members
  INNER JOIN teams USING (team_id)
GROUP BY
  team_name
HAVING
  BOOL_OR(active) = true;
```

Output:

```
 team_name | active_member_exists
-----------+----------------------
 Team A    | t
 Team B    | t
(2 rows)
```

## Summary

- Use the `BOOL_OR()` function to aggregate boolean values across rows within a group.
- The `BOOL_OR()` function ignores NULLs in the group.


# COUNT

---
title: 'PostgreSQL COUNT Function'
page_title: 'PostgreSQL COUNT() Function'
page_description: 'You will learn how to use the PostgreSQL COUNT() function to get the number of rows that satisfy a specific condition.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-aggregate-functions/postgresql-count-function/'
ogImage: '/postgresqltutorial/payment.png'
updatedOn: '2024-01-26T02:50:46+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL AVG Function'
  slug: 'postgresql-aggregate-functions/postgresql-avg-function'
nextLink:
  title: 'PostgreSQL MAX Function'
  slug: 'postgresql-aggregate-functions/postgresql-max-function'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `COUNT()` function to count the number of rows in a table.

## Introduction to PostgreSQL COUNT() function

The `COUNT()` function is an aggregate function that allows you to obtain the number of rows that match a specific condition.

The following statement illustrates various ways of using the `COUNT()` function.

### COUNT(\*)

The `COUNT(*)` function returns the number of rows returned by a  [`SELECT`](../postgresql-tutorial/postgresql-select) statement, including NULL and duplicates.

```sqlsql
SELECT
   COUNT(*)
FROM
   table_name
WHERE
   condition;
```

When you apply the `COUNT(*)` function to the entire table, PostgreSQL has to scan the whole table sequentially. If you use the `COUNT(*)` function on a big table, the query will be slow. This is related to the PostgreSQL MVCC implementation.

Due to multiple transactions seeing different states of data simultaneously, there is no direct way for `COUNT(*)` function to count across the entire table. Therefore, PostgreSQL must scan all rows.

### COUNT(column)

Similar to the `COUNT(*)` function, the `COUNT(column_name)` function returns the number of rows returned by a `SELECT` clause. However, it does not consider `NULL` values in the `column_name`.

```sql
SELECT
   COUNT(column_name)
FROM
   table_name
WHERE
   condition;
```

### COUNT(DISTINCT column)

In this syntax, the `COUNT(DISTINCT column_name)` returns the number of unique non\-null values in the `column_name`.

```sql
SELECT
   COUNT(DISTINCT column_name)
FROM
   table_name
WHERE
   condition;
```

In practice, you often use the `COUNT()` function with the [`GROUP BY`](../postgresql-tutorial/postgresql-group-by) clause to return the number of items for each group.

For example, you can use the `COUNT()` with the `GROUP BY` clause to return the number of films in each film category.

## PostgreSQL COUNT() function examples

Let’s use the `payment` table in the [sample database](../postgresql-getting-started/postgresql-sample-database) for the demonstration.

![payment](/postgresqltutorial/payment.png)

### 1\) Basic PostgreSQL COUNT(\*) example

The following statement uses the `COUNT(*)` function to return the number of transactions in the `payment` table:

```sql
SELECT
   COUNT(*)
FROM
   payment;
```

Output:

```text
 count
-------
 14596
(1 row)
```

### 2\) PostgreSQL COUNT(DISTINCT column) example

To get the distinct amounts that customers paid, you use the `COUNT(DISTINCT amount)` function as shown in the following example:

```
SELECT
  COUNT (DISTINCT amount)
FROM
  payment;
```

Output:

```text
 count
-------
    19
(1 row)
```

### 3\) Using PostgreSQL COUNT() function with GROUP BY clause example

The following example uses the `COUNT()` function with the `GROUP BY` function to return the number of payments of each customer:

```
SELECT
  customer_id,
  COUNT (customer_id)
FROM
  payment
GROUP BY
  customer_id;
```

Output:

```text
 customer_id | count
-------------+-------
         184 |    20
          87 |    28
         477 |    21
         273 |    28
...
```

If you want to display the customer name instead of id, you can join the payment table with the customer table:

```
SELECT
  first_name || ' ' || last_name full_name,
  COUNT (customer_id)
FROM
  payment
INNER JOIN customer USING (customer_id)
GROUP BY
  customer_id;
```

Output:

```
       full_name       | count
-----------------------+-------
 Vivian Ruiz           |    20
 Wanda Patterson       |    28
 Dan Paine             |    21
 Priscilla Lowe        |    28
...
```

### 4\) Using PostgreSQL COUNT() function with HAVING clause

You can use the `COUNT` function in a  [`HAVING`](../postgresql-tutorial/postgresql-having) clause to apply a specific condition to groups. For example, the following statement finds customers who have made over 40 payments:

```
SELECT
  first_name || ' ' || last_name full_name,
  COUNT (customer_id)
FROM
  payment
INNER JOIN customer USING (customer_id)
GROUP BY
  customer_id
HAVING
  COUNT (customer_id) > 40
```

Output:

```
  full_name   | count
--------------+-------
 Karl Seal    |    42
 Eleanor Hunt |    45
(2 rows)
```

## Summary

- Use the PostgreSQL `COUNT()` function to return the number of rows in a table.


# STRING_AGG

---
title: 'PostgreSQL STRING_AGG Function'
page_title: 'PostgreSQL STRING_AGG() Function By Practical Examples'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL STRING_AGG() function to concatenate strings and place a separator between them.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-aggregate-functions/postgresql-string_agg-function/'
ogImage: '/postgresqltutorial/PostgreSQL-STRING_AGG-function-email-list-example.png'
updatedOn: '2024-01-26T04:07:35+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL BOOL_AND() Function'
  slug: 'postgresql-aggregate-functions/postgresql-bool_and'
nextLink:
  title: 'PostgreSQL BOOL_OR() Function'
  slug: 'postgresql-aggregate-functions/postgresql-bool_or'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `STRING_AGG()` function to concatenate strings and place a separator between them.

## Introduction to PostgreSQL STRING_AGG() function

The PostgreSQL `STRING_AGG()` function is an aggregate function that concatenates a list of strings and places a separator between them. It does not add the separator at the end of the string.

The following shows the syntax of the `STRING_AGG()` function:

```csssqlsql
STRING_AGG ( expression, separator [order_by_clause] )
```

The `STRING_AGG()` function accepts two arguments and an optional `ORDER BY` clause.

- `expression` is any valid expression that can resolve to a character string. If you use other types than character string type, you need to explicitly [cast](../postgresql-tutorial/postgresql-cast) these values of that type to the character string type.
- `separator` is the separator for concatenated strings.

The `order_by_clause` is an optional clause that specifies the order of concatenated results. It has the following form:

```
ORDER BY expression1 {ASC | DESC}, [...]
```

The `STRING_AGG()` is similar to the [`ARRAY_AGG()`](https://neon.tech/postgresql/postgresql-aggregate-functions/postgresql-array_agg-function/) function except for the return type. The return value of the `STRING_AGG()` function is a string whereas the return value of the `ARRAY_AGG()` function is an [array](../postgresql-tutorial/postgresql-array).

Like other aggregate functions such as [`AVG()`](postgresql-avg-function), [`COUNT()`](postgresql-count-function), [`MAX()`](postgresql-max-function), [`MIN()`](postgresql-min-function), and [`SUM()`](postgresql-sum-function), the `STRING_AGG()` function is often used with the [`GROUP BY`](../postgresql-tutorial/postgresql-group-by) clause.

## PostgreSQL STRING_AGG() function examples

We will use the `film`, `film_actor`, and `actor` tables from the [sample database](../postgresql-getting-started/postgresql-sample-database) for the demonstration:

### 1\) Using PostgreSQL STRING_AGG() function to generate a list of comma\-separated values

This example uses the `STRING_AGG()` function to return a list of actor’s names for each film from the `film` table:

```sql
SELECT
    f.title,
    STRING_AGG (
	a.first_name || ' ' || a.last_name,
        ','
       ORDER BY
        a.first_name,
        a.last_name
    ) actors
FROM
    film f
INNER JOIN film_actor fa USING (film_id)
INNER JOIN actor a USING (actor_id)
GROUP BY
    f.title;
```

Here is the partial output:

```
            title            |                                                                                                   actors
-----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Academy Dinosaur            | Christian Gable,Johnny Cage,Lucille Tracy,Mary Keitel,Mena Temple,Oprah Kilmer,Penelope Guiness,Rock Dukakis,Sandra Peck,Warren Nolte
 Ace Goldfinger              | Bob Fawcett,Chris Depp,Minnie Zellweger,Sean Guiness
 Adaptation Holes            | Bob Fawcett,Cameron Streep,Julianne Dench,Nick Wahlberg,Ray Johansson
...
```

### 2\) Using the PostgreSQL STRING_AGG() function to generate a list of emails

The following example uses the `STRING_AGG()` function to build an email list for each country, with emails separated by semicolons:

```
SELECT
    country,
    STRING_AGG (email, ';') email_list
FROM
    customer
INNER JOIN address USING (address_id)
INNER JOIN city USING (city_id)
INNER JOIN country USING (country_id)
GROUP BY
    country
ORDER BY
    country;
```

The following picture shows the partial output:

![PostgreSQL STRING_AGG function email list example](/postgresqltutorial/PostgreSQL-STRING_AGG-function-email-list-example.png)

## Summary

- Use the PostgreSQL `STRING_AGG()` function to concatenate strings and place a separator between them.


# SUM

---
title: 'PostgreSQL SUM Function'
page_title: 'PostgreSQL SUM() Function'
page_description: 'This tutorial shows you how to use the PostgreSQL SUM() function to calculate the sum of values in a set of values.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-aggregate-functions/postgresql-sum-function/'
ogImage: '/postgresqltutorial/payment-table.png'
updatedOn: '2024-01-26T03:46:26+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL MIN() Function'
  slug: 'postgresql-aggregate-functions/postgresql-min-function'
nextLink:
  title: 'PostgreSQL ARRAY_AGG Function'
  slug: 'postgresql-aggregate-functions/postgresql-array_agg'
---

**Summary**: in this tutorial, you’ll learn how to use PostgreSQL `SUM()` function to calculate the sum of a set of values.

## Introduction to PostgreSQL SUM() function

The PostgreSQL `SUM()` is an aggregate function that returns the sum of values in a set.

Here’s the basic syntax of the `SUM()` function:

```csssqlsql
SUM(DISTINCT expression)
```

The `SUM()` function ignores `NULL`, meaning that it doesn’t consider the `NULL` in calculation.

If you use the `DISTINCT` option, the `SUM()` function calculates the sum of only distinct values.

For example, without the `DISTINCT` option, the `SUM()` of 1, 1, and 2 will return 4\. But the sum of distinct values of 1, 1, and 2 will return 3 (1 \+ 2\) because the `SUM()` function ignores one duplicate value (1\).

The `SUM()` of an empty set will return `NULL`, not zero.

## PostgreSQL SUM() function examples

Let’s take some examples of using the `SUM()` function. We’ll use the `payment` table in the [sample database](../postgresql-getting-started/postgresql-sample-database 'PostgreSQL Sample Database').

![payment table](/postgresqltutorial/payment-table.png)

### 1\) Using PostgreSQL SUM() function in SELECT statement example

The following example uses the `SUM()` function to calculate the sum of all payments in the `payment` table:

```sql
SELECT
  SUM(amount)
FROM
  payment;
```

Output:

```
   sum
----------
 61312.04
(1 row)
```

### 2\) Using PostgreSQL SUM() function with an empty result set

The following statement uses the `SUM()` function to calculate the total payment of the customer id 2000\.

```sql
SELECT
  SUM (amount)
FROM
  payment
WHERE
  customer_id = 2000;
```

Output:

```shell
 sum
------
 null
(1 row)
```

In this example, the `SUM()` function returns a `NULL` because the `payment` the table has no row with the `customer_id` 2000\.

### 3\) Using the SUM() function with COALESCE() function example

If you want the `SUM()` function to return zero instead of `NULL` in case there is no matching row, you use the [`COALESCE()`](../postgresql-tutorial/postgresql-coalesce) function.

The `COALESCE()` function returns the first non\-null argument. In other words, it returns the second argument if the first argument is `NULL`.

The following query illustrates how to use the `SUM()` function with the `COALESCE()` function:

```sql
SELECT
  COALESCE(SUM(amount), 0 ) total
FROM
  payment
WHERE
  customer_id = 2000;
```

Output:

```shell
 total
-------
     0
(1 row)
```

### 4\) Using PostgreSQL SUM() function with the GROUP BY clause example

To calculate the summary of every group, you use the [`GROUP BY`](../postgresql-tutorial/postgresql-group-by) clause to group the rows in the table into groups and apply the `SUM()` function to each group.

The following example uses the `SUM()` function with the `GROUP BY` clause to calculate the total amount paid by each customer:

```sql
SELECT
  customer_id,
  SUM (amount) AS total
FROM
  payment
GROUP BY
  customer_id
ORDER BY
  total;
```

Output:

```text
 customer_id | total
-------------+--------
         318 |  27.93
         281 |  32.90
         248 |  37.87
         320 |  47.85
...
```

The following query retrieves the top five customers who made the highest payments:

```
SELECT
  customer_id,
  SUM (amount) AS total
FROM
  payment
GROUP BY
  customer_id
ORDER BY
  total DESC
LIMIT
  5;
```

Output:

```text
 customer_id | total
-------------+--------
         148 | 211.55
         526 | 208.58
         178 | 194.61
         137 | 191.62
         144 | 189.60
(5 rows)
```

### 5\) Using PostgreSQL SUM() function with a HAVING clause

To filter group sums based on a specific condition, you use the `SUM()` function in the [`HAVING`](../postgresql-tutorial/postgresql-having) clause.

The following example retrieves customers who have made payments exceeding 200:

```
SELECT
  customer_id,
  SUM (amount) AS total
FROM
  payment
GROUP BY
  customer_id
HAVING
  SUM(amount) > 200
ORDER BY
  total DESC
```

Output:

```
 customer_id | total
-------------+--------
         148 | 211.55
         526 | 208.58
(2 rows)
```

### 6\) Using PostgreSQL SUM() function with an expression

See the following `rental` table from the [sample database](../postgresql-getting-started/postgresql-sample-database):

![](/postgresqltutorial/rental.png)
The following statement uses the `SUM()` function to calculate the total rental days:

```
SELECT
  SUM(return_date - rental_date)
FROM
  rental;
```

Output:

```shell
           sum
-------------------------
 71786 days 190098:21:00
(1 row)
```

How it works.

- First, calculate the rental duration by subtracting the rental date from the return date.
- Second, apply the `SUM()` function to the expression.

The following example uses the `SUM()` function to calculate the total duration by customers:

```
SELECT
  first_name || ' ' || last_name full_name,
  SUM(return_date - rental_date) rental_duration
FROM
  rental
  INNER JOIN customer USING(customer_id)
GROUP BY
  customer_id
ORDER BY
  full_name;
```

Output:

```
       full_name       |  rental_duration
-----------------------+--------------------
 Aaron Selby           | 109 days 273:34:00
 Adam Gooch            | 106 days 245:18:00
 Adrian Clary          | 90 days 286:00:00
 Agnes Bishop          | 97 days 339:40:00
...
```

## Summary

- Use the `SUM()` function to calculate the sum of values in a set.
- Use the `DISTINCT` option in the `SUM()` function to calculate the sum of distinct values.
- Use the `SUM()` function with the `GROUP BY` clause to calculate the sum for each group.


# MAX

---
title: 'PostgreSQL MAX Function'
page_title: 'PostgreSQL MAX() Function'
page_description: 'This tutorial shows you how to use the PostgreSQL MAX() function to get the maximum value of a set of values.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-aggregate-functions/postgresql-max-function/'
ogImage: '/postgresqltutorial/payment-table.png'
updatedOn: '2024-01-26T03:03:53+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL COUNT Function'
  slug: 'postgresql-aggregate-functions/postgresql-count-function'
nextLink:
  title: 'PostgreSQL MIN() Function'
  slug: 'postgresql-aggregate-functions/postgresql-min-function'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `MAX()` function to get the maximum value of a set of values.

## Introduction to PostgreSQL MAX() function

PostgreSQL `MAX()` function is an aggregate function that returns the maximum value in a set of values.

The `MAX()` function can be useful in many cases. For example, you can use it to find the employees with the highest salary or to identify the most expensive products.

Here’s the syntax of the `MAX` function:

```csssql
MAX(expression);
```

You can use the `MAX()` function not just in the [`SELECT`](../postgresql-tutorial/postgresql-select) clause but also in the [`WHERE`](../postgresql-tutorial/postgresql-where) and [`HAVING`](../postgresql-tutorial/postgresql-having) clauses.

## PostgreSQL MAX() function examples

Let’s take some examples of using the `MAX()` function. We’ll use the `payment` table from the [sample database](../postgresql-getting-started/postgresql-sample-database).

[![payment table](/postgresqltutorial/payment-table.png)](/postgresqltutorial/payment-table.png)

### 1\) Basic PostgreSQL MAX() function example

The following query uses the `MAX()` function to find the highest amount paid by customers in the `payment` table:

```sql
SELECT
  MAX(amount)
FROM
  payment;
```

Output:

```text
  max
-------
 11.99
(1 row)
```

### 2\) Using the PostgreSQL MAX() function in subquery

The following example uses the `MAX()` function in a subquery to get the detailed payment information:

```
SELECT
  payment_id,
  customer_id,
  amount
FROM
  payment
WHERE
  amount = (
    SELECT
      MAX (amount)
    FROM
      payment
  );
```

Output:

```text
 payment_id | customer_id | amount
------------+-------------+--------
      20403 |         362 |  11.99
      22650 |         204 |  11.99
      23757 |         116 |  11.99
...
```

How it works.

- First, the subquery uses the `MAX()` function to return the highest payment.
- Second, the outer query retrieves all the payments whose amounts are equal to the highest payment returned from the subquery.

### 3\) Using PostgreSQL MAX() function with the GROUP BY clause

You can combine the `MAX`function with the [`GROUP BY`](../postgresql-tutorial/postgresql-group-by) clause to get the maximum value for each group.

The following example uses the `MAX()` function with a `GROUP BY` clause to retrieve the highest payment paid by each customer.

```
SELECT
  customer_id,
  MAX (amount)
FROM
  payment
GROUP BY
  customer_id;
```

Output:

```text
 customer_id |  max
-------------+-------
         184 |  9.99
          87 | 10.99
         477 | 10.99
         273 |  8.99
```

### 4\) Using PostgreSQL MAX() function with a HAVING clause

If you use the `MAX()` function in a [`HAVING`](../postgresql-tutorial/postgresql-having) clause, you can apply a filter for a group. For example, the following query uses the `MAX()` function to select the highest payment made by each customer and includes those that are over `8.99`:

```
SELECT
  customer_id,
  MAX (amount)
FROM
  payment
GROUP BY
  customer_id
HAVING
  MAX(amount) > 8.99;
```

Output:

```
customer_id |  max
-------------+-------
         184 |  9.99
          87 | 10.99
         477 | 10.99
         550 | 10.99
          51 |  9.99
...
```

## Summary

- Use the PostgreSQL `MAX()` function to find the maximum value of a set.


# MIN

---
title: 'PostgreSQL MIN() Function'
page_title: 'PostgreSQL MIN() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL MIN() function to get the minimum value in a set of values.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-aggregate-functions/postgresql-min-function/'
ogImage: '/postgresqltutorial/film-film_category-category-tables.png'
updatedOn: '2024-01-26T03:16:19+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL MAX Function'
  slug: 'postgresql-aggregate-functions/postgresql-max-function'
nextLink:
  title: 'PostgreSQL SUM Function'
  slug: 'postgresql-aggregate-functions/postgresql-sum-function'
---

**Summary**: in this tutorial, you will learn how to use PostgreSQL`MIN()` function to get the minimum value of a set.

## Introduction to PostgreSQL MIN function

PostgreSQL `MIN()` function is an aggregate function that returns the minimum value in a set of values.

To find the minimum value in a column of a table, you pass the column name the `MIN()` function. The [data type](../postgresql-tutorial/postgresql-data-types) of the column can be [numeric](../postgresql-tutorial/postgresql-integer), [string](../postgresql-tutorial/postgresql-char-varchar-text), or any comparable type.

Here’s the basic syntax of the `MIN()` function:

```csssqlsql
MIN(expression)
```

Unlike the [`AVG()`](postgresql-avg-function), [`COUNT()`](postgresql-count-function) and [`SUM()`](postgresql-sum-function) functions, the `DISTINCT` option does not have any effects on the `MIN()` function.

## PostgreSQL MIN() function examples

We will use the `film` , `film_category`, and `category` tables from the [dvdrental sample database](../postgresql-getting-started/postgresql-sample-database 'PostgreSQL Sample Database') for demonstration.

![film film_category category tables](/postgresqltutorial/film-film_category-category-tables.png)

### 1\) Basic PostgreSQL MIN() function example

The following example uses the `MIN()` function to get the lowest rental rate from the `rental_rate` column the `film` table:

```sql
SELECT
   MIN (rental_rate)
FROM
   film;
```

Output:

```text
 min
------
 0.99
(1 row)
```

The query returns 0\.99, which is the lowest rental rate.

### 2\) Using the PostgreSQL MIN() function in a subquery example

The following example uses the `MIN()` function in a subquery to get the film information of the film with the lowest rental rate:

```php
SELECT
  film_id,
  title,
  rental_rate
FROM
  film
WHERE
  rental_rate = (
    SELECT
      MIN(rental_rate)
    FROM
      film
  );
```

Output:

```text
 film_id |          title          | rental_rate
---------+-------------------------+-------------
       1 | Academy Dinosaur        |        0.99
      11 | Alamo Videotape         |        0.99
      12 | Alaska Phantom          |        0.99
     213 | Date Speed              |        0.99
...
```

How it works.

- First, the [subquery](../postgresql-tutorial/postgresql-subquery) to select the lowest rental rate.
- Then, the outer query selects films with rental rates equal to the lowest rental rate returned by the subquery.

### 3\) Using PostgreSQL MIN() function with GROUP BY clause example

In practice, you often use the `MIN` function with the [`GROUP BY`](../postgresql-tutorial/postgresql-group-by) clause to find the lowest value in each group.

The following statement uses the `MIN()` function with the `GROUP BY` clause to find the lowest replacement cost of films by category:

```
SELECT
  name category,
  MIN(replacement_cost) replacement_cost
FROM
  category
  INNER JOIN film_category USING (category_id)
  INNER JOIN film USING (film_id)
GROUP BY
  name
ORDER BY
  name;
```

Output:

```text
  category   | replacement_cost
-------------+------------------
 Action      |             9.99
 Animation   |             9.99
 Children    |             9.99
 Classics    |            10.99
 Comedy      |             9.99
...
```

### 4\) Using PostgreSQL MIN() function with the HAVING clause example

It’s possible to use the `MIN` function in the [`HAVING`](../postgresql-tutorial/postgresql-having) clause the filter of the groups whose minimum values meet a specific condition.

The following query uses the `MIN()` function to find the lowest replacement costs of films grouped by category, selecting only groups with replacement costs greater than `9.99`:

```
SELECT
  name category,
  MIN(replacement_cost) replacement_cost
FROM
  category
  INNER JOIN film_category USING (category_id)
  INNER JOIN film USING (film_id)
GROUP BY
  name
HAVING
  MIN(replacement_cost) > 9.99
ORDER BY
  name;
```

Output:

```text
 category | replacement_cost
----------+------------------
 Classics |            10.99
 Horror   |            10.99
 Music    |            10.99
(3 rows)
```

### 5\) Using the PostgreSQL MIN() function with other aggregate functions example

It’s possible to use the  `MIN()` function with other aggregate functions such as `MAX()` function in the same query.

The following example uses the `MIN()` and `MAX()` function to find the shortest and longest films by category:

```
SELECT
  name category,
  MIN(length) min_length,
  MAX(length) max_length
FROM
  category
  INNER JOIN film_category USING (category_id)
  INNER JOIN film USING (film_id)
GROUP BY
  name
ORDER BY
  name;
```

Output:

```
  category   | min_length | max_length
-------------+------------+------------
 Action      |         47 |        185
 Animation   |         49 |        185
 Children    |         46 |        178
 Classics    |         46 |        184
 Comedy      |         47 |        185
 Documentary |         47 |        183
 Drama       |         46 |        181
 Family      |         48 |        184
 Foreign     |         46 |        184
 Games       |         57 |        185
 Horror      |         48 |        181
 Music       |         47 |        185
 New         |         46 |        183
 Sci-Fi      |         51 |        185
 Sports      |         47 |        184
 Travel      |         47 |        185
(16 rows)
```

### Summary

- Use the `MIN()` function to find the lowest value in a set of values.
- Use the `MIN()` with `GROUP BY` clause to find the lowest value in a group of values.


# Date Functions

# Getting Current Date & Time

# CURRENT_DATE

---
title: 'PostgreSQL CURRENT_DATE Function'
page_title: 'PostgreSQL CURRENT_DATE Function By Practical Examples'
page_description: 'You will learn how to use the PostgreSQL CURRENT_DATE function to get the current date of the PostgreSQL server.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-current_date/'
ogImage: ''
updatedOn: '2024-01-26T07:40:24+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Date Functions'
  slug: 'postgresql-date-functions/'
nextLink:
  title: 'PostgreSQL CURRENT_TIME Function'
  slug: 'postgresql-date-functions/postgresql-current_time'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `CURRENT_DATE` function to get the current date.

## Introduction to the PostgreSQL CURRENT_DATE function

The `CURRENT_DATE` function returns the current date in the default time zone of the database session.

Here is the basic syntax of the `CURRENT_DATE` function:

```phpsql
CURRENT_DATE
```

The `CURRENT_DATE` function returns a [`DATE`](../postgresql-tutorial/postgresql-date) value that represents the current date.

Note that the `CURRENT_DATE` function returns the current date without any time information.

## PostgreSQL CURRENT_DATE function examples

Let’s explore some examples of using the `CURRENT_DATE` function.

### 1\) Basic PostgreSQL CURRENT_DATE function example

The following example shows how to use the `CURRENT_DATE` function to get the current date:

```
SELECT CURRENT_DATE;
```

Output:

```
 current_date
--------------
 2024-01-26
(1 row)

```

### 2\) Using the PostgreSQL CURRENT_DATE for date\-based filtering

You can use the `CURRENT_DATE` in the `WHERE` clause to filter data based on the current date.

For example, you can retrieve the rentals placed today by comparing the rental date in the `rental` table with the result of the `CURRENT_DATE` function:

```
SELECT
  *
FROM
  rental
WHERE
  rental_date = CURRENT_DATE;
```

### 3\) Calculating ages

First, create a new table called `employees` with the `date_of_birth` column and insert some data into the table:

```
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    date_of_birth DATE NOT NULL
);

INSERT INTO employees (name, date_of_birth)
VALUES
    ('John Doe', '1992-05-15'),
    ('Jane Smith', '1995-08-22'),
    ('Bob Johnson', '1998-11-10')
RETURNING *;
```

Output:

```php
 id |    name     | birth_date
----+-------------+------------
  1 | John Doe    | 1992-05-15
  2 | Jane Smith  | 1995-08-22
  3 | Bob Johnson | 1998-11-10
(3 rows)


INSERT 0 3
```

Second, calculate the age of employees using the `CURRENT_DATE` function:

```
SELECT
  name,
  date_of_birth,
  CURRENT_DATE as today,
  (CURRENT_DATE - date_of_birth) / 365 AS age
FROM
  employees
ORDER BY
  name;
```

Output:

```php
    name     | date_of_birth |   today    | age
-------------+---------------+------------+-----
 Bob Johnson | 1998-11-10    | 2024-01-26 |  25
 Jane Smith  | 1995-08-22    | 2024-01-26 |  28
 John Doe    | 1992-05-15    | 2024-01-26 |  31
(3 rows)
```

### 4\) Using the PostgreSQL CURRENT_DATE function as the default value of a column

In practice, you often use the `CURRENT_DATE` function as a default value of a column. For example:

First, [create a table](../postgresql-tutorial/postgresql-create-table) called `delivery`:

```
CREATE TABLE delivery(
  delivery_id SERIAL PRIMARY KEY,
  product VARCHAR(255) NOT NULL,
  delivery_date DATE DEFAULT CURRENT_DATE
);
```

In the `delivery` table, the `delivery_date`is set with the default value generated by the `CURRENT_DATE` function.

Second, [insert a new row](../postgresql-tutorial/postgresql-insert) into the `delivery` table:

```
INSERT INTO delivery(product)
VALUES
  ('Sample screen protector');
```

In this `INSERT` statement, we do not specify the delivery date. Therefore, PostgreSQL uses the current date as the default value.

Third, verify the insert:

```
SELECT * FROM delivery;
```

Output:

```
 delivery_id |         product         | delivery_date
-------------+-------------------------+---------------
           1 | Sample screen protector | 2024-01-26
(1 row)
```

The output indicates that the statement inserted the current date into the `delivery_date` column.

Note that you will see a different value in the `delivery_date` column, depending on when you execute the query.

## Summary

- Use the PostgreSQL `CURRENT_DATE` function to retrieve the current date.


# CURRENT_TIME

---
title: 'PostgreSQL CURRENT_TIME Function'
page_title: 'PostgreSQL CURRENT_TIME Function By Examples'
page_description: 'This tutorial shows you how to use the PostgreSQL CURRENT_TIME function to get the current time of the database server.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-current_time/'
ogImage: ''
updatedOn: '2024-01-26T09:41:35+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CURRENT_DATE Function'
  slug: 'postgresql-date-functions/postgresql-current_date'
nextLink:
  title: 'PostgreSQL CURRENT_TIMESTAMP Function'
  slug: 'postgresql-date-functions/postgresql-current_timestamp'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `CURRENT_TIME` function to get the current time with the timezone.

## Introduction to the PostgreSQL CURRENT_TIME function

The following illustrates the syntax of the `CURRENT_TIME` function:

```phpsqlsql
CURRENT_TIME(precision)
```

The `CURRENT_TIME` function accepts one optional argument `precision`.

The `precision` specifies the returned fractional seconds precision. If you omit the `precision` argument, the result will include the full available precision.

The `CURRENT_TIME` function returns a [`TIME WITH TIME ZONE`](../postgresql-tutorial/postgresql-time) value that represents the current time with the timezone.

## PostgreSQL CURRENT_TIME function examples

Let’s explore some examples of using the `CURRENT_TIME` function.

### 1\) Basic PostgreSQL CURRENT_TIME function example

The following example uses the CURRENT_TIME function to get the current time with the timezone:

```
SELECT CURRENT_TIME;
```

The output is a `TIME WITH TIME ZONE` value as follows:

```
    current_time
--------------------
 14:42:10.884946-07
(1 row)

```

In this example, we don’t specify the precision argument. Therefore, the result includes the full precision available.

### 2\) Using the PostgreSQL CURRENT_TIME function with a precision example

The following example shows how to use the `CURRENT_TIME` function with the precision set to 2:

```sql
SELECT CURRENT_TIME(2);
```

Output:

```text
  current_time
----------------
 14:44:35.03-07
(1 row)
```

### 3\) Using the CURRENT_TIME function as the default value of a column

The `CURRENT_TIME` function can be used as the default value of `TIME` columns. For example:

First, [create a table](../postgresql-tutorial/postgresql-create-table) called `log`:

```
CREATE TABLE log (
    id SERIAL PRIMARY KEY,
    message VARCHAR(255) NOT NULL,
    created_at TIME DEFAULT CURRENT_TIME,
    created_on DATE DEFAULT CURRENT_DATE
);
```

The `log` table has the `created_at` column with the default value is the result of the `CURRENT_TIME` function.

Second, [insert a row](../postgresql-tutorial/postgresql-insert) into the `log` table:

```
INSERT INTO log( message )
VALUES('Testing the CURRENT_TIME function');
```

In the statement, we only specify a value for the `message` column. Therefore, other columns will take the default values.

Third, check whether the row was inserted into the `log` table with the `created_at` column populated correctly by using the following [query](../postgresql-tutorial/postgresql-select):

```sql
SELECT * FROM log;
```

The following picture shows the result:

```
 id |              message              |   created_at    | created_on
----+-----------------------------------+-----------------+------------
  1 | Testing the CURRENT_TIME function | 14:46:28.188809 | 2024-01-26
(1 row)
```

The output indicates that the `created_at` column is populated with the time at which the `INSERT` statement executed.

## Summary

- Use the PostgreSQL `CURRENT_TIME` function to get the current time with the default timezone.


# CURRENT_TIMESTAMP

---
title: 'PostgreSQL CURRENT_TIMESTAMP Function'
page_title: 'PostgreSQL CURRENT_TIMESTAMP Function'
page_description: 'This tutorial shows you how to use PostgreSQL CURRENT_TIMESTAMP() function to get the current date and time at which the transaction starts.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-current_timestamp/'
ogImage: ''
updatedOn: '2024-01-26T08:56:17+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CURRENT_TIME Function'
  slug: 'postgresql-date-functions/postgresql-current_time'
nextLink:
  title: 'PostgreSQL CLOCK_TIMESTAMP() Function'
  slug: 'postgresql-date-functions/postgresql-clock_timestamp'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `CURRENT_TIMESTAMP()` function to get the current date and time with the timezone.

## Introduction to PostgreSQL CURRENT_TIMESTAMP() function

The `CURRENT_TIMESTAMP` function returns the current date and time with the timezone.

Here’s the basic syntax of the PostgreSQL `CURRENT_TIMESTAMP()` function:

```sqlsql
CURRENT_TIMESTAMP(precision)
```

The PostgreSQL `CURRENT_TIMESTAMP()` function accepts one optional argument:

- `precision`: specifies the number of digits in the fractional seconds precision in the second field of the result.

If you omit the `precision` argument, the `CURRENT_TIMESTAMP()` function will return a `TIMESTAMP` with a timezone that includes the full fractional seconds precision available.

The `CURRENT_TIMESTAMP()` function returns a [`TIMESTAMP WITH TIME ZONE`](../postgresql-tutorial/postgresql-timestamp) representing the date and time at which the transaction started.

## PostgreSQL CURRENT_TIMESTAMP function examples

Let’s explore some examples of using the `CURRENT_TIMESTAMP` function.

### 1\) Basic CURRENT_TIMESTAMP function example

The following example shows how to use the `CURRENT_TIMESTAMP()` function to get the current date and time:

```sql
SELECT CURRENT_TIMESTAMP;
```

The result is:

```text
              now
-------------------------------
 2017-08-15 21:05:15.723336-07
(1 row)
```

Internally, the `CURRENT_TIMESTAMP()` is implemented with the [`NOW()`](postgresql-now) function, therefore, the column alias is `NOW`.

Like the `NOW()` function, the `CURRENT_TIMESTAMP()` function can be used as the default value of a timestamp column.

### 2\) Using the PostgreSQL CURRENT_TIMESTAMP function as the default value of a column

First, [create a table](../postgresql-tutorial/postgresql-create-table) called `note`:

```sql
CREATE TABLE note (
    id SERIAL PRIMARY KEY,
    message VARCHAR(255) NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

The default value of the `created_at` column is provided by the result of the `CURRENT_TIMESTAMP()` function.

Second, [insert a new row](../postgresql-tutorial/postgresql-insert) into the `note` table:

```sql
INSERT INTO note(message)
VALUES('Testing current_timestamp function');
```

In this statement, we don’t specify the value of the `created_at` column. Therefore, it takes the result of the `CURRENT_TIMESTAMP` at which the transaction started.

Third, verify the insert:

```sql
SELECT * FROM note;
```

The following picture illustrates the result:

```
 id |              message               |          created_at
----+------------------------------------+-------------------------------
  1 | Testing current_timestamp function | 2024-01-26 15:47:44.199212-07
(1 row)
```

The output indicates that the `created_at` column is populated by the date and time at which the statement was executed.

In PostgreSQL, the `TRANSACTION_TIMESTAMP()` function is synonymous with the `CURRENT_TIMESTAMP` function. However, the name of the function `TRANSACTION_TIMESTAMP` more explicitly conveys the meaning of the return value.

## Summary

- Use the PostgreSQL `CURRENT_TIMESTAMP()` to get the date and time at which the transaction starts.


# CLOCK_TIMESTAMP

---
title: 'PostgreSQL CLOCK_TIMESTAMP() Function'
page_title: 'PostgreSQL CLOCK_TIMESTAMP() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL CLOCK_TIMESTAMP() function to return the current date and time.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-clock_timestamp/'
ogImage: ''
updatedOn: '2024-03-20T09:24:37+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CURRENT_TIMESTAMP Function'
  slug: 'postgresql-date-functions/postgresql-current_timestamp'
nextLink:
  title: 'PostgreSQL STATEMENT_TIMESTAMP() Function'
  slug: 'postgresql-date-functions/postgresql-statement_timestamp'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `CLOCK_TIMESTAMP()` function to return the current date and time.

## Introduction to the PostgreSQL CLOCK_TIMESTAMP() function

The `CLOCK_TIMESTAMP()` function returns the current date and time with a timezone.

Here’s the basic syntax of the `CLOCK_TIMESTAMP()` function:

```sql
CLOCK_TIMESTAMP()
```

The `CLOCK_TIMESTAMP()` function has no parameters.

The `CLOCK_TIMESTAMP()` function returns the current date and time as a [timestamp with a timezone](postgresql-current_timestamp).

When you call the `CLOCK_TIMESTAMP()` function multiple times within a statement, you’ll get different results.

## PostgreSQL CLOCK_TIMESTAMP() function examples

Let’s take some examples of using the `CLOCK_TIMESTAMP()` function.

### 1\) Basic CLOCK_TIMESTAMP() function example

The following example uses the `CLOCK_TIMESTAMP()` function to obtain the current date and time:

```sql
SELECT CLOCK_TIMESTAMP();
```

Output:

```text
        clock_timestamp
-------------------------------
 2024-03-20 14:49:07.875891-07
(1 row)
```

The result is a timestamp with a time zone.

### 2\) Calling CLOCK_TIMESTAMP() function multiple times within a statement

The following example calls the `CLOCK_TIMESTAMP()` function multiple times within a statement:

```sql
SELECT
  clock_timestamp(),
  pg_sleep(3),
  clock_timestamp(),
  pg_sleep(3),
  clock_timestamp();
```

Output:

```sql
-[ RECORD 1 ]---+------------------------------
clock_timestamp | 2024-03-20 14:51:21.92144-07
pg_sleep        |
clock_timestamp | 2024-03-20 14:51:24.924244-07
pg_sleep        |
clock_timestamp | 2024-03-20 14:51:27.931263-07
```

The output shows that the `CLOCK_TIMESTAMP()` function returns the actual date and time between the calls within the same statement.

### 3\) Using the CLOCK_TIMESTAMP() function to measure the execution time of a statement

First, [define a new function](../postgresql-plpgsql/postgresql-create-function) called `time_it` to measure the execution time of a statement:

```sql
CREATE OR REPLACE FUNCTION time_it(
    p_statement TEXT
) RETURNS NUMERIC AS $$
DECLARE
    start_time TIMESTAMP WITH TIME ZONE;
    end_time TIMESTAMP WITH TIME ZONE;
    execution_time NUMERIC; -- ms
BEGIN
    -- Capture start time
    start_time := CLOCK_TIMESTAMP();

    -- Execute the statement
    EXECUTE p_statement;

    -- Capture end time
    end_time := CLOCK_TIMESTAMP();

    -- Calculate execution time in milliseconds
    execution_time := EXTRACT(EPOCH FROM end_time - start_time) * 1000;

    RETURN execution_time;
END;
$$ LANGUAGE plpgsql;
```

Second, use the `time_it()` function to measure the execution time of the statement that uses the `pg_sleep()` function:

```sql
SELECT time_it('SELECT pg_sleep(1)');
```

Output:

```text
   time_it
-------------
 1007.731000
```

It takes about 1008 ms or 1s to complete.

## Summary

- Use the `CLOCK_TIMESTAMP()` function to return the current date and time.


# STATEMENT_TIMESTAMP

---
title: 'PostgreSQL STATEMENT_TIMESTAMP() Function'
page_title: 'PostgreSQL statement_timestamp() Function'
page_description: 'How to use the PostgreSQL statement_timestamp() function to retrieve the start time of the current statement.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-statement_timestamp/'
ogImage: ''
updatedOn: '2024-03-21T04:12:51+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CLOCK_TIMESTAMP() Function'
  slug: 'postgresql-date-functions/postgresql-clock_timestamp'
nextLink:
  title: 'PostgreSQL NOW() Function'
  slug: 'postgresql-date-functions/postgresql-now'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `STATEMENT_TIMESTAMP()` function to retrieve the start time of the current statement.

## Introduction to the PostgreSQL STATEMENT_TIMESTAMP() function

The `STATEMENT_TIMESTAMP()` function returns the start time of the current statement.

Here’s the syntax of the `STATEMENT_TIMESTAMP()` function:

```sql
STATEMENT_TIMESTAMP()
```

The `STATEMENT_TIMESTAMP()` function doesn’t accept any argument. It returns a value of the type `TIMESTAMP WITH TIME ZONE`, representing a [timestamp](../postgresql-tutorial/postgresql-timestamp) at the start of the current statement.

## PostgreSQL STATEMENT_TIMESTAMP() function examples

Let’s take some examples of using the `STATEMENT_TIMESTAMP()` function.

### 1\) Basic statement_timestamp() function example

The following statement uses the `STATEMENT_TIMESTAMP()` function to retrieve the start time of the current statement:

```sql
SELECT STATEMENT_TIMESTAMP();
```

Output:

```text
      statement_timestamp
-------------------------------
 2024-03-20 11:30:47.001021-07
(1 row)
```

The output indicates that the `STATEMENT_TIMESTAMP()` function returns a timestamp with a time zone of the start time when the statement is executed.

### 2\) Using the statement_timestamp() within a transaction

The following example calls the `STATEMENT_TIMESTAMP()` function within a transaction multiple times and log the result into a table:

```sql
-- create a new table for logging
CREATE TABLE logs(
   id SERIAL PRIMARY KEY,
   started_at TIMESTAMP WITH TIME ZONE
);

-- start a transaction
BEGIN;

INSERT INTO logs(started_at) VALUES(statement_timestamp());
SELECT pg_sleep(3);

INSERT INTO logs(started_at) VALUES(statement_timestamp());
SELECT pg_sleep(3);

INSERT INTO logs(started_at) VALUES(statement_timestamp());
END;

-- retrieve data from the logs table
SELECT * FROM logs;
```

Output:

```text
 id |          started_at
----+-------------------------------
  1 | 2024-03-20 13:22:13.056783+07
  2 | 2024-03-20 13:22:16.228492+07
  3 | 2024-03-20 13:22:19.390211+07
(3 rows)
```

In this example, we use the `pg_sleep()` function to delay the execution of each [INSERT](../postgresql-tutorial/postgresql-insert) statement.

Since we invoke the `STATEMENT_TIMESTAMP()` function in its own SQL statement, it returns a timestamp differently with each call.

Notice that the `STATEMENT_TIMESTAMP()` function is unlike the `TRANSACTION_TIMESTAMP()` function which does not change with each statement. The `TRANSACTION_TIMESTAMP()` will return the same start time of the transaction.

### 3\) Call the statement_timestamp() function multiple times within a statement

The following example calls the `STATEMENT_TIMESTAMP()` function multiple times within a single statement:

```sql
SELECT
  statement_timestamp(),
  pg_sleep(3),
  statement_timestamp(),
  pg_sleep(3),
  statement_timestamp();
```

Output:

```sql
-[ RECORD 1 ]-------+------------------------------
statement_timestamp | 2024-03-20 13:52:55.861004-07
pg_sleep            |
statement_timestamp | 2024-03-20 13:52:55.861004-07
pg_sleep            |
statement_timestamp | 2024-03-20 13:52:55.861004-07
```

Note that to display vertical results in psql, you execute the \\x command first.

In this example, the `STATEMENT_TIMESTAMP()` function returns the same values for all three calls, even though we call the `pg_sleep()` to delay execution between each call.

It is important to notice that this behavior contrasts with the [`CLOCK_TIMESTAMP()`](postgresql-clock_timestamp) function, which continues to change as it progresses through the statement.

## Summary

- Use the `STATEMENT_TIMESTAMP()` function to retrieve the start time of the current statement.


# NOW

---
title: 'PostgreSQL NOW() Function'
page_title: 'PostgreSQL NOW() Function: Getting the Current Date and Time'
page_description: 'This tutorial shows you how to use the PostgreSQL NOW() function to get the current date and time with the timezone.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-now/'
ogImage: ''
updatedOn: '2024-01-27T02:24:06+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL STATEMENT_TIMESTAMP() Function'
  slug: 'postgresql-date-functions/postgresql-statement_timestamp'
nextLink:
  title: 'PostgreSQL LOCALTIME Function'
  slug: 'postgresql-date-functions/postgresql-localtime'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `NOW()` function to get the current date and time with the time zone.

## Introduction to PostgreSQL NOW() function

The `NOW()` function returns the current date and time with the time zone of the database server.

Here’s the basic syntax of the `NOW()` function:

```csssql
NOW()
```

The `NOW()` function doesn’t require any argument. Its return type is the [timestamp with time zone](../postgresql-tutorial/postgresql-timestamp). For example:

```
SELECT NOW();
```

Output:

```
              now
-------------------------------
 2024-01-26 18:14:09.101641-08
(1 row)
```

Note that the `NOW()` function returns the current date and time based on the database server’s time zone setting.

For example, if you change the timezone to ‘Africa/Cairo’ and get the current date and time:

```sql
SET TIMEZONE='Africa/Cairo';
SELECT NOW();
```

Output:

```text
              now
-------------------------------
 2024-01-27 04:15:20.112974+02
(1 row)
```

The output indicates that the value returned by the `NOW()` function is adjusted to the new timezone.

Note that to get a complete list of time zones, you can query from the `pg_timezone_names`:

```sql
SELECT * FROM pg_timezone_names;
```

Partial output:

```
               name               | abbrev | utc_offset | is_dst
----------------------------------+--------+------------+--------
 Africa/Abidjan                   | GMT    | 00:00:00   | f
 Africa/Accra                     | GMT    | 00:00:00   | f
 Africa/Addis_Ababa               | EAT    | 03:00:00   | f
...
```

If you want to get the current date and time without a timezone, you can cast it explicitly as follows:

```
SELECT NOW()::timestamp;
```

Output:

```php
            now
----------------------------
 2017-03-17 18:37:29.229991
(1 row)

```

You can use the common date and time operators for the `NOW()` function. For example, to get 1 hour from now:

```text
        an_hour_later
------------------------------
 2024-01-27 05:16:17.15237+02
(1 row)
```

To get this time tomorrow, you add 1 day to the current time:

```sql
SELECT (NOW() + interval '1 day') AS this_time_tomorrow;
```

Output:

```php
      this_time_tomorrow
-------------------------------
 2024-01-28 04:16:28.308575+02
(1 row)

```

To get 2 hours 30 minutes ago, you use the minus (\-) operator as follows:

```sql
SELECT now() - interval '2 hours 30 minutes' AS two_hour_30_min_go;
```

Output:

```
      two_hour_30_min_go
-------------------------------
 2024-01-27 01:47:18.246763+02
(1 row)
```

## PostgreSQL NOW() related functions

Besides the `NOW()` function, you can use the `CURRENT_TIME` or `CURRENT_TIMESTAMP` to get the current date and time with the timezone:

```sql
SELECT CURRENT_TIME, CURRENT_TIMESTAMP;
```

Output:

```
    current_time    |       current_timestamp
--------------------+-------------------------------
 04:17:46.412062+02 | 2024-01-27 04:17:46.412062+02
(1 row)

```

To get the current date and time without a timezone, you use the `LOCALTIME` and `LOCALTIMESTAMP` functions.

```sql
SELECT LOCALTIME, LOCALTIMESTAMP;
```

Output:

```
      time       |         timestamp
-----------------+----------------------------
 19:13:41.423371 | 2017-03-17 19:13:41.423371
(1 row)
```

Notice that `NOW()` and its related functions return the start time of the current transaction. In other words, the return values of the function calls are the same within a transaction.

The following example illustrates the concept:

```sql
postgres=# BEGIN;
BEGIN
postgres=# SELECT now();
              now
-------------------------------
 2017-03-17 19:21:43.049715-07
(1 row)


postgres=# SELECT pg_sleep(3);
 pg_sleep
----------

(1 row)


postgres=# SELECT now();
              now
-------------------------------
 2017-03-17 19:21:43.049715-07
(1 row)


postgres=# COMMIT;
COMMIT

```

In this example, we called the `NOW()` function within a transaction and its return values do not change through the transaction.

Note that the `pg_sleep()` function pauses the current session’s process sleep for a specified of seconds.

If you want to get the current date and time that does advance during the transaction, you can use the `TIMEOFDAY()` function. Consider the following example:

```sql
SELECT
    TIMEOFDAY(),
    pg_sleep(5),
    TIMEOFDAY();
```

Output:

```
              timeofday              | pg_sleep |              timeofday
-------------------------------------+----------+-------------------------------------
 Sat Jan 27 04:19:08.650831 2024 EET |          | Sat Jan 27 04:19:13.655833 2024 EET
(1 row)
```

After pausing 5 seconds, the current date and time increased.

## PostgreSQL NOW() function as default values

You can use the `NOW()` function as the default value for a column of a table. For example:

First, [create a new table](../postgresql-tutorial/postgresql-create-table) named posts with the `created_at` column that has a default value provided by the `NOW()` function:

```sql
CREATE TABLE posts (
     id         SERIAL PRIMARY KEY,
     title      VARCHAR NOT NULL,
     created_at TIMESTAMPTZ DEFAULT Now()
);

```

Second, [insert a new row](../postgresql-tutorial/postgresql-insert) into the `posts` table:

```sql
INSERT INTO posts (title)
VALUES     ('PostgreSQL NOW function');
```

Third, [query data](../postgresql-tutorial/postgresql-select) from the `posts` table:

```sql
SELECT * FROM posts;
```

Output:

```
 id |          title          |          created_at
----+-------------------------+-------------------------------
  1 | PostgreSQL NOW function | 2024-01-27 04:20:11.286958+02
(1 row)
```

Even though we did not provide the value for the `created_at` column, the statement used the value returned by the `NOW()` function for that column.

## Summary

- Use the PostgreSQL `NOW()` function to get the current date and time with the timezone.


# LOCALTIME

---
title: 'PostgreSQL LOCALTIME Function'
page_title: 'PostgreSQL LOCALTIME Function'
page_description: 'You will learn how to use the PostgreSQL LOCALTIME function to return the current time at which the current transaction starts.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-localtime/'
ogImage: ''
updatedOn: '2024-01-26T09:40:37+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL NOW() Function'
  slug: 'postgresql-date-functions/postgresql-now'
nextLink:
  title: 'PostgreSQL LOCALTIMESTAMP Function'
  slug: 'postgresql-date-functions/postgresql-localtimestamp'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `LOCALTIME` function to return the current time at which the current transaction starts.

## Introduction to PostgreSQL LOCALTIME function

The `LOCALTIME()` function returns the current time at which the current transaction starts.

Here’s the basic syntax of the `LOCALTIME` function:

```css
LOCALTIME(precision)
```

The `LOCALTIME` function takes one optional argument:

**1\) `precision`**

The `precision` argument specifies fractional seconds precision of the second field.

If you omit the `precision` argument, it defaults to 6\.

The `LOCALTIME` function returns a [`TIME`](../postgresql-tutorial/postgresql-time) value that represents the time at which the current transaction starts.

Note that the `LOCATIME` function returns a `TIME` without time zone whereas the [`CURRENT_TIME`](postgresql-current_time) function returns a `TIME` with the timezone.

## PostgreSQL LOCALTIME function examples

Let’s take some examples of using the `LOCALTIME` function.

### 1\) Basic PostgreSQL LOCALTIME function example

The following example uses the `LOCALTIME` function to get the time of the current transaction:

```
SELECT LOCALTIME;
```

Output:

```
    localtime
-----------------
 16:37:59.950622
(1 row)

```

### 2\) Using the PostgreSQL LOCALTIME function with fractional seconds precision

The following example uses the `LOCALTIME(2)` function to get the time with a specified fractional seconds precision:

```css
SELECT LOCALTIME(2);
```

Output:

```
  localtime
-------------
 16:38:07.97
(1 row)
```

## Summary

- Use the PostgreSQL `LOCALTIME` function to get the time at which the current transaction starts.


# LOCALTIMESTAMP

---
title: 'PostgreSQL LOCALTIMESTAMP Function'
page_title: 'PostgreSQL LOCALTIMESTAMP Function By Examples'
page_description: 'This tutorial shows you how to use the PostgreSQL LOCALTIMESTAMP function to return the date and time at which the current transaction starts.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-localtimestamp/'
ogImage: ''
updatedOn: '2024-01-26T10:03:19+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL LOCALTIME Function'
  slug: 'postgresql-date-functions/postgresql-localtime'
nextLink:
  title: 'PostgreSQL DATE_PART() Function'
  slug: 'postgresql-date-functions/postgresql-date_part'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `LOCALTIMESTAMP` function to return the current date and time at which the current transaction starts.

## Introduction to PostgreSQL LOCALTIMESTAMP function

The following illustrates the syntax of the `LOCALTIMESTAMP` function:

```csssql
LOCALTIMESTAMP(precision)
```

The `LOCALTIMESTAMP` function accepts one argument:

**1\) `precision`**

The `precision` argument specifies fractional seconds precision of the second field.

The `precision` argument is optional. If you omit it, its default value is 6\.

The `LOCALTIMESTAMP` function returns a [`TIMESTAMP`](../postgresql-tutorial/postgresql-timestamp) value that represents the date and time at which the current transaction starts.

The `LOCALTIMESTAMP` function returns a `TIMESTAMP` value **without** time zone whereas the [`CURRENT_TIMESTAMP`](postgresql-current_timestamp) function returns a `TIMESTAMP` **with** the timezone.

## PostgreSQL LOCALTIMESTAMP function examples

Let’s explore some examples of using the `LOCALTIMESTAMP` function

### 1\) Basic PostgreSQL LOCALTIMESTAMP function example

The following example uses the `LOCALTIMESTAMP` function to get the current date and time of the transaction:

```
SELECT LOCALTIMESTAMP;
```

Output:

```
         timestamp
----------------------------
 2017-08-16 09:37:38.443431
(1 row)
```

### 2\) Using PostgreSQL LOCALTIMESTAMP function with a fractional seconds precision example

To get the timestamp of the current transaction with specific fractional seconds precision, you use the `precision` argument as follows:

```css
SELECT LOCALTIMESTAMP(2);
```

The result is:

```
       timestamp
------------------------
 2017-08-16 09:39:06.64
(1 row)
```

## Summary

- Use the PostgreSQL `LOCALTIMESTAMP` function to return the date and time at which the current transaction starts.


# Extracting Date & Time Parts

# DATE_PART

---
title: 'PostgreSQL DATE_PART() Function'
page_title: 'PostgreSQL DATE_PART() Function'
page_description: 'Learn how to the PostgreSQL DATE_PART function to extract subfields such as year, month, week, and so on from a timestamp.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-date_part/'
ogImage: ''
updatedOn: '2024-03-22T01:10:49+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL LOCALTIMESTAMP Function'
  slug: 'postgresql-date-functions/postgresql-localtimestamp'
nextLink:
  title: 'PostgreSQL EXTRACT() Function'
  slug: 'postgresql-date-functions/postgresql-extract'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `DATE_PART()` function to retrieve the subfields such as year, month, and week from a [date](../postgresql-tutorial/postgresql-date) or [time](../postgresql-tutorial/postgresql-time) value.

## Introduction to the PostgreSQL DATE_PART() function

The `DATE_PART()` function allows you to extract a subfield from a date or time value.

The following illustrates the basic syntax for the `DATE_PART()` function:

```sqlsql
DATE_PART(field, source)
```

The `DATE_PART()` function has two optional parameters `field` and `source`. The `field` is an identifier that determines what to extract from the `source`.

The values of the field must be one of the following permitted values:

- century
- decade
- year
- month
- day
- hour
- minute
- second
- microseconds
- milliseconds
- dow
- doy
- epoch
- isodow
- isoyear
- timezone
- timezone_hour
- timezone_minute

The `source` is a temporal expression that evaluates to [`TIMESTAMP`](../postgresql-tutorial/postgresql-timestamp), [`TIME`](../postgresql-tutorial/postgresql-time), or [`INTERVAL`](../postgresql-tutorial/postgresql-interval). If the `source` evaluates to `DATE`, the function will be cast to `TIMESTAMP`.

The `DATE_PART()` function returns a value whose type is double precision.

## PostgreSQL DATE_PART() function examples

Let’s explore some examples of using the `DATE_PART()` function.

### 1\) Basic PostgreSQL DATE_PART() function example

The following example uses the `DATE_PART()` function to extract the century from a timestamp:

```sql
SELECT date_part('century',TIMESTAMP '2017-01-01');
```

Output:

```text
 date_part
-----------
        21
(1 row)
```

### 2\) Extracting the year from a timestamp

To extract the year from the same timestamp, you pass the year to the `field` argument:

```sql
SELECT date_part('year',TIMESTAMP '2017-01-01');
```

Output:

```text
 date_part
-----------
      2017
(1 row)
```

### 3\) Extracting the quarter from a timestamp

The following example uses the `DATE_PART()` function to extract the quarter from a timestamp:

```
SELECT date_part('quarter',TIMESTAMP '2017-01-01');
```

Output:

```text
 date_part
-----------
         1
(1 row)
```

### 4\) Extracting month from a timestamp

The following example uses the `DATE_PART()` function to extract the month from a timestamp:

```
SELECT date_part('month',TIMESTAMP '2017-09-30');
```

Output:

```text
 date_part
-----------
         9
(1 row)
```

### 5\) Extracting a decade from a timestamp

The following example uses the `DATE_PART()` function to extract the decade from a timestamp:

```text
 SELECT date_part('decade',TIMESTAMP '2017-09-30');
```

Output:

```text
 date_part
-----------
       201
(1 row)
```

### 6\) Extracting a week number from a timestamp

To extract the week number from a time stamp, you pass the week as the first argument:

```
SELECT date_part('week',TIMESTAMP '2017-09-30');
```

Output:

```text
 date_part
-----------
        39
(1 row)
```

### 7\) Extracting a week number from a timestamp

To get the current millennium, you use the `DATE_PART()` function with the [`NOW()`](postgresql-now) function as follows:

```sql
SELECT date_part('millennium',now());
```

Output:

```text
 date_part
-----------
         3
(1 row)
```

### 8\) Extracting day from a timestamp

To extract the day part from a timestamp, you pass the `day` string to the `DATE_PART()` function:

```sql
SELECT date_part('day',TIMESTAMP '2017-03-18 10:20:30');
```

Output:

```text
 date_part
-----------
        18
(1 row)
```

### 9\) Extracting hour, minute, and second from a timestamp

To extract the hour, minute, and second, from a time stamp, you pass the corresponding value hour, minute, and second to the `DATE_PART()` function:

```
SELECT date_part('hour',TIMESTAMP '2017-03-18 10:20:30') h,
       date_part('minute',TIMESTAMP '2017-03-18 10:20:30') m,
       date_part('second',TIMESTAMP '2017-03-18 10:20:30') s;
```

Output:

```
 h  | m  | s
----+----+----
 10 | 20 | 30
(1 row)
```

### 10\) Extracting hour, minute, and second from a timestamp

To extract the day of the week and or day of the year from a time stamp, you use the `dow` and `doy` arguments:

```sql
SELECT date_part('dow',TIMESTAMP '2017-03-18 10:20:30') dow,
       date_part('doy',TIMESTAMP '2017-03-18 10:20:30') doy;
```

Output:

```
 dow | doy
-----+-----
   6 |  77
(1 row)
```

## Summary

- Use the PostgreSQL `DATE_PART()` function to extract a subfield of a timestamp.


# EXTRACT

---
title: 'PostgreSQL EXTRACT() Function'
page_title: 'PostgreSQL EXTRACT() Function'
page_description: 'This tutorial shows you how to use the PostgreSQL EXTRACT() function to extract a field from a date, a timestamp, or an interval value.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-extract/'
ogImage: ''
updatedOn: '2024-03-22T01:01:47+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL DATE_PART() Function'
  slug: 'postgresql-date-functions/postgresql-date_part'
nextLink:
  title: 'PostgreSQL TO_DATE() Function'
  slug: 'postgresql-date-functions/postgresql-to_date'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `EXTRACT()` function to extract a field such as a year, month, and day from a date/time value.

## Introduction to PostgreSQL EXTRACT() function

The `EXTRACT()` function extracts a field from a date/time value. Here’s the basic syntax of the `EXTRACT()` function:

```sql
EXTRACT(field FROM source)
```

The PostgreSQL `EXTRACT()` function requires two arguments:

**1\) `field`**

The field argument specifies which information you want to extract from the date/time value.

The following table illustrates the valid field values:

| Field Value     | TIMESTAMP                                                           | Interval                                    |
| --------------- | ------------------------------------------------------------------- | ------------------------------------------- |
| CENTURY         | The century                                                         | The number of centuries                     |
| DAY             | The day of the month (1\-31\)                                       | The number of days                          |
| DECADE          | The decade that is the year field divided by 10                     |                                             |
| DOW             | The day of the week (Sunday (0\), Monday (1\) … Saturday (6\)).     | N/A                                         |
| DOY             | The day of the year (1\-365/366\)                                   | N/A                                         |
| EPOCH           | The number of seconds since 1970\-01\-01 00:00:00 UTC               | The total number of seconds in the interval |
| HOUR            | The hour (0\-23\)                                                   | The number of hours                         |
| ISODOW          | The day of the week, Monday (1\) to Sunday (7\)                     | N/A                                         |
| ISOYEAR         | The ISO 8601 week number of year                                    | N/A                                         |
| MICROSECONDS    | The second field, including fractional parts, multiplied by 1000000 | Sames as TIMESTAMP                          |
| MILLENNIUM      | The millennium                                                      | The number of millennium                    |
| MILLISECONDS    | The second field, including fractional parts, multiplied by 1000    | Sames as TIMESTAMP                          |
| MINUTE          | The minute (0\-59\)                                                 | The number of minutes                       |
| MONTH           | The month 1\-12                                                     | The number of months, modulo (0\-11\)       |
| QUARTER         | The quarter of the year (1 – 4\)                                    | The number of quarters                      |
| SECOND          | The second field, including any fractional seconds                  | The number of seconds                       |
| TIMEZONE        | The timezone offset from UTC, measured in seconds                   | N/A                                         |
| TIMEZONE_HOUR   | The hour component of the time zone offset                          | N/A                                         |
| TIMEZONE_MINUTE | The minute component of the time zone offset                        | N/A                                         |
| WEEK            | The number of the ISO 8601 week\-numbering week of the year         | N/A                                         |
| YEAR            | The year                                                            | Sames as TIMESTAMP                          |

**2\)** `source`

The `source` is a value of type [`TIMESTAMP`](../postgresql-tutorial/postgresql-timestamp) or [`INTERVAL`](../postgresql-tutorial/postgresql-interval). If you pass a [`DATE`](../postgresql-tutorial/postgresql-date) value, the function will cast it to a `TIMESTAMP` value.

The `EXTRACT()` function returns a double precision value.

## PostgreSQL EXTRACT function examples

Let’s explore some examples of using the `EXTRACT()` function.

### 1\) Basic PostgreSQL EXTRACT() function examples

The following example uses the `EXTRACT()` function to extract the year from a timestamp:

```sql
SELECT EXTRACT(YEAR FROM TIMESTAMP '2016-12-31 13:30:15') y;
```

Output:

```text
  y
------
 2016
(1 row)

```

The following example uses the `EXTRACT()` function to extract the quarter from a timestamp:

```sql
SELECT EXTRACT(QUARTER FROM TIMESTAMP '2016-12-31 13:30:15') q;
```

Output:

```text
 q
---
 4
(1 row)
```

The following example uses the `EXTRACT()` function to extract the month from a timestamp:

```sql
SELECT EXTRACT(MONTH FROM TIMESTAMP '2016-12-31 13:30:15') m;
```

Output:

```text
 m
----
 12
(1 row)
```

The following example uses the `EXTRACT()` function to extract the day from a timestamp:

```sql
SELECT EXTRACT(DAY FROM TIMESTAMP '2016-12-31 13:30:15') d;
```

Output:

```text
 d
----
 31
(1 row)
```

The following example uses the `EXTRACT()` function to extract the century from a timestamp:

```
SELECT EXTRACT(CENTURY FROM TIMESTAMP '2016-12-31 13:30:15') century;
```

Output:

```text
 century
---------
      21
(1 row)
```

The following example uses the `EXTRACT()` function to extract the decade from a timestamp:

```sql
SELECT EXTRACT(DECADE FROM TIMESTAMP '2016-12-31 13:30:15') decade;
```

The following is the result:

```text
 decade
--------
    201
(1 row)

```

The following example uses the `EXTRACT()` function to extract the day of the week from a timestamp:

```sql
SELECT EXTRACT(DOW FROM TIMESTAMP '2016-12-31 13:30:15') day_of_week;
```

The result is:

```text
 day_of_week
-------------
           6
(1 row)
```

The following example uses the `EXTRACT()` function to extract the day of the year from a timestamp:

```sql
SELECT EXTRACT(DOY FROM TIMESTAMP '2016-12-31 13:30:15') day_of_year;
```

It returned 366:

```text
 day_of_year
-------------
         366
(1 row)
```

The following example uses the `EXTRACT()` function to extract the epoch from a timestamp:

```sql
SELECT EXTRACT(EPOCH FROM TIMESTAMP '2016-12-31 13:30:15') epoch;
```

The result is:

```text
       epoch
-------------------
 1483191015.000000
(1 row)
```

The following example uses the `EXTRACT()` function to extract the hour from a timestamp:

```sql
SELECT EXTRACT(HOUR FROM TIMESTAMP '2016-12-31 13:30:15') h;
```

Result:

```text
 h
----
 13
(1 row)
```

The following example uses the `EXTRACT()` function to extract the minute from a timestamp:

```sql
SELECT EXTRACT(MINUTE FROM TIMESTAMP '2016-12-31 13:30:15') min;
```

Here is the result:

```text
 min
-----
  30
(1 row)
```

The following example uses the `EXTRACT()` function to extract the second from a timestamp:

```sql
SELECT EXTRACT(SECOND FROM TIMESTAMP '2016-12-31 13:30:15') sec;
```

The result includes second and its fractional seconds:

```text
    sec
-----------
 15.000000
(1 row)
```

The following example uses the `EXTRACT()` function to extract the weekday according to ISO 8601:

```sql
SELECT EXTRACT(ISODOW FROM TIMESTAMP '2016-12-31 13:30:15') weekday_iso;
```

Output:

```text
 weekday_iso
-------------
           6
(1 row)
```

The following example uses the `EXTRACT()` function to extract the millisecond from a timestamp:

```
SELECT EXTRACT(MILLISECONDS FROM TIMESTAMP '2016-12-31 13:30:15') ms;
```

The result is 15 \* 1000 \= 15000

```text
    ms
-----------
 15000.000
(1 row)
```

The following example uses the `EXTRACT()` function to extract the microseconds from a timestamp:

```sql
SELECT EXTRACT(MICROSECONDS FROM TIMESTAMP '2016-12-31 13:30:15') microsec;
```

The result is 15 \* 1000000 \= 15000000

```text
 microsec
----------
 15000000
(1 row)
```

### 2\) Extracting from an interval examples

The following example uses the `EXTRACT()` function to extract the year from an interval:

```sql
SELECT
  EXTRACT(
    YEAR
    FROM
      INTERVAL '6 years 5 months 4 days 3 hours 2 minutes 1 second'
  ) y;
```

Result:

```text
 y
---
 6
(1 row)
```

The following example uses the `EXTRACT()` function to extract the quarter from an interval:

```sql
SELECT
  EXTRACT(
    QUARTER
    FROM
      INTERVAL '6 years 5 months 4 days 3 hours 2 minutes 1 second'
  );
```

Result:

```sql
2
```

The following example uses the `EXTRACT()` function to extract the month from an interval:

```sql
SELECT
  EXTRACT(
    MONTH
    FROM
      INTERVAL '6 years 5 months 4 days 3 hours 2 minutes 1 second'
  );
```

Result:

```sql
5
```

The following example uses the `EXTRACT()` function to extract the day from an interval:

```sql
SELECT
  EXTRACT(
    DAY
    FROM
      INTERVAL '6 years 5 months 4 days 3 hours 2 minutes 1 second'
  );
```

Result:

```sql
4
```

The following example uses the `EXTRACT()` function to extract the hour from an interval:

```sql
SELECT
  EXTRACT(
    HOUR
    FROM
      INTERVAL '6 years 5 months 4 days 3 hours 2 minutes 1 second'
  );
```

Result:

```sql
3
```

The following example uses the `EXTRACT()` function to extract the minute from an interval:

```sql
SELECT
  EXTRACT(
    MINUTE
    FROM
      INTERVAL '6 years 5 months 4 days 3 hours 2 minutes 1 second'
  );
```

Result:

```sql
2
```

The following example uses the `EXTRACT()` function to extract the second from an interval:

```sql
SELECT
  EXTRACT(
    SECOND
    FROM
      INTERVAL '6 years 5 months 4 days 3 hours 2 minutes 1 second'
  );
```

Result:

```sql
1
```

The following example uses the `EXTRACT()` function to extract the millisecond from an interval:

```sql
SELECT
  EXTRACT(
    MILLISECONDS
    FROM
      INTERVAL '6 years 5 months 4 days 3 hours 2 minutes 1 second'
  );
```

Result:

```sql
1000
```

The following example uses the `EXTRACT()` function to extract the microsecond from an interval:

```sql
SELECT
  EXTRACT(
    MICROSECONDS
    FROM
      INTERVAL '6 years 5 months 4 days 3 hours 2 minutes 1 second'
  );
```

Result:

```sql
1000000
```

The following example uses the `EXTRACT()` function to extract the decade from an interval:

```sql
SELECT
  EXTRACT(
    DECADE
    FROM
      INTERVAL '60 years 5 months 4 days 3 hours 2 minutes 1 second'
  );

```

Result:

```sql
60
```

The following example uses the `EXTRACT()` function to extract the millennium from an interval:

```sql
SELECT
  EXTRACT(
    MILLENNIUM
    FROM
      INTERVAL '1999 years 5 months 4 days 3 hours 2 minutes 1 second'
  );

```

Result:

```sql
1
```

The following example uses the `EXTRACT()` function to extract the century from an interval:

```sql
SELECT
  EXTRACT(
    CENTURY
    FROM
      INTERVAL '1999 years 5 months 4 days 3 hours 2 minutes 1 second'
  );
```

Result:

```sql
19
```

## Summary

- Use the PostgreSQL `EXTRACT()` function to extract a field from a date/time or interval value.


# Converting to Date & Time

# TO_DATE

---
title: 'PostgreSQL TO_DATE() Function'
page_title: 'PostgreSQL TO_DATE() Function: Convert String to Date'
page_description: 'This tutorial shows you how to use the PostgreSQL to_date function to convert a string literal to a date value based on a specified pattern.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-to_date/'
ogImage: ''
updatedOn: '2024-03-22T01:30:01+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL EXTRACT() Function'
  slug: 'postgresql-date-functions/postgresql-extract'
nextLink:
  title: 'PostgreSQL TO_TIMESTAMP Function'
  slug: 'postgresql-date-functions/postgresql-to_timestamp'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `TO_DATE()` function to convert a string to a date.

## Introduction to the PostgreSQL TO_DATE() function

The `TO_DATE()` function converts a [string](../postgresql-tutorial/postgresql-char-varchar-text) literal to a [date](../postgresql-tutorial/postgresql-date) value.

Here’s the basic syntax of the `TO_DATE()` function:

```phpsql
TO_DATE(text,format);
```

The `TO_DATE()` function accepts two string arguments.

- `text`: is an input string that you want to convert to a date.
- `format`: specifies the format of the input string.

The `TO_DATE()` function returns a `DATE` value.

See the following example:

```sql
SELECT TO_DATE('20170103','YYYYMMDD');
```

Output:

```text
  TO_DATE
------------
 2017-01-03
```

In this example, the string `20170103` is converted into a date based on the input format `YYYYMMDD`.

- `YYYY`: year in four digits format.
- `MM`: month in two digits format.
- `DD`: day in two digits format.

As a result, the function returns `January 3rd 2017`.

The following table illustrates the template patterns for formatting date values:

| **Pattern**             | **Description**                                                                                     |
| ----------------------- | --------------------------------------------------------------------------------------------------- |
| Y,YYY                   | year in 4 digits with comma                                                                         |
| YYYY                    | year in 4 digits                                                                                    |
| YYY                     | last 2 digits of the year                                                                           |
| YY                      | The last digit of the year                                                                          |
| Y                       | The last 3 digits of ISO 8601 week\-numbering year                                                  |
| IYYY                    | ISO 8601 week\-numbering year (4 or more digits)                                                    |
| IYY                     | The last 2 digits of ISO 8601 week\-numbering year                                                  |
| IY                      | The last digit of ISO 8601 week\-numbering year                                                     |
| I                       | Abbreviated capitalized month name e.g., Jan, Feb,  etc.                                            |
| BC, bc, AD or ad        | Era indicator without periods                                                                       |
| B.C., b.c., A.D. ora.d. | Era indicator with periods                                                                          |
| MONTH                   | English month name in uppercase                                                                     |
| Month                   | Full capitalized English month name                                                                 |
| month                   | Full lowercase English month name                                                                   |
| MON                     | Abbreviated uppercase month name e.g., JAN, FEB, etc.                                               |
| Mon                     | Week number of the year (1\-53\) (the first week starts on the first day of the year)               |
| mon                     | Abbreviated lowercase month name e.g., Jan, Feb, etc.                                               |
| MM                      | month number from 01 to 12                                                                          |
| DAY                     | Full uppercase day name                                                                             |
| Day                     | Full capitalized day name                                                                           |
| day                     | Full lowercase day name                                                                             |
| DY                      | Abbreviated uppercase day name                                                                      |
| Dy                      | Abbreviated capitalized day name                                                                    |
| dy                      | Abbreviated lowercase day name                                                                      |
| DDD                     | Day of year (001\-366\)                                                                             |
| IDDD                    | Day of ISO 8601 week\-numbering year (001\-371; day 1 of the year is Monday of the first ISO week)  |
| DD                      | Day of month (01\-31\)                                                                              |
| D                       | Day of the week, Sunday (1\) to Saturday (7\)                                                       |
| ID                      | ISO 8601 day of the week, Monday (1\) to Sunday (7\)                                                |
| W                       | Week of month (1\-5\) (the first week starts on the first day of the month)                         |
| WW                      | Century e.g., 21, 22, etc.                                                                          |
| IW                      | Week number of ISO 8601 week\-numbering year (01\-53; the first Thursday of the year is in week 1\) |
| CC                      | Century e.g, 21, 22, etc.                                                                           |
| J                       | Julian Day (integer days since November 24, 4714 BC at midnight UTC)                                |
| RM                      | Month in uppercase Roman numerals (I\-XII; I\=January)                                              |
| rm                      | Month in lowercase Roman numerals (i\-xii; i\=January)                                              |

## PostgreSQL TO_DATE function examples

The following statement converts the string `10 Feb 2017` into a date value:

```sql
SELECT TO_DATE('10 Feb 2017', 'DD Mon YYYY');
```

The output is:

```text
  TO_DATE
------------
 2017-02-10
(1 row)
```

Suppose you want to convert the string `2017 Feb 10` to a date value, you can apply the pattern `YYYY Mon DD` as follows:

```sql
SELECT TO_DATE('2017 Feb 20','YYYY Mon DD');
```

The function returns the following output:

```text
  TO_DATE
------------
 2017-02-20
(1 row)
```

## PostgreSQL TO_DATE() function gotchas

If you pass an invalid date string, the `TO_DATE()` function will try to convert it to a valid date and issue an error if it cannot. For example:

```sql
SELECT TO_DATE('2017/02/30', 'YYYY/MM/DD');
```

PostgreSQL issued the following error:

```
ERROR:  date/time field value out of range: "2017/02/30"
LINE 1: SELECT '2017/02/30'::date;
```

## Summary

- Use the PostgreSQL `TO_DATE()` function to convert a string literal to a date value.


# TO_TIMESTAMP

---
title: 'PostgreSQL TO_TIMESTAMP Function'
page_title: 'PostgreSQL TO_TIMESTAMP() Function By Practical Examples'
page_description: 'This tutorial shows you how to use the PostgreSQL TO_TIMESTAMP() function to convert a string to a timestamp'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-to_timestamp/'
ogImage: ''
updatedOn: '2024-02-12T11:37:48+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL TO_DATE() Function'
  slug: 'postgresql-date-functions/postgresql-to_date'
nextLink:
  title: 'PostgreSQL MAKE_DATE() Function'
  slug: 'postgresql-date-functions/postgresql-make_date'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `TO_TIMESTAMP()` function to convert a string to a timestamp based on a specified format

The PostgreSQL `TO_TIMESTAMP()` function converts a string to a [timestamp](../postgresql-tutorial/postgresql-timestamp) according to the specified format.

## Syntax

The following illustrates the syntax of `TO_TIMESTAMP()` function:

```csssqlsql
TO_TIMESTAMP(timestamp, format)
```

## Arguments

The `TO_TIMESTAMP()` function requires two arguments:

**1\) `timestamp`**

The `timestamp` is a string that represents a timestamp value in the format specified by `format`.

**2\) `format`**

The format for `timestamp` argument.

To construct `format` strings, you use the following template patterns for formatting date and time values.

| **Pattern**              | **Description**                                                                                     |
| ------------------------ | --------------------------------------------------------------------------------------------------- |
| Y,YYY                    | year in 4 digits with comma                                                                         |
| YYYY                     | year in 4 digits                                                                                    |
| YYY                      | last 3 digits of the year                                                                           |
| YY                       | last 2 digits of the year                                                                           |
| Y                        | The last digit of the year                                                                          |
| IYYY                     | ISO 8601 week\-numbering year (4 or more digits)                                                    |
| IYY                      | The last 3 digits of ISO 8601 week\-numbering year                                                  |
| IY                       | The last 2 digits of ISO 8601 week\-numbering year                                                  |
| I                        | The last digit of ISO 8601 week\-numbering year                                                     |
| BC, bc, AD or ad         | Abbreviated capitalized month name e.g., Jan, Feb,  etc.                                            |
| B.C., b.c., A.D. ora.d.  | Era indicator with periods                                                                          |
| MONTH                    | English month name in uppercase                                                                     |
| Month                    | Full capitalized English month name                                                                 |
| month                    | Full lowercase English month name                                                                   |
| MON                      | Abbreviated uppercase month name e.g., JAN, FEB, etc.                                               |
| Mon                      | Abbreviated capitalized month name e.g, Jan, Feb,  etc.                                             |
| mon                      | Abbreviated lowercase month name e.g., jan, feb, etc.                                               |
| MM                       | month number from 01 to 12                                                                          |
| DAY                      | Full uppercase day name                                                                             |
| Day                      | Full capitalized day name                                                                           |
| day                      | Full lowercase day name                                                                             |
| DY                       | Abbreviated uppercase day name                                                                      |
| Dy                       | Abbreviated capitalized day name                                                                    |
| dy                       | Abbreviated lowercase day name                                                                      |
| DDD                      | Day of year (001\-366\)                                                                             |
| IDDD                     | Day of ISO 8601 week\-numbering year (001\-371; day 1 of the year is Monday of the first ISO week)  |
| DD                       | Day of month (01\-31\)                                                                              |
| D                        | Day of the week, Sunday (1\) to Saturday (7\)                                                       |
| ID                       | ISO 8601 day of the week, Monday (1\) to Sunday (7\)                                                |
| W                        | Week of month (1\-5\) (the first week starts on the first day of the month)                         |
| WW                       | Week number of the year (1\-53\) (the first week starts on the first day of the year)               |
| IW                       | Week number of ISO 8601 week\-numbering year (01\-53; the first Thursday of the year is in week 1\) |
| CC                       | Century e.g, 21, 22, etc.                                                                           |
| J                        | Julian Day (integer days since November 24, 4714 BC at midnight UTC)                                |
| RM                       | Month in upper case Roman numerals (I\-XII; \>                                                      |
| rm                       | Month in lowercase Roman numerals (i\-xii; \>                                                       |
| HH                       | Hour of day (0\-12\)                                                                                |
| HH12                     | Hour of day (0\-12\)                                                                                |
| HH24                     | Hour of day (0\-23\)                                                                                |
| MI                       | Minute (0\-59\)                                                                                     |
| SS                       | Second (0\-59\)                                                                                     |
| MS                       | Millisecond (000\-9999\)                                                                            |
| US                       | Microsecond (000000\-999999\)                                                                       |
| SSSS                     | Seconds past midnight (0\-86399\)                                                                   |
| AM, am, PM or pm         | Meridiem indicator (without periods)                                                                |
| A.M., a.m., P.M. or p.m. | Meridiem indicator (with periods)                                                                   |

## Return Value

The PostgreSQL `TO_TIMESTAMP()` function returns a timestamp with the time zone.

## Examples

The following statement uses the `TO_TIMESTAMP()` function to convert a string to a timestamp:

```
SELECT TO_TIMESTAMP(
    '2017-03-31 9:30:20',
    'YYYY-MM-DD HH:MI:SS'
);
```

Output:

```
      to_timestamp
------------------------
 2017-03-31 09:30:20-07
(1 row)
```

In this example:

- YYYY is the four\-digit year 2017
- MM is the month 03
- DD is the day 31
- HH is the hour 9
- MI is the minute 30
- SS is the second 20

## Remarks

1\) The `TO_TIMESTAMP()` function skips spaces in the input string unless the fixed format global option (`FX` prefix) is used.

This example uses multiple spaces in the input string:

```css
SELECT
    TO_TIMESTAMP('2017     Aug','YYYY MON');
```

The `TO_TIMESTAMP()` function just omits the spaces and returns the correct timestamp value:

```text
      to_timestamp
------------------------
 2017-08-01 00:00:00-07
(1 row)
```

However, the following example returns an error:

```shell
SELECT
    TO_TIMESTAMP('2017     Aug','FXYYYY MON');
```

Output:

```sql
ERROR:  invalid value "" for "MON"
DETAIL:  The given value did not match any of the allowed values for this field.
SQL state: 22007
```

Because the `FX` option instructs the `TO_TIMESTAMP()` to accept the input string with one space only.

2\) The `TO_TIMESTAMP()` function validates the input string with minimal error checking. It will try to convert the input string to a valid timestamp as much as possible that sometimes yields unexpected results.

The following example uses an invalid timestamp value:

```shell
SELECT
    TO_TIMESTAMP('2017-02-31 30:8:00', 'YYYY-MM-DD HH24:MI:SS');
```

It returns an error:

```sql
ERROR:  date/time field value out of range: "2017-02-31 30:8:00"
SQL state: 22008
```

3\) When converting a string to a timestamp, the `TO_TIMESTAMP()` function treats milliseconds or microseconds as seconds after the decimal point.

```css
SELECT
    TO_TIMESTAMP('01-01-2017 10:2', 'DD-MM-YYYY SS:MS');
```

The result is:

```sql
to_timestamp
--------------------------
 2017-01-01 00:00:10.2-07
```

In this example, 2 is not 2 milliseconds but 200\. It means that:

```shell
SELECT
        TO_TIMESTAMP('01-01-2017 10:2', 'DD-MM-YYYY SS:MS');
```

and

```sql
SELECT
        TO_TIMESTAMP('01-01-2017 10:200', 'DD-MM-YYYY SS:MS');
```

returns the same result.

```sql
2017-01-01 00:00:10.2-07
```

To get 2 milliseconds, you must use `01-01-2017 10:002`. In this case, `002` is interpreted as `0.002` seconds, equivalent to 2 milliseconds.

4\) If the year is less than four digits, the `TO_TIMESTAMP()` will adjust it to the nearest year e.g., 99 becomes 1999, 17 becomes 2017\.

```css
SELECT
    TO_TIMESTAMP('12 31 99 12:45', 'MM DD YY HH:MI');
```

Output:

```text
      to_timestamp
------------------------
 1999-12-31 00:45:00-07
(1 row)
```

Consider the following example:

```css
SELECT
      TO_TIMESTAMP('12 31 16 12:45', 'MM DD YY HH:MI');
```

The nearest year of 16 is 2016, therefore, it returns the following result:

```
to_timestamp
------------------------
 2016-12-31 00:45:00-07
```

In this tutorial, you have learned how to use the PostgreSQL `TO_TIMESTAMP()` function to convert a string to a timestamp.


# MAKE_DATE

---
title: 'PostgreSQL MAKE_DATE() Function'
page_title: 'PostgreSQL MAKE_DATE() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL MAKE_DATE() function to generate a date value from the year, month, and day.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-make_date/'
ogImage: ''
updatedOn: '2024-03-25T01:39:34+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL TO_TIMESTAMP Function'
  slug: 'postgresql-date-functions/postgresql-to_timestamp'
nextLink:
  title: 'PostgreSQL MAKE_TIME() Function'
  slug: 'postgresql-date-functions/postgresql-make_time'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `MAKE_DATE()` function to generate a date value from the year, month, and day.

## Introduction to PostgreSQL MAKE_DATE() function

The `MAKE_DATE()` function allows you to construct a [date](../postgresql-tutorial/postgresql-date) value from the specified year, month, and day values.

Here’s the syntax of the `MAKE_DATE()` function:

```sql
MAKE_DATE( year int, month int, day int ) → date
```

In this syntax, `year`, `month`, and `day` are the year, month, and day parts of the date. The negative year indicates BC.

The `MAKE_DATE()` function returns a value of the `DATE` type.

## PostgreSQL MAKE_DATE() function examples

Let’s explore some examples of using the `MAKE_DATE()` function.

### 1\) Basic PostgreSQL MAKE_DATE() function example

The following example uses the `MAKE_DATE()` function to generate the date `2024-03-25`:

```sql
SELECT MAKE_DATE(2023,3, 25);
```

Output:

```text
 make_date
------------
 2023-03-25
(1 row)
```

### 2\) Using the MAKE_DATE() function with leap years

The `MAKE_DATE()` function automatically handles the leap years for you. For example, you can create a date of `February 29th` in a leap year such as `2024` as follows:

```sql
SELECT MAKE_DATE(2024, 2, 29);
```

Output:

```text
 make_date
------------
 2024-02-29
(1 row)
```

### 3\) Using the MAKE_DATE() function to generate sequential dates

The following example uses the `MAKE_DATE()` function to generate a list of date values from `Jan 1, 2024` to `Jan 7, 2024`:

```sql
SELECT MAKE_DATE(2023, 1, day) dates
FROM generate_series(1, 7) AS day;
```

Output:

```text
   dates
------------
 2023-01-01
 2023-01-02
 2023-01-03
 2023-01-04
 2023-01-05
 2023-01-06
 2023-01-07
(7 rows)
```

## Summary

- Use the `MAKE_DATE()` function to generate a date value from the year, month, and day


# MAKE_TIME

---
title: 'PostgreSQL MAKE_TIME() Function'
page_title: 'PostgreSQL MAKE_TIME() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL MAKE_TIME() function to create a time value from hour, minute, and second values.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-make_time/'
ogImage: ''
updatedOn: '2024-03-25T02:56:31+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL MAKE_DATE() Function'
  slug: 'postgresql-date-functions/postgresql-make_date'
nextLink:
  title: 'PostgreSQL AGE() Function'
  slug: 'postgresql-date-functions/postgresql-age'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `MAKE_TIME()` function to create a time value from hour, minute, and second values.

## Introduction to the PostgreSQL MAKE_TIME() function

The `MAKE_TIME()` function allows you to create a [time](../postgresql-tutorial/postgresql-time) value from hour, minute, and second values.

Here’s the syntax of the `MAKE_TIME()` function:

```sql
MAKE_TIME ( hour int, min int, sec double precision ) → time
```

In this syntax:

- `hour`: The hour part of the time. The valid range for the hour is from 0 to 23\. 0 represents midnight (12:00 AM) and 24 represents noon.
- `min`: The minute part of the time. The valid range for the second is from 0 to 59\.
- `sec`: The second within a minute. Its valid range is from 0 to `59.999999`.

The `MAKE_TIME()` function returns a time value constructed from the hour, min, and sec.

If you use invalid values for hour, min, and sec, the function will issue an error.

## PostgreSQL MAKE_TIME() function examples

Let’s explore some examples of using the `MAKE_TIME()` function.

### 1\) Basic MAKE_TIME() function examples

The following example uses the `MAKE_TIME()` function to construct a time `22:30:45` from hour, minute, and second:

```sql
SELECT MAKE_TIME(22,30,45);
```

Output:

```text
 make_time
-----------
 22:30:45
(1 row)
```

The following example attempts to use invalid values for hour, minute, and second to construct a time and results in an error:

```sql
SELECT MAKE_TIME(25,30,45);
```

Error:

```sql
ERROR:  time field value out of range: 25:30:45
```

### 2\) Using the MAKE_TIME() function with string arguments

Even though the type of hour and minute parameters are integers and seconds are double precision, you can pass string arguments to the `MAKE_TIME()` function.

Behind the scenes, the function will implicitly convert these string arguments to the proper types, as long as the results of the conversions are in the valid range.

```sql
SELECT MAKE_TIME('8', '30', '59.999999');
```

Output:

```text
    make_time
-----------------
 08:30:59.999999
(1 row)
```

## Summary

- Use the `MAKE_TIME()` function to create a time value from hour, minute, and second values.


# Handling Intervals

# AGE

---
title: 'PostgreSQL AGE() Function'
page_title: 'PostgreSQL AGE() Function: Calculate Ages'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL AGE() function to calculate ages based on two timestamps.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-age/'
ogImage: '/postgresqltutorial/rental-table.png'
updatedOn: '2024-03-21T04:14:17+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL MAKE_TIME() Function'
  slug: 'postgresql-date-functions/postgresql-make_time'
nextLink:
  title: 'PostgreSQL JUSTIFY_DAYS() Function'
  slug: 'postgresql-date-functions/postgresql-justify_days'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `AGE()` function to calculate ages.

## Introduction to PostgreSQL AGE() function

In business applications, you often have to calculate ages such as the ages of employees, and years of service of employees. In PostgreSQL, you can use the `AGE()` function to accomplish these tasks.

Here’s the basic syntax of the `AGE()` function:

```shellsql
AGE(timestamp,timestamp);
```

The `AGE()` function accepts two [`TIMESTAMP`](../postgresql-tutorial/postgresql-timestamp) values. It subtracts the second argument from the first one and returns an [interval](../postgresql-tutorial/postgresql-interval) as a result.

For example:

```sql
SELECT AGE('2017-01-01','2011-06-24');
```

Output:

```text
   age
-----------------------
 5 years 6 mons 7 days
```

If you want to use the current date as the first argument, you can use the following form of the `AGE()` function:

```shell
AGE(timestamp);
```

For example, if someone’s birth date is `2000-01-01`, and the current date is `2024-01-26`, their age would be:

```sql
SELECT
  current_date,
  AGE(timestamp '2000-01-01');
```

Output:

```text
 current_date |       age
--------------+------------------
 2024-01-26   | 24 years 25 days
(1 row)
```

## PostgreSQL AGE() function example

We’ll use the following `rental` table in the [sample database](../postgresql-getting-started/postgresql-sample-database):

![PostgreSQL age Function: Rental Table Sample](/postgresqltutorial/rental-table.png)
The following example uses the `AGE()` function to retrieve the top 10 rentals that have the longest durations:

```
SELECT
  rental_id,
  customer_id,
  AGE(return_date, rental_date) AS duration
FROM
  rental
WHERE
  return_date IS NOT NULL
ORDER BY
  duration DESC
LIMIT
  10;
```

Output:

```text
 rental_id | customer_id |    duration
-----------+-------------+-----------------
      2412 |         127 | 9 days 05:59:00
     14678 |         383 | 9 days 05:59:00
     13947 |         218 | 9 days 05:58:00
     14468 |         224 | 9 days 05:58:00
      7874 |          86 | 9 days 05:58:00
     11629 |         299 | 9 days 05:58:00
      5738 |         187 | 9 days 05:56:00
      9938 |          63 | 9 days 05:56:00
     12159 |         106 | 9 days 05:55:00
      3873 |         394 | 9 days 05:55:00
(10 rows)

```

In this example, we use the `AGE()` function to calculate the rental duration based on the values of the `rental_date` and `return_date` columns.

## Summary

- Use the PostgreSQL `AGE()` function to calculate ages.


# JUSTIFY_DAYS

---
title: 'PostgreSQL JUSTIFY_DAYS() Function'
page_title: 'PostgreSQL JUSTIFY_DAYS() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL JUSTIFY_DAYS() function to adjust 30-day intervals as months.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-justify_days/'
ogImage: ''
updatedOn: '2024-03-21T03:38:28+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL AGE() Function'
  slug: 'postgresql-date-functions/postgresql-age'
nextLink:
  title: 'PostgreSQL JUSTIFY_HOURS() Function'
  slug: 'postgresql-date-functions/postgresql-justify_hours'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `JUSTIFY_DAYS()` function to adjust 30\-day intervals as months.

## Introduction to the PostgreSQL JUSTIFY_DAYS() function

The `JUSTIFY_DAYS()` function allows you to normalize an [interval](../postgresql-tutorial/postgresql-interval) by converting days exceeding 30 days into months and remaining days.

Here’s the basic syntax of the `JUSTIFY_DAYS()` function:

```sql
JUSTIFY_DAYS ( value) → interval
```

In this syntax:

- `value` is an interval value you want to justify.

The `JUSTIFY_DAYS()` function returns an adjusted interval with:

- Days exceeding 30 converted to months.
- The remaining days are kept as days.
- Hours, minutes, and seconds remain intact.

If the input interval (`value`) is `NULL`, the function returns `NULL`.

## PostgreSQL JUSTIFY_DAYS() function examples

Let’s explore some examples of using the PostgreSQL `JUSTIFY_DAYS()` function.

### 1\) Basic PostgreSQL JUSTIFY_DAYS() function example

The following statement uses the `JUSTIFY_DAYS()` function to adjust intervals that are multiples of 30 days:

```sql
SELECT JUSTIFY_DAYS(INTERVAL '30 days'),
       JUSTIFY_DAYS(INTERVAL '60 days'),
       JUSTIFY_DAYS(INTERVAL '90 days');
```

Output:

```text
 justify_days | justify_days | justify_days
--------------+--------------+--------------
 1 mon        | 2 mons       | 3 mons
(1 row)
```

### 2\) Using JUSTIFY_DAYS() function with intervals that are not multiple of 30 days

The following example uses the `JUSTIFY_DAYS()` function to adjust intervals that are not multiples of 30 days:

```sql
SELECT JUSTIFY_DAYS(INTERVAL '15 days'),
       JUSTIFY_DAYS(INTERVAL '45 days'),
       JUSTIFY_DAYS(INTERVAL '75 days');
```

Output:

```text
 justify_days | justify_days  |  justify_days
--------------+---------------+----------------
 15 days      | 1 mon 15 days | 2 mons 15 days
(1 row)
```

### 3\) Using JUSTIFY_DAYS() function with intervals that include hours

The following example uses the `JUSTIFY_DAYS()` function to adjust intervals that include hours, minutes, and seconds:

```sql
SELECT JUSTIFY_DAYS(INTERVAL '15 days 2 hours'),
       JUSTIFY_DAYS(INTERVAL '55 days 30 minutes'),
       JUSTIFY_DAYS(INTERVAL '75 days 45 seconds');
```

Output:

```text
   justify_days   |      justify_days      |      justify_days
------------------+------------------------+-------------------------
 15 days 02:00:00 | 1 mon 25 days 00:30:00 | 2 mons 15 days 00:00:45
(1 row)
```

The output indicates that the adjusted intervals have the time parts.

## Summary

- Use the `JUSTIFY_DAYS()` function to normalize an interval by converting days exceeding 30 days as months.


# JUSTIFY_HOURS

---
title: 'PostgreSQL JUSTIFY_HOURS() Function'
page_title: 'PostgreSQL JUSTIFY_HOURS() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL JUSTIFY_HOURS() function to adjust 24-hour intervals as days.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-justify_hours/'
ogImage: ''
updatedOn: '2024-03-21T03:42:38+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL JUSTIFY_DAYS() Function'
  slug: 'postgresql-date-functions/postgresql-justify_days'
nextLink:
  title: 'PostgreSQL JUSTIFY_INTERVAL() Function'
  slug: 'postgresql-date-functions/postgresql-justify_interval'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `JUSTIFY_HOURS()` function to adjust 24\-hour intervals as days.

## Introduction to the PostgreSQL JUSTIFY_HOURS() function

The `JUSTIFY_HOURS()` function normalizes an [interval](../postgresql-tutorial/postgresql-interval) by converting hours exceeding 24 to days.

Here’s the syntax of the `JUSTIFY_HOURS()` function:

```sql
JUSTIFY_HOURS ( value) → interval
```

In this syntax:

- `value` is an interval value you want to justify.

The `JUSTIFY_HOURS()` function returns an adjusted interval with:

- Hours exceeding 24 are converted to days.
- The remaining hours are kept the same.
- Minutes, seconds, and other units remain unchanged.

If the value is `NULL`, the function returns `NULL`.

## PostgreSQL JUSTIFY_HOURS() function examples

Let’s take some examples of using the PostgreSQL `JUSTIFY_HOURS()` function.

### 1\) Basic PostgreSQL JUSTIFY_HOURS() function example

The following statement uses the `JUSTIFY_HOURS()` function to adjust intervals that are multiples of 24 hours:

```sql
SELECT JUSTIFY_HOURS(INTERVAL '24 hours'),
       JUSTIFY_HOURS(INTERVAL '48 hours'),
       JUSTIFY_HOURS(INTERVAL '72 hours');
```

Output:

```text
 justify_hours | justify_hours | justify_hours
---------------+---------------+---------------
 1 day         | 2 days        | 3 days

```

### 2\) Using JUSTIFY_HOURS() function with intervals that are not multiple of 24 hours

The following example uses the `JUSTIFY_HOURS()` function to adjust intervals that are not multiples of 24 hours:

```sql
SELECT JUSTIFY_HOURS(INTERVAL '25 hours'),
       JUSTIFY_HOURS(INTERVAL '50 hours'),
       JUSTIFY_HOURS(INTERVAL '70 hours');
```

Output:

```text
 justify_hours  |  justify_hours  |  justify_hours
----------------+-----------------+-----------------
 1 day 01:00:00 | 2 days 02:00:00 | 2 days 22:00:00

```

### 3\) Using the JUSTIFY_HOURS() function with intervals that include hours

The following example uses the `JUSTIFY_HOURS()` function to adjust intervals that include hours, minutes, and seconds:

```sql
SELECT JUSTIFY_HOURS(INTERVAL '15 days 2 hours'),
       JUSTIFY_HOURS(INTERVAL '55 days 30 minutes'),
       JUSTIFY_HOURS(INTERVAL '75 days 45 seconds');
```

Output:

```text
   justify_days   |      justify_days      |      justify_days
------------------+------------------------+-------------------------
 15 days 02:00:00 | 1 mon 25 days 00:30:00 | 2 mons 15 days 00:00:45
(1 row)
```

## Summary

- Use the `JUSTIFY_HOURS()` function to adjust 24\-hour intervals as days.


# JUSTIFY_INTERVAL

---
title: 'PostgreSQL JUSTIFY_INTERVAL() Function'
page_title: 'PostgreSQL JUSTIFY_INTERVAL() Function'
page_description: 'How to use the PostgreSQL JUSTIFY_INTERVAL() to normalize an interval by using the JUSTIFY_DAYS() and JUSTIFY_HOURS() functions.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-justify_interval/'
ogImage: ''
updatedOn: '2024-03-21T03:47:04+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL JUSTIFY_HOURS() Function'
  slug: 'postgresql-date-functions/postgresql-justify_hours'
nextLink:
  title: 'PostgreSQL MAKE_INTERVAL() Function'
  slug: 'postgresql-date-functions/postgresql-make_interval'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `JUSTIFY_INTERVAL()` to adjust an interval.

## Introduction to the PostgreSQL JUSTIFY_INTERVAL() function

The `JUSTIFY_INTERVAL()` function allows you to adjust an interval by converting days exceeding 30 days into months and hours exceeding 24 hours into days. It essentially normalizes an interval for enhanced readability.

The `JUSTIFY_INTERVAL()` function achieves this by utilizing the `JUSTIFY_DAYS()` and `JUSTIFY_HOURS()` functions, with additional sign adjustments:

- [`JUSTIFY_DAYS()`](postgresql-justify_days): Convert days exceeding 30 days into months and remaining days.
- [`JUSTIFY_HOURS()`](postgresql-justify_hours): Convert hours exceeding 24 hours into days and remaining hours.

Here’s the syntax of the `JUSTIFY_INTERVAL()` function:

```sql
JUSTIFY_INTERVAL( value ) → interval
```

In this syntax, the `value` parameter is an interval value you want to justify.

The `JUSTIFY_INTERVAL()` function returns an adjusted interval by:

- Convert days exceeding 30 days into months and remaining days.
- Convert hours exceeding 24 hours into days and remaining hours.
- Correct signs (positive or negative) for the overall duration.

## PostgreSQL JUSTIFY_INTERVAL() function examples

Let’s take some examples of using the `JUSTIFY_INTERVAL()` function.

### 1\) Basic JUSTIFY_INTERVAL() function examples

The following example uses the `JUSTIFY_INTERVAL()` function to justify an interval in days to months:

```sql
SELECT JUSTIFY_INTERVAL('35 days');
```

Output:

```text
 justify_interval
------------------
 1 mon 5 days
(1 row)
```

The following statement uses the `JUSTIFY_INTERVAL()` function to justify an interval in hours to days:

```sql
SELECT JUSTIFY_INTERVAL('30 hours');
```

Output:

```sql
justify_interval
------------------
 1 day 06:00:00
(1 row)
```

### 2\) Using the JUSTIFY_INTERVAL() function with negative intervals

The following example uses the `JUSTIFY_INTERVAL()` function to convert a negative interval into hours days and hours:

```sql
SELECT JUSTIFY_INTERVAL('-2 days 5 hours');
```

Output:

```text
 justify_interval
-------------------
 -1 days -19:00:00
(1 row)
```

In this example:

- \-2 days 5 hours is \-48 hours \+ 5 hours which is 43 hours.
- The function converts – 43 hours to \-24 hours \+ – 19 hours, which results in \-1 days \-19:00:00\.

## Summary

- Use the `JUSTIFY_INTERVAL()` function to normalize an interval by converting days exceeding 30 days into months and hours exceeding 24 hours into days, while maintaining correct signs for positive or negative intervals.


# MAKE_INTERVAL

---
title: 'PostgreSQL MAKE_INTERVAL() Function'
page_title: 'PostgreSQL MAKE_INTERVAL() Function'
page_description: "In this tutorial, you will learn how to use the PostgreSQL MAKE_INTERVAL() function to create an interval from the interval's components"
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-make_interval/'
ogImage: ''
updatedOn: '2024-03-25T05:04:35+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL JUSTIFY_INTERVAL() Function'
  slug: 'postgresql-date-functions/postgresql-justify_interval'
nextLink:
  title: 'PostgreSQL AT TIME ZONE Operator'
  slug: 'postgresql-date-functions/postgresql-at-time-zone'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `MAKE_INTERVAL()` function to create an interval from the interval’s components

## Introduction to the PostgreSQL MAKE_INTERVAL() function

The `MAKE_INTERVAL()` function allows you to create an [interval](../postgresql-tutorial/postgresql-interval) from years, months, weeks, days, hours, minutes, and seconds.

Here’s the syntax of the `MAKE_INTERVAL()` function:

```csssqlsql
MAKE_INTERVAL ( [ years int [, months int [, weeks int [, days int [, hours int [, mins int [, secs double precision ]]]]]]] ) → interval
```

In this syntax:

- `years` is an integer representing the number of years.
- `months` is an integer representing the number of months.
- `weeks` is an integer representing the number of weeks.
- `days` is an integer representing the number of days.
- `hours` is an integer representing the number of hours.
- `mins` is an integer representing the number of minutes.
- `secs` is a double\-precision number representing the number of seconds.

All of these parameters are optional and default to zero.

The `MAKE_INTERVAL()` function returns a value of interval type.

Besides the `MAKE_INTERVAL()` function, you can use the `INTERVAL` literal syntax to create an interval:

```sql
INTERVAL 'X years Y months Z days W hours V minutes U seconds'
```

The `INTERVAL` literal syntax allows you to create an interval by specifying all components in a single string. It is suitable for creating static or predefined intervals.

On the other hand, the `MAKE_INTERVAL()` function offers the flexibility to specify each component separately and is ideal for creating an interval dynamically. For example, you can use the `MAKE_INTERVAL()` function to create an interval from values stored in a table.

## PostgreSQL MAKE_INTERVAL() function examples

Let’s explore some examples of using the `MAKE_INTERVAL()` function.

### 1\) Basic MAKE_INTERVAL() function example

The following example uses the `MAKE_INTERVAL()` function to create an interval that represents 1 year, 2 months, 3 days, and 4 hours:

```
SELECT
  MAKE_INTERVAL(
    years => 3, months => 6, days => 15, hours => 4
  );
```

Output:

```text
          make_interval
---------------------------------
 3 years 6 mons 15 days 04:00:00
(1 row)
```

### 2\) Using the MAKE_INTERVAL() function with default values

All of the parameters of the `MAKE_INTERVAL()` function are optional and default to zero. For example, the following statement creates an interval zero:

```sql
SELECT MAKE_INTERVAL();
```

Output:

```text
 make_interval
---------------
 00:00:00
(1 row)
```

### 3\) Using the MAKE_INTERVAL( ) function with table data

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `time_data`:

```sql
CREATE TABLE time_data (
    id SERIAL PRIMARY KEY,
    year INTEGER,
    month INTEGER,
    day INTEGER,
    hour INTEGER,
    minute INTEGER,
    second INTEGER
);
```

Second, [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the time_data table:

```sql
INSERT INTO time_data (year, month, day, hour, minute, second)
VALUES
    (1, 3, 25, 10, 0, 0),
    (2, 2, 25, 11, 30, 0),
    (3, 1, 25, 13, 15, 0)
RETURNING *;
```

Output:

```text
 id | year | month | day | hour | minute | second
----+------+-------+-----+------+--------+--------
  1 |    1 |     3 |  25 |   10 |      0 |      0
  2 |    2 |     2 |  25 |   11 |     30 |      0
  3 |    3 |     1 |  25 |   13 |     15 |      0
(3 rows)
```

Third, use the `MAKE_INTERVAL()` function to create intervals from the data stored in the `time_data` table:

```
SELECT
  MAKE_INTERVAL(
    year, month, 0, day, hour, minute, second
  ) AS interval_data
FROM
  time_data;
```

Output:

```
          interval_data
---------------------------------
 1 year 3 mons 25 days 10:00:00
 2 years 2 mons 25 days 11:30:00
 3 years 1 mon 25 days 13:15:00
(3 rows)
```

## Summary

- Use the `MAKE_INTERVAL()` function to construct an interval from the provided components, such as years, months, days, hours, minutes, and seconds.


# Operators

# AT TIME ZONE Operator

---
title: 'PostgreSQL AT TIME ZONE Operator'
page_title: 'PostgreSQL AT TIME ZONE Operator'
page_description: 'You will learn how to use the PostgreSQL AT TIME ZONE operator to convert a timestamp or a timestamp with time zone to a different time zone.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-at-time-zone/'
ogImage: ''
updatedOn: '2024-03-21T09:22:23+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL MAKE_INTERVAL() Function'
  slug: 'postgresql-date-functions/postgresql-make_interval'
nextLink:
  title: 'PostgreSQL DATE_TRUNC() Function'
  slug: 'postgresql-date-functions/postgresql-date_trunc'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `AT TIME ZONE` operator to convert a timestamp or a timestamp with time zone to a different time zone.

## Introduction to the PostgreSQL AT TIME ZONE operator

In PostgreSQL, the `AT TIME ZONE` is an operator that allows you to convert a [timestamp](../postgresql-tutorial/postgresql-timestamp) or a timestamp with time zone to a different time zone.

The `AT TIME ZONE` operator can be useful when you want to perform timezone conversions within your SQL queries.

Here’s the syntax of the `AT TIME ZONE` operator:

```csssqlsql
timestamp_expression AT TIME ZONE target_timezone
```

In this syntax:

- timestamp_expression is a timestamp or timestamp with time zone value that you want to convert.
- target_timezone is the target time zone to which you want to convert. This can be either a time zone name or an expression that evaluates to a time zone name.

The `AT TIME ZONE` operator always returns a value of type `TIMESTAMP WITH TIME ZONE`.

## PostgreSQL AT TIME ZONE operator examples

Let’s explore some examples of using the `AT TIME ZONE` operator. It is assumed that the server’s time zone is `'America/Los_Angeles'`.

If you want to have consistent results like the following examples, you can set the PostgreSQL server’s timezone to `'America/Los_Angeles'` by executing the following statement in any PostgreSQL client (such as pgAdmin or psql):

```sql
set timezone to 'America/Los_Angeles'
```

Once you execute the command, you can verify it by showing the current timezone:

```sql
show timezone;
```

Output:

```text
      TimeZone
---------------------
 America/Los_Angeles
(1 row)
```

### 1\) Basic AT TIME ZONE operator example

The following example uses the `AT TIME ZONE` operator to convert a timestamp to Coordinated Universal time (UTC):

```
SELECT TIMESTAMP '2024-03-21 10:00:00' AT TIME ZONE 'UTC';
```

Output:

```
        timezone
------------------------
 2024-03-21 03:00:00-07
(1 row)
```

### 2\) Converting timestamp with time zone

The following example uses the `AT TIME ZONE` operator to convert a timestamp with time zone to UTC:

```css
SELECT TIMESTAMP WITH TIME ZONE '2024-03-21 10:00:00-04' AT TIME ZONE 'UTC';
```

Output:

```text
      timezone
---------------------
 2024-03-21 14:00:00
(1 row)
```

### 3\) Using the AT TIME ZONE operator with time zone abbreviation

The following query uses the `AT TIME ZONE` operator to convert a timestamp to Pacific Standard Time (PST) from the default time zone:

```css
SELECT TIMESTAMP '2024-03-21 10:00:00' AT TIME ZONE 'PST';
```

Output:

```text
        timezone
------------------------
 2024-03-21 11:00:00-07
(1 row)
```

### 4\) Converting a timestamp using a time zone offset

The following example uses the `AT TIME ZONE` operator to convert a timestamp using a time zone offset:

```css
SELECT TIMESTAMP '2024-03-21 10:00:00' AT TIME ZONE '-08:00';
```

Output:

```text
        timezone
------------------------
 2024-03-20 19:00:00-07
(1 row)
```

### 5\) Converting a timestamp using named time zones

The following example uses the `AT TIME ZONE` operator to convert a timestamp using a named time zone:

```css
SELECT TIMESTAMP '2024-03-21 10:00:00' AT TIME ZONE 'America/New_York';
```

Output:

```
        timezone
------------------------
 2024-03-21 07:00:00-07
(1 row)
```

Please note that PostgreSQL uses the [IANA time zone database](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones) for time zone information.

## Summary

- Use the `AT TIME ZONE` operator to convert a timestamp to a different time zone.


# Utility Functions

# DATE_TRUNC

---
title: 'PostgreSQL DATE_TRUNC() Function'
page_title: 'PostgreSQL DATE_TRUNC Function By Examples'
page_description: 'This tutorial shows you how to use the PostgreSQL DATE_TRUNC function to truncate a timestamp or interval to a specified precision.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-date_trunc/'
ogImage: '/postgresqltutorial/rental-table.png'
updatedOn: '2024-03-22T01:11:13+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL AT TIME ZONE Operator'
  slug: 'postgresql-date-functions/postgresql-at-time-zone'
nextLink:
  title: 'PostgreSQL ISFINITE() Function'
  slug: 'postgresql-date-functions/postgresql-isfinite'
---

**Summary**: This tutorial shows you how to use the PostgreSQL `DATE_TRUNC()` function to truncate a timestamp or interval to a specified precision.

## Introduction to the PostgreSQL DATE_TRUNC() function

The `DATE_TRUNC()` function truncates a [`TIMESTAMP`](../postgresql-tutorial/postgresql-timestamp), a `TIMESTAMP WITH TIME ZONE`, or an  [`INTERVAL`](../postgresql-tutorial/postgresql-interval) value to a specified precision.

Here’s the basic syntax of the `DATE_TRUNC` function:

```sqlsql
DATE_TRUNC(field, source [,time_zone])
```

In this syntax:

### source

`source` is a value or an expression of type timestamp, timestamp with time zone, or interval. If you use a value of the date or time type, the function will cast it automatically to timestamp or interval respectively.

### field

`field` specifies the to which precision to truncate the `source`.

Here are the valid values for the `field`:

- millennium
- century
- decade
- year
- quarter
- month
- week
- day
- hour
- minute
- second
- milliseconds
- microseconds

### time_zone

`time_zone` specifies the time zone in which the function will perform the truncation. The `time_zone` argument is the default.

If you omit the `time_zone`, the function will truncate the `source` based on the current time zone setting.

The `DATE_TRUNC` function returns a `TIMESTAMP` or an `INTERVAL` value.

## PostgreSQL DATE_TRUNC() function examples

Let’s explore some examples of using the `DATE_TRUNC()` function.

### 1\) Basic PostgreSQL DATE_TRUNC() function example

The following example uses the `DATE_TRUNC()` function to truncate a `TIMESTAMP` value to `hour` part:

```sql
SELECT DATE_TRUNC('hour', TIMESTAMP '2017-03-17 02:09:30');
```

Output:

```text
     date_trunc
---------------------
 2017-03-17 02:00:00
(1 row)
```

In this example, the `DATE_TRUNC()` function returns a timestamp with the hour precision.

If you want to truncate a `TIMESTAMP` value to a minute, you use the `'minute'` field as shown in the following example:

```sql
SELECT DATE_TRUNC('minute', TIMESTAMP '2017-03-17 02:09:30');
```

The function returns a `TIMESTAMP` with the precision is minute:

```text
     date_trunc
---------------------
 2017-03-17 02:09:00
(1 row)
```

### 2\) Using PostgreSQL DATE_TRUNC() function with table data

See the following `rental` table in the [sample database](../postgresql-getting-started/postgresql-sample-database):

![Rental table - PostgreSQL date_trunc function demo](/postgresqltutorial/rental-table.png)
The following example uses the `DATE_TRUNC()` function to retrieve the number of rentals by month from the rental table:

```sql
SELECT
    DATE_TRUNC('month', rental_date) m,
    COUNT (rental_id)
FROM
    rental
GROUP BY
    m
ORDER BY
    m;
```

Output:

```text
          m          | count
---------------------+-------
 2005-05-01 00:00:00 |  1156
 2005-06-01 00:00:00 |  2311
 2005-07-01 00:00:00 |  6709
 2005-08-01 00:00:00 |  5686
 2006-02-01 00:00:00 |   182
(5 rows)
```

This query retrieves the month of each rental date and counts the number of rentals each month from the `rental` table. It then groups the counts by month and sorts the result set by month.

If you want to count the rentals by week, you can pass the week to the DATE_TRUNC() function as follows:

```sql
SELECT
    DATE_TRUNC('week', rental_date) week,
    COUNT (rental_id)
FROM
    rental
GROUP BY
    week
ORDER BY
    week;
```

Output:

```
        week         | count
---------------------+-------
 2005-05-23 00:00:00 |   835
 2005-05-30 00:00:00 |   321
 2005-06-13 00:00:00 |  1705
 2005-06-20 00:00:00 |   606
 2005-07-04 00:00:00 |  2497
 2005-07-11 00:00:00 |   956
 2005-07-25 00:00:00 |  3256
 2005-08-01 00:00:00 |  1314
 2005-08-15 00:00:00 |  3148
 2005-08-22 00:00:00 |  1224
 2006-02-13 00:00:00 |   182
(11 rows)
```

The following example uses the `DATE_TRUNC()` function to count the number of rentals by staff per year:

```
SELECT
	staff_id,
	date_trunc('year', rental_date) y,
	COUNT (rental_id) rental
FROM
	rental
GROUP BY
	staff_id, y
ORDER BY
	staff_id;
```

Output:

```text
 staff_id |          y          | rental
----------+---------------------+--------
        1 | 2006-01-01 00:00:00 |     85
        1 | 2005-01-01 00:00:00 |   7955
        2 | 2006-01-01 00:00:00 |     97
        2 | 2005-01-01 00:00:00 |   7907
(4 rows)
```

## Summary

- Use the PostgreSQL `DATE_TRUNC` function to truncate a timestamp or an interval value to a specified level of precision


# ISFINITE

---
title: 'PostgreSQL ISFINITE() Function'
page_title: 'PostgreSQL ISFINITE() Function'
page_description: 'You will learn how to use the PostgreSQL ISFINITE() function to determine if a date, a timestamp, or an interval is finite or not.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-isfinite/'
ogImage: ''
updatedOn: '2024-03-20T09:23:01+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL DATE_TRUNC() Function'
  slug: 'postgresql-date-functions/postgresql-date_trunc'
nextLink:
  title: 'PostgreSQL TIMEOFDAY() Function'
  slug: 'postgresql-date-functions/postgresql-timeofday'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `ISFINITE()` function to determine if a date, a timestamp, or an interval is finite or not.

## Introduction to the PostgreSQL ISFINITE() function

The `ISFINITE()` function accepts a [date](../postgresql-tutorial/postgresql-date), a [timestamp](../postgresql-tutorial/postgresql-timestamp), or an [interval](../postgresql-tutorial/postgresql-interval) and returns true if the value is finite.

Here’s the syntax of the `ISFINITE()` function:

```sql
isfinite ( value ) → boolean
```

The `isfinite()` function accepts a value with the type date, timestamp, or interval.

The `isfinite()` function returns true if the value is finite or false otherwise. It returns `NULL` if the value is `NULL`.

## PostgreSQL ISFINITE() function examples

Let’s explore some examples of using the `ISFINITE()` function.

### 1\) Using the ISFINITE() function with dates

The following example uses the `ISFINITE()` function to check if a date is finite or not:

```sql
SELECT ISFINITE('2024-03-20'::date) result;
```

Output:

```text
 result
--------
 t
(1 row)
```

The result is t, which is true in PostgreSQL.

The following example uses the `ISFINITE()` function to determine whether the date infinity is finite or not:

```sql
SELECT ISFINITE(DATE 'infinity') result;
```

Output:

```text
 result
--------
 f
(1 row)
```

The result is false because the infinity date is not finite.

### 2\) Using the ISFINITE() function with intervals

The following statement uses the `ISFINITE()` function to check if an interval is finite or not:

```sql
SELECT ISFINITE(INTERVAL '1 day') result;
```

Output:

```text
 result
--------
 t
(1 row)
```

Since PostgreSQL doesn’t support infinity intervals, the `ISFINITE()` function always returns true for an interval.

### 3\) Using the ISFINITE() function with timestamps

The following statement uses the `ISFINITE()` function to test for a finite timestamp:

```sql
SELECT ISFINITE(TIMESTAMP '2024-03-20 00:00:00') result;
```

Output:

```text
 result
--------
 t
(1 row)
```

The following statement uses the `ISFINITE()` function to check for an infinite timestamp:

```sql
SELECT ISFINITE(TIMESTAMP 'infinity') result;
```

Output:

```text
 result
--------
 f
(1 row)
```

## Summary

- Use the `ISFINITE()` function to test if a date, a timestamp, or an interval is finite or not.


# TIMEOFDAY

---
title: 'PostgreSQL TIMEOFDAY() Function'
page_title: 'PostgreSQL TIMEOFDAY() Function'
page_description: 'How to use the PostgreSQL TIMEOFDAY() function to retrieve the current date and time as a formatted string.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-timeofday/'
ogImage: ''
updatedOn: '2024-03-20T04:01:17+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL ISFINITE() Function'
  slug: 'postgresql-date-functions/postgresql-isfinite'
nextLink:
  title: 'PostgreSQL PG_SLEEP() Function'
  slug: 'postgresql-date-functions/postgresql-pg_sleep'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `TIMEOFDAY()` function to retrieve the current date and time as a formatted string.

## Introduction to the PostgreSQL TIMEOFDAY() function

The `TIMEOFDAY()` function returns the [current date and time](postgresql-current_timestamp) as a formatted string.

Here’s the syntax of the `TIMEOFDAY()` function:

```sql
TIMEOFDAY()
```

The function does not have any parameters and returns the current date and time as a string.

Note that the `TIMEOFDAY()` function returns the same result as the `CLOCK_TIMESTAMP()` function but in the text string.

## PostgreSQL TIMEOFDAY() function examples

Let’s take some examples of using the `TIMEOFDAY()` function.

### 1\) Basic TIMEOFDAY() function example

The following example uses the `TIMEOFDAY()` function to retrieve the current date and time as a string:

```text
              timeofday
-------------------------------------
 Wed Mar 20 10:20:10.108369 2024 -07
(1 row)
```

The output shows the date, time, and timezone.

### 2\) Formatting the output

If you want a specific format, you can cast the result of the `TIMEOFDAY()` function into a timestamp and use the `to_char()` function to achieve the desired format:

```sql
SELECT
  to_char(
    timeofday():: timestamp,
    'YYYY-MM-DD HH24:MI:SS'
  ) current_time;
```

Output:

```text
    current_time
---------------------
 2024-03-20 10:26:57
(1 row)
```

## Summary

- Use the `TIMEOFDAY()` function to obtain the current date and time as a formatted string.


# PG_SLEEP

---
title: 'PostgreSQL PG_SLEEP() Function'
page_title: 'PostgreSQL PG_SLEEP() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL PG_SLEEP() function to pause the execution of a query.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-date-functions/postgresql-pg_sleep/'
ogImage: ''
updatedOn: '2024-03-21T09:32:51+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL TIMEOFDAY() Function'
  slug: 'postgresql-date-functions/postgresql-timeofday'
nextLink:
  title: 'PostgreSQL String Functions'
  slug: 'postgresql-date-functions/../postgresql-string-functions'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `PG_SLEEP()` function to pause the execution of a query.

## Introduction to the PostgreSQL PG_SLEEP() function

The `PG_SLEEP()` function allows you to create a delay (sleep) in your queries. The function can be useful when you want to test, simulate real\-time processes, or add a pause between operations.

Here’s the syntax of the `PG_SLEEP()` function:

```sql
PG_SLEEP(seconds)
```

In this syntax, the `seconds` parameter specifies the number of seconds for which you want the execution to pause. It can be an integer or a decimal number with fractions.

## The PostgreSQL PG_SLEEP() function examples

Let’s explore some examples of using the `PG_SLEEP()` function.

### 1\) Basic usage of PG_SLEEP() function

The following example uses the `PG_SLEEP()` function to pause the execution for 3 seconds before returning any result:

```sql
SELECT pg_sleep(3);
```

After 3 seconds:

```text
 pg_sleep
----------

(1 row)
```

### 2\) Using Fractional Seconds

The following example uses the `PG_SLEEP()` function to pause the execution for `1.5` seconds:

```sql
SELECT PG_SLEEP(1.5);
```

After `1.5` seconds:

```text
 pg_sleep
----------

(1 row)
```

### 3\) Using the PG_SLEEP() function with NOW() function

The following example uses the `PG_SLEEP()` function between the [`NOW()`](postgresql-now) functions:

```sql
SELECT NOW(), PG_SLEEP(3), NOW();
```

Output:

```sql
-[ RECORD 1 ]---------------------------
now      | 2024-03-21 02:26:37.710939-07
pg_sleep |
now      | 2024-03-21 02:26:37.710939-07
```

The output indicates that the result of the `NOW()` function does not change within the same statement even though we use pause the execution between the calls of the `NOW()` functions for 3 seconds.

### 4\) Using the PG_SLEEP() function with CLOCK_TIMESTAMP() function

The following example uses the `PG_SLEEP()` function between the [`CLOCK_TIMESTAMP()`](postgresql-clock_timestamp) functions:

```sql
SELECT CLOCK_TIMESTAMP(), PG_SLEEP(3), CLOCK_TIMESTAMP();
```

Output:

```sql
-[ RECORD 1 ]---+------------------------------
clock_timestamp | 2024-03-21 02:27:03.181753-07
pg_sleep        |
clock_timestamp | 2024-03-21 02:27:06.186789-07
```

The output shows that the [`CLOCK_TIMESTAMP()`](postgresql-clock_timestamp) returns the actual current timestamp when it executes. The results of the `CLOCK_TIMESTAMP()` function calls are 3 seconds difference.

## Summary

- Use the `PG_SLEEP()` function to pause the SQL execution for a number of seconds.


# JSON Functions

---
title: 'PostgreSQL JSON Functions'
page_title: 'PostgreSQL JSON Functions'
page_description: 'This page provides you with the most commonly used PostgreSQL JSON functions that allow you to manage JSON data effectively.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/'
ogImage: ''
updatedOn: '2024-02-27T06:36:15+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL ROW_NUMBER Function'
  slug: 'postgresql-window-function/postgresql-row_number'
nextLink:
  title: 'PostgreSQL to_jsonb() Function'
  slug: 'postgresql-json-functions/postgresql-to_jsonb'
---

This page provides you with the most commonly used PostgreSQL JSON functions that allow you to manage JSON data effectively.

## Section 1\. Creating JSON data

This section covers the functions that help you create JSON data in SQL:

- [to_jsonb()](postgresql-json-functions/postgresql-to_jsonb) – Convert an SQL value to a value of JSONB.
- [jsonb_build_array()](postgresql-json-functions/postgresql-jsonb_build_array) – Construct a JSON array from a list of values or the result of a query.
- [jsonb_build_object()](postgresql-json-functions/postgresql-jsonb_build_object) – Build a JSON object from a list of alternating keys and values.
- [jsonb_object()](postgresql-json-functions/postgresql-jsonb_object) – Build a JSON object from a text array.
- [row_to_json()](postgresql-json-functions/postgresql-row_to_json) – Create a JSON object from a SQL composite value.

## Section 2\. Searching JSON data

This section provides you with functions that search for JSON elements based on JSON paths.

- [JSON path](postgresql-json-functions/postgresql-json-path) – Show you how to construct simple JSON paths to locate values or elements within a JSON document.
- [jsonb_path_query()](postgresql-json-functions/postgresql-jsonb_path_query) – Query data on a JSON document based on a JSON path expression and return matched JSONB data.
- [jsonb_path_query_array()](postgresql-json-functions/postgresql-jsonb_path_query_array) – Query data on a JSON document based on a JSON path expression and return matched elements as a JSON array.
- [jsonb_path_query_first()](postgresql-json-functions/postgresql-jsonb_path_query_first) – Evaluate a JSON path expression against a JSON document and return the first match.
- [jsonb_path_exists()](postgresql-json-functions/postgresql-jsonb_path_exists) – Return true if a JSON path returns any elements in a JSON document.
- jsonb_path_match() – Return true if any part of a JSON document matches a JSON path expression or false otherwise.

## Section 3\. Querying JSON data

This section shows you how to query and extract elements in JSON documents.

- [JSONB operators](postgresql-json-functions/postgresql-jsonb-operators) – Show you how to use JSONB operators to extract and query JSON data effectively.
- [Extracting JSON data](postgresql-json-functions/postgresql-json-extract) – Extract an array element of a JSON array or extract the value associated with a specified key from a JSON object and return the value as a JSONB value or a text string.
- [jsonb_extract_path()](postgresql-json-functions/postgresql-jsonb_extract_path) – Extract a JSON sub\-object from JSONB data at a specified path.
- [jsonb_extract_path_text()](postgresql-json-functions/postgresql-jsonb_extract_path_text) – Extract a JSON sub\-object as text from JSONB data at a specified path.

## Section 4\. Modifying JSON data

This section discusses the function that inserts and updates values in JSON documents.

- [jsonb_insert()](postgresql-json-functions/postgresql-jsonb_insert) – Insert a new value into a JSON document based on a path and return the modified JSON document.
- [jsonb_set()](postgresql-json-functions/postgresql-jsonb_set) – Replace existing values in a JSON document based on a path and return the modified JSON document.
- [jsonb_strip_nulls()](postgresql-json-functions/postgresql-jsonb_strip_nulls) – Delete all object fields that have null values from a specified JSON document.

## Section 5\. Working with JSON arrays

This section introduces you to JSON functions that work with JSON arrays including getting array length and expanding array elements into JSONB values and text.

- [jsonb_array_length()](postgresql-json-functions/postgresql-jsonb_array_length) – Return the number of elements in the top\-level JSON array.
- [jsonb_array_elements()](postgresql-json-functions/postgresql-jsonb_array_elements) – Expand the top\-level JSON array into a set of JSON values.
- [jsonb_array_elements_text()](postgresql-json-functions/postgresql-jsonb_array_elements_text) – Expand the top\-level JSON array into a set of text values.

## Section 6\. Working with JSON objects

This section shows you how to use JSON functions that handle JSON objects.

- [jsonb_each()](postgresql-json-functions/postgresql-jsonb_each) – Expand the keys and values of the top\-level JSON object into a set of key/value pairs. The values are JSON values.
- [jsonb_each_text()](postgresql-json-functions/postgresql-jsonb_each_text) – Expand the top\-level JSON object into a set of key/value pairs. The values are of the text type.
- [jsonb_object_keys()](postgresql-json-functions/postgresql-jsonb_object_keys) –  Return a set of keys in the top\-level JSON object.
- [jsonb_to_record()](postgresql-json-functions/postgresql-jsonb_to_record) – Convert a top\-level JSON object into a PostgreSQL record type defined by an AS clause.

## Section 7\. Aggregating JSON data

This section shows you how to use JSON aggregate functions that collect data from multiple rows into a JSON array or object.

- [jsonb_agg()](postgresql-json-functions/postgresql-jsonb_agg) – aggregate a list of values including NULL into a JSON array.
- [jsonb_object_agg()](postgresql-json-functions/postgresql-jsonb_object_agg) – aggregate a list of key/value pairs into a JSON object.

## Section 8\. JSON utility functions

This section discusses the JSON utility functions for getting types of JSONB values and formats JSON values into a human\-readable format.

- [jsonb_typeof()](postgresql-json-functions/postgresql-jsonb_typeof) – Return the type of top\-level JSON value as a text string.
- [jsonb_pretty()](postgresql-json-functions/postgresql-jsonb_pretty) – Format a JSON value into human\-readable, indented format, making it easier to read.


# Creating JSON Data

# to_jsonb

---
title: 'PostgreSQL to_jsonb() Function'
page_title: 'PostgreSQL to_jsonb() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL to_jsonb() function to convert an SQL value to a value of JSONB type.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-to_jsonb/'
ogImage: ''
updatedOn: '2024-02-25T02:38:36+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL JSON Functions'
  slug: 'postgresql-json-functions/'
nextLink:
  title: 'PostgreSQL jsonb_build_array() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_build_array'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `to_jsonb()` function to convert an SQL value to a value of `JSONB` type.

## Introduction to the PostgreSQL to_jsonb() function

The `to_jsonb()` function allows you to convert an SQL value to a `JSONB` value.

Here’s the syntax of the `to_jsonb()` function:

```sqlsql
to_jsonb ( value ) → jsonb
```

In this syntax, you specify an SQL value that you want to convert to a `JSONB` value.

The `to_jsonb()` function returns a value converted to a `JSONB` value. If the value is an array or a composite value, the function will convert to arrays or objects in JSON.

## PostgreSQL to_jsonb() function examples

Let’s explore some examples of using the `to_jsonb()` function.

### 1\) Converting a text string to a JSONB value

The following example uses the `to_jsonb()` function to convert a text string into a `JSONB` value:

```sql
SELECT to_jsonb('Hello'::text);
```

Output:

```text
 to_jsonb
----------
 "Hello"
(1 row)
```

The “Hello” is a `JSONB` value.

To verify it, you can pass the result of the `to_jsonb()` function to the `jsonb_typeof()` function.

The `jsonb_typeof()` function returns the type of a top\-level JSON value as a text string.

For example:

```sql
SELECT
  JSONB_TYPEOF(
    to_jsonb('Hello' :: text)
  );
```

Output:

```text
 jsonb_typeof
--------------
 string
(1 row)
```

### 2\) Converting numbers to a JSONB values

The following example uses the `to_jsonb()` function to convert numbers to `JSONB` values:

```sql
SELECT
  to_jsonb(10 :: int),
  to_jsonb(9.99 :: numeric);
```

Output:

```text
 to_jsonb | to_jsonb
----------+----------
 10       | 9.99
(1 row)
```

### 3\) Converting bool values to a JSONB values

The following example uses the `to_jsonb()` function to convert boolean values to `JSONB` values:

```sql
SELECT
  to_jsonb(true :: bool),
  to_jsonb(false :: bool);
```

Output:

```text
 to_jsonb | to_jsonb
----------+----------
 true     | false
(1 row)
```

### 4\) Converting NULL to a JSONB value

The following example uses the `to_jsonb()` function to convert `NULL` to a `JSONB` value:

```sql
SELECT
  to_jsonb(NULL::text);
```

Output:

```text
 to_jsonb
----------
 null
(1 row)
```

### 5\) Converting a PostgreSQL array into a JSON array

The following example uses the `to_jsonb()` function to convert an array in PostgreSQL to a JSON array with the `JSONB` type:

```sql
SELECT
  to_jsonb(
    ARRAY[ 'red', 'green', 'blue' ]
  ) AS jsonb_array;
```

Output:

```text
       jsonb_array
--------------------------
 ["red", "green", "blue"]
(1 row)
```

### 6\) Using the to_jsonb() function with table data

We’ll use the `to_jsonb()` function to convert data in the `film` table from the [sample database](../postgresql-getting-started/postgresql-sample-database) to `JSONB` values:

```
SELECT
  to_jsonb(title),
  to_jsonb(length)
FROM
  film
ORDER BY
  title;
```

Output:

```
           to_jsonb            | to_jsonb
-------------------------------+----------
 "Academy Dinosaur"            | 86
 "Ace Goldfinger"              | 48
 "Adaptation Holes"            | 50
...
```

## Summary

- Use the PostgreSQL `to_jsonb()` function to convert an SQL value to a `JSONB` value.


# jsonb_build_array

---
title: 'PostgreSQL jsonb_build_array() Function'
page_title: 'PostgreSQL jsonb_build_array() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL jsonb_build_array() function to create a JSON array.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_build_array/'
ogImage: '/postgresqltutorial/film.png'
updatedOn: '2024-02-23T07:45:10+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL to_jsonb() Function'
  slug: 'postgresql-json-functions/postgresql-to_jsonb'
nextLink:
  title: 'PostgreSQL jsonb_build_object() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_build_object'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_build_array()` function to create a JSON array.

## Introduction to the PostgreSQL jsonb_build_array() function

The `jsonb_build_array()` function allows you to construct a JSONB array from a variadic list of arguments.

Here’s the basic syntax of the `jsonb_build_array()` function:

```sql
jsonb_build_array ( VARIADIC "any" ) → jsonb
```

In this syntax, you provide a list of arguments that you want to convert to elements of a JSON array.

The `jsonb_build_array()` will convert each argument using the [`to_jsonb()`](postgresql-to_jsonb) function.

## PostgreSQL jsonb_build_array() function examples

Let’s take some examples of using the `jsonb_build_array()` function.

### 1\) Basic PostgreSQL jsonb_build_array() function example

The following example uses the `jsonb_build_array()` function to create a JSON array from a list of values:

```sql
SELECT jsonb_build_array(10, null, 'Hi', true) result;
```

Output:

```text
         result
------------------------
 [10, null, "Hi", true]
(1 row)
```

### 2\) Using PostgreSQL jsonb_build_array() function with table data

We’ll use the `film` table from the [sample database](../postgresql-getting-started/postgresql-sample-database):

![](/postgresqltutorial/film.png)The following example uses the `jsonb_build_array()` function to convert the title and length of each film into elements of a JSON array:

```sql
SELECT
  jsonb_build_array(title, length)
FROM
  film
ORDER BY
  title;
```

Output:

```text
          jsonb_build_array
--------------------------------------
 ["Academy Dinosaur", 86]
 ["Ace Goldfinger", 48]
 ["Adaptation Holes", 50]
 ["Affair Prejudice", 117]
...
```

## Summary

- Use the PostgreSQL `jsonb_build_array()` function to create a `JSONB` array from a variadic list of arguments.


# jsonb_build_object

---
title: 'PostgreSQL jsonb_build_object() Function'
page_title: 'PostgreSQL jsonb_build_object() Function'
page_description: 'You will learn how to use the PostgreSQL jsonb_build_object() function to create a JSON object based on a variadic argument list.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_build_object/'
ogImage: ''
updatedOn: '2024-02-23T08:02:53+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_build_array() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_build_array'
nextLink:
  title: 'PostgreSQL jsonb_object() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_object'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_build_object()` function to create a JSON object based on a variadic argument list.

## Introduction to the PostgreSQL jsonb_build_object() function

The `jsonb_build_object()` function allows you to build an object out of a variadic argument list.

Here’s the basic syntax of the `jsonb_build_object()` function:

```sql
jsonb_build_object ( VARIADIC "any" ) → jsonb
```

In this syntax, you pass a list of alternative keys and values. The list must have an even number of elements or you’ll get an error.

The function will coerce the key to text and value to a JSON value using the `to_jsonb()` function.

The `jsonb_build_object()` function returns a JSON object with the specified key and values.

## PostgreSQL jsonb_build_object() function examples

Let’s explore some examples of using the PostgreSQL `jsonb_build_object()` function.

### 1\) Basic jsonb_build_object() function example

The following example uses the `jsonb_build_object()` function to build an object out of the alternating keys and values:

```sql
SELECT
  jsonb_build_object(
    'title', 'Academy Dinosaur', 'length',
    86
  );
```

Output:

```text
             jsonb_build_object
---------------------------------------------
 {"title": "Academy Dinosaur", "length": 86}
(1 row)
```

### 2\) Using jonb_build_object() function with table data example

The following example uses the `jsonb_build_object()` function to create a JSON object based on the title and length of films in the `film` table from the [sample database](../postgresql-getting-started/postgresql-sample-database):

```sql
SELECT
  jsonb_build_object('title', title, 'length', length)
FROM
  film
ORDER BY
  length DESC;
```

Output:

```text
                   jsonb_build_object
---------------------------------------------------------
 {"title": "Muscle Bright", "length": 185}
 {"title": "Control Anthem", "length": 185}
 {"title": "Sweet Brotherhood", "length": 185}
...
```

### 3\) Using the jonb_build_object() function with an odd number of values

The following example attempts to use the `jsonb_build_object()` function with an odd number of values:

```sql
SELECT
  jsonb_build_object(
    'title', 'Theory Mermaid', 'length'
  );
```

It returns the following error:

```sql
ERROR:  argument list must have even number of elements
HINT:  The arguments of jsonb_build_object() must consist of alternating keys and values.
```

## Summary

- Use the PostgreSQL `jsonb_build_object()` function to build a JSON object out of a variadic argument list.


# jsonb_object

---
title: 'PostgreSQL jsonb_object() Function'
page_title: 'PostgreSQL jsonb_object() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL jsonb_object() function to create a JSON object from a text array.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_object/'
ogImage: '/postgresqltutorial/film.png'
updatedOn: '2024-02-25T13:23:04+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_build_object() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_build_object'
nextLink:
  title: 'PostgreSQL row_to_json() Function'
  slug: 'postgresql-json-functions/postgresql-row_to_json'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_object()` function to create a JSON object from a text array.

## Introduction to the PostgreSQL jsonb_object() function

The `jsonb_object()` function allows you to build a JSON object from a [text](../postgresql-tutorial/postgresql-char-varchar-text) [array](../postgresql-tutorial/postgresql-array).

Here’s the syntax of the `jsonb_object()` function:

```sql
jsonb_object(text[]) → jsonb
```

In this syntax, `text[]` array can be:

- A one\-dimensional array that contains an even number of elements. The elements are the alternating key/value pairs.
- A two\-dimensional array. Each inner array has exactly two elements representing the key/value pair.

The `jsonb_object()` function returns a JSON object constructed from the text array with the type of JSONB.

The `jsonb_object()` function has another syntax that takes keys and values pairwise from separate text arrays:

```sql
jsonb_object ( keys text[], values text[] ) → jsonb
```

In this syntax, the keys and values arrays in this syntax have the same number of elements. The `keys` array contains the keys of the JSON object whereas the `values` array contains the corresponding values of the `keys`.

## PostgreSQL jsonb_object() function examples

Let’s explore some examples of using the `jsonb_object()` function.

### 1\) Basic PostgreSQL jsonb_object function examples

The following example uses the `jsonb_object()` function to create a JSON object from a text array:

```sql
SELECT
  jsonb_object('{"name","John", "age", 22}');
```

Output:

```text
         jsonb_object
-------------------------------
 {"age": "22", "name": "John"}
(1 row)
```

Alternatively, you can use a two\-dimensional arrays to create the JSON object:

```sql
SELECT
  jsonb_object(
    '{{"name","age"},{"John", 22}}'
  );
```

Output:

```text
         jsonb_object
-------------------------------
 {"John": "22", "name": "age"}
(1 row)
```

Additionally, you can use two arrays including `keys` and `values` to create the JSON object:

```sql
SELECT
  jsonb_object(
    '{"name","age"}', '{"John", 22}'
  );
```

Output:

```text
         jsonb_object
-------------------------------
 {"age": "22", "name": "John"}
(1 row)
```

### 2\) Using the jsonb_object() function with table data

We’ll use the `film` table from the [sample database](../postgresql-getting-started/postgresql-sample-database).

![](/postgresqltutorial/film.png)The following example uses the `jsonb_object` function to create an object from the `title` and `release_year` from the `film` table:

```sql
SELECT
  jsonb_object(
    array[title], array[release_year]::text[]
  )
FROM
  film
ORDER BY
  title;
```

Output:

```text
         jsonb_object
------------------------------
 {"Academy Dinosaur": "2006"}
 {"Ace Goldfinger": "2006"}
 {"Adaptation Holes": "2006"}
 {"Affair Prejudice": "2006"}
 {"African Egg": "2006"}
...
```

## Summary

- Use the PostgreSQL `jsonb_object()` function to create a JSON object from a text array.


# row_to_json

---
title: 'PostgreSQL row_to_json() Function'
page_title: 'PostgreSQL row_to_json() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL row_to_json() function to convert an SQL composite value to a JSON object.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-row_to_json/'
ogImage: '/postgresqltutorial/film.png'
updatedOn: '2024-02-25T14:51:03+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_object() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_object'
nextLink:
  title: 'PostgreSQL JSON Path'
  slug: 'postgresql-json-functions/postgresql-json-path'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `row_to_json()` function to convert an SQL composite value to a JSON object.

## Introduction to the PostgreSQL row_to_json() function

The `row_to_json()` function allows you to convert an SQL composite value into a JSON object.

Here’s the syntax of the `row_to_json()` function:

```sql
row_to_json ( record [, boolean ] ) → json
```

In this syntax:

- `record` is an SQL composite value that you want to convert into a JSON object.
- `boolean` if true, the function will add a line feed between top\-level elements.

The `row_to_json()` function will return a JSON object.

## PostgreSQL row_to_json() function examples

Let’s take some examples of using the `row_to_json()` function.

### 1\) Basic row_to_json() function example

The following example uses the `row_to_json()` function to convert a row into a JSON object:

```sql
SELECT row_to_json(row('John',20));
```

Output:

```text
      row_to_json
-----------------------
 {"f1":"John","f2":20}
(1 row)
```

In this example, we use the `row()` function to create a composite value made up of multiple columns.

The `row_to_json()` function returns an object whose keys are automatically generated f1 and f2 with the values from the composite values.

### 2\) Using the row_to_json() function with table data

We’ll use the `film` table from the [sample database](../postgresql-getting-started/postgresql-sample-database):

![](/postgresqltutorial/film.png)The following example uses the `row_to_json()` function to convert the `title` and `length` of each film in the `film` table into a JSON object:

```sql
SELECT
  row_to_json(t) film
FROM
  (
    SELECT
      title,
      length
    FROM
      film
    ORDER BY
      title
  ) t;
```

Output:

```text
                         film
------------------------------------------------------
 {"title":"Academy Dinosaur","length":86}
 {"title":"Ace Goldfinger","length":48}
 {"title":"Adaptation Holes","length":50}
 {"title":"Affair Prejudice","length":117}
 {"title":"African Egg","length":130}
 {"title":"Agent Truman","length":169}
...
```

How it works.

- The subquery retrieves the `title` and `length` from the `film` table.
- The outer query uses the `row_to_json()` to convert each row returned by the subquery into a JSON object.

Note that you can use a [common table expression](../postgresql-tutorial/postgresql-cte) (`CTE`) instead of a subquery to achieve the same result:

```sql
WITH film_cte AS (
  SELECT
    title,
    length
  FROM
    film
  ORDER BY
    title
)
SELECT
  row_to_json(film_cte)
FROM
  film_cte;
```

## Summary

- Use the `row_to_json()` function to convert an SQL composite value to a JSON object.


# Searching JSON Data

# jsonb_path_query

---
title: 'PostgreSQL jsonb_path_query() Function'
page_title: 'PostgreSQL jsonb_path_query() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL jsonb_path_query() function to query JSONB data using JSON path expressions.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_path_query/'
ogImage: ''
updatedOn: '2024-02-23T13:41:27+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL JSON Path'
  slug: 'postgresql-json-functions/postgresql-json-path'
nextLink:
  title: 'PostgreSQL jsonb_path_query_array() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_path_query_array'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_path_query()` function to query `JSONB` data using JSON path expressions.

## Introduction to the PostgreSQL jsonb_path_query() function

The `jsonb_path_query()` function allows you to query [JSONB](../postgresql-tutorial/postgresql-json) data based on a JSON path expression.

Here’s the basic syntax of the `jsonb_path_query()` function:

```sql
jsonb_path_query(jsonb_data, path_expression)
```

In this syntax:

- `jsonb_data` is the JSONB data that you want to query.
- `path_expression` is a JSON path expression that locates values or elements in the JSONB data.

The `jsonb_path_query()` function returns JSONB data that matches the specified JSON path expression.

If the `path_expression` does not locate any element in the `jsonb_data`, the function returns `NULL`.

## PostgreSQL jsonb_path_query() function example

Let’s take some examples of using the `jsonb_path_query()` function.

### Setting up a sample table

First, [create a table](../postgresql-tutorial/postgresql-create-table) named `products`with a JSONB column names `attributes` to store product attributes:

```sql
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    attributes JSONB
);
```

Second, [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `products` table:

```sql
INSERT INTO products (name, attributes)
VALUES
    ('Laptop', '{"brand": "Dell", "price": 1200, "specs": {"cpu": "Intel i7", "ram": "16GB"}}'),
    ('Smartphone', '{"brand": "Samsung", "price": 800, "specs": {"os": "Android", "storage": "128GB"}}');
```

### 1\) A basic jsonb_path_query() function example

The following example uses the `jsonb_path_query()` function to retrieve the brand and price of all products:

```sql
SELECT jsonb_path_query(attributes, '$.brand') AS brand,
       jsonb_path_query(attributes, '$.price') AS price
FROM products;
```

Output:

```text
   brand   | price
-----------+-------
 "Dell"    | 1200
 "Samsung" | 800
(2 rows)
```

### 2\) More complex JSON path example

The following example uses the `jsonb_path_query()` function to query nested attributes such as retrieving the CPU specification of laptops:

```sql
SELECT jsonb_path_query(attributes, '$.specs.cpu') AS cpu
FROM products;
```

Output:

```text
    cpu
------------
 "Intel i7"
(1 row)
```

## Summary

- Use the `jsonb_path_query()` function to query JSONB data based on JSON path expressions.


# jsonb_path_query_array

---
title: 'PostgreSQL jsonb_path_query_array() Function'
page_title: 'PostgreSQL jsonb_path_query_array() Function'
page_description: 'Use the PostgreSQL jsonb_path_query_array() function to query JSONB data using a JSON path and return matched elements as a JSON array.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_path_query_array/'
ogImage: ''
updatedOn: '2024-02-24T02:02:31+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_path_query() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_path_query'
nextLink:
  title: 'PostgreSQL jsonb_path_query_first() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_path_query_first'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_path_query_array()` function to query JSONB data using a JSON path and return matched elements as a JSON array.

## Introduction to PostgreSQL jsonb_path_query_array() function

The `jsonb_path_query_array()` function allows you to query [JSONB](../postgresql-tutorial/postgresql-json) data using a [JSON path expression](postgresql-json-path).

Here’s the basic syntax of the `jsonb_path_query_array()` function:

```sql
jsonb_path_query_array(jsonb_data, json_path)
```

In this syntax:

- First, specify the `jsonb_data` that you want to query.
- Second, provide a `json_path` that you want to match elements within the `jsonb_data`.

The `jsonb_path_query_array()` function returns the matched elements as a JSON array.

If the function does not find any matched element, it returns an empty array.

If either argument is `NULL`, the function returns `NULL`.

## PostgreSQL jsonb_path_query_array() function example

Let’s explore some examples of using the `jsonb_path_query_array()` function

### 1\) Basic PostgreSQL jsonb_path_query_array() function example

The following example uses the `jsonb_path_query_array()` function to get the employee names as an array:

```sql
SELECT
  jsonb_path_query_array(
    '{"employees": [{"name": "Alice", "age": 25}, {"name": "Bob", "age": 30}]}',
    '$.employees[*].name'
  );
```

Output:

```text
 jsonb_path_query_array
------------------------
 ["Alice", "Bob"]
(1 row)
```

In this example, the JSON path expression `$.employees[*].name` locates the value of the `name` key of all elements in the `employees` array.

### 2\) Using jsonb_path_query_array() function with table data

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `employees`:

```sql
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    data JSONB
);
```

In the `employees` table, the `data` column has the type of `JSONB`.

Second, [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `employees` table:

```sql
INSERT INTO employees (data) VALUES
    ('{"name": "Alice", "age": 30, "pets": [{"type": "cat", "name": "Fluffy"}, {"type": "dog", "name": "Buddy"}]}'),
    ('{"name": "Bob", "age": 35, "pets": [{"type": "dog", "name": "Max"}]}'),
    ('{"name": "Charlie", "age": 40, "pets": [{"type": "rabbit", "name": "Snowball"}]}')
RETURNING *;
```

Output:

```text
 id |                                                    data

----+-------------------------------------------------------------------------------------------------------------
  1 | {"age": 30, "name": "Alice", "pets": [{"name": "Fluffy", "type": "cat"}, {"name": "Buddy", "type": "dog"}]}
  2 | {"age": 35, "name": "Bob", "pets": [{"name": "Max", "type": "dog"}]}
  3 | {"age": 40, "name": "Charlie", "pets": [{"name": "Snowball", "type": "rabbit"}]}
(3 rows)
```

Third, use the `jsonb_path_query_array()` function to retrieve the pet names of employees as a JSON array:

```sql
SELECT jsonb_path_query_array(data, '$.pets[*].name') AS employee_pet_names
FROM employees;
```

Output:

```text
 employee_pet_names
---------------------
 ["Fluffy", "Buddy"]
 ["Max"]
 ["Snowball"]
(3 rows)
```

### 3\) Handling missing paths

If the specified path doesn’t exist in the `JSONB` data, the `jsonb_path_query_array()` function returns an empty array. For example:

```sql
SELECT jsonb_path_query_array(data, '$.address')
FROM employees;
```

Output:

```text
 jsonb_path_query_array
------------------------
 []
 []
 []
(3 rows)
```

In this example, the employee object doesn’t have an `address` key, so the result is an empty array.

## Summary

- Use the `jsonb_path_query_array()` function to query JSONB data using a JSON path and return matched elements as a JSON array.


# jsonb_path_query_first

---
title: 'PostgreSQL jsonb_path_query_first() Function'
page_title: 'PostgreSQL jsonb_path_query_first() Function'
page_description: 'Use the PostgreSQL jsonb_path_query_first() function to extract the first JSON value that matches a JSON path from a JSON document.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_path_query_first/'
ogImage: ''
updatedOn: '2024-02-24T02:56:19+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_path_query_array() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_path_query_array'
nextLink:
  title: 'PostgreSQL jsonb_path_exists() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_path_exists'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_path_query_first()` function to extract the first JSON value that matches a JSON path expression from a JSON document.

## Introduction to the PostgreSQL jsonb_path_query_first() function

The `jsonb_path_query_first()` function allows you to query data from a [JSONB document](../postgresql-tutorial/postgresql-json) based on a [JSON path](postgresql-json-path) expression and return the first match.

Here’s the basic syntax of the `jsonb_path_query_first()` function:

```sql
jsonb_path_query_first(jsonb_data, json_path)
```

In this syntax:

- First, specify a JSONB data from which you want to query data.
- Second, provide a JSON path to match elements in the JSONB data.

If the `jsonb_path_query_first()` function doesn’t find any match, it returns `NULL`.

## PostgreSQL jsonb_path_query_first() function examples

Let’s explore some examples of using the `jsonb_path_query_first()` function.

### 1\) Basic jsonb_path_query_first() function example

The following example uses the `jsonb_path_query_first()` function to get the first pet of a person:

```sql
SELECT jsonb_path_query_first(
    '{"name": "Alice", "pets": ["Lucy","Bella"]}',
    '$.pets[*]'
) AS first_pet_name;
```

Output:

```text
 first_pet_name
----------------
 "Lucy"
(1 row)
```

### 2\) Using the jsonb_path_query_first() function with table data

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `person`:

```sql
CREATE TABLE person (
    id SERIAL PRIMARY KEY,
    data JSONB
);
```

In the `person` table, the `data` column has the type of JSONB that stores employee information including name, age, and pets.

Second, [insert data](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `person` table:

```sql
INSERT INTO person (data)
VALUES
    ('{"name": "Alice", "age": 30, "pets": [{"type": "cat", "name": "Fluffy"}, {"type": "dog", "name": "Buddy"}]}'),
    ('{"name": "Bob", "age": 35, "pets": [{"type": "dog", "name": "Max"}]}'),
    ('{"name": "Charlie", "age": 40, "pets": [{"type": "rabbit", "name": "Snowball"}]}')
RETURNING *;
```

Third, retrieve the first pet name using the `jsonb_path_query_first()` function:

```sql
SELECT jsonb_path_query_first(data, '$.pets[*].name') AS first_pet_name
FROM person;
```

Output:

```text
 first_pet_name
----------------
 "Fluffy"
 "Max"
 "Snowball"
(3 rows)
```

### 3\) Handling missing paths

The following example attempts to find an element whose path does not exist:

```sql
SELECT jsonb_path_query_first(data, '$.email')
FROM person;
```

Output:

```text
 jsonb_path_query_first
------------------------
 null
 null
 null
(3 rows)
```

In this case, the person object doesn’t have an `email` key, therefore the result is `NULL`.

## Summary

- Use the `jsonb_path_query_first()` function to extract the first JSON value that matches a JSON path expression from a JSON document.


# jsonb_path_exists

---
title: 'PostgreSQL jsonb_path_exists() Function'
page_title: 'PostgreSQL jsonb_path_exists() Function'
page_description: 'You will learn how to use the PostgreSQL jsonb_path_exists() function to check if a JSON path returns any item for a specified JSON document.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_path_exists/'
ogImage: ''
updatedOn: '2024-02-23T14:26:51+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_path_query_first() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_path_query_first'
nextLink:
  title: 'PostgreSQL JSONB Operators'
  slug: 'postgresql-json-functions/postgresql-jsonb-operators'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_path_exists()` function to check if a JSON path returns any item for a specified JSON document.

## Introduction to the PostgreSQL jsonb_path_exists() function

The `jsonb_path_exists()` function allows you to check if a JSON path matches any element in a JSON document.

Here’s the syntax of the `jsonb_path_exists()` function:

```sql
jsonb_path_exists(jsonb_data, json_path)
```

In this syntax:

- `jsonb_data` is a JSON document where you want to check for a JSON path.
- `json_path` is the path that you want to check.

The `jsonb_path_exists()` function returns true if the `json_path` returns any elements in the `jsonb_data` document or false otherwise.

## PostgreSQL jsonb_path_exists() function example

Let’s take some examples of using the `jsonb_path_exists()` function.

### Setting up a sample table

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `products` that store product information:

```sql
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    attributes JSONB
);
```

The `products` table has the `attributes` column whose data type is `JSONB`.

Second, [insert rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `products` table:

```sql
INSERT INTO products (name, attributes)
VALUES
    ('Laptop', '{"brand": "Dell", "price": 1200, "specs": {"cpu": "Intel i7", "ram": "16GB"}}'),
    ('Smartphone', '{"brand": "Samsung", "price": 800, "specs": {"os": "Android", "storage": "128GB"}}')
RETURNING *;

```

Output:

```text
 id |    name    |                                     attributes

----+------------+------------------------------------------------------------------------------------
  1 | Laptop     | {"brand": "Dell", "price": 1200, "specs": {"cpu": "Intel i7", "ram": "16GB"}}
  2 | Smartphone | {"brand": "Samsung", "price": 800, "specs": {"os": "Android", "storage": "128GB"}}
(2 rows)
```

### 1\) Basic jsonb_path_exists() function example

The following example uses the `jsonb_path_exists()` function to check whether the CPU specification exists for any product:

```sql
SELECT name,
       jsonb_path_exists(attributes, '$.specs.cpu') AS cpu_exists
FROM products;
```

Output:

```text
    name    | cpu_exists
------------+------------
 Laptop     | t
 Smartphone | f
(2 rows)
```

### 2\) Using the jsonb_path_exists() function in the WHERE clause

The following example uses the `jsonb_path_exists()` function with the [`jsonb_path_query()`](postgresql-jsonb_path_query) function to retrieve the `CPU` specification of any products that have `CPU` spec:

```sql
SELECT jsonb_path_query(attributes, '$.specs.cpu') AS cpu
FROM products
WHERE jsonb_path_exists(attributes, '$.specs.cpu');
```

Output:

```text
    cpu
------------
 "Intel i7"
(1 row)
```

## Summary

- Use the `jsonb_path_exists()` function to check the existence of JSON Path expressions within JSONB data


# Querying JSON Data

# JSONB Operators

---
title: 'PostgreSQL JSONB Operators'
page_title: 'PostgreSQL JSONB Operators'
page_description: 'In this tutorial, you will learn about the most commonly used PostgreSQL JSONB operators to process JSONB data effectively.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb-operators/'
ogImage: ''
updatedOn: '2024-02-26T11:49:22+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_path_exists() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_path_exists'
nextLink:
  title: 'PostgreSQL jsonb_extract_path() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_extract_path'
---

**Summary**: in this tutorial, you will learn about the PostgreSQL JSONB operators and how to use them to process JSONB data effectively.

## Introduction to PostgreSQL JSONB operators

JSONB type allows you to store and query [JSON](../postgresql-tutorial/postgresql-json) data efficiently. JSONB type supports a wide range of operators that help you manipulate and query JSON documents effectively.

The following table illustrates the JSONB operators:

<table><thead><tr><th>Operator</th><th>Syntax</th><th>Meaning</th></tr></thead><tbody><tr><td><code>-&gt;</code></td><td><code>jsonb-&gt;'key'</code></td><td>Extract the value of the ‘key’ from a JSON object as a JSONB value</td></tr><tr><td><code>-&gt;&gt;</code></td><td><code>jsonb-&gt;&gt;'key'</code></td><td>Extract the value of the ‘key’ from a JSON object as a text string</td></tr><tr><td><code>@&gt;</code></td><td><code>jsonb @&gt; jsonb → boolean</code></td><td>Return true if the first JSONB value contains the second JSONB value or false otherwise.</td></tr><tr><td><code>&lt;@</code></td><td><code>jsonb &lt;@ jsonb → boolean</code></td><td>Return true if the first JSONB value is contained in the second one or false otherwise.</td></tr><tr><td><code>?</code></td><td><code>jsonb ? text → boolean</code></td><td>Return true if a text string exists as a top-level key of a JSON object or as an element of a JSON array or false otherwise.</td></tr><tr><td><code>?|</code></td><td><code>jsonb ?| text[] → boolean</code></td><td>Return true if any text string in an array exists as top-level keys of a JSON object or as elements of a JSON array.</td></tr><tr><td><code>?&amp;</code></td><td><code>jsonb ?&amp; text[] → boolean</code></td><td>Return true if all text strings in an array exist as top-level keys of a JSON object or as elements of a JSON array.</td></tr><tr><td><code>||</code></td><td><code>jsonb || jsonb → jsonb</code></td><td>Concatenate two JSONB values into one.</td></tr><tr><td><code>-</code></td><td><code>jsonb - text → jsonb</code></td><td>Delete a key (and its value) from a JSON object, or matching string value(s) from a JSON array.</td></tr><tr><td><code>-</code></td><td><code>jsonb - text[] → jsonb</code></td><td>Delete all matching keys or array elements from the left operand.</td></tr><tr><td><code>-</code></td><td><code>jsonb - integer → jsonb</code></td><td>Delete the array element with specified index (negative integers count from the end of the array).</td></tr><tr><td><code>#-</code></td><td><code>jsonb #- text[] → jsonb</code></td><td>Delete the field or array element at the specified path.</td></tr><tr><td><code>@?</code></td><td><code>jsonb @? jsonpath → boolean</code></td><td>Return true if a JSON path returns any item for the specified JSONB value.</td></tr><tr><td><code>@@</code></td><td><code>jsonb @@ jsonpath → boolean</code></td><td>Evaluate a JSON path against a JSONB value and return a boolean result based on whether the JSON path matches any items within the JSONB value</td></tr></tbody></table>

## PostgreSQL JSONB operators examples

Let’s set up a sample table and take some examples of using PostgreSQL JSONB operators.

### Setting up a table

First, [create a table](../postgresql-tutorial/postgresql-create-table) called `products` that has a JSONB column to store JSON data:

```csssql
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    data JSONB
);
```

Second, [insert rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `products` table:

```sql
INSERT INTO products (data)
VALUES
    ('{
        "name": "iPhone 15 Pro",
        "category": "Electronics",
        "description": "The latest iPhone with advanced features.",
        "brand": "Apple",
        "price": 999.99,
        "attributes": {
            "color": "Graphite",
            "storage": "256GB",
            "display": "6.1-inch Super Retina XDR display",
            "processor": "A15 Bionic chip"
        },
        "tags": ["smartphone", "iOS", "Apple"]
    }'),
    ('{
        "name": "Samsung Galaxy Watch 4",
        "category": "Electronics",
        "description": "A smartwatch with health tracking and stylish design.",
        "brand": "Samsung",
        "price": 349.99,
        "attributes": {
            "color": "Black",
            "size": "42mm",
            "display": "AMOLED display",
            "sensors": ["heart rate monitor", "ECG", "SpO2"]
        },
        "tags": ["smartwatch", "wearable", "Samsung"]
    }'),
    ('{
        "name": "Leather Case for iPhone 15 Pro",
        "category": "Accessories",
        "description": "Premium leather case for iPhone 15 Pro.",
        "brand": "Apple",
        "price": 69.99,
        "attributes": {
            "color": "Saddle Brown",
            "material": "Genuine leather",
            "compatible_devices": ["iPhone 15 Pro", "iPhone 15 Pro Max"]
        },
        "tags": ["phone case", "accessory", "Apple"]
    }'),
    ('{
        "name": "Wireless Charging Pad",
        "category": "Accessories",
        "description": "Fast wireless charger compatible with smartphones and smartwatches.",
        "brand": "Anker",
        "price": 29.99,
        "attributes": {
            "color": "White",
            "compatible_devices": ["iPhone", "Samsung Galaxy", "Apple Watch", "Samsung Galaxy Watch"]
        },
        "tags": ["accessory", "wireless charger"]
    }')
RETURNING *;
```

Output:

```text
                          data

----+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  1 | {"name": "iPhone 15 Pro", "tags": ["smartphone", "iOS", "Apple"], "brand": "Apple", "price": 999.99, "category": "Electronics", "attributes": {"color": "Graphite", "display": "6.1-inch Super Retina XDR display", "storage": "256GB", "processor": "A15 Bionic chip"}, "description": "The latest iPhone with advanced features."}
  2 | {"name": "Samsung Galaxy Watch 4", "tags": ["smartwatch", "wearable", "Samsung"], "brand": "Samsung", "price": 349.99, "category": "Electronics", "attributes": {"size": "42mm", "color": "Black", "display": "AMOLED display", "sensors": ["heart rate monitor", "ECG", "SpO2"]}, "description": "A smartwatch with health tracking and stylish design."}
  3 | {"name": "Leather Case for iPhone 15 Pro", "tags": ["phone case", "accessory", "Apple"], "brand": "Apple", "price": 69.99, "category": "Accessories", "attributes": {"color": "Saddle Brown", "material": "Genuine leather", "compatible_devices": ["iPhone 15 Pro", "iPhone 15 Pro Max"]}, "description": "Premium leather case for iPhone 15 Pro."}
  4 | {"name": "Wireless Charging Pad", "tags": ["accessory", "wireless charger"], "brand": "Anker", "price": 29.99, "category": "Accessories", "attributes": {"color": "White", "compatible_devices": ["iPhone", "Samsung Galaxy", "Apple Watch", "Samsung Galaxy Watch"]}, "description": "Fast wireless charger compatible with smartphones and smartwatches."}
(4 rows)
```

### 1\) Operator (\-\>) example

The operator `->` allows you to [extract a field as a JSONB value](postgresql-json-extract) from a JSON object by a key:

```sql
jsonb -> 'key' → jsonb
```

Note that the `key` is surrounded by a single quote because the key in a JSON object is a text string.

For example, the following query uses the operator `->` to get the product names from the `products` table:

```sql
SELECT
  data -> 'name' AS product_name
FROM
  products;
```

Output:

```text
           product_name
----------------------------------
 "iPhone 15 Pro"
 "Samsung Galaxy Watch 4"
 "Leather Case for iPhone 15 Pro"
 "Wireless Charging Pad"
(4 rows)
```

The return values are JSONB values.

### 2\) Operator (\-\>\>)

The operator `->>` allows you to [extract a field value as text](postgresql-json-extract) from a JSON object by a specified key:

```sql
jsonb ->> 'key' → text
```

For example, the following statement uses the operator `->>` to get the product names as text:

```sql
SELECT
  data ->> 'name' AS product_name
FROM
  products;
```

Output:

```text
          product_name
--------------------------------
 iPhone 15 Pro
 Samsung Galaxy Watch 4
 Leather Case for iPhone 15 Pro
 Wireless Charging Pad
(4 rows)
```

### 3\) Operator (\#\>)

The operator `#>` extracts a JSON object or an element at the specified path:

```sql
jsonb #> 'path' → jsonb
```

For example, the following statement uses the operator `#>` to extract the `attributes` object from the JSON object in the `data` column of the `products` table:

```sql
SELECT
  data #>'{attributes}' AS attributes
FROM
  products;
```

Output:

```text
                                                        attributes
---------------------------------------------------------------------------------------------------------------------------
 {"color": "Graphite", "display": "6.1-inch Super Retina XDR display", "storage": "256GB", "processor": "A15 Bionic chip"}
 {"size": "42mm", "color": "Black", "display": "AMOLED display", "sensors": ["heart rate monitor", "ECG", "SpO2"]}
 {"color": "Saddle Brown", "material": "Genuine leather", "compatible_devices": ["iPhone 15 Pro", "iPhone 15 Pro Max"]}
 {"color": "White", "compatible_devices": ["iPhone", "Samsung Galaxy", "Apple Watch", "Samsung Galaxy Watch"]}
(4 rows)
```

The following example uses the operator `#>` to extract the `color` field of the `attributes` object from the `data` column of the `products` table:

```sql
SELECT
  data #>'{attributes, color}' AS colors
FROM
  products;
```

Output:

```text
     colors
----------------
 "Graphite"
 "Black"
 "Saddle Brown"
 "White"
(4 rows)
```

### 4\) Operator (\#\>\>)

The operator `#>>` extracts a JSON object or element at a specified path as text:

```sql
json #>> text[] → text

```

For example, the following statement uses the operator (`#>>`) to extract the `color` from the `attributes` subobject of the `data` object as text strings:

```
SELECT
  data #>>'{attributes, color}' AS colors
FROM
  products;
```

Output:

```text
    colors
--------------
 Graphite
 Black
 Saddle Brown
 White
(4 rows)
```

### 5\) Operator @\>

The operator `@>` return true if a JSONB value contains another JSONB value or false otherwise:

```sql
jsonb @> jsonb → boolean
```

For example, the following statement uses the operator `@>` to retrieve the `products` in the `Electronics` category:

```sql
SELECT
  id,
  data ->> 'name' product_name
FROM
  products
WHERE
  data @> '{"category": "Electronics"}';
```

Output:

```text
 id |      product_name
----+------------------------
  1 | iPhone 15 Pro
  2 | Samsung Galaxy Watch 4
(2 rows)
```

### 6\) Operator \<@

The operator `<@` returns true if a JSON value is contained within the another JSONB value or false otherwise:

```sql
jsonb <@ jsonb → boolean
```

For example:

```sql
SELECT
  data ->> 'name' name,
  data ->> 'price' price
FROM
  products
WHERE
  '{"price": 999.99}' :: jsonb <@ data;
```

Output:

```text
     name      | price
---------------+--------
 iPhone 15 Pro | 999.99
(1 row)
```

### 7\) Operator \|\|

The operator `||` concatenates two JSONB values into a single one:

```sql
jsonb || jsonb → jsonb
```

For example, the following statement uses the operator `||` to concatenate two JSONB values into a single JSONB value:

```sql
SELECT
  '{"name": "iPad"}' :: jsonb ||
   '{"price": 799}' :: jsonb
AS product;
```

Output:

```text
            product
--------------------------------
 {"name": "iPad", "price": 799}
(1 row)
```

In this example, we use the [cast operator](../postgresql-tutorial/postgresql-cast) (`::`) to convert text strings into JSONB values before concatenating them into a single JSONB value.

### 8\) Operator (?)

The operator `?` returns true if a text string exists as a top\-level key of a JSON object or as an array element of a JSON array, or false otherwise:

```sql
jsonb ? text → boolean
```

For example, the following statement uses the operator (`?`) to retrieve the products whose `price` key exists as the top\-level key of the JSON object stored in the `data` column of the `products` table:

```sql
SELECT
  id,
  data ->> 'name' product_name,
  data ->> 'price' price
FROM
  products
WHERE
  data ? 'price';
```

Output:

```text
 id |          product_name          | price
----+--------------------------------+--------
  1 | iPhone 15 Pro                  | 999.99
  2 | Samsung Galaxy Watch 4         | 349.99
  3 | Leather Case for iPhone 15 Pro | 69.99
  4 | Wireless Charging Pad          | 29.99
(4 rows)
```

The following example uses the operator `?` to retrieve all products whose tags have the text `Apple`:

```sql
SELECT
  data ->> 'name' product_name,
  data ->> 'tags' tags
FROM
  products
WHERE
  data-> 'tags' ? 'Apple'
```

Output:

```text
          product_name          |                 tags
--------------------------------+--------------------------------------
 iPhone 15 Pro                  | ["smartphone", "iOS", "Apple"]
 Leather Case for iPhone 15 Pro | ["phone case", "accessory", "Apple"]
(2 rows)
```

### 9\) Operator (?\|)

The operator `?|` returns true if any elements in a text array exist as top\-level keys of a JSON object or as elements of a JSON array, or false otherwise:

```sql
jsonb ?| text[] → boolean
```

For example, the following statement uses the operator `?|` to retrieve products whose `attributes` have either the `storage` or `size` keys:

```sql
SELECT
  data ->> 'name' product_name,
  data ->> 'attributes' attributes
FROM
  products
WHERE
  data -> 'attributes' ?| array ['storage', 'size'];
```

Output:

```text
      product_name      |                                                        attributes
------------------------+---------------------------------------------------------------------------------------------------------------------------
 iPhone 15 Pro          | {"color": "Graphite", "display": "6.1-inch Super Retina XDR display", "storage": "256GB", "processor": "A15 Bionic chip"}
 Samsung Galaxy Watch 4 | {"size": "42mm", "color": "Black", "display": "AMOLED display", "sensors": ["heart rate monitor", "ECG", "SpO2"]}
(2 rows)
```

### 10\) Operator (?\&)

The operator `?&` returns true if all elements in a text array exist as the top\-level keys of a JSON object or as elements of a JSON array, or false otherwise:

```sql
jsonb ?& text[] → boolean
```

For example, the following statement uses the operator `?&` to retrieve the products whose `attributes` have both `color` or `storage` keys:

```sql
SELECT
  data ->> 'name' product_name,
  data ->> 'attributes' attributes
FROM
  products
WHERE
  data -> 'attributes' ?& array ['color', 'storage'];
```

Output:

```text
 product_name  |                                                        attributes
---------------+---------------------------------------------------------------------------------------------------------------------------
 iPhone 15 Pro | {"color": "Graphite", "display": "6.1-inch Super Retina XDR display", "storage": "256GB", "processor": "A15 Bionic chip"}
(1 row)
```

### 11\) Operator (\-)

The operator `-` allows you to delete a key/value pair from a JSON object or a matching string value from a JSON array:

```sql
jsonb - text → jsonb
```

The following example uses the operator (`-`) to remove the `name` key and its value from a JSONB object:

```sql
SELECT
  '{"name": "John Doe", "age": 22}' :: jsonb - 'name' result;
```

Output:

```text
   result
-------------
 {"age": 22}
(1 row)
```

The following example uses the operator (`-`) to remove the element `"API"` from a JSON array:

```sql
SELECT
  '["PostgreSQL", "API", "Web Dev"]' :: jsonb - 'API' result;
```

Output:

```text
          result
---------------------------
 ["PostgreSQL", "Web Dev"]
(1 row)
```

### 12\) Operator (\-)

The operator `-` also allows you to delete all matching keys (with their values) from a JSON object or matching elements from a JSON array:

```sql
jsonb - text[] → jsonb
```

The following example uses the operator (`-`) to remove the `age` and `email` keys and their values from a JSONB object:

```sql
SELECT
  '{"name": "John Doe", "age": 22, "email": "[[email protected]](../cdn-cgi/l/email-protection.html)"}' :: jsonb - ARRAY[ 'age',
  'email' ] result;
```

Output:

```text
        result
----------------------
 {"name": "John Doe"}
(1 row)
```

The following example uses the operator (`-`) to remove the element `"API"` and `"Web Dev"` from a JSON array:

```sql
SELECT
  '["PostgreSQL", "API", "Web Dev"]' :: jsonb - ARRAY['API','Web Dev'] result;
```

Output:

```text
     result
----------------
 ["PostgreSQL"]
(1 row)
```

### 13\) Operator (@?)

The operator `@?` returns true if a [JSON path](postgresql-json-path) returns any items for the specified JSONB value:

```sql
jsonb @? jsonpath → boolean
```

For example, the following uses the @? operator to retrieve the products whose prices are greater than `999`:

```sql
SELECT
  data ->> 'name' product_name
FROM
  products
WHERE
  data @? '$.price ? (@ > 999)';
```

Output:

```text
 product_name
---------------
 iPhone 15 Pro
(1 row)
```

In this example, we use the operator `@?` to check if the JSON path `'$.price ? (@ > 999)'` returns any element in the JSONB value of the data column.

### 14\) Operator (@@)

The operator (`@@`) evaluates a [JSON path](postgresql-json-path) against a JSONB value and returns a boolean result based on whether the JSON path matches any items within the JSONB value. If the result is not a boolean, then the `@@` operator returns `NULL`.

```sql
jsonb @@ jsonpath → boolean
```

For example, the following example returns null because the JSON path `'$.scores'` returns an array, not a boolean result:

```sql
SELECT ('{"scores": [1,2,3,4,5]}'::jsonb @@ '$.scores') result;
```

Output:

```text
 result
--------
 null
(1 row)
```

However, the following statement returns true because the JSON path `'$.scores[*] > 2'` matches the elements that are greater than 2\.

```sql
SELECT ('{"scores": [1,2,3,4,5]}'::jsonb @@ '$.scores[*] > 2') result;
```

Output:

```text
 result
--------
 t
(1 row)
```

Notice that the `'$.scores[*] > 2'` matches 3, 4, and 5 but it only considers the result of the first matched item, which is 3\.


# Extracting JSON Data

---
title: 'PostgreSQL JSON Extract'
page_title: 'PostgreSQL JSON Extract Operators: -> And ->>'
page_description: 'You will learn how to use the operators -> and ->> to extract an element from a JSON array or a value of a key from a JSON object.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-json-extract/'
ogImage: ''
updatedOn: '2024-02-23T10:18:42+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_extract_path_text() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_extract_path_text'
nextLink:
  title: 'PostgreSQL jsonb_insert() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_insert'
---

**Summary**: in this tutorial, you will learn how to use the operator `->` and `->>` to extract an element from a JSON array or a value of a key from a JSON object.

## Extracting elements from JSON arrays

To extract an element of a JSON array as a `JSONB` value, you use the `->` operator.

Here’s the syntax for using the `->` operator:

```phpsqlsql
json_array -> n
```

In this syntax, `n` locates the nth element in a JSON array. n can be positive or negative. If the n is negative, the operator `->` returns the element from the end of the array.

Note that the first element has an index of zero and the last element has an index of \-1\.

If the nth element does not exist, the operator `->` returns `null`. To extract an array element as a text string, you can use the `->>` operator:

```sql
json_array ->> n
```

## Extracting JSON array element examples

Let’s explore some examples of using the `->` and `->>` operators.

### 1\) Setting up a sample table

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `employees` to store employee data:

```sql
CREATE TABLE employees(
   id SERIAL PRIMARY KEY,
   name VARCHAR(255) NOT NULL,
   phones JSONB NOT NULL
);
```

Second, [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `employees` table:

```sql
INSERT INTO employees (name, phones)
VALUES
   ('John Doe', '["(408) 555-1111", "(408) 555-2222", "(408) 555-3333"]'),
   ('Jane Smith', '["(408) 666-1111", "(408) 666-2222", "(408) 666-3333"]')
RETURNING *;
```

Output:

```text
 id |    name    |                         phones
----+------------+--------------------------------------------------------
  1 | John Doe   | ["(408) 555-1111", "(408) 555-2222", "(408) 555-3333"]
  2 | Jane Smith | ["(408) 666-1111", "(408) 666-2222", "(408) 666-3333"]
(2 rows)
```

### 2\) Extracting the first array element example

The following example uses the \-\> operator to retrieve the first phone number of an employee with the name John Doe:

```sql
SELECT
  name,
  phones -> 0 phone
FROM
  employees
WHERE
  name = 'John Doe';
```

Output:

```text
   name   |      phone
----------+------------------
 John Doe | "(408) 555-1111"
(1 row)
```

In this example, we use the `->` operator with the index 0\. Therefore, the expression `phones -> 0` returns the first element in the `phones` array as a `JSONB` value.

To extract the first phone number as a text string, you can use the \-\>\> operator:

```sql
SELECT
  name,
  phones ->> 0 phone
FROM
  employees
WHERE
  name = 'John Doe';
```

Output:

```text
   name   |     phone
----------+----------------
 John Doe | (408) 555-1111
(1 row)
```

### 3\) Extracting the last array element example

The following example uses the `->` operator to retrieve the first phone number of an employee with the name `Jane Smith`:

```sql
SELECT
  name,
  phones -> -1 phone
FROM
  employees
WHERE
  name = 'Jane Smith';
```

Output:

```text
    name    |      phone
------------+------------------
 Jane Smith | "(408) 666-3333"
(1 row)
```

To extract the last phone number as a `JSONB` value, you can use the \-\>\> operator:

```sql
SELECT
  name,
  phones ->> -1 phone
FROM
  employees
WHERE
  name = 'Jane Smith';
```

Output:

```text
    name    |     phone
------------+----------------
 Jane Smith | (408) 666-3333
(1 row)
```

### 4\) Extracting an element that does not exist

The following example uses the `->` operator to retrieve the 4th phone number of an employee with the name `Jane Smith`:

```sql
SELECT
  name,
  phones -> 3 phone
FROM
  employees
WHERE
  name = 'Jane Smith';
```

Output:

```text
    name    | phone
------------+-------
 Jane Smith | null
(1 row)
```

Since Jane Smith has 3 phone numbers only, the query returns `NULL`.

## Extracting object value

To extract a value of a JSON object by a key, you use the \-\> operator:

```sql
object -> 'key'
```

The \-\> operator returns the value of the ‘key’ as a JSONB value. If the key does not exist, the \-\> operator returns null.

If you want to return the value as an SQL value, you can use the \-\>\> operator:

```sql
object ->> 'key'
```

## Extracting JSON object value example

### 1\) Setting up a sample table

First, create a new table called `requests`:

```sql
CREATE TABLE requests(
   id SERIAL PRIMARY KEY,
   employee_id INT NOT NULL,
   request_date DATE NOT NULL,
   data JSONB NOT NULL
);
```

Second, insert some rows into the `requests` table:

```
INSERT INTO requests (request_date, employee_id, data)
VALUES
   ('2024-02-23',1, '{"current_position": "Software Engineer", "new_position": "Senior Software Engineer", "effective_date": "2024-03-01"}'),
   ('2024-02-24',2, '{"current_position": "Data Analyst", "new_position": "Senior Data Analyst", "effective_date": "2024-03-15"}'),
   ('2024-02-25',3, '{"current_position": "Marketing Manager", "new_position": "Senior Marketing Manager", "effective_date": "2024-04-01"}')
RETURNING *;
```

Output:

```text
 id | employee_id | request_date |                                                         data
----+-------------+--------------+-----------------------------------------------------------------------------------------------------------------------
  1 |           1 | 2024-02-23   | {"new_position": "Senior Software Engineer", "effective_date": "2024-03-01", "current_position": "Software Engineer"}
  2 |           2 | 2024-02-24   | {"new_position": "Senior Data Analyst", "effective_date": "2024-03-15", "current_position": "Data Analyst"}
  3 |           3 | 2024-02-25   | {"new_position": "Senior Marketing Manager", "effective_date": "2024-04-01", "current_position": "Marketing Manager"}
(3 rows)
```

### 2\) Extract a value from a JSON object

The following example uses the `->` operator to extract the current position of the request of employee ID 1:

```sql
SELECT
  data -> 'current_position' current_position
FROM
  requests
WHERE
  employee_id = 1;
```

Output:

```text
  current_position
---------------------
 "Software Engineer"
(1 row)
```

The return value is a JSONB value.

To get the current position as a text string, you can use the `->>` operator:

```sql
SELECT
  data ->> 'current_position' current_position
FROM
  requests
WHERE
  employee_id = 1;
```

Output:

```text
 current_position
-------------------
 Software Engineer
(1 row)
```

### 2\) Extract a key that does not exist

The following example attempts to extract a value of a non\-existing key from a JSON object:

```
SELECT
  data ->> 'position' position
FROM
  requests
WHERE
  employee_id = 1;
```

Output:

```
 position
----------
 null
(1 row)
```

## Summary

- Use the `json_array -> n` and `json_array ->> n` operator to extract a JSON array element as a `JSONB` value or as a text string specified by an index.
- Use the `json_object -> 'key'` and `json_object ->> 'key'` operator to extract a value from an object specified by a key as a JSONB value and a text string.


# jsonb_extract_path

---
title: 'PostgreSQL jsonb_extract_path() Function'
page_title: 'PostgreSQL jsonb_extract_path() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL jsonb_extract_path() function to extract JSON sub-object at the specified path.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_extract_path/'
ogImage: ''
updatedOn: '2024-02-24T14:20:37+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL JSONB Operators'
  slug: 'postgresql-json-functions/postgresql-jsonb-operators'
nextLink:
  title: 'PostgreSQL jsonb_extract_path_text() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_extract_path_text'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_extract_path()` function to extract a JSON subobject at the specified path.

## Introduction to the PostgreSQL jsonb_extract_path() function

The `jsonb_extract_path()` function allows you to extract a JSON sub\-object from a JSONB value at a specified path.

Here’s the basic syntax of the `jsonb_extract_path()` function:

```sql
jsonb_extract_path(target jsonb, VARIADIC path_elems text[])
```

In this syntax:

- `target` is a JSONB data from which you want to extract data.
- `path_elems` is a list of paths that you want to locate the elements in the JSONB data for extraction.

Note that the path is not a JSON path. The syntax for the `path_elems` parameter is as follows:

- `'key'`: Access a specific key in the JSON object.
- ‘`array_index`‘: Access an element in a JSON array using its index.

To navigate through the nested objects or array, you can chain these path components together.

Suppose you have the following JSON object:

```sql
{
  "employee": {
    "name": "John Doe",
    "age": 22,
    "contacts": [
      {"type": "email", "value": "[[email protected]](../cdn-cgi/l/email-protection.html)"},
      {"type": "phone", "value": "408-123-456"}
    ]
  }
}
```

Here are some examples of the path expressions:

- `'employee'` returns the entire `employee` object.
- `['employee', 'name']` returns the name within the employee object, which is `"John Doe"`.
- `['employee', 'contacts', '0', 'value']` returns the value in the first element of the contacts array, which is `[[email protected]](../cdn-cgi/l/email-protection.html)`

## PostgreSQL jsonb_extract_path() function examples

Let’s take some examples of using the `jsonb_extract_path()` function.

### Setting up a sample table

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `documents`:

```sql
CREATE TABLE documents(
   id SERIAL PRIMARY KEY,
   data JSONB
);
```

Second, [insert two rows](../postgresql-tutorial/postgresql-insert) into the `documents` table:

```sql
INSERT INTO documents(data)
VALUES
  ('{"employee":{"name":"John Doe","age":22,"contacts":[{"type":"email","value":"[[email protected]](../cdn-cgi/l/email-protection.html)"},{"type":"phone","value":"408-123-456"}]}}'),
  ('{"employee":{"name":"Jane Doe","age":21,"contacts":[{"type":"email","value":"[[email protected]](../cdn-cgi/l/email-protection.html)"},{"type":"phone","value":"408-123-789"}]}}');
```

### Basic jsonb_extract_path() function examples

The following example uses the `jsonb_extract_path()` function to extract the employee object:

```sql
SELECT
  jsonb_extract_path(data, 'employee') employee
FROM
  documents;
```

Output:

```text
                                                                 employee
-------------------------------------------------------------------------------------------------------------------------------------------
 {"age": 22, "name": "John Doe", "contacts": [{"type": "email", "value": "[[email protected]](../cdn-cgi/l/email-protection.html)"}, {"type": "phone", "value": "408-123-456"}]}
 {"age": 21, "name": "Jane Doe", "contacts": [{"type": "email", "value": "[[email protected]](../cdn-cgi/l/email-protection.html)"}, {"type": "phone", "value": "408-123-789"}]}
(2 rows)
```

The following example uses the `jsonb_extract_path()` function to extract the names of employees:

```sql
SELECT
  jsonb_extract_path(data, 'employee', 'name') name
FROM
  documents;
```

Output:

```text
    name
------------
 "John Doe"
 "Jane Doe"
(2 rows)
```

The following example uses the `jsonb_extract_path()` function to extract the emails of employees:

```sql
SELECT
  jsonb_extract_path(
    data, 'employee', 'contacts', '0',
    'value'
  ) email
FROM
  documents;
```

Output:

```text
        email
---------------------
 "[[email protected]](../cdn-cgi/l/email-protection.html)"
 "[[email protected]](../cdn-cgi/l/email-protection.html)"
(2 rows)
```

## Summary

- Use the `jsonb_extract_path()` function to extract JSON sub\-object at the specified path.


# jsonb_extract_path_text

---
title: 'PostgreSQL jsonb_extract_path_text() Function'
page_title: 'PostgreSQL jsonb_extract_path_text() Function'
page_description: 'You will learn how to use the PostgreSQL jsonb_extract_path_text() function to extract a JSON subobject at the specified path.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_extract_path_text/'
ogImage: ''
updatedOn: '2024-02-25T00:07:27+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_extract_path() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_extract_path'
nextLink:
  title: 'PostgreSQL JSON Extract'
  slug: 'postgresql-json-functions/postgresql-json-extract'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_extract_path_text()` function to extract a JSON subobject at the specified path.

## Introduction to the PostgreSQL jsonb_extract_path_text() function

The `jsonb_extract_path_text()` function allows you to extract a [JSON](../postgresql-tutorial/postgresql-json) subobject as text from a JSONB value at a specified path.

The following shows the basic syntax of the `jsonb_extract_path_text()` function:

```sql
jsonb_extract_path_text(
    target jsonb,
    VARIADIC path_elems text[]
)
```

In this syntax:

- `target` is a JSONB data from which you want to extract data as text.
- `path_elems` is a list of paths that you want to locate the elements in the JSONB data for extraction.

Here’s the syntax for the `path_elems` parameter:

- `'key'`: Access a specific key in a JSON object.
- ‘`array_index`‘: Access an element in a JSON array using its index.

Additionally, you can chain these path components together to navigate through the nested objects or arrays.

For example, suppose you have the following JSON object:

```sql
{
  "employee": {
    "name": "John Doe",
    "age": 22,
    "contacts": [
      {"type": "email", "value": "[[email protected]](../cdn-cgi/l/email-protection.html)"},
      {"type": "phone", "value": "408-123-456"}
    ]
  }
}
```

Here are some examples of the path expressions:

- `'employee'` returns the entire `employee` object.
- `['employee', 'name']` returns the name within the employee object, which is `"John Doe"`.
- `['employee', 'contacts', '0', 'value']` returns the value in the first element of the `contacts` array, which is `[[email protected]](../cdn-cgi/l/email-protection.html)`

## PostgreSQL jsonb_extract_path_text() function examples

Let’s explore some examples of using the `jsonb_extract_path_text()` function.

### Setting up a sample table

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `documents`:

```sql
CREATE TABLE documents(
   id SERIAL PRIMARY KEY,
   data JSONB
);
```

Second, [insert two rows](../postgresql-tutorial/postgresql-insert) into the `documents` table:

```sql
INSERT INTO documents(data)
VALUES
  ('{"employee":{"name":"John Doe","age":22,"contacts":[{"type":"email","value":"[[email protected]](../cdn-cgi/l/email-protection.html)"},{"type":"phone","value":"408-123-456"}]}}'),
  ('{"employee":{"name":"Jane Doe","age":21,"contacts":[{"type":"email","value":"[[email protected]](../cdn-cgi/l/email-protection.html)"},{"type":"phone","value":"408-123-789"}]}}');
```

### Basic jsonb_extract_path_text() function examples

The following example uses the `jsonb_extract_path_text()` function to extract the employee object:

```sql
SELECT
  jsonb_extract_path_text(data, 'employee') employee
FROM
  documents;
```

Output:

```text
                                                                 employee
-------------------------------------------------------------------------------------------------------------------------------------------
 {"age": 22, "name": "John Doe", "contacts": [{"type": "email", "value": "[[email protected]](../cdn-cgi/l/email-protection.html)"}, {"type": "phone", "value": "408-123-456"}]}
 {"age": 21, "name": "Jane Doe", "contacts": [{"type": "email", "value": "[[email protected]](../cdn-cgi/l/email-protection.html)"}, {"type": "phone", "value": "408-123-789"}]}
(2 rows)
```

The following example uses the `jsonb_extract_path_text()` function to extract the names of employees:

```sql
SELECT
  jsonb_extract_path_text(data, 'employee', 'name') name
FROM
  documents;
```

Output:

```text
   name
----------
 John Doe
 Jane Doe
(2 rows)
```

The following example uses the `jsonb_extract_path_text()` function to extract the emails of employees:

```sql
SELECT
  jsonb_extract_path_text(
    data, 'employee', 'contacts', '0',
    'value'
  ) email
FROM
  documents;
```

Output:

```text
       email
-------------------
 [[email protected]](../cdn-cgi/l/email-protection.html)
 [[email protected]](../cdn-cgi/l/email-protection.html)
(2 rows)

```

## Summary

- Use the `jsonb_extract_path_text()` function to extract JSON subobject as text at the specified path.


# Modifying JSON Data

# jsonb_insert

---
title: 'PostgreSQL jsonb_insert() Function'
page_title: 'PostgreSQL jsonb_insert() Function'
page_description: 'How to use the PostgreSQL jsonb_insert() function to insert a new element into a JSON array or a key/value pair into a JSON object.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_insert/'
ogImage: ''
updatedOn: '2024-02-25T01:22:46+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL JSON Extract'
  slug: 'postgresql-json-functions/postgresql-json-extract'
nextLink:
  title: 'PostgreSQL jsonb_set() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_set'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_insert()` function to insert a new element into a JSON array or a key/value pair into a JSON object.

## Introduction to the PostgreSQL jsonb_insert() function

The `jsonb_insert()` function allows you to insert new values into a [JSON](../postgresql-tutorial/postgresql-json) document of the JSONB type.

More specifically, the `jsonb_insert()` function allows you to add a new element into an array or a new key/value pair into an object, or nested combinations of them.

Here’s the syntax of the `jsonb_insert()` function:

```phpsqlsql
jsonb_insert(
   target jsonb,
   path text[],
   new_value jsonb,
   [insert_after boolean]
) → jsonb
```

In this syntax:

- `target`: The JSON document of the JSONB type into which you want to insert a new value.
- `path`: This is an array of text elements that specifies the path where you want to insert the new value.
- `new_value` is the new value that you want to insert into the JSON document.
- `insert_after`: This is an optional boolean parameter indicating whether you want to insert the new value after the specified path instead of before. It defaults to `false`, meaning that the function will insert a new value before the specified path.

The `jsonb_insert()` function returns a new JSON document with the `new_value` inserted before/after the specified `path`.

## PostgreSQL jsonb_insert() function examples

Let’s take some examples of using the PostgreSQL `jsonb_insert()` function

### 1\) Inserting a new element into a JSON array

The following example uses the `jsonb_insert()` function to insert a new element into a JSON array:

```text
 SELECT jsonb_insert('[1,2,3]', '{0}', '0');
```

Output:

```text
 jsonb_insert
--------------
 [0, 1, 2, 3]
(1 row)
```

In this example:

- The original array is `[1,2,3]`.
- The path `\{0\}` indicates the first element of the array.
- The number 0 is the new value.

The `jsonb_insert()` function inserts the number 0 before the first element of the array.

To insert the number 0 after the first position, you set the `insert_after` parameter to true as follows:

```sql
SELECT jsonb_insert('[1,2,3]', '{0}', '0', true);
```

Output:

```text
 jsonb_insert
--------------
 [1, 0, 2, 3]
(1 row)
```

### 2\) Inserting a new element into a nested JSON array

The following example uses the `jsonb_insert()` function to insert a new element into a nested array:

```sql
SELECT
  jsonb_insert(
    '[1,2,[4,5],6]', '{2,0}', '3'
  );
```

Output:

```text
     jsonb_insert
----------------------
 [1, 2, [3, 4, 5], 6]
(1 row)
```

In this example:

- The original array is `\[1,2,\[3,4],6]`.
- The path `\{2, 0\}`, `2` specifies the second element of the array which is the nested array `\[3,4]`, and `0` specifies the first element of the nested array.
- `3` is the new value.

Therefore the `jsonb_insert()` function inserts the new value 3 before the first element of the nested array.

### 3\) Inserting a new element into a JSON object

The following example uses the `jsonb_insert()` to add a new key/value pair to a JSON object:

```sql
SELECT
  jsonb_insert('{"name": "John"}', '{age}', '2');
```

Output:

```text
        jsonb_insert
----------------------------
 {"age": 2, "name": "John"}
(1 row)
```

In this example:

- `\{“name”: “John”\}` is the original object.
- `\{age\}` is the path that indicates the age property (or key).
- `2` is the new value to insert.

Therefore, the `jsonb_insert()` inserts the age property with value 2 into the JSON object.

Note that if you attempt to insert a key that already exists, you’ll get an error. For example:

```sql
SELECT jsonb_insert('{"name": "John"}', '{name}', '"Jane"');
```

Output:

```
ERROR:  cannot replace existing key
HINT:  Try using the function jsonb_set to replace key value.
```

In this case, you need to use the `jsonb_set()` function to replace the key value.

### 4\) Inserting a new element into a nested JSON object

The following example uses the `jsonb_insert()` to add a new key/value pair to a nested JSON object:

```
SELECT
  jsonb_insert(
    '{"name":"John Doe", "address" : { "city": "San Francisco"}}',
    '{address,state}',
    '"California"'
  );
```

Output:

```text
                                   jsonb_insert
-----------------------------------------------------------------------------------
 {"name": "John Doe", "address": {"city": "San Francisco", "state": "California"}}
(1 row)
```

In this example:

- `\{“name”:”John Doe”, “address” : \{ “city”: “San Francisco”\}\}` is the original JSON object.
- `\{address, state\}` is a path that specifies the address key whose value is an object and state is the new key of the address object.
- “California” is the value of the state key.

Therefore, the `jsonb_insert()` function inserts the state with the value California to the address object of the JSON document.

Note that to beautify the output, you can use the `jsonb_pretty()` function:

```sql
SELECT
  jsonb_pretty(jsonb_insert(
    '{"name":"John Doe", "address" : { "city": "San Francisco"}}',
    '{address,state}',
    '"California"'
  ));
```

Output:

```text
           jsonb_pretty
----------------------------------
 {                               +
     "name": "John Doe",         +
     "address": {                +
         "city": "San Francisco",+
         "state": "California"   +
     }                           +
 }
(1 row)
```

### 5\) Inserting a new element into an array of a nested object

The following example uses the `jsonb_insert()` to add a new element into an array of a nested object

```sql
SELECT
  jsonb_insert(
    '{"name": "John", "skills" : ["PostgreSQL", "API"]}',
    '{skills,1}', '"Web Dev"'
  );
```

Output:

```text
                         jsonb_insert
--------------------------------------------------------------
 {"name": "John", "skills": ["PostgreSQL", "Web Dev", "API"]}
(1 row)
```

In this example:

- `\{“name”: “John”, “skills” : \[“PostgreSQL”, “API”\]\}` is the original JSON object.
- `\{skills,1\}` is a path that specifies the skills key, which is an array, and 1 specifies the second element of the array.
- “Web Dev” is the new value to insert.

The `jsonb_insert()` function inserts the “Web Dev” before the second element of the skills array of the JSON object.

### 6\) Using the PostgreSQL jsonb_insert() function with table data

We’ll show you how to use the `jsonb_insert()` function to insert a new value into a JSON document and update it back to a table.

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `employee_profiles`:

```sql
CREATE TABLE employee_profiles(
    id INT PRIMARY KEY,
    profiles JSONB
);
```

Second, [insert rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `employee_profiles` table:

```sql
INSERT INTO employee_profiles(id, profiles)
VALUES
   (1, '{"name": "John", "skills" : ["PostgreSQL", "API"]}'),
   (2, '{"name": "Jane", "skills" : ["SQL","Java"]}')
RETURNING *;
```

Output:

```text
 id |                     profiles
----+---------------------------------------------------
  1 | {"name": "John", "skills": ["PostgreSQL", "API"]}
  2 | {"name": "Jane", "skills": ["SQL", "Java"]}
(2 rows)
```

Third, add the “Web Dev” skill to the employee with the id 1:

```sql
UPDATE
  employee_profiles
SET
  profiles = jsonb_insert(
    profiles, '{skills,0}', '"Web Dev"'
  )
WHERE
  id = 1
RETURNING *;
```

Output:

```text
 id |                           profiles
----+--------------------------------------------------------------
  1 | {"name": "John", "skills": ["Web Dev", "PostgreSQL", "API"]}
(1 row)
```

## Summary

- Use the `jsonb_insert()` function to insert a new value into a JSON document of the type JSONB.


# jsonb_set

---
title: 'PostgreSQL jsonb_set() Function'
page_title: 'PostgreSQL jsonb_set() Function'
page_description: 'How to use the PostgreSQL jsonb_set() function to replace an existing value specified by a path with a new value in a JSON document.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_set/'
ogImage: ''
updatedOn: '2024-02-25T02:21:21+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_insert() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_insert'
nextLink:
  title: 'PostgreSQL jsonb_strip_nulls() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_strip_nulls'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_set()` function to replace an existing value specified by a path with a new value in a JSON document.

## Introduction to the PostgreSQL jsonb_set() function

The `jsonb_set()` function allows you to replace an existing value specified by a path with a new value in a [JSON](../postgresql-tutorial/postgresql-json) document of the JSONB type.

More specifically, the `jsonb_set()` function allows you to replace an array element or key/value in a JSON object, or nested combinations of them.

Here’s the syntax of the `jsonb_set()` function:

```sqlsql
jsonb_set(
   target jsonb,
   path text[],
   new_value jsonb
   [, create_missing boolean]
)
```

In this syntax:

- `target`: This is the original JSON document of the JSONB type that you want to modify.
- `path`: This is an array of text elements that specifies the path to the key where you want to insert or update the data.
- `new_value` is the new JSONB value that you want to set at the specified path.
- `create_missing`: This is an optional boolean parameter indicating whether you want to create missing keys if they do not exist. It defaults to true, meaning that the function will create a new key if you attempt to set it for a key that does not exist.

The `jsonb_set()` function returns the modified JSON document with the `new_value` set at a specified `path`.

## PostgreSQL jsonb_set() function examples

Let’s explore some examples of using the PostgreSQL `jsonb_set()` function

### 1\) Updating an existing element in a JSON array

The following example uses the `jsonb_set()` function to update an existing element in a JSON array:

```text
 SELECT jsonb_set('[1,2,3]', '{0}', '-1');
```

Output:

```text
 jsonb_set
------------
 [-1, 2, 3]
(1 row)
```

In this example:

- The original array is `[1,2,3]`.
- The path `{0}` indicates the first element of the array.
- The number `-1` is the new value.

The `jsonb_set()` function sets the first element of the array to \-1 and returns the modified document.

To insert the number 4 after the 3rd element, you use a non\-existing path to the 4th element as follows:

```text
 SELECT jsonb_set('[1,2,3]', '{4}', '4');
```

Output:

```text
  jsonb_set
--------------
 [1, 2, 3, 4]
(1 row)
```

### 2\) Updating an element in a nested JSON array

The following example uses the `jsonb_set()` function to update an element in a nested array:

```sql
SELECT
  jsonb_set(
    '[1,2,[4,5],6]', '{2,0}', '3'
  );
```

Output:

```text
     jsonb_set
-------------------
 [1, 2, [3, 5], 6]
(1 row)

```

In this example:

- The original array is \[1,2,\[4,5],6].
- The path {2, 0}, 2 specifies the second element of the array which is the nested array \[4,5], and 0 specifies the first element of the nested array.
- 3 is the new value.

Therefore the `jsonb_set()` function changes the number 4 as the first element of the nested array \[4,5] to 3\.

### 3\) Updating data in a JSON object

The following example uses the `jsonb_set()` to update the value of a key in a JSON object:

```sql
SELECT
  jsonb_set('{"name": "Jane Doe"}', '{name}', '"Jane Smith"');
```

Output:

```text
       jsonb_set
------------------------
 {"name": "Jane Smith"}
(1 row)

```

In this example:

- `\{“name”: “Jane Doe”\}` is the original object.
- `\{name\}` is the path that indicates the name property (or key).
- “Jane Smith” is the new value to update.

Therefore, the `jsonb_set()` set the value of the `name` key in the JSON object to “Jane Smith”.

Note that if you attempt to set a key that does not exist, you’ll get an error, the jsonb_set will insert it. For example:

```sql
SELECT jsonb_set('{"name": "Jane Doe"}', '{age}', '25');
```

Output:

```text
            jsonb_set
---------------------------------
 {"age": 25, "name": "Jane Doe"}
(1 row)
```

But if you set the `create_missing` parameter to false, the function will not insert a new key/value pair:

```sql
SELECT
  jsonb_set(
    '{"name": "Jane Doe"}', '{age}',
    '25',
    false
  );

```

Output:

```text
      jsonb_set
----------------------
 {"name": "Jane Doe"}
(1 row)

```

### 4\) Updating a value in a nested JSON object

The following example uses the `jsonb_set()` to modify a key/value pair in a nested JSON object:

```
SELECT
  jsonb_set(
    '{"name":"John Doe", "address" : { "city": "San Francisco"}}',
    '{address,city}', '"San Jose"'
  );
```

Output:

```text
                       jsonb_set
-------------------------------------------------------
 {"name": "John Doe", "address": {"city": "San Jose"}}
(1 row)
```

In this example:

- `{"name":"John Doe", "address" : { "city": "San Francisco"}}` is the original JSON object.
- `{address, city}` is a path that specifies the `address` key whose value is an object and the `city` is the key of the `address` object that will be modified.
- `"San Jose"` is the value of the `city` key.

Therefore, the `jsonb_set()` function updates the `city` with the value `San Jose` in the `address` object of the JSON document.

### 5\) Updating an element in an array of a nested object

The following example uses the `jsonb_set()` to update an element in an array of a nested object

```sql
SELECT
  jsonb_set(
    '{"name": "John", "skills" : ["PostgreSQL", "API"]}',
    '{skills,1}',
    '"Web Dev"'
  );
```

Output:

```text
                       jsonb_set
-------------------------------------------------------
 {"name": "John", "skills": ["PostgreSQL", "Web Dev"]}
(1 row)

```

In this example:

- `{"name": "John", "skills" : ["PostgreSQL", "API"]}` is the original JSON object.
- `{skills,1}` is a path that specifies the skills key, which is an array, and 1 specifies the second element of the array.
- `"Web Dev"` is the new value to update.

The `jsonb_set()` function sets the second element of the skills array to `"Web Dev"`.

### 6\) Using the PostgreSQL jsonb_set() function with table data

We’ll show you how to use the `jsonb_set()` function to insert a new value into a JSON document and update it back to a table.

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `employee_skills`:

```sql
CREATE TABLE employee_skills(
    id INT PRIMARY KEY,
    data JSONB
);
```

Second, [insert rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `employee_skills` table:

```sql
INSERT INTO employee_skills(id, data)
VALUES
   (1, '{"name": "John", "skills" : ["PostgreSQL", "API"]}'),
   (2, '{"name": "Jane", "skills" : ["SQL","Java"]}')
RETURNING *;
```

Output:

```text
 id |                       data
----+---------------------------------------------------
  1 | {"name": "John", "skills": ["PostgreSQL", "API"]}
  2 | {"name": "Jane", "skills": ["SQL", "Java"]}
(2 rows)
```

Third, replace the first skill in the skills array of the employee id 1 with the new skill `"Web Dev"`:

```sql
UPDATE
  employee_skills
SET
  data = jsonb_set(
    data, '{skills,0}', '"Web Dev"'
  )
WHERE
  id = 1
RETURNING *;
```

Output:

```text
 id |                      data
----+------------------------------------------------
  1 | {"name": "John", "skills": ["Web Dev", "API"]}
(1 row)

```

## Summary

- Use the `jsonb_set()` function to update a JSON document of the type JSONB.


# jsonb_strip_nulls

---
title: 'PostgreSQL jsonb_strip_nulls() Function'
page_title: 'PostgreSQL json_strip_nulls() Function'
page_description: 'You will learn how to use the PostgreSQL jsonb_strip_nulls() function to recursively delete all object fields that have null values.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_strip_nulls/'
ogImage: ''
updatedOn: '2024-02-24T01:33:41+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_set() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_set'
nextLink:
  title: 'PostgreSQL jsonb_array_length() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_array_length'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_strip_nulls()` function to recursively delete all object fields that have null values.

## Introduction to the PostgreSQL jsonb_strip_nulls() function

The `jsonb_strip_nulls()` function accepts a JSON document with the [JSONB](../postgresql-tutorial/postgresql-json) type and recursively deletes all object fields that have null values. It does not delete non\-object fields with null values.

Here’s the syntax of the `jsonb_strip_nulls()` function:

```sql
jsonb_strip_nulls(jsonb_data)
```

In this syntax, you specify a JSON document in which you want to delete all object fields with null values. The `jsonb_data` must have the type `JSONB`.

The `jsonb_strip_nulls` returns a new `jsonb_data` whose object fields with null values are removed.

If the `jsonb_data` is null, the function returns `NULL`.

## PostgreSQL jsonb_strip_nulls() function example

Let’s take some examples of using the `jsonb_strip_nulls()` function.

### 1\) Basic jsonb_strip_nulls() function example

The following example uses the `jsonb_strip_nulls()` function to remove object fields with null values:

```sql
SELECT
  jsonb_strip_nulls(
    '{"first_name": "John", "middle_name":null, "last_name": "Doe", "scores": [null, 4, 5]}'
  );
```

Output:

```text
                         jsonb_strip_nulls
--------------------------------------------------------------------
 {"scores": [null, 4, 5], "last_name": "Doe", "first_name": "John"}
(1 row)
```

In this example, the object field `middle_name` has a null value therefore the `jsonb_strip_nulls()` function removes it. The `scores` array also has null but it is a non\-object field, therefore, the `jsonb_strip_nulls()` function does not delete it.

### 2\) Using the jsonb_strip_nulls() function to recursively delete object fields with null values

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `products`:

```sql
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    attributes JSONB
);
```

Second, [insert data](../postgresql-tutorial/postgresql-insert) into the `products` table:

```sql
INSERT INTO products (name, attributes)
VALUES
  (
    'Smartwatch', '{
  "id": 1,
  "name": "Laptop",
  "specs": {
    "cpu": "Intel i7",
    "ram": null,
    "gpu": "Nvidia GTX 1650",
    "extras": {
      "bluetooth": null,
      "fingerprint_reader": true,
      "webcam": null
    }
  }
}'
) RETURNING *;
```

Output:

```text
 id |    name    |                                                                                 attributes

----+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  1 | Smartwatch | {"id": 1, "name": "Laptop", "specs": {"cpu": "Intel i7", "gpu": "Nvidia GTX 1650", "ram": null, "extras": {"webcam": null, "bluetooth": null, "fingerprint_reader": true}}}
(1 row)
```

Third, use the `jsonb_strip_nulls()` function to remove all fields with null values recursively from the specs object and its nested object:

```sql
SELECT jsonb_strip_nulls(attributes) AS cleaned_attributes
FROM products;
```

Output:

```text
                                                     cleaned_attributes
-----------------------------------------------------------------------------------------------------------------------------
 {"id": 1, "name": "Laptop", "specs": {"cpu": "Intel i7", "gpu": "Nvidia GTX 1650", "extras": {"fingerprint_reader": true}}}
(1 row)
```

The output indicates that the `ram` field and the entire `extras` object, as well as its nested fields with null values, have been removed from the JSONB data.

## Summary

- Use the `jsonb_strip_nulls()` function to recursively delete all object fields that have null values.


# Working with JSON Arrays

# jsonb_array_length

---
title: 'PostgreSQL jsonb_array_length() Function'
page_title: 'PostgreSQL jsonb_array_length() Function'
page_description: 'You will learn how to use the PostgreSQL jsonb_array_length() function to get the number of elements in the top-level JSON array.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_array_length/'
ogImage: ''
updatedOn: '2024-02-24T03:50:01+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_strip_nulls() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_strip_nulls'
nextLink:
  title: 'PostgreSQL jsonb_array_elements() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_array_elements'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_array_length()` function to get the number of elements in the top\-level JSON array.

## Introduction to the PostgreSQL jsonb_array_length() function

The `jsonb_array_length()` function returns the number of elements in the top\-level [JSON](../postgresql-tutorial/postgresql-json) array.

Here’s the syntax of the `jsonb_array_length()` function:

```sql
jsonb_array_length(json_array)
```

In this syntax, you pass a JSON array with the type JSONB to the function. It’ll return the number of elements in the array.

If the array is empty, the `jsonb_array_length()` function returns zero. If the argument is not an array, the function will issue an error. In case the `json_array` is `NULL`, the `jsonb_array_length()` function will return `NULL`.

Note that the function will return the number of elements of the top\-level array only. If the array contains nested arrays, the function will not count the elements in the nested arrays but consider the nested arrays as individual elements.

## PostgreSQL jsonb_array_length() function examples

Let’s explore some examples of using the `jsonb_array_length()` function.

### 1\) Basic PostgreSQL jsonb_array_length() function example

The following example uses the `jsonb_array_length()` function to get the number of elements in a JSON array:

```sql
SELECT jsonb_array_length('[1,2,3]');
```

Output:

```text
 jsonb_array_length
--------------------
                  3
(1 row)
```

The function returns 3 because the JSON array \[1,2,3] contains three elements.

### 2\) Using the jsonb_array_length() function with nested arrays

The following example uses the `jsonb_array_length()` function with an array that contains another array:

```sql
SELECT jsonb_array_length('[1,2,3, [4,5], 6]');
```

Output:

```text
 jsonb_array_length
--------------------
                  5
(1 row)
```

In this example, the function returns 5 because the top\-level array contains 5 elements: 1, 2, 3, an array \[4,5], and 6\.

### 3\) Using the jsonb_array_length() function with table data

First, [create a table](../postgresql-tutorial/postgresql-create-table) called `person`:

```sql
CREATE TABLE person (
    id SERIAL PRIMARY KEY,
    info JSONB
);
```

In this `person` table, the `info` column has the type `JSONB` that contains the person’s information including name, age, and pets.

Second, [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `person` table:

```sql
INSERT INTO person (info)
VALUES
    ('{"name": "Alice", "age": 30, "pets": [{"type": "cat", "name": "Fluffy"}, {"type": "dog", "name": "Buddy"}]}'),
    ('{"name": "Bob", "age": 35, "pets": [{"type": "dog", "name": "Max"}]}'),
    ('{"name": "Charlie", "age": 40, "pets": [{"type": "rabbit", "name": "Snowball"}]}')
RETURNING *;
```

Third, retrieve the person names with their number of pets from the `info` column of the `person` table:

```sql
SELECT
  jsonb_path_query(info, '$.name') name,
  jsonb_array_length(
    jsonb_path_query(info, '$.pets')
  ) pet_count
FROM
  person;
```

Output:

```text
   name    | pet_count
-----------+-----------
 "Alice"   |         2
 "Bob"     |         1
 "Charlie" |         1
(3 rows)
```

In this example:

- The `jsonb_path_query`(info, ‘$.name’) returns the name of the person.
- The `jsonb_path_query`(info, ‘$.pets’) returns the `pets` array, and `jsonb_array_length()` returns the number of elements in the `pets` array.

## Summary

- Use the `jsonb_array_length()` function to get the number of elements in the top\-level JSON array.


# jsonb_array_elements

---
title: 'PostgreSQL jsonb_array_elements() Function'
page_title: 'PostgreSQL jsonb_array_elements() Function'
page_description: 'How to use the PostgreSQL jsonb_array_elements() function to expand the top-level JSON array into a set of JSON values.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_array_elements/'
ogImage: ''
updatedOn: '2024-02-24T04:18:19+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_array_length() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_array_length'
nextLink:
  title: 'PostgreSQL jsonb_array_elements_text() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_array_elements_text'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_array_elements()` function to expand the top\-level JSON array into a set of JSON values.

## Introduction to the PostgreSQL jsonb_array_elements() function

The `jsonb_array_elements()` function allows you to expand the top\-level [JSON](../postgresql-tutorial/postgresql-json) array into a set of JSON values.

Here’s the basic syntax of the `jsonb_array_elements()` function:

```sql
jsonb_array_elements(json_array)
```

In this syntax, you specify a JSON array with a JSONB type that you want to expand its elements.

The `jsonb_array_elements()` function will expand the elements of the `json_array` into individual elements.

If you pass a non\-array to the function, it’ll issue an error. If the `json_array` is `NULL`, the function returns an empty result set.

## PostgreSQL jsonb_array_elements() function examples

Let’s explore some examples of using the `jsonb_array_elements()` function.

### 1\) Basic PostgreSQL jsonb_array_elements() function examples

The following example uses the `jsonb_array_elements()` function to expand elements of a JSON array:

```sql
SELECT jsonb_array_elements('[1,2,3]');
```

Output:

```text
 jsonb_array_elements
----------------------
 1
 2
 3
(3 rows)
```

Note that the numbers 1, 2, 3 are the JSON values.

The following example uses the `jsonb_array_elements()` function to expand an array of strings:

```sql
SELECT jsonb_array_elements('["red","green","blue"]');
```

Output:

```text
 jsonb_array_elements
----------------------
 "red"
 "green"
 "blue"
(3 rows)
```

### 2\) Using the jsonb_array_elements() function with nested arrays example

The following example uses the `jsonb_array_elements()` function to expand elements of an array that contains another array:

```sql
SELECT jsonb_array_elements('[1,2,3, [4,5], 6]');
```

Output:

```text
 jsonb_array_elements
----------------------
 1
 2
 3
 [4, 5]
 6
(5 rows)
```

### 3\) Using the jsonb_array_elements() function with table data

First, [create a table](../postgresql-tutorial/postgresql-create-table) called `employees`:

```sql
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    skills JSONB
);
```

The `skills` column has the JSONB type, which stores the skills of employees.

Second, [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `employees` table:

```sql
INSERT INTO employees (name, skills)
VALUES
('John Doe', '["Java", "Python", "SQL"]'),
('Jane Smith', '["C++", "JavaScript", "HTML/CSS"]'),
('Alice Johnson', '["Python", "Data Analysis", "Machine Learning"]'),
('Bob Brown', '["Java", "SQL", "Spring Framework"]');
```

Third, retrieve all skills of employees:

```sql
SELECT jsonb_array_elements(skills) skills
FROM employees;
```

Output:

```text
       skills
--------------------
 "Java"
 "Python"
 "SQL"
 "C++"
 "JavaScript"
 "HTML/CSS"
 "Python"
 "Data Analysis"
 "Machine Learning"
 "Java"
 "SQL"
 "Spring Framework"
(12 rows)
```

It returns 12 skills.

It’s possible to use the [`DISTINCT`](../postgresql-tutorial/postgresql-select-distinct) to get unique skills of all employees:

```sql
SELECT DISTINCT jsonb_array_elements(skills) skills
FROM employees;
```

Output:

```text
       skills
--------------------
 "C++"
 "Python"
 "SQL"
 "HTML/CSS"
 "JavaScript"
 "Java"
 "Data Analysis"
 "Spring Framework"
 "Machine Learning"
(9 rows)
```

## Summary

- Use the `jsonb_array_elements()` function to expand elements of the top\-level JSON array.


# jsonb_array_elements_text

---
title: 'PostgreSQL jsonb_array_elements_text() Function'
page_title: 'PostgreSQL jsonb_array_elements_text() Function'
page_description: 'How to use the PostgreSQL jsonb_array_elements_text() function to expand the elements of a top-level JSON array into a set of text values.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_array_elements_text/'
ogImage: ''
updatedOn: '2024-02-24T08:07:50+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_array_elements() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_array_elements'
nextLink:
  title: 'PostgreSQL jsonb_each() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_each'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_array_elements_text()` function to expand the elements of a top\-level JSON array into a set of text values.

## Introduction to the PostgreSQL jsonb_array_elements_text() function

The `jsonb_array_elements_text()` function allows you to expand the elements of a top\-level [JSON](../postgresql-tutorial/postgresql-json) array into a set of JSON values.

The following shows the basic syntax of the `jsonb_array_elements_text()` function:

```sql
jsonb_array_elements_text(json_array)
```

In this syntax:

- `json_array` is a JSON array with the `JSONB` type, which you want to expand the elements.

The `jsonb_array_elements_text()` function will expand the elements in the `json_array` into individual text values.

If you pass an object to the function, it’ll issue an error. In case the `json_array` is `NULL`, the function returns an empty result set.

## PostgreSQL jsonb_array_elements_text() function examples

Let’s take some examples of using the `jsonb_array_elements_text()` function.

### 1\) Basic PostgreSQL jsonb_array_elements_text() function examples

The following example uses the `jsonb_array_elements_text()` function to expand elements of a JSON array:

```sql
SELECT jsonb_array_elements_text('["orange","banana","watermelon"]');
```

Output:

```text
 jsonb_array_elements_text
---------------------------
 orange
 banana
 watermelon
(3 rows)
```

The following example uses the `jsonb_array_elements_text()` function to expand an array of numbers:

```sql
SELECT jsonb_array_elements_text('[1,2,3]');
```

Output:

```text
 jsonb_array_elements_text
---------------------------
 1
 2
 3
(3 rows)
```

Note that 1, 2, and 3 are text values, not numbers. To convert them to numbers, you need to have an explicit cast.

### 2\) Using the jsonb_array_elements_text() function with nested arrays example

The following example uses the `jsonb_array_elements_text()` function to expand elements of an array that contains another array:

```sql
SELECT jsonb_array_elements_text('[1,2,3, [4,5], 6]');
```

Output:

```text
 jsonb_array_elements_text
---------------------------
 1
 2
 3
 [4, 5]
 6
(5 rows)
```

### 3\) Using the jsonb_array_elements_text() function with table data

First, [create a table](../postgresql-tutorial/postgresql-create-table) called `employees`:

```sql
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    skills JSONB
);
```

The `skills` column has the JSONB type, which stores the skills of employees.

Second, [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `employees` table:

```sql
INSERT INTO employees (name, skills)
VALUES
('John Doe', '["Java", "Python", "SQL"]'),
('Jane Smith', '["C++", "JavaScript", "HTML/CSS"]'),
('Alice Johnson', '["Python", "Data Analysis", "Machine Learning"]'),
('Bob Brown', '["Java", "SQL", "Spring Framework"]');
```

Third, retrieve all skills of employees:

```sql
SELECT jsonb_array_elements_text(skills) skills
FROM employees;
```

Output:

```text
      skills
------------------
 Java
 Python
 SQL
 C++
 JavaScript
 HTML/CSS
 Python
 Data Analysis
 Machine Learning
 Java
 SQL
 Spring Framework
(12 rows)
```

It returns 12 skills as text values.

If you want to get unique skills, you can use the [`DISTINCT`](../postgresql-tutorial/postgresql-select-distinct) operator:

```sql
SELECT DISTINCT jsonb_array_elements_text(skills) skills
FROM employees;
```

Output:

```text
      skills
------------------
 Data Analysis
 C++
 JavaScript
 SQL
 Python
 Machine Learning
 Spring Framework
 HTML/CSS
 Java
(9 rows)
```

## Summary

- Use the `jsonb_array_elements_text()` function to expand elements of the top\-level JSON array into a set of text values.


# Working with JSON Objects

# jsonb_each_text

---
title: 'PostgreSQL jsonb_each_text() Function'
page_title: 'PostgreSQL jsonb_each_text() Function'
page_description: 'You will learn how to use the PostgreSQL jsonb_each_text() function to expand a JSON object into a set of key/value pairs of type text.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_each_text/'
ogImage: ''
updatedOn: '2024-02-24T09:02:58+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_each() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_each'
nextLink:
  title: 'PostgreSQL jsonb_object_keys() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_object_keys'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_each_text()` function to expand a JSON object into a set of key/value pairs of type text.

## Introduction to the PostgreSQL jsonb_each_text() function

The `jsonb_each_text()` function allows you to expand a top\-level [JSON](../postgresql-tutorial/postgresql-json) object into a set of key/value pairs. Both keys and values are text strings.

The following shows the basic syntax of the `jsonb_each_text()` function:

```sql
jsonb_each_text(json_object)
```

In this syntax:

- `json_object` is the JSON object that you want to expand the key/value pairs.

The function returns a set of records where each record consists of two fields key and value, both have the type `text`.

If the `json_object` is null, the function returns an empty set. in case the `json_object` is not a JSON object, the function will issue an error.

## PostgreSQL jsonb_each_text() function examples

Let’s take some examples of using the `jsonb_each_text()` function.

### 1\) Basic PostgreSQL jsonb_each_text() function example

The following example uses the `jsonb_each_text` function to expand the key/value pair of a JSON object:

```sql
SELECT
  *
FROM
  jsonb_each_text(
    '{"name": "Jane", "age": 22, "city": "San Francisco"}'
  );
```

Output:

```text
 key  |     value
------+---------------
 age  | 22
 city | San Francisco
 name | Jane
(3 rows)
```

Notice that all values in the value column are text strings including the value 22\.

To retrieve a particular key/value pair, you can filter keys in the `WHERE` clause. For example, the following statement returns the name and city of the object:

```sql
SELECT
  *
FROM
  jsonb_each_text(
    '{"name": "Jane", "age": 22, "city": "San Francisco"}'
  )
WHERE key IN ('name','city');
```

Output:

```text
 key  |     value
------+---------------
 city | San Francisco
 name | Jane
(2 rows)
```

### 2\) Using the jsonb_each_text() function with table data

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `links`:

```sql
CREATE TABLE links (
    id SERIAL PRIMARY KEY,
    href TEXT NOT NULL,
    attributes JSONB
);
```

In the `links` table, the `attributes` column has the type of `JSONB` that stores various attributes of a link.

Second, [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `links` table:

```sql
INSERT INTO links (href, attributes)
VALUES
    ('https://example.com', '{"rel": "stylesheet", "type": "text/css", "media": "screen"}'),
    ('https://example.org', '{"rel": "icon", "type": "image/x-icon"}'),
    ('https://example.net', '{"rel": "alternate", "type": "application/rss+xml", "title": "RSS Feed"}');
```

Third, expand the key/value pairs of the objects in `attributes` column into a set of key/value pairs using the `jsonb_each_text()` function:

```sql
SELECT
  href,
  key,
  value
FROM
  links,
  jsonb_each_text(attributes);
```

Output:

```text
        href         |  key  |        value
---------------------+-------+---------------------
 https://example.com | rel   | stylesheet
 https://example.com | type  | text/css
 https://example.com | media | screen
 https://example.org | rel   | icon
 https://example.org | type  | image/x-icon
 https://example.net | rel   | alternate
 https://example.net | type  | application/rss+xml
 https://example.net | title | RSS Feed
(8 rows)
```

## Summary

- Use the `jsonb_each_text()` function to expand a JSON object into a set of key/value pairs of type `text`.


# jsonb_each

---
title: 'PostgreSQL jsonb_each() Function'
page_title: 'PostgreSQL jsonb_each() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL jsonb_each() function to expand a JSON object into a set of key/value pairs.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_each/'
ogImage: ''
updatedOn: '2024-02-24T08:46:16+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_array_elements_text() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_array_elements_text'
nextLink:
  title: 'PostgreSQL jsonb_each_text() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_each_text'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_each()` function to expand a JSON object into a set of key/value pairs.

## Introduction to the PostgreSQL jsonb_each() function

The `jsonb_each()` function allows you to expand a top\-level [JSON](../postgresql-tutorial/postgresql-json) object of a JSONB value into a set of key/value pairs. The keys are text and values are JSON values.

Here’s the syntax of the `jsonb_each()` function:

```sql
jsonb_each(json_object)
```

In this syntax:

- `json_object` is the JSON object that you want to expand the key/value pairs.

The function returns a set of records where each record consists of two fields key of type `text` and value of the `JSONB`.

If the `json_object` is not a JSON object, the function will issue an error. In case the `json_object` is null, the function returns an empty set.

## PostgreSQL jsonb_each() function examples

Let’s explore some examples of using the `jsonb_each()` function.

### 1\) Basic PostgreSQL jsonb_each() function example

The following example uses the `jsonb_each` function to expand the key/value pair of a JSON object:

```sql
SELECT
  *
FROM
  jsonb_each(
    '{"name": "John", "age": 30, "city": "New York"}'
  );
```

Output:

```text
 key  |   value
------+------------
 age  | 30
 city | "New York"
 name | "John"
(3 rows)
```

If you want to retrieve a particular key, you can filter the key in the `WHERE` clause.

For example, the following statement returns the name and age of the object:

```sql
SELECT
  *
FROM
  jsonb_each(
    '{"name": "John", "age": 30, "city": "New York"}'
  )
WHERE
  key in ('name', 'age');
```

Output:

```text
 key  | value
------+--------
 age  | 30
 name | "John"
(2 rows)
```

### 2\) Using the jsonb_each() function with table data

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `links`:

```sql
CREATE TABLE links (
    id SERIAL PRIMARY KEY,
    href TEXT NOT NULL,
    attributes JSONB
);
```

In the `links` table, the `attributes` column has the type of `JSONB` that stores various attributes of a link.

Second, [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `links` table:

```sql
INSERT INTO links (href, attributes)
VALUES
    ('https://example.com', '{"rel": "stylesheet", "type": "text/css", "media": "screen"}'),
    ('https://example.org', '{"rel": "icon", "type": "image/x-icon"}'),
    ('https://example.net', '{"rel": "alternate", "type": "application/rss+xml", "title": "RSS Feed"}');
```

Third, expand the key/value pairs of the objects in `attributes` column into a set of key/value pairs using the `jsonb_each()` function:

```sql
SELECT
  href,
  key,
  value
FROM
  links,
  jsonb_each(attributes);
```

Output:

```text
        href         |  key  |         value
---------------------+-------+-----------------------
 https://example.com | rel   | "stylesheet"
 https://example.com | type  | "text/css"
 https://example.com | media | "screen"
 https://example.org | rel   | "icon"
 https://example.org | type  | "image/x-icon"
 https://example.net | rel   | "alternate"
 https://example.net | type  | "application/rss+xml"
 https://example.net | title | "RSS Feed"
(8 rows)
```

## Summary

- Use the `jsonb_each()` function to expand a JSON object into a set of key/value pairs.


# jsonb_object_keys

---
title: 'PostgreSQL jsonb_object_keys() Function'
page_title: 'PostgreSQL jsonb_object_keys() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL jsonb_object_keys() function to extract the keys from a JSON object.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_object_keys/'
ogImage: ''
updatedOn: '2024-02-24T09:28:45+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_each_text() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_each_text'
nextLink:
  title: 'PostgreSQL jsonb_to_record() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_to_record'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_object_keys()` function to extract the keys from a JSON object.

## Introduction to the PostgreSQL jsonb_object_keys() function

The `jsonb_object_keys()` function allows you to extract the keys of a [JSON](../postgresql-tutorial/postgresql-json) object into a set of text values.

Here’s the basic syntax of the `jsonb_object_keys()` function:

```phpsqlsql
jsonb_object_keys(json_object)
```

In this syntax:

- `json_object` is the JSON object of type JSONB that you want to extract the keys.

The `jsonb_object_keys()` function returns a set of text values representing the keys in the `json_object`.

If the `json_object` is not a JSON object, the `jsonb_object_keys()` function will issue an error.

If the `json_object` is `NULL`, the function will return an empty set.

## PostgreSQL jsonb_object_keys() function examples

Let’s take some examples of using the `jsonb_object_keys()` function.

### 1\) Basic the jsonb_object_keys() function examples

The following example uses the `jsonb_object_keys()` function to extract the keys of a JSON object as a set of text values:

```sql
SELECT
  jsonb_object_keys(
    '{"name": "Joe", "age": 18, "city": "New York"}'
  );
```

Output:

```text
 jsonb_object_keys
-------------------
 age
 city
 name
(3 rows)
```

### 2\) Using the PostgreSQL jsonb_object_keys() function with table data

First, [create a table](../postgresql-tutorial/postgresql-create-table) called `person`:

```sql
CREATE TABLE person (
    id SERIAL PRIMARY KEY,
    info JSONB
);
```

In the `person` table, the `info` column has the type JSONB that stores various information about each person.

Second, [insert rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `person` table:

```sql
INSERT INTO person (info)
VALUES
    ('{"name": "John", "age": 30, "city": "New York"}'),
    ('{"name": "Alice", "city": "Los Angeles"}'),
    ('{"name": "Bob", "age": 35 }');
```

Third, get the keys of the objects in the `info` column:

```sql
SELECT jsonb_object_keys(info)
FROM person;
```

Output:

```text
 jsonb_object_keys
-------------------
 age
 city
 name
 city
 name
 age
 name
(7 rows)
```

To get unique keys from all the stored JSON objects in the info column, you can use the `DISTINCT` operator:

```sql
SELECT DISTINCT jsonb_object_keys(info)
FROM person;
```

Output:

```text
 jsonb_object_keys
-------------------
 age
 city
 name
(3 rows)
```

### 3\) Dynamically accessing keys

The following example shows how to dynamically access values corresponding to each key retrieved using `jsonb_object_keys()`:

```
SELECT
    id,
    key,
    info->key AS value
FROM
    person,
    jsonb_object_keys(info) AS key;

```

Output:

```
 id | key  |     value
----+------+---------------
  1 | age  | 30
  1 | city | "New York"
  1 | name | "John"
  2 | city | "Los Angeles"
  2 | name | "Alice"
  3 | age  | 35
  3 | name | "Bob"
(7 rows)
```

In this example, the query returns each key along with its corresponding value from the `info` column of the `person` table.

## Summary

- Use the `jsonb_object_keys()` function to extract the keys from a JSON object.


# jsonb_to_record

---
title: 'PostgreSQL jsonb_to_record() Function'
page_title: 'PostgreSQL jsonb_to_record() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL jsonb_to_record() function to convert a JSON object into a PostgreSQL record type.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_to_record/'
ogImage: ''
updatedOn: '2024-02-24T11:07:01+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_object_keys() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_object_keys'
nextLink:
  title: 'PostgreSQL jsonb_agg() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_agg'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_to_record()` function to convert a JSON object into a PostgreSQL record type.

## Introduction to the PostgreSQL JSONB jsonb_to_record() function

The `jsonb_to_record()` function allows you to convert a [JSON](../postgresql-tutorial/postgresql-json) object into a PostgreSQL record type.

Here’s the basic syntax of the `jsonb_to_record()` function:

```sql
jsonb_to_record(json_object)
  as record_type (column1 type, column2 type,...)
```

In this syntax:

- First, specify a JSON object (`json_object`) of type JSONB that you want to convert into a record type.
- Second, define the `record_type` with a list of columns that have the same names as the keys in the JSON object. The record may have fewer columns than the number of keys in the JSON object. If the names of the columns of the `record_type` are not the same as the names of the keys in the JSON object, they will be ignored.

The function `jsonb_to_record()` returns a record type representing the structure of a JSON object.

If the `json_object` is null, the `jsonb_to_record()` function returns null.

## PostgreSQL jsonb_to_record() function examples

Let’s take some examples of using the `jsonb_to_record()` function.

### 1\) Basic PostgreSQL jsonb_to_record() function examples

The following example uses the `jsonb_to_record()` function to convert a JSON object into a record:

```sql
SELECT
  *
FROM
  jsonb_to_record(
    '{"id": 1, "name": "Alice", "age": 30}'
  ) AS person (id INT, name TEXT, age INT);
```

Output:

```text
 id | name  | age
----+-------+-----
  1 | Alice |  30
(1 row)
```

The following example converts a JSON object into a record type but with fewer keys:

```sql
SELECT
  *
FROM
  jsonb_to_record(
    '{"id": 1, "name": "Alice", "age": 30}'
  ) AS person (id INT, name TEXT);
```

Output:

```text
 id | name
----+-------
  1 | Alice
(1 row)
```

### 2\) Using jsonb_to_record() function with user\-defined type

First, create a new custom type called `pet` with two fields `type` and `name`:

```sql
CREATE TYPE pet AS (type VARCHAR, name VARCHAR);
```

Second, use the pet type with the `jsonb_to_record()` function:

```sql
SELECT
  *
FROM
  jsonb_to_record(
    '{"id": 1, "name": "Alice", "age": 30, "pets": [{"type":"cat", "name": "Ellie"}, {"type":"dog", "name": "Birdie"}]}'
  ) AS person (id INT, name TEXT, pets pet[]);
```

Output:

```text
 id | name  |              pets
----+-------+--------------------------------
  1 | Alice | {"(cat,Ellie)","(dog,Birdie)"}
(1 row)
```

## Summary

- Use the `jsonb_to_record()` function to convert a JSON object into a PostgreSQL record type.


# Aggregating JSON Data

# jsonb_agg

---
title: 'PostgreSQL jsonb_agg() Function'
page_title: 'PostgreSQL jsonb_agg() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL jsonb_agg() function to aggregate values into a JSON array.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_agg/'
ogImage: ''
updatedOn: '2024-02-25T08:14:43+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_to_record() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_to_record'
nextLink:
  title: 'PostgreSQL jsonb_object_agg() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_object_agg'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_agg()` function to aggregate values into a JSON array.

## Introduction to the PostgreSQL jsonb_agg() function

The `jsonb_agg()` function is an [aggregate function](../postgresql-aggregate-functions) that allows you to aggregate values into a JSON array.

The `jsonb_agg()` function can be particularly useful when you want to create a JSON array from data of multiple rows.

Here’s the syntax of the `jsonb_agg()` function:

```sqlsql
jsonb_agg(expression)
```

In this syntax:

- `expression`: is any valid expression that evaluates to a JSON value.

The `jsonb_agg()` function returns a JSON array that consists of data from multiple rows.

## PostgreSQL jsonb_agg() function example

Let’s explore some examples of using the `jsonb_agg()` function.

### 1\) Basic jsonb_agg() function example

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `products`:

```sql
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    price DECIMAL(10, 2) NOT NULL
);
```

Second, [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `products` table:

```sql
INSERT INTO products (name, price)
VALUES
('Laptop', 1200.00),
('Smartphone', 800.00),
('Headphones', 100.00);
```

Third, use the `jsonb_agg()` function to aggregate product information into a JSON array:

```sql
SELECT
  jsonb_agg(
    jsonb_build_object('name', name, 'price', price)
  ) AS products
FROM
  products;
```

Output:

```text
                                                         products
--------------------------------------------------------------------------------------------------------------------------
 [{"name": "Laptop", "price": 1200.00}, {"name": "Smartphone", "price": 800.00}, {"name": "Headphones", "price": 100.00}]
(1 row)
```

### 2\) Using jsonb_agg() function with GROUP BY clause

First, [create new tables](../postgresql-tutorial/postgresql-create-table) called `departments` and `employees`:

```sql
CREATE TABLE departments(
   id SERIAL PRIMARY KEY,
   department_name VARCHAR(255) NOT NULL
);

CREATE TABLE employees(
    id SERIAL PRIMARY KEY,
    employee_name VARCHAR(255) NOT NULL,
    department_id INT NOT NULL,
    FOREIGN KEY (department_id)
        REFERENCES departments(id) ON DELETE CASCADE
);
```

Second, insert rows into `departments` and `employees` tables:

```sql
INSERT INTO departments (department_name)
VALUES
  ('Engineering'),
  ('Sales')
RETURNING *;

INSERT INTO employees (employee_name, department_id)
VALUES
  ('John Doe', 1),
  ('Jane Smith', 1),
  ('Alice Johnson', 1),
  ('Bob Brown', 2)
RETURNING *;
```

The `departments` table:

```text
 id | department_name
----+-----------------
  1 | Engineering
  2 | Sales
(2 rows)
```

The `employees` table:

```text
 id | employee_name | department_id
----+---------------+---------------
  1 | John Doe      |             1
  2 | Jane Smith    |             1
  3 | Alice Johnson |             1
  4 | Bob Brown     |             2
(4 rows)
```

Third, use the `jsonb_agg()` function to retrieve departments and a list of employees for each department in the form of a JSON array:

```sql
SELECT
  department_name,
  jsonb_agg(employee_name) AS employees
FROM
  employees e
  INNER JOIN departments d ON d.id = e.department_id
GROUP BY
  department_name;
```

Output:

```text
 department_name |                  employees
-----------------+---------------------------------------------
 Engineering     | ["John Doe", "Jane Smith", "Alice Johnson"]
 Sales           | ["Bob Brown"]
(2 rows)
```

### 3\) Using jsonb_agg() function with NULLs

First, drop the departments and employees tables:

```sql
DROP TABLE employees;
DROP TABLE departments;
```

Second, recreate the departments and employees tables:

```sql
CREATE TABLE departments(
   id SERIAL PRIMARY KEY,
   department_name VARCHAR(255) NOT NULL
);

CREATE TABLE employees(
    id SERIAL PRIMARY KEY,
    employee_name VARCHAR(255) NOT NULL,
    department_id INT NOT NULL,
    FOREIGN KEY (department_id)
        REFERENCES departments(id) ON DELETE CASCADE
);
```

Third, insert rows into the departments and employees tables:

```sql
INSERT INTO departments (department_name)
VALUES
  ('Engineering'),
  ('Sales'),
  ('IT')
RETURNING *;

INSERT INTO employees (employee_name, department_id)
VALUES
  ('John Doe', 1),
  ('Jane Smith', 1),
  ('Alice Johnson', 1),
  ('Bob Brown', 2)
RETURNING *;
```

Output:

The `departments` table:

```text
 id | department_name
----+-----------------
  1 | Engineering
  2 | Sales
  3 | IT
(3 rows)
```

The `employees` table:

```
 id | employee_name | department_id
----+---------------+---------------
  1 | John Doe      |             1
  2 | Jane Smith    |             1
  3 | Alice Johnson |             1
  4 | Bob Brown     |             2
(4 rows)

```

Third, use the `jsonb_agg()` function to retrieve departments and a list of employees for each department in the form of a JSON array:

```
SELECT
  department_name,
  jsonb_agg (employee_name) AS employees
FROM
  departments d
  LEFT JOIN employees e ON d.id = e.department_id
GROUP BY
  department_name;
```

Output:

```text
 department_name |                  employees
-----------------+---------------------------------------------
 Engineering     | ["John Doe", "Jane Smith", "Alice Johnson"]
 Sales           | ["Bob Brown"]
 IT              | [null]
(3 rows)
```

In this example, the IT department has no employees therefore `jsonb_agg()` function returns an array that contains a null value.

To skip the null and make the JSON array an empty array, you can use the `jsonb_agg_strict()` function:

```sql
SELECT
  department_name,
  jsonb_agg_strict (employee_name) AS employees
FROM
  departments d
  LEFT JOIN employees e ON d.id = e.department_id
GROUP BY
  department_name;
```

Output:

```
 department_name |                  employees
-----------------+---------------------------------------------
 Engineering     | ["John Doe", "Jane Smith", "Alice Johnson"]
 Sales           | ["Bob Brown"]
 IT              | []
(3 rows)
```

The `jsonb_agg_strict()` function works like the `jsonb_agg()` except that it skips the null values.

## Summary

- Use the `jsonb_agg()` function to aggregate values into a JSON array.


# jsonb_object_agg

---
title: 'PostgreSQL jsonb_object_agg() Function'
page_title: 'PostgreSQL jsonb_object_agg() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL jsonb_object_agg() function to aggregate key/value pairs into a JSON object.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_object_agg/'
ogImage: ''
updatedOn: '2024-02-25T09:00:30+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_agg() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_agg'
nextLink:
  title: 'PostgreSQL jsonb_typeof() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_typeof'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_object_agg()` function to aggregate key/value pairs into a JSON object.

## Introduction to the PostgreSQL jsonb_object_agg() function

The PostgreSQL `jsonb_object_agg()` function is an [aggregate function](../postgresql-aggregate-functions) that allows you to collect key/value pairs into a [JSON](../postgresql-tutorial/postgresql-json) object.

The `jsonb_object_agg()` can be useful when you want to aggregate data from multiple rows into a single JSON object or construct complex JSON output.

Here’s the syntax of the `jsonb_object_agg()` function:

```sql
jsonb_object_agg(key, value)
```

In this syntax:

- `key` represents the key for the JSON object. The key must not be null.
- `value` represents the value for the corresponding key.

The `jsonb_object_agg()` returns a JSON object that consists of key/value pairs.

## PostgreSQL jsonb_object_agg() function examples

Let’s explore some examples of using the PostgreSQL `jsonb_object_agg()` function.

### 1\) Basic PostgreSQL jsonb_object_agg() function example

First, [create a table](../postgresql-tutorial/postgresql-create-table) called `departments`:

```sql
CREATE TABLE departments(
    id SERIAL PRIMARY KEY,
    department_name VARCHAR(255) NOT NULL
);
```

Second, [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `departments` table:

```sql
INSERT INTO departments(department_name)
VALUES
   ('Sales'),
   ('Marketing')
RETURNING *;
```

Third, use the `jsonb_object_agg()` function to create an object whose key is the department name and value is the id:

```sql
SELECT
  jsonb_object_agg(department_name, id) departments
FROM
  departments;
```

Output:

```text
         departments
------------------------------
 {"Sales": 1, "Marketing": 2}
(1 row)
```

### 2\) Using the jsonb_object_agg() function with GROUP BY clause

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `employees`:

```sql
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    salary DECIMAL(10, 2),
    department_id INT NOT NULL,
    FOREIGN KEY(department_id)
       REFERENCES departments(id) ON DELETE CASCADE
);
```

Second, [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `employees` table:

```sql
INSERT INTO employees (name, salary, department_id)
VALUES
  ('John Doe', 60000, 1),
  ('Jane Smith', 65000, 1),
  ('Alice Johnson', 55000, 2),
  ('Bob Williams', 70000, 2),
  ('Alex Miller', NULL , 2)
RETURNING *;
```

Output:

```text
 id |     name      |  salary  | department_id
----+---------------+----------+---------------
  1 | John Doe      | 60000.00 |             1
  2 | Jane Smith    | 65000.00 |             1
  3 | Alice Johnson | 55000.00 |             2
  4 | Bob Williams  | 70000.00 |             2
  5 | Alex Miller   |     null |             2
(5 rows)
```

Third, use the `jsonb_object_agg()` function to get the department name and a JSON object that contains employee details of the department including employee name and salary:

```sql
SELECT
  department_name,
  jsonb_pretty(
    jsonb_object_agg(e.name, e.salary)
  ) AS employee_details
FROM
  departments d
  INNER JOIN employees e ON e.department_id = d.id
GROUP BY
  department_name;
```

Output:

```text
 department_name |       employee_details
-----------------+-------------------------------
 Marketing       | {                            +
                 |     "Alex Miller": null,     +
                 |     "Bob Williams": 70000.00,+
                 |     "Alice Johnson": 55000.00+
                 | }
 Sales           | {                            +
                 |     "John Doe": 60000.00,    +
                 |     "Jane Smith": 65000.00   +
                 | }
(2 rows)
```

Note that we use the `jsonb_pretty()` function to format JSON.

Alex Miller has not had a salary yet so his salary is null. The `jsonb_object_agg()` also collects the null into the JSON object.

To skip nulls, you can use the `jsonb_object_agg_strict()` function as follows:

```sql
SELECT
  department_name,
  jsonb_pretty(
    jsonb_object_agg_strict(e.name, e.salary)
  ) AS employee_details
FROM
  departments d
  INNER JOIN employees e ON e.department_id = d.id
GROUP BY
  department_name;
```

Output:

```text
 department_name |       employee_details
-----------------+-------------------------------
 Marketing       | {                            +
                 |     "Bob Williams": 70000.00,+
                 |     "Alice Johnson": 55000.00+
                 | }
 Sales           | {                            +
                 |     "John Doe": 60000.00,    +
                 |     "Jane Smith": 65000.00   +
                 | }
(2 rows)
```

The `jsonb_object_agg_strict()` function works like the `jsonb_object_agg()` function except that it skips null values.

## Summary

- Use the `jsonb_object_agg()` function to aggregate key/value pairs into a JSON object.
- Use the `jsonb_object_agg()` function to aggregate key/value pairs into a JSON object and skip null values.


# JSON Utility Functions

# jsonb_typeof

---
title: 'PostgreSQL jsonb_typeof() Function'
page_title: 'PostgreSQL jsonb_typeof() Function'
page_description: ''
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_typeof/'
ogImage: ''
updatedOn: '2024-02-24T11:07:59+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_object_agg() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_object_agg'
nextLink:
  title: 'PostgreSQL jsonb_pretty() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_pretty'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_typeof()` function to return the type of the top\-level JSON value as a text string.

## Introduction to the PostgreSQL jsonb_typeof() function

The `jsonb_typeof()` function allows you to get the type of a top\-level JSONB value as a text string.

Here’s the syntax of the `jsonb_typeof()` function:

```sql
jsonb_typeof(jsonb_value)
```

In this syntax:

- `jsonb_value` is a JSONB value of which you want to get the type as a text string.

The `jsonb_typeof()` function returns a text string representing the type of the input JSONB value. The possible return values are object, array, string, number, and null.

## PostgreSQL jsonb_typeof() function examples

Let’s take some examples of using the `jsonb_typeof()` function.

The following example uses the `jsonb_typeof()` function to return the type of a JSON object:

```sql
SELECT jsonb_typeof('{}');
```

Output:

```text
 jsonb_typeof
--------------
 object
(1 row)
```

The following example uses the `jsonb_typeof()` function to return the type of a JSON array:

```sql
select jsonb_typeof('[]');
```

Output:

```text
 jsonb_typeof
--------------
 array
(1 row)
```

The following example uses the `jsonb_typeof()` function to return the type of a number:

```sql
SELECT jsonb_typeof('1'::jsonb);
```

Output:

```text
 jsonb_typeof
--------------
 number
(1 row)
```

The following example uses the `jsonb_typeof()` function to return the type of null:

```sql
SELECT jsonb_typeof('null'::jsonb);
```

Output:

```text
 jsonb_typeof
--------------
 null
(1 row)
```

The following example uses the `jsonb_typeof()` function to return the type of string:

```sql
SELECT
  jsonb_typeof(
    jsonb_path_query('{"name": "Alice"}', '$.name')
  );
```

Output:

```text
 jsonb_typeof
--------------
 string
(1 row)
```

## Summary

- Use the `jsonb_typeof()` function to return the type of the top\-level JSON value as a text string.


# jsonb_pretty

---
title: 'PostgreSQL jsonb_pretty() Function'
page_title: 'PostgreSQL jsonb_pretty() Function'
page_description: 'You will learn how to use the PostgreSQL jsonb_pretty() function to convert a JSON value to a human-readable, indented format.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-json-functions/postgresql-jsonb_pretty/'
ogImage: ''
updatedOn: '2024-02-24T11:42:42+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_typeof() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_typeof'
nextLink:
  title: 'PostgreSQL jsonb_populate_record() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_populate_record'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `jsonb_pretty()` function to convert a JSON value to a human\-readable, indented format.

## Introduction to the PostgreSQL jsonb_pretty() function

The `jsonb_pretty()` function allows you to convert a given [JSONB](../postgresql-tutorial/postgresql-json) value to a human\-readable, indented format.

Here’s the basic syntax of the `jsonb_pretty()` function:

```jsonsql
jsonb_pretty(jsonb_value)
```

In this syntax:

- `jsonb_value` is a JSONB value that you want to convert.

The `jsonb_pretty()` function returns a text that is the human\-readable and indented format of the input JSONB value.

## PostgreSQL jsonb_pretty() function examples

Let’s explore some examples of using the `jsonb_pretty()` function.

### 1\) Basic PostgreSQL jsonb_pretty() function example

The following example uses the `jsonb_pretty()` function to format a JSONB value:

```sql
SELECT
  jsonb_pretty(
    '{"id": 1, "name": {"first": "John", "last": "Doe"}, "age": 30}'
  );
```

Output:

```text
      jsonb_pretty
-------------------------
 {                      +
     "id": 1,           +
     "age": 30,         +
     "name": {          +
         "last": "Doe", +
         "first": "John"+
     }                  +
 }
(1 row)
```

### 2\) Using PostgreSQL jsonb_pretty() function with table data

First, create a new table called recipes:

```json
CREATE TABLE recipes (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    details JSONB
);
```

Second, insert some rows into the recipes table:

```sql
INSERT INTO recipes (name, details)
VALUES
    (
        'Spaghetti Carbonara',
        '{"preparation_time": "30 minutes",
          "ingredients": ["spaghetti", "eggs", "bacon", "parmesan cheese", "black pepper"],
          "difficulty": "Medium"}'
    ),
    (
        'Chicken Tikka Masala',
        '{"preparation_time": "45 minutes",
          "ingredients": ["chicken", "tomatoes", "onions", "yogurt", "spices"],
          "difficulty": "Medium-High"}'
    ),
    (
        'Vegetable Stir Fry',
        '{"preparation_time": "20 minutes",
          "ingredients": ["mixed vegetables", "soy sauce", "garlic", "ginger", "sesame oil"],
          "difficulty": "Easy"}'
    );
```

Third, format the JSONB data in the details column:

```sql
SELECT
  name,
  jsonb_pretty(details)
FROM
  recipes;
```

Output:

```
         name         |             jsonb_pretty
----------------------+--------------------------------------
 Spaghetti Carbonara  | {                                   +
                      |     "difficulty": "Medium",         +
                      |     "ingredients": [                +
                      |         "spaghetti",                +
                      |         "eggs",                     +
                      |         "bacon",                    +
                      |         "parmesan cheese",          +
                      |         "black pepper"              +
                      |     ],                              +
                      |     "preparation_time": "30 minutes"+
                      | }
 Chicken Tikka Masala | {                                   +
                      |     "difficulty": "Medium-High",    +
                      |     "ingredients": [                +
                      |         "chicken",                  +
                      |         "tomatoes",                 +
                      |         "onions",                   +
                      |         "yogurt",                   +
                      |         "spices"                    +
                      |     ],                              +
                      |     "preparation_time": "45 minutes"+
                      | }
 Vegetable Stir Fry   | {                                   +
                      |     "difficulty": "Easy",           +
                      |     "ingredients": [                +
                      |         "mixed vegetables",         +
                      |         "soy sauce",                +
                      |         "garlic",                   +
                      |         "ginger",                   +
                      |         "sesame oil"                +
                      |     ],                              +
                      |     "preparation_time": "20 minutes"+
                      | }
(3 rows)
```

## Summary

- Use the `jsonb_pretty()` function to convert a JSON value to pretty\-printed, indented text.


# Math Functions

---
title: 'PostgreSQL Math Functions'
page_title: 'PostgreSQL Math Functions'
page_description: 'Provide the most commonly used PostgreSQL Match functions that help you perform various math operations quickly and effectively.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-math-functions/'
ogImage: 'https://www.postgresqltutorial.com//postgresqltutorial/math-functions.png'
updatedOn: '2024-05-19T04:18:23+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL TO_NUMBER() Function'
  slug: 'postgresql-string-functions/postgresql-to_number'
nextLink:
  title: 'PostgreSQL ABS() Function'
  slug: 'postgresql-math-functions/postgresql-abs'
---

This page provides the most commonly used PostgreSQL Math functions that help you perform various math operations quickly and effectively.

| Function                                                          | Description                                                                                     | Example                 | Result   |
| ----------------------------------------------------------------- | ----------------------------------------------------------------------------------------------- | ----------------------- | -------- |
| [ABS](postgresql-math-functions/postgresql-abs)                   | Calculate the absolute value of a number.                                                       | ABS(\-10\)              | 10       |
| [CBRT](postgresql-math-functions/postgresql-cbrt)                 | Calculate the cube root of a number.                                                            | CBRT(8\)                | 2        |
| [CEIL](postgresql-math-functions/postgresql-ceil)                 | Round a number to the nearest integer greater than or equal to a specified number.              | CEIL(\-12\.8\)          | \-12     |
| [CEILING](postgresql-math-functions/postgresql-ceil)              | Same as CEIL                                                                                    |                         |          |
| [DEGREES](postgresql-math-functions/postgresql-degrees)           | Convert radians to degrees.                                                                     | DEGREES(PI())           | 180      |
| [DIV](postgresql-math-functions/postgresql-div)                   | Return the integer quotient of two numeric values.                                              | DIV(8,3\)               | 2        |
| [EXP](postgresql-math-functions/postgresql-exp)                   | Return the exponential of a number.                                                             | EXP(1\)                 | 2\.71    |
| [FACTORIAL](postgresql-math-functions/postgresql-factorial)       | Calculate the factorial of a number.                                                            | FACTORIAL(5\)           | 120      |
| [FLOOR](postgresql-math-functions/postgresql-floor)               | Round a number down to the nearest integer, which is less than or equal to the number.          | FLOOR(10\.6\)           | 10       |
| [GCD](postgresql-math-functions/postgresql-gcd)                   | Calculate the greatest common divisor of two numbers.                                           | GCD(8,12\)              | 4        |
| [LCM](postgresql-math-functions/postgresql-lcm)                   | Calculate the least common multiples of two numbers.                                            | LCM(8,12\)              | 24       |
| [LN](postgresql-math-functions/postgresql-ln)                     | Return the natural logarithm of a numeric value.                                                | LN(3\)                  | 1\.0986  |
| [LOG](postgresql-math-functions/postgresql-log)                   | Return the base 10 logarithms of a numeric value.                                               | LOG(1000\)              | 3        |
| [LOG](postgresql-math-functions/postgresql-log)                   | Return the logarithm of a numeric value to a specified base.                                    | LOG(2, 64\)             | 6        |
| [MIN_SCALE](postgresql-math-functions/postgresql-min_scale)       | Return the minimum scale of a number.                                                           | MIN_SCALE(12\.300\)     | 2        |
| [MOD](postgresql-math-functions/postgresql-mod)                   | Divide the first parameter by the second one and return the remainder.                          | MOD(10,4\)              | 2        |
| [PI](postgresql-math-functions/postgresql-pi-function)            | Return the value of PI.                                                                         | PI()                    | 3\.14159 |
| [POWER](postgresql-math-functions/postgresql-power)               | Raise a number to a specific power.                                                             | POWER(5, 3\)            | 125      |
| [RADIANS](postgresql-math-functions/postgresql-radians)           | Convert degrees to radians                                                                      | RADIANS(180\)           | 3\.14159 |
| [ROUND](postgresql-math-functions/postgresql-round)               | Round a number to the nearest integer with the number of decimal places.                        | ROUND(10\.3\)           | 10       |
| [SCALE](postgresql-math-functions/postgresql-scale)               | Return the count of decimal digits in the fractional part of a number, which is a scale.        | SCALE(1\.234\)          | 3        |
| [SIGN](postgresql-math-functions/postgresql-sign)                 | Return \-1 if the number is negative, 0 if the number is zero, and 1 if the number is positive. | SIGN(\-1\)              | \-1      |
| [SQRT](postgresql-math-functions/postgresql-sqrt)                 | Return the square root of a numeric value.                                                      | SQRT(3\.0\)             | 1\.73205 |
| [TRIM_SCALE](postgresql-math-functions/postgresql-trim_scale)     | Reduce the scale of a number by removing trailing zeroes.                                       | TRIM_SCALE(12\.300\)    | 12\.3    |
| [TRUNC](postgresql-math-functions/postgresql-trunc)               | Truncate a numeric value to a whole number of the specified decimal places                      | TRUNC(12\.3\)           | 12       |
| [WIDTH_BUCKET](postgresql-math-functions/postgresql-width_bucket) | Assign a numeric value to a bucket in an equiwidth histogram.                                   | WIDTH_BUCKET(1,1,10,5\) | 1        |
| [RANDOM](postgresql-math-functions/postgresql-random)             | Generate a random number between 0 and 1                                                        | RANDOM()                | 0\.9684  |


# PostgreSQL Math Functions

# ABS

---
title: 'PostgreSQL ABS() Function'
page_title: 'PostgreSQL ABS() Function'
page_description: 'This tutorial shows you how to use the PostgreSQL ABS() function to calculate the absolute value of a number.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-math-functions/postgresql-abs/'
ogImage: ''
updatedOn: '2024-02-16T14:25:19+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Math Functions'
  slug: 'postgresql-math-functions/'
nextLink:
  title: 'PostgreSQL CEIL() Function'
  slug: 'postgresql-math-functions/postgresql-ceil'
---

The PostgreSQL `ABS()` function returns the absolute value of a number.

## Syntax

The following illustrates the syntax of the `ABS()` function:

```csssql
ABS(numeric_expression)
```

## Arguments

The `ABS()` function requires one argument:

1\) `numeric_expression`

The `numeric_expression` can be a number or a numeric expression that evaluates to a number.

## Return Value

The `ABS()` function returns a value whose [data type](../postgresql-tutorial/postgresql-time) is the same as the input argument.

## Absolute Operator @

Besides the ABS() function, you can use the absolute operator @:

```
@ expression
```

In this syntax, the `@` operator returns the absolute value of the `expression`.

## Examples

The following example shows how to use the `ABS()` function to calculate the absolute value of a number:

```
SELECT ABS(-10.25) result;
```

The result is:

```css
 result
--------
  10.25
(1 row)

```

The following statement uses an expression for the `ABS()` function:

```
SELECT ABS( 100 - 250 ) result;
```

Here is the result:

```
 result
--------
    150
(1 row)
```

Besides the `ABS()` function, you can use the absolute operator `@`, for example:

```
SELECT @ -15 as result
```

It returned 15 as expected.

```
 result
--------
     15
(1 row)
```

In this tutorial, you have learned how to use the PostgreSQL `ABS()` function to calculate the absolute value of a number.


# CEIL

---
title: 'PostgreSQL CEIL() Function'
page_title: 'PostgreSQL CEIL() Function'
page_description: 'Show you how to use the PostgreSQL CEIL() function to round a number up to the nearest integer, which is greater than or equal to the number.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-math-functions/postgresql-ceil/'
ogImage: '/postgresqltutorial/customer-and-payment-tables.png'
updatedOn: '2024-02-16T14:25:43+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL ABS() Function'
  slug: 'postgresql-math-functions/postgresql-abs'
nextLink:
  title: 'PostgreSQL CBRT() Function'
  slug: 'postgresql-math-functions/postgresql-cbrt'
---

The PostgreSQL `CEIL()` function returns a number rounded up to the next whole number.

## Syntax

The following illustrates the syntax of the `CEIL()` function:

```css
CEIL(numeric_expression)
```

## Arguments

The `CEIL()` function requires one argument:

**1\) `numeric_expression`**

The `numeric_expression` is a number (or an expression that evaluates to a number) that is rounded up.

## Return Value

The `CEIL()` function returns a value whose data type is the same as the input argument.

## Examples

The following statement illustrates how to use the `CEIL()` function to round a number up to the nearest integer:

```
SELECT
    CEIL( 200.25 );
```

The result is:

```
 ceil
------
  201
(1 row)
```

Let’s take the `customer` and `payment` tables in the [sample database](../postgresql-getting-started/postgresql-sample-database) for the demonstration.

![customer and payment tables](/postgresqltutorial/customer-and-payment-tables.png)The following example calculates the ceiling of amounts paid by customers for rentals:

```
SELECT
    first_name,
    last_name,
    CEIL(SUM( amount )) amt
FROM
    payment
INNER JOIN customer
        USING(customer_id)
GROUP BY
    customer_id
ORDER BY
    amt DESC;
```

The following picture illustrates the result:

![PostgreSQL CEIL function example](/postgresqltutorial/PostgreSQL-CEIL-function-example.png)

## Remarks

To round a number down to the nearest whole number, you use the [`FLOOR()`](postgresql-floor) function.

In this tutorial, you have learned how to use the PostgreSQL `CEIL()` function to round a number up to the nearest integer, greater than or equal to the number.


# CBRT

---
title: 'PostgreSQL CBRT() Function'
page_title: 'PostgreSQL CBRT() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL CBRT() function to calculate the cube root of a number.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-math-functions/postgresql-cbrt/'
ogImage: ''
updatedOn: '2024-04-18T02:16:40+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CEIL() Function'
  slug: 'postgresql-math-functions/postgresql-ceil'
nextLink:
  title: 'PostgreSQL DIV() Function'
  slug: 'postgresql-math-functions/postgresql-div'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `CBRT()` function to calculate the cube root of a number.

## Introduction to the PostgreSQL CBRT() function

A cube root number is a number that when you multiply itself twice, you’ll get the cube number. For example, 2 is a cube root number of 8 because when you multiply the number 2 by itself three times, you’ll get the number 8:

```sql
2 * 2 * 2 = 8
```

In PostgreSQL, the `CBRT()` is a math function that returns the cube root of a number.

Here’s the syntax of the `CBRT()` function:

```sql
CBRT(n)
```

In this syntax:

- `n` is the number that you want to calculate the cube root. `n` can be a literal number, an expression, or a table column.

The `CBRT()` function returns the cube root of a number n with the double precision type. If `n` is `NULL`, the `CBRT()` function returns `NULL`.

If `n` is a string, the `CBRT()` function will attempt to convert it to a number before calculating the cube root. If the conversion fails, it raises an error.

## PostgreSQL CBRT() function examples

Let’s explore some examples of using the `CBRT()` function.

### 1\) Basic PostgreSQL CBRT() function example

The following example uses the `CBRT()` function to calculate the cube root of 27:

```sql
SELECT CBRT(27) result;
```

Output:

```text
 result
--------
      3
```

It returns 3 because 3\* 3 \*3 \= 27\.

### 2\) Using CBRT() function with a negative number

The following example uses the `CBRT()` function to find the cube root of \-27:

```sql
SELECT CBRT(-27) result;
```

Output:

```text
 result
--------
     -3
```

The result is \-3 because \-3 \* \-3 \* \-3 is \-27\. Please note that the cube root of a negative number is always negative.

### 3\) Using CBRT() function with numeric strings

The following example uses the `CBRT()` function with a numeric string:

```sql
SELECT CBRT('125') result;
```

Output:

```text
 result
--------
      5
```

In this example, the `CBRT()` function converts the text ‘125’ to the number 125 and calculates the cube root.

### 4\) Using the CBRT() function with table data

First, [create a table](../postgresql-tutorial/postgresql-create-table) called `cube_volumes` that stores the volumes of cubes:

```sql
CREATE TABLE cube_volumes(
    id INT GENERATED ALWAYS AS IDENTITY,
    volume DEC(19,2),
    PRIMARY KEY(id)
);
```

Second, [insert rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `cube_volumes` table:

```sql
INSERT INTO
  cube_volumes (volume)
VALUES
  (8),
  (125),
  (NULL),
  (0)
RETURNING *;
```

Output:

```text
 id | volume
----+--------
  1 |   8.00
  2 | 125.00
  3 |   null
  4 |   0.00
(4 rows)
```

Third, calculate the side lengths of cubes using the `CBRT()` function:

```sql
SELECT
  id,
  volume,
  CBRT (volume) side_length
FROM
  cube_volumes;
```

Output:

```text
 id | volume | side_length
----+--------+-------------
  1 |   8.00 |           2
  2 | 125.00 |           5
  3 |   null |        null
  4 |   0.00 |           0
(4 rows)
```

## Summary

- Use the `CBRT()` function to calculate the cube root of a number.


# DEGREES

---
title: 'PostgreSQL DEGREES() Function'
page_title: 'PostgreSQL DEGREES() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL DEGREES() function to convert radians to degrees.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-math-functions/postgresql-degrees/'
ogImage: ''
updatedOn: '2024-02-18T03:54:44+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL DIV() Function'
  slug: 'postgresql-math-functions/postgresql-div'
nextLink:
  title: 'PostgreSQL EXP() Function'
  slug: 'postgresql-math-functions/postgresql-exp'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `DEGREES()` function to convert radians to degrees.

## Introduction to the PostgreSQL DEGREES() function

The `DEGREES()` function converts radians to degrees. Here’s the syntax of the `DEGREES()` function:

```sql
DEGREES(radians_value)
```

In this syntax, the `radians_value` is a value in radians that you want to convert to degrees.

The `DEGREES()` function returns the value of the `radians_value` in degrees.

If the `radians_value` is `NULL`, the `DEGREES()` function returns `NULL`.

## PostgreSQL DEGREES() function examples

Let’s take some examples of using the `DEGREES()` function.

### 1\) Basic DEGREES() function examples

The following example uses the `DEGREES()` function to convert 1 radian to its equivalent degrees:

```sql
SELECT DEGREES(1);
```

Output:

```text
      degrees
-------------------
 57.29577951308232
(1 row)
```

The following example uses the `DEGREES()` function to convert the value of π (pi) radians to its equivalent in degrees:

```sql
SELECT DEGREES(PI());
```

Output:

```text
 degrees
---------
     180
(1 row)
```

Note that the `PI()` function returns the value of π (pi) radians.

### 2\) Using the DEGREES() function with table data

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `angles` to store radian data:

```sql
CREATE TABLE angles (
    id SERIAL PRIMARY KEY,
    angle_radians NUMERIC
);
```

Second, [insert some rows](../postgresql-tutorial/postgresql-insert) into the `angles` table:

```sql
INSERT INTO angles (angle_radians)
VALUES
    (2*PI()),
    (PI()),
    (PI()/2),
    (NULL)
RETURNING *;
```

Third, use the `DEGREES()` function to convert radians to degrees:

```sql
SELECT
    id,
    angle_radians,
    ROUND(DEGREES(angle_radians)::numeric, 0) AS angle_degrees
FROM
    angles;
```

Output:

```text
 id |  angle_radians   | angle_degrees
----+------------------+---------------
  1 | 6.28318530717959 |           360
  2 | 3.14159265358979 |           180
  3 |  1.5707963267949 |            90
  4 |             null |          null
(4 rows)
```

## Summary

- Use the PostgreSQL `DEGREES()` function to convert radians to degrees.


# DIV

---
title: 'PostgreSQL DIV() Function'
page_title: 'PostgreSQL DIV() Function By Practical Examples'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL DIV() function to perform integer division and apply it effectively.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-math-functions/postgresql-div/'
ogImage: ''
updatedOn: '2024-02-17T05:09:08+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CBRT() Function'
  slug: 'postgresql-math-functions/postgresql-cbrt'
nextLink:
  title: 'PostgreSQL DEGREES() Function'
  slug: 'postgresql-math-functions/postgresql-degrees'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `DIV()` function to perform integer division.

## Introduction to the PostgreSQL DIV() function

The `DIV()` function is a useful tool for performing integer division. Unlike the division operator (`/`), which returns a floating\-point result, the `DIV()` function provides an integer quotient.

Here’s the basic syntax of the `DIV()` function:

```sqlsql
DIV(dividend, divisor)
```

In this syntax:

- `dividend` is the number that you want to divide.
- `divisor` is the number to which to divide the dividend.

The `DIV()` function returns the integer quotient of the division.

## PostgreSQL DIV() function examples

Let’s explore some examples of using the `DIV()` function.

### 1\) Basic DIV() function example

The following uses the `DIV()` function to return the result of dividing 10 by 3:

```
SELECT DIV(10,3) as result;
```

Output:

```text
 result
--------
      3
(1 row)
```

The result is 3\.

Unlike regular division, the `DIV()` function truncates any fractional part of the result and returns only the integer part.

### 2\) Grouping data into bins

You can group numerical data data into bins using the `DIV()` function. For example, you can group film from the `film` table of the [sample database](../postgresql-getting-started/postgresql-sample-database) into bins of 30 minutes:

```
SELECT
  title,
  DIV(length, 30) * 30 as bin
FROM
  film
GROUP BY
  bin,
  title
ORDER BY
  title;
```

Output:

```
            title            | bin
-----------------------------+-----
 Academy Dinosaur            |  60
 Ace Goldfinger              |  30
 Adaptation Holes            |  30
 Affair Prejudice            |  90
 African Egg                 | 120
 Agent Truman                | 150
 Airplane Sierra             |  60
...
```

In this example, we group the lengths of films into bins of 30 minutes.

### 3\) Using the PostgreSQL DIV() for calculating ages

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `employees` and [insert some data into it](../postgresql-tutorial/postgresql-insert-multiple-rows):

```
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    birthdate DATE NOT NULL
);

INSERT INTO employees (name, birthdate)
VALUES
    ('John Doe', '1990-05-15'),
    ('Jane Smith', '1985-09-20'),
    ('Michael Johnson', '1982-03-10'),
    ('Emily Brown', '1995-11-28')
RETURNING *;
```

Output:

```text
 id |      name       | birthdate
----+-----------------+------------
  1 | John Doe        | 1990-05-15
  2 | Jane Smith      | 1985-09-20
  3 | Michael Johnson | 1982-03-10
  4 | Emily Brown     | 1995-11-28
(4 rows)
```

Second, calculate the age of each employee:

```
SELECT name, DIV(EXTRACT(YEAR FROM AGE(current_date, birthdate)), 1) AS age
FROM employees;
```

Output:

```
      name       | age
-----------------+-----
 John Doe        |  33
 Jane Smith      |  38
 Michael Johnson |  41
 Emily Brown     |  28
(4 rows)
```

How it works.

- Use the [AGE()](../postgresql-date-functions/postgresql-age) function to calculate age.
- Use the [EXTRACT()](../postgresql-date-functions/postgresql-extract) function to extract the year from the age.
- Use the `DIV()` function to return the integer part of the age.

## Summary

- Use the PostgreSQL `DIV()` function to perform integer division.


# EXP

---
title: 'PostgreSQL EXP() Function'
page_title: 'PostgreSQL EXP() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL EXP() function to calculate the exponential of a number.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-math-functions/postgresql-exp/'
ogImage: ''
updatedOn: '2024-04-18T03:00:18+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL DEGREES() Function'
  slug: 'postgresql-math-functions/postgresql-degrees'
nextLink:
  title: 'PostgreSQL FACTORIAL() Function'
  slug: 'postgresql-math-functions/postgresql-factorial'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `EXP()` function to calculate the exponential of a number.

## Introduction to the PostgreSQL EXP() function

An exponential of a number is the number e, approximately equal to `2.71`, raised to a given power (en).

In PostgreSQL, you can use the `EXP()` function to calculate the exponential of a number.

Here’s the syntax of the `EXP()` function:

```plaintextsql
EXP(n)
```

In this syntax:

- `n` is the number that you want to calculate the exponential. It can be a literal number, an expression, or a table column.

The `EXP()` function returns the exponential of a number in double precision. The `EXP()` function returns `NULL` if the n is `NULL`.

If n is a string, the `EXP()` function will attempt to convert it to a number before calculating the exponential. If the conversion fails, the `EXP()` function will raise an error.

## PostgreSQL EXP() function examples

Let’s take some examples to practice the `EXP()` function.

### 1\) Basic EXP() function examples

The following example uses the `EXP()` function to return the exponential of 1:

```sql
SELECT EXP(1) result;
```

Output:

```text
      result
-------------------
 2.718281828459045
(1 row)
```

It returns the Euler number (e) because e1 is e.

The following statement uses the `EXP()` function to return the exponential of zero:

```sql
SELECT EXP(0) result;
```

Output:

```text
 result
--------
      1
(1 row)
```

It returns 1 because e0 is 1\.

### 2\) Using the EXP() function with numeric strings

The following example uses the `EXP()` function with a numeric string:

```sql
SELECT EXP('10') result;
```

Output:

```text
        exp
--------------------
 22026.465794806718
(1 row)
```

In this example, the EXP() function converts the string ’10’ to the number 10 before calculating the exponential of 10\.

The following example raises an error because the function fails to convert the string ’10x’ to a number:

```plaintext
SELECT EXP('10X') result;
```

Error:

```
ERROR:  invalid input syntax for type double precision: "10X"
LINE 1: SELECT EXP('10X') result;
                   ^
```

## Summary

- Use the `EXP()` function to calculate the exponential of a number.


# FLOOR

---
title: 'PostgreSQL FLOOR() Function'
page_title: 'PostgreSQL FLOOR() Function By Practical Examples'
page_description: 'Show you how to use the PostgreSQL FLOOR() function to round a number down to the nearest integer, which is less than or equal to the number.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-math-functions/postgresql-floor/'
ogImage: '/postgresqltutorial/payment-table.png'
updatedOn: '2024-02-25T04:31:17+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL FACTORIAL() Function'
  slug: 'postgresql-math-functions/postgresql-factorial'
nextLink:
  title: 'PostgreSQL GCD() Function'
  slug: 'postgresql-math-functions/postgresql-gcd'
---

The PostgreSQL `FLOOR()` function returns a number rounded down to the next whole number.

## Syntax

The syntax of the `FLOOR()` function is as follows:

```css
FLOOR(numeric_expression)
```

## Arguments

The `FLOOR()` function requires one argument:

**1\) `numeric_expression`**

The `numeric_expression` is a number or an expression that evaluates to a number, which you want to round down.

## Return Value

The `FLOOR()` function returns a value whose data type is the same as the input argument.

## Examples

The following example shows how to use the `FLOOR()` function to round a number down to the nearest integer:

```
SELECT
    FLOOR( 150.75 );
```

The result is:

```
150
```

See the following `payment` table in the [sample database](../postgresql-getting-started/postgresql-sample-database):

![payment table](/postgresqltutorial/payment-table.png)
The following statement returns the floor of the amount paid by the customer:

```
SELECT
    customer_id,
    FLOOR(SUM( amount )) amount_paid
FROM
    payment
GROUP BY
    customer_id
ORDER BY
    amount_paid DESC;
```

The following picture illustrates the result:

![PostgreSQL FLOOR Function Example](/postgresqltutorial/PostgreSQL-FLOOR-Function-Example.png)

## Remarks

To round a number up to the nearest whole number, you use the [`CEIL()`](postgresql-floor) function.

In this tutorial, you have learned how to use the PostgreSQL `FLOOR()` function to round a number down to the nearest integer, which is less than or equal to the number.


# MOD

---
title: 'PostgreSQL MOD() Function'
page_title: 'PostgreSQL MOD() Function'
page_description: 'The PostgreSQL MOD() function performs the modulo operation, returning the remainder after dividing the first argument by the second one.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-math-functions/postgresql-mod/'
ogImage: ''
updatedOn: '2024-02-18T07:38:31+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL MIN_SCALE() Function'
  slug: 'postgresql-math-functions/postgresql-min_scale'
nextLink:
  title: 'PostgreSQL LN() Function'
  slug: 'postgresql-math-functions/postgresql-ln'
---

**Summary**: In this tutorial, you will learn how to use the PostgreSQL `MOD()` function performs the modulo operation, returning the remainder after dividing the first argument by the second one.

## Introduction to the PostgreSQL MOD() function

The MOD() function allows you to perform a modulo operation, returning the remainder after dividing the first argument by the second one.

Here’s the basic syntax of the PostgreSQL `MOD()` function:

```css
MOD(dividend,divisor)
```

In this syntax:

- `dividend`: The `dividend` is a number that you want to divide.
- `divisor`: The `divisor` is the number by which you want to divide the dividend.

The `divisor` must not be zero (0\), otherwise, the function will issue the division by zero error.

The `MOD()` function returns a number whose [data type](../postgresql-tutorial/postgresql-data-types) is the same as the input argument. It returns NULL if either `dividend` or `divisor` is `NULL`.

## PostgreSQL MOD() function examples

Let’s explore some examples of using the MOD() function.

### 1\) Basic PostgreSQL MOD() function examples

The following example uses the `MOD()` function to get the remainder of two integers:

```
SELECT MOD(15,4);
```

Output:

```
 mod
-----
   3
(1 row)
```

The following statement uses the `MOD()` function to get the remainder of 15 and \-5:

```
SELECT MOD(15,-4);
```

Output:

```
 mod
-----
   3
(1 row)
```

But the following statement returns a negative result:

```
SELECT MOD(-15,4);
```

The remainder is a negative number:

```
 mod
-----
  -3
(1 row)

```

Similarly, the following statement returns the same negative remainder number:

```
SELECT MOD(-15,-4);
```

Output:

```
 mod
-----
  -3
(1 row)
```

### 2\) Using the MOD() function with decimal numbers

The following example uses the `MOD()` function to calculate the remainder when dividing 10\.5 by 3, resulting in 1\.5:

```
SELECT MOD(10.5, 3);
```

Output:

```css
 mod
-----
 1.5
(1 row)
```

## Summary

- Use the PostgreSQL `MOD()` function to find the remainder after dividing one number by another.


# LN

---
title: 'PostgreSQL LN() Function'
page_title: 'PostgreSQL LN() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL LN() function to calculate the natural logarithm of a number.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-math-functions/postgresql-ln/'
ogImage: ''
updatedOn: '2024-04-18T04:23:16+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL MOD() Function'
  slug: 'postgresql-math-functions/postgresql-mod'
nextLink:
  title: 'PostgreSQL LOG() Function'
  slug: 'postgresql-math-functions/postgresql-log'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `LN()` function to calculate the natural logarithm of a number.

## Introduction to the PostgreSQL LN() function

The natural logarithm is a function that represents the logarithm to base e, where e is Euler’s number, which is approximately equal to `2.71828`.

In Math, the natural logarithm of a x is denoted as ln(x).

If ln(x) \= y, then ey \= x.

In PostgreSQL, you use the `LN()` function to calculate the natural logarithm of a number.

Here’s the syntax of the `LN()` function:

```sql
LN(n)
```

In this syntax:

- `n` is a number with the type numeric or double precision. It can be a literal number, an expression, or a table column. `n` cannot be zero.

The `LN()` function returns the natural logarithm of `n` with the type corresponding to the type of `n`. It returns `NULL` if n is `NULL`.

If n is a string, the `LN()` function will convert it to a type numeric or double precision value. If the conversion fails, the `LN()` function raises an error.

The `LN()` function is the inverse of the [`EXP()`](postgresql-exp) function that returns the exponential value of a number.

## PostgreSQL LN() function examples

Let’s take some examples of using the `LN()` function.

### 1\) Basic PostgreSQL LN() function examples

The following example uses the `LN()` function to return the natural logarithm of 10:

```sql
SELECT LN(10) result;
```

Output:

```text
      result
-------------------
 2.302585092994046
```

The following statement uses the `LN()` function to return the natural logarithm of e:

```sql
SELECT LN(EXP(1)) result;
```

Output:

```text
 result
--------
      1
```

In this example, the `EXP`(1\) function returns e1, which is e. Then, the `LN()` function returns the natural logarithm of e, which returns 1\.

### 2\) Using the LN() function with text

The following example uses the `LN()` function to calculate the natural logarithm of a numeric string ’10’

```sql
SELECT LN('10') result;
```

Output:

```text
      result
-------------------
 2.302585092994046
```

In this example, the `LN()` function converts the string ’10’ to a number before calculating the natural logarithm.

The following example attempts to calculate the natural logarithm of the string ’10x’:

```sql
SELECT LN('10x') result;
```

The function raises an error because it cannot convert the string ’10x’ to a number:

```sql
ERROR:  invalid input syntax for type double precision: "10x"
LINE 1: SELECT LN('10x') result;
                  ^
```

## Summary

- Use the `LN()` function to calculate the natural logarithm of a number.


# POWER

---
title: 'PostgreSQL POWER() Function'
page_title: 'PostgreSQL POWER() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL POWER() function to raise a number to a specific power.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-math-functions/postgresql-power/'
ogImage: ''
updatedOn: '2024-02-17T15:07:31+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL LOG() Function'
  slug: 'postgresql-math-functions/postgresql-log'
nextLink:
  title: 'PostgreSQL PI() Function'
  slug: 'postgresql-math-functions/postgresql-pi-function'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `POWER()` function to raise a number to a specific power.

## Introduction to PostgreSQL POWER() function

The `POWER()` function allows you to raise a number to a specific power. Here’s the basic syntax of the `POWER()` function:

```sql
POWER(base, exponent)
```

In this syntax:

- `base`: This is the base number
- `exponent`: This is the exponent to which you want to raise the base number.

The `POWER()` function returns a numeric value representing the result of raising the base number to a specified exponent. It returns `NULL` if either `base` or `exponent` is `NULL`.

## PostgreSQL POWER() function examples

Let’s take some examples of using the `POWER()` function.

### 1\) Basic POWER() function examples

The following example uses the `POWER()` function to raise the number to the power of 3:

```sql
SELECT POWER(2,3) result;
```

Output:

```text
 result
--------
      8
(1 row)
```

Similarly, you can use the `POWER()` function with decimal values:

```sql
SELECT POWER(2.5, 2);
```

Output:

```text
       power
--------------------
 6.2500000000000000
(1 row)
```

### 2\) Using the POWER() function with negative exponent

The following example uses the `POWER()` function with a negative exponent:

```sql
SELECT POWER(10, -2);
```

Output:

```text
 power
-------
  0.01
(1 row)
```

In this example, we raise 10 to the power of \-2 resulting in `0.01`.

### 3\) Using the POWER() function with a fractional exponent

The following example uses the `POWER()` function to raise the number 2 to the power of `1.5`:

```sql
SELECT POWER(2, 1.5);
```

Output:

```text
       power
--------------------
 2.8284271247461901
(1 row)
```

### 4\) Using the POWER() function with table data

We’ll use the `POWER()` function to calculate [compound interest](https://en.wikipedia.org/wiki/Compound_interest).

First, [create a table](../postgresql-tutorial/postgresql-create-table) called `investments` to store the investment data:

```sql
CREATE TABLE investments (
    id SERIAL PRIMARY KEY,
    investment_amount NUMERIC NOT NULL,
    annual_interest_rate NUMERIC NOT NULL,
    years INT NOT NULL
);
```

Second, [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `investments` table:

```sql
INSERT INTO investments (investment_amount, annual_interest_rate, years)
VALUES
    (1000, 5, 1),
    (2000, 7, 3),
    (5000, 4.5, 5)
RETURNING *;
```

Output:

```text
 id | investment_amount | annual_interest_rate | years
----+-------------------+----------------------+-------
  1 |              1000 |                    5 |     1
  2 |              2000 |                    7 |     3
  3 |              5000 |                  4.5 |     5
(3 rows)
```

Third, calculate the compound interest of each investment in the `investments` table:

```sql
SELECT
    investment_amount,
    annual_interest_rate,
    years,
    ROUND(investment_amount * POWER(1 + (annual_interest_rate / 100), years), 2) AS future_value
FROM
    investments;
```

Output:

```text
 investment_amount | annual_interest_rate | years | future_value
-------------------+----------------------+-------+--------------
              1000 |                    5 |     1 |      1050.00
              2000 |                    7 |     3 |      2450.09
              5000 |                  4.5 |     5 |      6230.91
(3 rows)
```

The query returns the initial investment details along with the calculated future value for each investment.

To calculate the compound interest of each investment:

- Calculate the interest rate using the `POWER()` function.
- Use the [`ROUND()`](postgresql-round) function to round the future value to two decimal places.

## Summary

- Use the PostgreSQL `POWER()` function to raise a number to a specific power.


# RANDOM

---
title: 'PostgreSQL RANDOM() Function'
page_title: 'PostgreSQL RANDOM() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL RANDOM() function to generate random values.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-math-functions/postgresql-random/'
ogImage: ''
updatedOn: '2024-02-16T14:56:59+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL RADIANS() Function'
  slug: 'postgresql-math-functions/postgresql-radians'
nextLink:
  title: 'PostgreSQL ROUND() Function'
  slug: 'postgresql-math-functions/postgresql-round'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `RANDOM()` function to generate random values.

## Introduction to the PostgreSQL RANDOM() function

The `RANDOM()` function allows you to generate random values. Here’s the basic syntax of the `RANDOM()` function:

```sql
RANDOM()
```

The `RANDOM()` function returns a random value between 0 and 1\.

In practice, you’ll find the `RANDOM()` function useful in various applications such as:

- Generate random data.
- Shuffling results.
- Select random rows from a table.

## PostgreSQL RANDOM() function examples

Let’s take some examples of using the PostgreSQL `RANDOM` function.

### 1\) Basic PostgreSQL RANDOM() function example

The following query uses the `RANDOM()` function to generate a random value between 0 and 1:

```sql
SELECT RANDOM() AS random;
```

Output:

```text
       random
--------------------
 0.1118658328429385
(1 row)
```

### 2\) Generating random integers

To generate a random integer, you need to use the `RANDOM()` function with the [`FLOOR()`](postgresql-floor) function. For example, the following generates a random integer between 1 and 100:

```sql
SELECT floor(random() * 100) + 1 AS random_integer;
```

Sample output:

```text
 random_integer
----------------
             34
(1 row)
```

### 3\) Retrieving random records

Sometimes, you may need to retrieve random records from a table. To do that, you can utilize the `RANDOM()` function in conjunction with the `ORDER` `BY` clause.

For example, the following query uses the `RANDOM()` function to retrieve a random film from the `film` table in the [sample database](../postgresql-getting-started/postgresql-sample-database):

```sql
SELECT title
FROM film
ORDER BY RANDOM()
LIMIT 1;
```

Sample output:

```text
       title
-------------------
 Outfield Massacre
(1 row)
```

### 4\) Shuffling results

You can use the `RANDOM()` function to shuffle the rows in a result set of a query.

For example, the following query uses the `RANDOM()` function to shuffle the rows from the film table:

```sql
SELECT title FROM film ORDER BY RANDOM();
```

Sample output:

```text
            title
-----------------------------
 Shootist Superfly
 Beauty Grease
 Craft Outfield
 Amistad Midsummer
 Lord Arizona
...
```

### 5\) Seed for reproducibility

By default, PostgreSQL uses a deterministic pseudo\-random number generator to generate random numbers.

But if you need to generate the same random number, you can reissue the `SETSEED()` function in the same session with the same argument.

For example, the following query always returns the same random number:

```sql
SELECT SETSEED(0.5), RANDOM();
```

## Summary

- Use the `RANDOM()` function to generate a random number between 0 and 1\.


# RADIANS

---
title: 'PostgreSQL RADIANS() Function'
page_title: 'PostgreSQL RADIANS() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL RADIANS() function to convert degrees to radians.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-math-functions/postgresql-radians/'
ogImage: ''
updatedOn: '2024-02-18T04:15:55+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL PI() Function'
  slug: 'postgresql-math-functions/postgresql-pi-function'
nextLink:
  title: 'PostgreSQL RANDOM() Function'
  slug: 'postgresql-math-functions/postgresql-random'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `RADIANS()` function to convert degrees to radians.

## Introduction to the PostgreSQL RADIANS() function

The `RADIANS()` function converts degrees to radians.

Here’s the basic syntax of the `RADIANS()` function:

```sql
RADIANS(degrees_value)
```

In this syntax, the `degrees_value` is a value in degrees that you want to convert to radians. The function returns the `degrees_value` converted to radians.

If the `degrees_value` is `NULL`, the function returns `NULL`.

## PostgreSQL RADIANS() function examples

Let’s explore some examples of using the `RADIANS()` function.

### 1\) Basic RADIANS() function example

The following example uses the `RADIANS()` function to convert 180 degrees to its equivalent in radians, resulting in `PI` value:

```sql
SELECT RADIANS(180);
```

Output:

```text
      radians
-------------------
 3.141592653589793
(1 row)
```

### 2\) Using the RADIANS() function with table data

We’ll show you how to use the `RADIANS` with data in a table.

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `angles` to store angle data in radians:

```sql
CREATE TABLE angles (
    id SERIAL PRIMARY KEY,
    angle_degrees NUMERIC
);
```

Second, [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `angles` table:

```sql
INSERT INTO angles (angle_degrees)
VALUES
    (45),
    (60),
    (90),
    (NULL)
RETURNING *;
```

Output:

```text
 id | angle_degrees
----+---------------
  1 |            45
  2 |            60
  3 |            90
  4 |          null
(4 rows)
```

Third, use the `RADIANS()` function to convert the values in the `angle_degrees` column to radians:

```sql
SELECT
    id,
    angle_degrees,
    RADIANS(angle_degrees) AS angle_radians
FROM
    angles;
```

Output:

```text
 id | angle_degrees |   angle_radians
----+---------------+--------------------
  1 |            45 | 0.7853981633974483
  2 |            60 | 1.0471975511965976
  3 |            90 | 1.5707963267948966
  4 |          null |               null
(4 rows)
```

## Summary

- Use the PostgreSQL `RADIANS()` function to convert degrees to radians.


# ROUND

---
title: 'PostgreSQL ROUND() Function'
page_title: 'PostgreSQL ROUND() Function'
page_description: 'Show you how to use the PostgreSQL ROUND() function to round a number to its nearest integer or a number of specified decimal places.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-math-functions/postgresql-round/'
ogImage: '/postgresqltutorial/customer-and-payment-tables.png'
updatedOn: '2024-02-16T14:25:02+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL RANDOM() Function'
  slug: 'postgresql-math-functions/postgresql-random'
nextLink:
  title: 'PostgreSQL SQRT() Function'
  slug: 'postgresql-math-functions/postgresql-sqrt'
---

The PostgreSQL `ROUND()` function rounds a numeric value to its nearest [integer](../postgresql-tutorial/postgresql-integer) or a number with the number of decimal places.

## Syntax

The following illustrates the syntax of the `ROUND()` function:

```css
ROUND (source [ , n ] )
```

## Arguments

The `ROUND()` function accepts 2 arguments:

1\) source

The `source` argument is a number or a numeric expression that is to be rounded.

2\) n

The `n` argument is an integer that determines the number of decimal places after rounding.

The n argument is optional. If you omit the n argument, its default value is 0\.

## Return value

The `ROUND()` function returns a result whose type is the same as the input if you omit the second argument.

If you use both arguments, the `ROUND()` function returns a numeric value.

## Examples

### 1\) Basic ROUND() function example

The following example shows how to round a decimal using the `ROUND()` function:

```css
SELECT
    ROUND( 10.4 );
```

Because the nearest integer of 10\.4 is 10, the function returns 10 as expected:

```css
10
```

The following example rounds 10\.5:

```
SELECT
    ROUND( 10.5 );
```

Output:

```css
11
```

### 2\) Round to 2 decimal places examples

The following example uses the `ROUND()` function to round a number to the one with 2 decimal places:

```
SELECT
    ROUND( 10.812, 2 );
```

Result:

```css
10.81
```

And another example of rounding a decimal to 2 decimal places:

```css
SELECT
    ROUND( 10.817, 2 );
```

Result:

```css
10.82
```

You can change the second argument to round a number to specific decimal places.

### 3\) Rounding data from table examples

We will use the following `payment` and `customer` tables in the [sample database](../postgresql-getting-started/postgresql-sample-database) for the demonstration.

![customer and payment tables](/postgresqltutorial/customer-and-payment-tables.png)The following statement retrieves the average rental fee that each customer has paid.

```php
SELECT
    first_name,
    last_name,
    ROUND( AVG( amount ), 2 ) avg_rental
FROM
    payment
INNER JOIN customer
        USING(customer_id)
GROUP BY
    customer_id
ORDER BY
    avg_rental DESC;
```

In this statement, we use the `ROUND()` function to round the average rental fee to 2 decimal places.

Output:

```
first_name  |  last_name   | avg_rental
-------------+--------------+------------
 Brittany    | Riley        |       5.62
 Kevin       | Schuler      |       5.52
 Ruth        | Martinez     |       5.49
 Linda       | Williams     |       5.45
 Paul        | Trout        |       5.39
 Daniel      | Cabral       |       5.30
...
```

The following statement calculates the average number of rentals per customer:

```
WITH rental(customer_id,rent) AS
(
    SELECT
        customer_id,
        COUNT( rental_id )
    FROM
        payment
    GROUP BY
        customer_id
)
SELECT
    ROUND(AVG(rent))
FROM
    rental;
```

Output:

```
 round
-------
    24
(1 row)
```

In this example, we used the `ROUND()` function to round the result to an integer.

## Summary

- Use the PostgreSQL `ROUND()` function to round a number to its nearest integer or a number of specified decimal places.


# PI

---
title: 'PostgreSQL PI() Function'
page_title: 'PostgreSQL PI() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL PI() function to return the pi value.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-math-functions/postgresql-pi-function/'
ogImage: ''
updatedOn: '2024-04-18T03:47:36+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL POWER() Function'
  slug: 'postgresql-math-functions/postgresql-power'
nextLink:
  title: 'PostgreSQL RADIANS() Function'
  slug: 'postgresql-math-functions/postgresql-radians'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `PI()` function to return the pi value.

## Introduction to the PostgreSQL PI() function

In PostgreSQL, the `PI()` function returns the value of pi denoted by the Greek letter (π), which is approximately equal to `3.14`

Here’s the syntax of the `PI()` function:

```sql
PI()
```

The `PI`() function takes no arguments and returns the constant value of `PI`, which is `3.141592653589793`.

## PostgreSQL PI() function examples

Let’s take some examples of using the `PI()` function examples.

### 1\) Basic PI() function examples

The following statement uses the `PI()` function to return the constant `PI` value:

```sql
SELECT PI();
```

Output:

```text
        pi
-------------------
 3.141592653589793
```

The following example uses the `PI()` function to calculate the area of a circle with a radius of 10:

```sql
SELECT PI() * 10 * 10 area;
```

Output:

```text
       area
-------------------
 314.1592653589793
(1 row)
```

### 2\) Using the PI() function with table data

First, [create a table](../postgresql-tutorial/postgresql-create-table) called `circles` that stores the radiuses of circles:

```sql
CREATE TABLE circles(
   id INT GENERATED ALWAYS AS IDENTITY,
   radius DEC(19,2) NOT NULL,
   PRIMARY KEY(id)
);
```

Second, [insert rows](../postgresql-tutorial/postgresql-insert) into the `circles` table:

```sql
INSERT INTO circles(radius)
VALUES(10), (20), (25)
RETURNING *;
```

Output:

```text
 id | radius
----+--------
  1 |  10.00
  2 |  20.00
  3 |  25.00
(3 rows)
```

Third, calculate the areas of circles using the `PI()` function:

```sql
SELECT id, radius, PI() * radius * radius area
FROM circles;
```

Output:

```text
 id | radius |        area
----+--------+--------------------
  1 |  10.00 |  314.1592653589793
  2 |  20.00 | 1256.6370614359173
  3 |  25.00 | 1963.4954084936207
(3 rows)
```

To make the area more readable, you can use the [`ROUND()`](postgresql-round) function:

```sql
SELECT
  id,
  RADIUS,
  ROUND((PI() * RADIUS * RADIUS)::NUMERIC, 2) AREA
FROM
  circles;
```

Output:

```text
 id | radius |  area
----+--------+---------
  1 |  10.00 |  314.16
  2 |  20.00 | 1256.64
  3 |  25.00 | 1963.50
(3 rows)
```

## Summary

- Use the `PI()` function to return the pi value.


# SIGN

---
title: 'PostgreSQL SIGN() Function'
page_title: 'PostgreSQL SIGN() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL SIGN() function to determine the sign of a number.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-math-functions/postgresql-sign/'
ogImage: ''
updatedOn: '2024-02-17T14:02:19+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL SCALE() Function'
  slug: 'postgresql-math-functions/postgresql-scale'
nextLink:
  title: 'PostgreSQL TRUNC() Function'
  slug: 'postgresql-math-functions/postgresql-trunc'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `SIGN()` function to determine the sign of a number.

## Introduction to the PostgreSQL SIGN() function

The `SIGN()` function allows you to determine the sign of a number.

Here’s the syntax of the `SIGN()` function:

```phpsql
SIGN(numeric_value)
```

The `SIGN()` function accepts a numeric value (`numeric_value`) and returns \-1 if the value is negative, 0 if the value is zero, and 1 if the value is positive. Additionally, it returns `NULL` if the value is `NULL`.

The `SIGN()` function can be handy when you’re working with financial data, performing mathematical calculations, or handling data validation activities.

## PostgreSQL SIGN() function examples

Let’s explore some examples of using the `SIGN()` function.

### 1\) Basic SIGN() function example

The following example uses the `SIGN()` function to get the sign of various numbers:

```sql
SELECT
  SIGN(-10),
  SIGN(0),
  SIGN(10),
  SIGN(NULL);
```

Output:

```text
 sign | sign | sign | sign
------+------+------+------
   -1 |    0 |    1 | null
(1 row)
```

The `SIGN()` returns \-1 for \-10, 0 for 0, 1 for 10, and `NULL` for `NULL`.

### 2\) Using the SIGN() function with table data

First, [create a table](../postgresql-tutorial/postgresql-create-table) called `sales` to store the sales amount by year:

```sql
CREATE TABLE sales (
    year INTEGER PRIMARY KEY,
    sales_amount NUMERIC NOT NULL
);
```

Second, [insert rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `sales` table:

```sql
INSERT INTO sales (year, sales_amount)
VALUES
    (2013, 10000),
    (2014, 12000),
    (2015, 15000),
    (2016, 15000),
    (2017, 20000),
    (2018, 22000),
    (2019, 22000),
    (2020, 23000),
    (2021, 22000),
    (2022, 24000),
    (2023, 26000)
RETURNING *;
```

Third, compare the sales of a year with the previous year and use the `SIGN()` function to output the sales trend:

```sql
SELECT
    year,
    sales_amount,
    LAG(sales_amount) OVER (ORDER BY year) AS previous_year_sales,
    CASE
        WHEN LAG(sales_amount) OVER (ORDER BY year) IS NULL THEN 'N/A'
        WHEN SIGN(sales_amount - LAG(sales_amount) OVER (ORDER BY year)) = 1 THEN 'up'
        WHEN SIGN(sales_amount - LAG(sales_amount) OVER (ORDER BY year)) = -1 THEN 'down'
        ELSE 'unchanged'
    END AS sales_trend
FROM
    sales;
```

Output:

```text
 year | sales_amount | previous_year_sales | sales_trend
------+--------------+---------------------+-------------
 2013 |        10000 |                null | N/A
 2014 |        12000 |               10000 | up
 2015 |        15000 |               12000 | up
 2016 |        15000 |               15000 | unchanged
 2017 |        20000 |               15000 | up
 2018 |        22000 |               20000 | up
 2019 |        22000 |               22000 | unchanged
 2020 |        23000 |               22000 | up
 2021 |        22000 |               23000 | down
 2022 |        24000 |               22000 | up
 2023 |        26000 |               24000 | up
(11 rows)
```

How it works.

- Use the [`LAG()`](../postgresql-window-function/postgresql-lag-function) window function to retrieve the `sales_amount` from the previous year utilizing the `ORDER` `BY` year clause to specify the order of rows.
- Use the [`CASE`](../postgresql-tutorial/postgresql-case) expression to evaluate each row’s sales data and assign a corresponding value to the `sales_trend` column.

If you want to reuse the result of the LAG() function, you can use a [common table expression](../postgresql-tutorial/postgresql-cte):

```
WITH sales_data AS (
    SELECT
        year,
        sales_amount,
        LAG(sales_amount) OVER (ORDER BY year) AS previous_year_sales
    FROM
        sales
)
SELECT
    year,
    sales_amount,
    previous_year_sales,
    CASE
        WHEN previous_year_sales IS NULL THEN 'N/A'
        WHEN SIGN(sales_amount - previous_year_sales) = 1 THEN 'up'
        WHEN SIGN(sales_amount - previous_year_sales) = -1 THEN 'down'
        ELSE 'unchanged'
    END AS sales_trend
FROM
    sales_data;

```

## Summary

- Use the `SIGN()` function to determine the sign of a number.


# SCALE

---
title: 'PostgreSQL SCALE() Function'
page_title: 'PostgreSQL SCALE() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL SCALE() function to retrieve the scale of a number.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-math-functions/postgresql-scale/'
ogImage: ''
updatedOn: '2024-02-17T07:51:05+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL SQRT() Function'
  slug: 'postgresql-math-functions/postgresql-sqrt'
nextLink:
  title: 'PostgreSQL SIGN() Function'
  slug: 'postgresql-math-functions/postgresql-sign'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `SCALE()` function to retrieve the scale of a number.

## Introduction to the PostgreSQL SCALE() function

The scale of a number is the count of decimal digits in its fractional part. For example, the scale of `1.234` is 3 because it has three digits after the decimal point.

The `SCALE()` function allows you to determine the scale of a number.

Here’s the basic syntax of the `SCALE()` function:

```sql
SCALE(numeric_value)
```

The `SCALE()` function returns an integer representing the scale of the `numeric_value`. It returns `NULL` if the `numeric_value` is `NULL`.

## PostgreSQL SCALE() function examples

Let’s explore some examples of using the PostgreSQL `SCALE()` function.

### 1\) Basic SCALE() function example

The following example uses the `SCALE()` function to determine the scale of the number `3.141592653589793`:

```sql
SELECT SCALE(3.141592653589793);
```

Output:

```text
 scale
-------
    15
(1 row)
```

It returns 15 indicating that there are 15 digits after the decimal point.

### 2\) Using the SCALE() table to examine table data

First, [create a table](../postgresql-tutorial/postgresql-create-table) called `product_prices` to store product prices with various scales:

```sql
CREATE TABLE product_prices (
    product_id SERIAL PRIMARY KEY,
    product_name VARCHAR(100) NOT NULL,
    price NUMERIC NOT NULL
);
```

Second, [insert some data](../postgresql-tutorial/postgresql-insert-multiple-rows) into the table:

```sql
INSERT INTO product_prices (product_name, price)
VALUES
    ('T-Shirt', 10.123),
    ('Jeans', 20.5678),
    ('Sneakers', 30.45),
    ('Backpack', 40.12345),
    ('Watch', 50.6789),
    ('Sunglasses', 60.1),
    ('Headphones', 70.23456),
    ('Smartphone', 80.123),
    ('Laptop', 90.5),
    ('Camera', 100.1234)
RETURNING *;
```

Output:

```text
 product_id | product_name |  price
------------+--------------+----------
          1 | T-Shirt      |   10.123
          2 | Jeans        |  20.5678
          3 | Sneakers     |    30.45
          4 | Backpack     | 40.12345
          5 | Watch        |  50.6789
          6 | Sunglasses   |     60.1
          7 | Headphones   | 70.23456
          8 | Smartphone   |   80.123
          9 | Laptop       |     90.5
         10 | Camera       | 100.1234
(10 rows)
```

Third, group the product prices by scales using the `SCALE()` function:

```sql
SELECT
  scale(price) AS price_scale,
  COUNT(*) AS count_of_products
FROM
  product_prices
GROUP BY
  price_scale
ORDER BY
  price_scale;
```

Output:

```text
 price_scale | count_of_products
-------------+-------------------
           1 |                 2
           2 |                 1
           3 |                 2
           4 |                 3
           5 |                 2
(5 rows)
```

By understanding the scales of prices, you can identify the diverse decimal precisions and take appropriate action to standardize them.

## Summary

- Use the `SCALE()` function to retrieve the scale of a number.


# SQRT

---
title: 'PostgreSQL SQRT() Function'
page_title: 'PostgreSQL SQRT() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL SQRT() function to calculate the square root of a number.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-math-functions/postgresql-sqrt/'
ogImage: ''
updatedOn: '2024-02-17T07:21:55+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL ROUND() Function'
  slug: 'postgresql-math-functions/postgresql-round'
nextLink:
  title: 'PostgreSQL SCALE() Function'
  slug: 'postgresql-math-functions/postgresql-scale'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `SQRT()` function to calculate the square root of a number.

## Introduction to the PostgreSQL SQRT() function

The `SQRT()` function is a powerful mathematical function that allows you to calculate the square root of a number.

Here’s the basic syntax of the `SQRT()` function:

```sql
SQRT(number)
```

In this syntax, the `number` is a numeric value for which you want to calculate the square root

The `SQRT()` function returns the square root of the input `number`.

## PostgreSQL SQRT() function examples

Let’s take some examples of using the `SQRT()` function.

### 1\) Basic SQRT() function example

The following example uses the `SQRT()` function to return the square root of 25:

```sql
SELECT SQRT(25) AS result;
```

Output:

```text
 result
--------
      5
(1 row)
```

The query returns the square root of 25, which is 5\.

### 2\) Using PostgreSQL SQRT() function to calculate distance

Suppose you have a table called `coordinates` that consists of columns `x` and `y` representing the coordinates of points in two\-dimensional space:

```sql
-- Create coordinates table
CREATE TABLE coordinates (
    id SERIAL PRIMARY KEY,
    x NUMERIC,
    y NUMERIC
);

-- Insert sample data
INSERT INTO coordinates (x, y) VALUES
    (3, 4),
    (-2, 5),
    (0, 0),
    (8, -6),
    (-1.5, 2.5)
RETURNING *;
```

Output:

```text
 id |  x   |  y
----+------+-----
  1 |    3 |   4
  2 |   -2 |   5
  3 |    0 |   0
  4 |    8 |  -6
  5 | -1.5 | 2.5
(5 rows)
```

The following query uses the `SQRT()` function to calculate the distance of each point from the origin (0,0\):

```sql
SELECT SQRT(x * x + y * y) AS distance_from_origin
FROM coordinates;
```

Output:

```text
 distance_from_origin
----------------------
    5.000000000000000
    5.385164807134504
    0.000000000000000
   10.000000000000000
    2.915475947422650
(5 rows)
```

## Summary

- Use the PostgreSQL `SQRT()` function to calculate the square root of a number.


# TRUNC

---
title: 'PostgreSQL TRUNC() Function'
page_title: 'PostgreSQL TRUNC() Function: Truncating Numbers'
page_description: 'This tutorial shows you how to use the PostgreSQL TRUNC() function to truncate numbers to the specified decimal places.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-math-functions/postgresql-trunc/'
ogImage: '/postgresqltutorial/film-film_category-category-tables.png'
updatedOn: '2024-02-16T14:26:33+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL SIGN() Function'
  slug: 'postgresql-math-functions/postgresql-sign'
nextLink:
  title: 'PostgreSQL TRIM_SCALE() Function'
  slug: 'postgresql-math-functions/postgresql-trim_scale'
---

The PostgreSQL `TRUNC()` function returns a number truncated to a whole number or truncated to the specified decimal places.

## Syntax

The following illustrates the syntax of the PostgreSQL `TRUNC()` function:

```css
TRUNC(number [, precision])
```

## Arguments

The `TRUNC()` function accepts two arguments.

**1\) `number`**

The `number` argument is a numeric value to be truncated

**2\) `precision`**

The `precision` argument is an integer that indicates the number of decimal places.

If the `precision` argument is a positive integer, the `TRUNC()` function truncates digits to the right of the decimal point.

In case the `precision` is a negative integer, the `TRUNC()` function replaces digits to the left of the decimal point.

The precision argument is optional. If you don’t specify it, it defaults to zero (0\). In other words, the `number` is truncated to a whole number.

## Return value

The PostgreSQL `TRUNC()` function returns the same [numeric data type](../postgresql-tutorial/postgresql-numeric) as the first argument if the second argument is not specified. Otherwise, the function returns a numeric value if both arguments are used.

## Examples

### 1\) Truncate to a whole number example

The following example uses the `TRUNC()` function to truncate a number to an integer:

```css
SELECT
    TRUNC(10.6);
```

The result is:

```css
10
```

### 2\) Truncate to the specified decimal place

The following statement truncates a number to 2 decimal places:

```
 SELECT
    TRUNC(
        1.234,
        2
    );
```

Here is the result:

```css
1.23
```

### 3\) Truncate numbers with a negative second argument example

Consider the following example:

```css
SELECT
    TRUNC(150.45,-2)
```

The second argument is \-2, therefore, the `TRUNC()` function replaced the digits to the left of the decimal point that resulting in:

```
100
```

### 4\) Truncate numbers returned by a query

See the following `film`, `film_category`, and `category` tables in the [sample database](../postgresql-getting-started/postgresql-sample-database):

![film film_category category tables](/postgresqltutorial/film-film_category-category-tables.png)The following statement calculates the average rental rate by film category:

```
SELECT
    NAME,
    TRUNC(AVG( rental_rate ),2)
FROM
    film
INNER JOIN film_category
        USING(film_id)
INNER JOIN category
        USING(category_id)
GROUP BY
    NAME
ORDER BY NAME;
```

In this example, we used the `TRUNC()` function to truncate the average rentals to two decimal places.

The following picture illustrates the result:

![PostgreSQL TRUNC example](/postgresqltutorial/PostgreSQL-TRUNC-example.png)
In this tutorial, you have learned how to use the PostgreSQL `TRUNC()` function to truncate numbers.


# TRIM_SCALE

---
title: 'PostgreSQL TRIM_SCALE() Function'
page_title: 'PostgreSQL TRIM_SCALE() Function'
page_description: "In this tutorial, you will learn how to use the PostgreSQL TRIM_SCALE() function to reduce the value's scale by removing trailing zeroes."
prev_url: 'https://www.postgresqltutorial.com/postgresql-math-functions/postgresql-trim_scale/'
ogImage: ''
updatedOn: '2024-02-18T03:02:25+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL TRUNC() Function'
  slug: 'postgresql-math-functions/postgresql-trunc'
nextLink:
  title: 'PostgreSQL WIDTH_BUCKET() Function'
  slug: 'postgresql-math-functions/postgresql-width_bucket'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `TRIM_SCALE()` function to reduce the value’s scale by removing trailing zeroes.

## Introduction to the PostgreSQL TRIM_SCALE() function

The `TRIM_SCALE()` function allows you to reduce the scale of a number by removing trailing zeroes.

Note that the scale of a number is a number of fractional decimal digits.

Here’s the syntax of the `TRIM_SCALE()` function:

```csssql
TRIM_SCALE(numeric_value)
```

In this syntax, the `numeric_value` is a value that you want to trim the scale.

The `TRIM_SCALE()` function returns a numeric value with the numeric type after removing trailing zeroes.

It returns `NULL` if the `numeric_value` is `NULL`.

## PostgreSQL TRIM_SCALE() function examples

Let’s take some examples of using the `TRIM_SCALE()` function.

### 1\) Basic TRIM_SCALE() function example

The following example uses the `TRIM_SCALE()` function to reduce the trailing zeroes of the number `123.45000`:

```sql
SELECT TRIM_SCALE(123.45000);
```

Output:

```text
 trim_scale
------------
     123.45
(1 row)
```

In this example, the `TRIM_SCALE()` function removes the trailing zeroes from the `123.45`000, resulting in `123.45`.

### 2\) Using the TRIM_SCALE() function with table data

We’ll show you an example of using the `TRIM_SCALE()` function to standardize the numeric values in a table.

First, [create a table](../postgresql-tutorial/postgresql-create-table) called `products` to store product data:

```
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    price NUMERIC NOT NULL
);
```

Second, [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `products` table:

```sql
INSERT INTO products (name, price)
VALUES
    ('Smartphone', 699.9900),
    ('Laptop', 1299.99),
    ('Headphones', 149.5000),
    ('Tablet', 449.00),
    ('Smartwatch', 299.00),
    ('Wireless Speaker', 79.9900)
RETURNING *;
```

Output:

```text
 id |       name       |  price
----+------------------+----------
  1 | Smartphone       | 699.9900
  2 | Laptop           |  1299.99
  3 | Headphones       | 149.5000
  4 | Tablet           |   449.00
  5 | Smartwatch       |   299.00
  6 | Wireless Speaker |  79.9900
(6 rows)
```

Third, [update](../postgresql-tutorial/postgresql-update) the prices to remove trailing zeroes using the `TRIM_SCALE()` function:

```sql
UPDATE products
SET price = TRIM_SCALE(price)
RETURNING *;
```

Output:

```text
 id |       name       |  price
----+------------------+---------
  1 | Smartphone       |  699.99
  2 | Laptop           | 1299.99
  3 | Headphones       |   149.5
  4 | Tablet           |     449
  5 | Smartwatch       |     299
  6 | Wireless Speaker |   79.99
(6 rows)
```

## Summary

- Use the `TRIM_SCALE()` function to reduce the scale of a number scale by removing trailing zeroes.


# WIDTH_BUCKET

---
title: 'PostgreSQL WIDTH_BUCKET() Function'
page_title: 'PostgreSQL WIDTH_BUCKET() Function By Practical Examples'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL WIDTH_BUCKET() function for binning numeric data into discrete buckets.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-math-functions/postgresql-width_bucket/'
ogImage: '/postgresqltutorial/film.png'
updatedOn: '2024-02-17T14:08:37+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL TRIM_SCALE() Function'
  slug: 'postgresql-math-functions/postgresql-trim_scale'
nextLink:
  title: 'PostgreSQL Window Functions'
  slug: 'postgresql-math-functions/../postgresql-window-function'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `WIDTH_BUCKET()` function for binning numeric data into discrete buckets.

## Introduction to the PostgreSQL WIDTH_BUCKET() function

The `WIDTH_BUCKET()` function allows you to categorize numeric values into discrete buckets based on specified boundaries.

Here’s the basic syntax of the `WIDTH_BUCKET()` function:

```sql
WIDTH_BUCKET(numeric_value, lower_bound, upper_bound, num_buckets)
```

In this syntax:

- `numeric_value`: The numeric value that you want to place into a bucket.
- `lower_bound`: The lower bound of the range within which the `numeric_value` falls. It is **inclusive**.
- `upper_bound`: The upper bound of the range within which the `numeric_value` falls. It is exclusive.
- `num_buckets`: The total number of buckets to divide the range into.

The `WIDTH_BUCKET()` function returns an integer value that represents the bucket number into which the specified value falls.

If `numeric_value` is less than the lower bound, the `WIDTH_BUCKET()` function returns 0\.

If the `numeric_value` is greater than or equal to the `lower_bound` but less than the upper bound of the first bucket, the `WIDTH_BUCKET()` function returns 1\.

If the numeric value falls within the second bucket, the `WIDTH_BUCKET()` function returns 2\.

This pattern continues until the numeric value falls into the last bucket, where the `WIDTH_BUCKET()` function returns the `num_buckets`

If the `numeric_value` is less than the `lower_bound`, the `WIDTH_BUCKET()` function returns 0\. If the `numeric_value` is greater than the `upper_bound`, the `WIDTH_BUCKET()` function returns the `num_buckets` plus 1\.

In practice, you often use the `WIDTH_BUCKET()` function for data binning tasks and histogram generation.

## PostgreSQL WIDTH_BUCKET() function examples

Let’s explore some examples of using the `WIDTH_BUCKET()` function.

### 1\) Basic WIDTH_BUCKET() function example

The following example uses the `WIDTH_BUCKET()` function to assign numeric values to three buckets (0, 10\), (10, 20\), and (20, 30\):

```sql
SELECT
  WIDTH_BUCKET(-1, 0, 30, 3),
  WIDTH_BUCKET(0, 0, 30, 3),
  WIDTH_BUCKET(12, 0, 30, 3),
  WIDTH_BUCKET(25, 0, 30, 3),
  WIDTH_BUCKET(35, 0, 30, 3);
```

Output:

```text
 width_bucket | width_bucket | width_bucket | width_bucket | width_bucket
--------------+--------------+--------------+--------------+--------------
            0 |            1 |            2 |            3 |            4
(1 row)
```

In this example:

- The `WIDTH_BUCKET()` function returns 0 for the value \-1 because \-1 is less than the lower bound (0\).
- The `WIDTH_BUCKET()` function returns 1 for the value 0 because 0 falls in the range of the first bucket (0,10\).
- The `WIDTH_BUCKET()` function returns 2 for the value 12 because 12 falls in the second bucket (10, 20\).
- The `WIDTH_BUCKET()` function returns 3 for the value 25 because 25 falls in the third bucket (20, 30\).
- The `WIDTH_BUCKET()` functions return 3 for the value 35 because 35 is greater than the upper bound (30\).

### 2\) Using the WIDTH_BUCKET() function with table data

We’ll use the `film` table from the [sample database](../postgresql-getting-started/postgresql-sample-database):

![](/postgresqltutorial/film.png)The following example uses the `WIDTH_BUCKET()` function to categorize the films into six buckets:

```sql
SELECT
  title,
  length,
  WIDTH_BUCKET(length, 40, 200, 6) AS bucket_number
FROM
  film
ORDER BY
  title;
```

Output:

```text
            title            | length | bucket_number
-----------------------------+--------+---------------
 Academy Dinosaur            |     86 |             2
 Ace Goldfinger              |     48 |             1
 Adaptation Holes            |     50 |             1
 Affair Prejudice            |    117 |             3
 African Egg                 |    130 |             4
...
```

### 3\) Using WIDTH_BUCKET() function to generate histogram

The following example uses a [common table expression](../postgresql-tutorial/postgresql-cte) (CTE) to generate the bucket numbers and then calculate the frequency of films falling into each bucket:

```sql
WITH buckets_cte AS (
    SELECT WIDTH_BUCKET(length, 40, 200, 6) AS bucket_number
    FROM film
)
SELECT
    bucket_number,
    COUNT(*) AS frequency
FROM
    buckets_cte
GROUP BY
    bucket_number
ORDER BY
    bucket_number;
```

Output:

```text
 bucket_number | frequency
---------------+-----------
             1 |       147
             2 |       203
             3 |       184
             4 |       194
             5 |       175
             6 |        97
(6 rows)
```

How it works.

CTE:

- First, define a common table expression named `buckets_cte`.
- Second, use the `WIDTH_BUCKET()` function to assign each film’s length into one of six buckets.

Main query:

- First, select data from the `buckets_cte`.
- Second, count the number of films for each bucket using the [`COUNT(*)`](../postgresql-aggregate-functions/postgresql-count-function) function and group the result by the `bucket_number` using the [`GROUP BY`](../postgresql-tutorial/postgresql-group-by) clause.
- Third, sort the result by the `bucket_number`.

### 4\) Generate ASCII histograms

Based on the result set, you can generate a histogram in the application. But if you want to generate a histogram in psql, you can use the following query:

```sql
WITH buckets_cte AS (
    SELECT WIDTH_BUCKET(length, 40, 200, 6) AS bucket_number
    FROM film
),
histogram_cte AS (
    SELECT
        bucket_number,
        COUNT(*) AS frequency
    FROM
        buckets_cte
    GROUP BY
        bucket_number
    ORDER BY
        bucket_number
)
SELECT
    bucket_number,
    REPEAT('*', DIV(frequency,10)::int) AS histogram
FROM
    histogram_cte;
```

Output:

```text
 bucket_number |      histogram
---------------+----------------------
             1 | **************
             2 | ********************
             3 | ******************
             4 | *******************
             5 | *****************
             6 | *********
(6 rows)
```

How it works.

The query defines two common table expressions and generates the histogram using the asterisk character (\*).

- `buckets_cte` `CTE` – Assign films to buckets using the `WIDTH_BUCKET()` function based on their lengths.
- `histogram_cte` `CTE` – Select data from the `buckets_cte` by grouping the frequency of the bucket numbers.
- The main query – Select data from the `histogram_cte` `CTE`. We use the `REPEAT`() function to generate the histogram bars by repeating the asterisk (\*) character a number of times which equals the integer division of frequency by 10\. This is to scale down the histogram to prevent it from being too wide. To perform integer divisions, we use the [`DIV()`](postgresql-div) function. Since the `REPEAT` function accepts an integer only, we cast the result of the `DIV()` to an integer using the cast operator (::).

## Summary

- Use the PostgreSQL `WIDTH_BUCKET()` function for binning numeric data into discrete buckets or generating histograms.


# String Functions

---
title: 'PostgreSQL String Functions'
page_title: 'PostgreSQL String Functions'
page_description: 'This page provides you with the most commonly used PostgreSQL string functions that help you manipulate strings effectively.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/'
ogImage: 'https://www.postgresqltutorial.com//postgresqltutorial/string-functions.png'
updatedOn: '2024-03-20T02:04:54+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL PG_SLEEP() Function'
  slug: 'postgresql-date-functions/postgresql-pg_sleep'
nextLink:
  title: 'PostgreSQL ASCII() Function'
  slug: 'postgresql-string-functions/postgresql-ascii'
---

This page provides the most commonly used PostgreSQL string functions that allow you to manipulate string data effectively.

| Function                                                                | Description                                                                                              | Example                                              | Result             |
| ----------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------- | ---------------------------------------------------- | ------------------ |
| [ASCII](postgresql-string-functions/postgresql-ascii)                   | Return the ASCII code value of a character or Unicode code point of a UTF8 character                     | ASCII(‘A’)                                           | 65                 |
| [CHR](postgresql-string-functions/postgresql-chr)                       | Convert an ASCII code to a character or a Unicode code point to a UTF8 character                         | CHR(65\)                                             | ‘A’                |
| [CONCAT](postgresql-string-functions/postgresql-concat-function)        | Concatenate two or more strings into one                                                                 | CONCAT(‘A’,’B’,’C’)                                  | ‘ABC’              |
| [CONCAT_WS](postgresql-string-functions/postgresql-concat_ws)           | Concatenate strings with a specified separator.                                                          | CONCAT_WS(‘,’,’A’,’B’,’C’)                           | ‘A,B,C’            |
| [FORMAT](postgresql-string-functions/postgresql-format)                 | Format a string based on a template                                                                      | FORMAT(‘Hello %s’,’PostgreSQL’)                      | ‘Hello PostgreSQL’ |
| [INITCAP](postgresql-string-functions/postgresql-letter-case-functions) | Convert words in a string to title case                                                                  | INITCAP(‘hI tHERE’)                                  | Hi There           |
| [LEFT](postgresql-string-functions/postgresql-left)                     | Return the first n character in a string                                                                 | LEFT(‘ABC’,1\)                                       | ‘A’                |
| [LENGTH](postgresql-string-functions/postgresql-length-function)        | Return the number of characters in a string                                                              | LENGTH(‘ABC’)                                        | 3                  |
| [LOWER](postgresql-string-functions/postgresql-lower)                   | Convert a string to lowercase                                                                            | LOWER(‘hI tHERE’)                                    | ‘hi there’         |
| [LPAD](postgresql-string-functions/postgresql-lpad)                     | Extending a string to a length by padding specified characters on the left                               | LPAD(‘123′, 5, ’00’)                                 | ‘00123’            |
| [LTRIM](postgresql-string-functions/postgresql-ltrim)                   | Remove the longest string that contains specified characters from the left of the input string           | LTRIM(‘00123’)                                       | ‘123’              |
| [MD5](postgresql-string-functions/postgresql-md5)                       | Return MD5 hash of a string in hexadecimal                                                               | MD5(‘ABC’)                                           |                    |
| [POSITION](postgresql-string-functions/postgresql-position)             | Return the location of a substring in a string                                                           | POSITION(‘B’ in ‘A B C’)                             | 3                  |
| [REGEXP_MATCHES](postgresql-string-functions/postgresql-regexp_matches) | Replace substrings that match a POSIX regular expression with a new substring                            | SELECT REGEXP_MATCHES(‘ABC’, ‘^(A)(..)$’, ‘g’);      | \{A,BC\}           |
| [REGEXP_REPLACE](postgresql-string-functions/regexp_replace)            | Replace a substring using regular expressions.                                                           | REGEXP_REPLACE(‘John Doe’,'(.\*) (.\*)’,’\\2, \\1′); | ‘Doe, John’        |
| [REPEAT](postgresql-string-functions/postgresql-repeat)                 | Repeat a string the specified number of times.                                                           | REPEAT(‘\*’, 5\)                                     | ‘\*\*\*\*\*’       |
| [REPLACE](postgresql-string-functions/postgresql-replace)               | Replace a substring within a string with a new one.                                                      | REPLACE(‘ABC’,’B’,’A’)                               | ‘AAC’              |
| [REVERSE](postgresql-string-functions/postgresql-reverse)               | Replace a substring within a string with a new one                                                       | REVERSE(‘ABC’)                                       | ‘CBA’              |
| [RIGHT](postgresql-string-functions/postgresql-right)                   | Return the last n characters in the string. When n is negative, return all but the first \\n characters. | RIGHT(‘ABC’, 2\)                                     | ‘BC’               |
| [RPAD](postgresql-string-functions/postgresql-rpad)                     | Extend a string to a length by appending specified characters.                                           | RPAD(‘ABC’, 6, ‘xo’)                                 | ‘ABCxox’           |
| [RTRIM](postgresql-string-functions/postgresql-rtrim)                   | Remove the longest string that contains specified characters from the right of the input string          | RTRIM(‘abcxxzx’, ‘xyz’)                              | ‘abc’              |
| [SPLIT_PART](postgresql-string-functions/postgresql-split_part)         | Split a string on a specified delimiter and return nth substring                                         | SPLIT_PART(‘2017\-12\-31′,’\-‘,2\)                   | ’12’               |
| [SUBSTRING](postgresql-string-functions/postgresql-substring)           | Extract a substring from a string                                                                        | SUBSTRING(‘ABC’,1,1\)                                | A’                 |
| [TRIM](postgresql-string-functions/postgresql-trim-function)            | Remove the leading and trailing characters from a string.                                                | TRIM(‘ ABC  ‘)                                       | ‘ABC’              |
| [UPPER](postgresql-string-functions/postgresql-upper)                   | Convert a string to uppercase                                                                            | UPPER(‘hI tHERE’)                                    | ‘HI THERE’         |


# PostgreSQL String functions

# ASCII

---
title: 'PostgreSQL ASCII() Function'
page_title: 'PostgreSQL ASCII: Get ASCII code or Unicode Code Point of a Character'
page_description: 'This tutorial shows you how to use the PostgreSQL ASCII() function to get the ASCII code or Unicode code point of a character.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-ascii/'
ogImage: '/postgresqltutorial/PostgreSQL-ASCII-function-example.png'
updatedOn: '2024-01-29T01:37:56+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL String Functions'
  slug: 'postgresql-string-functions/'
nextLink:
  title: 'PostgreSQL CHR() Function'
  slug: 'postgresql-string-functions/postgresql-chr'
---

The PostgreSQL `ASCII()` function returns an [ASCII](https://en.wikipedia.org/wiki/ASCII) code value of a character. In the case of UTF\-8, the `ASCII()` function returns the Unicode code point of the character.

## Syntax

The following illustrates the syntax of ASCII function:

```sql
ASCII(char)
```

## Arguments

The `ASCII()` function requires one argument:

**1\) `char`**

The `char` argument is a [character](../postgresql-tutorial/postgresql-char-varchar-text) that you want to get the ASCII code.

If you pass a string to the `ASCII()` function, it will return the ASCII code of the first character.

## Return value

The `ASCII()` function returns an integer that represents the ASCII code value of the input character. In the case of a UTF\-8 character, it returns an integer which is corresponding to the Unicode code point.

## Examples

The following example uses the `ASCII()` function to get the ASCII code values of the character `A` and `a`:

```
SELECT
    ASCII( 'A' ),
    ASCII( 'a' );
```

The output is:

![PostgreSQL ASCII function example](/postgresqltutorial/PostgreSQL-ASCII-function-example.png)
If you pass a sequence of characters to the `ASCII()` function, you will get the ASCII code of the first character as shown in the following example:

```sql
SELECT
    ASCII( 'ABC' );
```

The function returns the ASCII code of the letter A which is 65 as follows:

![PostgreSQL ASCII function - string example](/postgresqltutorial/PostgreSQL-ASCII-function-string-example.png)
The following example illustrates how to use the `ASCII()` function to get the Unicode code point of a UTF\-8 character:

```text
 SELECT
    ASCII( 'Ω' );
```

![PostgreSQL ASCII function - unicode example](/postgresqltutorial/PostgreSQL-ASCII-function-unicode-example.png)

## Remarks

To get the ASCII code value or Unicode code point of an integer, you use the [`CHR()`](postgresql-chr) function.

In this tutorial, you have learned how to use the PostgreSQL `ASCII()` function to get the ASCII code or Unicode code point of a character.


# CONCAT

---
title: 'PostgreSQL CONCAT() Function'
page_title: 'PostgreSQL CONCAT() Function'
page_description: 'This tutorial shows you how to use the PostgreSQL CONCAT() functions to concatenate two or more strings into one.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-concat-function/'
ogImage: '/postgresqltutorial/customer.png'
updatedOn: '2024-01-28T13:55:27+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL RPAD() Function'
  slug: 'postgresql-string-functions/postgresql-rpad'
nextLink:
  title: 'PostgreSQL CONCAT_WS() Function'
  slug: 'postgresql-string-functions/postgresql-concat_ws'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `CONCAT()` function to concatenate two or more strings into one.

## Introduction to PostgreSQL CONCAT() function

To concatenate two or more strings into a single string, you can use the string concatenation operator \|\| as shown in the following example:

```csssqlsql
SELECT
   'John' || ' ' || 'Doe' AS full_name;
```

Output:

```text
 full_name
-----------
 John Doe
(1 row)

```

The following statement uses the concatenation operator (`||`) to concatenate a string with `NULL`:

```
SELECT
   'John' || NULL result;
```

It returns `NULL`.

```text
 result
--------
 null
(1 row)

```

Since version 9\.1, PostgreSQL has introduced a built\-in string function called `CONCAT()` to concatenate two or more strings into one.

Here’s the basic syntax of the `CONCAT()` function:

```sql
CONCAT(string1, string2, ...)
```

The `CONCAT` function accepts a list of input strings, which can be any string type including `CHAR`, `VARCHAR`, and `TEXT`.

The `CONCAT()` function returns a new string that results from concatenating the input strings.

Unlike the concatenation operator `||`, the `CONCAT` function ignores  `NULL` arguments.

To concatenate two or more strings into one using a specified separator, you can use the [CONCAT_WS()](postgresql-concat_ws) function.

## PostgreSQL CONCAT() function examples

Let’s take some examples of using the PostgreSQL `CONCAT()` function.

### 1\) Basic PostgreSQL CONCAT() function example

The following example uses the `CONCAT()` function to concatenate three literal strings into one:

```sql
SELECT
  CONCAT ('John', ' ', 'Doe') full_name;
```

Output:

```text
 full_name
-----------
 John Doe
(1 row)
```

### 2\) Using the CONCAT() function with table data example

We’ll use the `customer` table from the [sample database](https://neon.tech/postgresql/download/dvd-rental-sample-database/):

![customer table](/postgresqltutorial/customer.png)The following statement uses the `CONCAT()` function to concatenate values in the `first_name`, a space, and values in the `last_name` columns of the `customer` table into a single string:

```
SELECT
  CONCAT (first_name, ' ', last_name) AS full_name
FROM
  customer
ORDER BY
  full_name;
```

Output:

```text
       full_name
-----------------------
 Aaron Selby
 Adam Gooch
 Adrian Clary
 Agnes Bishop
 Alan Kahn
...
```

### 3\) Using the CONCAT() function with NULL

First, [create a table](../postgresql-tutorial/postgresql-create-table) called `contacts` and [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into it:

```
CREATE TABLE contacts (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    phone VARCHAR(15)
);

INSERT INTO contacts (name, email, phone)
VALUES
    ('John Doe', '[[email protected]](../cdn-cgi/l/email-protection.html)', '123-456-7890'),
    ('Jane Smith', '[[email protected]](../cdn-cgi/l/email-protection.html)', NULL),
    ('Bob Johnson', '[[email protected]](../cdn-cgi/l/email-protection.html)', '555-1234'),
    ('Alice Brown', '[[email protected]](../cdn-cgi/l/email-protection.html)', NULL),
    ('Charlie Davis', '[[email protected]](../cdn-cgi/l/email-protection.html)', '987-654-3210')
RETURNING *;
```

Output:

```text
 id |     name      |        email        |    phone
----+---------------+---------------------+--------------
  1 | John Doe      | [[email protected]](../cdn-cgi/l/email-protection.html)      | 123-456-7890
  2 | Jane Smith    | [[email protected]](../cdn-cgi/l/email-protection.html)    | null
  3 | Bob Johnson   | [[email protected]](../cdn-cgi/l/email-protection.html)     | 555-1234
  4 | Alice Brown   | [[email protected]](../cdn-cgi/l/email-protection.html)   | null
  5 | Charlie Davis | [[email protected]](../cdn-cgi/l/email-protection.html) | 987-654-3210
(5 rows)


INSERT 0 5
```

Second, use the `CONCAT()` function to concatenate the values in the `name`, `email`, and `phone` columns of the `contacts` table:

```
SELECT
  CONCAT(name, ' ', '(', email, ')', ' ', phone) contact
FROM
  contacts;
```

Output:

```
                     contact
--------------------------------------------------
 John Doe (john@gmail.com) 123-456-7890
 Jane Smith ([[email protected]](../cdn-cgi/l/email-protection.html))
 Bob Johnson ([[email protected]](../cdn-cgi/l/email-protection.html)) 555-1234
 Alice Brown ([[email protected]](../cdn-cgi/l/email-protection.html))
 Charlie Davis ([[email protected]](../cdn-cgi/l/email-protection.html)) 987-654-3210
(5 rows)
```

The output indicates that the `CONCAT()` function ignores `NULL`.

## Summary

- Use the PostgreSQL `CONCAT()` function to concatenate two or more strings into one.


# CHR

---
title: 'PostgreSQL CHR() Function'
page_title: 'PostgreSQL CHR: Get Character Based on ASCII or Unicode Code Point'
page_description: 'This tutorial shows you how to use the PostgreSQL CHR() function to get the character based on its ASCII value or Unicode code point.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-chr/'
ogImage: '/postgresqltutorial/PostgreSQL-CHR-ASCII-example.png'
updatedOn: '2024-01-29T01:38:05+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL ASCII() Function'
  slug: 'postgresql-string-functions/postgresql-ascii'
nextLink:
  title: 'PostgreSQL INITCAP() Function'
  slug: 'postgresql-string-functions/postgresql-letter-case-functions'
---

The PostgreSQL `CHR()` function converts an integer ASCII code to a character or a Unicode code point to a UTF8 character.

## Syntax

The following shows the syntax of the `CHR()` function:

```
CHR(num)
```

## Arguments

The `CHR()` function requires one argument:

**1\) `num`**

The num argument is an integer that is converted to the corresponding ASCII code.

It could be a Unicode code point which is converted to a UTF8 character.

## Return Value

The `CHR()` function returns a character that corresponds the ASCII code value or Unicode code point.

## Examples

The following example shows how to use the `CHR()` function to get the characters whose ASCII code value is 65 and 97:

```
SELECT
    CHR(65),
    CHR(97);
```

The query returns character A for 65 and a for 97:

![PostgreSQL CHR - ASCII example](/postgresqltutorial/PostgreSQL-CHR-ASCII-example.png)
Here is an example of getting the UTF8 character based on the Unicode code point 937:

```
SELECT
    CHR(937);
```

The output for the Unicode code point 937 is Ω, which is what we expected.

![PostgreSQL CHR - Unicode example](/postgresqltutorial/PostgreSQL-CHR-Unicode-example.png)

## Remarks

To get the ASCII code or UTF\-8 character of an integer, you use the [`ASCII()`](postgresql-ascii) function.

In this tutorial, you have learned how to use the PostgreSQL `CHR()` function to get the character based on its ASCII value or Unicode code point.


# FORMAT

---
title: 'PostgreSQL FORMAT() Function'
page_title: 'PostgreSQL FORMAT: Formats Arguments based on a Format String'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL FORMAT() function to format arguments according to a format string.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-format/'
ogImage: '/postgresqltutorial/customer-table.png'
updatedOn: '2024-01-27T14:36:05+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL RTRIM() Function'
  slug: 'postgresql-string-functions/postgresql-rtrim'
nextLink:
  title: 'PostgreSQL MD5() Function'
  slug: 'postgresql-string-functions/postgresql-md5'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `FORMAT()` function to format a string based on a template.

If you have experience with the C programming language, you’ll notice that the `FORMAT()` function is similar to the `sprintf()` function.

## Introduction to PostgreSQL FORMAT() function

The `FORMAT()` function allows you to format strings based on a template.

Here’s the basic syntax of the `FORMAT()` function:

```csssqlsql
FORMAT(format_string, value1, value2, ...)
```

In this syntax:

- `format_string`: This is the input string that you want to format.
- `value1`, `value2`, …: These are values to be inserted into placeholders in the `format_string`.

The `FORMAT()` function returns a formatted string.

The `FORMAT()` function can be useful for creating dynamic strings with placeholders for variables.

### Format specifier

The following shows the syntax of the format specifier:

```
%[position][flags][width]type
```

A format specifier starts with `%` character and include three optional components `position`, `flags`, `with` and a required component `type`.

**position**

The `position` specifies which argument to be inserted in the result string. The `position` is in the form `n$` where `n` is the argument index. The first argument starts from 1\.

If you omit the `position` component, the default is the next argument in the list.

**flags**

The `flags` can accept a minus sign (\-) that instructs the format specifier’s output to be left\-justified.

The `flags` component only takes effect when the `width` field is specified.

**width**

The optional `width` field specifies the minimum number of characters to use for displaying the format specifier’s output.

The result string can be padded left or right with the spaces needed to fill the `width`.

If the `width` is too small, the output will be displayed as\-is without any truncation.

The `width` can be one of the following values:

- A positive integer.
- An asterisk (\*) to use the next function argument as the width.
- A string of the form `*n$` to use the `nth` function argument as the width.

**t\*\***y\***\*pe**

`type` is the type of format conversion to use to produce the format specifier’s output.

The permitted values for type argument are as follows:

- `s` formats the argument value as a string. NULL is treated as an empty string.
- `I` treats the argument value as an SQL identifier.
- `L` quotes the argument value as an SQL literal.

We often use `I` and `L` for constructing dynamic SQL statements.

If you want to include `%` in the result string, use double percentages `%%`

## PostgreSQL FORMAT() function examples

Let’s explore some examples of using the `FORMAT()` function.

### 1\) Basic PostgreSQL FORMAT() function example

The following statement uses the `FORMAT()` function to format a string:

```
SELECT FORMAT('Hello, %s','PostgreSQL');
```

Output:

```sql
'Hello, PostgreSQL'
```

In this example, the function replaces the `%s` with the `'PostgreSQL'` string argument.

### 2\) Using FORMAT() function with table data example

We’ll use the following `customer` table in the [sample database](../postgresql-getting-started/postgresql-sample-database).

![customer table](/postgresqltutorial/customer-table.png)
The following statement uses the `FORMAT()` function to construct customers’ full names from first names and last names:

```sql
SELECT
    FORMAT('%s, %s',last_name, first_name) full_name
FROM
    customer
ORDER BY
    full_name;
```

Output:

```text
       full_name
------------------------
 Abney, Rafael
 Adam, Nathaniel
 Adams, Kathleen
 Alexander, Diana
 Allard, Gordon
 Allen, Shirley
 Alvarez, Charlene
...
```

In this example, we used two format specifiers `%s %s` which are then replaced by values in the `first_name` and `last_name` columns.

### 3\) Using FORMAT() function with the flags component

The following statement uses the FORMAT() function with the `flags` and `with` components in the format specifier:

```
SELECT FORMAT('|%10s|', 'one');
```

The output string is left\-padded with spaces and right\-aligned.

```text
    format
--------------
 |       one|
(1 row)
```

To make it left\-aligned, you use – as the flag:

```
SELECT FORMAT('|%-10s|', 'one');
```

The output is:

```text
    format
--------------
 |one       |
(1 row)
```

### 4\) Using FORMAT() function with the position component

This example uses the FORMAT() function with the `position` component of the format specifier:

```
SELECT
    FORMAT('%1$s apple, %2$s orange, %1$s banana', 'small', 'big');
```

The following illustrates the output:

```
                format
---------------------------------------
 small apple, big orange, small banana
(1 row)
```

In this example, we have two arguments which are `'small'` and `'big'` strings.

The `1$` and `2$` positions instruct the `FORMAT()` function to inject the first (`'small'`) and second arguments (`'big'`) into the corresponding placeholders.

The `1$` appears twice in the format string, therefore, the first argument is also inserted twice.

## Summary

- Use the PostgreSQL `FORMAT()` function to format a string based on a template.


# LEFT

---
title: 'PostgreSQL LEFT() Function'
page_title: 'PostgreSQL LEFT: Get First N Characters in a String'
page_description: 'This tutorial shows you how to use the PostgreSQL LEFT() function to get the first n characters in a string.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-left/'
ogImage: '/postgresqltutorial/PostgreSQL-LEFT-example.png'
updatedOn: '2024-01-29T02:05:23+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL MD5() Function'
  slug: 'postgresql-string-functions/postgresql-md5'
nextLink:
  title: 'PostgreSQL RIGHT() Function'
  slug: 'postgresql-string-functions/postgresql-right'
---

The PostgreSQL `LEFT()` function returns the first `n` characters in the string.

## Syntax

The following illustrates the syntax of the PostgreSQL `LEFT()` function:

```sql
LEFT(string, n)
```

## Arguments

The PostgreSQL `LEFT()` function requires two arguments:

**1\) `string`**

is a string from which a number of the leftmost characters returned.

**2\) `n`**

is an integer that specifies the number of left\-most characters in the string should be returned.

If `n` is negative, the `LEFT()` function returns the leftmost characters in the string but last `|n|` (absolute) characters.

## Return value

The PostgreSQL `LEFT()` function returns the first `n` characters in a string.

## Examples

Let’s look at some examples of using the `LEFT()` function.

The following example shows how to get the first character of a string `'ABC'`:

```
SELECT LEFT('ABC',1);
```

The result is

```text
 left
------
 A
(1 row)
```

To get the first two characters of the string ‘ABC’, you use 2 instead of 1 for the `n` argument:

```
SELECT LEFT('ABC',2);
```

Here is the result:

```text
 left
------
 AB
(1 row)
```

The following statement demonstrates how to use a negative integer:

```
SELECT LEFT('ABC',-2);
```

In this example, n is \-2, therefore, the `LEFT()` function return all character except the last 2 characters, which results in:

```
 left
------
 A
(1 row)
```

See the following customer table in the sample database:

The following statement uses the `LEFT()` function to get the initials and the `COUNT()` function to return the number of customers for each initial.

```
SELECT LEFT(first_name, 1) initial,
    COUNT(*)
FROM customer
GROUP BY initial
ORDER BY initial;
```

In this example, first, the `LEFT()` function returns initials of all customers. Then, the [`GROUP BY`](../postgresql-tutorial/postgresql-group-by) clause groups customers by their initials. Finally, the [`COUNT()`](../postgresql-aggregate-functions/postgresql-count-function) function returns the number of customer for each group.

![PostgreSQL LEFT example](/postgresqltutorial/PostgreSQL-LEFT-example.png)

## Remarks

If you want to get the `n` rightmost characters, please see the [`RIGHT()`](postgresql-right) function for the details.

In this tutorial, you have learned how to use the PostgreSQL `LEFT()` function to get the n left\-most characters in a string.


# LENGTH

---
title: 'PostgreSQL LENGTH() Function'
page_title: 'PostgreSQL LENGTH() function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL LENGTH() function to get the number of characters of a string.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-length-function/'
ogImage: '/postgresqltutorial/customer.png'
updatedOn: '2024-01-27T09:29:04+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL REPEAT() Function'
  slug: 'postgresql-string-functions/postgresql-repeat'
nextLink:
  title: 'PostgreSQL TRIM() Function'
  slug: 'postgresql-string-functions/postgresql-trim-function'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `LENGTH()` functions to get the number of characters of a string.

## Introduction to the PostgreSQL LENGTH() function

The PostgreSQL `LENGTH()` function returns the number of characters in a string.

Here’s the basic syntax for the `LENGTH()` function:

```sqlsql
LENGTH(string);
```

The `LENGTH()` function accepts a string as a parameter. It can be any of the following [data types](../postgresql-tutorial/postgresql-data-types):

- character or char
- character varying or varchar
- text

The `LENGTH()` function returns an integer that represents the number of characters in the string. It returns NULL if the string is null.

PostgreSQL provides the `CHAR_LENGTH()` and `CHARACTER_LENGTH()` functions that provide the same functionality as the `LENGTH()` function.

## PostgreSQL LENGTH() function examples

Let’s explore some examples of using the `LENGTH()` function.

### 1\) Basic PostgreSQL LENGTH() function examples

The following example uses the `LENGTH()` function to get the length of a string:

```sql
SELECT
  LENGTH ('PostgreSQL Tutorial');
```

Output:

```text
 length
--------
     19
(1 row)
```

If you pass NULL to the `LENGTH()` function, it returns NULL.

```
SELECT
  LENGTH (NULL);
```

Output:

```text
 length
--------
   null
(1 row)
```

### 2\) Using the PostgreSQL LENGTH() function with table data example

We’ll use the `customer` table from the [sample database](../postgresql-getting-started/postgresql-sample-database):

![customer table](/postgresqltutorial/customer.png)The following example uses the `LENGTH()` function to retrieve the first names and the number of characters of first names from the `customer` table:

```
SELECT
  first_name,
  LENGTH (first_name) len
FROM
  customer
ORDER BY
  len;
```

Output:

```
 first_name  | len
-------------+-----
 Jo          |   2
 Sam         |   3
 Roy         |   3
 Eva         |   3
 Don         |   3
 Dan         |   3
...
```

## Summary

- Use the PostgreSQL `LENGTH()` function to get the number of characters of a string.


# LPAD

---
title: 'PostgreSQL LPAD() Function'
page_title: 'PostgreSQL LPAD() Function'
page_description: 'The PostgreSQL LPAD() function pads a string on the left to a specified length with a sequence of characters.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-lpad/'
ogImage: '/postgresqltutorial/customer-and-payment-tables.png'
updatedOn: '2024-01-28T02:20:39+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL RIGHT() Function'
  slug: 'postgresql-string-functions/postgresql-right'
nextLink:
  title: 'PostgreSQL RPAD() Function'
  slug: 'postgresql-string-functions/postgresql-rpad'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `LPAD()` function to pad a string on the left to a specified length with a sequence of characters.

## Introduction to the PostgreSQL LPAD() function

The LPAD() function pad a string on the left to a specified length with a sequence of characters.

Here’s the basic syntax of the `LPAD()` function:

```csssql
LPAD(string, length[, fill])
```

The `LPAD()` function accepts 3 arguments:

**1\) `string`**

is a string that should be padded on the left

**2\) `length`**

is an positive integer that specifies the length of the result string after padding.

Note that if the string is longer than the length argument, the string will be truncated on the right.

**3\) `fill`**

is a string used for padding.

The `fill` argument is optional. If you omit the `fill` argument, its default value is a space.

The PostgreSQL `LPAD()` function returns a string left\-padded to `length` characters.

## PostgreSQL LPAD() function Examples

Let’s see some examples of using the `LPAD()` function.

### 1\) Basic PostgreSQL LPAD() function example

The following statement uses the `LPAD()` function to pad the ‘\*’ on the left of the string ‘PostgreSQL’:

```
SELECT LPAD('PostgreSQL',15,'*');
```

The result is:

```text
      lpad
----------------
 *****PostgreSQL
(1 row)
```

In this example, the length of the `PostgreSQL` string is 10, and the result string should have a length of 15\. Therefore, the `LPAD()` function pads 5 asterisks (\*) on the left of the string.

### 2\) Padding leading zeros

The following example uses the `LPAD()` function to pad zeros at the beginning of the string to a length of five characters:

```
SELECT LPAD('123',5,'0') result;
```

Output:

```text
 result
--------
 00123
(1 row)
```

If you want to pad a number, you need to convert that number to a string before padding. For example:

```
SELECT LPAD(123::text,5,'0') result;
```

Output:

```text
 result
--------
 00123
(1 row)
```

### 3\) Using LPAD() function with table data

See the following `customer` and `payment` tables from the [sample database](../postgresql-getting-started/postgresql-sample-database):

![customer and payment tables](/postgresqltutorial/customer-and-payment-tables.png)The following statement illustrates how to use the `LPAD()` function to draw a chart based on the sum of payments per customer.

```
SELECT first_name || ' ' || last_name fullname,
    SUM(amount) total,
    LPAD('*', CAST(TRUNC(SUM(amount) / 10) AS INT), '*') chart
FROM payment
INNER JOIN customer using (customer_id)
GROUP BY customer_id
ORDER BY SUM(amount) DESC;
```

The following picture illustrates the result:

```
       fullname        | total  |         chart
-----------------------+--------+-----------------------
 Eleanor Hunt          | 211.55 | *********************
 Karl Seal             | 208.58 | ********************
 Marion Snyder         | 194.61 | *******************
 Rhonda Kennedy        | 191.62 | *******************
 Clara Shaw            | 189.60 | ******************
 Tommy Collazo         | 183.63 | ******************
 Ana Bradley           | 167.67 | ****************
 Curtis Irby           | 167.62 | ****************
...
```

In this example,

- First, add up the payments for each customer using the [`SUM()`](../postgresql-aggregate-functions/postgresql-sum-function) function and the [`GROUP BY`](../postgresql-tutorial/postgresql-group-by) clause,
- Second, calculate the length of the bar chart based on the sums of payments using various functions: `TRUNC()` to truncate the total payments, `CAST()` to convert the result of the `TRUNC()` to an integer. To make the bar chart more readable, we divided the sum of payments by 10\.
- Third, apply the `LPAD()` function to pad the character (\*) based on the result of the second step above.

## Summary

- Use the PostgreSQL `LPAD()` function to pad characters on the left of a string to a certain length.


# LOWER

---
title: 'PostgreSQL LOWER() Function'
page_title: 'PostgreSQL LOWER() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL LOWER() function to convert the string to all lower case.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-lower/'
ogImage: '/postgresqltutorial/customer.png'
updatedOn: '2024-01-28T09:51:45+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL LTRIM() Function'
  slug: 'postgresql-string-functions/postgresql-ltrim'
nextLink:
  title: 'PostgreSQL UPPER() Function'
  slug: 'postgresql-string-functions/postgresql-upper'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `LOWER()` function to convert the string to all lowercase.

## Introduction to the PostgreSQL LOWER() function

The `LOWER()` function converts a string to lowercase based on the rules of the database’s locale.

Here’s the syntax of the `LOWER()` function:

```sql
LOWER(text)
```

In this syntax, text is the input string that you want to convert. Its type can be `CHAR`, [`VARCHAR`](../postgresql-tutorial/postgresql-char-varchar-text), or `TEXT`.

The `LOWER()` function returns a new string with all letters converted to lowercase.

If the text is `NULL`, the `LOWER()` function returns `NULL`.

## PostgreSQL LOWER() function examples

Let’s explore some examples of using the `LOWER()` function.

### 1\) Basic PostgreSQL LOWER() function example

The following example uses the `LOWER()` function to convert the string PostgreSQL to lowercase:

```sql
SELECT LOWER('PostgreSQL');
```

Output:

```text
   lower
------------
 postgresql
(1 row)
```

### 2\) Using PostgreSQL LOWER() function with table data

We’ll use the `customer` table from the [sample database](../postgresql-getting-started/postgresql-sample-database):

![PostgreSQL LOWER() Function - Sample Table ](/postgresqltutorial/customer.png)The following example uses the `LOWER()` function to convert the first names of customers to lowercase:

```sql
SELECT
  LOWER(first_name)
FROM
  customer
ORDER BY
  first_name;
```

Output:

```text
    lower
-------------
 aaron
 adam
 adrian
 agnes
 alan
...
```

### 3\) Using PostgreSQL LOWER() function in the WHERE clause

The following example uses the `LOWER()` function in the [`WHERE`](../postgresql-tutorial/postgresql-where) clause to find customers by last names, comparing them with the input string in lowercase:

```sql
SELECT
  first_name,
  last_name
FROM
  customer
WHERE
  LOWER(last_name) = 'barnett';
```

Output:

```text
 first_name | last_name
------------+-----------
 Carole     | Barnett
(1 row)
```

## Summary

- Use the `LOWER()` function to return a new string with all the characters of the input string converted to lowercase.


# LTRIM

---
title: 'PostgreSQL LTRIM() Function'
page_title: 'PostgreSQL LTRIM() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL LTRIM() function to remove specified characters from the beginning of a string.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-ltrim/'
ogImage: ''
updatedOn: '2024-01-27T13:51:25+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL TRIM() Function'
  slug: 'postgresql-string-functions/postgresql-trim-function'
nextLink:
  title: 'PostgreSQL LOWER() Function'
  slug: 'postgresql-string-functions/postgresql-lower'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `LTRIM()` function to remove specified characters from the beginning of a string.

## Introduction to PostgreSQL LTRIM() function

The `LTRIM()` function allows you to remove specified characters from the beginning of a string.

Here’s the syntax of the `LTRIM()` function:

```sql
LTRIM(string, character)
```

In this syntax:

- `string` is the input string that you want to remove characters.
- `character` specifies the characters you want to remove from the beginning of the `string`. The `character` parameter is optional. It defaults to space.

The `LTRIM()` function returns the string with all leading characters removed.

To remove both leading and trailing characters from a string, you use the [TRIM()](postgresql-trim-function) function.

To remove the trailing characters from a string, you use the [RTRIM()](postgresql-rtrim) function.

## PostgreSQL LTRIM() function examples

Let’s explore some examples of using the `LTRIM()` function.

### 1\) Basic PostgreSQL LTRIM() function example

The following example uses the `LTRIM()` function to remove the `#` from the beginning of the string `#postgres`:

```sql
SELECT LTRIM('#postgres', '#');
```

Output:

```text
  ltrim
----------
 postgres
(1 row)
```

### 2\) Using the PostgreSQL LTRIM() function to remove leading spaces

The following example uses the `LTRIM()` function to remove all the spaces from the string `' PostgreSQL'`:

```sql
SELECT LTRIM('   PostgreSQL');
```

Output:

```text
   ltrim
------------
 PostgreSQL
(1 row)
```

Since the default of the second argument of the `LTRIM()` function is space, we don’t need to specify it.

### 3\) Using the LTRIM() function with table data example

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `articles` and [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into it:

```sql
CREATE TABLE articles(
   id SERIAL PRIMARY KEY,
   title VARCHAR(255) NOT NULL
);

INSERT INTO articles(title)
VALUES
   ('   Mastering PostgreSQL string functions'),
   (' PostgreSQL LTRIM() function')
RETURNING *;
```

Output:

```text
 id |                  title
----+------------------------------------------
  1 |    Mastering PostgreSQL string functions
  2 |  PostgreSQL LTRIM() function
(2 rows)
```

Second, [update](../postgresql-tutorial/postgresql-update) the titles by removing the leading spaces using the `LTRIM()` function:

```sql
UPDATE articles
SET title = LTRIM(title);
```

Output:

```sql
UPDATE 2
```

The output indicates that two rows were updated.

Third, verify the updates:

```sql
SELECT * FROM articles;
```

Output:

```text
 id |                 title
----+---------------------------------------
  1 | Mastering PostgreSQL string functions
  2 | PostgreSQL LTRIM() function
(2 rows)
```

## Summary

- Use `LTRIM()` function to remove all specified characters from the beginning of a string.


# MD5

---
title: 'PostgreSQL MD5() Function'
page_title: 'PostgreSQL MD5() Function'
page_description: 'The PostgreSQL MD5() function calculates the MD5 hash of a string and returns the result in hexadecimal.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-md5/'
ogImage: ''
updatedOn: '2024-01-29T01:39:25+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL FORMAT() Function'
  slug: 'postgresql-string-functions/postgresql-format'
nextLink:
  title: 'PostgreSQL LEFT() Function'
  slug: 'postgresql-string-functions/postgresql-left'
---

The PostgreSQL `MD5()` function calculates the [MD5](https://en.wikipedia.org/wiki/MD5) hash of a string and returns the result in hexadecimal.

## Syntax

The following illustrates the syntax of the `MD5()` function:

```sql
MD5(string)
```

## Arguments

The `MD5()` function accepts one argument.

**1\) `string`**

The `string` argument is the string of which the MD5 hash is calculated.

## Return value

The `MD5()` function returns a string in [`TEXT`](../postgresql-tutorial/postgresql-char-varchar-text) data type.

## Examples

The following example shows how to use the `MD5()` function to return the MD5 hash of the message `'PostgreSQL MD5'`:

```
SELECT MD5('PostgreSQL MD5');
```

The result is:

```
        md5
----------------------------------
 f78fdb18bf39b23d42313edfaf7e0a44
(1 row)
```

In this tutorial, you have learned how to use the PostgreSQL `MD5()` function to calculate the MD5 hash of a string.


# POSITION

---
title: 'PostgreSQL POSITION() Function'
page_title: 'PostgresQL POSITION: Locate a Substring in a String'
page_description: 'This tutorial shows you how to use the PostgreSQL POSITION() function to locate a substring in a string.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-position/'
ogImage: ''
updatedOn: '2024-04-19T08:26:26+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL INITCAP() Function'
  slug: 'postgresql-string-functions/postgresql-letter-case-functions'
nextLink:
  title: 'PostgreSQL SUBSTRING() Function'
  slug: 'postgresql-string-functions/postgresql-substring'
---

The PostgreSQL `POSITION()` function returns the location of the first instance of a substring within a string.

## Syntax

The following illustrates the syntax of the `POSITION()` function:

```sql
POSITION(substring in string)
```

## Arguments

The `POSITION()` function requires two arguments:

**1\) `substring`**

The substring argument is the string that you want to locate.

**2\) `string`**

The `string` argument is the string for which the substring is searched.

## Return Value

The `POSITION()` function returns an [integer](../postgresql-tutorial/postgresql-integer) representing the location of the first instance of the substring within the input string.

The `POSITION()` function returns zero (0\) if the substring is not found in the string. It returns NULL if either `substring` or `string` argument is null.

## Examples

The following example returns the position of the `'Tutorial'` in the string `'PostgreSQL Tutorial'`:

```
SELECT POSITION('Tutorial' IN 'PostgreSQL Tutorial');
```

The result is as follows:

```sql
position
----------
       12
(1 row)
```

Note that the `POSITION()` function searches for the substring case\-insensitively.

See the following example:

```
SELECT POSITION('tutorial' IN 'PostgreSQL Tutorial');
```

It returns zero (0\), indicating that the string `tutorial` does not exist in the string `'PostgreSQL Tutorial'`.

The following example uses the `POSITION()` function to locate the first string `'fateful'` in the `description` column of the `film` table from the [sample database](../postgresql-getting-started/postgresql-sample-database):

```sql
SELECT
  POSITION('Fateful' in description ),
  description
FROM
  film
WHERE
  POSITION('Fateful' in description ) > 0;
```

Output:

```text
 position |                                                   description
----------+-----------------------------------------------------------------------------------------------------------------
        3 | A Fateful Reflection of a Moose And a Husband who must Overcome a Monkey in Nigeria
        3 | A Fateful Yarn of a Lumberjack And a Feminist who must Conquer a Student in A Jet Boat
        3 | A Fateful Yarn of a Womanizer And a Feminist who must Succumb a Database Administrator in Ancient India
        3 | A Fateful Display of a Womanizer And a Mad Scientist who must Outgun a A Shark in Soviet Georgia
...
```

## Remarks

The `POSITION()` function returns the location of the first instance of the substring in the string.

For example:

```
SELECT POSITION('is' IN 'This is a cat');
```

Output:

```
 position
----------
        3
(1 row)
```

Even though the substring `'is'` appears twice in the string `'This is a cat'`, the `POSITION()` function returns the first match.

## Summary

- Use the `POSITION()` function to locate the first instance of a substring within a string.


# REGEXP_MATCHES

---
title: 'PostgreSQL REGEXP_MATCHES() Function'
page_title: 'PostgreSQL REGEXP_MATCHES() Function'
page_description: 'This tutorial shows you how to use the PostgreSQL REGEXP_MATCHES() function to extract text according to a regular expression.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-regexp_matches/'
ogImage: '/postgresqltutorial/film.png'
updatedOn: '2024-01-27T09:14:12+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL REGEXP_REPLACE() Function'
  slug: 'postgresql-string-functions/regexp_replace'
nextLink:
  title: 'PostgreSQL REVERSE() Function'
  slug: 'postgresql-string-functions/postgresql-reverse'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `REGEXP_MATCHES()` function to extract substrings from a string based on a regular expression.

## Introduction to the PostgreSQL REGEXP_MATCHES() function

The `REGEXP_MATCHES()` function allows you to extract substrings from a string based on a regular expression pattern.

Here’s the basic syntax for the PostgreSQL `REGEXP_MATCHES()` function:

```csssql
REGEXP_MATCHES(source_string, pattern [, flags])
```

The `REGEXP_MATCHES()` function accepts three arguments:

1\) `source`

The `source` is a string that you want to extract substrings that match a regular expression.

2\) `pattern`

The `pattern` is a POSIX regular expression for matching.

3\) `flags`

The `flags` argument is one or more characters that control the behavior of the function. For example, `i` allows you to match case\-insensitively.

The `REGEXP_MATCHES()` function returns a set of text, even if the result array only contains a single element.

## PostgreSQL REGEXP_MATCHES() function examples

Let’s explore some examples of using the `REGEXP_MATCHES()` function.

### 1\) Basic REGEXP_MATCHES() function examples

The following example uses the `REGEXP_MATCHES()` function to extract hashtags such as `PostgreSQL` and `REGEXP_MATCHES` from a string:

```php
SELECT
    REGEXP_MATCHES('Learning #PostgreSQL #REGEXP_MATCHES',
         '#([A-Za-z0-9_]+)',
        'g');
```

Output:

```text
  regexp_matches
------------------
 {PostgreSQL}
 {REGEXP_MATCHES}
(2 rows)
```

In this example, the following regular expression matches any word that starts with the hash character (`#`) and is followed by any alphanumeric characters or underscore (`_`).

```
#([A-Za-z0-9_]+)
```

The `g` flag argument is for the global search.

The result set has two rows, each is an [array](../postgresql-tutorial/postgresql-array) (`text[]`), which indicates that there are two matches.

If you want to transform the elements of the array into separate rows, you can use the `UNNEST()` function:

```
SELECT
    UNNEST(REGEXP_MATCHES('Learning #PostgreSQL #REGEXP_MATCHES',
         '#([A-Za-z0-9_]+)',
        'g')) result;
```

Output:

```text
     result
----------------
 PostgreSQL
 REGEXP_MATCHES
(2 rows)

```

### 2\) Using the PostgreSQL REGEXP_MATCHES() function with table data example

We’ll use the following `film` table from the [sample database](../postgresql-getting-started/postgresql-sample-database):

![](/postgresqltutorial/film.png)The following statement uses the `REGEXP_MATCHES()` function to retrieve films with descriptions containing the word `Cat` or `Dog`:

```
SELECT
  REGEXP_MATCHES(description, 'Cat | Dog ') cat_or_dog,
  description
FROM
  film;
```

Output:

```text
 cat_or_dog |                                                    description
------------+--------------------------------------------------------------------------------------------------------------------
 {"Cat "}   | A Epic Drama of a Cat And a Explorer who must Redeem a Moose in Australia
 {"Cat "}   | A Boring Epistle of a Butler And a Cat who must Fight a Pastry Chef in A MySQL Convention
 {"Cat "}   | A Brilliant Drama of a Cat And a Mad Scientist who must Battle a Feminist in A MySQL Convention
 {" Dog "}  | A Fast-Paced Character Study of a Composer And a Dog who must Outgun a Boat in An Abandoned Fun House
 {" Dog "}  | A Touching Panorama of a Waitress And a Woman who must Outrace a Dog in An Abandoned Amusement Park
 {" Dog "}  | A Astounding Story of a Dog And a Squirrel who must Defeat a Woman in An Abandoned Amusement Park
...
```

## Summary

- Use the PostgreSQL `REGEXP_MATCHES()` function to extract text from a string based on a regular expression.


# REGEXP_REPLACE

---
title: 'PostgreSQL REGEXP_REPLACE() Function'
page_title: 'PostgreSQL REGEXP_REPLACE() Function By Examples'
page_description: 'How to use the PostgreSQL REGEXP_REPLACE() function to replace substrings that match a regular expression with a new substring.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/regexp_replace/'
ogImage: ''
updatedOn: '2024-01-29T01:38:59+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL REPLACE() Function'
  slug: 'postgresql-string-functions/postgresql-replace'
nextLink:
  title: 'PostgreSQL REGEXP_MATCHES() Function'
  slug: 'postgresql-string-functions/postgresql-regexp_matches'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `REGEXP_REPLACE()` function to replace strings that match a regular expression.

The PostgreSQL `REGEXP_REPLACE()` function replaces substrings that match a [POSIX regular expression](https://en.wikibooks.org/wiki/Regular_Expressions/POSIX-Extended_Regular_Expressions) with a new substring.

Note that if you want to perform simple string replacement, you can use the [`REPLACE()`](postgresql-replace) function.

## Syntax

The syntax of the PostgreSQL `REGEXP_REPLACE()` function is as follows:

```csssql
REGEXP_REPLACE(source, pattern, replacement_string,[, flags])
```

## Arguments

The `REGEXP_REPLACE()` function accepts four arguments:

**1\) `source`**

The source is a string that replacement should take place.

**2\) `pattern`**

The pattern is a POSIX regular expression for matching substrings that should be replaced.

**3\) `replacement_string`**

The `replacement_string` is a string that replaces the substrings that match the regular expression pattern.

**4\) `flags`**

The `flags` argument is one or more characters that control the matching behavior of the function e.g., `i` allows case\-insensitive matching, `n` enables matching any character and also the newline character.

## Return value

The PostgreSQL `REGEXP_REPLACE()` function returns a new string with the substrings, which match a regular expression pattern, replaced by a new substring.

## Examples

Let’s take some examples to understand how the `REGEXP_REPLACE()` function works.

### 1\) Name rearrangement

Suppose, you have the name of a person in the following format:

```php
first_name last_name
```

For example, `John Doe`

You want to rearrange this name as follows for reporting purposes.

```
last_name, first_name
```

To do this, you can use the `REGEXP_REPLACE()` function as shown below:

```
SELECT REGEXP_REPLACE('John Doe','(.*) (.*)','\2, \1');
```

The output of the statement is:

```sql
'Doe, John'
```

### 2\) String removal

Imagine you have string data with mixed alphabets and digits as follows:

```sql
ABC12345xyz
```

The following statement removes all alphabets e.g., A, B, C, etc from the source string:

```
SELECT REGEXP_REPLACE('ABC12345xyz','[[:alpha:]]','','g');
```

The output is:

```sql
'12345'
```

In this example,

- `[[:alpha:]]` matches any alphabets
- `''` is the replacement string
- `'g'` instructs the function to remove all alphabets, not just the first one.

Similarly, you can remove all digits in the source string by using the following statement:

```sql
SELECT REGEXP_REPLACE('ABC12345xyz','[[:digit:]]','','g');
```

The output is:

```sql
'ABCxyz'
```

### 3\) Redundant space removal

The following example uses the `REGEXP_REPLACE()` function to remove redundant spaces:

```sql
SELECT REGEXP_REPLACE('Your string with   redundant    spaces', '\s{2,}', ' ', 'g') AS cleaned_string;

```

Output:

```
          cleaned_string
-----------------------------------
 Your string with redundant spaces
(1 row)
```

In this example, we use the `REGEXP_REPLACE()` function to match two or more consecutive spaces and replace them with a single space.

## Summary

- Use the PostgreSQL `REGEXP_REPLACE()` function to replace substrings that match a regular expression with a new substring.


# RIGHT

---
title: 'PostgreSQL RIGHT() Function'
page_title: 'PostgreSQL RIGHT() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL RIGHT() function to get the n right-most characters in a string.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-right/'
ogImage: '/postgresqltutorial/customer.png'
updatedOn: '2024-01-29T01:48:10+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL LEFT() Function'
  slug: 'postgresql-string-functions/postgresql-left'
nextLink:
  title: 'PostgreSQL LPAD() Function'
  slug: 'postgresql-string-functions/postgresql-lpad'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `RIGHT()` function to return the last `n` characters in a string.

## Introduction to the PostgreSQL RIGHT() function

The `RIGHT()` function allows you to retrieve the last n characters of a string.

Here’s the basic syntax of the `RIGHT()` function:

```sqlsql
RIGHT(string, n)
```

The PostgreSQL `RIGHT()` function requires two arguments:

- `string` is a string from which a number of the rightmost characters are returned.
- **`n`** is a positive integer that specifies the number of the rightmost characters in the string that should be returned.

The `RIGHT()` function returns the last `n` characters in a string. If `n` is negative, the `RIGHT()` function returns all characters in the string but first `|n|` (absolute) characters.

If you want to return the `n` first characters of a string, you can use the [`LEFT()`](postgresql-left) function.

## PostgreSQL RIGHT() function examples

Let’s take some examples of using the PostgreSQL `RIGHT()` function.

### 1\) Basic PostgreSQL RIGHT() function example

The following statement uses the `RIGHT()` function to get the last character in the string `'XYZ'`:

```sql
SELECT RIGHT('XYZ', 1);
```

Here is the result:

```text
 right
-------
 Z
(1 row)

```

To get the last two characters, you pass the value `2` as the second argument as follows:

```
SELECT RIGHT('XYZ', 2);
```

Output:

```text
 right
-------
 YZ
(1 row)
```

The following statement illustrates how to use a negative integer as the second argument:

```
SELECT RIGHT('XYZ', - 1);
```

In this example, the `RIGHT()` function returns all characters except for the first character.

```text
 right
-------
 YZ
(1 row)
```

### 2\) Using the RIGHT() function with table data example

See the following `customer` table in the [sample database](../postgresql-getting-started/postgresql-sample-database):

![customer table](/postgresqltutorial/customer.png)The following statement uses the `RIGHT()` function in [`WHERE`](../postgresql-tutorial/postgresql-where) clause to get all customers whose last names end with `'son'`:

```
SELECT
  last_name
FROM
  customer
WHERE
  RIGHT(last_name, 3) = 'son';
```

Output:

```
  last_name
-------------
 Johnson
 Wilson
 Anderson
 Jackson
 Thompson
...
```

## Summary

- Use the PostgreSQL `RIGHT()` function to get the n rightmost characters in a string.


# REPLACE

---
title: 'PostgreSQL REPLACE() Function'
page_title: 'PostgreSQL REPLACE() Function'
page_description: 'This tutorial shows how to use the PostgreSQL REPLACE() function to replace all occurrences of a substring in a string with a new substring.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-replace/'
ogImage: ''
updatedOn: '2024-01-29T01:38:44+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL SPLIT_PART() Function'
  slug: 'postgresql-string-functions/postgresql-split_part'
nextLink:
  title: 'PostgreSQL REGEXP_REPLACE() Function'
  slug: 'postgresql-string-functions/regexp_replace'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `REPLACE()` function to replace a substring with a new one.

## Introduction to PostgreSQL REPLACE() function

The `REPLACE()` function replaces all occurrences of a substring with a new one in a string.

Here’s the syntax of the PostgreSQL `REPLACE()` function:

```phpsqlsql
REPLACE(source, from_text, to_text);
```

The `REPLACE()` function accepts three arguments:

- `source`: This is an input string that you want to replace.
- `from_text`: This is the substring that you want to search and replace. If the `from_text` appears multiple times in the `source` string, the function will replace all the occurrences.
- `to_text`: This is the new substring that you want to replace the `from_text`.

## PostgreSQL REPLACE() function examples

Let’s explore some examples of using the `REPLACE()` function.

### 1\) Basic PostgreSQL REPLACE() function example

The following example uses the `REPLACE()` function to replace the string `'A'` in the string `'ABC AA'` with the string `'Z'`:

```sql
SELECT REPLACE ('ABC AA', 'A', 'Z');
```

Output:

```text
 replace
---------
 ZBC ZZ
(1 row)
```

In this example, the `REPLACE()` function replaces all the characters `'A'` with the character `'Z'` in a string.

### 2\) Using the PostgreSQL REPLACE() function with table data

If you want to search and replace a substring in a table column, you use the following syntax:

```
UPDATE
  table_name
SET
  column_name = REPLACE(column, old_text, new_text)
WHERE
  condition;
```

Let’s see the following example.

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `posts` that has three columns `id`, `title`, and `url`:

```sql
CREATE TABLE posts(
    id SERIAL PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    url VARCHAR(255) NOT NULL
);

INSERT INTO posts(title, url)
VALUES
('PostgreSQL Tutorial', 'http://neon.tech/postgresql'),
('PL/pgSQL', 'http://neon.tech/postgresql/postgresql-plpgsql/'),
('PostgreSQL Administration
', 'http://neon.tech/postgresql/postgresql-administration/')
RETURNING *;
```

Output:

```
 id |           title           |                             url
----+---------------------------+--------------------------------------------------------------
  1 | PostgreSQL Tutorial       | http://neon.tech/postgresql
  2 | PL/pgSQL                  | http://neon.tech/postgresql/postgresql-plpgsql/
  3 | PostgreSQL Administration+| http://neon.tech/postgresql/postgresql-administration/
    |                           |
(3 rows)


INSERT 0 3
```

Second, replace the `http` in the `url` column with the `https` using the `REPLACE()` function:

```sql
UPDATE posts
SET url = REPLACE(url, 'http','https');
```

Output:

```sql
UPDATE 3
```

The output indicates that three rows were updated.

Third, verify the update by retrieving data from the `customer` table:

```
SELECT * FROM posts;
```

Output:

```
 id |           title           |                              url
----+---------------------------+---------------------------------------------------------------
  1 | PostgreSQL Tutorial       | https://neon.tech/postgresql
  2 | PL/pgSQL                  | https://neon.tech/postgresql/postgresql-plpgsql/
  3 | PostgreSQL Administration+| https://neon.tech/postgresql/postgresql-administration/
    |                           |
(3 rows)
```

The output indicates that the `http` in the `url` column were replaced by the `https`.

## Summary

- Use the PostgreSQL `REPLACE()` function to replace all occurrences of a substring in a string with another a new substring.


# RTRIM

---
title: 'PostgreSQL RTRIM() Function'
page_title: 'PostgreSQL RTRIM() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL RTRIM() function to remove specified characters from the end of a string.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-rtrim/'
ogImage: ''
updatedOn: '2024-01-27T13:44:30+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL UPPER() Function'
  slug: 'postgresql-string-functions/postgresql-upper'
nextLink:
  title: 'PostgreSQL FORMAT() Function'
  slug: 'postgresql-string-functions/postgresql-format'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `RTRIM()` function to remove specified characters from the end of a string.

## Introduction to PostgreSQL RTRIM() function

The `RTRIM()` function allows you to remove specified characters from the end of a string.

Here’s the syntax of the `RTRIM()` function:

```sql
RTRIM(string, character)
```

In this syntax:

- `string` is the input string that you want to remove characters
- `character` specifies the character you want to remove from the end of the string. The `character` parameter is optional and defaults to space.

The `RTRIM()` function returns the string with all trailing characters removed.

To remove both leading and trailing characters from a string, you use the [TRIM()](postgresql-trim-function) function.

To remove all the leading characters from a string, you use the [LTRIM()](postgresql-ltrim) function.

## PostgreSQL RTRIM() function examples

Let’s explore some examples of using the `RTRIM()` function.

### 1\) Basic PostgreSQL RTRIM() function example

The following example uses the `RTRIM()` function to remove the character `!` from the end of the string `postgres!!!`:

```sql
SELECT RTRIM('postgres!!!', '!');
```

Output:

```text
  rtrim
----------
 postgres
(1 row)
```

### 2\) Using the PostgreSQL RTRIM() function to remove leading spaces

The following example uses the `RTRIM()` function to remove all the spaces from the end of the string `'PostgreSQL '`:

```sql
SELECT RTRIM('PostgreSQL   ');
```

Output:

```text
   rtrim
------------
 PostgreSQL
(1 row)

```

Because the default of the second argument of the `RTRIM()` function is space, you don’t need to explicitly specify it.

### 3\) Using the RTRIM() function with table data example

First, [create a new table](../postgresql-tutorial/postgresql-create-table) called `tweets` and [insert some rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into it:

```sql
CREATE TABLE tweets(
   id SERIAL PRIMARY KEY,
   tweet VARCHAR(120) NOT NULL
);

INSERT INTO tweets(tweet)
VALUES
   ('PostgreSQL tutorial   '),
   ('PostgreSQL RTRIM() function   ')
RETURNING *;
```

Output:

```text
 id |             tweet
----+--------------------------------
  1 | PostgreSQL tutorial
  2 | PostgreSQL RTRIM() function
(2 rows)


INSERT 0 2
```

Second, [update](../postgresql-tutorial/postgresql-update) the tweets by removing the trailing spaces using the `RTRIM()` function:

```sql
UPDATE tweets
SET tweet = RTRIM(tweet);
```

Output:

```sql
UPDATE 2
```

The output indicates that two rows were updated.

Third, verify the updates:

```sql
SELECT * FROM tweets;
```

Output:

```text
 id |            tweet
----+-----------------------------
  1 | PostgreSQL tutorial
  2 | PostgreSQL RTRIM() function
(2 rows)
```

## Summary

- Use `RTRIM()` function to remove all specified characters from the end of a string.


# SPLIT_PART

---
title: 'PostgreSQL SPLIT_PART() Function'
page_title: 'PostgreSQL SPLIT_PART() Function'
page_description: 'How to use the PostgreSQL SPLIT_PART() function to split a string based on a specified delimiter and return the nth substring.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-split_part/'
ogImage: '/postgresqltutorial/payment-table.png'
updatedOn: '2024-02-13T13:52:15+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL SUBSTRING() Function'
  slug: 'postgresql-string-functions/postgresql-substring'
nextLink:
  title: 'PostgreSQL REPLACE() Function'
  slug: 'postgresql-string-functions/postgresql-replace'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL SPLIT_PART() function to retrieve a part of a string at a specified position after splitting.

## Introduction to the PostgreSQL SPLIT_PART() function

The `SPLIT_PART()` function splits a [string](../postgresql-tutorial/postgresql-char-varchar-text) on a specified delimiter and returns the nth substring.

The following illustrates the syntax of the PostgreSQL `SPLIT_PART()` function:

```phpsql
SPLIT_PART(string, delimiter, position)
```

The `SPLIT_PART()` function requires three arguments:

**1\) `string`**

This is the string to be split.

**2\) `delimiter`**

The delimiter is a string used as the delimiter for splitting.

**3\) `position`**

This is the position of the part to return, starting from 1\. The position must be a positive integer.

If the `position` is greater than the number of parts after splitting, the `SPLIT_PART()` function returns an empty string.

The `SPLIT_PART()` function returns a part as a string at a specified position.

## PostgreSQL SPLIT_PART() function examples

Let’s take some examples of using the PostgreSQL `SPLIT_PART()` function.

### 1\) Basic PostgreSQL SPLIT_PART() function example

The following example uses the `SPLIT_PART()` function to split a string by a comma (`,`) and returns the third substring:

```
SELECT SPLIT_PART('A,B,C', ',', 2);
```

The string `'A,B,C'` is split on the comma delimiter (,) that results in 3 substrings: ‘A’, ‘B’, and ‘C’.

Because the `position` is 2, the function returns the 2nd substring which is ‘B’.

Here is the output:

```text
 split_part
------------
 B
(1 row)
```

### 1\) Using PostgreSQL SPLIT_PART() function with a position that does not exist

The following example returns an empty string because the position is greater than the number of parts (3\):

```
SELECT SPLIT_PART('A,B,C', ',', 4) result;
```

Output:

```
 result
--------

(1 row)
```

### 3\) Using the SPLIT_PART() function with table data

See the following `payment` table in the [sample database.](../postgresql-getting-started/postgresql-sample-database)

![payment table](/postgresqltutorial/payment-table.png)
The following statement uses the `SPLIT_PART()` function to return the year and month of the payment date:

```
SELECT
    split_part(payment_date::TEXT,'-', 1) y,
    split_part(payment_date::TEXT,'-', 2) m,
    amount
FROM
    payment;
```

Output:

```
  y   | m  | amount
------+----+--------
 2007 | 02 |   7.99
 2007 | 02 |   1.99
 2007 | 02 |   7.99
...
```

## Summary

- Use the PostgreSQL `SPLIT_PART()` function to retrieve a part of a string at a specified position after splitting.


# SUBSTRING

---
title: 'PostgreSQL SUBSTRING() Function'
page_title: 'PostgreSQL SUBSTRING() Function'
page_description: 'This tutorial shows you how to use the PostgreSQL SUBSTRING() function to extract A substring from a string.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-substring/'
ogImage: '/postgresqltutorial/PostgreSQL-substring-function-example.jpg'
updatedOn: '2024-01-29T01:37:47+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL POSITION() Function'
  slug: 'postgresql-string-functions/postgresql-position'
nextLink:
  title: 'PostgreSQL SPLIT_PART() Function'
  slug: 'postgresql-string-functions/postgresql-split_part'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `SUBSTRING()` function to extract a substring from a string.

## Introduction to PostgreSQL SUBSTRING() function

The `SUBSTRING()` function allows you to extract a substring from a string and return the substring.

Here’s the basic syntax of the `SUBSTRING()` function:

```sqlsql
SUBSTRING(string, start_position, length)
```

In this syntax:

- `string`: This is an input string with the data type char, varchar, text, and so on.
- `start_position`: This is an integer that specifies where in the string you want to extract the substring. If `start_position` equals zero, the substring starts at the first character of the string. The `start_position` can be only positive. Note that in other database systems such as MySQL the [SUBSTRING() function](https://www.mysqltutorial.org/mysql-string-functions/mysql-substring/) can accept a negative `start_position`.
- `length`: This is a positive integer that determines the number of characters that you want to extract from the string beginning at `start_position`. If the sum of `start_position` and `length` is greater than the number of characters in the `string`, the substring function returns the whole string beginning at `start_position`. The `length` parameter is optional. If you omit it, the `SUBSTRING` function returns the whole string started at `start_position`.

PostgreSQL offers another syntax for the `SUBSTRING()` function as follows:

```sql
SUBSTRING(string FROM start_position FOR length);
```

PostgreSQL provides another function named `SUBSTR()` that has the same functionality as the `SUBSTRING()` function.

## PostgreSQL SUBSTRING() function examples

Let’s explore some examples of using the `SUBSTRING()` function.

### 1\) Basic SUBSTRING() function examples

The following example uses the `SUBSTRING()` function to extract the first 8 characters from the string PostgreSQL:

```sql
SELECT
  SUBSTRING ('PostgreSQL', 1, 8);
```

Output:

```
 substring
-----------
 PostgreS
(1 row)
```

In the example, we extract a substring that has a length of 8, starting at the first character of the `PostgreSQL` string. The result is et `PostgreS` as illustrated in the following picture:

![PostgreSQL substring function example](/postgresqltutorial/PostgreSQL-substring-function-example.jpg)The following example uses the `SUBSTRING()` function to extract the first 8 characters from the PostgreSQL string:

```
SELECT
  SUBSTRING ('PostgreSQL', 8);
```

Output:

```text
 substring
-----------
 SQL
(1 row)

```

In this example, we extract a substring started at position 8 and omit the `length` parameter. The resulting substring starts at the position 8 to the rest of the string.

The following examples use the alternative syntax of the `SUBSTRING()` function:

```
SELECT
  SUBSTRING ('PostgreSQL' FROM 1 FOR 8),
  SUBSTRING ('PostgreSQL' FROM 8);
```

Output:

```text
 substring | substring
-----------+-----------
 PostgreS  | SQL
(1 row)
```

### 2\) Using the PostgreSQL SUBSTRING() function with table data

We’ll use the `customer` table from the [sample database](../postgresql-getting-started/postgresql-sample-database):

![customer table](/postgresqltutorial/customer.png)
The following example uses the `SUBSTRING()` function to retrieve the initial names of customers by extracting the first character of value in the `first_name` column:

```
SELECT
  first_name,
  SUBSTRING(first_name, 1, 1) AS initial
FROM
  customer;
```

Output:

```text
 first_name  | initial
-------------+---------
 Jared       | J
 Mary        | M
 Patricia    | P
 Linda       | L
...
```

## Extracting substring matching POSIX regular expression

In addition to the SQL\-standard substring function, PostgreSQL allows you to extract a substring that matches a [POSIX regular expression](https://en.wikipedia.org/wiki/Regular_expression#POSIX_basic_and_extended).

The following illustrates the syntax of the substring function with POSIX regular expression:

```
SUBSTRING(string, pattern);
```

Or you can use the following syntax:

```sql
SUBSTRING(string FROM pattern)
```

If the SUBSTRING() function finds no match, it returns NULL.

If the `pattern` contains any parentheses, the `SUBSTRING()` function returns the text that matches the first parenthesized subexpression.

The following example uses the `SUBSTRING()` to extract the house number with 1 to 4 digits, from a string:

```sql
SELECT
  SUBSTRING (
    'The house number is 9001', '([0-9]{1,4})'
  ) AS house_no
```

Output:

```text
 house_no
----------
 9001
(1 row)
```

## Extracting substring matching a SQL regular expression

Besides the POSIX regular expression pattern, you can use the SQL regular expression pattern to extract a substring from a string using the following syntax:

```
SUBSTRING(string FROM pattern FOR escape-character)
```

In this syntax:

- `string`: is a string that you want to extract the substring.
- `escape-character`: the escape character.
- `pattern` is a regular expression wrapped inside escape characters followed by a double quote ("). For example, if the character `#` is the escape character, the pattern will be `#"pattern#"`. In addition, the `pattern` must match the entire `string`, otherwise, the function will fail and return `NULL`.

For example:

```sql
SELECT
  SUBSTRING ('PostgreSQL' FROM '%#"S_L#"%' FOR '#');
```

Output:

```
 substring
-----------
 SQL
(1 row)
```

## Summary

- Use the PostgreSQL `SUBSTRING()` functions to extract a substring from a string.


# TRANSLATE

---
title: 'PostgreSQL TRANSLATE() Function'
page_title: 'PostgreSQL TRANSLATE() Function'
page_description: 'How to use the PostgreSQL TRANSLATE() function to perform several single-character, one-to-one translation in one operation.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-translate/'
ogImage: ''
updatedOn: '2024-01-29T01:41:25+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CONCAT_WS() Function'
  slug: 'postgresql-string-functions/postgresql-concat_ws'
nextLink:
  title: 'PostgreSQL TO_CHAR() Function'
  slug: 'postgresql-string-functions/postgresql-to_char'
---

The PostgreSQL `TRANSLATE()` function performs several single\-character, one\-to\-one translations in one operation.

## Syntax

The following illustrates the syntax of the PostgreSQL `TRANSLATE()` function:

```sql
TRANSLATE(string, from, to)
```

## Arguments

The PostgreSQL `TRANSLATE()` function accepts three arguments:

**1\) `string`**  
 is a string subjected to translation.

**2\) `from`**  
 is a set of characters in the first argument (`string`) that should be replaced.

**3\) `to`**  
 is a set of characters that replaces the `from` in the string.

Notice that if `from` is longer than `to`, the `TRANSLATE()` function removes the occurrences of the extra characters in `from`.

## Return value

The PostgreSQL `TRANSLATE()` function returns a string with the characters in the one set of characters replaced by another set of characters.

## Examples

Let’s see some examples of using the `TRANSLATE()` function to understand how it works.

### 1\) Basic TRANSLATE() function example

See the following statement:

```sql
SELECT TRANSLATE('12345', '134', 'ax')
```

In this example:

- The character `'1'` in string `'12345'` is substituted by character `'a'`, The character `'3'` in the string `'12345'` is substituted by the character `'x'`.
- Because the string `'134'` has more characters than the string `'ax'`, the `TRANSLATE()` function removes the extra character in the string `'134'`, which is `'4'`, from the string `'12345'`.

The following illustrates the result:

```text
 translate
-----------
 a2x5
(1 row)
```

### 2\) Single character replacement

The following example shows how to use the `TRANSLATE()` function to replace comma (,) with a semi\-colon (;) in a comma\-separated values list.

```
SELECT TRANSLATE('apple,orange,banana', ',', ';');
```

Here is the output:

```text
  translate
---------------------
 apple;orange;banana
(1 row)
```

### 3\) Encrypting and decrypting a message

The following example shows how to use the `TRANSLATE()` function to encrypt a message:

```
SELECT TRANSLATE('a secret message',
                 'abcdefghijklmnopqrstuvxyz',
                 '0123456789acwrvyuiopkjhbq');
```

Here is the output:

```text
    translate
------------------
 0 o42i4p w4oo064
(1 row)
```

You can also decrypt the message `'0 o42i4p w4oo064'` using the function:

```
SELECT TRANSLATE('0 o42i4p w4oo064',
                     '0123456789acwrvyuiopkjhbq',
                     'abcdefghijklmnopqrstuvxyz');
```

Hence the output is:

```
    translate
------------------
 a secret message
(1 row)
```

In this tutorial, you have learned how to use the PostgreSQL `TRANSLATE()` function to substitute characters in a set with another, one\-to\-one, in a single operation.


# TRIM

---
title: 'PostgreSQL TRIM() Function'
page_title: 'PostgreSQL TRIM() Function'
page_description: 'Use the PostgreSQL TRIM() function to remove the specified characters from the leading, trailing, or both leading and trailing of a string.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-trim-function/'
ogImage: ''
updatedOn: '2024-01-27T14:01:40+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL LENGTH() Function'
  slug: 'postgresql-string-functions/postgresql-length-function'
nextLink:
  title: 'PostgreSQL LTRIM() Function'
  slug: 'postgresql-string-functions/postgresql-ltrim'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `TRIM()` function to remove specified prefixes or suffixes (or both) from a string.

## Introduction to PostgreSQL TRIM() function

The `TRIM()` function allows you to remove specified prefixes or suffixes (or both) from a string.

Here’s the basic syntax of the `TRIM()` function:

```css
TRIM([LEADING | TRAILING | BOTH] trim_character
FROM source_string)

```

In this syntax:

- `source_string`: Specify the string that you want to remove specified characters.
- `trim_character`: Specify the trim characters.
- `LEADING`: This option instructs the function to remove the leading occurrences of the specified trim character.
- `TRAILING`: This option instructs the function to remove trailing occurrences of the specified trim character.
- `BOTH`: This option instructs the function to remove both leading and trailing occurrences of the specified trim character.

The `TRIM()` function can be very useful when you want to clean up strings.

To remove specific characters from the beginning of a string, you use the [LTRIM()](postgresql-ltrim) function. To remove specific characters from the end of a string, you can use the [RTRIM()](postgresql-rtrim) function.

## PostgreSQL TRIM() function examples

Let’s explore some examples of using the `TRIM()` function.

### 1\) Basic PostgreSQL TRIM() function example

The following example uses the `TRIM()` function to remove leading and trailing spaces from the string `' PostgreSQL '`:

```php
SELECT TRIM('   PostgreSQL   ') AS trimmed_string;

```

Output:

```php
 trimmed_string
----------------
 PostgreSQL
(1 row)
```

The output is a string without leading and trailing spaces.

### 2\) Using the PostgreSQL TRIM() function to remove specific characters

The following example uses the `TRIM()` function to remove leading and trailing hash symbols (`#`) from the string `'##PostgreSQL##'`:

```
SELECT TRIM('#' FROM '##PostgreSQL##') AS trimmed_string;

```

Output:

```php
 trimmed_string
----------------
 PostgreSQL
(1 row)
```

### 3\) Using the TRIM() function to remove specific characters by specifying the trim location

The following example uses the PostgreSQL `TRIM()` function to remove leading, trailing, and both leading and trailing zeros from the string `'0000123450'`:

```
SELECT TRIM(LEADING '0' FROM '000123450') AS trimmed_string_leading,
       TRIM(TRAILING '0' FROM '000123450') AS trimmed_string_trailing,
       TRIM(BOTH '0' FROM '000123450') AS trimmed_string_both;

```

Output:

```php
 trimmed_string_leading | trimmed_string_trailing | trimmed_string_both
------------------------+-------------------------+---------------------
 123450                 | 00012345                | 12345
(1 row)
```

### 4\) Using the TRIM() function with table data

First, [create a table](../postgresql-tutorial/postgresql-create-table) called `todo` and [insert](../postgresql-tutorial/postgresql-insert) some sample data:

```
CREATE TABLE todo(
  id SERIAL PRIMARY KEY,
  title VARCHAR(255) NOT NULL,
  completed BOOL NOT NULL DEFAULT false
);

INSERT INTO todo(title)
VALUES
  ('   Learn PostgreSQL   '),
  ('Build an App   ')
RETURNING *;
```

Output:

```
 id |         title          | completed
----+------------------------+-----------
  1 |    Learn PostgreSQL    | f
  2 | Build an App           | f
(2 rows)
```

Second, remove the leading and trailing spaces from the `title` column using the `TRIM()` function:

```
UPDATE todo
SET title = TRIM(title);
```

Output:

```
UPDATE 2
```

Third, verify the updates:

```
SELECT * FROM todo;
```

Output:

```
 id |      title       | completed
----+------------------+-----------
  1 | Learn PostgreSQL | f
  2 | Build an App     | f
(2 rows)
```

## Summary

- Use the PostgreSQL `TRIM()` function to remove a specified leading, trailing, or both leading and trailing characters from a string.


# TO_CHAR

---
title: 'PostgreSQL TO_CHAR() Function'
page_title: 'PostgreSQL TO_CHAR Function By Practical Examples'
page_description: 'This tutorial shows you how to use the PostgreSQL TO_CHAR() function to convert a timestamp or a numeric value to a string.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-to_char/'
ogImage: '/postgresqltutorial/payment-table.png'
updatedOn: '2024-01-29T02:05:27+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL TRANSLATE() Function'
  slug: 'postgresql-string-functions/postgresql-translate'
nextLink:
  title: 'PostgreSQL TO_NUMBER() Function'
  slug: 'postgresql-string-functions/postgresql-to_number'
---

The PostgreSQL `TO_CHAR()` function converts a [timestamp](../postgresql-tutorial/postgresql-timestamp), an [interval](../postgresql-tutorial/postgresql-interval), an [integer](../postgresql-tutorial/postgresql-integer), a double\-precision, or a [numeric](../postgresql-tutorial/postgresql-numeric) value to a [string](../postgresql-tutorial/postgresql-char-varchar-text).

## Syntax

The following illustrates the syntax of the PostgreSQL `TO_CHAR()` function:

```csssql
TO_CHAR(expression, format)
```

## Arguments

The PostgreSQL `TO_CHAR()` function requires two arguments:

### 1\) expression

The expression can be a timestamp, an interval, an integer, a double\-precision, or a numeric value that is converted to a string according to a specific format.

### 2\) format

The format for the result string.

The following table illustrates the valid numeric format strings:

| Format     | Description                                                               |
| ---------- | ------------------------------------------------------------------------- |
| 9          | Numeric value with the specified number of digits                         |
| 0          | Numeric value with leading zeros                                          |
| . (period) | decimal point                                                             |
| D          | decimal point that uses the locale                                        |
| , (comma)  | group (thousand) separator                                                |
| FM         | Fill mode, which suppresses padding blanks and leading zeroes.            |
| PR         | Negative value in angle brackets.                                         |
| S          | Sign anchored to a number that uses locale                                |
| L          | Currency symbol that uses locale                                          |
| G          | Group separator that uses locale                                          |
| MI         | Minus sign in the specified position for numbers that are less than 0\.   |
| PL         | Plus sign in the specified position for numbers that are greater than 0\. |
| SG         | Plus / minus sign in the specified position                               |
| RN         | Roman numeral that ranges from 1 to 3999                                  |
| TH or th   | Upper case or lower case ordinal number suffix                            |

The following table shows the valid timestamp format strings:

| **Pattern**              | **Description**                                                                                     |
| ------------------------ | --------------------------------------------------------------------------------------------------- |
| Y,YYY                    | year in 4 digits with comma                                                                         |
| YYYY                     | year in 4 digits                                                                                    |
| YYY                      | The last 3 digits of ISO 8601 week\-numbering year                                                  |
| YY                       | last 3 digits of the year                                                                           |
| Y                        | last 2 digits of the year                                                                           |
| IYYY                     | ISO 8601 week\-numbering year (4 or more digits)                                                    |
| IYY                      | The last 2 digits of ISO 8601 week\-numbering year                                                  |
| IY                       | The last digit of ISO 8601 week\-numbering year                                                     |
| I                        | Abbreviated lowercase month name e.g., Jan, feb, etc.                                               |
| BC, bc, AD or ad         | Era indicator without periods                                                                       |
| B.C., b.c., A.D. or a.d. | Era indicator with periods                                                                          |
| MONTH                    | English month name in uppercase                                                                     |
| Month                    | Full capitalized English month name                                                                 |
| month                    | Full lowercase English month name                                                                   |
| MON                      | Abbreviated uppercase month name e.g., JAN, FEB, etc.                                               |
| Mon                      | Week number of the year (1\-53\) (the first week starts on the first day of the year)               |
| mon                      | Abbreviated capitalized month name e.g., Jan, Feb,  etc.                                            |
| MM                       | month number from 01 to 12                                                                          |
| DAY                      | Full uppercase day name                                                                             |
| Day                      | Full capitalized day name                                                                           |
| day                      | Full lowercase day name                                                                             |
| DY                       | Abbreviated uppercase day name                                                                      |
| Dy                       | Abbreviated capitalized day name                                                                    |
| dy                       | Abbreviated lowercase day name                                                                      |
| DDD                      | Day of year (001\-366\)                                                                             |
| IDDD                     | Day of ISO 8601 week\-numbering year (001\-371; day 1 of the year is Monday of the first ISO week)  |
| DD                       | Day of month (01\-31\)                                                                              |
| D                        | Day of the week, Sunday (1\) to Saturday (7\)                                                       |
| ID                       | ISO 8601 day of the week, Monday (1\) to Sunday (7\)                                                |
| W                        | Week of month (1\-5\) (the first week starts on the first day of the month)                         |
| WW                       | Century e.g., 21, 22, etc.                                                                          |
| IW                       | Week number of ISO 8601 week\-numbering year (01\-53; the first Thursday of the year is in week 1\) |
| CC                       | Century e.g, 21, 22, etc.                                                                           |
| J                        | Julian Day (integer days since November 24, 4714 BC at midnight UTC)                                |
| RM                       | Month in upper case Roman numerals (I\-XII; \>                                                      |
| rm                       | Month in lowercase Roman numerals (i\-xii; \>                                                       |
| HH                       | Hour of day (0\-12\)                                                                                |
| HH12                     | Hour of day (0\-12\)                                                                                |
| HH24                     | Hour of day (0\-23\)                                                                                |
| MI                       | Minute (0\-59\)                                                                                     |
| SS                       | Second (0\-59\)                                                                                     |
| MS                       | Millisecond (000\-999\)                                                                             |
| US                       | Microsecond (000000\-999999\)                                                                       |
| SSSS                     | Seconds past midnight (0\-86399\)                                                                   |
| AM, am, PM or pm         | Meridiem indicator (without periods)                                                                |
| A.M., a.m., P.M. or p.m. | Meridiem indicator (with periods)                                                                   |

## Return value

The `TO_CHAR()` function returns a string in [`TEXT`](../postgresql-tutorial/postgresql-char-varchar-text) data type that represents the first argument formatted according to the specified format.

## Examples

We will use the `payment` table in the [sample database](../postgresql-getting-started/postgresql-sample-database) for the demonstration.

![payment table](/postgresqltutorial/payment-table.png)

### 1\) Converting a timestamp to a string example

The following statement uses the `TO_CHAR()` function to format the payment date that consists of hours, minutes, and seconds:

```
SELECT
    payment_date,
    TO_CHAR(
        payment_date,
        'HH12:MI:SS'
    ) payment_time
FROM
    payment
ORDER BY
    payment_date;
```

Here is the result:

![PostgreSQL TO_CHAR Function - format timestamp example](/postgresqltutorial/PostgreSQL-TO_CHAR-Function-format-timestamp-example.png)

### 2\) Converting an entire timestamp value into a different format example

The following example converts the payment date into a different format:

```sql
SELECT
    payment_id,
    payment_date,
    TO_CHAR(
        payment_date,
        'MON-DD-YYYY HH12:MIPM'
    ) payment_time
FROM
    payment
ORDER BY
    payment_date;
```

The output is:

![](/postgresqltutorial/PostgreSQL-TO_CHAR-Function-format-payment-date-example.png)

### 3\) Converting a timestamp literal to a string example

The following statement converts a timestamp literal to a string:

```sql
SELECT
    TO_CHAR(
        TIMESTAMP '2017-08-18 22:30:59',
        'HH24:MI:SS'
    );
```

The result is:

```sql
22:30:59
```

### 4\) Adding currency symbol to the amount example

The following example adds US dollar to the paid amounts:

```
SELECT
    payment_id,
    amount,
    TO_CHAR(
        amount,
        'l99999D99'
    ) amount_format
FROM
    payment
ORDER BY
    payment_date;
```

The following picture illustrates the output:

![PostgreSQL TO_CHAR Function - add currency symbol example](/postgresqltutorial/PostgreSQL-TO_CHAR-Function-add-currency-symbol-example.png)

### 5\) Converting an integer to a string example

The following example converts an integer to a string:

```sql
SELECT
    TO_CHAR(
        2017,
        '9,999'
    );
```

Result

```text
  2,017
```

### 6\) Putting it all together example

The following example converts a numeric and timestamp to a string:

```
SELECT
    first_name || ' ' || last_name
    || ' paid ' ||
    TO_CHAR(
        amount,
        'l99D99'
    )
    || ' at ' ||
    TO_CHAR(
        payment_date,
        'HH24:MI:SS'
    )
    || ' on ' ||
    TO_CHAR(
        payment_date,
        'Mon-DD-YYYY'
    ) payment_info
FROM
    payment
INNER JOIN customer USING(customer_id)
ORDER BY
    rental_id;
```

The result is

![PostgreSQL TO_CHAR Function - example](/postgresqltutorial/PostgreSQL-TO_CHAR-Function-example.png)
Summary

- Use the PostgreSQL `TO_CHAR()` function to convert a timestamp or a numeric value to a string.


# TO_NUMBER

---
title: 'PostgreSQL TO_NUMBER() Function'
page_title: 'PostgreSQL TO_NUMBER() Function By Examples'
page_description: 'This tutorial shows you how to use the PostgreSQL TO_NUMBER() function to convert a string to a numeric value based on the specified format.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-to_number/'
ogImage: ''
updatedOn: '2024-01-29T02:05:33+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL TO_CHAR() Function'
  slug: 'postgresql-string-functions/postgresql-to_char'
nextLink:
  title: 'PostgreSQL Math Functions'
  slug: 'postgresql-string-functions/../postgresql-math-functions'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `TO_NUMBER()` function to convert a [character string](../postgresql-tutorial/postgresql-char-varchar-text) to a [numeric](../postgresql-tutorial/postgresql-numeric) value according to a specified format.

## Introduction to the PostgreSQL TO_NUMBER() function

The PostgreSQL `TO_NUMBER()` function allows you to convert a string to a number based on a specified format.

Here’s the basic syntax of the `TO_NUMBER()` function:

```csssql
TO_NUMBER(string, format)
```

The `TO_NUMBER()` function requires two arguments:

- string: This is a string that you want to convert to a number.
- format: This is the format that specifies how the string should be interpreted as a number.

The `TO_NUMBER()` function returns a value whose data type is numeric.

The following table illustrates the list of valid formats:

| Format     | Description                                                                                         |
| ---------- | --------------------------------------------------------------------------------------------------- |
| 9          | Numeric value with the specified number of digits                                                   |
| 0          | Numeric value with leading zeros                                                                    |
| . (period) | decimal point                                                                                       |
| D          | Sign anchored to a number that uses the locale                                                      |
| , (comma)  | group (thousand) separator                                                                          |
| FM         | Fill mode, which suppresses padding blanks and leading zeroes.                                      |
| PR         | Negative value in angle brackets.                                                                   |
| S          | Sign anchored to a number that uses locale                                                          |
| L          | Currency symbol that uses locale                                                                    |
| G          | Group separator that uses locale                                                                    |
| MI         | Minus sign in the specified position for numbers that are less than 0\.                             |
| PL         | Plus sign in the specified position for numbers that are greater than 0\.                           |
| SG         | Plus / minus sign in the specified position                                                         |
| RN         | Roman numeral ranges from 1 to 3999 – currently, it **does not work** for the Roman numeric string. |
| TH or th   | Upper case or lower case ordinal number suffix                                                      |

Noted that these format strings are also applicable to [`TO_CHAR()`](postgresql-to_char) function.

## PostgreSQL TO_NUMBER() function examples

Let’s take a look at some examples of using the `TO_NUMBER()` function to understand how it works.

### 1\) Converting a string to a number

The following example uses the `TO_NUMBER()` function to convert the string `'12,345.6-'` to a number.

```
SELECT
    TO_NUMBER(
        '12,345.6-',
        '99G999D9S'
    );
```

The output is:

```text
 to_number
-----------
  -12345.6
(1 row)
```

In this example:

- `'12,345.6-'` is the input that we want to convert to a number. The input string consists of a group separator (`,`), a decimal point (`.`), and a minus sign (`-`) indicating a negative number.
- `'99G999D9S'` is the format pattern used to interpret the input string. Each character in the format pattern has a specific meaning:
  - `9`: A digit placeholder.
  - `G`: The group separator (`,`).
  - `D`: The decimal point (`.`).
  - `S`: The sign (either `+` or `-`).

The TO_NUMBER() parses the input string `'12,345.6-'` according to the format `'99G999D9S'` and returns a numeric value `-12345.6`

### 2\) Converting a money amount to a number

The following example uses the `TO_NUMBER()` function to convert a money amount to a number:

```css
SELECT
    TO_NUMBER(
        '$1,234,567.89',
        'L9G999g999.99'
    );
```

Here is the result:

```sql
to_number
-----------
 1234567.89
(1 row)
```

In this example:

- `'$1,234,567.89'` is the input string representing a money amount. It includes a dollar sign (`$`), a group separator (`,`), a decimal point (`.`), and numeric digits.
- `'L9G999g999.99'` is the format string that the `TO_NUMBER()` function interprets the money amount. Each character in the format string has a specific meaning:
  - `L`: A local currency symbol (in this case, the dollar sign `$`).
  - `9`: A digit placeholder.
  - `G`: The group separator (`,` in this case).
  - `g`: An optional occurrence of the group separator (`,`), which allows for flexible formatting.
  - `.`: The decimal point.
  - `99`: Two\-digit placeholders for the fractional part (cents).

Since the provided format matches the input string, the function parses the string accordingly and returns the number `1234567.89`.

### 3\) Format control

If you don’t specify .99 in the format string, the `TO_NUMBER()` function will not parse the part after the decimal place. For example:

```http
SELECT
    TO_NUMBER(
        '1,234,567.89',
        '9G999g999'
    );
```

It returned `1234567` instead of `1234567.89` as follows:

```text
 to_number
-----------
   1234567
(1 row)
```

### 4\) Format string does not match the input string

The following statement uses the `TO_NUMBER()` function to convert a string to a number but the format string does not match:

```
SELECT TO_NUMBER('1,234,567.89', '999G999.99');
```

Output:

```
ERROR:  numeric field overflow
DETAIL:  A field with precision 6, scale 0 must round to an absolute value less than 10^6.
```

The `TO_NUMBER()` function issues an error in this case.

## Summary

- Use the PostgreSQL `TO_NUMBER()` function to convert a string to a numeric value.


# UPPER

---
title: 'PostgreSQL UPPER() Function'
page_title: 'PostgreSQL UPPER() Function'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL UPPER() function to convert the string to all uppercase.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-string-functions/postgresql-upper/'
ogImage: '/postgresqltutorial/customer.png'
updatedOn: '2024-01-28T11:13:28+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL LOWER() Function'
  slug: 'postgresql-string-functions/postgresql-lower'
nextLink:
  title: 'PostgreSQL RTRIM() Function'
  slug: 'postgresql-string-functions/postgresql-rtrim'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `UPPER()` function to convert a string to uppercase.

## Introduction to the PostgreSQL UPPER() function

The `UPPER()` function converts a string to uppercase based on the rules of the database’s locale.

Here’s the syntax of the `UPPER()` function:

```sql
UPPER(text)
```

In this syntax, `text` is the input string that you want to convert to uppercase. Its type can be `CHAR`, [`VARCHAR`](../postgresql-tutorial/postgresql-char-varchar-text), or `TEXT`.

The `UPPER()` function returns a new string with all letters converted to uppercase.

The `UPPER()` function returns `NULL` if the `text` is `NULL`.

Note that to convert a string to lowercase, you use the [LOWER()](postgresql-lower) function.

## PostgreSQL UPPER() function examples

Let’s take some examples of using the `UPPER()` function.

### 1\) Basic PostgreSQL UPPER() function example

The following example uses the `UPPER()` function to convert the string `PostgreSQL` to uppercase:

```sql
SELECT UPPER('PostgreSQL');
```

Output:

```text
   upper
------------
 POSTGRESQL
(1 row)
```

### 2\) Using PostgreSQL UPPER() function with table data

We’ll use the `customer` table from the [sample database](../postgresql-getting-started/postgresql-sample-database):

![PostgreSQL UPPER() Function - Sample Table ](/postgresqltutorial/customer.png)The following example uses the `UPPER()` function to convert the first names of customers to uppercase:

```sql
SELECT
  UPPER(first_name)
FROM
  customer
ORDER BY
  first_name;
```

Output:

```text
    upper
-------------
 AARON
 ADAM
 ADRIAN
 AGNES
 ALAN
...
```

### 3\) Using PostgreSQL UPPER() function in the WHERE clause

The following example uses the `UPPER()` function in the [`WHERE`](../postgresql-tutorial/postgresql-where) clause to find customers by last names, comparing them with the input string in uppercase:

```sql
SELECT
  first_name,
  last_name
FROM
  customer
WHERE
  UPPER(last_name) = 'BARNETT';
```

Output:

```text
 first_name | last_name
------------+-----------
 Carole     | Barnett
(1 row)
```

## Summary

- Use the `UPPER()` function to return a new string with all the characters of the input string converted to uppercase.


# Window Functions

---
title: 'PostgreSQL Window Functions'
page_title: 'PostgreSQL Window Functions: The Ultimate Guide'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL window functions to perform the calculation across the set of rows related to the current row.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-window-function/'
ogImage: 'https://www.postgresqltutorial.com//postgresqltutorial/window-functions.png'
updatedOn: '2021-04-27T01:56:11+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL WIDTH_BUCKET() Function'
  slug: 'postgresql-math-functions/postgresql-width_bucket'
nextLink:
  title: 'PostgreSQL CUME_DIST Function'
  slug: 'postgresql-window-function/postgresql-cume_dist-function'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL window functions to perform the calculation across a set of rows related to the current row.

## Setting up sample tables

First, [create two tables](postgresql-tutorial/postgresql-create-table) named `products` and `product_groups` for the demonstration:

![](/postgresqltutorial/products_product_groups_tables.png)

```sql
CREATE TABLE product_groups (
	group_id serial PRIMARY KEY,
	group_name VARCHAR (255) NOT NULL
);

CREATE TABLE products (
	product_id serial PRIMARY KEY,
	product_name VARCHAR (255) NOT NULL,
	price DECIMAL (11, 2),
	group_id INT NOT NULL,
	FOREIGN KEY (group_id) REFERENCES product_groups (group_id)
);
```

Second, [insert](postgresql-tutorial/postgresql-insert) some rows into these tables:

```sql
INSERT INTO product_groups (group_name)
VALUES
	('Smartphone'),
	('Laptop'),
	('Tablet');

INSERT INTO products (product_name, group_id,price)
VALUES
	('Microsoft Lumia', 1, 200),
	('HTC One', 1, 400),
	('Nexus', 1, 500),
	('iPhone', 1, 900),
	('HP Elite', 2, 1200),
	('Lenovo Thinkpad', 2, 700),
	('Sony VAIO', 2, 700),
	('Dell Vostro', 2, 800),
	('iPad', 3, 700),
	('Kindle Fire', 3, 150),
	('Samsung Galaxy Tab', 3, 200);
```

![](/postgresqltutorial/products-table-sample-data.png)

![](/postgresqltutorial/product_groups-table-data.png)

## Introduction to PostgreSQL window functions

The easiest way to understand the window functions is to start by reviewing the [aggregate functions](postgresql-aggregate-functions). An aggregate function aggregates data from a set of rows into a single row.

The following example uses the [`AVG()`](postgresql-aggregate-functions/postgresql-avg-function) aggregate function to calculate the average price of all products in the `products` table.

```sql
SELECT
	AVG (price)
FROM
	products;

```

![PostgreSQL Window Function - AVG function](/postgresqltutorial/PostgreSQL-Window-Function-AVG-function.png)
To apply the aggregate function to subsets of rows, you use the [`GROUP BY`](postgresql-tutorial/postgresql-group-by) clause. The following example returns the average price for every product group.

```sql
SELECT
	group_name,
	AVG (price)
FROM
	products
INNER JOIN product_groups USING (group_id)
GROUP BY
	group_name;
```

![PostgreSQL Window Function - AVG function with GROUP BY](/postgresqltutorial/PostgreSQL-Window-Function-AVG-function-with-GROUP-BY.png)
As you see clearly from the output, the [`AVG()`](postgresql-aggregate-functions/postgresql-avg-function) function reduces the number of rows returned by the queries in both examples.

Similar to an aggregate function, a window function operates on a set of rows. However, it does not reduce the number of rows returned by the query.

The term _window_ describes the set of rows on which the window function operates. A window function returns values from the rows in a window.

For instance, the following query returns the product name, the price, product group name, along with the average prices of each product group.

```sql
SELECT
	product_name,
	price,
	group_name,
	AVG (price) OVER (
	   PARTITION BY group_name
	)
FROM
	products
	INNER JOIN
		product_groups USING (group_id);
```

![](/postgresqltutorial/PostgreSQL-Window-Function-AVG-window-function.png)
In this query, the `AVG()` function works as a _window function_ that operates on a set of rows specified by the `OVER` clause. Each set of rows is called a window.

The new syntax for this query is the `OVER` clause:

```sql
AVG(price) OVER (PARTITION BY group_name)
```

In this syntax, the `PARTITION BY` distributes the rows of the result set into groups and the `AVG()` function is applied to each group to return the average price for each.

Note that a window function always performs the calculation on the result set after the [`JOIN`](postgresql-tutorial/postgresql-joins), [`WHERE`](postgresql-tutorial/postgresql-where), [`GROUP BY`](postgresql-tutorial/postgresql-group-by) and [`HAVING`](postgresql-tutorial/postgresql-having) clause and before the final [`ORDER BY`](postgresql-tutorial/postgresql-order-by) clause in the evaluation order.

## PostgreSQL Window Function Syntax

PostgreSQL has a sophisticated [syntax for window function call](https://www.postgresql.org/docs/current/sql-expressions.html#SYNTAX-WINDOW-FUNCTIONS). The following illustrates the simplified version:

```sql
window_function(arg1, arg2,..) OVER (
   [PARTITION BY partition_expression]
   [ORDER BY sort_expression [ASC | DESC] [NULLS {FIRST | LAST }])
```

In this syntax:

### window_function(arg1,arg2,...)

The `window_function` is the name of the window function. Some window functions do not accept any argument.

### PARTITION BY clause

The `PARTITION BY` clause divides rows into multiple groups or partitions to which the window function is applied. Like the example above, we used the product group to divide the products into groups (or partitions).

The `PARTITION BY` clause is optional. If you skip the `PARTITION BY` clause, the window function will treat the whole result set as a single partition.

### ORDER BY clause

The `ORDER BY` clause specifies the order of rows in each partition to which the window function is applied.

The `ORDER BY` clause uses the `NULLS FIRST` or `NULLS LAST` option to specify whether nullable values should be first or last in the result set. The default is `NULLS LAST` option.

### frame_clause

The `frame_clause` defines a subset of rows in the current partition to which the window function is applied. This subset of rows is called a frame.

If you use multiple window functions in a query:

```sql
SELECT
    wf1() OVER(PARTITION BY c1 ORDER BY c2),
    wf2() OVER(PARTITION BY c1 ORDER BY c2)
FROM table_name;
```

you can use the `WINDOW` clause to shorten the query as shown in the following query:

```sql
SELECT
   wf1() OVER w,
   wf2() OVER w,
FROM table_name
WINDOW w AS (PARTITION BY c1 ORDER BY c2);
```

It is also possible to use the `WINDOW` clause even though you call one window function in a query:

```sql
SELECT wf1() OVER w
FROM table_name
WINDOW w AS (PARTITION BY c1 ORDER BY c2);
```

## PostgreSQL window function List

The following table lists all window functions provided by PostgreSQL. Note that some aggregate functions such as `AVG()`, `MIN()`, `MAX()`, `SUM()`, and `COUNT()` can be also used as window functions.

##

| Name                                                                        | Description                                                                                                                 |
| --------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------- |
| [CUME_DIST](postgresql-window-function/postgresql-cume_dist-function)       | Return the relative rank of the current row.                                                                                |
| [DENSE_RANK](postgresql-window-function/postgresql-dense_rank-function)     | Rank the current row within its partition without gaps.                                                                     |
| [FIRST_VALUE](postgresql-window-function/postgresql-first_value-function)   | Return a value evaluated against the first row within its partition.                                                        |
| [LAG](postgresql-window-function/postgresql-lag-function)                   | Return a value evaluated at the row that is at a specified physical offset row before the current row within the partition. |
| [LAST_VALUE](postgresql-window-function/postgresql-last_value-function)     | Return a value evaluated against the last row within its partition.                                                         |
| [LEAD](postgresql-window-function/postgresql-lead-function)                 | Return a value evaluated at the row that is offset rows after the current row within the partition.                         |
| [NTILE](postgresql-window-function/postgresql-ntile-function)               | Divide rows in a partition as equally as possible and assign each row an integer starting from 1 to the argument value.     |
| [NTH_VALUE](postgresql-window-function/postgresql-nth_value-function)       | Return a value evaluated against the nth row in an ordered partition.                                                       |
| [PERCENT_RANK](postgresql-window-function/postgresql-percent_rank-function) | Return the relative rank of the current row (rank\-1\) / (total rows – 1\)                                                  |
| [RANK](postgresql-window-function/postgresql-rank-function)                 | Rank the current row within its partition with gaps.                                                                        |
| [ROW_NUMBER](postgresql-window-function/postgresql-row_number)              | Number the current row within its partition starting from 1\.                                                               |

## The ROW_NUMBER(), RANK(), and DENSE_RANK() functions

The [`ROW_NUMBER()`](postgresql-window-function/postgresql-row_number), [`RANK()`](postgresql-window-function/postgresql-rank-function), and [`DENSE_RANK()`](postgresql-window-function/postgresql-dense_rank-function) functions assign an integer to each row based on its order in its result set.

The `ROW_NUMBER()` function assigns a sequential number to each row in each partition. See the following query:

```sql
SELECT
	product_name,
	group_name,
	price,
	ROW_NUMBER () OVER (
		PARTITION BY group_name
		ORDER BY
			price
	)
FROM
	products
INNER JOIN product_groups USING (group_id);
```

![PostgreSQL Window Function - ROW_NUMBER function](/postgresqltutorial/PostgreSQL-Window-Function-ROW_NUMBER-function.png)
The [`RANK()`](postgresql-window-function/postgresql-rank-function) function assigns ranking within an ordered partition. If rows have the same values, the  `RANK()` function assigns the same rank, with the next ranking(s) skipped.

See the following query:

```sql
SELECT
	product_name,
	group_name,
  price,
	RANK () OVER (
		PARTITION BY group_name
		ORDER BY
			price
	)
FROM
	products
INNER JOIN product_groups USING (group_id);
```

![PostgreSQL Window Function - RANK function](/postgresqltutorial/PostgreSQL-Window-Function-RANK-function.png)
In the laptop product group, both `Dell Vostro` and `Sony VAIO` products have the same price, therefore, they receive the same rank 1\. The next row in the group is `HP Elite` that receives the rank 3 because the rank 2 is skipped.

Similar to the `RANK()` function, the [`DENSE_RANK()`](postgresql-window-function/postgresql-dense_rank-function) function assigns a rank to each row within an ordered partition, but the ranks have no gap. In other words, the same ranks are assigned to multiple rows and no ranks are skipped.

```sql
SELECT
	product_name,
	group_name,
	price,
	DENSE_RANK () OVER (
		PARTITION BY group_name
		ORDER BY
			price
	)
FROM
	products
INNER JOIN product_groups USING (group_id);
```

![PostgreSQL Window Function - DENSE_RANK function](/postgresqltutorial/PostgreSQL-Window-Function-DENSE_RANK-function.png)
Within the laptop product group, rank 1 is assigned twice to `Dell Vostro` and `Sony VAIO`. The next rank is 2 assigned to `HP Elite`.

## The FIRST_VALUE and LAST_VALUE functions

The [`FIRST_VALUE()`](postgresql-window-function/postgresql-first_value-function) function returns a value evaluated against the first row within its partition, whereas the [`LAST_VALUE()`](postgresql-window-function/postgresql-last_value-function) function returns a value evaluated against the last row in its partition.

The following statement uses the `FIRST_VALUE()` to return the lowest price for every product group.

```sql
SELECT
	product_name,
	group_name,
	price,
	FIRST_VALUE (price) OVER (
		PARTITION BY group_name
		ORDER BY
			price
	) AS lowest_price_per_group
FROM
	products
INNER JOIN product_groups USING (group_id);
```

![PostgreSQL Window Function - FIRST_VALUE function](/postgresqltutorial/PostgreSQL-Window-Function-FIRST_VALUE-function.png)
The following statement uses the `LAST_VALUE()` function to return the highest price for every product group.

```sql
SELECT
	product_name,
	group_name,
	price,
	LAST_VALUE (price) OVER (
		PARTITION BY group_name
		ORDER BY
			price RANGE BETWEEN UNBOUNDED PRECEDING
		AND UNBOUNDED FOLLOWING
	) AS highest_price_per_group
FROM
	products
INNER JOIN product_groups USING (group_id);
```

![PostgreSQL Window Function - LAST_VALUE function](/postgresqltutorial/PostgreSQL-Window-Function-LAST_VALUE-function.png)
Notice that we added the frame clause `RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING` because by default the frame clause is `RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW`.

## The LAG and LEAD functions

The [`LAG()`](postgresql-window-function/postgresql-lag-function) function has the ability to access data from the previous row, while the [`LEAD()`](postgresql-window-function/postgresql-lead-function) function can access data from the next row.

Both [`LAG()`](postgresql-window-function/postgresql-lag-function) and [`LEAD()`](postgresql-window-function/postgresql-lead-function) functions have the same syntax as follows:

```sql
LAG  (expression [,offset] [,default]) over_clause;
LEAD (expression [,offset] [,default]) over_clause;
```

In this syntax:

- `expression` – a column or expression to compute the returned value.
- `offset` – the number of rows preceding ( `LAG`)/ following ( `LEAD`) the current row. It defaults to 1\.
- `default` – the default returned value if the `offset` goes beyond the scope of the window. The `default` is `NULL` if you skip it.

The following statement uses the `LAG()` function to return the prices from the previous row and calculates the difference between the price of the current row and the previous row.

```sql
SELECT
	product_name,
	group_name,
	price,
	LAG (price, 1) OVER (
		PARTITION BY group_name
		ORDER BY
			price
	) AS prev_price,
	price - LAG (price, 1) OVER (
		PARTITION BY group_name
		ORDER BY
			price
	) AS cur_prev_diff
FROM
	products
INNER JOIN product_groups USING (group_id);
```

![PostgreSQL Window Function - LAG function](/postgresqltutorial/PostgreSQL-Window-Function-LAG-function.png)
The following statement uses the `LEAD()` function to return the prices from the next row and calculates the difference between the price of the current row and the next row.

```sql
SELECT
	product_name,
	group_name,
	price,
	LEAD (price, 1) OVER (
		PARTITION BY group_name
		ORDER BY
			price
	) AS next_price,
	price - LEAD (price, 1) OVER (
		PARTITION BY group_name
		ORDER BY
			price
	) AS cur_next_diff
FROM
	products
INNER JOIN product_groups USING (group_id);
```

![PostgreSQL Window Function - LEAD function](/postgresqltutorial/PostgreSQL-Window-Function-LEAD-function.png)
In this tutorial, we have introduced you to the PostgreSQL window functions and shown you some examples of using them to query data.


# PostgreSQL Window Functions

# CUME_DIST

---
title: 'PostgreSQL CUME_DIST Function'
page_title: 'PostgreSQL CUME_DIST Function By Practical Examples'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL CUME_DIST() function to calculate the cumulative distribution of a value within a set of values.'
prev_url: 'index.html'
ogImage: '/postgresqltutorial/PostgreSQL-CUME_DIST-Function-over-a-result-set-example.png'
updatedOn: '2020-04-11T10:53:00+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Window Functions'
  slug: 'postgresql-window-function/'
nextLink:
  title: 'PostgreSQL DENSE_RANK Function'
  slug: 'postgresql-window-function/postgresql-dense_rank-function'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `CUME_DIST()` function to calculate the cumulative distribution of a value within a set of values.

## PostgreSQL CUME_DIST() function overview

Sometimes, you may want to create a report that shows the top or bottom x% values from a data set, for example, top 1% of products by revenue. Fortunately, PostgreSQL provides us with the `CUME_DIST()` function to calculate it.

The `CUME_DIST()` function returns the cumulative distribution of a value within a set of values. In other words, it returns the relative position of a value in a set of values.

The syntax of the `CUME_DIST()` function is as follows:

```text
 CUME_DIST() OVER (
    [PARTITION BY partition_expression, ... ]
    ORDER BY sort_expression [ASC | DESC], ...
)

```

Let’s examine this syntax in detail.

### PARTITION BY clause

The `PARTITION BY` clause divides rows into multiple partitions to which the function is applied.

The `PARTITION BY` clause is optional. If you skip it, the `CUME_DIST()` function will treat the whole result set as a single partition.

### ORDER BY clause

The `ORDER BY` clause sorts rows in each partition to which the `CUME_DIST()` function is applied.

### Return value

The `CUME_DIST()` a double precision value which is greater than 0 and less than or equal to 1:

```sql
0 < CUME_DIST() <= 1

```

The function returns the same cumulative distribution values for the same tie values.

## PostgreSQL CUME_DIST() examples

First, [create a new table](../postgresql-tutorial/postgresql-create-table) named `sales_stats` that stores the  sales revenue by employees:

```sql
CREATE TABLE sales_stats(
    name VARCHAR(100) NOT NULL,
    year SMALLINT NOT NULL CHECK (year > 0),
    amount DECIMAL(10,2) CHECK (amount >= 0),
    PRIMARY KEY (name,year)
);

```

Second, [insert](../postgresql-tutorial/postgresql-insert) some rows into the `sales_stats` table:

```sql
INSERT INTO
    sales_stats(name, year, amount)
VALUES
    ('John Doe',2018,120000),
    ('Jane Doe',2018,110000),
    ('Jack Daniel',2018,150000),
    ('Yin Yang',2018,30000),
    ('Stephane Heady',2018,200000),
    ('John Doe',2019,150000),
    ('Jane Doe',2019,130000),
    ('Jack Daniel',2019,180000),
    ('Yin Yang',2019,25000),
    ('Stephane Heady',2019,270000);

```

The following examples help you get a better understanding of the `CUME_DIST()` function.

### 1\) Using PostgreSQL CUME_DIST() function over a result set example

The following example returns the sales amount percentile for each sales employee in 2018:

```sql
SELECT
    name,
    year,
    amount,
    CUME_DIST() OVER (
        ORDER BY amount
    )
FROM
    sales_stats
WHERE
    year = 2018;

```

Here is the output:

![PostgreSQL CUME_DIST Function over a result set example](/postgresqltutorial/PostgreSQL-CUME_DIST-Function-over-a-result-set-example.png)As clearly shown in the output, we can find that 80% of sales employees have sales less than or equal to 150K in 2018\.

### 2\) Using PostgreSQL CUME_DIST() function over a partition example

The following example uses the `CUME_DIST()` function to calculate the sales percentile for each sales employee in 2018 and 2019\.

```sql
SELECT
    name,
	year,
	amount,
    CUME_DIST() OVER (
		PARTITION BY year
        ORDER BY amount
    )
FROM
    sales_stats;

```

Here is the output:

![PostgreSQL CUME_DIST Function over a partition example](/postgresqltutorial/PostgreSQL-CUME_DIST-Function-over-a-partition-example.png)
In this example:

- The `PARTITION BY`clause divided the rows into two partitions by the year 2018 and 2019\.
- The `ORDER BY` clause sorted sales amount of every employee in each partition from high to low to which the `CUME_DIST()` function is applied.

In this tutorial, you have learned how to use the PostgreSQL `CUME_DIST()` function to calculate the cumulative distribution of a value in a group of values.


# DENSE_RANK

---
title: 'PostgreSQL DENSE_RANK Function'
page_title: 'PostgreSQL DENSE_RANK() Function By Practical Examples'
page_description: 'In this tutorial, you are going to learn how to use the PostgreSQL DENSE_RANK() function to assign a rank with no gaps to every row in a result set.'
prev_url: 'index.html'
ogImage: '/postgresqltutorial/PostgreSQL-DENSE_RANK-Function-Sample-Table.png'
updatedOn: '2020-07-10T04:55:06+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL CUME_DIST Function'
  slug: 'postgresql-window-function/postgresql-cume_dist-function'
nextLink:
  title: 'PostgreSQL FIRST_VALUE Function'
  slug: 'postgresql-window-function/postgresql-first_value-function'
---

**Summary**: in this tutorial, you are going to learn how to use the PostgreSQL `DENSE_RANK()` function to assign a rank to each row within a partition of a result set, with no gaps in ranking values.

## Introduction to PostgreSQL DENSE_RANK() function

The `DENSE_RANK()` assigns a rank to every row in each partition of a result set. Different from the `RANK()` function, the `DENSE_RANK()` function always returns consecutive rank values.

For each partition, the `DENSE_RANK()` function returns the same rank for the rows which have the same values

The following shows the syntax of the `DENSE_RANK()` function:

```csssql
DENSE_RANK() OVER (
    [PARTITION BY partition_expression, ... ]
    ORDER BY sort_expression [ASC | DESC], ...
)
```

The `DENSE_RANK()` function is applied to every row in each partition defined by the `PARTITION BY` clause, in the sort order specified by `ORDER BY` clause. It will reset the rank when crossing the partition boundary.

The `PARITION BY` clause is optional. If you skip it, the `DENSE_RANK()` function will treat the whole result set as a single partition.

## PostgreSQL DENSE_RANK() function demo

First, [create a table](../postgresql-tutorial/postgresql-create-table) named `dense_ranks` that has one column:

```php
CREATE TABLE dense_ranks (
	c VARCHAR(10)
);
```

Second, [insert some rows](../postgresql-tutorial/postgresql-insert) into the `dense_ranks` table:

```
INSERT INTO dense_ranks(c)
VALUES('A'),('A'),('B'),('C'),('C'),('D'),('E');
```

Third, [query data](../postgresql-tutorial/postgresql-select) from the `dense_ranks` table:

```sql
SELECT c from dense_ranks;
```

![](/postgresqltutorial/PostgreSQL-DENSE_RANK-Function-Sample-Table.png)
Fourth, use the `DENSE_RANK()` function to assign a rank to each row in the result set:

```
SELECT
	c,
	DENSE_RANK() OVER (
		ORDER BY c
	) dense_rank_number
FROM
	dense_ranks;
```

Here is the output:

![PostgreSQL DENSE_RANK Function example](/postgresqltutorial/PostgreSQL-DENSE_RANK-Function-example.png)

## PostgreSQL DENSE_RANK() function examples

We will use the `products` table to demonstrate the `DENSE_RANK()` function.

![](/postgresqltutorial/products_product_groups_tables.png)

![](/postgresqltutorial/products-table-sample-data.png)

### 1\) Using PostgreSQL DENSE_RANK() function over a result set example

This statement uses the `DENSE_RANK()` function to rank products by list prices:

```
SELECT
	product_id,
	product_name,
	price,
	DENSE_RANK () OVER (
		ORDER BY price DESC
	) price_rank
FROM
	products;
```

Here is the output:

![](/postgresqltutorial/PostgreSQL-DENSE_RANK-Function-over-a-result-set.png)
In this example, we skipped the `PARTITION BY` clause, therefore, the `DENSE_RANK()` function treated the whole result set as a single partition.

The `DENSE_RANK()` function assigned a rank to each product based on the price order from high to low specified by the `ORDER BY` clause.

### 2\) Using PostgreSQL DENSE_RANK() function over partitions example

The following example assigns a rank to every product in each product group:

```
SELECT
	product_id,
	product_name,
	group_id,
	price,
	DENSE_RANK () OVER (
		PARTITION BY group_id
		ORDER BY price DESC
	) price_rank
FROM
	products;
```

This picture shows the output:

![](/postgresqltutorial/PostgreSQL-DENSE_RANK-Function-over-a-partition.png)
In this example, the `PARTITION BY` clause distributed the products into product groups. The `ORDER BY` clause sorted products in each group by their prices from high to low to which the `DENSE_RANK()` function is applied.

### 3\) Using PostgreSQL DENSE_RANK() function with a CTE example

The following statement uses the `DENSE_RANK()` function with a CTE to return the most expensive product in each product group:

```
WITH cte AS(
	SELECT
		product_id,
		product_name,
		group_id,
		price,
		DENSE_RANK () OVER (
			PARTITION BY group_id
			ORDER BY price DESC
		) price_rank
	FROM
		products
)
SELECT
	product_id,
	product_name,
	price
FROM
	cte
WHERE
	price_rank = 1;
```

![PostgreSQL DENSE_RANK Function top rows example](/postgresqltutorial/PostgreSQL-DENSE_RANK-Function-top-rows-example.png)
In this tutorial, you have learned how to use the PostgreSQL `DENSE_RANK()` function to calculate a rank to each row within a partition of a result set, with no gaps in rank values.


# FIRST_VALUE

---
title: 'PostgreSQL FIRST_VALUE Function'
page_title: 'PostgreSQL FIRST_VALUE() Function By Practical Examples'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL FIRST_VALUE() function to return the first value in a sorted partition of a result set.'
prev_url: 'index.html'
ogImage: 'https://www.postgresqltutorial.com//postgresqltutorial/products_product_groups_tables.png'
updatedOn: '2020-07-10T04:55:53+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL DENSE_RANK Function'
  slug: 'postgresql-window-function/postgresql-dense_rank-function'
nextLink:
  title: 'PostgreSQL LAG Function'
  slug: 'postgresql-window-function/postgresql-lag-function'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `FIRST_VALUE()` function to return the first value in a sorted partition of a result set.

## Introduction to PostgreSQL FIRST_VALUE() function

The `FIRST_VALUE()` function returns a value evaluated against the first row in a sorted partition of a result set.

The following is the syntax of the `FIRST_VALUE()` function:

```css
FIRST_VALUE ( expression )
OVER (
    [PARTITION BY partition_expression, ... ]
    ORDER BY sort_expression [ASC | DESC], ...

```

```
FIRST_VALUE ( expression )
OVER (
    [PARTITION BY partition_expression, ... ]
    ORDER BY sort_expression [ASC | DESC], ...
)
```

In this syntax:

### expression

The `expression` can be an expression, column, or subquery evaluated against the value of the first row of a sorted partition of a result set. The `expression` must return a single value. And it cannot be a window function.

### PARTITION BY clause

The `PARTITION BY` clause divides rows in a result set into partitions to which the `FIRST_VALUE()` function is applied.

When you the `PARTITION BY` clause, the `FIRST_VALUE()` function treats the whole result set as a single partition.

### ORDER BY clause

The `ORDER BY` clause specifies the sort order of rows in each partition to which the `FIRST_VALUE()`function is applied.

### rows_range_clause

The `rows_range_clause` further limits the rows within the partition by defining the start and end in the partition

## PostgreSQL FIRST_VALUE() function examples

We will use the `products` table created in the window function tutorial for the demonstration:

![](/postgresqltutorial/products_product_groups_tables.png)The data of the `products` table is as follows:

![](/postgresqltutorial/products-table-sample-data.png)

### 1\) Using PostgreSQL FIRST_VALUE() function over a result set example

The following statement uses the `FIRST_VALUE()` function to return all products and also the product which has the lowest price:

```
SELECT
    product_id,
    product_name,
    group_id,
    price,
    FIRST_VALUE(product_name)
    OVER(
        ORDER BY price
    ) lowest_price
FROM
    products;
```

Here is the result set:

![PostgreSQL FIRST_VALUE Function over a result set](/postgresqltutorial/PostgreSQL-FIRST_VALUE-Function-over-a-result-set.png)
In this example:

- Since we skipped the `PARTITION BY` clause in the `FIRST_VALUE()` function, the function treated the whole result set as a single partition.
- The `ORDER BY` clause sorted products by prices from low to high.
- The `FIRST_VALUE()` function is applied to the whole result set and picked the value in the `product_name` column of the first row.

### 2\) Using FIRST_VALUE() function over a partition example

This statement uses the `FIRST_VALUE()` function to return all products grouped by the product group. And for each product group, it returns the product with the lowest price:

```
SELECT
    product_id,
    product_name,
	group_id,
    price,
    FIRST_VALUE(product_name)
    OVER(
	PARTITION BY group_id
        ORDER BY price
        RANGE BETWEEN
            UNBOUNDED PRECEDING AND
            UNBOUNDED FOLLOWING
    ) lowest_price
FROM
    products;
```

![PostgreSQL FIRST_VALUE Function over partition](/postgresqltutorial/PostgreSQL-FIRST_VALUE-Function-over-partition.png)
In this example:

- The `PARTITION BY` clause distributed products by product group.
- The `ORDER BY` clause sorted products in each product group (partition) by prices from low to high.
- The `RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING` clause defined the frame in each partition, starting from the first row and ending at the last row.
- The `FIRST_VALUE()` function is applied to each partition separately.

In this tutorial, you have learned how to use the PostgreSQL `FIRST_VALUE()` function to return the first value in a sorted partition of a result set.


# LAG

---
title: 'PostgreSQL LAG Function'
page_title: 'PostgreSQL LAG() Function By Practical Examples'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL LAG() function to access a row which comes before the current row at a specific physical offset.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-window-function/postgresql-lag-function/'
ogImage: ''
updatedOn: '2024-02-12T12:08:42+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL FIRST_VALUE Function'
  slug: 'postgresql-window-function/postgresql-first_value-function'
nextLink:
  title: 'PostgreSQL LAST_VALUE Function'
  slug: 'postgresql-window-function/postgresql-last_value-function'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `LAG()` function to access data of the previous row from the current row.

## Introduction to PostgreSQL LAG() function

PostgreSQL `LAG()` function allows you to access data of the previous row from the current row. It can be very useful for comparing the value of the current row with the value of the previous row.

Here’s the basic syntax of the `LAG()` function:

```phpsqlsql
LAG(expression [,offset [,default_value]])
OVER (
    [PARTITION BY partition_expression, ... ]
    ORDER BY sort_expression [ASC | DESC], ...
)

```

In this syntax:

### expression

The `expression` is evaluated against the previous row at a specified offset. It can be a column, expression, or [subquery](../postgresql-tutorial/postgresql-subquery).

The `expression` must return a single value, and cannot be a window function.

### offset

The `offset` is a positive integer that specifies the number of rows that come before the current row from which to access data. The `offset` can be an expression, subquery, or column. It defaults to 1 if you don’t specify it.

### default_value

The `LAG()` function will return the `default_value` in case the `offset` goes beyond the scope of the partition. The function will return NULL if you omit the `default_value`.

### PARTITION BY clause

The `PARTITION BY` clause divides rows into partitions to which the `LAG()` function is applied.

By default, the function will treat the whole result set as a single partition if you omit the `PARTITION BY` clause.

### ORDER BY clause

The `ORDER BY` clause specifies the order of the rows in each partition to which the `LAG()` function is applied.

## PostgreSQL LAG() function examples

We’ll use the `sales` table from the [`LEAD()`](postgresql-lead-function) function tutorial for the demonstration:

```sql
CREATE TABLE sales(
	year SMALLINT CHECK(year > 0),
	group_id INT NOT NULL,
	amount DECIMAL(10,2) NOT NULL,
	PRIMARY KEY(year,group_id)
);

INSERT INTO
	sales(year, group_id, amount)
VALUES
	(2018,1,1474),
	(2018,2,1787),
	(2018,3,1760),
	(2019,1,1915),
	(2019,2,1911),
	(2019,3,1118),
	(2020,1,1646),
	(2020,2,1975),
	(2020,3,1516)
RETURNING *;
```

Here is the data from the `sales` function:

```
 year | group_id | amount
------+----------+---------
 2018 |        1 | 1474.00
 2018 |        2 | 1787.00
 2018 |        3 | 1760.00
 2019 |        1 | 1915.00
 2019 |        2 | 1911.00
 2019 |        3 | 1118.00
 2020 |        1 | 1646.00
 2020 |        2 | 1975.00
 2020 |        3 | 1516.00
(9 rows)
```

### 1\) Using PostgreSQL LAG() function over a result set example

This example uses the `LAG()` function to return the sales amount of the current year and the previous year of the group id 1:

```
SELECT
  year,
  amount,
  LAG(amount, 1) OVER (
    ORDER BY
      year
  ) previous_year_sales
FROM
  sales
WHERE group_id = 1;
```

Output:

```text
 year | amount  | previous_year_sales
------+---------+---------------------
 2018 | 1474.00 |                null
 2019 | 1915.00 |             1474.00
 2020 | 1646.00 |             1915.00
(3 rows)
```

In this example:

- The `WHERE` clause retrieves only the rows with the group id 1\.
- The `LAG()` function returns the sales amount of the previous year from the current year.

Since the sales table has no data for the year before 2018, the `LAG()` function returns NULL.

### 2\) Using PostgreSQL LAG() function over a partition example

The following example uses the `LAG()` function to compare the sales of the current year with the sales of the previous year of each product group:

```sql
SELECT
  year,
  amount,
  group_id,
  LAG(amount, 1) OVER (
    PARTITION BY group_id
    ORDER BY
      year
  ) previous_year_sales
FROM
  sales;
```

Output:

```
 year | amount  | group_id | previous_year_sales
------+---------+----------+---------------------
 2018 | 1474.00 |        1 |                null
 2019 | 1915.00 |        1 |             1474.00
 2020 | 1646.00 |        1 |             1915.00
 2018 | 1787.00 |        2 |                null
 2019 | 1911.00 |        2 |             1787.00
 2020 | 1975.00 |        2 |             1911.00
 2018 | 1760.00 |        3 |                null
 2019 | 1118.00 |        3 |             1760.00
 2020 | 1516.00 |        3 |             1118.00
(9 rows)
```

In this example:

- The `PARTITION BY` clause divides the rows into partitions by the group id.
- The `ORDER BY` clause sorts rows in each product group by years in ascending order.
- The `LAG()` function is applied to each partition to return the sales of the previous year.

## Summary

- Use the PostgreSQL `LAG()` function to access the data of the previous row from the current row.


# LAST_VALUE

---
title: 'PostgreSQL LAST_VALUE Function'
page_title: 'PostgreSQL LAST_VALUE Function By Practical Examples'
page_description: 'In this tutorial, you will learn how to get the last value in an ordered partition of a result set by using the PostgreSQL LAST_VALUE() function.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-window-function/postgresql-last_value-function/'
ogImage: 'https://www.postgresqltutorial.com//postgresqltutorial/products_product_groups_tables.png'
updatedOn: '2024-02-15T02:30:55+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL LAG Function'
  slug: 'postgresql-window-function/postgresql-lag-function'
nextLink:
  title: 'PostgreSQL LEAD Function'
  slug: 'postgresql-window-function/postgresql-lead-function'
---

**Summary**: in this tutorial, you will learn how to get the last value in an ordered partition of a result set by using the PostgreSQL `LAST_VALUE()` function.

## Introduction to PostgreSQL LAST_VALUE() function

The `LAST_VALUE()` function returns the last value in an ordered partition of a result set.

The syntax of the `LAST_VALUE()` function is as follows:

```css
LAST_VALUE ( expression )
OVER (
    [PARTITION BY partition_expression, ... ]
    ORDER BY sort_expression [ASC | DESC], ...
)
```

In this syntax:

### expression

The `expression` can be an expression, column, or [subquery](../postgresql-tutorial/postgresql-subquery) evaluated against the value of the last row in an ordered partition of the result set.

The `expression` must return a single value. Additionally, it cannot be a window function.

### PARTITION BY clause

The `PARTITION BY` clause divides rows of the result set into partitions to which the `LAST_VALUE()` function is applied.

If you omit the `PARTITION BY` clause, the `LAST_VALUE()` function will treat the whole result set as a single partition.

### ORDER BY clause

The `ORDER BY` clause specifies the sort order for rows in each partition to which the `LAST_VALUE()` function is applied.

### frame_clause

The `frame_clause` defines the subset of rows in the current partition to which the `LAST_VALUE()` function is applied.

## PostgreSQL LAST_VALUE() function examples

We will use the `products` table created in the window function tutorial for the demonstration:

![](/postgresqltutorial/products_product_groups_tables.png)Here are the contents of the data of the `products` table:

![](/postgresqltutorial/products-table-sample-data.png)

### 1\) Using PostgreSQL LAST_VALUE() over a result set example

The following example uses the `LAST_VALUE()` function to return all products together with the product that has the highest price:

```
SELECT
    product_id,
    product_name,
    price,
    LAST_VALUE(product_name)
    OVER(
        ORDER BY price
        RANGE BETWEEN
            UNBOUNDED PRECEDING AND
            UNBOUNDED FOLLOWING
    ) highest_price
FROM
    products;
```

![PostgreSQL LAST_VALUE over result set example](/postgresqltutorial/PostgreSQL-LAST_VALUE-over-result-set-example.png)
In this example:

- Since we omit the `PARTITION BY` clause in the `LAST_VALUE()` function, the function treats the whole result set as a single partition.
- The `ORDER BY` clause sorts products by prices from low to high.
- The `LAST_VALUE()` retrieves the product name of the last row in the result set.

### 2\) Using PostgreSQL LAST_VALUE() over a partition example

The following example uses the `LAST_VALUE()` function to return all products together with the most expensive product per product group:

```
SELECT
    product_id,
    product_name,
    group_id,
    price,
    LAST_VALUE(product_name)
    OVER(
	PARTITION BY group_id
        ORDER BY price
        RANGE BETWEEN
            UNBOUNDED PRECEDING AND
            UNBOUNDED FOLLOWING
    ) highest_price
FROM
    products;
```

![PostgreSQL LAST_VALUE over partition example](/postgresqltutorial/PostgreSQL-LAST_VALUE-over-partition-example.png)
In this example:

- The `PARTITION BY` clause divides rows by group id into three partitions specified by group id 1, 2, and 3\.
- The `ORDER BY` clause sorts products in each product group ( or partition) from low to high.
- The `RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING` clause defines the frame starting from the first row and ending at the last row of each partition.
- The `LAST_VALUE()` function applies to each partition separately and returns the product name of the last row in each partition.

## Summary

- Use the PostgreSQL `LAST_VALUE()` window function to return the last value in an ordered partition of a result set.


# LEAD

---
title: 'PostgreSQL LEAD Function'
page_title: 'PostgreSQL LEAD() Function By Practical Examples'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL LEAD() function to access a row that follows the current row, at a specific physical offset.'
prev_url: 'index.html'
ogImage: '/postgresqltutorial/Sales-sample-table.png'
updatedOn: '2020-04-11T10:53:00+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL LAST_VALUE Function'
  slug: 'postgresql-window-function/postgresql-last_value-function'
nextLink:
  title: 'PostgreSQL NTILE Function'
  slug: 'postgresql-window-function/postgresql-ntile-function'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `LEAD()` function to access a row that follows the current row, at a specific physical offset.

## Introduction to PostgreSQL LEAD() function

PostgreSQL `LEAD()` function provide access to a row that follows the current row at a specified physical offset.

It means that from the current row, the `LEAD()` function can access data of the next row, the row after the next row, and so on.

The `LEAD()` function is very useful for comparing the value of the current row with the value of the row that following the current row.

The following illustrates the syntax of `LEAD()` function:

```sql
LEAD(expression [,offset [,default_value]])
OVER (
    [PARTITION BY partition_expression, ... ]
    ORDER BY sort_expression [ASC | DESC], ...
)

```

In this syntax:

### expression

The `expression` is evaluated against the following row based on a specified offset from the current row. The `expression` can be a column, expression, [subquery](../postgresql-tutorial/postgresql-subquery) that must evaluate to a single value. And it cannot be a window function.

### offset

The `offset` is a positive integer that specifies the number of rows forwarding from the current row from which to access data. The `offset` can be an expression, subquery, or column.

The offset defaults to 1 if you don’t specify it.

### default_value

The `default_value` is the return value if the `offset` goes beyond the scope of the partition. The `default_value` defaults to NULL if you omit it.

### PARTITION BY clause

The `PARTITION BY` clause divides rows into partitions to which the `LEAD()` function is applied.

By default, the whole result set is a single partition if you omit the `PARTITION BY` clause.

### ORDER BY clause

The `ORDER BY` clause specifies the sort order of the rows in each partition to which the `LEAD()` function is applied.

## PostgreSQL LEAD() function examples

Let’s set up a new table for the demonstration.

First, [create a new table](../postgresql-tutorial/postgresql-create-table) named `sales`:

```sql
CREATE TABLE sales(
	year SMALLINT CHECK(year > 0),
	group_id INT NOT NULL,
	amount DECIMAL(10,2) NOT NULL,
	PRIMARY KEY(year,group_id)
);

```

Second, [insert](../postgresql-tutorial/postgresql-insert) some rows into the `sales` table:

```sql
INSERT INTO
	sales(year, group_id, amount)
VALUES
	(2018,1,1474),
	(2018,2,1787),
	(2018,3,1760),
	(2019,1,1915),
	(2019,2,1911),
	(2019,3,1118),
	(2020,1,1646),
	(2020,2,1975),
	(2020,3,1516);

```

Third, query data from the `sales` table:

```sql
SELECT * FROM sales;
```

![Sales sample table](/postgresqltutorial/Sales-sample-table.png)

### 1\) Using PostgreSQL LEAD() function over a result set examples

The following query returns the total sales amount by year:

```sql
SELECT
	year,
	SUM(amount)
FROM sales
GROUP BY year
ORDER BY year;

```

![PostgreSQL LEAD Function - Sales by years](/postgresqltutorial/PostgreSQL-LEAD-Function-Sales-by-years.png)
This example uses the `LEAD()` function to return the sales amount of the current year and the next year:

```sql
WITH cte AS (
	SELECT
		year,
		SUM(amount) amount
	FROM sales
	GROUP BY year
	ORDER BY year
)
SELECT
	year,
	amount,
	LEAD(amount,1) OVER (
		ORDER BY year
	) next_year_sales
FROM
	cte;

```

Here is the output:

![PostgreSQL LEAD Function over a result set example](/postgresqltutorial/PostgreSQL-LEAD-Function-over-a-result-set-example.png)
In this example:

- First, the [CTE](../postgresql-tutorial/postgresql-cte) returns the sales summarized by year.
- Then, the outer query uses the `LEAD()` function to return the sales of the following year for each row.

The following example uses two common table expressions to return the sales variance between the current year and the next:

```sql
WITH cte AS (
	SELECT
		year,
		SUM(amount) amount
	FROM sales
	GROUP BY year
	ORDER BY year
), cte2 AS (
	SELECT
		year,
		amount,
		LEAD(amount,1) OVER (
			ORDER BY year
		) next_year_sales
	FROM
		cte
)
SELECT
	year,
	amount,
	next_year_sales,
	(next_year_sales - amount) variance
FROM
	cte2;

```

![PostgreSQL LEAD Function over result set example](/postgresqltutorial/PostgreSQL-LEAD-Function-over-result-set-example-2.png)

### 2\) Using PostgreSQL LEAD() function over a partition example

The following statement uses the `LEAD()` function to compare the sales of the current year with sales of the next year for each product group:

```sql
SELECT
	year,
	amount,
	group_id,
	LEAD(amount,1) OVER (
		PARTITION BY group_id
		ORDER BY year
	) next_year_sales
FROM
	sales;

```

This picture shows the output:

![PostgreSQL LEAD Function over a partition example](/postgresqltutorial/PostgreSQL-LEAD-Function-over-a-partition-example.png)
In this example:

- The `PARTITION BY` clause distributes rows into product groups (or partitions) specified by group id.
- The `ORDER BY` clause sorts rows in each product group by years in ascending order.
- The `LEAD()` function returns the sales of the next year from the current year for each product group.

In this tutorial, you have learned how to use the PostgreSQL `LEAD()` function to access a row at a specific physical offset which follows the current row.


# NTILE

---
title: 'PostgreSQL NTILE Function'
page_title: 'PostgreSQL NTILE Function By Practical Examples'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL NTILE() function to divide ordered rows in the partition into a specified number of ranked buckets.'
prev_url: 'index.html'
ogImage: '/postgresqltutorial/sales_stats-table.png'
updatedOn: '2020-04-11T10:53:00+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL LEAD Function'
  slug: 'postgresql-window-function/postgresql-lead-function'
nextLink:
  title: 'PostgreSQL NTH_VALUE Function'
  slug: 'postgresql-window-function/postgresql-nth_value-function'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `NTILE()` function to divide ordered rows in the partition into a specified number of ranked buckets.

## Introduction to PostgreSQL NTILE() function

The PostgreSQL `NTILE()` function allows you to divide ordered rows in the partition into a specified number of ranked groups as equal size as possible. These ranked groups are called buckets.

The `NTILE()` function assigns each group a bucket number starting from 1\. For each row in a group, the `NTILE()` function assigns a bucket number representing the group to which the row belongs.

The syntax of the `NTILE()` function is as follows:

```sql
NTILE(buckets) OVER (
    [PARTITION BY partition_expression, ... ]
    [ORDER BY sort_expression [ASC | DESC], ...]
)

```

Let’s examine the syntax in detail:

### buckets

The `buckets` represents the number of ranked groups. It can be a number or an expression that evaluates to a positive integer value (greater than 0\) for each partition. The `buckets` must not be nullable.

### PARTITION BY

The `PARTITION BY` clause distributes rows into partitions to which the function is applied.

The `PARTITION BY` clause is optional. If you skip it, the function treats the whole result set as a single partition.

### ORDER BY

The `ORDER BY` clause sorts rows in each partition to which the function is applied.

The `ORDER BY` clause is optional. However, you should always use the `ORDER BY` clause to get an expected result.

Note that if the number of rows is not divisible by the `buckets`, the `NTILE()` function returns groups of two sizes with the difference by one. The bigger groups always come before the smaller groups in the order specified by the `ORDER BY` clause.

## PostgreSQL NTILE() function examples

Let’s take some examples of using the `NTILE()` function.

We’ll use the `sales_stats` table created in the [`CUME_DIST()`](postgresql-cume_dist-function) function tutorial to demonstrate the `NTILE()` function.

```sql
SELECT
	year,
	name,
	amount
FROM
	actual_sales
ORDER BY
	year, name;
```

![sales_stats table](/postgresqltutorial/sales_stats-table.png)

### 1\) Using PostgreSQL NTILE() function over a result set example

This example uses the `NTILE()` function to distribute rows into 3 buckets:

```sql
SELECT
	name,
	amount,
	NTILE(3) OVER(
		ORDER BY amount
	)
FROM
	sales_stats
WHERE
	year = 2019;

```

Here is the output:

![PostgreSQL NTILE Function Over a Result Set Example](/postgresqltutorial/PostgreSQL-NTILE-Function-Over-a-Result-Set-Example.png)

### 2\) Using PostgreSQL NTILE() function over a partition example

This example uses the `NTILE()` function to divide rows in the `sales_stats` table into two partitions and 3 buckets for each:

```sql
SELECT
	name,
	amount,
	NTILE(3) OVER(
		PARTITION BY year
		ORDER BY amount
	)
FROM
	sales_stats;

```

Here is the result set:

![PostgreSQL NTILE Function Over a Partition Example](/postgresqltutorial/PostgreSQL-NTILE-Function-Over-a-Partition-Example.png)
In this tutorial, you have learned how to use the PostgreSQL `NTILE()` function to distribute ordered rows within a partition into a specified number of ranked groups.


# NTH_VALUE

---
title: 'PostgreSQL NTH_VALUE Function'
page_title: 'PostgreSQL NTH_VALUE() Function By Practical Examples'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL NTH_VALUE() function to get a value from the nth row in a result set.'
prev_url: 'index.html'
ogImage: 'https://www.postgresqltutorial.com//postgresqltutorial/products-table-sample-data.png'
updatedOn: '2020-04-11T10:53:01+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL NTILE Function'
  slug: 'postgresql-window-function/postgresql-ntile-function'
nextLink:
  title: 'PostgreSQL PERCENT_RANK Function'
  slug: 'postgresql-window-function/postgresql-percent_rank-function'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `NTH_VALUE()` function to get a value from the nth row in a result set.

## Introduction to PostgreSQL NTH_VALUE() function

The `NTH_VALUE()` function returns a value from the nth row in an ordered partition of a result set.

Here is the syntax of the `NTH_VALUE()` function:

```sql
NTH_VALUE(expression, offset)
OVER (
    [PARTITION BY partition_expression]
    [ ORDER BY sort_expression [ASC | DESC]
    frame_clause ]
)

```

Let’s examine the syntax of the `NTH_VALUE()` function in detail.

### expression

The `expression` is the target column or expression on which the `NTH_VALUE()` function operates.

### offset

The `offset` is a positive integer (greater than zero) that determines the row number relative to the first row in the window against which the expression evaluates.

### PARTITION BY partition_expression

The `PARTITION BY` clause distributes rows of the result set into partitions to which the `NTH_VALUE()` function applies.

### ORDER BY sort_expression

The `ORDER BY` clause sorts rows in each partition to which the function is applied.

### frame clause

The `frame_clause` defines the subset (or the frame) of the current partition.

## PostgreSQL NTH_VALUE() function examples

We will use the `products` table created in the window functions tutorial for the demonstration.

![](/postgresqltutorial/products-table-sample-data.png)

### 1\) Using PostgreSQL NTH_VALUE() function over the result set example

This example uses the `NTH_VALUE()` function to return all products together with the second most expensive product:

```sql
SELECT
    product_id,
    product_name,
    price,
    NTH_VALUE(product_name, 2)
    OVER(
        ORDER BY price DESC
        RANGE BETWEEN
            UNBOUNDED PRECEDING AND
            UNBOUNDED FOLLOWING
    )
FROM
    products;

```

Here is the output:

![PostgreSQL NTH_VALUE function over a result set example](/postgresqltutorial/PostgreSQL-NTH_VALUE-function-over-a-result-set-example.png)
In this example:

- The `ORDER BY` clause sorted all products by prices from high to low
- The frame clause defined the frame start at the beginning row and end at the ending row of the result set.
- The `NTH_VALUE()` function return value in the product_name column of the second row of the result set after sorting and framing.

### 2\) Using PostgreSQL NTH_VALUE() function over a partition example

This example uses the `NTH_VALUE()` function to return all products with the second most expensive product for each product group:

```sql
SELECT
    product_id,
    product_name,
    price,
    group_id,
    NTH_VALUE(product_name, 2)
    OVER(
        PARTITION BY group_id
        ORDER BY price DESC
        RANGE BETWEEN
            UNBOUNDED PRECEDING AND
            UNBOUNDED FOLLOWING
    )
FROM
    products;

```

The following picture illustrates the output:

![PostgreSQL NTH_VALUE function over a partition example](/postgresqltutorial/PostgreSQL-NTH_VALUE-function-over-a-partition-example.png)
In this example,

- The `PARTITION BY` clause to distributed products into product groups (or partitions) specified by the values in the `group_id` column.
- The `ORDER BY` clause sorted the products in each product group from high to low.
- The frame clause defined the whole partition as a frame.
- And the `NTH_VALUE()` function returns the product name of the 2nd row of each product group.

Now, you should how to use the PostgreSQL `NTH_VALUE()` function to get a value from the nth row of a result set.


# PERCENT_RANK

---
title: 'PostgreSQL PERCENT_RANK Function'
page_title: 'PostgreSQL PERCENT_RANK() Function By Practical Examples'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL PERCENT_RANK() function to calculate the relative rank of a value within a set of values.'
prev_url: 'index.html'
ogImage: '/postgresqltutorial/sales_stats-table.png'
updatedOn: '2020-04-11T10:53:00+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL NTH_VALUE Function'
  slug: 'postgresql-window-function/postgresql-nth_value-function'
nextLink:
  title: 'PostgreSQL RANK Function'
  slug: 'postgresql-window-function/postgresql-rank-function'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `PERCENT_RANK()` function to calculate the relative rank of a value within a set of values.

## Introduction to PostgreSQL PERCENT_RANK() function

The `PERCENT_RANK()` function is like the `CUME_DIST()` function. The `PERCENT_RANK()` function evaluates the relative standing of a value within a set of values.

The following illustrates the syntax of the `PERCENT_RANK()` function:

```sql
PERCENT_RANK() OVER (
    [PARTITION BY partition_expression, ... ]
    ORDER BY sort_expression [ASC | DESC], ...
)

```

In this syntax:

### PARTITION BY

The `PARTITION BY` clause divides rows into multiple partitions to which the `PERCENT_RANK()` function is applied.

The `PARTITION BY` clause is optional. If you omit it, the function treats the whole result set as a single partition.

### ORDER BY

The `ORDER BY` clause specifies the order of rows in each partition to which the function is applied.

### Return value

The `PERCENT_RANK()` function returns a result that is greater than 0 and less than or equal to 1\.

```sql
0 < PERCENT_RANK() <= 1

```

The first value always receives a rank of zero. Tie values evaluate to the same cumulative distribution value.

## PostgreSQL PERCENT_RANK() examples

We will use the `sales_stats` table created in the `CUME_DIST()` function tutorial for the demonstration.

```sql
SELECT
	year,
	name,
	amount
FROM
	actual_sales
ORDER BY
	year, name;
```

![sales_stats table](/postgresqltutorial/sales_stats-table.png)

### 1\) Using PostgreSQL PERCENT_RANK() function over a result set example

The following example uses the `PERCENT_RANK()` function to calculate the sales percentile of each employee in 2019:

```sql
SELECT
    name,
	amount,
    PERCENT_RANK() OVER (
        ORDER BY amount
    )
FROM
    sales_stats
WHERE
    year = 2019;

```

Here is the output:

![PostgreSQL PERCENT_RANK Function Over a Result Set example](/postgresqltutorial/PostgreSQL-PERCENT_RANK-Function-Over-a-Result-Set-example.png)

### 2\) Using PostgreSQL PERCENT_RANK() function over a partition example

This statement uses the `PERCENT_RANK()` function to calculate the sales amount percentile by sales employees in both 2018 and 2019\.

```sql
SELECT
    name,
	amount,
    PERCENT_RANK() OVER (
		PARTITION BY year
        ORDER BY amount
    )
FROM
    sales_stats;

```

Here is the output:

![PostgreSQL PERCENT_RANK Function Over a Partition example](/postgresqltutorial/PostgreSQL-PERCENT_RANK-Function-Over-a-Partition-example.png)
In this example:

- The `PARTITION BY`clause distributed the rows in the `sales_stats` table into two partitions, one for 2018 and the other for 2019\.
- The `ORDER BY` clause sorted rows in each partition by sales amount.
- The `PERCENT_RANK()` function is applied to each ordered partition to calculate the percent rank.

In this tutorial, you have learned how to use the PostgreSQL `PERCENT_RANK()` function to calculate the relative rank of a value within a set of values.


# RANK

---
title: 'PostgreSQL RANK Function'
page_title: 'PostgreSQL RANK() Function By Practical Examples'
page_description: 'In this tutorial, you will learn how to use PostgreSQL RANK() function to assign a rank for every row of a result set.'
prev_url: 'index.html'
ogImage: '/postgresqltutorial/PostgreSQL-RANK-function-sample-table.png'
updatedOn: '2020-07-10T04:57:36+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL PERCENT_RANK Function'
  slug: 'postgresql-window-function/postgresql-percent_rank-function'
nextLink:
  title: 'PostgreSQL ROW_NUMBER Function'
  slug: 'postgresql-window-function/postgresql-row_number'
---

**Summary**: in this tutorial, you will learn how to use PostgreSQL `RANK()` function to assign a rank for every row of a result set.

## Introduction to PostgreSQL RANK() function

The `RANK()` function assigns a rank to every row within a partition of a result set.

For each partition, the rank of the first row is 1\. The `RANK()` function adds the number of tied rows to the tied rank to calculate the rank of the next row, so the ranks may not be sequential. In addition, rows with the same values will get the same rank.

The following illustrates the syntax of the `RANK()` function:

```csssql
RANK() OVER (
    [PARTITION BY partition_expression, ... ]
    ORDER BY sort_expression [ASC | DESC], ...
)
```

In this syntax:

- First, the `PARTITION BY` clause distributes rows of the result set into partitions to which the `RANK()` function is applied.
- Then, the `ORDER BY` clause specifies the order of rows in each a partition to which the function is applied.

The `RANK()` function can be useful for creating top\-N and bottom\-N reports.

## PostgreSQL RANK() function demo

First, [create a new table](../postgresql-tutorial/postgresql-create-table) named `ranks` that contains one column:

```
CREATE TABLE ranks (
	c VARCHAR(10)
);
```

Second, [insert some rows](../postgresql-tutorial/postgresql-insert) into the `ranks` table:

```
INSERT INTO ranks(c)
VALUES('A'),('A'),('B'),('B'),('B'),('C'),('E');
```

Third, query data from the `ranks` table:

```
SELECT
	c
FROM
	ranks;
```

![PostgreSQL RANK function - sample table](/postgresqltutorial/PostgreSQL-RANK-function-sample-table.png)
Fourth, use the `RANK()` function to assign ranks to the rows in the result set of `ranks` table:

```
SELECT
	c,
	RANK () OVER (
		ORDER BY c
	) rank_number
FROM
	ranks;
```

The following picture shows the output:

![](/postgresqltutorial/PostgreSQL-RANK-function-example.png)As you can see clearly from the output:

- The first and second rows receive the same rank because they have the same value `A`.
- The third, fourth, and fifth rows receive the rank 3 because the `RANK()` function skips the rank 2 and all of them have the same values `B`.

## PostgreSQL RANK() function examples

We’ll use the `products` table to demonstrate the `RANK()` function:

![](/postgresqltutorial/products_product_groups_tables.png)
This picture shows the data of the `products` table:

![](/postgresqltutorial/products-table-sample-data.png)

### 1\) Using PostgreSQL RANK() function for the whole result set

This example uses the `RANK()` function to assign a rank to each product by its price:

```
SELECT
	product_id,
	product_name,
	price,
	RANK () OVER (
		ORDER BY price DESC
	) price_rank
FROM
	products;
```

![PostgreSQL RANK function over the result set](/postgresqltutorial/PostgreSQL-RANK-function-over-the-result-set.png)
In this example, we omitted the `PARTITION BY` clause, therefore, the `RANK()` function treated the whole result set as a single partition.

The `RANK()` function calculated a rank for each row within the whole result set sorted by prices from high to low.

### 2\) Using PostgreSQL RANK() function with PARTITION BY clause example

The following example uses the `RANK()` function to assign a rank to every product in each product group:

```
SELECT
	product_id,
	product_name,
	group_name,
	price,
	RANK () OVER (
		PARTITION BY p.group_id
		ORDER BY price DESC
	) price_rank
FROM
	products p
	INNER JOIN product_groups g
		ON g.group_id = p.group_id;
```

![PostgreSQL RANK function over partition](/postgresqltutorial/PostgreSQL-RANK-function-over-partition.png)
In this example:

- First, the `PARTITION BY` clause distributes products into partitions grouped by product group id (`group_id`).
- Second, the `ORDER BY` clause sort products in each partition by their prices from high to low.

The `RANK()` function was applied to every product in each product group and it is reinitialized when the product group changed.

In this tutorial, you have learned how to use the PostgreSQL `RANK()` function to calculate a rank for every row in a partition of a result set.


# ROW_NUMBER

---
title: 'PostgreSQL ROW_NUMBER Function'
page_title: 'PostgreSQL ROW_NUMBER() Explained with Practical Examples'
page_description: 'In this tutorial, you will learn how to use the PostgreSQL ROW_NUMBER function to assign a unique integer value to each row in a result set.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-window-function/postgresql-row_number/'
ogImage: '/postgresqltutorial/products_product_groups_tables.png'
updatedOn: '2024-02-01T15:58:59+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL RANK Function'
  slug: 'postgresql-window-function/postgresql-rank-function'
nextLink:
  title: 'PostgreSQL JSON Functions'
  slug: 'postgresql-window-function/../postgresql-json-functions'
---

**Summary**: in this tutorial, you will learn how to use the PostgreSQL `ROW_NUMBER()` function to assign a unique integer value to each row in a result set.

## Introduction to the PostgreSQL ROW_NUMBER() function

The `ROW_NUMBER()` function is a window function that assigns a sequential integer to each row in a result set.

The following illustrates the syntax of the `ROW_NUMBER()` function:

```sql
ROW_NUMBER() OVER(
    [PARTITION BY column_1, column_2,…]
    [ORDER BY column_3,column_4,…]
)
```

The set of rows on which the `ROW_NUMBER()` function operates is called a window.

The `PARTITION BY` clause divides the window into smaller sets or partitions. If you specify the `PARTITION BY` clause, the row number for each partition starts with one and increments by one.

Because the `PARTITION BY` clause is optional to the `ROW_NUMBER()` function, therefore you can omit it, and `ROW_NUMBER()` function will treat the whole window as a partition.

The `ORDER BY` clause inside the `OVER` clause determines the order in which the numbers are assigned.

## PostgreSQL ROW_NUMBER() function examples

We will use the `products` table created in the PostgreSQL window function tutorial to demonstrate the functionality of the `ROW_NUMBER()` function.

![products_product_groups_tables](/postgresqltutorial/products_product_groups_tables.png)The following shows the data in the `products` table:

![](/postgresqltutorial/products-table-data.png)
See the following query.

```sql
SELECT
  product_id,
  product_name,
  group_id,
  ROW_NUMBER () OVER (
    ORDER BY
      product_id
  )
FROM
  products;
```

![](/postgresqltutorial/PostgreSQL-ROW_NUMBER-example.png)
Because we did not use the `PARTITION BY` clause, the `ROW_NUMBER()` function considers the whole result set as a partition.

The `ORDER BY` clause sorts the result set by `product_id`, therefore, the `ROW_NUMBER()` function assigns integer values to the rows based on the  `product_id` order.

In the following query, we change the column in the `ORDER BY` clause to product_name, the `ROW_NUMBER()` function assigns the integer values to each row based on the product name order.

```sql
SELECT
  product_id,
  product_name,
  group_id,
  ROW_NUMBER () OVER (
    ORDER BY
      product_name
  )
FROM
  products;
```

![PostgreSQL ROW_NUMBER order by product name](/postgresqltutorial/PostgreSQL-ROW_NUMBER-order-by-product-name.png)
In the following query, we use the `PARTITION BY` clause to divide the window into subsets based on the values in the  `group_id` column. In this case, the `ROW_NUMBER()` function assigns one to the starting row of each partition and increases by one for the next row within the same partition.

The `ORDER BY` clause sorts the rows in each partition by the values in the `product_name` column.

```sql
SELECT
  product_id,
  product_name,
  group_id,
  ROW_NUMBER () OVER (
    PARTITION BY group_id
    ORDER BY
      product_name
  )
FROM
  products;
```

![PostgreSQL ROW_NUMBER with PARTITION example](/postgresqltutorial/PostgreSQL-ROW_NUMBER-with-PARTITION-example.png)

## PostgreSQL ROW_NUMBER() function and DISTINCT operator

The following query uses the `ROW_NUMBER()` function to assign integers to the [distinct](../postgresql-tutorial/postgresql-select-distinct) prices from the `products` table.

```sql
SELECT
  DISTINCT price,
  ROW_NUMBER () OVER (
    ORDER BY
      price
  )
FROM
  products
ORDER BY
  price;
```

![PostgreSQL ROW_NUMBER and DISTINCT](/postgresqltutorial/PostgreSQL-ROW_NUMBER-and-DISTINCT.png)
However, the result is not expected because it includes duplicate prices. The reason is that the `ROW_NUMBER()` operates on the result set before the `DISTINCT` is applied.

To solve this problem, we can get a list of distinct prices in a CTE, then apply the `ROW_NUMBER()` function in the outer query as follows:

```sql
WITH prices AS (
  SELECT
    DISTINCT price
  FROM
    products
)
SELECT
  price,
  ROW_NUMBER () OVER (
    ORDER BY
      price
  )
FROM
  prices;
```

![PostgreSQL ROW_NUMBER and CTE](/postgresqltutorial/PostgreSQL-ROW_NUMBER-and-CTE.png)
Or we can use a [subquery](../postgresql-tutorial/postgresql-subquery) in the `FROM` clause to get a list of unique prices, and then apply the `ROW_NUMBER()` function in the outer query.

```sql
SELECT
  price,
  ROW_NUMBER () OVER (
    ORDER BY
      price
  )
FROM
  (
    SELECT
      DISTINCT price
    FROM
      products
  ) prices;
```

![PostgreSQL ROW_NUMBER and subquery](/postgresqltutorial/PostgreSQL-ROW_NUMBER-and-subquery.png)

## Using the ROW_NUMBER() function for pagination

In application development, you use the pagination technique for displaying a subset of rows instead of all rows in a table.

Besides using the [LIMIT](../postgresql-tutorial/postgresql-limit) clause, you can use the `ROW_NUMBER()` function for the pagination.

For example, the following query selects the five rows starting at row number 6:

```sql
SELECT
  *
FROM
  (
    SELECT
      product_id,
      product_name,
      price,
      ROW_NUMBER () OVER (
        ORDER BY
          product_name
      )
    FROM
      products
  ) x
WHERE
  ROW_NUMBER BETWEEN 6 AND 10;
```

![PostgreSQL ROW_NUMBER with pagination](/postgresqltutorial/PostgreSQL-ROW_NUMBER-with-pagination.png)

## Using the ROW_NUMBER() function for getting the nth highest / lowest row

For example, to get the third most expensive products, first, we get the distinct prices from the products table and select the price whose row number is 3\. Then, in the outer query, we get the products with the price that equals the 3rd highest price.

```sql
SELECT
  *
FROM
  products
WHERE
  price = (
    SELECT
      price
    FROM
      (
        SELECT
          price,
          ROW_NUMBER () OVER (
            ORDER BY
              price DESC
          ) nth
        FROM
          (
            SELECT
              DISTINCT (price)
            FROM
              products
          ) prices
      ) sorted_prices
    WHERE
      nth = 3
  );
```

![PostgreSQL ROW_NUMBER nth highest lowest example](/postgresqltutorial/PostgreSQL-ROW_NUMBER-nth-highest-lowest-example.png)

## Summary

- Use the PostgreSQL `ROW_NUMBER()` function to assign integer values to rows in a result set.


# API

# PostgreSQL C#

---
title: 'PostgreSQL C#'
page_title: 'PostgreSQL C#'
page_description: 'This page shows how to manipulate data in a PostgreSQL database from C# applications using ADO.NET.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-csharp/'
ogImage: ''
updatedOn: '2024-05-21T12:42:32+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL JDBC: Managing Transactions'
  slug: 'postgresql-jdbc/transaction'
nextLink:
  title: 'PostgreSQL C#: Connecting the PostgreSQL Database'
  slug: 'postgresql-csharp/postgresql-csharp-connect'
---

This page shows how to manipulate data in a PostgreSQL database from C\# applications using ADO.NET.

## Section 1\. Getting Started

This section helps you get started by showing you how to install the PostgreSQL driver for ADO.NET, connect to a PostgreSQL database, and create new tables

- [Connecting to a PostgreSQL database](postgresql-csharp/postgresql-csharp-connect) – Learn how to install a Npgsql .NET Data provider and connect to a PostgreSQL database from a C\# program.
- [Creating new tables](postgresql-csharp/postgresql-csharp-create-table) – Show how to create new tables in a PostgreSQL database from a C\# program.

## Section 2\. Performing Common Database Operations

This section shows you how to perform common database operations such as inserting, updating, deleting, and retrieving data.

- [Inserting data into a table](postgresql-csharp/postgresql-csharp-insert) – Learn how to insert a new row into a table in a PostgreSQL database from a C\# program.
- [Import a CSV file into a table](postgresql-csharp/postgresql-csharp-import-csv-file) – Show you how to load data from a CSV file into a table in a PostgreSQL database using ADO.NET.
- [Updating data](postgresql-csharp/postgresql-csharp-update) – Show you how to update data in a table in a PostgreSQL database from a C\# program.
- [Deleting data](postgresql-csharp/postgresql-csharp-delete) – Discuss how to delete data from a table in a PostgreSQL database from a C\# program.
- [Querying data](postgresql-csharp/postgresql-csharp-select) – Show you how to query one or more rows from a table in a PostgreSQL database from a C\# program.

## Section 3\. Transactions

This section guides you on how to perform a PostgreSQL database transaction in C\# program

- [Transaction](postgresql-csharp/postgresql-csharp-transaction) – Learn to perform a database transaction in PostgreSQL database using C\#.

## Section 4\. Calling PostgreSQL functions and stored procedure

This section shows you how to call PostgreSQL functions and stored procedures from C\# programs.

- [Calling a PostgreSQL Function](postgresql-csharp/postgresql-csharp-call-postgresql-function) – Show you how to call a PostgreSQL function from a C\# program.
- [Calling a Stored Procedure](postgresql-csharp/postgresql-csharp-call-a-stored-procedure) – Guide you on calling a stored procedure using C\#.


# Connect to Database Using C#

---
title: 'PostgreSQL C#: Connecting the PostgreSQL Database'
page_title: 'PostgreSQL C#: Connecting to the PostgreSQL database'
page_description: 'Learn how to create a sample database in PostgreSQL and how to connect to the database from a C# program using ADO.NET'
prev_url: 'https://www.postgresqltutorial.com/postgresql-csharp/postgresql-csharp-connect/'
ogImage: '/postgresqltutorial/PostgreSQL-C-Connect.png'
updatedOn: '2024-05-21T00:35:17+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL C#'
  slug: 'postgresql-csharp/'
nextLink:
  title: 'PostgreSQL C#: Creating Tables'
  slug: 'postgresql-csharp/postgresql-csharp-create-table'
---

**Summary**: in this tutorial, you will learn how to create a sample database in PostgreSQL and how to connect to the database from a C\# program using ADO.NET

## Create a sample database

First, open a terminal and [connect to the PostgreSQL database server](../postgresql-getting-started/connect-to-postgresql-database):

```plaintextsql
psql -U postgres
```

It’ll prompt you to enter a password for the postgres user.

Second, [create a new database](../postgresql-administration/postgresql-create-database) called `elearning`:

```sql
CREATE DATABASE elearning;
```

Third, change the current database to `elearning`:

```text
\c elearning
```

Fourth, [create a new role](../postgresql-administration/postgresql-roles) (user) with the name `ed`:

```
CREATE ROLE ed WITH LOGIN PASSWORD 'YourPassword';
```

Note that you need to replace the `YourPassword` with your actual password and keep it for setting up the connection string later.

Fifth, [grant all privileges](../postgresql-administration/postgresql-grant) of the `elearning` database to the `ed` user:

```sql
GRANT ALL PRIVILEGES ON SCHEMA public
TO ed;
```

Finally, exit the psql database:

```sql
exit
```

## Create a new C\# Project

First, launch Visual Studio.

Second, create a Console App with the name `ELearning`.

Third, install the following Nuget packages:

```cs
dotnet add package Microsoft.Extensions.Configuration
dotnet add package Microsoft.Extensions.Configuration.Json
dotnet add package Npgsql
```

- The `Npgsql` is a .NET data provider for PostgreSQL.
- The `Microsoft.Extensions`.Configuration and `Microsoft.Extensions`.`Configuration.Json` are packages that manage configurations.

Fourth, create `appsettings.json` file in the project and add the `ConnnectionStrings` setting as follows:

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=localhost;Database=elearning;User Id=ed;Password=YourPassword;"
  }
}
```

In the `appsettings.json` file, add the connection string that connects to the local PostgreSQL server, `elearning` database using the `ed` user with your selected password.

Fifth, right\-click the `appsettings.json` file, choose the **Properties…** and change the **Copy to Output Directory** to **“Copy if Newer”**:

![PostgreSQL C# Connect](/postgresqltutorial/PostgreSQL-C-Connect.png)Sixth, create a new `ConfigurationHelper.cs` file and define the `ConfigurationHelper` class with the following code:

```cs
using Microsoft.Extensions.Configuration;

public static class ConfigurationHelper
{
    private static readonly IConfiguration _configuration;

    static ConfigurationHelper()
    {
        var builder = new ConfigurationBuilder()
            .SetBasePath(Directory.GetCurrentDirectory())
            .AddJsonFile("appsettings.json", optional: false, reloadOnChange: true);

        _configuration = builder.Build();
    }

    public static string GetConnectionString(string name)
    {
        var connectionString = _configuration.GetConnectionString(name);
        if (string.IsNullOrEmpty(connectionString))
        {
            throw new InvalidOperationException($"The connection string '{name}' has not been initialized.");
        }
        return connectionString;
    }
}
```

The `ConfigurationHelper` reads the `appsettings.json` file and returns the connection string from the `GetConnectionString()` method.

Seventh, add the following code to the `Program.cs` to connect to the PostgreSQL server:

```cs
using Npgsql;

// Get the connection string
string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");


// Connect to the PostgreSQL server
await using var conn = new NpgsqlConnection(connectionString);
await conn.OpenAsync();

Console.WriteLine($"The PostgreSQL version: {conn.PostgreSqlVersion}");
```

Finally, run the program.

If everything is fine, you should see the PostgreSQL server version on the screen.

## How the Program.cs file works

First, import the `Npgsql` namespace that allows you to use the classes provided by `Npgsql` to interact with the PostgreSQL database:

```cs
using Npgsql;
```

Second, get the connection string by calling the `GetConnectionString` from the `ConfigurationHelper` class:

```cs
string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");
```

Third, create a `NpgsqlConnection` object that represents a connection to the PostgreSQL database with the provided connection string:

```cs
await using var conn = new NpgsqlConnection(connectionString);
```

The `using` statement automatically closes the database connection when it goes out of scope.

It’s important to close a connection where it is no longer needed. If you do not close it, you’ll encounter a connection leak, which may crash your program.

Fourth, open a connection to the PostgreSQL Server by calling the `OpenAsync()` method:

```cs
await conn.OpenAsync();
```

Finally, display the PostgreSQL server version by accessing the `PostgreSqlVersion` property of the `NpgsqlConnection` object:

```cs
Console.WriteLine($"The PostgreSQL version: {conn.PostgreSqlVersion}");
```

## Data source

Npgsql 7\.0 or later supports a new concept called data source. The data source represents the PostgreSQL database and manages your database connections automatically.

To create a new data source, you call the Create() method of the NpgsqlDataSource class:

```
string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");
await using var dataSource = NpgsqlDataSource.Create(connectionString);
```

After having a data source, you can perform database operations such as executing a query and handling a transaction.

Typically, you create and use a single data source object through your application. Note that the data source is thread\-safe.

Sometimes, you may want to deal with the database connection manually. In such cases, you can use the data source object to create a new database connection:

```sql
await using var conn = await dataSource.OpenConnectionAsync();
```

## Summary

- Use Npgsql .NET Data Provider to interact with the PostgreSQL database.


# Call a Stored Procedure using C#

---
title: 'PostgreSQL C#: Call a Stored Procedure'
page_title: 'PostgreSQL C#: Call a PostgreSQL Stored Procedure Using C#'
page_description: 'In this tutorial, you will learn to call a PostgreSQL stored procedure from a C# program using ADO.NET'
prev_url: 'https://www.postgresqltutorial.com/postgresql-csharp/postgresql-csharp-call-a-stored-procedure/'
ogImage: ''
updatedOn: '2024-05-21T12:55:45+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL C#: Call a PostgreSQL Function'
  slug: 'postgresql-csharp/postgresql-csharp-call-postgresql-function'
nextLink:
  title: 'PostgreSQL Cheat Sheet'
  slug: 'postgresql-csharp/../postgresql-cheat-sheet'
---

**Summary**: in this tutorial, you will learn to call a PostgreSQL stored procedure from a C\# program using ADO.NET

## How to call a PostgreSQL stored procedure in C\#

The following are the steps for calling a PostgreSQL stored procedure in C\#:

First, create a data source that represents the PostgreSQL database:

```cssql
await using var dataSource = NpgsqlDataSource.Create(connectionString);
```

Second, create a new `NpgsqlCommand` object from the statement that calls a stored procedure:

```cs
await using var cmd = dataSource.CreateCommand("CALL sp($1,$2)");
```

The `$1` and `$2` are placeholders for binding parameters to the stored procedure.

Third, optionally, bind values to the command:

```cs
cmd.Parameters.AddWithValue(value1);
cmd.Parameters.AddWithValue(value2);
```

Fourth, execute the stored procedure call by calling the `ExecuteNonQueryAsync()` method of the `NpgsqlCommand` object:

```cs
await using var reader = await cmd.ExecuteReaderAsync();
```

We’ll create a new stored procedure in the PostgreSQL server and call it from a C\# program.

## Creating a PostgreSQL stored procedure

First, open a terminal and connect to the `elearning` database using the `ed` user:

```plaintext
psql -U ed -d elearning
```

It’ll prompt you to enter a password for the `ed` user. Input the valid password and press Enter to connect to the PostgreSQL server.

Second, create a PostgreSQL stored procedure that enrolls a student and creates an invoice:

```sql
CREATE OR REPLACE PROCEDURE enroll_student(
    p_student_id INTEGER,
    p_course_id INTEGER,
    p_amount DOUBLE PRECISION,
    p_tax DOUBLE PRECISION,
    p_invoice_date DATE
)
LANGUAGE plpgsql
AS $$
BEGIN

    -- Enroll the student in the course
	INSERT INTO enrollments (student_id, course_id, enrolled_date)
    VALUES (p_student_id, p_course_id, p_invoice_date);

    -- Create a new invoice for the student
    INSERT INTO invoices (student_id, course_id, amount, tax, invoice_date)
    VALUES (p_student_id, p_course_id, p_amount, p_tax, p_invoice_date);

END;
$$;
```

## Calling the PostgreSQL stored procedure in C\#

The following C\# program invokes the `enroll_student` stored procedure from the PostgreSQL database:

```cs
using Npgsql;

var studentId = 2;
var courseId = 2;
var amount = 49.99;
var tax = 0.05;
var invoiceDate = new DateOnly(2024, 05, 20);

string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");


try
{
    await using var dataSource = NpgsqlDataSource.Create(connectionString);
    await using var cmd = dataSource.CreateCommand("CALL enroll_student($1,$2,$3,$4,$5)");

    cmd.Parameters.AddWithValue(studentId);
    cmd.Parameters.AddWithValue(courseId);
    cmd.Parameters.AddWithValue(amount);
    cmd.Parameters.AddWithValue(tax);
    cmd.Parameters.AddWithValue(invoiceDate);


    await cmd.ExecuteNonQueryAsync();
}
catch (NpgsqlException ex)
{
    Console.WriteLine($"Error: {ex.Message}");
}
```

How it works.

First, declare and initialize variables for storing the enrollment details including `studentId`, `courseId`, `amount`, `tax`, and `invoiceDate`:

```cs
var studentId = 2;
var courseId = 2;
var amount = 49.99;
var tax = 0.05;
var invoiceDate = new DateOnly(2024, 05, 20);
```

Second, get the connection string from the configuration file using the `ConfigurationHelper` class:

```cs
string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");
```

Third, create a data source that represents the PostgreSQL database:

```cs
await using var dataSource = NpgsqlDataSource.Create(connectionString);
```

Fourth, create a new `NpgsqlCommand` object that will execute a call to the `enroll_student` stored procedure:

```cs
await using var cmd = dataSource.CreateCommand("CALL enroll_student($1,$2,$3,$4,$5)");
```

Note that `$1`, `$2`, `$3`, `$4` and `$5` are the parameter placeholders you need to bind values when executing the command.

Fifth, bind the variables to the parameters of the `NpgsqlCommand` object:

```cs
cmd.Parameters.AddWithValue(studentId);
cmd.Parameters.AddWithValue(courseId);
cmd.Parameters.AddWithValue(amount);
cmd.Parameters.AddWithValue(tax);
cmd.Parameters.AddWithValue(invoiceDate);
```

Sixth, execute the command that calls the PostgreSQL stored procedure:

```cs
await cmd.ExecuteNonQueryAsync();
```

Finally, show the error message if any exceptions occur:

```cs
// ...
} catch (NpgsqlException ex)
{
    Console.WriteLine($"Error: {ex.Message}");
}
```

## Verify the stored procedure call

First, connect to the `elearning` database using the `ed` user:

```plaintext
psql -U ed -d elearning
```

Second, retrieve data from the enrollments table:

```plaintext
SELECT * FROM enrollments;
```

Output:

```text
 student_id | course_id | enrolled_date
------------+-----------+---------------
          2 |         1 | 2024-05-20
          2 |         2 | 2024-05-20
(2 rows)
```

Third, retrieve data from the invoices table:

```
 SELECT * FROM invoices;
```

Output:

```
 id | student_id | course_id | amount | tax  | invoice_date
----+------------+-----------+--------+------+--------------
  1 |          2 |         1 |  99.50 | 0.05 | 2024-05-20
  2 |          2 |         2 |  49.99 | 0.05 | 2024-05-20
(2 rows)
```

The output shows that the program successfully called the stored procedure `enroll_student` that inserts new rows into the `enrollments` and `invoices` tables;

## Summary

- Call the `ExecuteNonQueryAsync()` method of the `NpgsqlCommand` object to execute a call to a PostgreSQL stored procedure from a C\# program.


# Call PostgreSQL Functions using C#

---
title: 'PostgreSQL C#: Call a PostgreSQL Function'
page_title: 'PostgreSQL C#: Call a PostgreSQL Function'
page_description: 'In this tutorial, you will learn to call a PostgreSQL function with parameters from a C# program using ADO.NET'
prev_url: 'https://www.postgresqltutorial.com/postgresql-csharp/postgresql-csharp-call-postgresql-function/'
ogImage: ''
updatedOn: '2024-05-21T07:40:03+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL C#: Transaction'
  slug: 'postgresql-csharp/postgresql-csharp-transaction'
nextLink:
  title: 'PostgreSQL C#: Call a Stored Procedure'
  slug: 'postgresql-csharp/postgresql-csharp-call-a-stored-procedure'
---

**Summary**: in this tutorial, you will learn to call a PostgreSQL function from a C\# program using ADO.NET

## How to call a PostgreSQL function in C\#

Here are the steps for calling a PostgreSQL function in C\#:

First, create a data source that represents the PostgreSQL database:

```cs
await using var dataSource = NpgsqlDataSource.Create(connectionString);
```

Second, create a new `NpgsqlCommand` object from the statement that calls a PostgreSQL function:

```cs
await using var cmd = dataSource.CreateCommand("SELECT fn(?,?)");
```

Third, optionally, bind values to the query’s parameters:

```cs
cmd.Parameters.AddWithValue(value1);
cmd.Parameters.AddWithValue(value2);
```

Fourth, execute the function call by calling the `ExecuteReaderAsync()` method of the `NpgsqlCommand` object:

```cs
await using var reader = await cmd.ExecuteReaderAsync();
```

The `ExecuteReaderAsync()` returns a `NpgsqlDataReader` object.

Finally, read the return values of the function by calling the `ReadAsync()` method of the `NpgsqlDataReader` object:

```cs
while (await reader.ReadAsync())
{
    var result = reader.GetInt32(0);
    // ...
}
```

We’ll create a new function in the PostgreSQL server and call it from a C\# program.

## Creating a PostgreSQL function

First, open a terminal and connect to the `elearning` database using the `ed` user:

```plaintext
psql -U ed -d elearning
```

It’ll prompt you to enter a password for the `ed` user. Input the valid password and press Enter to connect to the PostgreSQL server.

Second, create a stored procedure in PostgreSQL, which enrolls a student in a course and creates a corresponding invoice:

```sql
create function get_student_count(begin_date date, end_date date)
returns int
language plpgsql as $$
declare
   student_count integer;
begin
   select count(*)
   into student_count
   from students
   where registration_date between begin_date and end_date;

   return student_count;
end;
$$;
```

## Calling the PostgreSQL function in C\#

The following C\# program invokes the \`enroll_student_and_create_invoice\` function from the PostgreSQL database:

```cs
using Npgsql;

var beginDate = new DateOnly(2024, 5, 10);
var endDate = new DateOnly(2024, 5, 15);

string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");

try
{
    await using var dataSource = NpgsqlDataSource.Create(connectionString);

    await using var cmd = dataSource.CreateCommand("SELECT get_student_count($1,$2)");

    cmd.Parameters.AddWithValue(beginDate);
    cmd.Parameters.AddWithValue(endDate);

    await using var reader = await cmd.ExecuteReaderAsync();

    if (await reader.ReadAsync())
    {
        var studentCount = reader.GetInt32(0);

        Console.WriteLine($"Students who registered between {beginDate} and {endDate}: {studentCount} ");
    }

}
catch (NpgsqlException ex)
{
    Console.WriteLine($"Error: {ex.Message}");
}
```

How it works.

First, declare and initialize variables `beginDate` and `endDate` to May 10 2024 and May 15 2024:

```cs
var beginDate = new DateOnly(2024, 5, 10);
var endDate = new DateOnly(2024, 5, 15);
```

Second, get the connection string from the configuration file using the `ConfigurationHelper` class:

```cs
string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");
```

Third, create a data source that represents the PostgreSQL database:

```cs
await using var dataSource = NpgsqlDataSource.Create(connectionString);
```

Fourth, create a new `NpgsqlCommand` object that will execute a function call to the `get_student_count()` function:

```cs
await using var cmd = dataSource.CreateCommand("SELECT get_student_count($1,$2)");
```

Notice that `$1` and `$2` are the parameter placeholders you need to bind values when executing the command.

Fifth, bind the `beginDate` and `endDate` to the parameters of the `NpgsqlCommand` object:

```cs
cmd.Parameters.AddWithValue(beginDate);
cmd.Parameters.AddWithValue(endDate);
```

Sixth, execute the command function call:

```cs
await using var reader = await cmd.ExecuteReaderAsync();
```

Seventh, read the student count and display it in the console:

```cs
if (await reader.ReadAsync())
{
    var studentCount = reader.GetInt32(0);
    Console.WriteLine($"Students who registered between {beginDate} and {endDate}: {studentCount} ");
}
```

Finally, display the error message if any exceptions occur:

```cs
// ...
} catch (NpgsqlException ex)
{
    Console.WriteLine($"Error: {ex.Message}");
}
```

## Summary

- Call the `ExecuteReaderAsync()` method of the `NpgsqlCommand` object to execute a call to a PostgreSQL function from a C\# program.


# Connect to PostgreSQL using C#

---
title: 'PostgreSQL C#: Connecting the PostgreSQL Database'
page_title: 'PostgreSQL C#: Connecting to the PostgreSQL database'
page_description: 'Learn how to create a sample database in PostgreSQL and how to connect to the database from a C# program using ADO.NET'
prev_url: 'https://www.postgresqltutorial.com/postgresql-csharp/postgresql-csharp-connect/'
ogImage: '/postgresqltutorial/PostgreSQL-C-Connect.png'
updatedOn: '2024-05-21T00:35:17+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL C#'
  slug: 'postgresql-csharp/'
nextLink:
  title: 'PostgreSQL C#: Creating Tables'
  slug: 'postgresql-csharp/postgresql-csharp-create-table'
---

**Summary**: in this tutorial, you will learn how to create a sample database in PostgreSQL and how to connect to the database from a C\# program using ADO.NET

## Create a sample database

First, open a terminal and [connect to the PostgreSQL database server](../postgresql-getting-started/connect-to-postgresql-database):

```plaintextsql
psql -U postgres
```

It’ll prompt you to enter a password for the postgres user.

Second, [create a new database](../postgresql-administration/postgresql-create-database) called `elearning`:

```sql
CREATE DATABASE elearning;
```

Third, change the current database to `elearning`:

```text
\c elearning
```

Fourth, [create a new role](../postgresql-administration/postgresql-roles) (user) with the name `ed`:

```
CREATE ROLE ed WITH LOGIN PASSWORD 'YourPassword';
```

Note that you need to replace the `YourPassword` with your actual password and keep it for setting up the connection string later.

Fifth, [grant all privileges](../postgresql-administration/postgresql-grant) of the `elearning` database to the `ed` user:

```sql
GRANT ALL PRIVILEGES ON SCHEMA public
TO ed;
```

Finally, exit the psql database:

```sql
exit
```

## Create a new C\# Project

First, launch Visual Studio.

Second, create a Console App with the name `ELearning`.

Third, install the following Nuget packages:

```cs
dotnet add package Microsoft.Extensions.Configuration
dotnet add package Microsoft.Extensions.Configuration.Json
dotnet add package Npgsql
```

- The `Npgsql` is a .NET data provider for PostgreSQL.
- The `Microsoft.Extensions`.Configuration and `Microsoft.Extensions`.`Configuration.Json` are packages that manage configurations.

Fourth, create `appsettings.json` file in the project and add the `ConnnectionStrings` setting as follows:

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=localhost;Database=elearning;User Id=ed;Password=YourPassword;"
  }
}
```

In the `appsettings.json` file, add the connection string that connects to the local PostgreSQL server, `elearning` database using the `ed` user with your selected password.

Fifth, right\-click the `appsettings.json` file, choose the **Properties…** and change the **Copy to Output Directory** to **“Copy if Newer”**:

![PostgreSQL C# Connect](/postgresqltutorial/PostgreSQL-C-Connect.png)Sixth, create a new `ConfigurationHelper.cs` file and define the `ConfigurationHelper` class with the following code:

```cs
using Microsoft.Extensions.Configuration;

public static class ConfigurationHelper
{
    private static readonly IConfiguration _configuration;

    static ConfigurationHelper()
    {
        var builder = new ConfigurationBuilder()
            .SetBasePath(Directory.GetCurrentDirectory())
            .AddJsonFile("appsettings.json", optional: false, reloadOnChange: true);

        _configuration = builder.Build();
    }

    public static string GetConnectionString(string name)
    {
        var connectionString = _configuration.GetConnectionString(name);
        if (string.IsNullOrEmpty(connectionString))
        {
            throw new InvalidOperationException($"The connection string '{name}' has not been initialized.");
        }
        return connectionString;
    }
}
```

The `ConfigurationHelper` reads the `appsettings.json` file and returns the connection string from the `GetConnectionString()` method.

Seventh, add the following code to the `Program.cs` to connect to the PostgreSQL server:

```cs
using Npgsql;

// Get the connection string
string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");


// Connect to the PostgreSQL server
await using var conn = new NpgsqlConnection(connectionString);
await conn.OpenAsync();

Console.WriteLine($"The PostgreSQL version: {conn.PostgreSqlVersion}");
```

Finally, run the program.

If everything is fine, you should see the PostgreSQL server version on the screen.

## How the Program.cs file works

First, import the `Npgsql` namespace that allows you to use the classes provided by `Npgsql` to interact with the PostgreSQL database:

```cs
using Npgsql;
```

Second, get the connection string by calling the `GetConnectionString` from the `ConfigurationHelper` class:

```cs
string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");
```

Third, create a `NpgsqlConnection` object that represents a connection to the PostgreSQL database with the provided connection string:

```cs
await using var conn = new NpgsqlConnection(connectionString);
```

The `using` statement automatically closes the database connection when it goes out of scope.

It’s important to close a connection where it is no longer needed. If you do not close it, you’ll encounter a connection leak, which may crash your program.

Fourth, open a connection to the PostgreSQL Server by calling the `OpenAsync()` method:

```cs
await conn.OpenAsync();
```

Finally, display the PostgreSQL server version by accessing the `PostgreSqlVersion` property of the `NpgsqlConnection` object:

```cs
Console.WriteLine($"The PostgreSQL version: {conn.PostgreSqlVersion}");
```

## Data source

Npgsql 7\.0 or later supports a new concept called data source. The data source represents the PostgreSQL database and manages your database connections automatically.

To create a new data source, you call the Create() method of the NpgsqlDataSource class:

```
string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");
await using var dataSource = NpgsqlDataSource.Create(connectionString);
```

After having a data source, you can perform database operations such as executing a query and handling a transaction.

Typically, you create and use a single data source object through your application. Note that the data source is thread\-safe.

Sometimes, you may want to deal with the database connection manually. In such cases, you can use the data source object to create a new database connection:

```sql
await using var conn = await dataSource.OpenConnectionAsync();
```

## Summary

- Use Npgsql .NET Data Provider to interact with the PostgreSQL database.


# Create Tables using C#

---
title: 'PostgreSQL C#: Creating Tables'
page_title: 'PostgreSQL C#: Create Tables'
page_description: 'In this tutorial, you will learn how to create new tables in the PostgreSQL database from a C# program.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-csharp/postgresql-csharp-create-table/'
ogImage: ''
updatedOn: '2024-05-21T00:46:06+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL C#: Connecting the PostgreSQL Database'
  slug: 'postgresql-csharp/postgresql-csharp-connect'
nextLink:
  title: 'PostgreSQL C#: Inserting data'
  slug: 'postgresql-csharp/postgresql-csharp-insert'
---

**Summary**: in this tutorial, you will learn how to create new tables in the PostgreSQL database from a C\# program.

This tutorial begins where the [Connecting to the PostgreSQL database from a C\# program tutorial](postgresql-csharp-connect) left off.

## How to create tables in PostgreSQL using C\#

To create a new table in a PostgreSQL database from a C\# program, you follow these steps:

First, construct a [`CREATE TABLE`](../postgresql-tutorial/postgresql-create-table) statement:

```cssql
var sql = "CREATE TABLE  ...";
```

Second, open a connection to the PostgreSQL database:

```cs
await using var conn = new NpgsqlConnection(connectionString);
await conn.OpenAsync();
```

Third, create a `NpgsqlCommand` object:

```cs
 await using var cmd = new NpgsqlCommand(sql, conn);
```

Fourth, execute the `CREATE TABLE` statement by calling the `ExecuteNonQueryAsync()` method of the command object:

```cs
await cmd.ExecuteNonQueryAsync();
```

Finally, close the database connection. Note that the `using` statement automatically closes the database connection when it goes out of scope.

## Creating new tables

The following program illustrates how to create three tables `courses`, `students`, and `enrollments` in the `elearning` database:

```cs
using Npgsql;

// Construct CREATE TABLE statements
var statements = new List<string> {@"
    CREATE TABLE courses(
        id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
        name VARCHAR(255) NOT NULL UNIQUE,
        duration INTERVAL NOT NULL,
        description TEXT
    )",

    @"CREATE TABLE students(
        id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
        first_name VARCHAR(255) NOT NULL,
        last_name VARCHAR(255) NOT NULL,
        email VARCHAR(400) NOT NULL UNIQUE,
        registration_date DATE NOT NULL
    )",

    @"CREATE TABLE enrollments(
        student_id INT NOT NULL,
        course_id INT NOT NULL,
        enrolled_date DATE NOT NULL,
        PRIMARY KEY(student_id, course_id)
    )"
};

// Get the connection string
string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");

try
{
    // Create a new data source
    using var dataSource =  NpgsqlDataSource.Create(connectionString);

    // Execute each CREATE TABLE statement
    foreach (var statement in statements)
    {
        await using var cmd = dataSource.CreateCommand(statement);
        await cmd.ExecuteNonQueryAsync();
    }

    Console.WriteLine("The tables have been created successfully.");

}
catch (NpgsqlException ex)
{
    Console.WriteLine($"Error: {ex.Message}");
}
```

How it works.

First, construct a list of `CREATE` `TABLE` statements:

```cs
var statements = new List<string> {
   // ...
}
```

Next, get the connection string using the `ConfigurationHelper` class:

```cs
string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");
```

Then, create a new data source from the connection string:

```cs
using var dataSource = NpgsqlDataSource.Create(connectionString);
```

After that, iterate over the statements list and execute each statement by calling the `ExecuteNonQueryAsync()` method:

```
foreach (var statement in statements)
{
    await using var cmd = dataSource.CreateCommand(statement);
    await cmd.ExecuteNonQueryAsync();
}
```

Finally, use the [try\-catch](https://www.csharptutorial.net/csharp-tutorial/csharp-try-catch/) statement to catch any exceptions that may occur and display the error message:

```cs
Console.WriteLine($"Error: {ex.Message}");
```

## Verify table creation

First, open a terminal and connect to the `elearning` database using the `ed` user:

```cs
psql -U ed -d elearning
```

It’ll prompt you to enter a password for the `ed` user. Input the valid password and press Enter to connect to the PostgreSQL.

Second, run the `\dt` command to [show all tables](../postgresql-administration/postgresql-show-tables) in the `elearning` database:

```cs
\dt
```

Output:

```cs
 Schema |    Name     | Type  | Owner
--------+-------------+-------+-------
 public | courses     | table | ed
 public | enrollments | table | ed
 public | students    | table | ed
(3 rows)
```

The output indicates that the program has successfully created three tables including `courses`, `enrollments`, and `students`.

## Summary

- Call the `ExecuteNonQueryAsync()` method of the `NpgsqlCommand` to execute a `CREATE` `TABLE` statement to create a new table in the PostgreSQL database.


# Delete Data from a Table using C#

---
title: 'PostgreSQL C#: Deleting Data'
page_title: 'PostgreSQL C#: Delete'
page_description: 'In this tutorial, you will learn how to delete data from a table in a PostgreSQL database from a C# program.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-csharp/postgresql-csharp-delete/'
ogImage: ''
updatedOn: '2024-05-21T03:47:58+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL C#: Updating Data'
  slug: 'postgresql-csharp/postgresql-csharp-update'
nextLink:
  title: 'PostgreSQL C#: Selecting Data'
  slug: 'postgresql-csharp/postgresql-csharp-select'
---

**Summary**: in this tutorial, you will learn how to delete data from a table in a PostgreSQL database from a C\# program.

This tutorial begins where [updating data in PostgreSQL using C\#](postgresql-csharp-update) is left off.

## How to delete data from PostgreSQL using C\#

To delete a row from a table in a PostgreSQL database from a C\# program, you use the following steps:

First, construct a [`DELETE`](../postgresql-tutorial/postgresql-delete) statement that deletes one or more rows from a specified table:

```cssql
var sql = "DELETE.. ";
```

In the `DELETE` statement, you can use parameters in the format `@parameter`. When executing the query, you need to bind values to these parameters.

Parameterized queries can prevent SQL injection attacks, especially when the data comes from untrusted sources.

Second, create a data source that represents the PostgreSQL database:

```cs
await using var dataSource = NpgsqlDataSource.Create(connectionString);
```

Third, create a `NpgsqlCommand` object and bind one or more values to the parameters:

```cs
await using var cmd = dataSource.CreateCommand(sql);

cmd.Parameters.AddWithValue("@parameter1", value1);
cmd.Parameters.AddWithValue("@parameter2", value2);
...
```

Finally, execute the `DELETE` statement by calling the `ExecuteNonQueryAsync()` method of the command object:

```cs
await cmd.ExecuteNonQueryAsync();
```

Note that the `using` statement will automatically close the database connection.

## Deleting data from a table

The following C\# program shows how to delete the row with id 1 from the `students` table:

```cs
using Npgsql;

// Construct a DELETE statement
var sql = @"DELETE FROM students WHERE id = @id";

// Get the connection string
string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");
try
{

    // Create a data source
    await using var dataSource = NpgsqlDataSource.Create(connectionString);

    // Create a Command object
    await using var cmd = dataSource.CreateCommand(sql);

    // Bind parameters
    cmd.Parameters.AddWithValue("@id", 1);

    // Execute the DELETE statement
    await cmd.ExecuteNonQueryAsync();

    Console.WriteLine("The row has been deleted successfully.");

}
catch (NpgsqlException ex)
{
    Console.WriteLine($"Error: {ex.Message}");
}
```

How it works.

First, construct an `DELETE` statement that deletes a row specified by an id from the `students` table:

```cs
var sql = @"DELETE FROM students WHERE id = @id";
```

The `@id` is a placeholder for the parameter in the `DELETE` statement.

Second, get the connection string from the configuration:

```cs
string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");
```

Third, create a data source that represents the PostgreSQL database:

```
await using var dataSource = NpgsqlDataSource.Create(connectionString);
```

Fourth, create a new `NpgsqlCommand` object and bind the values to its parameters:

```cs
await using var cmd = dataSource.CreateCommand(sql);
cmd.Parameters.AddWithValue("@id", 1);
```

Fifth, execute the `DELETE` statement by calling the `ExecuteNonQueryAsync()` method and display a success message:

```cs
await cmd.ExecuteNonQueryAsync();
Console.WriteLine("The row has been deleted successfully.");
```

Finally, display an error message if any exceptions occur when deleting the data:

```cs
// ...
catch (NpgsqlException ex)
{
    Console.WriteLine($"Error: {ex.Message}");
}
```

## Verify the deletion

First, open a terminal and connect to the `elearning` database using the `ed` user:

```cs
psql -U ed -d elearning
```

It’ll prompt you to enter a password for the `ed` user. Input the valid password and press Enter to connect to the PostgreSQL.

Second, query the row with id 1 from the `students` table:

```cs
SELECT * FROM students
WHERE id = 1;
```

Output:

```cs
 id | first_name | last_name | email | registration_date
----+------------+-----------+-------+-------------------
(0 rows)
```

The output indicates that the program has successfully deleted the row id 1\.

## Summary

- Use the `NpgsqlCommand` object to execute an `DELETE` statement that deletes a row from a table.


# Import Data from CSV using C#

---
title: 'PostgreSQL C#: Importing Data from a CSV File into a Table'
page_title: 'PostgreSQL C#: Import Data from a CSV File into a Table'
page_description: 'In this tutorial, you will learn how to import data from a CSV file into a table in PostgreSQL using C#.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-csharp/postgresql-csharp-import-csv-file/'
ogImage: ''
updatedOn: '2024-05-21T03:19:12+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL C#: Inserting data'
  slug: 'postgresql-csharp/postgresql-csharp-insert'
nextLink:
  title: 'PostgreSQL C#: Updating Data'
  slug: 'postgresql-csharp/postgresql-csharp-update'
---

**Summary**: in this tutorial, you will learn how to import data from a CSV file into a table in PostgreSQL using C\#.

This tutorial begins where the [Inserting data into a table in PostgreSQL tutoria](postgresql-csharp-insert)l left off.

## How to import a CSV file into the PostgreSQL database using C\#

To import data from a CSV file into a table in PostgreSQL from a C\# program, you follow these steps:

- First, read data from the CSV file into a list of records.
- Second, iterate over the list and [insert each record into the table](postgresql-csharp-insert).

## Importing a CSV file into PostgreSQL

The following program illustrates how to import data from `students.csv` file into the `students` table in the `elearning` database:

```cs
using CsvHelper;
using System.Globalization;
using Npgsql;

namespace ELearning;

public record Student(string FirstName, string LastName, string Email, DateOnly RegistrationDate);

public class Program
{
    public static IEnumerable<Student> ReadStudentsFromCSV(string filePath)
    {
        using var reader = new StreamReader(filePath);
        using var csv = new CsvReader(reader, CultureInfo.InvariantCulture);

        // Skip header of the csv file
        csv.Read();

        // Read the header of the csv file to map to fields
        csv.ReadHeader();

        while (csv.Read())
        {
            var firstName = csv.GetField<string>("Firstname");
            var lastName = csv.GetField<string>("Lastname");
            var email = csv.GetField<string>("Email");
            var registrationDate = csv.GetField<DateOnly>("RegistrationDate");

            yield return new Student(firstName, lastName, email, registrationDate);
        }
    }
    public static async Task Main()
    {
        var csvFilePath = @"c:\db\students.csv";

        var sql = @"INSERT INTO students(first_name, last_name, email, registration_date) " +
          "VALUES(@first_name,@last_name,@email,@registration_date)";

        string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");

        try
        {
            // Create a new data source

            await using var dataSource = NpgsqlDataSource.Create(connectionString);


            // Insert lines of CSV into the students table
            foreach (var student in ReadStudentsFromCSV(csvFilePath))
            {
                await using var cmd = dataSource.CreateCommand(sql);

                cmd.Parameters.AddWithValue("@first_name", student.FirstName);
                cmd.Parameters.AddWithValue("@last_name", student.LastName);
                cmd.Parameters.AddWithValue("@email", student.Email);
                cmd.Parameters.AddWithValue("@registration_date", student.RegistrationDate);

                await cmd.ExecuteNonQueryAsync();
            }
        }
        catch (NpgSQLException ex)
        {
            Console.WriteLine(ex.Message);
        }
    }
}
```

In this program, we use an external package for reading a CSV file called `CsvHelper`. You can install the `CsvHelper` package by running the following command in the Package Manager Console:

```cs
Install-Package CsvHelper
```

To learn more details on reading data from a CSV file using the `CsvHelper` package, check out the tutorial on [how to read a CSV file in C\# using the CsvHelper package](https://www.csharptutorial.net/csharp-file/csharp-read-csv-file/).

Note that you can [download the students.csv file](/postgresqltutorial/students.csv) from here.

Let’s discuss how the program works.

### Declaring Student record

Define a `Student` [record](https://www.csharptutorial.net/csharp-tutorial/csharp-record/) that includes the following fields: `FirstName`, `LastName`, `Email`, and `RegistrationDate`:

```cs
public record Student(string FirstName, string LastName, string Email, DateOnly RegistrationDate);
```

### Defining ReadStudentsFromCSV() method

The `ReadStudentsFromCSV()` method reads data from a CSV file specified by a `filePath` and returns an enumerable sequence of `Student` records.

```cs
public static IEnumerable<Student> ReadStudentsFromCSV(string filePath)
{
    using var reader = new StreamReader(filePath);
    using var csv = new CsvReader(reader, CultureInfo.InvariantCulture);

    // Skip header of the csv file
    csv.Read();

    // Read the header of the csv file to map to fields
    csv.ReadHeader();

    while (csv.Read())
    {
        var firstName = csv.GetField<string>("Firstname");
        var lastName = csv.GetField<string>("Lastname");
        var email = csv.GetField<string>("Email");
        var registrationDate = csv.GetField<DateOnly>("RegistrationDate");

        yield return new Student(firstName, lastName, email, registrationDate);
    }
}
```

How it works.

First, create a `StreamReader` from the CSV file specified by the `filePath`. The `using` statement ensures that the `StreamReader` is properly closed:

```cs
using var reader = new StreamReader(filePath);
```

Second, create a `CsvReader` to parse the CSV data. The `CultureInfo.InvariantCulture` ensures consistent parsing across different locales:

```cs
using var csv = new CsvReader(reader, CultureInfo.InvariantCulture);
```

Third, read the heading line from a CSV file, which advances the reader to the next line in the CSV file:

```cs
csv.Read();
```

Fourth, read the header row of the CSV file to map the column names to fields:

```cs
csv.ReadHeader();
```

Fifth, start a loop that iterates over each line in the CSV file. The `Read()` method reads the next line from the CSV file and returns true if successful, or false if there are no more lines:

```cs
while (csv.Read())
```

Sixth, retrieve the values of the columns of the CSV file:

```cs
var firstName = csv.GetField<string>("Firstname");
var lastName = csv.GetField<string>("Lastname");
var email = csv.GetField<string>("Email");
var registrationDate = csv.GetField<DateOnly>("RegistrationDate");
```

Finally, return a new `Student` record for each row in the CSV file. The `yield return` returns multiple `Student` records iteratively without loading them all in memory:

```cs
yield return new Student(firstName, lastName, email, registrationDate);
```

### Defining Main() method

First, declare a variable `csvFilePath` and initialize it with the path to the CSV file:

```cs
var csvFilePath = @"c:\db\students.csv";
```

Next, declare a variable `sql` and initialize it with an SQL `INSERT` statement:

```cs
var sql = @"INSERT INTO students(first_name, last_name, email, registration_date) " +
          "VALUES(@first_name,@last_name,@email,@registration_date)";
```

Then, get a connection string from the `appsettings.json` file using the `ConfigurationHelper` class:

```cs
var connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");
```

After that, create a data source that represents the PostgreSQL database:

```cs
await using var dataSource = NpgsqlDataSource.Create(connectionString);
```

Finally, iterate over each `Student` record list returned by the `ReadStudentsFromCSV()` method and execute the `INSERT` statement to insert the new row into the `students` table:

```cs
foreach(var student in ReadStudentsFromCSV(csvFilePath)) {
  await using
  var cmd = dataSource.CreateCommand(sql);

  cmd.Parameters.AddWithValue("@first_name", student.FirstName);
  cmd.Parameters.AddWithValue("@last_name", student.LastName);
  cmd.Parameters.AddWithValue("@email", student.Email);
  cmd.Parameters.AddWithValue("@registration_date", student.RegistrationDate);

  await cmd.ExecuteNonQueryAsync();
}
```

## Verify the inserts

First, open a terminal and connect to the `elearning` database using the `ed` user:

```cs
psql -U ed -d elearning
```

It’ll prompt you to enter a password for the `ed` user. Input the valid password and press Enter to connect to the PostgreSQL.

Second, query data from the `students` table:

```cs
SELECT * FROM students;
```

Output:

```
 id | first_name | last_name |            email             | registration_date
----+------------+-----------+------------------------------+-------------------
  1 | John       | Doe       | [[email protected]](../cdn-cgi/l/email-protection.html)           | 2024-05-20
  2 | Emma       | Smith     | [[email protected]](../cdn-cgi/l/email-protection.html)         | 2024-05-20
  3 | Liam       | Johnson   | [[email protected]](../cdn-cgi/l/email-protection.html)       | 2024-05-20
  4 | Olivia     | Williams  | [[email protected]](../cdn-cgi/l/email-protection.html)    | 2024-05-20
  5 | Noah       | Brown     | [[email protected]](../cdn-cgi/l/email-protection.html)         | 2024-05-15
  6 | Ava        | Jones     | [[email protected]](../cdn-cgi/l/email-protection.html)          | 2024-05-15
  7 | William    | Garcia    | [[email protected]](../cdn-cgi/l/email-protection.html)     | 2024-05-15
  8 | Sophia     | Miller    | [[email protected]](../cdn-cgi/l/email-protection.html)      | 2024-05-10
  9 | James      | Davis     | [[email protected]](../cdn-cgi/l/email-protection.html)        | 2024-05-10
 10 | Isabella   | Rodriguez | [[email protected]](../cdn-cgi/l/email-protection.html) | 2024-05-10
 11 | Benjamin   | Martinez  | [[email protected]](../cdn-cgi/l/email-protection.html)  | 2024-05-10
(11 rows)
```

The output indicates that the program has successfully imported 10 rows from the `students.csv` file into the `students` table.

## Summary

- Utilize the `CsvHelper` package to read data from a CSV file.
- Call the `ExecuteNonQueryAsync()` method of the `NpgsqlCommand` object to execute an SQL `INSERT` statement to load data from a CSV file into a table in the SQLite database.


# Insert Data Into Tables using C#

---
title: 'PostgreSQL C#: Inserting data'
page_title: 'PostgreSQL C#: Insert'
page_description: 'In this tutorial, you will learn how to insert data into a table in PostgreSQL Database from a C# program.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-csharp/postgresql-csharp-insert/'
ogImage: ''
updatedOn: '2024-05-21T03:13:47+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL C#: Creating Tables'
  slug: 'postgresql-csharp/postgresql-csharp-create-table'
nextLink:
  title: 'PostgreSQL C#: Importing Data from a CSV File into a Table'
  slug: 'postgresql-csharp/postgresql-csharp-import-csv-file'
---

**Summary**: in this tutorial, you will learn how to insert data into a table in the PostgreSQL database from a C\# program.

This tutorial begins where the [Creating Tables in PostgreSQL database from a C\# program tutorial](postgresql-csharp-create-table) left off.

## How to insert data into PostgreSQL database using C\#

To insert a new row into a table in a PostgreSQL database from a C\# program, you follow these steps:

First, construct an `INSERT` statement:

```cs
var sql = "INSERT INTO ...";
```

In the SQL statement, you can have one or more parameters in the format `@parameter`. When you execute it, you can bind values to these parameters.

This allows you to prevent SQL injection attacks if the values come from untrusted sources such as form input.

Second, create a new data source from the connection string:

```cs
using var dataSource = NpgsqlDataSource.Create(connectionString);
```

Third, create a `NpgsqlCommand` object from the data source with the `INSERT` statement:

```cs
await using var cmd = dataSource.CreateCommand(sql);
```

Finally, execute the `INSERT` statement by calling the `ExecuteNonQueryAsync()` method of the command object:

```cs
await cmd.ExecuteNonQueryAsync();
```

## Inserting data into a table

The following C\# program inserts a row into the `students` table in the `elearning` database:

```cs
using Npgsql;

var student = new Student("John", "Doe", "[[email protected]](../cdn-cgi/l/email-protection.html)", new DateOnly(2024, 5, 20));


// Construct INSERT statement
var sql = @"INSERT INTO students(first_name, last_name, email, registration_date) " +
          "VALUES(@first_name,@last_name,@email,@registration_date)";

// Get the connection string
string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");

try
{
    // Create a new data source
    using var dataSource = NpgsqlDataSource.Create(connectionString);

    // Create a command
    await using var cmd = dataSource.CreateCommand(sql);

    // Bind parameters
    cmd.Parameters.AddWithValue("@first_name", student.FirstName);
    cmd.Parameters.AddWithValue("@last_name", student.LastName);
    cmd.Parameters.AddWithValue("@email", student.Email);
    cmd.Parameters.AddWithValue("@registration_date", student.RegistrationDate);

    await cmd.ExecuteNonQueryAsync();

    Console.WriteLine("The row has been inserted successfully.");

}
catch (NpgsqlException ex)
{
    Console.WriteLine($"Error: {ex.Message}");
}


public record Student(string FirstName, string LastName, string Email, DateOnly RegistrationDate);

```

How it works.

First, create a new [record](https://www.csharptutorial.net/csharp-tutorial/csharp-record/) called `Student` that includes the `FirstName`, `LastName`, `Email`, and `RegistrationDate` fields:

```cs
public record Student(string FirstName, string LastName, string Email, DateOnly RegistrationDate);
```

Second, define a new instance of the `Student` record for insertion into the `students` table:

```cs
var student = new Student("John", "Doe", "[[email protected]](../cdn-cgi/l/email-protection.html)", new DateOnly(2024,5,20));
```

Third, construct an [`INSERT`](../postgresql-tutorial/postgresql-insert) statement that inserts a new row into the `students` table:

```cs
var sql = @"INSERT INTO students(first_name, last_name, email, registration_date) " +
          "VALUES(@first_name,@last_name,@email,@registration_date)";
```

These `@first_name`,`@last_name`,`@email`, and `@registration_date` are placeholders for parameters in the SQL command.

Fourth, get the connection string and establish a connection to the PostgreSQL server:

```cs
// Get the connection string
 string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");
```

Fifth, create a new `NpgsqlCommand` object and bind the values to its parameters:

```cs
await using var cmd = new NpgsqlCommand(sql, conn);

// Bind parameters
cmd.Parameters.AddWithValue("@first_name", student.FirstName);
cmd.Parameters.AddWithValue("@last_name", student.LastName);
cmd.Parameters.AddWithValue("@email", student.Email);
cmd.Parameters.AddWithValue("@registration_date", student.RegistrationDate);
```

Sixth, execute the `INSERT` statement by calling the `ExecuteNonQueryAsync()` method:

```cs
await cmd.ExecuteNonQueryAsync();
```

Finally, display an error message if any exceptions occur during the insertion:

```cs
// ...
catch (NpgsqlException ex)
{
    Console.WriteLine($"Error: {ex.Message}");
}
```

## Verify the insert

First, open a terminal and connect to the `elearning` database using the `ed` user:

```cs
psql -U ed -d elearning
```

It’ll prompt you to enter a password for the `ed` user. Input the valid password and press Enter to connect to the PostgreSQL.

Second, query data from the `students` table:

```cs
SELECT * FROM students;
```

Output:

```cs
 id | first_name | last_name |       email        | registration_date
----+------------+-----------+--------------------+-------------------
  1 | John       | Doe       | [[email protected]](../cdn-cgi/l/email-protection.html) | 2024-05-20
(1 row)
```

The output indicates that the program has successfully inserted a new row into the `students` table.

## Summary

- Use the `NpgsqlCommand` object to execute an `INSERT` statement that inserts a row into a table.


# Select Data in a Table using C#

---
title: 'PostgreSQL C#: Selecting Data'
page_title: 'PostgreSQL C#: Selecting Data'
page_description: 'In this tutorial, you will learn how to retrieve data from a PostgreSQL table from the C# program.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-csharp/postgresql-csharp-select/'
ogImage: ''
updatedOn: '2024-05-21T03:40:01+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL C#: Deleting Data'
  slug: 'postgresql-csharp/postgresql-csharp-delete'
nextLink:
  title: 'PostgreSQL C#: Transaction'
  slug: 'postgresql-csharp/postgresql-csharp-transaction'
---

**Summary**: in this tutorial, you will learn how to retrieve data from a PostgreSQL table from the C\# program.

This tutorial begins where [Deleting data from PostgreSQL using C\#](postgresql-csharp-delete) is left off.

## How to query data from PostgreSQL using C\#

To query data from PostgreSQL using C\# ADO.NET, you follow these steps:

First, create a data source that represents the PostgreSQL database.

Second, create a command object `NpgsqlCommand` with a `SELECT` statement from the data source.

Third, execute the `SELECT` statement by calling one of the following methods of the `NpgsqlCommand` object:

- `ExecuteReaderAsync()` – executes a query that returns a result set. The method returns a `NpgsqlDataReader` that can be used to read rows from the query’s result set.
- `ExecuteScalarAsync()` – executes a query that returns a scalar value such as a query that uses an [aggregate function](../postgresql-aggregate-functions) to return a [count](../postgresql-aggregate-functions/postgresql-count-function), [sum](../postgresql-aggregate-functions/postgresql-sum-function), [maximum](../postgresql-aggregate-functions/postgresql-max-function), [minimum](../postgresql-aggregate-functions/postgresql-min-function), and [average value](../postgresql-aggregate-functions/postgresql-avg-function).

Finally, iterate over the result set and use the Get\* methods of the NpgsqlDataReader object to retrieve the values of columns in each row.

## Querying all rows from a table

The following program queries all rows from the `students` table in the `elearning` database:

```cs
using Npgsql;

var sql = @"SELECT
              id,
              first_name,
              last_name,
              email,
              registration_date
            FROM
              students";

string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");

try
{
    // Open a connection
    await using var dataSource = NpgsqlDataSource.Create(connectionString);

    // Create a Command
    await using var cmd = dataSource.CreateCommand(sql);

    // Create a new data reader
    using var reader = await cmd.ExecuteReaderAsync();

    // Read data from the table
    while (await reader.ReadAsync())
    {
        var id = reader.GetInt32(0);
        var firstName = reader.GetString(1);
        var lastName = reader.GetString(2);
        var email = reader.GetString(3);
        var registrationDate = reader.GetDateTime(4);

        // Display the student details
        Console.WriteLine($"{id}\t{firstName}\t{lastName}\t{email}\t{registrationDate.ToShortDateString()}");
    }
}
catch (NpgsqlException ex)
{
    Console.WriteLine($"Error: {ex.Message}");
}
```

Output:

```cs
2       Emma    Smith   [[email protected]](../cdn-cgi/l/email-protection.html)    5/20/2024
3       Liam    Johnson [[email protected]](../cdn-cgi/l/email-protection.html)  5/20/2024
4       Olivia  Williams        [[email protected]](../cdn-cgi/l/email-protection.html)       5/20/2024
5       Noah    Brown   [[email protected]](../cdn-cgi/l/email-protection.html)    5/15/2024
6       Ava     Jones   [[email protected]](../cdn-cgi/l/email-protection.html)     5/15/2024
7       William Garcia  [[email protected]](../cdn-cgi/l/email-protection.html)        5/15/2024
8       Sophia  Miller  [[email protected]](../cdn-cgi/l/email-protection.html) 5/10/2024
9       James   Davis   [[email protected]](../cdn-cgi/l/email-protection.html)   5/10/2024
10      Isabella        Rodriguez       [[email protected]](../cdn-cgi/l/email-protection.html)    5/10/2024
11      Benjamin        Martinez        [[email protected]](../cdn-cgi/l/email-protection.html)     5/10/2024
```

## Querying data with parameters

The following program shows how to retrieve the students who registered on `2024-05-10` from the `students` table:

```cs
using Npgsql;

var sql = @"SELECT
              first_name,
              registration_date
            FROM
              students
            WHERE
              registration_date=@registration_date";

string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");

try
{
    // Open a connection
    await using var dataSource = NpgsqlDataSource.Create(connectionString);


    // Create a Command
    await using var cmd = dataSource.CreateCommand(sql);

    cmd.Parameters.AddWithValue(
        "@registration_date",
        new DateOnly(2024, 5, 10)
    );

    // Create a new data reader
    using var reader = await cmd.ExecuteReaderAsync();

    // Read data from the table
    while (await reader.ReadAsync())
    {
        var firstName = reader.GetString(0);
        var registrationDate = reader.GetDateTime(1);

        Console.WriteLine($"{firstName}\t{registrationDate.ToShortDateString()}");
    }
}
catch (NpgsqlException ex)
{
    Console.WriteLine($"Error: {ex.Message}");
}
```

Output:

```cs
Sophia  5/10/2024
James   5/10/2024
Isabella        5/10/2024
Benjamin        5/10/2024
```

## Querying a scalar value

The following program shows how to select the total number of students from the `students` table using the [count(\*)](../postgresql-aggregate-functions/postgresql-count-function) aggregate function:

```cs
using Npgsql;

var sql = @"SELECT count(*) FROM students";

string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");

try
{
    // Open a connection
    await using var dataSource = NpgsqlDataSource.Create(connectionString);

    // Create a Command
    await using var cmd = dataSource.CreateCommand(sql);

    // Return the total number of students
    var studentCount = await cmd.ExecuteScalarAsync();

    Console.WriteLine($"Student count: {studentCount}");
}
catch (NpgsqlException ex)
{
    Console.WriteLine($"Error: {ex.Message}");
}
```

Output:

```
Student count: 10
```

## Summary

- Call the `ExecuteReaderAsync()` method of a `NpgsqlCommand` object to execute a query that returns a result set.
- Call the `ExecuteScalarAsync()` method of the `NpgsqlCommand` object to execute a query that returns a scalar value.


# PostgreSQL Transactions in C#

---
title: 'PostgreSQL C#: Transaction'
page_title: 'PostgreSQL C#: Transaction'
page_description: 'In this tutorial, you will learn how to perform a PostgreSQL transaction using C# ADO.NET.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-csharp/postgresql-csharp-transaction/'
ogImage: ''
updatedOn: '2024-05-21T03:56:12+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL C#: Selecting Data'
  slug: 'postgresql-csharp/postgresql-csharp-select'
nextLink:
  title: 'PostgreSQL C#: Call a PostgreSQL Function'
  slug: 'postgresql-csharp/postgresql-csharp-call-postgresql-function'
---

**Summary**: in this tutorial, you will learn how to perform a transaction in PostgreSQL using C\#.

## Creating a new table

First, open a terminal and connect to the `elearning` database using the `ed` user using `psql` program:

```plaintextsql
psql -U ed -d elearning
```

Second, [create a new table](../postgresql-tutorial/postgresql-create-table) called `invoices`:

```plaintext
CREATE TABLE invoices (
    id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    student_id INT NOT NULL,
    course_id INT NOT NULL,
    amount DEC(19,2) NOT NULL,
    tax DEC(5,2) NOT NULL,
    invoice_date DATE NOT NULL,
    FOREIGN KEY(student_id) REFERENCES students (id) ON DELETE CASCADE,
    FOREIGN KEY(course_id) REFERENCES courses (id) ON DELETE CASCADE
);
```

Third, [insert five rows](../postgresql-tutorial/postgresql-insert-multiple-rows) into the `courses` table:

```sql
INSERT INTO courses ( name, duration)
VALUES
   ('Introduction to PostgreSQL', '10 hours'),
   ('Advanced PostgreSQL Performance Tuning', '15 hours'),
   ('C# Fundamentals', '12 hours' ),
   ('Building Web Applications with C# and ASP.NET', '20 hours'),
   ('PostgreSQL for Application Developers', '18 hours')
RETURNING id, name, duration;
```

Output:

```text
 id |                     name                      | duration
----+-----------------------------------------------+----------
  1 | Introduction to PostgreSQL                    | 10:00:00
  2 | Advanced PostgreSQL Performance Tuning        | 15:00:00
  3 | C# Fundamentals                               | 12:00:00
  4 | Building Web Applications with C# and ASP.NET | 20:00:00
  5 | PostgreSQL for Application Developers         | 18:00:00
(5 rows)
```

Finally, exit the psql program:

```cs
exit
```

## Perform a transaction

The following program illustrates how to enroll a student in a course and create an invoice for the enrollment within a transaction:

```cs
using Npgsql;

var studentId = 2;
var courseId = 1;
var amount = 99.5;
var tax = 0.05;
var invoiceDate = new DateOnly(2024, 05, 20);

string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");

try
{
    // Create a new database source
    await using var dataSource = NpgsqlDataSource.Create(connectionString);


    // Open a connection to the PostgreSQL server
    await using var conn = await dataSource.OpenConnectionAsync();

    // Start the transaction
    await using var tx = await conn.BeginTransactionAsync();

    try
    {
        // Enroll student id 2 with the course id 1
        var sql = "INSERT INTO enrollments (student_id, course_id, enrolled_date) " +
            "VALUES (@student_id,@course_id, @enrolled_date)";

        await using var cmd1 = new NpgsqlCommand(sql, conn,tx)
        {
            Parameters =
            {
                new("@student_id", studentId),
                new("@course_id", courseId),
                new("@enrolled_date", invoiceDate),
            }
        };
        await cmd1.ExecuteNonQueryAsync();

        // Create a new invoice
        sql = "INSERT INTO invoices(student_id, course_id, amount, tax, invoice_date) " +
            "VALUES(@student_id, @course_id, @amount, @tax, @invoice_date)";

        await using var cmd2 = new NpgsqlCommand(sql, conn, tx)
        {
            Parameters =
            {
                new("@student_id", studentId),
                new("@course_id", courseId),
                new("@amount", amount),
                new("@tax", tax),
                new("@invoice_date", invoiceDate),
            }
        };
        await cmd2.ExecuteNonQueryAsync();

        // Commit the transaction
        await tx.CommitAsync();
    }
    catch (NpgsqlException ex)
    {
        Console.WriteLine($"Error: {ex.Message}");

        // Roll back the transaction
        await tx.RollbackAsync();
    }

}
catch (NpgsqlException ex)
{
    Console.WriteLine($"Error: {ex.Message}");
}
```

## Verify the transaction

First, open a terminal and connect to the `elearning` database using the `ed` user:

```cs
psql -U ed -d elearning
```

It’ll prompt you to enter a password for the `ed` user. Input the valid password and press Enter to connect to the PostgreSQL.

Second, retrieve data from the `enrollments` table:

```cs
SELECT * FROM enrollments;
```

Output:

```text
 student_id | course_id | enrolled_date
------------+-----------+---------------
          2 |         1 | 2024-05-20
(1 row)
```

Third, retrieve data from the `invoices` table:

```cs
SELECT * FROM invoices;
```

Output:

```
 id | student_id | course_id | amount | tax  | invoice_date
----+------------+-----------+--------+------+--------------
  1 |          2 |         1 |  99.50 | 0.05 | 2024-05-20
(1 row)
```

## Summary

- Call the `BeginTransactionAsync()` method of the `NpgsqlConnection` object to start a transaction.
- Call the `CommitAsync()` method of the `NpgsqlTransaction` object to apply the changes since the transaction started to the database permanently.
- Call the `RollbackAsync()` method of the `NpgsqlTransaction` object to roll back the changes.


# Update Data in a Table in C#

---
title: 'PostgreSQL C#: Updating Data'
page_title: 'PostgreSQL C#: Updating Data'
page_description: 'In this tutorial, you will learn how to update data in a table of a PostgreSQL database from a C# program.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-csharp/postgresql-csharp-update/'
ogImage: ''
updatedOn: '2024-05-21T03:27:42+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL C#: Importing Data from a CSV File into a Table'
  slug: 'postgresql-csharp/postgresql-csharp-import-csv-file'
nextLink:
  title: 'PostgreSQL C#: Deleting Data'
  slug: 'postgresql-csharp/postgresql-csharp-delete'
---

**Summary**: in this tutorial, you will learn how to update data in the PostgreSQL database using C\#.

This tutorial begins where [importing data from a CSV file into PostgreSQL tutorial](postgresql-csharp-import-csv-file) is left off.

## How to update data in PostgreSQL using C\#

To update a row from a table in a PostgreSQL database from a C\# program, you follow these steps:

First, construct an [`UPDATE`](../postgresql-tutorial/postgresql-update) statement:

```cssql
var sql = "UPDATE .. ";
```

In the `UPDATE` statement, you can add parameters in the format `@parameter`. When you execute the query, you need to bind values to these parameters.

Using the parameters in the query helps you to prevent SQL injection attacks when the values come from untrusted sources such as user inputs.

Second, create a data source that represents the PostgreSQL database:

```cs
await using var conn = new NpgsqlConnection(connectionString);
await conn.OpenAsync();
```

Third, create a `NpgsqlCommand` object and bind one or more values to the parameters:

```cs
await using var cmd = new NpgsqlCommand(sql, conn);

cmd.Parameters.AddWithValue("@parameter1", value1);
cmd.Parameters.AddWithValue("@parameter2", value2);
...
```

Finally, execute the `UPDATE` statement by calling the `ExecuteNonQueryAsync()` method of the command object:

```cs
await cmd.ExecuteNonQueryAsync();
```

Note that the `using` statement will automatically close the database connection when it is not used.

## Updating data in a table

The following C\# program modifies the email of the row with id 1 in the `students` table in the `elearning` database:

```cs
using Npgsql;

// Construct an UPDATE statement
var sql = @"UPDATE email = @email FROM students WHERE id= @id";

// Get the connection string
string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");

try
{
    // Set up a data source
    await using var dataSource = NpgsqlDataSource.Create(connectionString);

    // Create a Command object
    await using var cmd = dataSource.CreateCommand(sql);

    // Bind parameters
    cmd.Parameters.AddWithValue("@email", "[[email protected]](../cdn-cgi/l/email-protection.html)");
    cmd.Parameters.AddWithValue("@id", 1);

    // Execute the UPDATE statement
    await cmd.ExecuteNonQueryAsync();

    Console.WriteLine("The row has been updated successfully.");

}
catch (NpgsqlException ex)
{
    Console.WriteLine($"Error: {ex.Message}");
}
```

How it works.

First, construct an [UPDATE](../postgresql-tutorial/postgresql-update) statement that inserts a new row into the `students` table:

```cs
var sql = @"UPDATE email = @email FROM students WHERE id= @id";
```

These `@email` and `@id` are the placeholders for parameters in the `UPDATE` command.

Second, get the connection string from the configuration using the `ConfigurationHelper` class:

```cs
string connectionString = ConfigurationHelper.GetConnectionString("DefaultConnection");
```

Third, create a data source that represents the PostgreSQL database:

```
await using var dataSource = NpgsqlDataSource.Create(connectionString);
```

Fourth, create a new `NpgsqlCommand` object and bind the values to its parameters:

```cs
await using var cmd = dataSource.CreateCommand(sql);

cmd.Parameters.AddWithValue("@email", "[[email protected]](../cdn-cgi/l/email-protection.html)");
cmd.Parameters.AddWithValue("@id", 1);
```

Fifth, execute the `UPDATE` statement by calling the `ExecuteNonQueryAsync()` method and display a success message:

```cs
await cmd.ExecuteNonQueryAsync();
Console.WriteLine("The row has been updated successfully.");
```

Finally, display an error message if any exceptions occur during the update:

```cs
// ...
catch (NpgsqlException ex)
{
    Console.WriteLine($"Error: {ex.Message}");
}
```

## Verify the update

First, open a terminal and connect to the `elearning` database using the `ed` user:

```cs
psql -U ed -d elearning
```

It’ll prompt you to enter a password for the `ed` user. Input the valid password and press Enter to connect to the PostgreSQL.

Second, query data from the `students` table:

```cs
SELECT * FROM students
WHERE id = 1;
```

Output:

```cs
 id | first_name | last_name |       email       | registration_date
----+------------+-----------+-------------------+-------------------
  1 | John       | Doe       | [[email protected]](../cdn-cgi/l/email-protection.html) | 2024-05-20
(1 row)
```

The output indicates that the program has successfully updated the email of row id 1 to `[[email protected]](../cdn-cgi/l/email-protection.html)`.

## Summary

- Use the `NpgsqlCommand` object to execute an `UPDATE` statement that updates a row into a table.


# PostgreSQL PHP

---
title: 'PostgreSQL PHP'
page_title: 'PostgreSQL PHP - Using PHP PDO to Access PostgreSQL'
page_description: 'This PostgreSQL PHP tutorial series shows you how to use PHP PDO to manage data in PostgreSQL databases effectively.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-php/'
ogImage: '/postgresqltutorial/PostgreSQL-PHP-1.png'
updatedOn: '2024-01-30T00:39:28+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL jsonb_populate_recordset() Function'
  slug: 'postgresql-json-functions/postgresql-jsonb_populate_recordset'
nextLink:
  title: 'PostgreSQL PHP: Connect to PostgreSQL Database Using PDO'
  slug: 'postgresql-php/connect'
---

![PostgreSQL-PHP](/postgresqltutorial/PostgreSQL-PHP-1.png?alignright)
This PostgreSQL PHP section shows you how to interact with the PostgreSQL database using [PHP Data Objects](http://php.net/manual/en/book.pdo.php) (PDO) API. It guides you through the steps of performing the common database operations in PHP, including creating new tables, inserting data, updating data, querying data, deleting data, using transactions, calling stored procedures, and handling binary large objects.

PHP is a highly popular scripting language for developing web applications and websites. PHP is fast, flexible, and easy to learn. It powers everything from a personal blog to complex e\-commerce platforms, making it a powerful tool for web development.

The PHP Data Objects (PDO) defines a unified interface for accessing relational databases in PHP. Each database defines the database\-specific driver that implements the PDO interface. Additionally, each driver can expose the database\-specific features as regular extension functions.

Many PHP distributions include the `PDO_PGSQL` driver that allows you to interact with PostgreSQL databases through the PDO API.

- [Connecting to a PostgreSQL database](postgresql-php/connect) – shows you how to set up a simple PHP application structure and connect to a PostgreSQL database.
- [Creating new PostgreSQL database tables](postgresql-php/create-tables) – walks you through the steps of creating database tables in PostgreSQL using PHP.
- [Inserting data into PostgreSQL tables](postgresql-php/insert) – guides you on how to insert data into a table using PHP PDO.
- [Updating data in the table](postgresql-php/update) – provides you with the steps of updating data in the database tables.
- [Querying data from a table](postgresql-php/query) – shows you various ways to query data in the PostgreSQL database from PHP.
- [Performing transactions](postgresql-php/transaction) – explains the transaction concept and shows you how to perform transactions in PHP.
- [Working with the binary large objects (BLOB)](postgresql-php/postgresql-blob) – shows you how to insert, select, and delete large objects in PostgreSQL using PHP.
- [Calling PostgreSQL stored procedures](postgresql-php/call-stored-procedures) – explains to you the steps of calling [PostgreSQL stored procedures](https://neon.tech/postgresql/postgresql-stored-procedures/) from PHP.
- [Deleting data in a PostgreSQL table using PHP PDO](postgresql-php/delete) – teaches you how to delete data from the PostgreSQL table in the PHP application using PDO.


# Connect to PostgreSQL Database Using PDO

---
title: 'PostgreSQL PHP: Connect to PostgreSQL Database Using PDO'
page_title: 'PostgreSQL PHP: Connect to PostgreSQL Database Using PDO'
page_description: 'In this tutorial, you will learn how to set up a simple project structure and connect to the PostgreSQL database using PHP PDO API.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-php/connect/'
ogImage: '/postgresqltutorial/PostgreSQL-PHP-Connect.png'
updatedOn: '2024-01-30T00:49:02+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL PHP'
  slug: 'postgresql-php/'
nextLink:
  title: 'PostgreSQL PHP: Create New Tables'
  slug: 'postgresql-php/create-tables'
---

**Summary**: in this tutorial, you will learn how to set up a simple project structure and connect to the PostgreSQL database using PHP PDO API.

## Enable PDO_PGSQL driver

Most PHP distributions include the PostgreSQL extension `PDO_PGSQL` by default so you don’t need to do any further configuration in PHP.

However, if this is not the case, you can enable the extension by editing the `php.ini` file to uncomment the following line:

```shellsqlsql
;extension=php_pdo_pgsql.dll
```

To uncomment the line, you remove the semicolon (;) at the beginning of the line and restart the web server.

```php
extension=php_pdo_pgsql.dll
```

## Create a PHP project structure with Composer

The [Composer](http://Composer) is a tool for managing dependency that allows you to declare the PHP library in a project and manage the update automatically.

We will use the Composer to set up the project structure of all the projects that we will be working on.

First, create the  `postgresqlphpconnect` folder in the webroot folder to store the project files.

Next, create the `app` folder and a new `composer.json` file in the  `postgresqlphpconnect` folder with the following content:

```sql
{
    "autoload": {
        "psr-4": {
            "PostgreSQLTutorial\\": "app/"
        }
    }
}
```

It means that every class that you create in the `app` folder will map to the `PostgreSQLTutorial` namespace.

Then, go to the window terminal, navigate to the  `postgresqlphpconnect` folder, and type the following command:

```sql
composer update
```

This command instructs the Composer to download the declared libraries in the `composer.json` file and generate an autoload file.

The command will also place all third\-party libraries in the newly created `vendor` folder. Because we don’t declare any library in the `composer.json` file, it generates the autoload file.

```
Loading composer repositories with package information
Updating dependencies (including require-dev)
Nothing to install or update
Generating autoload files
```

After that, create the `index.php` file in the  `postgresqlphpconnect` folder.

Finally, create two more files in the `app` folder: `Connection.php` and `database.ini`.

The project structure will look like the following picture:

![PostgreSQL PHP Connect](/postgresqltutorial/PostgreSQL-PHP-Connect.png)

## Connect to the PostgreSQL database

First, [create a new database](../postgresql-administration/postgresql-create-database) named `stocks` for the demonstration.

```
CREATE DATABASE stocks;
```

Next, use the `database.ini` file to store the PostgreSQL database parameters as follows:

```sql
host=localhost
port=5432
database=stocks
user=postgres
password=postgres
```

Then, create a new class called `Connection` in the `Connection.php` file.

```sql
<?php

namespace PostgreSQLTutorial;

/**
 * Represent the Connection
 */
class Connection {

    /**
     * Connection
     * @var type
     */
    private static $conn;

    /**
     * Connect to the database and return an instance of \PDO object
     * @return \PDO
     * @throws \Exception
     */
    public function connect() {

        // read parameters in the ini configuration file
        $params = parse_ini_file('database.ini');
        if ($params === false) {
            throw new \Exception("Error reading database configuration file");
        }
        // connect to the postgresql database
        $conStr = sprintf("pgsql:host=%s;port=%d;dbname=%s;user=%s;password=%s",
                $params['host'],
                $params['port'],
                $params['database'],
                $params['user'],
                $params['password']);

        $pdo = new \PDO($conStr);
        $pdo->setAttribute(\PDO::ATTR_ERRMODE, \PDO::ERRMODE_EXCEPTION);

        return $pdo;
    }

    /**
     * return an instance of the Connection object
     * @return type
     */
    public static function get() {
        if (null === static::$conn) {
            static::$conn = new static();
        }

        return static::$conn;
    }

    protected function __construct() {

    }

    private function __clone() {

    }

    private function __wakeup() {

    }

}
```

How it works.

- The `Connection` class is a singleton class. It means that you can create only one instance for the class. If the instance already exists and you try to create a new one, the class will return the existing reference.
- To connect to a PostgreSQL database, you need to create a new instance of the PDO class. In the `connect()` method, we read the database configuration parameters in the `database.ini` file, construct a connection string, and pass it to the `PDO` constructor.

After that, place the following code in the `index.php` file.

```php
<?php

require 'vendor/autoload.php';

use PostgreSQLTutorial\Connection as Connection;

try {
    Connection::get()->connect();
    echo 'A connection to the PostgreSQL database sever has been established successfully.';
} catch (\PDOException $e) {
    echo $e->getMessage();
}
```

PHP throws a `\PDOException` if there is an exception occurs when connecting to the PostgreSQL database server, therefore, you need to place the code to create a new `PDO` object inside the  `try...catch` block to handle the exception.

Run the following composer command to update the autoload files:

```css
composer dump-autoload -o
```

Output:

```sql
Generating optimized autoload files
```

Finally, launch the `index.php` file from the web browser to test it.

```
A connection to the PostgreSQL database sever has been established successfully.
```

If you want to see the exception that may occur, you can change the parameters in the `database.ini` file to an invalid one and test it.

The following is the error message when the password is invalid.

```
SQLSTATE[08006] [7] FATAL: password authentication failed for user "postgres"
```

And the following is the error message when the database is invalid.

```
SQLSTATE[08006] [7] FATAL: database "stockss" does not exist
```

In this tutorial, you have learned how to connect to the PostgreSQL database from a PHP application using the PDO API. We will reuse the `Connection` class in the subsequent tutorials.


# Create New Tables in PHP

---
title: 'PostgreSQL PHP: Create New Tables'
page_title: 'PostgreSQL PHP: Create New Tables'
page_description: 'In this tutorial, you will learn how to create new tables in the PostgreSQL database using PHP PDO API.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-php/create-tables/'
ogImage: '/postgresqltutorial/PostgreSQL-PHP-Create-Tables.png'
updatedOn: '2022-02-09T14:58:21+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL PHP: Connect to PostgreSQL Database Using PDO'
  slug: 'postgresql-php/connect'
nextLink:
  title: 'PostgreSQL PHP: Insert Data Into Tables'
  slug: 'postgresql-php/insert'
---

**Summary**: in this tutorial, you will learn how to create new tables in the PostgreSQL database using PHP PDO API.

## Creating new tables using PHP PDO steps

To create new tables in a PostgreSQL database using PHP PDO, you follow these steps:

1. First, [connect to the database](connect) by creating a new PDO object.
2. Second, call the `exec()` method of the PDO object to execute the [CREATE TABLE](../postgresql-tutorial/postgresql-create-table) statement.

Let’s look at an example of creating new tables.

## Creating new table example

In the previous tutorial, we created the `stocks` database in the PostgreSQL database server.

For the demonstration, we’ll create two new tables in the `stocks` database: `stocks` and `stock_evaluations` with the following structures:

```phpsql
CREATE TABLE IF NOT EXISTS stocks (
    id SERIAL PRIMARY KEY,
    symbol CHARACTER VARYING(10) NOT NULL UNIQUE,
    company CHARACTER VARYING(255) NOT NULL UNIQUE
);
```

```sql
CREATE TABLE IF NOT EXISTS stock_valuations (
    stock_id INTEGER NOT NULL,
    value_on DATE NOT NULL,
    price NUMERIC(8 , 2 ) NOT NULL DEFAULT 0,
    PRIMARY KEY (stock_id , value_on),
    FOREIGN KEY (stock_id)
        REFERENCES stocks (id)
);
```

We create a new class named `PostgreSQLCreateTable` in the `app` folder.

```sql
<?php

namespace PostgreSQLTutorial;
/**
 * Create table in PostgreSQL from PHP demo
 */
class PostgreSQLCreateTable {

    /**
     * PDO object
     * @var \PDO
     */
    private $pdo;

    /**
     * init the object with a \PDO object
     * @param type $pdo
     */
    public function __construct($pdo) {
        $this->pdo = $pdo;
    }

    /**
     * create tables
     */
    public function createTables() {
        $sqlList = ['CREATE TABLE IF NOT EXISTS stocks (
                        id serial PRIMARY KEY,
                        symbol character varying(10) NOT NULL UNIQUE,
                        company character varying(255) NOT NULL UNIQUE
                     );',
            'CREATE TABLE IF NOT EXISTS stock_valuations (
                        stock_id INTEGER NOT NULL,
                        value_on date NOT NULL,
                        price numeric(8,2) NOT NULL DEFAULT 0,
                        PRIMARY KEY (stock_id, value_on),
                        FOREIGN KEY (stock_id) REFERENCES stocks(id)
                    );'];

        // execute each sql statement to create new tables
        foreach ($sqlList as $sql) {
            $this->pdo->exec($sql);
        }

        return $this;
    }

    /**
     * return tables in the database
     */
    public function getTables() {
        $stmt = $this->pdo->query("SELECT table_name
                                   FROM information_schema.tables
                                   WHERE table_schema= 'public'
                                        AND table_type='BASE TABLE'
                                   ORDER BY table_name");
        $tableList = [];
        while ($row = $stmt->fetch(\PDO::FETCH_ASSOC)) {
            $tableList[] = $row['table_name'];
        }

        return $tableList;
    }
}

```

How it works.

- First, the constructor of the class accepts a PDO object as the argument.
- Second, the `createTables()` method creates new tables in the database. The `$sqlList` array holds all the [CREATE TABLE](../postgresql-tutorial/postgresql-create-table) statements. To execute a statement, you call the `exec()` method of the PDO object. We iterate over the array of SQL statements and execute them one by one by calling the `exec()` method.
- Third, the `getTables()` method returns all tables in the connected database. We use it to query the tables in the `stocks` database after calling the `createTables()` method.

![PostgreSQL PHP Create Tables](/postgresqltutorial/PostgreSQL-PHP-Create-Tables.png)
In the `index.php` file, connect to the PostgreSQL database execute the statement to create tables and query tables.

```php
<?php

require 'vendor/autoload.php';

use PostgreSQLTutorial\Connection as Connection;
use PostgreSQLTutorial\PostgreSQLCreateTable as PostgreSQLCreateTable;

try {

    // connect to the PostgreSQL database
    $pdo = Connection::get()->connect();

    //
    $tableCreator = new PostgreSQLCreateTable($pdo);

    // create tables and query the table from the
    // database
    $tables = $tableCreator->createTables()
                            ->getTables();

    foreach ($tables as $table){
        echo $table . '<br>';
    }

} catch (\PDOException $e) {
    echo $e->getMessage();
}

```

Launch the `index.php` file in a web browser. You’ll see the following output:

```
stock_valuations
stocks
```

The output shows that the script has created two tables successfully.

## Summary

- Use the `CREATE TABLE` statement to create a new table.
- Use the PDO `exec()` method to to execute a `CREATE TABLE` statement to create a new table in the datatabase.


# Insert Data Into Tables in PHP

---
title: 'PostgreSQL PHP: Insert Data Into Tables'
page_title: 'PostgreSQL PHP: Insert Data Into Tables'
page_description: 'In this tutorial, you will learn how to use PHP PDO API to insert data into a PostgreSQL database table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-php/insert/'
ogImage: '/postgresqltutorial/PostgreSQL-PHP-Insert-Example.png'
updatedOn: '2022-02-09T15:05:02+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL PHP: Create New Tables'
  slug: 'postgresql-php/create-tables'
nextLink:
  title: 'PostgreSQL PHP: Updating Data In a Table'
  slug: 'postgresql-php/update'
---

**Summary**: in this tutorial, you will learn how to use PHP PDO API to insert data into a PostgreSQL database table.

## Steps for inserting data into a PostgreSQL table using PDO

To insert data into a database table, you use the following steps:

1. First, connect to the PostgreSQL database server by creating a new instance of the PDO class.
2. Next, construct an [INSERT](../postgresql-tutorial/postgresql-insert) statement. If you want to pass parameters to the `INSERT` statement, you use the named placeholders such as `:param`
3. Then, prepare the `INSERT` statement by calling the `prepare()` method of the PDO object. The `prepare()` method returns a `PDOStatement` object.
4. After that, pass the values to the statement by calling the `bindValue()` method of the `PDOStatement` object.
5. Finally, call the `execute()` method of the PDOStatement object to execute the `INSERT` statement.

We will use the `stocks` table that we created in the previous tutorial for demonstration purposes.

Let’s create a new class named `PostgreSQLPHPInsert` in the `app` folder and the `index.php` file in the project folder.

![PostgreSQL PHP Insert Example](/postgresqltutorial/PostgreSQL-PHP-Insert-Example.png)

## Inserting a single row into a table example

The following `insertStock()` method inserts a new row into the `stocks` table.

```phpsql
    /**
     * insert a new row into the stocks table
     * @param type $symbol
     * @param type $company
     * @return the id of the inserted row
     */
    public function insertStock($symbol, $company) {
        // prepare statement for insert
        $sql = 'INSERT INTO stocks(symbol,company) VALUES(:symbol,:company)';
        $stmt = $this->pdo->prepare($sql);

        // pass values to the statement
        $stmt->bindValue(':symbol', $symbol);
        $stmt->bindValue(':company', $company);

        // execute the insert statement
        $stmt->execute();

        // return generated id
        return $this->pdo->lastInsertId('stocks_id_seq');
    }
```

First, construct an `INSERT` statement that uses two named placed holders: `:symbol` and `:company` for binding values later.

Next, prepare the insert statement for execution by calling the `prepare()` method of the PDO object.

Then, passing the values to the statement by calling the `bindValue()` method.

After that, execute the `INSERT` statement by calling the `execute()` method.

Finally, get the ID of the last inserted row by calling the `lastInsertId()` method of the PDO object

the `PDO_PGSQL` extension requires us to specify the name of the sequence object as the parameter, we passed the `stocks_id_seq` string to the function to get the generated ID.

## Insert multiple rows into a table example

The following `insertStockList()` method inserts multiple rows into the `stocks` table.

```php
   /**
     * Insert multiple stocks into the stocks table
     * @param array $stocks
     * @return a list of inserted ID
     */
    public function insertStockList($stocks) {
        $sql = 'INSERT INTO stocks(symbol,company) VALUES(:symbol,:company)';
        $stmt = $this->pdo->prepare($sql);

        $idList = [];
        foreach ($stocks as $stock) {
            $stmt->bindValue(':symbol', $stock['symbol']);
            $stmt->bindValue(':company', $stock['company']);
            $stmt->execute();
            $idList[] = $this->pdo->lastInsertId('stocks_id_seq');
        }
        return $idList;
    }
```

The method accepts an array of stocks and calls the `execute()` method multiple times to insert multiple rows into the `stocks` table. It returns a list of inserted IDs.

Place the following code in the index.php file to test the `insertStock()` and `insertStockList()` methods.

```php
<?php
require 'vendor/autoload.php';

use PostgreSQLTutorial\Connection as Connection;
use PostgreSQLTutorial\PostgreSQLPHPInsert as PostgreSQLPHPInsert;

try {
    // connect to the PostgreSQL database
    $pdo = Connection::get()->connect();
    //
    $insertDemo = new PostgreSQLPHPInsert($pdo);

    // insert a stock into the stocks table
    $id = $insertDemo->insertStock('MSFT', 'Microsoft Corporation');
    echo 'The stock has been inserted with the id ' . $id . '<br>';

    // insert a list of stocks into the stocks table
    $list = $insertDemo->insertStockList([
        ['symbol' => 'GOOG', 'company' => 'Google Inc.'],
        ['symbol' => 'YHOO', 'company' => 'Yahoo! Inc.'],
        ['symbol' => 'FB', 'company' => 'Facebook, Inc.'],
    ]);

    foreach ($list as $id) {
        echo 'The stock has been inserted with the id ' . $id . '<br>';
    }
} catch (\PDOException $e) {
    echo $e->getMessage();
}
```

Launch the index.php in the web browser, we got the following output:

```
The stock has been inserted with the id 1
The stock has been inserted with the id 2
The stock has been inserted with the id 3
The stock has been inserted with the id 4
```

In this tutorial, you have learned how to insert a single row or multiple rows into a table in the PostgreSQL database using PHP PDO.


# Update Data In a Table using PHP

---
title: 'PostgreSQL PHP: Updating Data In a Table'
page_title: 'PostgreSQL PHP: Updating Data in a Table Using PDO API'
page_description: 'This tutorial shows you how to use the prepared statement in PHP PDO to update data in a PostgreSQL database table.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-php/update/'
ogImage: '/postgresqltutorial/PostgreSQL-PHP-Update.png'
updatedOn: '2022-02-09T15:06:27+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL PHP: Insert Data Into Tables'
  slug: 'postgresql-php/insert'
nextLink:
  title: 'PostgreSQL PHP: Querying Data'
  slug: 'postgresql-php/query'
---

**Summary**: in this tutorial, you will learn to update data in a PostgreSQL database table using PHP PDO.

## Steps for updating data in a database table from a PHP application

To update data in a table, you use these steps:

1. [Connect to the PostgreSQL database server](connect) by creating an instance of the PDO class.
2. Call the `prepare()` method of the PDO object to prepare the [UPDATE](../postgresql-tutorial/postgresql-update) statement for execution. The `prepare()` method returns a `PDOStatement` object.
3. Pass the values to the `UPDATE` statement by calling the `bindValue()` method of the `PDOStatement` object.
4. Execute the `UPDATE` statement by calling the `execute()` method of the `PDOStatement` object.
5. Get the number of rows updated using the `rowCount()` method of the `PDOStatement` object.

## Updating data example

We will use the `stocks` table that we created in the [creating table tutorial](create-tables) for the demonstration.

The `updateStock()` method of the `PostgreSQLPHPUpdate` class updates the data in the `stocks` table based on a specified id.

```phpsqlsql
<?php

namespace PostgreSQLTutorial;

/**
 * PostgreSQL PHP Update Demo
 */
class PostgreSQLPHPUpdate {

    /**
     * PDO object
     * @var \PDO
     */
    private $pdo;

    /**
     * Initialize the object with a specified PDO object
     * @param \PDO $pdo
     */
    public function __construct($pdo) {
        $this->pdo = $pdo;
    }

    /**
     * Update stock based on the specified id
     * @param int $id
     * @param string $symbol
     * @param string $company
     * @return int
     */
    public function updateStock($id, $symbol, $company) {

        // sql statement to update a row in the stock table
        $sql = 'UPDATE stocks '
                . 'SET company = :company, '
                . 'symbol = :symbol '
                . 'WHERE id = :id';

        $stmt = $this->pdo->prepare($sql);

        // bind values to the statement
        $stmt->bindValue(':symbol', $symbol);
        $stmt->bindValue(':company', $company);
        $stmt->bindValue(':id', $id);
        // update data in the database
        $stmt->execute();

        // return the number of row affected
        return $stmt->rowCount();
    }
}
```

We use the `PostgreSQLPHPUpdate` class in the `index.php` file as follows:

```php
<?php

require 'vendor/autoload.php';

use PostgreSQLTutorial\Connection as Connection;
use PostgreSQLTutorial\PostgreSQLPHPUpdate as PostgreSQLPHPUpdate;

try {
    // connect to the PostgreSQL database
    $pdo = Connection::get()->connect();

    //
    $updateDemo = new PostgreSQLPHPUpdate($pdo);

    // insert a stock into the stocks table
    $affectedRows = $updateDemo->updateStock(2, 'GOOGL', 'Alphabet Inc.');

    echo 'Number of row affected ' . $affectedRows;
} catch (\PDOException $e) {
    echo $e->getMessage();
}
```

In the index.php script, we connected to the PostgreSQL database and called the `updateStock()` method of the `PostgreSQLPHPUpdate` class to update the company name of the stock id 2 from `Google Inc.` to `Alphabet Inc.`

![PostgreSQL PHP Update](/postgresqltutorial/PostgreSQL-PHP-Update.png)
Before running the script, we query data from the stocks table to see its current data.

```
SELECT
    id, symbol, company
FROM
    stocks;
```

```text
 id | symbol |        company
----+--------+-----------------------
  1 | MSFT   | Microsoft Corporation
  2 | GOOG   | Google Inc.
  3 | YHOO   | Yahoo! Inc.
  4 | FB     | Facebook, Inc.
(4 rows)
```

Launch the `index.php` file in a web browser; we get the following output.

```
Number of row affected 1
```

Let’s recheck the stocks table.

```
 id | symbol |        company
----+--------+-----------------------
  1 | MSFT   | Microsoft Corporation
  2 | GOOGL  | Alphabet Inc.
  3 | YHOO   | Yahoo! Inc.
  4 | FB     | Facebook, Inc.
(4 rows)
```

The company name of stock with id 2 has been updated to the new one.

In this tutorial, you have learned how to update data in a PostgreSQL table using the prepared statement in PHP PDO.


# Handle Transaction in PHP

---
title: 'PostgreSQL PHP: Transaction'
page_title: 'PostgreSQL PHP: Transaction'
page_description: 'In this tutorial, you will learn how to perform transactions in the PostgreSQL using PHP PDO.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-php/transaction/'
ogImage: ''
updatedOn: '2024-01-30T01:08:33+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL PHP: Querying Data'
  slug: 'postgresql-php/query'
nextLink:
  title: 'PostgreSQL PHP: Calling Stored Procedures'
  slug: 'postgresql-php/call-stored-procedures'
---

**Summary**: in this tutorial, you will learn how to perform transactions in PostgreSQL using PHP PDO.

A transaction is a series of operations performed as a single logical unit of work. A transaction has four characteristics:

- Atomicity
- Consistency
- Isolation
- Durability

These characteristics are referred to as ([ACID](https://en.wikipedia.org/wiki/ACID)).

By default, PostgreSQL uses the auto\-commit mode. This means that for every statement that the application issues, PostgreSQL commits it automatically.

To turn off the auto\-commit mode in PHP, you call the `beginTransaction()` method of the PDO object. By doing this, the change to the database is made only when the `commit()` method of the PDO object is called.

If there is an exception or error, you can cancel the change using the `rollback()` method of the PDO object.

The typical usage of the transaction in PHP PDO is as follows:

```phpsqlsql
<?php

try {
    $pdo->beginTransaction();

    $pdo->query("SELECT * FROM table");

    $stmt = $pdo->prepare("UPDATE QUERY");
    $stmt->execute();

    $stmt = $pdo->prepare("ANOTHER UPDATE QUERY");
    $stmt->execute();

    $db->commit();
} catch (\PDOException $e) {
    $db->rollBack();
    throw $e;
}
```

## PostgreSQL PHP transaction example

We’ll create the following tables for the demonstration:

1. `accounts`: stores the account information such as first name, last name
2. `plans`: stores the plan information for the account such as silver, gold, and platinum.
3. `account_plans` : stores the plan for each account with the effective date.

The following [CREATE TABLE](../postgresql-tutorial/postgresql-create-table) statements create the three tables:

```php
CREATE TABLE accounts(
   id SERIAL PRIMARY KEY,
   first_name CHARACTER VARYING(100),
   last_name CHARACTER VARYING(100)
);

CREATE TABLE plans(
   id SERIAL PRIMARY KEY,
   plan CHARACTER VARYING(10) NOT NULL
);

CREATE TABLE account_plans(
   account_id INTEGER NOT NULL,
   plan_id INTEGER NOT NULL,
   effective_date DATE NOT NULL,
   PRIMARY KEY (account_id,plan_id),
   FOREIGN KEY(account_id) REFERENCES accounts(id),
   FOREIGN KEY(plan_id) REFERENCES plans(id)
);
```

The following [INSERT](insert) statement inserts some sample data into the `plans` table.

```sql
INSERT INTO plans(plan) VALUES('SILVER'),('GOLD'),('PLATINUM');
```

When creating an account, you need to assign a plan that can be silver, gold, or platinum. To ensure that an account always has at least one plan at a time, you use the transaction API in PDO.

The following `addAccount()` method performs two main steps:

- First, insert an account into the `accounts` table and return the account id.
- Then, assign the account a specific plan by inserting a new row into the `account_plans` table.

At the beginning of the method, you call the `beginTransaction()` method of the PDO object to start the transaction.

If all the steps succeed, you call the `commit()` method to save the changes. If an exception occurs in any step, you roll back the changes by calling the `rollback()` method in the `catch` block:

```text
   /**
     * Add a new account
     * @param string $firstName
     * @param string $lastName
     * @param int $planId
     * @param date $effectiveDate
     */
    public function addAccount($firstName, $lastName, $planId, $effectiveDate) {
        try {
            // start the transaction
            $this->pdo->beginTransaction();

            // insert an account and get the ID back
            $accountId = $this->insertAccount($firstName, $lastName);

            // add plan for the account
            $this->insertPlan($accountId, $planId, $effectiveDate);

            // commit the changes
            $this->pdo->commit();
        } catch (\PDOException $e) {
            // rollback the changes
            $this->pdo->rollBack();
            throw $e;
        }
    }
```

The `addAccount()` method uses two other private methods: `insertAccount()` and `insertPlan()` as shown in the following:

```php
   /**
     *
     * @param string $firstName
     * @param string $lastName
     * @return int
     */
    private function insertAccount($firstName, $lastName) {
        $stmt = $this->pdo->prepare(
                'INSERT INTO accounts(first_name,last_name) '
                . 'VALUES(:first_name,:last_name)');

        $stmt->execute([
            ':first_name' => $firstName,
            ':last_name' => $lastName
        ]);

        return $this->pdo->lastInsertId('accounts_id_seq');
    }
```

```php
   /**
     * insert a new plan for an account
     * @param int $accountId
     * @param int $planId
     * @param int $effectiveDate
     * @return bool
     */
    private function insertPlan($accountId, $planId, $effectiveDate) {
        $stmt = $this->pdo->prepare(
                'INSERT INTO account_plans(account_id,plan_id,effective_date) '
                . 'VALUES(:account_id,:plan_id,:effective_date)');

        return $stmt->execute([
                    ':account_id' => $accountId,
                    ':plan_id' => $planId,
                    ':effective_date' => $effectiveDate,
        ]);
    }
```

To test the `AccountDB` class, you use the following code in the `index.php` file.

```php
<?php

require 'vendor/autoload.php';

use PostgreSQLTutorial\Connection as Connection;
use PostgreSQLTutorial\AccountDB as AccountDB;

try {
    // connect to the PostgreSQL database
    $pdo = Connection::get()->connect();

    $accountDB = new AccountDB($pdo);

    // add accounts
    $accountDB->addAccount('John', 'Doe', 1, date('Y-m-d'));
    $accountDB->addAccount('Linda', 'Williams', 2, date('Y-m-d'));
    $accountDB->addAccount('Maria', 'Miller', 3, date('Y-m-d'));


    echo 'The new accounts have been added.' . '<br>';
    //
    $accountDB->addAccount('Susan', 'Wilson', 99, date('Y-m-d'));
} catch (\PDOException $e) {
    echo $e->getMessage();
}
```

How it works.

- First, connect to the PostgreSQL database.
- Second, insert three accounts with silver, gold, and platinum levels.
- Third, try to insert one more account but with a plan ID that does not exist in the `plans` table. Based on the input, the step of assigning the plan to the account fails which causes the whole transaction to be rolled back.

The following shows the output of the index.php file:

```
The new accounts have been added.

SQLSTATE[23503]: Foreign key violation: 7 ERROR: insert or update on table "account_plans" violates foreign key constraint "account_plans_plan_id_fkey" DETAIL: Key (plan_id)=(99) is not present in table "plans".
```

If you query the data in the `accounts` and `account_plans` tables, you will see only three rows inserted in each table:

```
stocks=# SELECT * FROM accounts;
 id | first_name | last_name
----+------------+-----------
  1 | John       | Doe
  2 | Linda      | Williams
  3 | Maria      | Miller
(3 rows)

stocks=# SELECT * FROM account_plans;
 account_id | plan_id | effective_date
------------+---------+----------------
          1 |       1 | 2016-06-13
          2 |       2 | 2016-06-13
          3 |       3 | 2016-06-13
(3 rows)
```

## Summary

- Use the `beginTransaction`() method of the PDO object to start a transaction.
- Use the `commit()` method to apply the changes to the database and `rollback()` method to undo the changes.


# Query Data From PostgresQL using PDO

---
title: 'PostgreSQL PHP: Querying Data'
page_title: 'PostgreSQL PHP: Queying Data From PostgreSQL Tables'
page_description: 'In this tutorial, you will step by step learn how to query data from the tables in the PostgreSQL database using PHP PDO.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-php/query/'
ogImage: '/postgresqltutorial/PostgreSQL-PHP-Query-Example.png'
updatedOn: '2022-02-09T14:55:54+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL PHP: Updating Data In a Table'
  slug: 'postgresql-php/update'
nextLink:
  title: 'PostgreSQL PHP: Transaction'
  slug: 'postgresql-php/transaction'
---

**Summary**: in this tutorial, you will learn to query data from the PostgreSQL database in PHP using PDO.

## Querying all rows in a table

To query all rows from a table in the PostgreSQL database, you use the following steps:

1. First, [connect to the PostgreSQL database](connect) by creating a new PDO object.
2. Second, call the `query()` method of the PDO object. The query() method accepts a [SELECT](../postgresql-tutorial/postgresql-select) statement as the argument. The query method returns a `PDOStatement` object.
3. Third, fetch the next rows from the result by calling the fetch() method of the PDOstatement object. The fetch_style argument of the `fetch()` method controls how the result returned. For example, the `PDO::FETCH_ASSOC` instructs the `fetch()` method to return the result set as an array indexed by column name.

We will use the `stocks` table created in the [creating table tutorial](create-tables) for the demonstration. Let’s create a new class `StockDB` for storing all the methods that select data from the `stocks` table.

The following `all()` method selects all rows in the `stocks` table.

```phpsql
   /**
     * Return all rows in the stocks table
     * @return array
     */
    public function all() {
        $stmt = $this->pdo->query('SELECT id, symbol, company '
                . 'FROM stocks '
                . 'ORDER BY symbol');
        $stocks = [];
        while ($row = $stmt->fetch(\PDO::FETCH_ASSOC)) {
            $stocks[] = [
                'id' => $row['id'],
                'symbol' => $row['symbol'],
                'company' => $row['company']
            ];
        }
        return $stocks;
    }
```

To test the `all()` method, we use the following code in the `index.php` file.

![PostgreSQL PHP Query Example](/postgresqltutorial/PostgreSQL-PHP-Query-Example.png)

```php
<?php
require 'vendor/autoload.php';

use PostgreSQLTutorial\Connection as Connection;
use PostgreSQLTutorial\StockDB as StockDB;

try {
    // connect to the PostgreSQL database
    $pdo = Connection::get()->connect();
    //
    $stockDB = new StockDB($pdo);
    // get all stocks data
    $stocks = $stockDB->all();
} catch (\PDOException $e) {
    echo $e->getMessage();
}
?>
<!DOCTYPE html>
<html>
    <head>
        <title>PostgreSQL PHP Querying Data Demo</title>
        <link rel="stylesheet" href="https://cdn.rawgit.com/twbs/bootstrap/v4-dev/dist/css/bootstrap.css">
    </head>
    <body>
        <div class="container">
            <h1>Stock List</h1>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Symbol</th>
                        <th>Company</th>
                    </tr>
                </thead>
                <tbody>
                    <?php foreach ($stocks as $stock) : ?>
                        <tr>
                            <td><?php echo htmlspecialchars($stock['id']) ?></td>
                            <td><?php echo htmlspecialchars($stock['symbol']); ?></td>
                            <td><?php echo htmlspecialchars($stock['company']); ?></td>
                        </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
        </div>
    </body>
</html>
```

The first part of the index.php is to connect to the PostgreSQL database and get all rows in the stocks table. The second part shows the data in HTML format.

The following screenshot illustrates the output of the index.php file.

![PostgreSQL PHP Query all rows example](/postgresqltutorial/PostgreSQL-PHP-Query-all-rows-example.png)

## Querying a specific row in a table

To query a specific row in a table, you use the following steps:

1. First, connect to the PostgreSQL database by creating a new PDO object.
2. Next, prepare the SELECT statement for execution by calling the `prepare()` method of the PDO object. The `prepare()` method returns an instance of the PDOStatement class.
3. Then, bind the values to the statement by using the `bindValue()` method.
4. After that, execute the SELECT statement by calling the `execute()` method of the PDOStatement object.
5. Finally, fetch the next row in the result using the `fetch()` method. If the SELECT statement returns 1 row, you can use the fetchObject() method to return an object.

The following `findByPK()` method selects a row in the stocks table based on a specified id and returns a Stock object.

```
   /**
     * Find stock by id
     * @param int $id
     * @return a stock object
     */
    public function findByPK($id) {
        // prepare SELECT statement
        $stmt = $this->pdo->prepare('SELECT id, symbol, company
                                       FROM stocks
                                      WHERE id = :id');
        // bind value to the :id parameter
        $stmt->bindValue(':id', $id);

        // execute the statement
        $stmt->execute();

        // return the result set as an object
        return $stmt->fetchObject();
    }
```

To test the `findByPK()` method, we create a new PHP file named `stock.php`.

```php
<?php
require 'vendor/autoload.php';

use PostgreSQLTutorial\Connection as Connection;
use PostgreSQLTutorial\StockDB as StockDB;

try {
    // connect to the PostgreSQL database
    $pdo = Connection::get()->connect();
    //
    $stockDB = new StockDB($pdo);
    // get all stocks data
    $stock = $stockDB->findByPK(1);

    var_dump($stock);

} catch (\PDOException $e) {
    echo $e->getMessage();
}
```

Run the stock.php file, we get the following result.

```php
object(stdClass)[6]
  public 'id' => int 1
  public 'symbol' => string 'MSFT' (length=4)
  public 'company' => string 'Microsoft Corporation' (length=21)
```

In this tutorial, you have learned various ways to query data from the tables in the PostgreSQL database using PHP PDO.


# Call PostgreSQL Stored Procedures in PHP

---
title: 'PostgreSQL PHP: Calling Stored Procedures'
page_title: 'PostgreSQL PHP: Calling Stored Procedures'
page_description: ''
prev_url: 'https://www.postgresqltutorial.com/postgresql-php/call-stored-procedures/'
ogImage: '/postgresqltutorial/PostgreSQL-PHP-store-procedure.png'
updatedOn: '2024-01-30T00:56:37+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL PHP: Transaction'
  slug: 'postgresql-php/transaction'
nextLink:
  title: 'PostgreSQL PHP: Working with Binary Data'
  slug: 'postgresql-php/postgresql-blob'
---

**Summary**: in this tutorial, you will learn how to call stored procedures in PostgreSQL in PHP using PDO.

## Calling a stored procedure that returns one value

Let’s create a simple [stored procedure](call-stored-procedures) named `add()` that returns the product of two integers using plpgsql.

```phpsql
CREATE OR REPLACE FUNCTION add(
    a INTEGER,
    b INTEGER)
  RETURNS integer AS $$
BEGIN
return a + b;
END; $$
  LANGUAGE 'plpgsql';
```

To call a stored procedure that returns one value, you use these steps:

1. [Connect to the PostgreSQL database server](connect) by creating a new instance of the PDO class.
2. Prepare the statement that calls the stored procedure for execution using the `prepare()` method of the PDO object. The `prepare()` method returns a `PDOStatement` object.
3. Optionally pass values to the statement using the `bindValue()` method.
4. Execute the statement using the `execute()` method of the `PDOStatement` object. You can pass the values to the statement when calling the `execute()` method as well.
5. Get the value using the `fetchColumn()` method that returns a single column of the next row in the result set.

The following `add()` method demonstrates how to call the `add()` stored procedure in PostgreSQL database.

```text
   /**
     * Call a simple stored procedure
     * @param int $a
     * @param int $b
     * @return int
     */
    public function add($a, $b) {
        $stmt = $this->pdo->prepare('SELECT * FROM add(:a,:b)');
        $stmt->setFetchMode(\PDO::FETCH_ASSOC);
        $stmt->execute([
            ':a' => $a,
            ':b' => $b
        ]);
        return $stmt->fetchColumn(0);
    }
```

To test the `add()` method, you use the following code in the `index.php` file:

```php
<?php

require 'vendor/autoload.php';

use PostgreSQLTutorial\Connection as Connection;
use PostgreSQLTutorial\StoreProc as StoreProc;

try {
    // connect to the PostgreSQL database
    $pdo = Connection::get()->connect();
    //
    $storeProc = new StoreProc($pdo);

    $result = $storeProc->add(20, 30);
    echo $result;

} catch (\PDOException $e) {
    echo $e->getMessage();
}
```

## Calling a stored procedure that returns a result set

We will use the `accounts`, `plans`, and `account_plans` tables for the sake of demonstration. The following `get_accounts()` stored procedure returns a result set that contains complete data of accounts.

```php
CREATE OR REPLACE FUNCTION get_accounts()
  RETURNS TABLE(id integer,
                first_name character varying,
                last_name character varying,
                plan character varying,
                effective_date date) AS
$$
BEGIN
 RETURN QUERY

 SELECT a.id,a.first_name,a.last_name, p.plan, ap.effective_date
 FROM accounts a
 INNER JOIN account_plans ap on a.id = account_id
 INNER JOIN plans p on p.id = plan_id
 ORDER BY a.id, ap.effective_date;
END; $$

LANGUAGE plpgsql;
```

The steps of calling a stored procedure that returns a result set are the same as the steps of [querying data](query).

The following `getAccounts()` method demonstrates how to call the `get_accounts()` stored procedure in PHP.

```text
   /**
     * Call a stored procedure that returns a result set
     * @return array
     */
    function getAccounts() {
        $stmt = $this->pdo->query('SELECT * FROM get_accounts()');
        $accounts = [];
        while ($row = $stmt->fetch()) {
            $accounts[] = [
                'id' => $row['id'],
                'first_name' => $row['first_name'],
                'last_name' => $row['last_name'],
                'plan' => $row['plan'],
                'effective_date' => $row['effective_date']
            ];
        }
        return $accounts;
    }
```

To test the `getAccounts()` method, you use the following code in the `account.php` file.

```
<?php
require 'vendor/autoload.php';

use PostgreSQLTutorial\Connection as Connection;
use PostgreSQLTutorial\StoreProc as StoreProc;

try {
    // connect to the PostgreSQL database
    $pdo = Connection::get()->connect();
    //
    $storeProc = new StoreProc($pdo);

    $accounts = $storeProc->getAccounts();

} catch (\PDOException $e) {
    echo $e->getMessage();
}
?>
<!DOCTYPE html>
<html>
    <head>
        <title>PostgreSQL PHP: calling stored procedure demo</title>
        <link rel="stylesheet" href="https://cdn.rawgit.com/twbs/bootstrap/v4-dev/dist/css/bootstrap.css">
    </head>
    <body>
        <div class="container">
            <h1>Account List</h1>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Plan</th>
                        <th>Effective Date</th>
                    </tr>
                </thead>
                <tbody>
                    <?php foreach ($accounts as $account) : ?>
                        <tr>
                            <td><?php echo htmlspecialchars($account['id']) ?></td>
                            <td><?php echo htmlspecialchars($account['first_name']); ?></td>
                            <td><?php echo htmlspecialchars($account['last_name']); ?></td>
                            <td><?php echo htmlspecialchars($account['plan']); ?></td>
                            <td><?php echo htmlspecialchars($account['effective_date']); ?></td>
                        </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
        </div>
    </body>
</html>
```

![D:\ref\projects\postgresql\php\stored procedure](/postgresqltutorial/PostgreSQL-PHP-store-procedure.png)In this tutorial, we have shown you how to call stored procedures from PostgreSQL using PHP PDO.


# Manage with BLOB in PHP

---
title: 'PostgreSQL PHP: Working with Binary Data'
page_title: 'PostgreSQL PHP: Working with Binary Data'
page_description: 'In this tutorial, you will learn how to work with PostgreSQL BLOB using PHP such inserting BLOB, querying BLOB, and deleting BLOB.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-php/postgresql-blob/'
ogImage: '/postgresqltutorial/PostgreSQL-PHP-BLOB.png'
updatedOn: '2024-04-20T13:44:59+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL PHP: Calling Stored Procedures'
  slug: 'postgresql-php/call-stored-procedures'
nextLink:
  title: 'PostgreSQL PHP: Delete Data From a Table'
  slug: 'postgresql-php/delete'
---

**Summary**: in this tutorial, you will learn how to store binary data in the PostgreSQL database using PHP.

BLOB stands for the binary large object used to store binary data such as the content of a file.

PostgreSQL does not support the BLOB data type. However, you can use the [BYTEA data type](../postgresql-tutorial/postgresql-bytea-data-type) for storing the binary string.

We’ll [create a new table](../postgresql-tutorial/postgresql-create-table) called `company_files` to store the binary string:

```phpsql
CREATE TABLE company_files (
   id SERIAL PRIMARY KEY,
   stock_id INT NOT NULL,
   mime_type VARCHAR(255) NOT NULL,
   file_name VARCHAR (255) NOT NULL,
   file_data BYTEA NOT NULL,
   FOREIGN KEY (stock_id) REFERENCES stocks (id)
);
```

We will store the content of a file in the `file_data` column. In addition, we will read the files from the `assets/images` folder and insert them into the `company_files` table.

To work with the binary data, we create a new class named `BlobDB`.

![PostgreSQL PHP BLOB](/postgresqltutorial/PostgreSQL-PHP-BLOB.png)

## Inserting binary data

The following `insert()` method reads data from a file specified by the `$pathToFile` parameter and inserts it into the `company_files` table.

```text
   /**
     * Insert a file into the company_files table
     * @param int $stockId
     * @param string $fileName
     * @param string $mimeType
     * @param string $pathToFile
     * @return int
     * @throws \Exception
     */
    public function insert($stockId, $fileName, $mimeType, $pathToFile) {
        if (!file_exists($pathToFile)) {
            throw new \Exception("File %s not found.");
        }

        $sql = "INSERT INTO company_files(stock_id,mime_type,file_name,file_data) "
                . "VALUES(:stock_id,:mime_type,:file_name,:file_data)";

        try {
            $this->pdo->beginTransaction();

            // create large object
            $fileData = $this->pdo->pgsqlLOBCreate();
            $stream = $this->pdo->pgsqlLOBOpen($fileData, 'w');

            // read data from the file and copy the stream
            $fh = fopen($pathToFile, 'rb');
            stream_copy_to_stream($fh, $stream);
            //
            $fh = null;
            $stream = null;

            $stmt = $this->pdo->prepare($sql);

            $stmt->execute([
                ':stock_id' => $stockId,
                ':mime_type' => $mimeType,
                ':file_name' => $fileName,
                ':file_data' => $fileData,
            ]);

            // commit the transaction
            $this->pdo->commit();
        } catch (\Exception $e) {
            $this->pdo->rollBack();
            throw $e;
        }

        return $this->pdo->lastInsertId('company_files_id_seq');
    }
```

How it works.

1. First, call the pgsqlLOBCreate() method of the PDO object to create a new large object and get the OID of the large object.
2. Next, call the pgsqlLOBopen() method to open a stream on the large object to write data to it.
3. Then, read data from a file and copy the data from the file stream to the large binary object.
4. After that, prepare the INSERT statement and execute it.
5. Finally, call the lastInsertId to get the generated ID.

Note that the `pgsqlLOBCreate()` method must be called within a transaction, therefore, we place all the logic within a transaction.

Place the following code in the `index.php` file to insert the content of the `google.png` file into the `company_files` table.

```php
<?php

require 'vendor/autoload.php';

use PostgreSQLTutorial\Connection as Connection;
use PostgreSQLTutorial\BlobDB as BlobDB;

try {
    // connect to the PostgreSQL database
    $pdo = Connection::get()->connect();
    //
    $blobDB = new BlobDB($pdo);
    $fileId = $blobDB->insert(2, 'logo', 'image/png', 'assets/images/google.png');

    echo 'A file has been inserted with id ' . $fileId;
} catch (\PDOException $e) {
    echo $e->getMessage();
}
```

Launch the index.php file, we get the following message.

```sql
A file has been inserted with id 1
```

To verify the insert operation, we use the following query:

```sql
SELECT * FROM company_files;
```

```
 id | stock_id | mime_type | file_name |  file_data
----+----------+-----------+-----------+--------------
  1 |        2 | image/png | logo      | \x3137323730
(1 row)
```

## Querying binary data

The following `read()` method reads the BLOB data from the `company_files` table and outputs the file content to the web browser:

```
    /**
     * Read BLOB from the database and output to the web browser
     * @param int $id
     */
    public function read($id) {

        $this->pdo->beginTransaction();

        $stmt = $this->pdo->prepare("SELECT id, file_data, mime_type "
                . "FROM company_files "
                . "WHERE id= :id");

        // query blob from the database
        $stmt->execute([$id]);

        $stmt->bindColumn('file_data', $fileData, \PDO::PARAM_STR);
        $stmt->bindColumn('mime_type', $mimeType, \PDO::PARAM_STR);
        $stmt->fetch(\PDO::FETCH_BOUND);
        $stream = $this->pdo->pgsqlLOBOpen($fileData, 'r');

        // output the file
        header("Content-type: " . $mimeType);
        fpassthru($stream);
    }
```

How it works.

1. First, prepare a [SELECT](../postgresql-tutorial/postgresql-select) statement.
2. Next, execute the `SELECT` statement by calling the `execute()` method.
3. Then, pass the OID to the `pgsqlLOBOpen()` method of a PDO object to get the stream.
4. After that, output the stream based on the mime type of the file.
5. Finally, because the `pgsqlLOBopen()` must be called within a transaction, we called the `beginTransaction()` at the beginning of the method.

To test the read() method, we place the following code in the file.php:

```php
<?php

require 'vendor/autoload.php';

use PostgreSQLTutorial\Connection as Connection;
use PostgreSQLTutorial\BlobDB as BlobDB;

$pdo = Connection::get()->connect();
$blobDB = new BlobDB($pdo);

// get document id from the query string
$id = filter_input(INPUT_GET, 'id', FILTER_SANITIZE_NUMBER_INT);

$file = $blobDB->read($id);
```

The file.php file gets the id value from the query string and outputs the file stored in the company_files table to the web browser.

![PostgreSQL BLOB example](/postgresqltutorial/PostgreSQL-BLOB-example.png)

## Deleting binary data

The following `delete()` method deletes a row in the `company_files` table.

```php
    /**
     * Delete the large object in the database
     * @param int $id
     * @throws \Exception
     */
    public function delete($id) {
        try {
            $this->pdo->beginTransaction();
            // select the file data from the database
            $stmt = $this->pdo->prepare('SELECT file_data '
                    . 'FROM company_files '
                    . 'WHERE id=:id');
            $stmt->execute([$id]);
            $stmt->bindColumn('file_data', $fileData, \PDO::PARAM_STR);
            $stmt->closeCursor();

            // delete the large object
            $this->pdo->pgsqlLOBUnlink($fileData);
            $stmt = $this->pdo->prepare("DELETE FROM company_files WHERE id = :id");
            $stmt->execute([$id]);

            $this->pdo->commit();
        } catch (\Exception $e) {
            $this->pdo->rollBack();
            throw $e;
        }
    }
```

How it works.

1. First, get the OID object from the `file_data` column.
2. Second, use the `pgsqlLOBUnLink()` method to remove the BLOB data and execute the `DELETE` statement to remove a row specified by an ID in the `company_files` table.

In this tutorial, you have learned how to insert, query, and delete binary data in the PostgreSQL database.


# Delete Data From a Table in PHP

---
title: 'PostgreSQL PHP: Delete Data From a Table'
page_title: 'PostgreSQL PHP: Delete Data In a Table'
page_description: 'In this tutorial, you will learn how to delete data from a PostgreSQL table in PHP application using PDO API.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-php/delete/'
ogImage: ''
updatedOn: '2024-01-30T00:55:55+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL PHP: Working with Binary Data'
  slug: 'postgresql-php/postgresql-blob'
nextLink:
  title: 'PostgreSQL Python'
  slug: 'postgresql-php/../postgresql-python'
---

**Summary**: This tutorial shows you how to delete data from a PostgreSQL table using the PHP PDO.

## Steps for deleting data in the PostgreSQL using PHP PDO

To delete data from a PostgreSQL table in PHP, you use the following steps:

1. [Connect to the PostgreSQL database server](connect) by creating an instance of the PDO class.
2. Prepare the [DELETE](../postgresql-tutorial/postgresql-delete) statement for execution by calling the `prepare()` method of the PDO object. The `prepare()` method returns a `PDOStatement` object.
3. Bind values to the DELETE statement by calling the `bindValue()` method of the `PDOStatement` object.
4. Execute the `DELETE` statement by calling the `execute()` method.
5. Get the number of rows deleted using the `rowCount()` method.

## Deleting data examples

We will use the `stocks` table for the demonstration. If you have not created the `stocks` table yet, you can follow the [creating table tutorial](create-tables).

Let’s create a new class named StockDB that contains all the methods for deleting data in a table.

```phpsql
<?php
namespace PostgreSQLTutorial;

/**
 * PostgreSQL PHP delete data demo
 */
class StockDB {

    /**
     * PDO object
     * @var \PDO
     */
    private $pdo;

    /**
     * Initialize the object with a specified PDO object
     * @param \PDO $pdo
     */
    public function __construct($pdo) {
        $this->pdo = $pdo;
    }
    // other methods
    // ...
}
```

The following `delete()` method deletes a row specified by id from the `stocks` table

```php
   /**
     * Delete a row in the stocks table specified by id
     * @param int $id
     * @return the number row deleted
     */
    public function delete($id) {
        $sql = 'DELETE FROM stocks WHERE id = :id';

        $stmt = $this->pdo->prepare($sql);
        $stmt->bindValue(':id', $id);

        $stmt->execute();

        return $stmt->rowCount();
    }
```

The following `deleteAll()` method deletes all rows from the `stocks` table.

```php
   /**
     * Delete all rows in the stocks table
     * @return int the number of rows deleted
     */
    public function deleteAll() {

        $stmt = $this->pdo->prepare('DELETE FROM stocks');
        $stmt->execute();
        return $stmt->rowCount();
    }
```

Before running the methods, we query the data from the `stocks` table.

```php
stocks=# SELECT * FROM stocks
stocks-# ORDER BY id;
 id | symbol |        company
----+--------+-----------------------
  1 | MSFT   | Microsoft Corporation
  2 | GOOGL  | Alphabet Inc.
  3 | YHOO   | Yahoo! Inc.
  4 | FB     | Facebook, Inc.
(4 rows)
```

Use the following code in the index.php file to delete the row with id 1\.

```sql
<?php

require 'vendor/autoload.php';

use PostgreSQLTutorial\Connection as Connection;
use PostgreSQLTutorial\StockDB as StockDB;

try {
    // connect to the PostgreSQL database
    $pdo = Connection::get()->connect();
    //
    $stockDB = new StockDB($pdo);
    // delete a stock with a specified id
    $deletedRows = $stockDB->delete(1);
    echo 'The number of row(s) deleted: ' . $deletedRows . '<br>';

} catch (\PDOException $e) {
    echo $e->getMessage();
}

```

The following is the output:

```
The number of row(s) deleted: 1
```

We query data from the stocks table again to verify.

```sql
stocks=# SELECT * FROM stocks
stocks-# ORDER BY id;
 id | symbol |    company
----+--------+----------------
  2 | GOOGL  | Alphabet Inc.
  3 | YHOO   | Yahoo! Inc.
  4 | FB     | Facebook, Inc.
(3 rows)
```

The row with id 1 was deleted as expected.

In the `index.php` file, modify the code to call the `deleteAll()` method instead of the `delete()` method and execute it. The following is the output of the script:

```sql
The number of row(s) deleted: 3
```

The following shows the output when we query data from the `stocks` table.

```
stocks=# SELECT * FROM stocks
stocks-# ORDER BY id;
 id | symbol | company
----+--------+---------
(0 rows)
```

All rows in the stocks table have been deleted as expected.

In this tutorial, we have shown you how to delete data from a PostgreSQL table in the PHP application using PDO API.


# PostgreSQL Python

---
title: 'PostgreSQL Python'
page_title: 'PostgreSQL Python'
page_description: 'This PostgreSQL Python section shows how to work with PostgreSQL from Python programming language using the psycopg2 database driver.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-python/'
ogImage: 'https://www.postgresqltutorial.com//postgresqltutorial/PostgreSQL-Python.png'
updatedOn: '2024-05-19T08:36:25+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL PHP: Delete Data From a Table'
  slug: 'postgresql-php/delete'
nextLink:
  title: 'PostgreSQL Python: Connect to PostgreSQL Database Server'
  slug: 'postgresql-python/connect'
---

This PostgreSQL Python section shows you how to work with PostgreSQL using the [Python programming language](https://www.pythontutorial.net/).

Python has various database drivers for PostgreSQL. Currently, the [psycopg](http://initd.org/psycopg/) is the most popular PostgreSQL database adapter for the Python language. The psycopg fully implements the Python DB\-API 2\.0 specification.

The current version of the psycopg is 2 or psycopg2\. The psycopg2 database adapter is implemented in C as a [libpq](https://www.postgresql.org/docs/9.0/static/libpq.html) wrapper resulting in both fast and secure. The psycopg2 provides many useful features such as client\-side and server\-side [cursors](postgresql-plpgsql/plpgsql-cursor), asynchronous notification and communication, COPY command support, etc.

Besides, the psycopg2 driver supports many Python types out\-of\-the\-box. The psycopg2 matches Python objects to the [PostgreSQL data types](postgresql-tutorial/postgresql-data-types), e.g., list to the [array](postgresql-tutorial/postgresql-array), tuples to records, and dictionary to [hstore](postgresql-tutorial/postgresql-hstore).  If you want to customize and extend the type adaption, you can use a flexible object adaption system.

This PostgreSQL Python section covers the most common activities for interacting with PostgreSQL in Python applications:

- [Connecting to the PostgreSQL database server](postgresql-python/connect) – show you how to connect to the PostgreSQL database server from Python.
- [Creating new PostgreSQL tables in Python](postgresql-python/create-tables) – show you how to create new tables in PostgreSQL from Python.
- [Inserting data into the PostgreSQL table in Python](postgresql-python/insert) – explain to you how to insert data into a PostgreSQL database table in Python.
- [Updating data in the PostgreSQL table in Python](postgresql-python/update) – learn various ways to update data in the PostgreSQL table.
- [Transaction](postgresql-python/transaction) – show you how to perform transactions in Python.
- [Calling a PostgreSQL function in Python](postgresql-python/postgresql-python-call-postgresql-functions) – show you step by step how to call a PostgreSQL function in Python.
- [Calling a PostgreSQL stored procedure in Python](postgresql-python/call-stored-procedures) – guide you on how to call a stored procedure from in a Python application.
- [Handling PostgreSQL BLOB data in Python](postgresql-python/blob)– give you an example of inserting and selecting the PostgreSQL BLOB data in a Python application.
- [Querying data from the PostgreSQL tables](postgresql-python/query) – walk you through the steps of querying data from the PostgreSQL tables in a Python application.
- [Deleting data from PostgreSQL tables in Python](postgresql-python/delete) – show you how to delete data in a table in Python.

For demonstration purposes, we will use the `suppliers` sample database. The following picture illustrates the structure of the `suppliers` database:

![PostgreSQL Python Sample Database Diagram](/postgresqltutorial/PostgreSQL-Python-Sample-Database-Diagram.png)The `suppliers` database has the following tables:

1. `vendors` table: stores vendor data.
2. `parts` table: stores parts data.
3. `parts_drawings` table: stores the drawing of a part.
4. `vendor_parts` table: stores the data of which parts are supplied by which vendor.


# Connect To PostgreSQL Database

---
title: 'PostgreSQL Python: Connect to PostgreSQL Database Server'
page_title: 'PostgreSQL Python: Connecting to PostgreSQL Server'
page_description: 'In this tutorial, you will learn how to connect to the PostgreSQL database server from Python using the psycopg2 package.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-python/connect/'
ogImage: ''
updatedOn: '2024-05-19T08:11:16+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Python'
  slug: 'postgresql-python/'
nextLink:
  title: 'PostgreSQL Python: Create Tables'
  slug: 'postgresql-python/create-tables'
---

**Summary**: in this tutorial, you will learn how to connect to the PostgreSQL server in Python using the `psycopg2` package.

## Creating a virtual environment

First, open the Command Prompt on Windows or Terminal on Unix\-like systems.

Second, create a new directory to store the project files such as `suppliers`:

```plaintextsql
mkdir suppliers
```

Third, [create a new virtual environment](https://www.pythontutorial.net/python-basics/python-virtual-environments/) called `venv` using the built\-in `venv` module:

```plaintext
python -m venv venv
```

Finally, activate the virtual environment on Windows:

```plaintext
venv/scripts/activate
```

on Unix\-like systems:

```plaintext
source venv/bin/activate
```

## Installing the psycopg2 module

First, install the `psycopg2` package using the following `pip` command:

```shell
pip install psycopg2
```

Second, create the `requirements.txt` file:

```python
pip freeze > requirements.txt
```

## Creating a new database

First, [connect to the PostgreSQL server](../postgresql-getting-started/connect-to-postgresql-database) using the `psql` client tool:

```python
psql -U postgres
```

Second, [create a new database](../postgresql-administration/postgresql-create-database) called `suppliers`:

```python
CREATE DATABASE suppliers;
```

Third, exit the `psql`:

```sql
exit
```

## Connecting to the PostgreSQL database from Python

First, create a configuration file called `database.ini` in the project directory to store database connection parameters:

```python
[postgresql]
host=localhost
database=suppliers
user=YourUsername
password=YourPassword
```

In the `database.ini` file, you need to replace the `YourUsername` and `YourPassword` with the real ones.

Second, create a new file called `config.py` in the project directory and define a function called `load_config()` that reads configuration data from the `database.ini` file:

```python
from configparser import ConfigParser

def load_config(filename='database.ini', section='postgresql'):
    parser = ConfigParser()
    parser.read(filename)

    # get section, default to postgresql
    config = {}
    if parser.has_section(section):
        params = parser.items(section)
        for param in params:
            config[param[0]] = param[1]
    else:
        raise Exception('Section {0} not found in the {1} file'.format(section, filename))

    return config

if __name__ == '__main__':
    config = load_config()
    print(config)
```

The `config.py` module uses the built\-in `configparser` module to read data from the `database.ini` file.

By using the `database.ini`, you can change the PostgreSQL connection parameters when moving the code to different environments such as testing or production.

Notice that if you git source control, you need to add the `database.ini` to the `.gitignore` file to avoid committing sensitive information to a public repository like GitHub:

```python
database.ini
```

Third, create a new file called `connect.py` that uses the `config.py` module to read the database configuration and connect to the PostgreSQL:

```python
import psycopg2
from config import load_config

def connect(config):
    """ Connect to the PostgreSQL database server """
    try:
        # connecting to the PostgreSQL server
        with psycopg2.connect(**config) as conn:
            print('Connected to the PostgreSQL server.')
            return conn
    except (psycopg2.DatabaseError, Exception) as error:
        print(error)


if __name__ == '__main__':
    config = load_config()
    connect(config)
```

To connect to the `suppliers` database, you use the `connect()` function of the `psycopg2` module.

The `connect()` function creates a new database session and returns a new instance of the `connection` class.

To call the `connect()` function, you specify the PostgreSQL database parameters as a connection string and pass it to the function like this:

```python
conn = psycopg2.connect("dbname=suppliers user=YourUsername password=YourPassword")
```

Alternatively, you can use keyword arguments:

```
conn = psycopg2.connect(
    host="localhost",
    database="suppliers",
    user="YourUsername",
    password="YourPassword"
)
```

The following is the list of the connection parameters:

- `database`: the name of the database that you want to connect.
- `user`: the username used to authenticate.
- `password`: password used to authenticate.
- `host`: database server address e.g., localhost or an IP address.
- `port`: the port number that defaults to 5432 if it is not provided.

Since we use the `config.py` module, we can pass the configuration to the `connect()` function and unpack it using the `**` operator:

```python
with psycopg2.connect(**config) as conn:
```

In `psycopg2`, the `with` statement doesn't automatically close the database connection — only the transaction is closed. However, in `psycopg3`, using `with connection` will close the connection at the end of the `with` block. See [with connection](https://www.psycopg.org/docs/usage.html#with-statement) in the `psycopg` documentation for details.

### Executing the connect.py module

To execute the `connect.py` file, you use the following command:

```shell
python connect.py
```

Output:

```shell
Connected to the PostgreSQL server.
```

The output indicates that you have successfully connected to the PostgreSQL server.

[Download the project source code](/postgresqltutorial/connect.zip)

## Summary

- Use the `psycopg2` package to connect to the PostgreSQL server from Python.
- Call the `connect()` function of the `psycopg2` module to connect to the PostgreSQL server.


# Create Tables in Python

---
title: 'PostgreSQL Python: Create Tables'
page_title: 'PostgreSQL Python: Create Tables'
page_description: 'In this tutorial, you will learn how to create new tables in the PostgreSQL database using Python.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-python/create-tables/'
ogImage: '/postgresqltutorial/PostgreSQL-Python-Sample-Database-Diagram.png'
updatedOn: '2024-05-19T08:12:15+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Python: Connect to PostgreSQL Database Server'
  slug: 'postgresql-python/connect'
nextLink:
  title: 'PostgreSQL Python: Insert Data Into a Table'
  slug: 'postgresql-python/insert'
---

**Summary**: in this tutorial, you will learn how to create new tables in the PostgreSQL database using Python.

This tutorial picks up from where the [Connecting to PostgreSQL database server tutorial](connect) left off.

## Steps for creating tables in PostgreSQL from Python

To create a new table in a PostgreSQL database, you use the following steps:

- First, [connect to the PostgreSQL server](connect) by calling the `connect()` function. The `connect()` function returns a `connection` object.
- Second, create a `cursor` object by calling the `cursor()` method of the `connection` object.
- Third, execute the `CREATE TABLE` by calling the `execute()` method of the `cursor` object.
- Finally, close the connection.

If you use the `with` statement, you don’t need to explicitly close the connection.

## Creating tables in Python example

Let’s take an example of creating tables from Python.

### 1\) Create a Python program

First, create a new file in the project directory called `create_tables.py`.

Second, define a new function called `create_tables()` in the `create_tables.py` module:

```python
import psycopg2
from config import load_config

def create_tables():
    """ Create tables in the PostgreSQL database"""
    commands = (
        """
        CREATE TABLE vendors (
            vendor_id SERIAL PRIMARY KEY,
            vendor_name VARCHAR(255) NOT NULL
        )
        """,
        """ CREATE TABLE parts (
                part_id SERIAL PRIMARY KEY,
                part_name VARCHAR(255) NOT NULL
                )
        """,
        """
        CREATE TABLE part_drawings (
                part_id INTEGER PRIMARY KEY,
                file_extension VARCHAR(5) NOT NULL,
                drawing_data BYTEA NOT NULL,
                FOREIGN KEY (part_id)
                REFERENCES parts (part_id)
                ON UPDATE CASCADE ON DELETE CASCADE
        )
        """,
        """
        CREATE TABLE vendor_parts (
                vendor_id INTEGER NOT NULL,
                part_id INTEGER NOT NULL,
                PRIMARY KEY (vendor_id , part_id),
                FOREIGN KEY (vendor_id)
                    REFERENCES vendors (vendor_id)
                    ON UPDATE CASCADE ON DELETE CASCADE,
                FOREIGN KEY (part_id)
                    REFERENCES parts (part_id)
                    ON UPDATE CASCADE ON DELETE CASCADE
        )
        """)
    try:
        config = load_config()
        with psycopg2.connect(**config) as conn:
            with conn.cursor() as cur:
                # execute the CREATE TABLE statement
                for command in commands:
                    cur.execute(command)
    except (psycopg2.DatabaseError, Exception) as error:
        print(error)

if __name__ == '__main__':
    create_tables()
```

How it works.

First, initialize a list of `CREATE TABLE` statements:

```python
commands = ...
```

Next, read the connection parameters using the `load_config()` function of the `config` module:

```python
config = load_config()
```

Then, connect to the PostgreSQL server using the `connect()` function of the `psycopg2` module. The `connect()` function returns a `connection` object:

```python
with psycopg2.connect(**config) as conn:
```

The `with` statement will close the database connection automatically.

After that, create a new `cursor` object from the `connection` object using the `cursor()` function:

```python
with conn.cursor() as cur:
```

The `with` statement will also automatically close the cursor once it is no longer in use.

Finally, iterate over the command in the `commands` list and execute each of them using the `execute()` method:

```python
for command in commands:
   cur.execute(command)
```

The `create_tables()` function will create four tables in the `suppliers` database:

- `vendors` – stores vendor data.
- `parts` – stores the part data.
- `vendor_parts` – stores the links between vendors and parts.
- `part_drawings` – stores the drawing of the parts.

The following diagram illustrates the tables and their relationships:

![PostgreSQL Python Sample Database Diagram](/postgresqltutorial/PostgreSQL-Python-Sample-Database-Diagram.png)

### 2\) Execute the create_tables.py script

The following command executes the `create_tables.py` module that calls the `create_tables()` function:

```python
python create_table.py
```

### 3\) Verify the table creation

First, open the Command Prompt on Windows or Terminal on Unix\-like systems and connect to the PostgreSQL server using the `psql` client tool.

```python
psql -U postgres
```

It’ll prompt you for a password for the `postgres` user.

Second, change the current database to `suppliers`:

```python
\c suppliers
```

Third, [show tables](../postgresql-administration/postgresql-show-tables) in the `suppliers` database using the `\dt` command:

```python
\dt
```

Output:

```python
             List of relations
 Schema |     Name      | Type  |  Owner
--------+---------------+-------+----------
 public | part_drawings | table | postgres
 public | parts         | table | postgres
 public | vendor_parts  | table | postgres
 public | vendors       | table | postgres
(4 rows)
```

The output indicates that the `suppliers` database has four tables.

[Download the project source code](/postgresqltutorial/create_tables.zip)

## Summary

- Call the `execute()` method of the `Cursor` object to execute a `CREATE TABLE` statement to create a new table in the database.


# Insert Data Into Table in Python

---
title: 'PostgreSQL Python: Insert Data Into a Table'
page_title: 'PostgresSQL Python: Insert Data Into a Table'
page_description: 'This tutorial shows you the step by step how to insert one or more rows into a PostgreSQL table in Python.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-python/insert/'
ogImage: '/postgresqltutorial/vendors_table.png'
updatedOn: '2024-05-19T08:29:59+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Python: Create Tables'
  slug: 'postgresql-python/create-tables'
nextLink:
  title: 'PostgreSQL Python: Update Data in a Table'
  slug: 'postgresql-python/update'
---

**Summary**: in this tutorial, you will learn to insert one or more rows into a PostgreSQL table from Python.

This tutorial picks up from where the [Creating Tables Tutorial](create-tables) left off.

## Steps for inserting one row into a table from Python

To insert one or more rows into a table from Python, you follow these steps:

- First, [connect to the PostgreSQL server](connect).
- Next, create a `cursor` object from the `connection` object.
- Then, execute the [INSERT](../postgresql-tutorial/postgresql-insert) statement with values by calling the `execute()` or `executemany()` method of the `cursor` object.
- After that, commit the transaction by calling the `commit()` method of the `connection` object.
- Finally, obtain the inserted ID by calling the `fetchone()` method of the `cursor` object.

## Inserting data into a table example

We will use the `vendors` table in the `suppliers` database for the demonstration purposes:

![vendors_table](/postgresqltutorial/vendors_table.png)

### 1\) Inserting one row into a table

First, create a new file named insert.py.

Second, define a `insert_vendor()` function in the insert.py file:

```pythonsql
import psycopg2
from config import load_config


def insert_vendor(vendor_name):
    """ Insert a new vendor into the vendors table """

    sql = """INSERT INTO vendors(vendor_name)
             VALUES(%s) RETURNING vendor_id;"""

    vendor_id = None
    config = load_config()

    try:
        with  psycopg2.connect(**config) as conn:
            with  conn.cursor() as cur:
                # execute the INSERT statement
                cur.execute(sql, (vendor_name,))

                # get the generated id back
                rows = cur.fetchone()
                if rows:
                    vendor_id = rows[0]

                # commit the changes to the database
                conn.commit()
    except (Exception, psycopg2.DatabaseError) as error:
        print(error)
    finally:
        return vendor_id


if __name__ == '__main__':
    insert_vendor("3M Co.")
```

The `insert_vendor()` function will insert a new row into the `vendors` table and return the inserted `vendor_id`.

### 2\) Inserting multiple rows into a table

The steps for inserting multiple rows into a table are similar to the steps for inserting one row.

The key difference is in the third step: instead of calling the `execute()` method of the `cursor` object, you use the `executemany()` method.

For example, the following defines `insert_many_vendors()` function that inserts multiple rows into the `vendors` table:

```python
def insert_many_vendors(vendor_list):
    """ Insert multiple vendors into the vendors table  """

    sql = "INSERT INTO vendors(vendor_name) VALUES(%s) RETURNING *"
    config = load_config()
    try:
        with  psycopg2.connect(**config) as conn:
            with  conn.cursor() as cur:
                # execute the INSERT statement
                cur.executemany(sql, vendor_list)

            # commit the changes to the database
            conn.commit()
    except (Exception, psycopg2.DatabaseError) as error:
        print(error)
```

The following uses the `insert_vendor()` and `insert_many_vendors()` functions to insert one and multiple rows into the `vendors` table:

```css
if __name__ == '__main__':
    insert_vendor("3M Co.")

    insert_many_vendors([
        ('AKM Semiconductor Inc.',),
        ('Asahi Glass Co Ltd.',),
        ('Daikin Industries Ltd.',),
        ('Dynacast International Inc.',),
        ('Foster Electric Co. Ltd.',),
        ('Murata Manufacturing Co. Ltd.',)
    ])
```

### 3\) Execute the insert.py module

First, open the Command Prompt on Windows or Terminal on Unix\-like systems.

Second, run the following command to execute the `insert.py` module:

```
python insert.py
```

### 4\) Verify the inserts

First, [connect to the PostgreSQL server](connect) using the `psql`:

```
psql -U postgres
```

Second, change the current database to `suppliers`:

```
\c suppliers
```

Third, retrieve data from the `vendors` table:

```
SELECT * FROM vendors;
```

Output:

```
 vendor_id |          vendor_name
-----------+-------------------------------
         1 | 3M Co.
         2 | AKM Semiconductor Inc.
         3 | Asahi Glass Co Ltd.
         4 | Daikin Industries Ltd.
         5 | Dynacast International Inc.
         6 | Foster Electric Co. Ltd.
         7 | Murata Manufacturing Co. Ltd.
(7 rows)
```

[Download the project source code](/postgresqltutorial/insert.zip)

## Summary

- Use the `execute()` or `executemany()` method of the `cursor` object to insert one or more rows into a table from Python.


# Update Data in Python

---
title: 'PostgreSQL Python: Update Data in a Table'
page_title: 'PostgreSQL Python: Update Data in a Table'
page_description: 'In this tutorial, you will learn how to update data in a PostgreSQL database table in a Python program using psycopg2 package.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-python/update/'
ogImage: '/postgresqltutorial/vendors_table.png'
updatedOn: '2024-05-19T08:31:04+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Python: Insert Data Into a Table'
  slug: 'postgresql-python/insert'
nextLink:
  title: 'PostgreSQL Python: Querying Data'
  slug: 'postgresql-python/query'
---

**Summary**: in this tutorial, you will learn how to update data in a PostgreSQL table from a Python program.

This tutorial picks up from where the [Inserting Data Into Table Tutorial](insert) left off.

## Steps for updating data in a PostgreSQL table from Python

To update data from a table in Python, you follow these steps:

- First, [connect to the PostgreSQL server](connect).
- Next, create a `cursor` object from the `connection` object.
- Then, execute an [UPDATE](../postgresql-tutorial/postgresql-update) statement by calling the `execute()` method of the `cursor` object.
- After that, commit the changes by calling the `commit()` method of the `connection` object.
- Finally, optionally obtain the number of updated rows from the `rowcount` property of the `cursor` object.

## Updating data in a table example

We will use the `vendors` table in the `suppliers` database for the demonstration:

![vendors_table](/postgresqltutorial/vendors_table.png)

### 1\) Creating update.py module

Suppose a vendor changed its name, you need to reflect these changes in the `vendors` table.

To achieve this, you can define a function `update_vendor()`, which updates the vendor name based on the vendor id.

First, create a new module called `update.py` in the project directory.

Second, define `update_vendor()` function in the `update.py` module:

```python
import psycopg2
from config import load_config


def update_vendor(vendor_id, vendor_name):
    """ Update vendor name based on the vendor id """

    updated_row_count = 0

    sql = """ UPDATE vendors
                SET vendor_name = %s
                WHERE vendor_id = %s"""

    config = load_config()

    try:
        with  psycopg2.connect(**config) as conn:
            with  conn.cursor() as cur:

                # execute the UPDATE statement
                cur.execute(sql, (vendor_name, vendor_id))
                updated_row_count = cur.rowcount

            # commit the changes to the database
            conn.commit()
    except (Exception, psycopg2.DatabaseError) as error:
        print(error)
    finally:
        return updated_row_count

if __name__ == '__main__':
    update_vendor(1, "3M Corp")
```

### 2\) Execute the update.py module

First, open the Command Prompt on Windows or Terminal on Unix\-like systems.

Second, execute the `update.py` module:

```css
python update.py
```

### 3\) Verify the update

First, connect to the PostgreSQL server using the `psql` client tool:

```bash
psql -U postgres
```

Second, change the current database to `suppliers`:

```
\c suppliers
```

Third, retrieve data from the `vendors` table with the vendor id 1:

```
SELECT
  *
FROM
  vendors
WHERE
  vendor_id = 1;
```

Output:

```shell
 vendor_id | vendor_name
-----------+-------------
         1 | 3M Corp
(1 row)
```

The name of the vendor id 1 has been changed as expected.

[Download the project source code](/postgresqltutorial/update.zip)

## Summary

- Use the `execute()` method of a `cursor` object to execute an `UPDATE` statement that updates data in a table


# Query Data in Python

---
title: 'PostgreSQL Python: Querying Data'
page_title: 'PostgreSQL Python: Querying Data'
page_description: 'This tutorial shows you how to query data from the PostgreSQL tables in Python using the fetchone, fetchall, and fetchmany methods.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-python/query/'
ogImage: 'https://www.postgresqltutorial.com//postgresqltutorial/PostgreSQL-Python-Sample-Database-Diagram.png'
updatedOn: '2024-05-19T08:32:12+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Python: Update Data in a Table'
  slug: 'postgresql-python/update'
nextLink:
  title: 'PostgreSQL Python: Transactions'
  slug: 'postgresql-python/transaction'
---

**Summary**: in this tutorial, you will learn how to query data from the PostgreSQL tables in Python.

This tutorial picks up from where the [Handling BLOB Data Tutorial](blob) left off.

## The steps for querying data from a PostgreSQL table in Python

To query data from one or more PostgreSQL tables in Python, you use the following steps.

First, [establish a connection to the PostgreSQL server](connect) by calling the `connect()` function of the `psycopg2` module.

```pythonsql
conn = psycopg2.connect(config)
```

If the connection is created successfully, the `connect()` function returns a new `Connection` object; Otherwise, it throws a `DatabaseError` exception.

Next, create a new cursor by calling the `cursor()` method of the `Connection` object. The `cursor` object is used to execute a [SELECT](../postgresql-tutorial/postgresql-select) statement.

```python
cur = conn.cursor()
```

Then, execute a `SELECT` statement by calling the `execute()` method. If you want to pass values to the `SELECT` statement, you use the placeholder  ( `%s`) in the `SELECT` statement and bind the input values when calling the `execute()` method:

```python
cur.execute(sql, (value1,value2))
```

After that, process the result set returned by the SELECT statement using the `fetchone()`,  `fetchall()`, or `fetchmany()` method.

- The `fetchone()` fetches the next row in the result set. It returns a single tuple or `None` when no more row is available.
- The `fetchmany(size=cursor.arraysize)` fetches the next set of rows specified by the `size` parameter. If you omit this parameter, the  `arraysize` will determine the number of rows to be fetched. The  `fetchmany()` method returns a list of tuples or an empty list if no more rows are available.
- The `fetchall()` fetches all rows in the result set and returns a list of tuples. If there are no rows to fetch, the  `fetchall()` method returns an empty list.

Finally, close the database connection by calling the `close()` method of the `Cursor` and `Connection` objects

```python
cur.close()
conn.close()
```

If you use context managers, you don’t need to explicitly call the `close()` methods of the `Cursor` and `Connection` objects.

## Querying data using the fetchone() method

For the demonstration purposes, we will use the `parts`, `vendors`, and `vendor_parts` tables in the `suppliers` database:

![PostgreSQL Python Sample Database Diagram](/postgresqltutorial/PostgreSQL-Python-Sample-Database-Diagram.png)The following `get_vendor()` function selects data from the `vendors` table and fetches the rows using the  `fetchone()` method.

```python
import psycopg2
from config import load_config

def get_vendors():
    """ Retrieve data from the vendors table """
    config  = load_config()
    try:
        with psycopg2.connect(**config) as conn:
            with conn.cursor() as cur:
                cur.execute("SELECT vendor_id, vendor_name FROM vendors ORDER BY vendor_name")
                print("The number of parts: ", cur.rowcount)
                row = cur.fetchone()

                while row is not None:
                    print(row)
                    row = cur.fetchone()

    except (Exception, psycopg2.DatabaseError) as error:
        print(error)

if __name__ == '__main__':
    get_vendors()
```

Output:

```python
The number of parts:  8
(1, '3M Corp')
(2, 'AKM Semiconductor Inc.')
(3, 'Asahi Glass Co Ltd.')
(4, 'Daikin Industries Ltd.')
(5, 'Dynacast International Inc.')
(6, 'Foster Electric Co. Ltd.')
(8, 'LG')
(7, 'Murata Manufacturing Co. Ltd.')
```

## Querying data using the fetchall() method

The following `get_parts()` function uses the `fetchall()` method of the cursor object to fetch rows from the result set and display all the parts in the `parts` table.

```sql
import psycopg2
from config import load_config

def get_vendors():
    """ Retrieve data from the vendors table """
    config  = load_config()
    try:
        with psycopg2.connect(**config) as conn:
            with conn.cursor() as cur:
                cur.execute("SELECT vendor_id, vendor_name FROM vendors ORDER BY vendor_name")
                rows = cur.fetchall()

                print("The number of parts: ", cur.rowcount)
                for row in rows:
                    print(row)

    except (Exception, psycopg2.DatabaseError) as error:
        print(error)

if __name__ == '__main__':
    get_vendors()
```

```python
The number of parts:  8
(1, '3M Corp')
(2, 'AKM Semiconductor Inc.')
(3, 'Asahi Glass Co Ltd.')
(4, 'Daikin Industries Ltd.')
(5, 'Dynacast International Inc.')
(6, 'Foster Electric Co. Ltd.')
(8, 'LG')
(7, 'Murata Manufacturing Co. Ltd.')
```

## Querying data using the fetchmany() method

The following `get_suppliers()` function selects parts and vendor data using the `fetchmany()` method.

```python
import psycopg2
from config import load_config

def iter_row(cursor, size=10):
    while True:
        rows = cursor.fetchmany(size)
        if not rows:
            break
        for row in rows:
            yield row

def get_part_vendors():
    """ Retrieve data from the vendors table """
    config  = load_config()
    try:
        with psycopg2.connect(**config) as conn:
            with conn.cursor() as cur:
                cur.execute("""
                    SELECT part_name, vendor_name
                    FROM parts
                    INNER JOIN vendor_parts ON vendor_parts.part_id = parts.part_id
                    INNER JOIN vendors ON vendors.vendor_id = vendor_parts.vendor_id
                    ORDER BY part_name;
                """)
                for row in iter_row(cur, 10):
                    print(row)
    except (Exception, psycopg2.DatabaseError) as error:
        print(error)

if __name__ == '__main__':
    get_part_vendors()
```

Output:

```
('Antenna', 'Foster Electric Co. Ltd.')
('Antenna', 'Murata Manufacturing Co. Ltd.')
('Home Button', 'Dynacast International Inc.')
('Home Button', '3M Corp')
('LTE Modem', 'Dynacast International Inc.')
('LTE Modem', '3M Corp')
('SIM Tray', 'AKM Semiconductor Inc.')
('SIM Tray', '3M Corp')
('Speaker', 'Daikin Industries Ltd.')
('Speaker', 'Asahi Glass Co Ltd.')
('Vibrator', 'Dynacast International Inc.')
('Vibrator', 'Foster Electric Co. Ltd.')
```

[Download the project source code](/postgresqltutorial/query.zip)

In this tutorial, we have learned how to select data from the PostgreSQL tables in Python using the `fetchone()`, `fetchall()`, and `fetchmany()` methods.


# Handle Transactions in Python

---
title: 'PostgreSQL Python: Transactions'
page_title: 'PostgreSQL Python: Managing Transactions'
page_description: 'You will learn how to manage PostgreSQL transactions in Python using the commit() and rollback() methods of the connection object.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-python/transaction/'
ogImage: '/postgresqltutorial/parts_vendors_tables.png'
updatedOn: '2024-01-29T13:40:36+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Python: Querying Data'
  slug: 'postgresql-python/query'
nextLink:
  title: 'PostgreSQL Python: Call PostgreSQL Functions'
  slug: 'postgresql-python/postgresql-python-call-postgresql-functions'
---

**Summary**: in this tutorial, you will learn how to handle PostgreSQL transactions in Python.

This tutorial picks up from where the [Updating Data in a Table Tutorial](update) left off.

## Introduction to transactions in Python

In the `psycopg2` package, the `connection` class is responsible for managing transactions.

When you send the first SQL statement to the PostgreSQL database using a `cursor` object, `psycopg2` initiates a new [transaction](../postgresql-tutorial/postgresql-transaction).

Subsequentially, all the following statements are executed within the same transaction. If any statement encounters an error, `psycopg2` will abort the entire transaction.

The `connection` class has two methods for concluding a transaction:

- `commit()` – Use this method to permanently apply all changes to the PostgreSQL database.
- `rollback()` – Call this method to discard the changes.

Closing a connection object by calling the close() method or deleting it using `del` will also trigger an implicit rollback:

```csssql
conn.close()
```

Or

```python
del conn
```

Alternatively, you can set the `autocommit` attribute of the `connection` object to `True`. This ensures that `psycopg2` executes every statement and commits it immediately.

The `autocommit` mode can be particularly useful when executing statements that need to operate outside a transaction, such as [CREATE DATABASE](../postgresql-administration/postgresql-create-database) and `VACUUM`.

The following shows a typical pattern for managing a transaction in `psycopg2`:

```
import psycopg2

conn = None
try:
    conn = psycopg2.connect(config)
    cur = conn.cursor()

    # execute 1st statement
    cur.execute(statement1)

    # execute 2nd statement
    cur.execute(statement2)

    # commit the transaction
    conn.commit()

    # close the cursor
    cur.close()
except psycopg2.DatabaseError as error:
    if conn:
       conn.rollback()
    print(error)
finally:
    if conn:
        conn.close()
```

## Managing transactions using context managers

Starting from `psycopg` 2\.5, the connection and cursor are [context managers](https://www.pythontutorial.net/advanced-python/python-context-managers/) therefore you can use them in the `with` statement:

```python
with psycopg2.connect(config) as conn:
    with conn.cursor() as cur:
        cur.execute(sql)
```

The `psycopg2` commits the transaction if no exception occurs within the `with` block, otherwise, it rolls back the transaction.

Unlike other [context manager](https://www.pythontutorial.net/advanced-python/python-context-managers/) objects, exiting the `with` block does not close the connection but only terminates the transaction. Consequentially, you can use the same `connection` object in the subsequent `with` statements in another transaction as follows:

```python
conn = psycopg2.connect(config)

# transaction 1
with conn:
    with conn.cursor() as cur:
        cur.execute(sql)

# transaction 2
with conn:
    with conn.cursor() as cur:
        cur.execute(sql)

conn.close()
```

## PostgreSQL transaction example

We will use the `parts` and `vendor_parts` tables in the `suppliers` database:

![parts_vendors_tables](/postgresqltutorial/parts_vendors_tables.png)Suppose you need to add a new part and assign the vendors who supply the part at the same time.

To achieve this, you can do as follows:

- First, [insert a new row](../postgresql-tutorial/postgresql-insert) into the `parts` table and get the part id.
- Then, insert rows into the `vendor_parts` table.

The following `add_part()` function demonstrates the steps:

```python
import psycopg2
from config import load_config


def add_part(part_name, vendor_list):
    # statement for inserting a new row into the parts table
    insert_part = "INSERT INTO parts(part_name) VALUES(%s) RETURNING part_id;"

    # statement for inserting a new row into the vendor_parts table
    assign_vendor = "INSERT INTO vendor_parts(vendor_id,part_id) VALUES(%s,%s)"

    conn = None
    config = load_config()

    try:
        with psycopg2.connect(**config) as conn:
            with conn.cursor() as cur:
                # insert a new part
                cur.execute(insert_part, (part_name,))

                # get the part id
                row = cur.fetchone()
                if row:
                    part_id = row[0]
                else:
                    raise Exception('Could not get the part id')

                # assign parts provided by vendors
                for vendor_id in vendor_list:
                    cur.execute(assign_vendor, (vendor_id, part_id))

                # commit the transaction
                conn.commit()
    except (Exception, psycopg2.DatabaseError) as error:
        if conn:
            conn.rollback()

        print(error)

if __name__ == '__main__':
    add_part('SIM Tray', (1, 2))
    add_part('Speaker', (3, 4))
    add_part('Vibrator', (5, 6))
    add_part('Antenna', (6, 7))
    add_part('Home Button', (1, 5))
    add_part('LTE Modem', (1, 5))
```

### 2\) Execute the transaction.py module

First, open the Command Prompt on Windows or Terminal on Unix\-like systems.

Second, run the following command to execute the `transaction.py` module:

```css
python transaction.py
```

### 3\) Verify transaction

First, connect to the `suppliers` on the PostgreSQL server:

```python
psql -U postgres -d suppliers
```

Second, retrieve data from the `parts` table:

```
SELECT * FROM parts;
```

Output:

```
 part_id |  part_name
---------+-------------
       1 | SIM Tray
       2 | Speaker
       3 | Vibrator
       4 | Antenna
       5 | Home Button
       6 | LTE Modem
(6 rows)
```

Third, query data from the `vendor_parts` table:

```
SELECT * FROM vendor_parts;
```

Output:

```
 vendor_id | part_id
-----------+---------
         1 |       1
         2 |       1
         3 |       2
         4 |       2
         5 |       3
         6 |       3
         6 |       4
         7 |       4
         1 |       5
         5 |       5
         1 |       6
         5 |       6
(12 rows)
```

### 4\) Test a failed transaction

Let’s insert another part, but this time, we intentionally use an invalid vendor id for demonstration purposes.

The program should not add a new part without assigning it to a vendor.

```
if __name__ == '__main__':
    # no rows inserted into the parts and vendor_parts tables
    add_part('Power Amplifier', (99,))
```

An exception occurred.

```
insert or update on table "vendor_parts" violates foreign key constraint "vendor_parts_vendor_id_fkey"
DETAIL:  Key (vendor_id)=(99) is not present in table "vendors".
```

You can query data from the `parts` and `vendor_parts` tables again. There will be no new data, meaning that the program works as expected.

[Download the project source code](/postgresqltutorial/transaction.zip)

## Summary

- Use the `commit()` method to permanently apply all changes to the database.
- Use the `rollback()` method to discard the changes.


# Call PostgreSQL Functions in Python

---
title: 'PostgreSQL Python: Call PostgreSQL Functions'
page_title: 'PostgreSQL Python: Call PostgreSQL Functions'
page_description: 'In this tutorial, you will learn how to call PostgreSQL functions from a Python program.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-python/postgresql-python-call-postgresql-functions/'
ogImage: ''
updatedOn: '2024-01-29T13:45:56+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Python: Transactions'
  slug: 'postgresql-python/transaction'
nextLink:
  title: 'PostgreSQL Python: Call Stored Procedures'
  slug: 'postgresql-python/call-stored-procedures'
---

**Summary**: in this tutorial, you will learn how to call PostgreSQL functions from a Python program.

This tutorial picks up from where the [Transaction Tutorial](transaction) left off.

## Calling a PostgreSQL function in Python

To call a PostgreSQL function from a Python program, you use the following steps:

First, [create a new database connection](connect) to the PostgreSQL server by calling the `connect()` function of the `psycopg2` module.

```pythonsql
conn = psycopg2.connect(config)
```

The `connect()` method returns a new instance of the `connection` class.

Next, create a new cursor by calling the `cursor()` method of the `connection` object.

```python
cur = conn.cursor()
```

Then, pass the name of the function and the optionally pass values to the `callproc()` method of the `cursor` object:

```sql
cur.callproc('function_name', (value1,value2))
```

Internally, the `callproc()` method translates the function call and input values into the following statement:

```sql
SELECT * FROM function_name(value1,value2);
```

Therefore, you can use the `execute()` method of the `cursor` object to call a function as follows:

```python
cur.execute("SELECT * FROM function_name( %s,%s); ",(value1,value2))
```

Both statements have the same effect.

After that, process the result set returned by the function using the `fetchone()`,  `fetchall()`, or `fetchmany()` method.

Finally, call the `close()` method of the `cursor` and `connection` objects to close the communication with the PostgreSQL database server:

```python
cur.close()
conn.close()
```

## Calling a PostgreSQL function example

Let’s take an example of calling a PostgreSQL function from Python.

### 1\) Create a new function

First, open the Command Prompt on Windows or Terminal on Unix\-like systems and connect to the `suppliers` database:

```python
psql -U postgres -d suppliers
```

Second, execute the following command to create a new function called `get_parts_by_vendors()` that returns a list of parts by a specified vendor:

```
CREATE OR REPLACE FUNCTION get_parts_by_vendor(id INTEGER)
  RETURNS TABLE(part_id INTEGER, part_name VARCHAR) AS
$$
BEGIN
 RETURN QUERY

 SELECT parts.part_id, parts.part_name
 FROM parts
 INNER JOIN vendor_parts on vendor_parts.part_id = parts.part_id
 WHERE vendor_id = id;

END; $$

LANGUAGE plpgsql;
```

Notice that you can use any PostgreSQL client tools to create a function such as pgAdmin.

### 2\) Create call_function.py module

First, create a new module in the project directory called `call_function.py`:

Second, define a new function called `get_parts()` that calls the `get_parts_by_vendors()` function in PostgreSQL:

```
import psycopg2
from config import load_config


def get_parts(vendor_id):
    """ Get parts provided by a vendor specified by the vendor_id """
    parts = []
    # read database configuration
    params = load_config()
    try:
        # connect to the PostgreSQL database
        with  psycopg2.connect(**params) as conn:
            with conn.cursor() as cur:
                # create a cursor object for execution
                cur = conn.cursor()
                cur.callproc('get_parts_by_vendor', (vendor_id,))

                # process the result set
                row = cur.fetchone()
                while row is not None:
                    parts.append(row)
                    row = cur.fetchone()

    except (Exception, psycopg2.DatabaseError) as error:
        print(error)
    finally:
        return parts

if __name__ == '__main__':
    parts = get_parts(1)
    print(parts)
```

### 3\) Call the call_function.py module

Run the following command to execute the `call_function.py` module:

```css
python call_function.py
```

Output:

```json
[(1, 'SIM Tray'), (5, 'Home Button'), (6, 'LTE Modem')]
```

[Download the project source code](/postgresqltutorial/call_function.zip)

## Summary

- Use the `callproc()` method of the `cursor` object to call a function in PostgreSQL from Python.


# Call PostgreSQL Stored Procedures in Python

---
title: 'PostgreSQL Python: Call Stored Procedures'
page_title: 'PostgreSQL Python: Call PostgreSQL Stored Procedures'
page_description: 'In this tutorial, you will learn how to call PostgreSQL stored procedures from a Python program.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-python/call-stored-procedures/'
ogImage: ''
updatedOn: '2024-01-29T13:48:43+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Python: Call PostgreSQL Functions'
  slug: 'postgresql-python/postgresql-python-call-postgresql-functions'
nextLink:
  title: 'PostgreSQL Python: Handling Binary Data'
  slug: 'postgresql-python/blob'
---

**Summary**: in this tutorial, you will learn how to call PostgreSQL stored procedures from a Python program.

This tutorial picks up from where the [Call PostgreSQL Functions Tutorial](postgresql-python-call-postgresql-functions) left off.

## Steps for calling a PostgreSQL stored procedure in Python

To call a PostgreSQL stored procedure in a Python program, you follow these steps:

First, [create a new database connection](connect) to the PostgreSQL database server by calling the `connect()` function:

```pythonsql
conn = psycopg2.connect(config)
```

The `connect()` method returns a new instance of the `connection` class.

Next, create a new cursor by calling the `cursor()` method of the `connection` object.

```python
cur = conn.cursor()
```

Then, pass the name of the stored procedure and optional input values to the `execute()` method of the `cursor` object. For example:

```python
cur.execute("CALL sp_name(%s, %s);", (val1, val2))
```

If your stored procedure does not accept any parameters, you can omit the second argument like this:

```python
cur.execute("CALL sp_name);")
```

After that, call the `commit()` method to commit the transaction:

```python
conn.commit();
```

Finally, call the `close()` method of the `cursor` and `connection` objects to close the connection to the PostgreSQL database server.

```python
cur.close()
conn.close()
```

If you use context managers, you don’t need to explicitly call the `close()` method of the cursor and connection.

## Calling a stored procedure example

Let’s take an example of calling a PostgreSQL stored procedure in Python.

### 1\) Create a new stored procedure

First, open the Command Prompt on Windows or Terminal on Unix\-like systems.

Second, connect to the `suppliers` database on the local PostgreSQL server:

```python
psql -U postgres -d suppliers
```

Third, create a new stored procedure called `add_new_part()`:

```
CREATE OR REPLACE PROCEDURE add_new_part(
	new_part_name varchar,
	new_vendor_name varchar
)
AS $$
DECLARE
	v_part_id INT;
	v_vendor_id INT;
BEGIN
	-- insert into the parts table
	INSERT INTO parts(part_name)
	VALUES(new_part_name)
	RETURNING part_id INTO v_part_id;

	-- insert a new vendor
	INSERT INTO vendors(vendor_name)
	VALUES(new_vendor_name)
	RETURNING vendor_id INTO v_vendor_id;

	-- insert into vendor_parts
	INSERT INTO vendor_parts(part_id, vendor_id)
	VALUEs(v_part_id,v_vendor_id);

END;
$$
LANGUAGE PLPGSQL;
```

### 2\) Create the call_stored_procedure.py module

First, create a new module called `call_stored_procedure.py` file in the project directory.

Second, define the following `add_part()` function that calls the `add_new_part()` stored procedure from the `suppliers` database:

```sql
import psycopg2
from config import load_config


def add_part(part_name, vendor_name):
    """ Add a new part """
    # read database configuration
    params = load_config()

    try:
        # connect to the PostgreSQL database
        with psycopg2.connect(**params) as conn:
            with conn.cursor() as cur:
                # call a stored procedure
                cur.execute('CALL add_new_part(%s,%s)', (part_name, vendor_name))

            # commit the transaction
            conn.commit()
    except (Exception, psycopg2.DatabaseError) as error:
        print(error)


if __name__ == '__main__':
    add_part('OLED', 'LG')
```

### 3\) Execute the Python module

Execute the following command to run the `call_stored_procedure.py` module:

```plaintext
python call_stored_procedure.py
```

### 4\) Verify the result

Execute the following statement to retrieve data from the `parts`, `vendors`, and `vendor_parts` tables to verify the result:

```
SELECT * FROM parts;
SELECT * FROM vendors;
SELECT * FROM vendor_parts;
```

[Download the project source code](/postgresqltutorial/call_stored_procedure.zip)

## Summary

- Use the `execute()` method of a `cursor` object to execute a stored procedure call.
- Use the `CALL sp_name(arguments)` syntax to construct a stored procedure call.


# Work with BLOB Data in Python

---
title: 'PostgreSQL Python: Handling Binary Data'
page_title: 'PostgreSQL Python: Handling Binary Data'
page_description: 'In this tutorial, you will learn how to store binary data in the PostgreSQL database using Python.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-python/blob/'
ogImage: '/postgresqltutorial/parts_part_drawings_tables.png'
updatedOn: '2024-04-20T13:39:35+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Python: Call Stored Procedures'
  slug: 'postgresql-python/call-stored-procedures'
nextLink:
  title: 'PostgreSQL Python: Delete Data from Tables'
  slug: 'postgresql-python/delete'
---

**Summary**: in this tutorial, you will learn how to store binary data in the PostgreSQL database using Python.

This tutorial picks up from where the [Call Stored Procedures Tutorial](call-stored-procedures) left off.

Standard SQL defines a `BLOB` as the binary large object for storing binary data in the database. Using the `BLOB` data type, you can store binary data such as images, documents, and so on in a table.

PostgreSQL does not support BLOB data type. Instead, it uses the [`BYTEA` data type](../postgresql-tutorial/postgresql-bytea-data-type) for storing binary data.

Let’s take a look at the `part_drawings` table.

![parts_part_drawings_tables](/postgresqltutorial/parts_part_drawings_tables.png)The `part_drawings` table stores the pictures of parts in the `drawing_data` column. We will show you how to insert binary data into this column and read it back.

## Insert binary data into a table

To insert binary data into a table, you use the following steps:

1. First, read data from a file.
2. Next, [connect to the PostgreSQL database](connect) by creating a new connection object from the `connect()` function.
3. Then, create a `cursor` object from the `Connection` object.
4. After that, execute the [INSERT](../postgresql-tutorial/postgresql-insert) statement with the input values. For binary data, use the `Binary` object of the `psycopg2` module
5. Finally, commit the changes permanently to the PostgreSQL database by calling the `commit()` method of the `connection` object.

The following `write_blob()` function reads binary data from a file specified by the `path_to_file` parameter and inserts it into the `part_drawings` table.

```python
import psycopg2
from config import load_config


def write_blob(part_id, path_to_file, file_extension):
    """ Insert a BLOB into a table """
    # read database configuration
    params = load_config()

    # read data from a picture
    data = open(path_to_file, 'rb').read()


    try:
        # connect to the PostgresQL database
        with psycopg2.connect(**params) as conn:
            # create a new cursor object
            with  conn.cursor() as cur:
                # execute the INSERT statement
                cur.execute("INSERT INTO part_drawings(part_id,file_extension,drawing_data) " +
                            "VALUES(%s,%s,%s)",
                            (part_id, file_extension, psycopg2.Binary(data)))

            conn.commit()

    except (Exception, psycopg2.DatabaseError) as error:
        print(error)

if __name__ == '__main__':
    write_blob(1, 'images/input/simtray.png', 'png')
    write_blob(2, 'images/input/speaker.png', 'png')
```

## Read binary data from a table

The steps of reading binary data from a table are similar to the steps of querying data from a table. After fetching binary data from the table, you can save it to a file, output it to the web browser, and so on.

The following `read_blob()` function selects BLOB data from the `part_drawings` table based on a specified part id and saves the binary data to a file.

```python
import psycopg2
from config import load_config

def read_blob(part_id, path_to_dir):
    """ Read BLOB data from a table """
    # read database configuration
    config = load_config()

    try:
        # connect to the PostgresQL database
        with  psycopg2.connect(**config) as conn:
            with conn.cursor() as cur:
                # execute the SELECT statement
                cur.execute(""" SELECT part_name, file_extension, drawing_data
                                FROM part_drawings
                                INNER JOIN parts on parts.part_id = part_drawings.part_id
                                WHERE parts.part_id = %s """,
                            (part_id,))

                blob = cur.fetchone()

                # write blob data into file
                open(path_to_dir + blob[0] + '.' + blob[1], 'wb').write(blob[2])
    except (Exception, psycopg2.DatabaseError) as error:
        print(error)

if __name__ == '__main__':
    read_blob(1, 'images/output/')
    read_blob(2, 'images/output/')
```

The following snippet reads the binary data of the parts with id values 1 and 2 and saves the binary data to the `images/output` directory.

[Download the project source code](/postgresqltutorial/blob.zip)

In this tutorial, you have learned how to write binary data to a table and read it back using Python.


# Delete Data from Tables in Python

---
title: 'PostgreSQL Python: Delete Data from Tables'
page_title: 'PostgreSQL Python: Delete Data from Tables'
page_description: 'This tutorial shows you how to delete data from PostgreSQL tables in Python program using psycopg database adapter.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-python/delete/'
ogImage: ''
updatedOn: '2024-05-19T08:40:51+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Python: Handling Binary Data'
  slug: 'postgresql-python/blob'
nextLink:
  title: 'PostgreSQL JDBC'
  slug: 'postgresql-python/../postgresql-jdbc'
---

**Summary**: This tutorial shows you how to delete data from PostgreSQL tables in Python.

This tutorial picks up from where the [Querying Data from Tables Tutorial](query) left off.

## Steps for deleting data from a PostgreSQL table in Python

To delete data from the PostgreSQL table in Python, you use the following steps:

First, [create a new database connection](connect) by calling the `connect()` function of the `psycopg2` module.

```pythonsql
conn = psycopg2.connect(config)
```

The `connect()` function returns a new `connection` object.

Next, create a new `Cursor` object by calling the `cursor()` method of the `Connection` object:

```python
cur = conn.cursor()
```

Then, execute the [DELETE](../postgresql-tutorial/postgresql-delete) statement. If you want to pass values to the `DELETE` statement, you use the placeholders ( `%s`) in the `DELETE` statement and pass input values to the second parameter of the `execute()` method.

The `DELETE` statement with a placeholder for the value of the `id` field is as follows:

```python
DELETE FROM table_1 WHERE id = %s;
```

To bind value `value1` to the placeholder, you call the `execute()` method and pass the input value as a tuple to the second parameter like the following:

```sql
cur.execute(delete_sql, (value1,))
```

After that, save the changes to the database permanently by calling the `commit()` method of the `connection` object.

```sql
conn.commit()
```

Finally, close the communication with the PostgreSQL database server by calling the `close()` method of the `cursor` and `connection` objects.

```sql
cur.close()
conn.close()
```

If you use context managers, you don’t need to explicitly close the cursor or connection.

## Example of deleting data in PostgreSQL table in Python

We will use the `parts` table in the `suppliers` database for the demonstration purposes.

The following `delete_part()` function deletes a row in the `parts` table specified by the `part_id`.

```python
import psycopg2
from config import load_config


def delete_part(part_id):
    """ Delete part by part id """

    rows_deleted  = 0
    sql = 'DELETE FROM parts WHERE part_id = %s'
    config = load_config()

    try:
        with  psycopg2.connect(**config) as conn:
            with  conn.cursor() as cur:
                # execute the UPDATE statement
                cur.execute(sql, (part_id,))
                rows_deleted = cur.rowcount

            # commit the changes to the database
            conn.commit()
    except (Exception, psycopg2.DatabaseError) as error:
        print(error)
    finally:
        return rows_deleted

if __name__ == '__main__':
    deleted_rows = delete_part(2)
    print('The number of deleted rows: ', deleted_rows)
```

Now we run the Python program to delete the part with the part id 1\.

```python
python delete.py
```

Output:

```
The number of deleted rows:  1
```

Retrieve data from the `parts` table again to confirm the deletion:

```
SELECT * FROM parts;
```

Output:

```
 part_id |  part_name
---------+-------------
       1 | SIM Tray
       3 | Vibrator
       4 | Antenna
       5 | Home Button
       6 | LTE Modem
       8 | OLED
(6 rows)
```

The output indicates that part id 2 has been deleted successfully.

[Download the project source code](/postgresqltutorial/delete.zip)

## Summary

- Use the `execute()` method of a `cursor` object to delete a row from a table.


# PostgreSQL JDBC

---
title: 'PostgreSQL JDBC'
page_title: 'PostgreSQL JDBC'
page_description: 'In this PostgreSQL JDBC section, you will learn how to interact with the PostgreSQL databases in Java using the PostgreSQL JDBC driver.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-jdbc/'
ogImage: 'https://www.postgresqltutorial.com//postgresqltutorial/PostgreSQL-JDBC.png'
updatedOn: '2024-01-31T08:53:11+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL Python: Delete Data from Tables'
  slug: 'postgresql-python/delete'
nextLink:
  title: 'PostgreSQL JDBC: Connecting to PostgreSQL Databases'
  slug: 'postgresql-jdbc/connecting-to-postgresql-database'
---

In this section on PostgreSQL JDBC, you’ll learn the process of interacting with the PostgreSQL databases from Java programs using the JDBC driver.

JDBC, as the core API of Java, offers a standardized interface for communication with SQL\-compliant databases, especially PostgreSQL.

![PostgreSQL JDBC Tutorial](/postgresqltutorial/PostgreSQL-JDBC.jpg?alignright)

### What you’ll learn

- Install JDK, setup Java IDE, and download PostgreSQL JDBC driver
- Connect to the PostgreSQL server from Java programs.
- Perform common database operations such as creating tables, inserting data, querying data, updating data, and deleting data.
- Call PostgreSQL stored functions and stored procedures.
- Handle Transactions.

### Prerequisites

- Basic Java programming.
- Know how to connect to PostgreSQL using psql and execute queries.

## Section 1\. Getting Started

This section helps you get started by setting up JDK, installing Java IDE, downloading the PostgreSQL JDBC driver, and connecting to the PostgreSQL server from a Java program.

- [Connecting to the PostgreSQL database server](postgresql-jdbc/connecting-to-postgresql-database) – Show you how to connect to the PostgreSQL database server from a Java program.

## Section 2\. Performing Common Database Operations

This section shows you how to perform common database operations including creating tables, inserting data, querying data, updating data, and deleting data.

- [Creating Tables](postgresql-jdbc/create-tables) – Learn how to create tables in the PostgreSQL database using JDBC.
- [Inserting Data](postgresql-jdbc/insert) – Guide you on how to insert one or more rows into a table.
- [Querying Data](postgresql-jdbc/query) – Walk you through the steps for querying data from a table.
- [Updating Data](postgresql-jdbc/update) – Provide you with the steps for updating existing data in a table.
- [Deleting Data](postgresql-jdbc/delete) – Show you how to delete one or more rows from a table.

## Section 3\. Calling stored functions \& stored procedures

This section guides you on how to call stored functions and stored procedures in PostgreSQL from Java programs.

- [Calling PostgreSQL stored functions](postgresql-jdbc/call-postgresql-stored-function) – Guide you on how to call PostgreSQL stored functions including built\-in and user\-defined stored functions.

## Section 4\. Handling Transactions

This section explores how to manage PostgreSQL transactions in a Java program.

- [Handling database transactions](postgresql-jdbc/transaction) – Show you how to manage PostgreSQL transactions in Java.


# Connecting to PostgreSQL

---
title: 'PostgreSQL JDBC: Connecting to PostgreSQL Databases'
page_title: 'PostgreSQL JDBC: Connecting To The PostgreSQL Database'
page_description: 'How to setup Java environment, download PostgreSQL JDBC driver, and connect to the PostgreSQL database server from a Java program.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-jdbc/connecting-to-postgresql-database/'
ogImage: ''
updatedOn: '2024-05-14T14:32:43+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL JDBC'
  slug: 'postgresql-jdbc/'
nextLink:
  title: 'PostgreSQL JDBC: Creating Tables'
  slug: 'postgresql-jdbc/create-tables'
---

**Summary**: in this tutorial, you will learn how to connect to the PostgreSQL database server from a Java program.

## Creating a new database

First, open the Command Prompt on Windows or the Terminal on Unix\-like systems and connect to the local PostgreSQL database server using `psql` client tool:

```php
psql -U postgres
```

Second, create a new database called `sales`:

```
CREATE DATABASE sales;
```

Third, exit the `psql`:

```
exit
```

## Setting up JDK

Follow [this tutorial to install JDK](https://www.javazerotomastery.com/java-tutorial/install-jdk/) on your computer.

## Installing IntelliJ IDE

We’ll use the IntelliJ IDE.

## Downloading PostgreSQL JDBC Driver

To connect to the PostgreSQL server from a Java program, you need a PostgreSQL JDBC driver.

You can download the latest version of the driver on the [jdbc.postgresql.org download page](https://jdbc.postgresql.org/download/). The downloaded file is a jar file e.g., `postgresql-42.7.1.jar`.

## Creating a new project

First, launch the IntellJ IDE.

Next, create a new project called `sales`.

Then, right\-click the project name and choose the **Open Module Settings**.

After that, choose the **Libraries** under **Project Settings** and click **New Project Library**.

Finally, select the PostgreSQL database driver file such as `postgresql-42.7.1.jar`.

## Creating a database configuration file

First, create a new file called `db.properties` file in the `src` directory of the project.

Second, add the connection parameters to the `db.properties` file:

```properties
db.url=jdbc:postgresql://localhost:5432/sales
db.username=Yourusername
db.password=YourPassword
```

The `config.properties` include three connection parameters:

- `db.url`: The URL of the PostgreSQL database server. In this example, we connect to the `sales` database on the local PostgreSQL server with port 5432 (default port).
- `db.user`: The user account that connects to the database.
- `db.password`: The password for the user.

Note that you need to replace the `YourUsername` and `YourPassword` with the actual ones.

## Defining a DatabaseConfig class

First, create a new file in the `src` directory called `DatabaseConfig.java`.

Second, define the `DatabaseConfig` class in the `DatabaseConfig.java` file:

```java
import java.io.IOException;
import java.io.InputStream;
import java.util.Properties;

public class DatabaseConfig {
    private static final Properties properties = new Properties();

    static {
        try (InputStream input = DatabaseConfig.class.getClassLoader().getResourceAsStream("db.properties")) {
            if (input == null) {
                System.out.println("Sorry, unable to find db.properties");
                System.exit(1);
            }

            // Load the properties file
            properties.load(input);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public static String getDbUrl() {

        return properties.getProperty("db.url");
    }

    public static String getDbUsername() {
        return properties.getProperty("db.username");
    }

    public static String getDbPassword() {
        return properties.getProperty("db.password");
    }
}
```

The `DatabaseConfig` class is responsible for loading database configuration from the `db.properties` file.

The `DatabaseConfig` has three static methods that expose the database configuration:

- `getDbUrl()` – Return the database URL.
- `getDbUsername()` – Return the username.
- `getDbPassword()` – Return the password.

## Creating a DB class

First, create a new file named `DB.java` file in the `src` directory

Second, define the `DB` class with the following code:

```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;


public class DB {
    public static Connection connect() throws SQLException {

        try {
            // Get database credentials from DatabaseConfig class
            var jdbcUrl = DatabaseConfig.getDbUrl();
            var user = DatabaseConfig.getDbUsername();
            var password = DatabaseConfig.getDbPassword();

            // Open a connection
            return DriverManager.getConnection(jdbcUrl, user, password);

        } catch (SQLException  e) {
            System.err.println(e.getMessage());
            return null;
        }
    }
}

```

The `DB` class has the static method, `connect()`, which connects to the sales database on the local PostgreSQL server.

The connect() method utilizes the `DatabaseConfig` class to load the connection parameters and establish a connection to the database using the `getConnection()` method of the `DriverManager` class.

The `connect()` method returns a `Connection` object if it successfully established a connection to PostgreSQL, or null otherwise.

If any `SQLException` occurs during the connection process, the `connect()` method displays the details of the exception.

## Creating a Java Program

First, create the `Main.java` file in the src directory.

Second, define the `Main` class in the `Main.java` file with the following code:

```java
import java.sql.SQLException;

public class Main {
    public static void main(String[] args){
        try (var connection =  DB.connect()){
            System.out.println("Connected to the PostgreSQL database.");
        } catch (SQLException e) {
            System.err.println(e.getMessage());
        }
    }
}
```

The `main()` of the `Main` class uses the `DB` class to connect to the `sales` database on the local PostgreSQL server by calling the `connect()` method.

It displays a message if the connection is established successfully or an error if an `SQLException` occurs.

The try\-with\-resources statement ensures that the `Connection` is automatically closed even if an exception occurs.

If you run the program and see the following output, meaning that the program is successfully connected to the PostgreSQL server:

```
Connected to the PostgreSQL database.
```

## Summary

- Use the `DriverManager.getConnection()` method to establish a connection to a database on a PostgreSQL server.


# Creating Tables

---
title: 'PostgreSQL JDBC: Creating Tables'
page_title: 'PostgreSQL JDBC: Creating Tables'
page_description: 'In this tutorial, you will learn how to create tables in a PostgreSQL database from a Java program using JDBC.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-jdbc/create-tables/'
ogImage: ''
updatedOn: '2024-02-02T04:56:46+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL JDBC: Connecting to PostgreSQL Databases'
  slug: 'postgresql-jdbc/connecting-to-postgresql-database'
nextLink:
  title: 'PostgreSQL JDBC: Insert Data into a Table'
  slug: 'postgresql-jdbc/insert'
---

**Summary**: in this tutorial, you will learn how to create tables in a PostgreSQL database from a Java program using JDBC.

## Creating table program

The following example shows how to create tables in the PostgreSQL database from a Java program:

```java
import java.sql.SQLException;

public class Main {
    public static void main(String[] args) {

        var sql = "CREATE TABLE products (" +
                "    id SERIAL PRIMARY KEY," +
                "    name VARCHAR(255) NOT NULL," +
                "    price DECIMAL(10, 2) NOT NULL" +
                ");";
        try (var conn =  DB.connect();
             var stmt = conn.createStatement()) {
            stmt.executeUpdate(sql);
        } catch (SQLException e) {
            System.err.println(e.getMessage());
        }
    }
}
```

How it works.

First, construct a `CREATE TABLE` statement that creates the `products` table:

```java
var sql = "CREATE TABLE products (" +
            "    id SERIAL PRIMARY KEY," +
            "    name VARCHAR(255) NOT NULL," +
            "    price DECIMAL(10, 2) NOT NULL" +
            ");";
```

Second, [establish a connection](connecting-to-postgresql-database) to `sales` database on the local PostgreSQL server using the `DB` class:

```java
var conn =  DB.connect();
```

Third, create a `Statement` by calling the `createStatement()` method of the `Connection` object:

```java
var stmt = conn.createStatement()
```

Fourth, execute the `CREATE` `TABLE` statement by calling the `executeUpdate()` method.

```java
stmt.executeUpdate(sql);
```

The try\-catch statement will display an error message if any `SQLException` occurs.

Since the `connect()` and `createStatement()` method calls are wrapped in a try\-with\-resources statement, the `Statement` and `Connection` will be closed properly.

If you run the program, it’ll create the `products` in the `sales` database.

## Verify the table creation

First, open the Command Prompt on Windows or Terminal on Unix\-like systems.

Second, connect to the `sales` database on the local PostgreSQL server using the `psql` client tool:

```java
psql -U postgres -d sales
```

It’ll prompt you for a password.

Third, use the `\dt` command to [show tables](../postgresql-administration/postgresql-show-tables) in the `sales` database:

```java
\dt
```

Output:

```java
          List of relations
 Schema |   Name   | Type  |  Owner
--------+----------+-------+----------
 public | products | table | postgres
(1 row)
```

The output indicates that the `products` table has been created successfully.

## Summary

- Call the `executeUpdate()` method of a Statement object to execute a `CREATE TABLE` statement to create a new table in the PostgreSQL database.


# Inserting Data

---
title: 'PostgreSQL JDBC: Insert Data into a Table'
page_title: 'PostgreSQL JDBC: Insert Data into a Table'
page_description: 'In this tutorial, you will learn how to insert one or more rows into a table in the PostgreSQL database using JDBC.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-jdbc/insert/'
ogImage: ''
updatedOn: '2024-02-02T04:56:04+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL JDBC: Creating Tables'
  slug: 'postgresql-jdbc/create-tables'
nextLink:
  title: 'PostgreSQL JDBC: Querying Data'
  slug: 'postgresql-jdbc/query'
---

**Summary**: in this tutorial, you will learn how to insert data into a table in the PostgreSQL database using JDBC.

## Inserting one row into a table

We’ll use the `products` table from the `sales` database for the demonstration.

### Defining a Product class

The following creates `Product.java` file and defines the `Product` class with three properties `id`, `name`, and `price`. These properties correspond to the columns in the `products` table:

```javasqlsql
public class Product {
    private int id;
    private String name;
    private double price;

    public Product(int id, String name, double price){
        this(name,price);
        this.id = id;
    }

    public Product(String name, double price) {
        this.name = name;
        this.price = price;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public double getPrice() {
        return price;
    }

    public void setPrice(double price) {
        this.price = price;
    }

    public int getId() { return id;  }

    public void setId(int id) { this.id = id; }

    @Override
    public String toString() {
        return "Product{" +
                "id=" + id +
                ", name='" + name + '\'' +
                ", price=" + price +
                '}';
    }
}

```

### Defining a ProductDB class

The following creates a new file called `ProductDB.java` and defines the `ProductDB` class:

```java
import java.sql.SQLException;
import java.sql.Statement;
import java.util.List;

public class ProductDB {


    public static int add(Product product) {
        var sql = "INSERT INTO products(name, price) "
                + "VALUES(?,?)";

        try (var conn =  DB.connect();
             var pstmt = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS)) {

            // bind the values
            pstmt.setString(1, product.getName());
            pstmt.setDouble(2, product.getPrice());

            // execute the INSERT statement and get the inserted id
            int insertedRow = pstmt.executeUpdate();
            if (insertedRow > 0) {
                var rs = pstmt.getGeneratedKeys();
                if (rs.next()) {
                    return rs.getInt(1);
                }
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
        return -1;
    }
}
```

The `add()` method inserts a new row into the `products` table.

How it works.

First, initialize an `INSERT` statement:

```java
var sql = "INSERT INTO products(name,price) "
          + "VALUES(?,?)";
```

The question mark (`?`) is a placeholder that will be replaced by the actual values later.

Second, open a connection to the sales database on the local PostgreSQL server using the `DB` class:

```java
var conn =  DB.connect();
```

Third, create a `PreparedStatement` object by calling the `preparedStatement()` method:

```java
var pstmt = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS)
```

The `Statement.RETURN_GENERATED_KEYS` argument instructs the `PreparedStatement` object to return the generated id key of the product.

Fourth, bind the values to the statement:

```java
pstmt.setString(1, product.getName());
pstmt.setDouble(2, product.getPrice());
```

Behind the scenes, the `PreparedStatement` will validate the values and bind them to the placeholders (?) accordingly.

Fifth, execute the `INSERT` statement and return the number of inserted rows by calling the `executeUpdate()` method of the `PreparedStatement` object:

```java
int insertedRow = pstmt.executeUpdate();
```

Sixth, retrieve the inserted id and return it:

```java
if (insertedRow > 0) {
    var rs = pstmt.getGeneratedKeys();
    if (rs.next()) {
        return rs.getInt(1);
    }
}
```

If any `SQLException` occurs, display the detail of the exception in the catch block.

Since the Connection and `PreparedStatement` objects are created in the try\-with\-resources statement, they will be automatically closed.

### Adding a product

The following `main()` method uses the `add()` method of the ProductDB class to insert a new row into the `products` table:

```java
public class Main {
    public static void main(String[] args) {
        int id = ProductDB.add(new Product("Phone Case", 19.99));
        System.out.println("Inserted id:" + id);
    }
}
```

If you run the program, it’ll show the following output:

```java
Inserted id:1
```

### Verify the insert

Connect to the `sales` database and retrieve the data from the `products` table to verify the insert:

```plaintext
SELECT * FROM products;
```

Output:

```
 id |    name    | price
----+------------+-------
  1 | Phone Case | 19.99
(1 row)
```

## Inserting multiple rows into a table

Define a new method add() that accepts a list of `Product` objects and inserts them into the `products` table:

```java
import java.sql.SQLException;
import java.sql.Statement;
import java.util.List;

public class ProductDB {

    public static void add(List<Product> products){
        var sql = "INSERT INTO products(name, price) "
                + "VALUES(?,?)";

        try (var conn =  DB.connect();
             var pstmt = conn.prepareStatement(sql)) {
             for (var product : products) {
                 pstmt.setString(1, product.getName());
                 pstmt.setDouble(2, product.getPrice());
                 pstmt.addBatch();
             }
             pstmt.executeBatch();

        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
    // ...
}
```

How it works.

First, initialize an `INSERT` statement:

```
var sql = "INSERT INTO products(name,price) "
          + "VALUES(?,?)";
```

Second, open a connection and create a `PreparedStatement` object:

```java
try (var conn =  DB.connect();
     var pstmt = conn.prepareStatement(sql)) {
// ...
```

The try\-with\-resources statement ensures that the `PreparedStatement` and `Connection` objects will be closed automatically.

Third, iterate over the `Product` in the `Products` list, bind the values to the statement, and add the statement to a batch for insertion:

```java
for (var product : products) {
    pstmt.setString(1, product.getName());
    pstmt.setDouble(2, product.getPrice());
    pstmt.addBatch();
}
```

Finally, execute insert statements in batch by calling the `executeBatch()` method of the `PreparedStatement` object:

```java
pstmt.executeBatch();
```

### Adding multiple products

The following shows how to use the `ProductDB` class to add multiple products to the `products` table:

```java
import java.util.ArrayList;

public class Main {
    public static void main(String[] args) {

        var products = new ArrayList<Product>();

        products.add(new Product("Power Bank",19.99));
        products.add(new Product("Screen Protector", 29.99));
        products.add(new Product("Wireless Charger", 35.99));
        products.add(new Product("Bluetooth Headphones", 199));
        products.add(new Product("Phone Stand", 24.99));
        products.add(new Product("Ring Holder", 39.99));
        products.add(new Product("Car Mount", 29.98));
        products.add(new Product("Selfie Stick", 29.99));
        products.add(new Product("Smartwatch", 399.97));

        ProductDB.add(products);
    }
}

```

### Verify the inserts

Connect to the `sales` database and query data from the `products` table to verify the inserts:

```java
SELECT * FROM products;
```

Output:

```php
 id |         name         | price
----+----------------------+--------
  1 | Phone Case           |  19.99
  2 | Power Bank           |  19.99
  3 | Screen Protector     |  29.99
  4 | Wireless Charger     |  35.99
  5 | Bluetooth Headphones | 199.00
  6 | Phone Stand          |  24.99
  7 | Ring Holder          |  39.99
  8 | Car Mount            |  29.98
  9 | Selfie Stick         |  29.99
 10 | Smartwatch           | 399.97
(10 rows)
```

The output indicates the new `add()` method added nine rows to the `products` table successfully.

## Summary

- Call the `executeUpdate()` method of the `PreparedStatement` object to execute the `INSERT` statement to insert a new row into a table.
- Use the `addBatch()` and the `executeBatch()` methods of the `PreparedStatement` object to execute batch inserts.


# Querying Data

---
title: 'PostgreSQL JDBC: Querying Data'
page_title: 'PostgreSQL JDBC: Querying Data'
page_description: 'In this tutorial,  you will learn how to query data from a table in the PostgreSQL database using JDBC API.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-jdbc/query/'
ogImage: ''
updatedOn: '2024-01-31T04:06:17+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL JDBC: Insert Data into a Table'
  slug: 'postgresql-jdbc/insert'
nextLink:
  title: 'PostgreSQL JDBC: Updating Data'
  slug: 'postgresql-jdbc/update'
---

**Summary**: in this tutorial, you will learn how to query data from a table in the PostgreSQL database using JDBC API.

## Steps for querying data

To query data from a table using JDBC, you follow these steps:

- [Establish a database connection](connecting-to-postgresql-database) to the PostgreSQL server.
- Create an instance of the `Statement` or `PreparedStatement` object.
- Execute a statement to get a `ResultSet` object.
- Process the `ResultSet` object.
- Close the `Statement` \& `Connection` object by calling their `close()` method.

If you use the try\-with\-resources statement, you don’t need to explicitly call the `close()` method of the `Statement` or `Connection` object. It will automatically close these objects.

### 1\) Establishing a database connection

Use the `getConnection()` method of the `DriverManager` class to establish a connection to the PostgreSQL server.

```javasql
return DriverManager.getConnection(url, user, password);
```

We’ll use the `DB` class created in the [connecting to the PostgreSQL server](connecting-to-postgresql-database) to connect to the PostgreSQL server.

### 2\) Creating a Statement object

In JDBC, a `Statement` object represents an SQL statement.

- First, create a `Statement` object from the `Connection` object.
- Then, execute the `Statement` object to get a `ResultSet` object that represents a database result set.

JDBC offers three types of `Statement` objects:

- `Statement`: use the Statement to implement a simple SQL statement that has no parameters.
- `PreparedStatement`: is the subclass of the `Statement` class, which allows you to bind parameters to the SQL statement.
- `CallableStatement`: extends the `PreparedStatement` class that can execute a stored procedure.

### 3\) Executing a query

To execute a query, you use one of the following methods of the `Statement` object:

- `execute()`: Return true if the first object of the query is a `ResultSet` object. You can get the `ResultSet` by calling the method `getResultSet()`.
- `executeQuery()`: Return only one `ResultSet` object.
- `executeUpdate()`: Return the number of rows affected by the statement. Typically, you use this method for executing the [INSERT](../postgresql-tutorial/postgresql-insert), [DELETE](../postgresql-tutorial/postgresql-delete), or [UPDATE](../postgresql-tutorial/postgresql-update) statement.

### 4\) Processing the ResultSet

Once having a `ResultSet` object, you use a while loop to iterate over the result in the result set:

```java
while (rs.next()) {
   // ...
}
```

### 5\) Closing a database connection

To close a `Statement` or `Connection` object, you call the `close()` method explicitly in the `finally` clause of the `try...catch...finally` statement. This ensures that the resources are closed properly even if any exception occurs.

Starting from JDBC 4\.1, you can use a try\-with\-resources statement to close `ResultSet`, `Statement`, and `Connection` objects automatically.

## Querying data examples

Let’s explore some examples of querying data from a table using JDBC.

### 1\) Querying all rows from the products table

Define a new function findAll() in the ProductDB class to retrieve all rows from the products table:

```java
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

public class ProductDB {

    public static List<Product> findAll() {
        var products = new ArrayList<Product>();

        var sql = "SELECT id, name, price FROM products ORDER BY name";

        try (var conn =  DB.connect();
             var stmt = conn.createStatement()) {

            var rs = stmt.executeQuery(sql);

            while (rs.next()) {
                var product = new Product(
                        rs.getInt("id"),
                        rs.getString("name"),
                        rs.getDouble("price"));
                products.add(product);
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
        return products;
    }

    // ...
}
```

How it works.

First, initialize an `ArrayList` to store the returned products.

```java
 var products = new ArrayList<Product>();
```

Second, construct a query that retrieves all rows from the `products` table:

```java
var sql = "SELECT id, name, price FROM products ORDER BY name";
```

Third, open a database connection and create a `Statement` object:

```java
try (var conn =  DB.connect();
     var stmt = conn.createStatement()) {
// ..
```

The try\-with\-resources will automatically close the `Statement` and `Connection` objects.

Fourth, execute the `SELECT` statement by calling the `executeQuery()` method:

```java
var rs = stmt.executeQuery(sql);
```

Fifth, iterate over the result set, initialize the `Product` object, and add it to the `products` list:

```java
while (rs.next()) {
    var product = new Product(
        rs.getInt("id"),
        rs.getString("name"),
        rs.getDouble("price")
    );
    products.add(product);
}
```

Finally, return the products list:

```css
return products;
```

The following shows how to use the findAll() method of the ProductDB class to retrieve all data from the products table and display each in the standard output:

```sql
public class Main {
    public static void main(String[] args) {

        var products = ProductDB.findAll();
        for (var product:  products) {
            System.out.println(product);
        }

    }
}
```

Output:

```sql
Product{id=5, name='Bluetooth Headphones', price=199.0}
Product{id=8, name='Car Mount', price=29.98}
Product{id=1, name='Phone Case', price=19.99}
Product{id=6, name='Phone Stand', price=24.99}
Product{id=2, name='Power Bank', price=19.99}
Product{id=7, name='Ring Holder', price=39.99}
Product{id=3, name='Screen Protector', price=29.99}
Product{id=9, name='Selfie Stick', price=29.99}
Product{id=10, name='Smartwatch', price=399.97}
Product{id=4, name='Wireless Charger', price=35.99}
```

### 2\) Querying data with parameters

The following defines a method called findById() to find the product by id:

```sql
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

public class ProductDB {
     public static Product findById(int id){
        var sql = "SELECT id, name, price FROM products WHERE id=?";

        try (var conn =  DB.connect();
             var pstmt = conn.prepareStatement(sql)) {

            pstmt.setInt(1, id);
            var rs = pstmt.executeQuery();
            if (rs.next()) {
                return new Product(
                    rs.getInt("id"),
                    rs.getString("name"),
                    rs.getDouble("price")
                );
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
        return null;
    }
    // ...
}
```

How it works.

First, construct a SELECT that selects a product by id and use the question mark (?) as the placeholder:

```sql
var sql = "SELECT id, name, price FROM products WHERE id=?";
```

Second, open a connection to the database and create a `PreparedStatement` object:

```sql
try (var conn =  DB.connect();
     var pstmt = conn.prepareStatement(sql)) {
//...
```

Third, bind the id to the statement:

```sql
pstmt.setInt(1, id);
```

Fourth, execute the statement using the `executeQuery()` method of the PreparedStatement object:

```
var rs = pstmt.executeQuery();
```

Fifth, process the result set if the row with specified id exists and return the Product object:

```sql
if (rs.next()) {
    return new Product(
        rs.getInt("id"),
        rs.getString("name"),
        rs.getDouble("price")
    );
}
```

The following shows how to use the `findById()` in the `main()` method of the Main() class to retrieve the product with id 1 from the `products` table:

```sql
public class Main {
    public static void main(String[] args) {

        var p = ProductDB.findById(1);
        if(p != null){
            System.out.println(p);
        }
    }
}
```

Output:

```sql
Product{id=1, name='Phone Case', price=19.99}
```

## Summary

- Use the `executeQuery()` method of the `Statement` or `PreparedStatement` object to retrieve data from a table.


# Updating Data

---
title: 'PostgreSQL JDBC: Updating Data'
page_title: 'PostgreSQL JDBC: Updating Data'
page_description: 'In this tutorial, you will learn how to update data in a PostgreSQL database using JDBC API.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-jdbc/update/'
ogImage: ''
updatedOn: '2024-02-02T04:57:49+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL JDBC: Querying Data'
  slug: 'postgresql-jdbc/query'
nextLink:
  title: 'PostgreSQL JDBC: Delete Data from Table'
  slug: 'postgresql-jdbc/delete'
---

**Summary**: in this tutorial, you will learn how to update data in a PostgreSQL database using JDBC API.

## Steps for updating data

To update data in a table of a PostgreSQL database, you follow these steps:

- Create a database connection by instantiating a `Connection` object.
- Create a `PreparedStatement` object.
- Execute an [UPDATE statement](../postgresql-tutorial/postgresql-update) by calling the `executeUpdate()` method of the `PreparedStatement` object.
- Close the `PreparedStatement` and `Connection` objects by calling the `close()` method.

## Updating data example

The following defines the `update()` method that changes the `name` and `price` of a product specified by product id:

```javasql
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

public class ProductDB {

    public static int update(int id, String name, double price) {
        var sql  = "UPDATE products "
                + "SET name = ?, price= ? "
                + "WHERE id = ?";

        int affectedRows = 0;

        try (var conn  = DB.connect();
             var pstmt = conn.prepareStatement(sql)) {

            pstmt.setString(1, name);
            pstmt.setDouble(2, price);
            pstmt.setInt(3, id);

            affectedRows = pstmt.executeUpdate();

        } catch (SQLException e) {
            e.printStackTrace();
        }
        return affectedRows;
    }

 // ...
}
```

How it works.

First, construct an `UPDATE` statement that updates the `name` and `price` of a product by id:

```java
 var sql  = "UPDATE products "
                + "SET name = ?, price= ? "
                + "WHERE id = ?";
```

Second, initialize a variable that stores the number of affected rows:

```java
int affectedRows = 0;
```

Third, establish a connection and create a `PreparedStatement` object:

```
try (var conn  = DB.connect();
     var pstmt = conn.prepareStatement(sql)) {
// ...
```

Fourth, bind values to the statement:

```java
pstmt.setString(1, name);
pstmt.setDouble(2, price);
pstmt.setInt(3, id);
```

Fifth, execute the statement and assign the return value of the `executeUpdate()` method to the `affectedRows` variable:

```java
affectedRows = pstmt.executeUpdate();
```

Finally, return the number of affected rows:

```java
return affectedRows;
```

The following shows how to use the `ProductDB` class to update the name and price of the product:

```java
public class Main {
    public static void main(String[] args) {
        int updatedRows = ProductDB.update(1, "Phone Cover", 22.49);
        System.out.println("Updated Rows: " + updatedRows);
    }
}
```

Output:

```plaintext
Updated Rows: 1
```

## Verify the update

First, open the Command Prompt on Windows or Terminal on Linux and connect to the PostgreSQL server:

```plaintext
psql -U postgres -d sales
```

Second, retrieve the product with id 1 to verify the update:

```
SELECT * FROM products
WHERE id = 1;
```

## Summary

- Use a `PreparedStatement` object to update data in a table from a Java program.


# Deleting Data

---
title: 'PostgreSQL JDBC: Delete Data from Table'
page_title: 'PostgreSQL JDBC: Delete Data from Table'
page_description: 'In this tutorial, you will learn how to delete data from a table in the PostgreSQL database using JDBC.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-jdbc/delete/'
ogImage: ''
updatedOn: '2024-02-02T04:58:33+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL JDBC: Updating Data'
  slug: 'postgresql-jdbc/update'
nextLink:
  title: 'PostgreSQL JDBC: Call Stored Functions'
  slug: 'postgresql-jdbc/call-postgresql-stored-function'
---

**Summary**: in this tutorial, you will learn how to delete data from a table in the PostgreSQL database using JDBC.

## Steps for deleting data from a table in JDBC

To delete data from a Java program, you follow these steps:

- [Establish a database connection to PostgreSQL.](connecting-to-postgresql-database)
- Create a `PreparedStatement` object.
- Execute a [DELETE statement](../postgresql-tutorial/postgresql-delete).
- Close the database connection.

## Deleting data example

The following example adds a delete() function to the `ProductDB` class to delete a product by id:

```javasql
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

public class ProductDB {
    public static int delete(int id) {
        var sql  = "DELETE FROM products WHERE id=?";

        try (var conn  = DB.connect();
             var pstmt = conn.prepareStatement(sql)) {

            pstmt.setInt(1, id);

            return pstmt.executeUpdate();

        } catch (SQLException e) {
            e.printStackTrace();
        }

        return 0;
    }

    // ...
}
```

How it works.

First, construct a DELETE statement to delete a product from the products table specified by id:

```java
var sql  = "DELETE FROM products WHERE id=?";
```

Second, open a database connection and create a PreparedStatement object:

```java
try (var conn  = DB.connect();
     var pstmt = conn.prepareStatement(sql)) {
// ...
```

The try\-with\-resources statement will automatically close the statement and connection.

Third, bind the id to the statement:

```java
pstmt.setInt(1, id);
```

Fourth, execute the prepared statement and return the number of deleted rows:

```java
return pstmt.executeUpdate();
```

The following shows how to use the delete() method of the `ProductDB` class to delete a product with the id 1 from the database table:

```java
public class Main {
    public static void main(String[] args) {
        int deletedRows = ProductDB.delete(1);
        System.out.println("Deleted Rows: " + deletedRows);
    }
}
```

Output:

```plaintext
Deleted Rows: 1
```

## Verify the deletion

First, open the Command Prompt on Windows or Terminal on Linux and connect to the PostgreSQL server:

```
psql -U postgres -d sales
```

Second, retrieve the product with id 1 to verify the deletion:

```plaintext
SELECT * FROM products
WHERE id = 1;
```

Output:

```
 id | name | price
----+------+-------
(0 rows)
```

The result set is empty, meaning that the program deleted the product with id 1 successfully.

## Summary

- Use the `PreparedStatement` to delete data from a table using JDBC.


# Calling PostgreSQL Stored Functions

---
title: 'PostgreSQL JDBC: Call Stored Functions'
page_title: 'PostgreSQL JDBC: Call Stored Functions'
page_description: 'In this tutorial, you will learn how to call PostgreSQL stored functions using JDBC.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-jdbc/call-postgresql-stored-function/'
ogImage: ''
updatedOn: '2024-01-31T08:32:29+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL JDBC: Delete Data from Table'
  slug: 'postgresql-jdbc/delete'
nextLink:
  title: 'PostgreSQL JDBC: Managing Transactions'
  slug: 'postgresql-jdbc/transaction'
---

**Summary**: in this tutorial, you will learn how to call PostgreSQL stored functions using JDBC.

## Calling a built\-in stored function example

We will call a built\-in string function [`initcap()`](../postgresql-string-functions/postgresql-letter-case-functions) that capitalizes the first letter of each word in a string.

To call the `initcap()` function, you follow these steps:

- First, [establish a database connection](connecting-to-postgresql-database).
- Second, create a `CallableStatement` object by calling the `prepareCall()` method of the `Connection` object.
- Register `OUT` parameters if applicable.
- Bind values to the statement if applicable.
- Third, execute the function call and obtain the result.

The following example creates a new class named `Util` and defines a static method `properCase()` that calls the `initcap()` function in PostgreSQL:

```javasql
import java.sql.SQLException;
import java.sql.Types;

public class Util {
    public static String properCase(String s) {
        try (var conn = DB.connect();
             var stmt = conn.prepareCall("{ ? = call initcap( ? ) }")) {
            stmt.registerOutParameter(1, Types.VARCHAR);
            stmt.setString(2, s);
            stmt.execute();
            return stmt.getString(1);
        } catch (SQLException e) {
            e.printStackTrace();
        }
        return null;
    }
}
```

The following illustrates how to use the `properCase()` method of the `Util` class:

```sql
public class Main {
    public static void main(String[] args) {
        var greeting = Util.properCase("hello joe");
        System.out.println(greeting);
    }
}
```

Output:

```sql
Hello Joe
```

## Calling a stored function example

Let’s take an example of calling a stored function in PostgreSQL from a Java program using JDBC.

### Creating a stored function

First, open Command Prompt on Windows or Terminal on Unix\-like systems and connect to the sales database on your PostgreSQL server:

```
psql -U postgres -d sales
```

Second, create a function that finds the products by name based on a specified pattern:

```
create or replace function find_products (
	p_pattern varchar
)
returns table (
	p_id int,
	p_name varchar,
	p_price decimal
)
language plpgsql
as $$
declare
    var_r record;
begin
	for var_r in(
		select id, name, price
		from products
		where name ilike p_pattern
    )
	loop
		p_id := var_r.id;
		p_name := var_r.name;
		p_price := var_r.price;
        return next;
	end loop;
end; $$
```

Third, exit the psql:

```php
exit
```

### Calling a stored function

The following defines the `findByName()` method in the `ProductDB` class that calls the `find_products` stored function to find the products by names based on a pattern:

```java
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

public class ProductDB {
    public static List<Product> findByName(String pattern) {
        String SQL = "SELECT * FROM find_products (?)";

        var products = new ArrayList<Product>();

        try (var conn = DB.connect();
             var pstmt = conn.prepareStatement(SQL)) {

            pstmt.setString(1, pattern);
            var rs = pstmt.executeQuery();

            while (rs.next()) {
                var product = new Product(
                        rs.getInt("p_id"),
                        rs.getString("p_name"),
                        rs.getDouble("p_price")
                );
                products.add(product);
            }
        } catch (SQLException e) {
            System.out.println(e.getMessage());
        }
        return products;
    }

// ...
}
```

The following uses the `findByName()` method of the `ProductDB` class to search for products with the name containing the string `"phone"`:

```java
public class Main {
    public static void main(String[] args) {

        var products = ProductDB.findByName("%phone%");

        for (var product: products) {
            System.out.println(product);
        }
    }
}
```

Output:

```
Product{id=5, name='Bluetooth Headphones', price=199.0}
Product{id=6, name='Phone Stand', price=24.99}
```

## Summary

- Use the `CallableStatement` to call a built\-in function from PostgreSQL.


# Managing Transactions

---
title: 'PostgreSQL JDBC: Managing Transactions'
page_title: 'PostgreSQL JDBC: Transactions'
page_description: 'In this tutorial, you will learn how to manage transactions in PostgreSQL using JDBC API utilizing the commit() and rollback() methods.'
prev_url: 'https://www.postgresqltutorial.com/postgresql-jdbc/transaction/'
ogImage: ''
updatedOn: '2024-02-02T05:00:10+00:00'
enableTableOfContents: true
previousLink:
  title: 'PostgreSQL JDBC: Call Stored Functions'
  slug: 'postgresql-jdbc/call-postgresql-stored-function'
nextLink:
  title: 'PostgreSQL C#'
  slug: 'postgresql-jdbc/../postgresql-csharp'
---

**Summary**: in this tutorial, you will learn how to manage PostgreSQL transactions in Java programs using JDBC.

## Steps for performing a PostgreSQL transaction in JDBC

The following are the steps for carrying out a transaction in JDBC:

### Step 1\. Establish a Connection

Use `DriverManager.getConnection(url, user, password)` to establish a connection to your PostgreSQL database.

```csssql
var connection = DriverManager.getConnection("jdbc:postgresql://your-database-host:your-database-port/your-database-name", "your-username", "your-password");
```

In this code, you need to replace `url`, `user`, and `password` with your actual database connection details.

### Step 2\. Disable Auto\-Commit

JDBC operates in auto\-commit mode by default, to manually control the transaction, you need to disable the auto\-commit mode using the `setAutoComit()` method as follows:

```sql
connection.setAutoCommit(false);
```

### Step 3\. Perform database operations

Perform a database transaction using `Statement` or `PreparedStatement` within the transaction:

```sql
var statement = connection.createStatement();
// execute the statement
// ...
```

### Step 4\. Commit the transaction

Commit the changes to the database permanently if all database operations within the transaction are successful using the `commit()` method of the `Connection` object:

```sql
connection.commit();
```

### Step 5\. Rollback on failure

Undo the changes to the database if an exception occurs during the transaction using the `rollback()` method:

```css
connection.rollback();
```

### Step 6\. Close resources

Close the `Connection`, `Statement`, and `ResultSet` (if applicable) to release resources.

```css
connection.close();
statement.close();
```

Note that if you use the try\-with\-resources, you don’t need to call the `close()` method explicitly to release resources.

### Step 7\. Exception handling

Handle exceptions appropriately using the `try...catch...finally` statement and perform a rollback in case of an exception to ensure data consistency:

```
try {
    // perform a database operation...
    connection.commit();
} catch (SQLException e) {
    connection.rollback();
    e.printStackTrace();
} finally {
    connection.close();
}
```

## Summary

- Use the `commit()` method to apply permanent changes to the database.
- Use the `rollback()` method to undo the changes.


